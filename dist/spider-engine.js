
      if (typeof exports === 'undefined') { var exports = {}; }
      var spider = exports;!function(t,e){for(var n in e)t[n]=e[n]}(exports,function(t){function webpackJsonpCallback(e){for(var r,i,o=e[0],s=e[1],c=0,u=[];c<o.length;c++)i=o[c],n[i]&&u.push(n[i][0]),n[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);for(a&&a(e);u.length;)u.shift()()}var e={},n={1:0};function __webpack_require__(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,__webpack_require__),r.l=!0,r.exports}__webpack_require__.e=function requireEnsure(t){var e=[],r=n[t];if(0!==r)if(r)e.push(r[2]);else{var i=new Promise(function(e,i){r=n[t]=[e,i]});e.push(r[2]=i);var o,a=document.createElement("script");a.charset="utf-8",a.timeout=120,__webpack_require__.nc&&a.setAttribute("nonce",__webpack_require__.nc),a.src=function jsonpScriptSrc(t){return __webpack_require__.p+""+({0:"default-assets"}[t]||t)+".js"}(t),o=function(e){a.onerror=a.onload=null,clearTimeout(s);var r=n[t];if(0!==r){if(r){var i=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src,c=new Error("Loading chunk "+t+" failed.\n("+i+": "+o+")");c.type=i,c.request=o,r[1](c)}n[t]=void 0}};var s=setTimeout(function(){o({type:"timeout",target:a})},12e4);a.onerror=a.onload=o,document.head.appendChild(a)}return Promise.all(e)},__webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.d=function(t,e,n){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,e){if(1&e&&(t=__webpack_require__(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)__webpack_require__.d(n,r,function(e){return t[e]}.bind(null,r));return n},__webpack_require__.n=function(t){var e=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="/dist/",__webpack_require__.oe=function(t){throw console.error(t),t};var r=window.webpackJsonp=window.webpackJsonp||[],i=r.push.bind(r);r.push=webpackJsonpCallback,r=r.slice();for(var o=0;o<r.length;o++)webpackJsonpCallback(r[o]);var a=i;return __webpack_require__(__webpack_require__.s=105)}([function(t,e,n){"use strict";function __export(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),__export(n(15)),__export(n(19)),__export(n(30)),__export(n(31)),__export(n(60));var r=n(20),i=n(20);e.EventQueue=i.default,e.queue=function queue(){return r.default.global()},e.flushOnce=function flushOnce(){r.default.global().flushOnce()},e.flush=function flush(t){void 0===t&&(t=10),r.default.global().flush(t)}},function(t,e,n){"use strict";var r=n(5),i=n(38),o=n(18),a=n(78),s=n(13);function identity(t){return t}function stringToArrayLike(t,e){for(var n=0;n<t.length;++n)e[n]=255&t.charCodeAt(n);return e}e.newBlob=function(t,n){e.checkSupport("blob");try{return new Blob([t],{type:n})}catch(e){try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return r.append(t),r.getBlob(n)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(t,e,n){var r=[],i=0,o=t.length;if(o<=n)return String.fromCharCode.apply(null,t);for(;i<o;)"array"===e||"nodebuffer"===e?r.push(String.fromCharCode.apply(null,t.slice(i,Math.min(i+n,o)))):r.push(String.fromCharCode.apply(null,t.subarray(i,Math.min(i+n,o)))),i+=n;return r.join("")},stringifyByChar:function(t){for(var e="",n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e},applyCanBeUsed:{uint8array:function(){try{return r.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return r.nodebuffer&&1===String.fromCharCode.apply(null,o.allocBuffer(1)).length}catch(t){return!1}}()}};function arrayLikeToString(t){var n=65536,r=e.getTypeOf(t),i=!0;if("uint8array"===r?i=c.applyCanBeUsed.uint8array:"nodebuffer"===r&&(i=c.applyCanBeUsed.nodebuffer),i)for(;n>1;)try{return c.stringifyByChunk(t,r,n)}catch(t){n=Math.floor(n/2)}return c.stringifyByChar(t)}function arrayLikeToArrayLike(t,e){for(var n=0;n<t.length;n++)e[n]=t[n];return e}e.applyFromCharCode=arrayLikeToString;var u={};u.string={string:identity,array:function(t){return stringToArrayLike(t,new Array(t.length))},arraybuffer:function(t){return u.string.uint8array(t).buffer},uint8array:function(t){return stringToArrayLike(t,new Uint8Array(t.length))},nodebuffer:function(t){return stringToArrayLike(t,o.allocBuffer(t.length))}},u.array={string:arrayLikeToString,array:identity,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return o.newBufferFrom(t)}},u.arraybuffer={string:function(t){return arrayLikeToString(new Uint8Array(t))},array:function(t){return arrayLikeToArrayLike(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:identity,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return o.newBufferFrom(new Uint8Array(t))}},u.uint8array={string:arrayLikeToString,array:function(t){return arrayLikeToArrayLike(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:identity,nodebuffer:function(t){return o.newBufferFrom(t)}},u.nodebuffer={string:arrayLikeToString,array:function(t){return arrayLikeToArrayLike(t,new Array(t.length))},arraybuffer:function(t){return u.nodebuffer.uint8array(t).buffer},uint8array:function(t){return arrayLikeToArrayLike(t,new Uint8Array(t.length))},nodebuffer:identity},e.transformTo=function(t,n){if(n||(n=""),!t)return n;e.checkSupport(t);var r=e.getTypeOf(n);return u[r][t](n)},e.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":r.nodebuffer&&o.isBuffer(t)?"nodebuffer":r.uint8array&&t instanceof Uint8Array?"uint8array":r.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},e.checkSupport=function(t){if(!r[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},e.MAX_VALUE_16BITS=65535,e.MAX_VALUE_32BITS=-1,e.pretty=function(t){var e,n,r="";for(n=0;n<(t||"").length;n++)r+="\\x"+((e=t.charCodeAt(n))<16?"0":"")+e.toString(16).toUpperCase();return r},e.delay=function(t,e,n){a(function(){t.apply(n||null,e||[])})},e.inherits=function(t,e){var n=function(){};n.prototype=e.prototype,t.prototype=new n},e.extend=function(){var t,e,n={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===n[e]&&(n[e]=arguments[t][e]);return n},e.prepareContent=function(t,n,o,a,c){return s.Promise.resolve(n).then(function(t){return r.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new s.Promise(function(e,n){var r=new FileReader;r.onload=function(t){e(t.target.result)},r.onerror=function(t){n(t.target.error)},r.readAsArrayBuffer(t)}):t}).then(function(n){var u=e.getTypeOf(n);return u?("arraybuffer"===u?n=e.transformTo("uint8array",n):"string"===u&&(c?n=i.decode(n):o&&!0!==a&&(n=function string2binary(t){return stringToArrayLike(t,r.uint8array?new Uint8Array(t.length):new Array(t.length))}(n))),n):s.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},function(t,n,r){var i;t.exports=function e(t,n,r){function s(a,c){if(!n[a]){if(!t[a]){var u="function"==typeof i&&i;if(!c&&u)return i(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof i&&i,a=0;a<r.length;a++)s(r[a]);return s}({1:[function(t,e,n){e.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,e,n){e.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,e,n){var r=t("../math/Vec3");function AABB(t){t=t||{},this.lowerBound=new r,t.lowerBound&&this.lowerBound.copy(t.lowerBound),this.upperBound=new r,t.upperBound&&this.upperBound.copy(t.upperBound)}t("../utils/Utils"),e.exports=AABB;var i=new r;AABB.prototype.setFromPoints=function(t,e,n,r){var o=this.lowerBound,a=this.upperBound,s=n;o.copy(t[0]),s&&s.vmult(o,o),a.copy(o);for(var c=1;c<t.length;c++){var u=t[c];s&&(s.vmult(u,i),u=i),u.x>a.x&&(a.x=u.x),u.x<o.x&&(o.x=u.x),u.y>a.y&&(a.y=u.y),u.y<o.y&&(o.y=u.y),u.z>a.z&&(a.z=u.z),u.z<o.z&&(o.z=u.z)}return e&&(e.vadd(o,o),e.vadd(a,a)),r&&(o.x-=r,o.y-=r,o.z-=r,a.x+=r,a.y+=r,a.z+=r),this},AABB.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this},AABB.prototype.clone=function(){return(new AABB).copy(this)},AABB.prototype.extend=function(t){var e=t.lowerBound.x;this.lowerBound.x>e&&(this.lowerBound.x=e);var n=t.upperBound.x;this.upperBound.x<n&&(this.upperBound.x=n);var e=t.lowerBound.y;this.lowerBound.y>e&&(this.lowerBound.y=e);var n=t.upperBound.y;this.upperBound.y<n&&(this.upperBound.y=n);var e=t.lowerBound.z;this.lowerBound.z>e&&(this.lowerBound.z=e);var n=t.upperBound.z;this.upperBound.z<n&&(this.upperBound.z=n)},AABB.prototype.overlaps=function(t){var e=this.lowerBound,n=this.upperBound,r=t.lowerBound,i=t.upperBound;return(r.x<=n.x&&n.x<=i.x||e.x<=i.x&&i.x<=n.x)&&(r.y<=n.y&&n.y<=i.y||e.y<=i.y&&i.y<=n.y)&&(r.z<=n.z&&n.z<=i.z||e.z<=i.z&&i.z<=n.z)},AABB.prototype.contains=function(t){var e=this.lowerBound,n=this.upperBound,r=t.lowerBound,i=t.upperBound;return e.x<=r.x&&n.x>=i.x&&e.y<=r.y&&n.y>=i.y&&e.z<=r.z&&n.z>=i.z},AABB.prototype.getCorners=function(t,e,n,r,i,o,a,s){var c=this.lowerBound,u=this.upperBound;t.copy(c),e.set(u.x,c.y,c.z),n.set(u.x,u.y,c.z),r.set(c.x,u.y,u.z),i.set(u.x,c.y,c.z),o.set(c.x,u.y,c.z),a.set(c.x,c.y,u.z),s.copy(u)};var o=[new r,new r,new r,new r,new r,new r,new r,new r];AABB.prototype.toLocalFrame=function(t,e){var n=o,r=n[0],i=n[1],a=n[2],s=n[3],c=n[4],u=n[5],l=n[6],p=n[7];this.getCorners(r,i,a,s,c,u,l,p);for(var h=0;8!==h;h++){var f=n[h];t.pointToLocal(f,f)}return e.setFromPoints(n)},AABB.prototype.toWorldFrame=function(t,e){var n=o,r=n[0],i=n[1],a=n[2],s=n[3],c=n[4],u=n[5],l=n[6],p=n[7];this.getCorners(r,i,a,s,c,u,l,p);for(var h=0;8!==h;h++){var f=n[h];t.pointToWorld(f,f)}return e.setFromPoints(n)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,e,n){function ArrayCollisionMatrix(){this.matrix=[]}e.exports=ArrayCollisionMatrix,ArrayCollisionMatrix.prototype.get=function(t,e){if(t=t.index,(e=e.index)>t){var n=e;e=t,t=n}return this.matrix[(t*(t+1)>>1)+e-1]},ArrayCollisionMatrix.prototype.set=function(t,e,n){if(t=t.index,(e=e.index)>t){var r=e;e=t,t=r}this.matrix[(t*(t+1)>>1)+e-1]=n?1:0},ArrayCollisionMatrix.prototype.reset=function(){for(var t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0},ArrayCollisionMatrix.prototype.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1}},{}],5:[function(t,e,n){var r=t("../objects/Body"),i=t("../math/Vec3"),o=t("../math/Quaternion");function Broadphase(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}t("../shapes/Shape"),t("../shapes/Plane"),e.exports=Broadphase,Broadphase.prototype.collisionPairs=function(t,e,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var a=r.STATIC|r.KINEMATIC;Broadphase.prototype.needBroadphaseCollision=function(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&a)&&t.sleepState!==r.SLEEPING||0==(e.type&a)&&e.sleepState!==r.SLEEPING)},Broadphase.prototype.intersectionTest=function(t,e,n,r){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,n,r):this.doBoundingSphereBroadphase(t,e,n,r)};var s=new i;new i,new o,new i,Broadphase.prototype.doBoundingSphereBroadphase=function(t,e,n,r){var i=s;e.position.vsub(t.position,i);var o=Math.pow(t.boundingRadius+e.boundingRadius,2),a=i.norm2();a<o&&(n.push(t),r.push(e))},Broadphase.prototype.doBoundingBoxBroadphase=function(t,e,n,r){t.aabbNeedsUpdate&&t.computeAABB(),e.aabbNeedsUpdate&&e.computeAABB(),t.aabb.overlaps(e.aabb)&&(n.push(t),r.push(e))};var c={keys:[]},u=[],l=[];Broadphase.prototype.makePairsUnique=function(t,e){for(var n=c,r=u,i=l,o=t.length,a=0;a!==o;a++)r[a]=t[a],i[a]=e[a];t.length=0,e.length=0;for(var a=0;a!==o;a++){var s=r[a].id,p=i[a].id,h=s<p?s+","+p:p+","+s;n[h]=a,n.keys.push(h)}for(var a=0;a!==n.keys.length;a++){var h=n.keys.pop(),f=n[h];t.push(r[f]),e.push(i[f]),delete n[h]}},Broadphase.prototype.setWorld=function(t){};var p=new i;Broadphase.boundingSphereCheck=function(t,e){var n=p;return t.position.vsub(e.position,n),Math.pow(t.shape.boundingSphereRadius+e.shape.boundingSphereRadius,2)>n.norm2()},Broadphase.prototype.aabbQuery=function(t,e,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,e,n){e.exports=GridBroadphase;var r=t("./Broadphase"),i=t("../math/Vec3"),o=t("../shapes/Shape");function GridBroadphase(t,e,n,o,a){r.apply(this),this.nx=n||10,this.ny=o||10,this.nz=a||10,this.aabbMin=t||new i(100,100,100),this.aabbMax=e||new i(-100,-100,-100);var s=this.nx*this.ny*this.nz;if(s<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=s,this.binLengths.length=s;for(var c=0;c<s;c++)this.bins[c]=[],this.binLengths[c]=0}GridBroadphase.prototype=new r,GridBroadphase.prototype.constructor=GridBroadphase;var a=new i;new i,GridBroadphase.prototype.collisionPairs=function(t,e,n){for(var r=t.numObjects(),i=t.bodies,s=this.aabbMax,c=this.aabbMin,u=this.nx,l=this.ny,p=this.nz,h=l*p,f=p,d=1,y=s.x,m=s.y,v=s.z,g=c.x,_=c.y,b=c.z,w=u/(y-g),x=l/(m-_),P=p/(v-b),O=(y-g)/u,C=(m-_)/l,S=(v-b)/p,j=.5*Math.sqrt(O*O+C*C+S*S),R=o.types,T=R.SPHERE,E=R.PLANE,B=(R.BOX,R.COMPOUND,R.CONVEXPOLYHEDRON,this.bins),A=this.binLengths,I=this.bins.length,M=0;M!==I;M++)A[M]=0;var z=Math.ceil,c=Math.min,s=Math.max;function addBoxToBins(t,e,n,r,i,o,a){var s=(t-g)*w|0,c=(e-_)*x|0,y=(n-b)*P|0,m=z((r-g)*w),v=z((i-_)*x),O=z((o-b)*P);s<0?s=0:s>=u&&(s=u-1),c<0?c=0:c>=l&&(c=l-1),y<0?y=0:y>=p&&(y=p-1),m<0?m=0:m>=u&&(m=u-1),v<0?v=0:v>=l&&(v=l-1),O<0?O=0:O>=p&&(O=p-1),c*=f,y*=d,m*=h,v*=f,O*=d;for(var C=s*=h;C<=m;C+=h)for(var S=c;S<=v;S+=f)for(var j=y;j<=O;j+=d){var R=C+S+j;B[R][A[R]++]=a}}for(var M=0;M!==r;M++){var k=i[M],D=k.shape;switch(D.type){case T:var F=k.position.x,L=k.position.y,N=k.position.z,V=D.radius;addBoxToBins(F-V,L-V,N-V,F+V,L+V,N+V,k);break;case E:D.worldNormalNeedsUpdate&&D.computeWorldNormal(k.quaternion);var U=D.worldNormal,W=g+.5*O-k.position.x,q=_+.5*C-k.position.y,G=b+.5*S-k.position.z,H=a;H.set(W,q,G);for(var K=0,X=0;K!==u;K++,X+=h,H.y=q,H.x+=O)for(var Q=0,Y=0;Q!==l;Q++,Y+=f,H.z=G,H.y+=C)for(var Z=0,J=0;Z!==p;Z++,J+=d,H.z+=S)if(H.dot(U)<j){var $=X+Y+J;B[$][A[$]++]=k}break;default:k.aabbNeedsUpdate&&k.computeAABB(),addBoxToBins(k.aabb.lowerBound.x,k.aabb.lowerBound.y,k.aabb.lowerBound.z,k.aabb.upperBound.x,k.aabb.upperBound.y,k.aabb.upperBound.z,k)}}for(var M=0;M!==I;M++){var tt=A[M];if(tt>1)for(var et=B[M],K=0;K!==tt;K++)for(var k=et[K],Q=0;Q!==K;Q++){var nt=et[Q];this.needBroadphaseCollision(k,nt)&&this.intersectionTest(k,nt,e,n)}}this.makePairsUnique(e,n)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,e,n){e.exports=NaiveBroadphase;var r=t("./Broadphase"),i=t("./AABB");function NaiveBroadphase(){r.apply(this)}NaiveBroadphase.prototype=new r,NaiveBroadphase.prototype.constructor=NaiveBroadphase,NaiveBroadphase.prototype.collisionPairs=function(t,e,n){var r,i,o,a,s=t.bodies,c=s.length;for(r=0;r!==c;r++)for(i=0;i!==r;i++)o=s[r],a=s[i],this.needBroadphaseCollision(o,a)&&this.intersectionTest(o,a,e,n)},new i,NaiveBroadphase.prototype.aabbQuery=function(t,e,n){n=n||[];for(var r=0;r<t.bodies.length;r++){var i=t.bodies[r];i.aabbNeedsUpdate&&i.computeAABB(),i.aabb.overlaps(e)&&n.push(i)}return n}},{"./AABB":3,"./Broadphase":5}],8:[function(t,e,n){function ObjectCollisionMatrix(){this.matrix={}}e.exports=ObjectCollisionMatrix,ObjectCollisionMatrix.prototype.get=function(t,e){if(t=t.id,(e=e.id)>t){var n=e;e=t,t=n}return t+"-"+e in this.matrix},ObjectCollisionMatrix.prototype.set=function(t,e,n){if(t=t.id,(e=e.id)>t){var r=e;e=t,t=r}n?this.matrix[t+"-"+e]=!0:delete this.matrix[t+"-"+e]},ObjectCollisionMatrix.prototype.reset=function(){this.matrix={}},ObjectCollisionMatrix.prototype.setNumObjects=function(t){}},{}],9:[function(t,e,n){e.exports=Ray;var r=t("../math/Vec3"),i=t("../math/Quaternion"),o=t("../math/Transform"),a=(t("../shapes/ConvexPolyhedron"),t("../shapes/Box"),t("../collision/RaycastResult")),s=t("../shapes/Shape"),c=t("../collision/AABB");function Ray(t,e){this.from=t?t.clone():new r,this.to=e?e.clone():new r,this._direction=new r,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray.ANY,this.result=new a,this.hasHit=!1,this.callback=function(t){}}Ray.prototype.constructor=Ray,Ray.CLOSEST=1,Ray.ANY=2,Ray.ALL=4;var u=new c,l=[];Ray.prototype.intersectWorld=function(t,e){return this.mode=e.mode||Ray.ANY,this.result=e.result||new a,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(u),l.length=0,t.broadphase.aabbQuery(t,u,l),this.intersectBodies(l),this.hasHit};var p=new r,h=new r;function pointInTriangle(t,e,n,r){r.vsub(e,A),n.vsub(e,p),t.vsub(e,h);var i,o,a=A.dot(A),s=A.dot(p),c=A.dot(h),u=p.dot(p),l=p.dot(h);return(i=u*c-s*l)>=0&&(o=a*l-s*c)>=0&&i+o<a*u-s*s}Ray.pointInTriangle=pointInTriangle;var f=new r,d=new i;Ray.prototype.intersectBody=function(t,e){e&&(this.result=e,this._updateDirection());var n=this.checkCollisionResponse;if((!n||t.collisionResponse)&&0!=(this.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&this.collisionFilterMask))for(var r=f,i=d,o=0,a=t.shapes.length;o<a;o++){var s=t.shapes[o];if((!n||s.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[o],i),t.quaternion.vmult(t.shapeOffsets[o],r),r.vadd(t.position,r),this.intersectShape(s,i,r,t),this.result._shouldStop))break}},Ray.prototype.intersectBodies=function(t,e){e&&(this.result=e,this._updateDirection());for(var n=0,r=t.length;!this.result._shouldStop&&n<r;n++)this.intersectBody(t[n])},Ray.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},Ray.prototype.intersectShape=function(t,e,n,r){var i=this.from,o=function distanceFromIntersection(t,e,n){n.vsub(t,A);var r=A.dot(e);return e.mult(r,I),I.vadd(t,I),n.distanceTo(I)}(i,this._direction,n);if(!(o>t.boundingSphereRadius)){var a=this[t.type];a&&a.call(this,t,e,n,r)}},new r,new r;var y=new r,m=new r,v=new r,g=new r;new r,new a,Ray.prototype.intersectBox=function(t,e,n,r){return this.intersectConvex(t.convexPolyhedronRepresentation,e,n,r)},Ray.prototype[s.types.BOX]=Ray.prototype.intersectBox,Ray.prototype.intersectPlane=function(t,e,n,i){var o=this.from,a=this.to,s=this._direction,c=new r(0,0,1);e.vmult(c,c);var u=new r;o.vsub(n,u);var l=u.dot(c);a.vsub(n,u);var p=u.dot(c);if(!(l*p>0||o.distanceTo(a)<l)){var h=c.dot(s);if(!(Math.abs(h)<this.precision)){var f=new r,d=new r,y=new r;o.vsub(n,f);var m=-c.dot(f)/h;s.scale(m,d),o.vadd(d,y),this.reportIntersection(c,y,t,i,-1)}}},Ray.prototype[s.types.PLANE]=Ray.prototype.intersectPlane,Ray.prototype.getAABB=function(t){var e=this.to,n=this.from;t.lowerBound.x=Math.min(e.x,n.x),t.lowerBound.y=Math.min(e.y,n.y),t.lowerBound.z=Math.min(e.z,n.z),t.upperBound.x=Math.max(e.x,n.x),t.upperBound.y=Math.max(e.y,n.y),t.upperBound.z=Math.max(e.z,n.z)};var _={faceList:[0]};Ray.prototype.intersectHeightfield=function(t,e,n,i){t.data,t.elementSize;var a=new r,s=new Ray(this.from,this.to);o.pointToLocalFrame(n,e,s.from,s.from),o.pointToLocalFrame(n,e,s.to,s.to);var c=[],u=null,l=null,p=null,h=null,f=t.getIndexOfPosition(s.from.x,s.from.y,c,!1);if(f&&(u=c[0],l=c[1],p=c[0],h=c[1]),(f=t.getIndexOfPosition(s.to.x,s.to.y,c,!1))&&((null===u||c[0]<u)&&(u=c[0]),(null===p||c[0]>p)&&(p=c[0]),(null===l||c[1]<l)&&(l=c[1]),(null===h||c[1]>h)&&(h=c[1])),null!==u){var d=[];t.getRectMinMax(u,l,p,h,d);for(var y=u;y<=p;y++)for(var m=l;m<=h;m++){if(this.result._shouldStop)return;if(t.getConvexTrianglePillar(y,m,!1),o.pointToWorldFrame(n,e,t.pillarOffset,a),this.intersectConvex(t.pillarConvex,e,a,i,_),this.result._shouldStop)return;t.getConvexTrianglePillar(y,m,!0),o.pointToWorldFrame(n,e,t.pillarOffset,a),this.intersectConvex(t.pillarConvex,e,a,i,_)}}},Ray.prototype[s.types.HEIGHTFIELD]=Ray.prototype.intersectHeightfield;var b=new r,w=new r;Ray.prototype.intersectSphere=function(t,e,n,r){var i=this.from,o=this.to,a=t.radius,s=Math.pow(o.x-i.x,2)+Math.pow(o.y-i.y,2)+Math.pow(o.z-i.z,2),c=2*((o.x-i.x)*(i.x-n.x)+(o.y-i.y)*(i.y-n.y)+(o.z-i.z)*(i.z-n.z)),u=Math.pow(i.x-n.x,2)+Math.pow(i.y-n.y,2)+Math.pow(i.z-n.z,2)-Math.pow(a,2),l=Math.pow(c,2)-4*s*u,p=b,h=w;if(!(l<0))if(0===l)i.lerp(o,l,p),p.vsub(n,h),h.normalize(),this.reportIntersection(h,p,t,r,-1);else{var f=(-c-Math.sqrt(l))/(2*s),d=(-c+Math.sqrt(l))/(2*s);if(f>=0&&f<=1&&(i.lerp(o,f,p),p.vsub(n,h),h.normalize(),this.reportIntersection(h,p,t,r,-1)),this.result._shouldStop)return;d>=0&&d<=1&&(i.lerp(o,d,p),p.vsub(n,h),h.normalize(),this.reportIntersection(h,p,t,r,-1))}},Ray.prototype[s.types.SPHERE]=Ray.prototype.intersectSphere;var x=new r,P=(new r,new r,new r);Ray.prototype.intersectConvex=function intersectConvex(t,e,n,r,i){for(var o=x,a=P,s=i&&i.faceList||null,c=t.faces,u=t.vertices,l=t.faceNormals,p=this._direction,h=this.from,f=this.to,d=h.distanceTo(f),_=s?s.length:c.length,b=this.result,w=0;!b._shouldStop&&w<_;w++){var O=s?s[w]:w,C=c[O],S=l[O],j=e,R=n;a.copy(u[C[0]]),j.vmult(a,a),a.vadd(R,a),a.vsub(h,a),j.vmult(S,o);var T=p.dot(o);if(!(Math.abs(T)<this.precision)){var E=o.dot(a)/T;if(!(E<0)){p.mult(E,y),y.vadd(h,y),m.copy(u[C[0]]),j.vmult(m,m),R.vadd(m,m);for(var B=1;!b._shouldStop&&B<C.length-1;B++){v.copy(u[C[B]]),g.copy(u[C[B+1]]),j.vmult(v,v),j.vmult(g,g),R.vadd(v,v),R.vadd(g,g);var A=y.distanceTo(h);!pointInTriangle(y,m,v,g)&&!pointInTriangle(y,v,m,g)||A>d||this.reportIntersection(o,y,t,r,O)}}}}},Ray.prototype[s.types.CONVEXPOLYHEDRON]=Ray.prototype.intersectConvex;var O=new r,C=new r,S=new r,j=new r,R=new r,T=new r,E=(new c,[]),B=new o;Ray.prototype.intersectTrimesh=function intersectTrimesh(t,e,n,r,i){var a=O,s=E,c=B,u=P,l=C,p=S,h=j,f=T,d=R,_=(i&&i.faceList,t.indices),b=(t.vertices,t.faceNormals,this.from),w=this.to,x=this._direction;c.position.copy(n),c.quaternion.copy(e),o.vectorToLocalFrame(n,e,x,l),o.pointToLocalFrame(n,e,b,p),o.pointToLocalFrame(n,e,w,h);var A=p.distanceSquared(h);t.tree.rayQuery(this,c,s);for(var I=0,M=s.length;!this.result._shouldStop&&I!==M;I++){var z=s[I];t.getNormal(z,a),t.getVertex(_[3*z],m),m.vsub(p,u);var k=l.dot(a),D=a.dot(u)/k;if(!(D<0)){l.scale(D,y),y.vadd(p,y),t.getVertex(_[3*z+1],v),t.getVertex(_[3*z+2],g);var F=y.distanceSquared(p);!pointInTriangle(y,v,m,g)&&!pointInTriangle(y,m,v,g)||F>A||(o.vectorToWorldFrame(e,a,d),o.pointToWorldFrame(n,e,y,f),this.reportIntersection(d,f,t,r,z))}}s.length=0},Ray.prototype[s.types.TRIMESH]=Ray.prototype.intersectTrimesh,Ray.prototype.reportIntersection=function(t,e,n,r,i){var o=this.from,a=this.to,s=o.distanceTo(e),c=this.result;if(!(this.skipBackfaces&&t.dot(this._direction)>0))switch(c.hitFaceIndex=void 0!==i?i:-1,this.mode){case Ray.ALL:this.hasHit=!0,c.set(o,a,t,e,n,r,s),c.hasHit=!0,this.callback(c);break;case Ray.CLOSEST:(s<c.distance||!c.hasHit)&&(this.hasHit=!0,c.hasHit=!0,c.set(o,a,t,e,n,r,s));break;case Ray.ANY:this.hasHit=!0,c.hasHit=!0,c.set(o,a,t,e,n,r,s),c._shouldStop=!0}};var A=new r,I=new r},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,e,n){var r=t("../math/Vec3");function RaycastResult(){this.rayFromWorld=new r,this.rayToWorld=new r,this.hitNormalWorld=new r,this.hitPointWorld=new r,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}e.exports=RaycastResult,RaycastResult.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},RaycastResult.prototype.abort=function(){this._shouldStop=!0},RaycastResult.prototype.set=function(t,e,n,r,i,o,a){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(r),this.shape=i,this.body=o,this.distance=a}},{"../math/Vec3":30}],11:[function(t,e,n){t("../shapes/Shape");var r=t("../collision/Broadphase");function SAPBroadphase(t){r.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var e=this.axisList;this._addBodyHandler=function(t){e.push(t.body)},this._removeBodyHandler=function(t){var n=e.indexOf(t.body);-1!==n&&e.splice(n,1)},t&&this.setWorld(t)}e.exports=SAPBroadphase,SAPBroadphase.prototype=new r,SAPBroadphase.prototype.setWorld=function(t){this.axisList.length=0;for(var e=0;e<t.bodies.length;e++)this.axisList.push(t.bodies[e]);t.removeEventListener("addBody",this._addBodyHandler),t.removeEventListener("removeBody",this._removeBodyHandler),t.addEventListener("addBody",this._addBodyHandler),t.addEventListener("removeBody",this._removeBodyHandler),this.world=t,this.dirty=!0},SAPBroadphase.insertionSortX=function(t){for(var e=1,n=t.length;e<n;e++){for(var r=t[e],i=e-1;i>=0&&!(t[i].aabb.lowerBound.x<=r.aabb.lowerBound.x);i--)t[i+1]=t[i];t[i+1]=r}return t},SAPBroadphase.insertionSortY=function(t){for(var e=1,n=t.length;e<n;e++){for(var r=t[e],i=e-1;i>=0&&!(t[i].aabb.lowerBound.y<=r.aabb.lowerBound.y);i--)t[i+1]=t[i];t[i+1]=r}return t},SAPBroadphase.insertionSortZ=function(t){for(var e=1,n=t.length;e<n;e++){for(var r=t[e],i=e-1;i>=0&&!(t[i].aabb.lowerBound.z<=r.aabb.lowerBound.z);i--)t[i+1]=t[i];t[i+1]=r}return t},SAPBroadphase.prototype.collisionPairs=function(t,e,n){var r,i,o=this.axisList,a=o.length,s=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),r=0;r!==a;r++){var c=o[r];for(i=r+1;i<a;i++){var u=o[i];if(this.needBroadphaseCollision(c,u)){if(!SAPBroadphase.checkBounds(c,u,s))break;this.intersectionTest(c,u,e,n)}}}},SAPBroadphase.prototype.sortList=function(){for(var t=this.axisList,e=this.axisIndex,n=t.length,r=0;r!==n;r++){var i=t[r];i.aabbNeedsUpdate&&i.computeAABB()}0===e?SAPBroadphase.insertionSortX(t):1===e?SAPBroadphase.insertionSortY(t):2===e&&SAPBroadphase.insertionSortZ(t)},SAPBroadphase.checkBounds=function(t,e,n){var r,i;0===n?(r=t.position.x,i=e.position.x):1===n?(r=t.position.y,i=e.position.y):2===n&&(r=t.position.z,i=e.position.z);var o=t.boundingRadius,a=e.boundingRadius,s=r+o,c=i-a;return c<s},SAPBroadphase.prototype.autoDetectAxis=function(){for(var t=0,e=0,n=0,r=0,i=0,o=0,a=this.axisList,s=a.length,c=1/s,u=0;u!==s;u++){var l=a[u],p=l.position.x;t+=p,e+=p*p;var h=l.position.y;n+=h,r+=h*h;var f=l.position.z;i+=f,o+=f*f}var d=e-t*t*c,y=r-n*n*c,m=o-i*i*c;this.axisIndex=d>y?d>m?0:2:y>m?1:2},SAPBroadphase.prototype.aabbQuery=function(t,e,n){n=n||[],this.dirty&&(this.sortList(),this.dirty=!1);var r=this.axisIndex,i="x";1===r&&(i="y"),2===r&&(i="z");for(var o=this.axisList,a=(e.lowerBound[i],e.upperBound[i],0);a<o.length;a++){var s=o[a];s.aabbNeedsUpdate&&s.computeAABB(),s.aabb.overlaps(e)&&n.push(s)}return n}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,e,n){e.exports=ConeTwistConstraint,t("./Constraint");var r=t("./PointToPointConstraint"),i=t("../equations/ConeEquation"),o=t("../equations/RotationalEquation"),a=(t("../equations/ContactEquation"),t("../math/Vec3"));function ConeTwistConstraint(t,e,n){var s=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,c=n.pivotA?n.pivotA.clone():new a,u=n.pivotB?n.pivotB.clone():new a;this.axisA=n.axisA?n.axisA.clone():new a,this.axisB=n.axisB?n.axisB.clone():new a,r.call(this,t,c,e,u,s),this.collideConnected=!!n.collideConnected,this.angle=void 0!==n.angle?n.angle:0;var l=this.coneEquation=new i(t,e,n),p=this.twistEquation=new o(t,e,n);this.twistAngle=void 0!==n.twistAngle?n.twistAngle:0,l.maxForce=0,l.minForce=-s,p.maxForce=0,p.minForce=-s,this.equations.push(l,p)}ConeTwistConstraint.prototype=new r,ConeTwistConstraint.constructor=ConeTwistConstraint,new a,new a,ConeTwistConstraint.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.coneEquation,i=this.twistEquation;r.prototype.update.call(this),t.vectorToWorldFrame(this.axisA,n.axisA),e.vectorToWorldFrame(this.axisB,n.axisB),this.axisA.tangents(i.axisA,i.axisA),t.vectorToWorldFrame(i.axisA,i.axisA),this.axisB.tangents(i.axisB,i.axisB),e.vectorToWorldFrame(i.axisB,i.axisB),n.angle=this.angle,i.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,e,n){e.exports=Constraint;var r=t("../utils/Utils");function Constraint(t,e,n){n=r.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=Constraint.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}Constraint.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},Constraint.prototype.enable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!0},Constraint.prototype.disable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!1},Constraint.idCounter=0},{"../utils/Utils":53}],14:[function(t,e,n){e.exports=DistanceConstraint;var r=t("./Constraint"),i=t("../equations/ContactEquation");function DistanceConstraint(t,e,n,o){r.call(this,t,e),void 0===n&&(n=t.position.distanceTo(e.position)),void 0===o&&(o=1e6),this.distance=n;var a=this.distanceEquation=new i(t,e);this.equations.push(a),a.minForce=-o,a.maxForce=o}DistanceConstraint.prototype=new r,DistanceConstraint.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.distanceEquation,r=.5*this.distance,i=n.ni;e.position.vsub(t.position,i),i.normalize(),i.mult(r,n.ri),i.mult(-r,n.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,e,n){e.exports=HingeConstraint,t("./Constraint");var r=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation"),o=t("../equations/RotationalMotorEquation"),a=(t("../equations/ContactEquation"),t("../math/Vec3"));function HingeConstraint(t,e,n){var s=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,c=n.pivotA?n.pivotA.clone():new a,u=n.pivotB?n.pivotB.clone():new a;r.call(this,t,c,e,u,s);var l=this.axisA=n.axisA?n.axisA.clone():new a(1,0,0);l.normalize();var p=this.axisB=n.axisB?n.axisB.clone():new a(1,0,0);p.normalize();var h=this.rotationalEquation1=new i(t,e,n),f=this.rotationalEquation2=new i(t,e,n),d=this.motorEquation=new o(t,e,s);d.enabled=!1,this.equations.push(h,f,d)}HingeConstraint.prototype=new r,HingeConstraint.constructor=HingeConstraint,HingeConstraint.prototype.enableMotor=function(){this.motorEquation.enabled=!0},HingeConstraint.prototype.disableMotor=function(){this.motorEquation.enabled=!1},HingeConstraint.prototype.setMotorSpeed=function(t){this.motorEquation.targetVelocity=t},HingeConstraint.prototype.setMotorMaxForce=function(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t};var s=new a,c=new a;HingeConstraint.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.motorEquation,i=this.rotationalEquation1,o=this.rotationalEquation2,a=s,u=c,l=this.axisA,p=this.axisB;r.prototype.update.call(this),t.quaternion.vmult(l,a),e.quaternion.vmult(p,u),a.tangents(i.axisA,o.axisA),i.axisB.copy(u),o.axisB.copy(u),this.motorEquation.enabled&&(t.quaternion.vmult(this.axisA,n.axisA),e.quaternion.vmult(this.axisB,n.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,e,n){e.exports=LockConstraint,t("./Constraint");var r=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation"),o=(t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation"),t("../math/Vec3"));function LockConstraint(t,e,n){var a=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,s=new o,c=new o,u=new o;t.position.vadd(e.position,u),u.scale(.5,u),e.pointToLocalFrame(u,c),t.pointToLocalFrame(u,s),r.call(this,t,s,e,c,a);var l=this.rotationalEquation1=new i(t,e,n),p=this.rotationalEquation2=new i(t,e,n),h=this.rotationalEquation3=new i(t,e,n);this.equations.push(l,p,h)}LockConstraint.prototype=new r,LockConstraint.constructor=LockConstraint,new o,new o,LockConstraint.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=(this.motorEquation,this.rotationalEquation1),i=this.rotationalEquation2,a=this.rotationalEquation3;r.prototype.update.call(this),t.vectorToWorldFrame(o.UNIT_X,n.axisA),e.vectorToWorldFrame(o.UNIT_Y,n.axisB),t.vectorToWorldFrame(o.UNIT_Y,i.axisA),e.vectorToWorldFrame(o.UNIT_Z,i.axisB),t.vectorToWorldFrame(o.UNIT_Z,a.axisA),e.vectorToWorldFrame(o.UNIT_X,a.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,e,n){e.exports=PointToPointConstraint;var r=t("./Constraint"),i=t("../equations/ContactEquation"),o=t("../math/Vec3");function PointToPointConstraint(t,e,n,a,s){r.call(this,t,n),s=void 0!==s?s:1e6,this.pivotA=e?e.clone():new o,this.pivotB=a?a.clone():new o;var c=this.equationX=new i(t,n),u=this.equationY=new i(t,n),l=this.equationZ=new i(t,n);this.equations.push(c,u,l),c.minForce=u.minForce=l.minForce=-s,c.maxForce=u.maxForce=l.maxForce=s,c.ni.set(1,0,0),u.ni.set(0,1,0),l.ni.set(0,0,1)}PointToPointConstraint.prototype=new r,PointToPointConstraint.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.equationX,r=this.equationY,i=this.equationZ;t.quaternion.vmult(this.pivotA,n.ri),e.quaternion.vmult(this.pivotB,n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,e,n){e.exports=ConeEquation;var r=t("../math/Vec3"),i=(t("../math/Mat3"),t("./Equation"));function ConeEquation(t,e,n){var o=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;i.call(this,t,e,-o,o),this.axisA=n.axisA?n.axisA.clone():new r(1,0,0),this.axisB=n.axisB?n.axisB.clone():new r(0,1,0),this.angle=void 0!==n.angle?n.angle:0}ConeEquation.prototype=new i,ConeEquation.prototype.constructor=ConeEquation;var o=new r,a=new r;ConeEquation.prototype.computeB=function(t){var e=this.a,n=this.b,r=this.axisA,i=this.axisB,s=o,c=a,u=this.jacobianElementA,l=this.jacobianElementB;r.cross(i,s),i.cross(r,c),u.rotational.copy(c),l.rotational.copy(s);var p=Math.cos(this.angle)-r.dot(i),h=this.computeGW(),f=this.computeGiMf(),d=-p*e-h*n-t*f;return d}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,e,n){e.exports=ContactEquation;var r=t("./Equation"),i=t("../math/Vec3");function ContactEquation(t,e,n){n=void 0!==n?n:1e6,r.call(this,t,e,0,n),this.restitution=0,this.ri=new i,this.rj=new i,this.ni=new i}t("../math/Mat3"),ContactEquation.prototype=new r,ContactEquation.prototype.constructor=ContactEquation;var o=new i,a=new i,s=new i;ContactEquation.prototype.computeB=function(t){var e=this.a,n=this.b,r=this.bi,i=this.bj,c=this.ri,u=this.rj,l=o,p=a,h=r.velocity,f=r.angularVelocity,d=(r.force,r.torque,i.velocity),y=i.angularVelocity,m=(i.force,i.torque,s),v=this.jacobianElementA,g=this.jacobianElementB,_=this.ni;c.cross(_,l),u.cross(_,p),_.negate(v.spatial),l.negate(v.rotational),g.spatial.copy(_),g.rotational.copy(p),m.copy(i.position),m.vadd(u,m),m.vsub(r.position,m),m.vsub(c,m);var b=_.dot(m),w=this.restitution+1,x=w*d.dot(_)-w*h.dot(_)+y.dot(p)-f.dot(l),P=this.computeGiMf(),O=-b*e-x*n-t*P;return O};var c=new i,u=new i,l=new i,p=new i,h=new i;ContactEquation.prototype.getImpactVelocityAlongNormal=function(){var t=c,e=u,n=l,r=p,i=h;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,r),this.bi.getVelocityAtWorldPoint(n,t),this.bj.getVelocityAtWorldPoint(r,e),t.vsub(e,i),this.ni.dot(i)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,e,n){e.exports=Equation;var r=t("../math/JacobianElement"),i=t("../math/Vec3");function Equation(t,e,n,i){this.id=Equation.id++,this.minForce=void 0===n?-1e6:n,this.maxForce=void 0===i?1e6:i,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new r,this.jacobianElementB=new r,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}Equation.prototype.constructor=Equation,Equation.id=0,Equation.prototype.setSpookParams=function(t,e,n){var r=e,i=t,o=n;this.a=4/(o*(1+4*r)),this.b=4*r/(1+4*r),this.eps=4/(o*o*i*(1+4*r))},Equation.prototype.computeB=function(t,e,n){var r=this.computeGW(),i=this.computeGq(),o=this.computeGiMf();return-i*t-r*e-o*n},Equation.prototype.computeGq=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.position,o=r.position;return t.spatial.dot(i)+e.spatial.dot(o)};var o=new i;Equation.prototype.computeGW=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.velocity,a=r.velocity,s=n.angularVelocity||o,c=r.angularVelocity||o;return t.multiplyVectors(i,s)+e.multiplyVectors(a,c)},Equation.prototype.computeGWlambda=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.vlambda,a=r.vlambda,s=n.wlambda||o,c=r.wlambda||o;return t.multiplyVectors(i,s)+e.multiplyVectors(a,c)};var a=new i,s=new i,c=new i,u=new i;Equation.prototype.computeGiMf=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.force,o=n.torque,l=r.force,p=r.torque,h=n.invMassSolve,f=r.invMassSolve;return n.invInertiaWorldSolve?n.invInertiaWorldSolve.vmult(o,c):c.set(0,0,0),r.invInertiaWorldSolve?r.invInertiaWorldSolve.vmult(p,u):u.set(0,0,0),i.mult(h,a),l.mult(f,s),t.multiplyVectors(a,c)+e.multiplyVectors(s,u)};var l=new i;Equation.prototype.computeGiMGt=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,r=this.bj,i=n.invMassSolve,o=r.invMassSolve,a=n.invInertiaWorldSolve,s=r.invInertiaWorldSolve,c=i+o;return a&&(a.vmult(t.rotational,l),c+=l.dot(t.rotational)),s&&(s.vmult(e.rotational,l),c+=l.dot(e.rotational)),c};var p=new i;new i,new i,new i,new i,new i,Equation.prototype.addToWlambda=function(t){var e=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,i=this.bj,o=p;e.spatial.mult(r.invMassSolve*t,o),r.vlambda.vadd(o,r.vlambda),n.spatial.mult(i.invMassSolve*t,o),i.vlambda.vadd(o,i.vlambda),r.invInertiaWorldSolve&&(r.invInertiaWorldSolve.vmult(e.rotational,o),o.mult(t,o),r.wlambda.vadd(o,r.wlambda)),i.invInertiaWorldSolve&&(i.invInertiaWorldSolve.vmult(n.rotational,o),o.mult(t,o),i.wlambda.vadd(o,i.wlambda))},Equation.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,e,n){e.exports=FrictionEquation;var r=t("./Equation"),i=t("../math/Vec3");function FrictionEquation(t,e,n){r.call(this,t,e,-n,n),this.ri=new i,this.rj=new i,this.t=new i}t("../math/Mat3"),FrictionEquation.prototype=new r,FrictionEquation.prototype.constructor=FrictionEquation;var o=new i,a=new i;FrictionEquation.prototype.computeB=function(t){this.a;var e=this.b,n=(this.bi,this.bj,this.ri),r=this.rj,i=o,s=a,c=this.t;n.cross(c,i),r.cross(c,s);var u=this.jacobianElementA,l=this.jacobianElementB;c.negate(u.spatial),i.negate(u.rotational),l.spatial.copy(c),l.rotational.copy(s);var p=this.computeGW(),h=this.computeGiMf(),f=-p*e-t*h;return f}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,e,n){e.exports=RotationalEquation;var r=t("../math/Vec3"),i=(t("../math/Mat3"),t("./Equation"));function RotationalEquation(t,e,n){var o=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;i.call(this,t,e,-o,o),this.axisA=n.axisA?n.axisA.clone():new r(1,0,0),this.axisB=n.axisB?n.axisB.clone():new r(0,1,0),this.maxAngle=Math.PI/2}RotationalEquation.prototype=new i,RotationalEquation.prototype.constructor=RotationalEquation;var o=new r,a=new r;RotationalEquation.prototype.computeB=function(t){var e=this.a,n=this.b,r=this.axisA,i=this.axisB,s=o,c=a,u=this.jacobianElementA,l=this.jacobianElementB;r.cross(i,s),i.cross(r,c),u.rotational.copy(c),l.rotational.copy(s);var p=Math.cos(this.maxAngle)-r.dot(i),h=this.computeGW(),f=this.computeGiMf(),d=-p*e-h*n-t*f;return d}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,e,n){e.exports=RotationalMotorEquation;var r=t("../math/Vec3"),i=(t("../math/Mat3"),t("./Equation"));function RotationalMotorEquation(t,e,n){n=void 0!==n?n:1e6,i.call(this,t,e,-n,n),this.axisA=new r,this.axisB=new r,this.targetVelocity=0}RotationalMotorEquation.prototype=new i,RotationalMotorEquation.prototype.constructor=RotationalMotorEquation,RotationalMotorEquation.prototype.computeB=function(t){this.a;var e=this.b,n=(this.bi,this.bj,this.axisA),r=this.axisB,i=this.jacobianElementA,o=this.jacobianElementB;i.rotational.copy(n),r.negate(o.rotational);var a=this.computeGW()-this.targetVelocity,s=this.computeGiMf(),c=-a*e-t*s;return c}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,e,n){var r=t("../utils/Utils");function ContactMaterial(t,e,n){n=r.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=ContactMaterial.idCounter++,this.materials=[t,e],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}e.exports=ContactMaterial,ContactMaterial.idCounter=0},{"../utils/Utils":53}],25:[function(t,e,n){function Material(t){var e="";"string"==typeof(t=t||{})?(e=t,t={}):"object"==typeof t&&(e=""),this.name=e,this.id=Material.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}e.exports=Material,Material.idCounter=0},{}],26:[function(t,e,n){e.exports=JacobianElement;var r=t("./Vec3");function JacobianElement(){this.spatial=new r,this.rotational=new r}JacobianElement.prototype.multiplyElement=function(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)},JacobianElement.prototype.multiplyVectors=function(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,e,n){e.exports=Mat3;var r=t("./Vec3");function Mat3(t){this.elements=t||[0,0,0,0,0,0,0,0,0]}Mat3.prototype.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},Mat3.prototype.setZero=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0},Mat3.prototype.setTrace=function(t){var e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z},Mat3.prototype.getTrace=function(t){var t=t||new r,e=this.elements;t.x=e[0],t.y=e[4],t.z=e[8]},Mat3.prototype.vmult=function(t,e){e=e||new r;var n=this.elements,i=t.x,o=t.y,a=t.z;return e.x=n[0]*i+n[1]*o+n[2]*a,e.y=n[3]*i+n[4]*o+n[5]*a,e.z=n[6]*i+n[7]*o+n[8]*a,e},Mat3.prototype.smult=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]*=t},Mat3.prototype.mmult=function(t,e){for(var n=e||new Mat3,r=0;r<3;r++)for(var i=0;i<3;i++){for(var o=0,a=0;a<3;a++)o+=t.elements[r+3*a]*this.elements[a+3*i];n.elements[r+3*i]=o}return n},Mat3.prototype.scale=function(t,e){e=e||new Mat3;for(var n=this.elements,r=e.elements,i=0;3!==i;i++)r[3*i+0]=t.x*n[3*i+0],r[3*i+1]=t.y*n[3*i+1],r[3*i+2]=t.z*n[3*i+2];return e},Mat3.prototype.solve=function(t,e){e=e||new r;for(var n,i=[],o=0;o<12;o++)i.push(0);for(o=0;o<3;o++)for(n=0;n<3;n++)i[o+4*n]=this.elements[o+3*n];i[3]=t.x,i[7]=t.y,i[11]=t.z;var a,s,c=3,u=c;do{if(0===i[(o=u-c)+4*o])for(n=o+1;n<u;n++)if(0!==i[o+4*n]){a=4;do{i[(s=4-a)+4*o]+=i[s+4*n]}while(--a);break}if(0!==i[o+4*o])for(n=o+1;n<u;n++){var l=i[o+4*n]/i[o+4*o];a=4;do{i[(s=4-a)+4*n]=s<=o?0:i[s+4*n]-i[s+4*o]*l}while(--a)}}while(--c);if(e.z=i[11]/i[10],e.y=(i[7]-i[6]*e.z)/i[5],e.x=(i[3]-i[2]*e.z-i[1]*e.y)/i[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw"Could not solve equation! Got x=["+e.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]";return e},Mat3.prototype.e=function(t,e,n){if(void 0===n)return this.elements[e+3*t];this.elements[e+3*t]=n},Mat3.prototype.copy=function(t){for(var e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this},Mat3.prototype.toString=function(){for(var t="",e=0;e<9;e++)t+=this.elements[e]+",";return t},Mat3.prototype.reverse=function(t){t=t||new Mat3;for(var e,n=[],r=0;r<18;r++)n.push(0);for(r=0;r<3;r++)for(e=0;e<3;e++)n[r+6*e]=this.elements[r+3*e];n[3]=1,n[9]=0,n[15]=0,n[4]=0,n[10]=1,n[16]=0,n[5]=0,n[11]=0,n[17]=1;var i,o,a=3,s=a;do{if(0===n[(r=s-a)+6*r])for(e=r+1;e<s;e++)if(0!==n[r+6*e]){i=6;do{n[(o=6-i)+6*r]+=n[o+6*e]}while(--i);break}if(0!==n[r+6*r])for(e=r+1;e<s;e++){var c=n[r+6*e]/n[r+6*r];i=6;do{n[(o=6-i)+6*e]=o<=r?0:n[o+6*e]-n[o+6*r]*c}while(--i)}}while(--a);r=2;do{e=r-1;do{var c=n[r+6*e]/n[r+6*r];i=6;do{n[(o=6-i)+6*e]=n[o+6*e]-n[o+6*r]*c}while(--i)}while(e--)}while(--r);r=2;do{var c=1/n[r+6*r];i=6;do{n[(o=6-i)+6*r]=n[o+6*r]*c}while(--i)}while(r--);r=2;do{e=2;do{if(o=n[3+e+6*r],isNaN(o)||o===1/0)throw"Could not reverse! A=["+this.toString()+"]";t.e(r,e,o)}while(e--)}while(r--);return t},Mat3.prototype.setRotationFromQuaternion=function(t){var e=t.x,n=t.y,r=t.z,i=t.w,o=e+e,a=n+n,s=r+r,c=e*o,u=e*a,l=e*s,p=n*a,h=n*s,f=r*s,d=i*o,y=i*a,m=i*s,v=this.elements;return v[0]=1-(p+f),v[1]=u-m,v[2]=l+y,v[3]=u+m,v[4]=1-(c+f),v[5]=h-d,v[6]=l-y,v[7]=h+d,v[8]=1-(c+p),this},Mat3.prototype.transpose=function(t){for(var e=(t=t||new Mat3).elements,n=this.elements,r=0;3!==r;r++)for(var i=0;3!==i;i++)e[3*r+i]=n[3*i+r];return t}},{"./Vec3":30}],28:[function(t,e,n){e.exports=Quaternion;var r=t("./Vec3");function Quaternion(t,e,n,r){this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==n?n:0,this.w=void 0!==r?r:1}Quaternion.prototype.set=function(t,e,n,r){this.x=t,this.y=e,this.z=n,this.w=r},Quaternion.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},Quaternion.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},Quaternion.prototype.setFromAxisAngle=function(t,e){var n=Math.sin(.5*e);this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(.5*e)},Quaternion.prototype.toAxisAngle=function(t){t=t||new r,this.normalize();var e=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/n,t.y=this.y/n,t.z=this.z/n),[t,e]};var i=new r,o=new r;Quaternion.prototype.setFromVectors=function(t,e){if(t.isAntiparallelTo(e)){var n=i,r=o;t.tangents(n,r),this.setFromAxisAngle(n,Math.PI)}else{var a=t.cross(e);this.x=a.x,this.y=a.y,this.z=a.z,this.w=Math.sqrt(Math.pow(t.norm(),2)*Math.pow(e.norm(),2))+t.dot(e),this.normalize()}};var a=new r,s=new r,c=new r;Quaternion.prototype.mult=function(t,e){e=e||new Quaternion;var n=this.w,r=a,i=s,o=c;return r.set(this.x,this.y,this.z),i.set(t.x,t.y,t.z),e.w=n*t.w-r.dot(i),r.cross(i,o),e.x=n*i.x+t.w*r.x+o.x,e.y=n*i.y+t.w*r.y+o.y,e.z=n*i.z+t.w*r.z+o.z,e},Quaternion.prototype.inverse=function(t){var e=this.x,n=this.y,r=this.z,i=this.w;t=t||new Quaternion,this.conjugate(t);var o=1/(e*e+n*n+r*r+i*i);return t.x*=o,t.y*=o,t.z*=o,t.w*=o,t},Quaternion.prototype.conjugate=function(t){return(t=t||new Quaternion).x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t},Quaternion.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t)},Quaternion.prototype.normalizeFast=function(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t)},Quaternion.prototype.vmult=function(t,e){e=e||new r;var n=t.x,i=t.y,o=t.z,a=this.x,s=this.y,c=this.z,u=this.w,l=u*n+s*o-c*i,p=u*i+c*n-a*o,h=u*o+a*i-s*n,f=-a*n-s*i-c*o;return e.x=l*u+f*-a+p*-c-h*-s,e.y=p*u+f*-s+h*-a-l*-c,e.z=h*u+f*-c+l*-s-p*-a,e},Quaternion.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},Quaternion.prototype.toEuler=function(t,e){var n,r,i;e=e||"YZX";var o=this.x,a=this.y,s=this.z,c=this.w;switch(e){case"YZX":var u=o*a+s*c;if(u>.499&&(n=2*Math.atan2(o,c),r=Math.PI/2,i=0),u<-.499&&(n=-2*Math.atan2(o,c),r=-Math.PI/2,i=0),isNaN(n)){var l=o*o,p=a*a,h=s*s;n=Math.atan2(2*a*c-2*o*s,1-2*p-2*h),r=Math.asin(2*u),i=Math.atan2(2*o*c-2*a*s,1-2*l-2*h)}break;default:throw new Error("Euler order "+e+" not supported yet.")}t.y=n,t.z=r,t.x=i},Quaternion.prototype.setFromEuler=function(t,e,n,r){r=r||"XYZ";var i=Math.cos(t/2),o=Math.cos(e/2),a=Math.cos(n/2),s=Math.sin(t/2),c=Math.sin(e/2),u=Math.sin(n/2);return"XYZ"===r?(this.x=s*o*a+i*c*u,this.y=i*c*a-s*o*u,this.z=i*o*u+s*c*a,this.w=i*o*a-s*c*u):"YXZ"===r?(this.x=s*o*a+i*c*u,this.y=i*c*a-s*o*u,this.z=i*o*u-s*c*a,this.w=i*o*a+s*c*u):"ZXY"===r?(this.x=s*o*a-i*c*u,this.y=i*c*a+s*o*u,this.z=i*o*u+s*c*a,this.w=i*o*a-s*c*u):"ZYX"===r?(this.x=s*o*a-i*c*u,this.y=i*c*a+s*o*u,this.z=i*o*u-s*c*a,this.w=i*o*a+s*c*u):"YZX"===r?(this.x=s*o*a+i*c*u,this.y=i*c*a+s*o*u,this.z=i*o*u-s*c*a,this.w=i*o*a-s*c*u):"XZY"===r&&(this.x=s*o*a-i*c*u,this.y=i*c*a-s*o*u,this.z=i*o*u+s*c*a,this.w=i*o*a+s*c*u),this},Quaternion.prototype.clone=function(){return new Quaternion(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,e,n){var r=t("./Vec3"),i=t("./Quaternion");function Transform(t){t=t||{},this.position=new r,t.position&&this.position.copy(t.position),this.quaternion=new i,t.quaternion&&this.quaternion.copy(t.quaternion)}e.exports=Transform;var o=new i;Transform.pointToLocalFrame=function(t,e,n,i){var i=i||new r;return n.vsub(t,i),e.conjugate(o),o.vmult(i,i),i},Transform.prototype.pointToLocal=function(t,e){return Transform.pointToLocalFrame(this.position,this.quaternion,t,e)},Transform.pointToWorldFrame=function(t,e,n,i){var i=i||new r;return e.vmult(n,i),i.vadd(t,i),i},Transform.prototype.pointToWorld=function(t,e){return Transform.pointToWorldFrame(this.position,this.quaternion,t,e)},Transform.prototype.vectorToWorldFrame=function(t,e){var e=e||new r;return this.quaternion.vmult(t,e),e},Transform.vectorToWorldFrame=function(t,e,n){return t.vmult(e,n),n},Transform.vectorToLocalFrame=function(t,e,n,i){var i=i||new r;return e.w*=-1,e.vmult(n,i),e.w*=-1,i}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,e,n){e.exports=Vec3;var r=t("./Mat3");function Vec3(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}Vec3.ZERO=new Vec3(0,0,0),Vec3.UNIT_X=new Vec3(1,0,0),Vec3.UNIT_Y=new Vec3(0,1,0),Vec3.UNIT_Z=new Vec3(0,0,1),Vec3.prototype.cross=function(t,e){var n=t.x,r=t.y,i=t.z,o=this.x,a=this.y,s=this.z;return(e=e||new Vec3).x=a*i-s*r,e.y=s*n-o*i,e.z=o*r-a*n,e},Vec3.prototype.set=function(t,e,n){return this.x=t,this.y=e,this.z=n,this},Vec3.prototype.setZero=function(){this.x=this.y=this.z=0},Vec3.prototype.vadd=function(t,e){if(!e)return new Vec3(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z},Vec3.prototype.vsub=function(t,e){if(!e)return new Vec3(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z},Vec3.prototype.crossmat=function(){return new r([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},Vec3.prototype.normalize=function(){var t=this.x,e=this.y,n=this.z,r=Math.sqrt(t*t+e*e+n*n);if(r>0){var i=1/r;this.x*=i,this.y*=i,this.z*=i}else this.x=0,this.y=0,this.z=0;return r},Vec3.prototype.unit=function(t){t=t||new Vec3;var e=this.x,n=this.y,r=this.z,i=Math.sqrt(e*e+n*n+r*r);return i>0?(i=1/i,t.x=e*i,t.y=n*i,t.z=r*i):(t.x=1,t.y=0,t.z=0),t},Vec3.prototype.norm=function(){var t=this.x,e=this.y,n=this.z;return Math.sqrt(t*t+e*e+n*n)},Vec3.prototype.length=Vec3.prototype.norm,Vec3.prototype.norm2=function(){return this.dot(this)},Vec3.prototype.lengthSquared=Vec3.prototype.norm2,Vec3.prototype.distanceTo=function(t){var e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z;return Math.sqrt((i-e)*(i-e)+(o-n)*(o-n)+(a-r)*(a-r))},Vec3.prototype.distanceSquared=function(t){var e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z;return(i-e)*(i-e)+(o-n)*(o-n)+(a-r)*(a-r)},Vec3.prototype.mult=function(t,e){e=e||new Vec3;var n=this.x,r=this.y,i=this.z;return e.x=t*n,e.y=t*r,e.z=t*i,e},Vec3.prototype.scale=Vec3.prototype.mult,Vec3.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},Vec3.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},Vec3.prototype.negate=function(t){return(t=t||new Vec3).x=-this.x,t.y=-this.y,t.z=-this.z,t};var i=new Vec3,o=new Vec3;Vec3.prototype.tangents=function(t,e){var n=this.norm();if(n>0){var r=i,a=1/n;r.set(this.x*a,this.y*a,this.z*a);var s=o;Math.abs(r.x)<.9?(s.set(1,0,0),r.cross(s,t)):(s.set(0,1,0),r.cross(s,t)),r.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)},Vec3.prototype.toString=function(){return this.x+","+this.y+","+this.z},Vec3.prototype.toArray=function(){return[this.x,this.y,this.z]},Vec3.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},Vec3.prototype.lerp=function(t,e,n){var r=this.x,i=this.y,o=this.z;n.x=r+(t.x-r)*e,n.y=i+(t.y-i)*e,n.z=o+(t.z-o)*e},Vec3.prototype.almostEquals=function(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)},Vec3.prototype.almostZero=function(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)};var a=new Vec3;Vec3.prototype.isAntiparallelTo=function(t,e){return this.negate(a),a.almostEquals(t,e)},Vec3.prototype.clone=function(){return new Vec3(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,e,n){e.exports=Body;var r=t("../utils/EventTarget"),i=(t("../shapes/Shape"),t("../math/Vec3")),o=t("../math/Mat3"),a=t("../math/Quaternion"),s=(t("../material/Material"),t("../collision/AABB")),c=t("../shapes/Box");function Body(t){t=t||{},r.apply(this),this.id=Body.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new i,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:1,this.collisionResponse=!0,this.position=new i,t.position&&this.position.copy(t.position),this.previousPosition=new i,this.initPosition=new i,this.velocity=new i,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new i,this.force=new i;var e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=e>0?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?Body.STATIC:Body.DYNAMIC,typeof t.type==typeof Body.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new i,this.quaternion=new a,t.quaternion&&this.quaternion.copy(t.quaternion),this.initQuaternion=new a,this.angularVelocity=new i,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new i,this.interpolatedPosition=new i,this.interpolatedQuaternion=new a,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new i,this.invInertia=new i,this.invInertiaWorld=new o,this.invMassSolve=0,this.invInertiaSolve=new i,this.invInertiaWorldSolve=new o,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.aabb=new s,this.aabbNeedsUpdate=!0,this.wlambda=new i,t.shape&&this.addShape(t.shape),this.updateMassProperties()}Body.prototype=new r,Body.prototype.constructor=Body,Body.DYNAMIC=1,Body.STATIC=2,Body.KINEMATIC=4,Body.AWAKE=0,Body.SLEEPY=1,Body.SLEEPING=2,Body.idCounter=0,Body.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=0,t===Body.SLEEPING&&this.dispatchEvent({type:"wakeup"})},Body.prototype.sleep=function(){this.sleepState=Body.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},Body.sleepyEvent={type:"sleepy"},Body.sleepEvent={type:"sleep"},Body.prototype.sleepTick=function(t){if(this.allowSleep){var e=this.sleepState,n=this.velocity.norm2()+this.angularVelocity.norm2(),r=Math.pow(this.sleepSpeedLimit,2);e===Body.AWAKE&&n<r?(this.sleepState=Body.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(Body.sleepyEvent)):e===Body.SLEEPY&&n>r?this.wakeUp():e===Body.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Body.sleepEvent))}},Body.prototype.updateSolveMassProperties=function(){this.sleepState===Body.SLEEPING||this.type===Body.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},Body.prototype.pointToLocalFrame=function(t,e){var e=e||new i;return t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e},Body.prototype.vectorToLocalFrame=function(t,e){var e=e||new i;return this.quaternion.conjugate().vmult(t,e),e},Body.prototype.pointToWorldFrame=function(t,e){var e=e||new i;return this.quaternion.vmult(t,e),e.vadd(this.position,e),e},Body.prototype.vectorToWorldFrame=function(t,e){var e=e||new i;return this.quaternion.vmult(t,e),e};var u=new i,l=new a;Body.prototype.addShape=function(t,e,n){var r=new i,o=new a;return e&&r.copy(e),n&&o.copy(n),this.shapes.push(t),this.shapeOffsets.push(r),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},Body.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,n=t.length,r=0,i=0;i!==n;i++){var o=t[i];o.updateBoundingSphereRadius();var a=e[i].norm(),s=o.boundingSphereRadius;a+s>r&&(r=a+s)}this.boundingRadius=r};var p=new s;Body.prototype.computeAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,n=this.shapeOrientations,r=t.length,i=u,o=l,a=this.quaternion,s=this.aabb,c=p,h=0;h!==r;h++){var f=t[h];n[h].mult(a,o),o.vmult(e[h],i),i.vadd(this.position,i),f.calculateWorldAABB(i,o,c.lowerBound,c.upperBound),0===h?s.copy(c):s.extend(c)}this.aabbNeedsUpdate=!1};var h=new o,f=new o;new o,Body.prototype.updateInertiaWorld=function(t){var e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){var n=h,r=f;n.setRotationFromQuaternion(this.quaternion),n.transpose(r),n.scale(e,n),n.mmult(r,this.invInertiaWorld)}};var d=new i,y=new i;Body.prototype.applyForce=function(t,e){if(this.type===Body.DYNAMIC){var n=d;e.vsub(this.position,n);var r=y;n.cross(t,r),this.force.vadd(t,this.force),this.torque.vadd(r,this.torque)}};var m=new i,v=new i;Body.prototype.applyLocalForce=function(t,e){if(this.type===Body.DYNAMIC){var n=m,r=v;this.vectorToWorldFrame(t,n),this.pointToWorldFrame(e,r),this.applyForce(n,r)}};var g=new i,_=new i,b=new i;Body.prototype.applyImpulse=function(t,e){if(this.type===Body.DYNAMIC){var n=g;e.vsub(this.position,n);var r=_;r.copy(t),r.mult(this.invMass,r),this.velocity.vadd(r,this.velocity);var i=b;n.cross(t,i),this.invInertiaWorld.vmult(i,i),this.angularVelocity.vadd(i,this.angularVelocity)}};var w=new i,x=new i;Body.prototype.applyLocalImpulse=function(t,e){if(this.type===Body.DYNAMIC){var n=w,r=x;this.vectorToWorldFrame(t,n),this.pointToWorldFrame(e,r),this.applyImpulse(n,r)}};var P=new i;Body.prototype.updateMassProperties=function(){var t=P;this.invMass=this.mass>0?1/this.mass:0;var e=this.inertia,n=this.fixedRotation;this.computeAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),c.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!n?1/e.x:0,e.y>0&&!n?1/e.y:0,e.z>0&&!n?1/e.z:0),this.updateInertiaWorld(!0)},Body.prototype.getVelocityAtWorldPoint=function(t,e){var n=new i;return t.vsub(this.position,n),this.angularVelocity.cross(n,e),this.velocity.vadd(e,e),e}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,e,n){t("./Body");var r=t("../math/Vec3"),i=t("../math/Quaternion"),o=(t("../collision/RaycastResult"),t("../collision/Ray")),a=t("../objects/WheelInfo");function RaycastVehicle(t){this.chassisBody=t.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==t.indexRightAxis?t.indexRightAxis:1,this.indexForwardAxis=void 0!==t.indexForwardAxis?t.indexForwardAxis:0,this.indexUpAxis=void 0!==t.indexUpAxis?t.indexUpAxis:2}e.exports=RaycastVehicle,new r,new r,new r;var s=new r,c=new r,u=new r;new o,RaycastVehicle.prototype.addWheel=function(t){var e=new a(t=t||{}),n=this.wheelInfos.length;return this.wheelInfos.push(e),n},RaycastVehicle.prototype.setSteeringValue=function(t,e){var n=this.wheelInfos[e];n.steering=t},new r,RaycastVehicle.prototype.applyEngineForce=function(t,e){this.wheelInfos[e].engineForce=t},RaycastVehicle.prototype.setBrake=function(t,e){this.wheelInfos[e].brake=t},RaycastVehicle.prototype.addToWorld=function(t){this.constraints,t.add(this.chassisBody);var e=this;this.preStepCallback=function(){e.updateVehicle(t.dt)},t.addEventListener("preStep",this.preStepCallback),this.world=t},RaycastVehicle.prototype.getVehicleAxisWorld=function(t,e){e.set(0===t?1:0,1===t?1:0,2===t?1:0),this.chassisBody.vectorToWorldFrame(e,e)},RaycastVehicle.prototype.updateVehicle=function(t){for(var e=this.wheelInfos,n=e.length,i=this.chassisBody,o=0;o<n;o++)this.updateWheelTransform(o);this.currentVehicleSpeedKmHour=3.6*i.velocity.norm();var a=new r;this.getVehicleAxisWorld(this.indexForwardAxis,a),a.dot(i.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var o=0;o<n;o++)this.castRay(e[o]);this.updateSuspension(t);for(var s=new r,c=new r,o=0;o<n;o++){var u=e[o],l=u.suspensionForce;l>u.maxSuspensionForce&&(l=u.maxSuspensionForce),u.raycastResult.hitNormalWorld.scale(l*t,s),u.raycastResult.hitPointWorld.vsub(i.position,c),i.applyImpulse(s,u.raycastResult.hitPointWorld)}this.updateFriction(t);var p=new r,h=new r,f=new r;for(o=0;o<n;o++){var u=e[o];i.getVelocityAtWorldPoint(u.chassisConnectionPointWorld,f);var d=1;switch(this.indexUpAxis){case 1:d=-1}if(u.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,h);var y=h.dot(u.raycastResult.hitNormalWorld);u.raycastResult.hitNormalWorld.scale(y,p),h.vsub(p,h);var m=h.dot(f);u.deltaRotation=d*m*t/u.radius}!u.sliding&&u.isInContact||0===u.engineForce||!u.useCustomSlidingRotationalSpeed||(u.deltaRotation=(u.engineForce>0?1:-1)*u.customSlidingRotationalSpeed*t),Math.abs(u.brake)>Math.abs(u.engineForce)&&(u.deltaRotation=0),u.rotation+=u.deltaRotation,u.deltaRotation*=.99}},RaycastVehicle.prototype.updateSuspension=function(t){for(var e=this.chassisBody,n=e.mass,r=this.wheelInfos,i=r.length,o=0;o<i;o++){var a=r[o];if(a.isInContact){var s,c=a.suspensionRestLength,u=a.suspensionLength,l=c-u;s=a.suspensionStiffness*l*a.clippedInvContactDotSuspension;var p,h=a.suspensionRelativeVelocity;p=h<0?a.dampingCompression:a.dampingRelaxation,s-=p*h,a.suspensionForce=s*n,a.suspensionForce<0&&(a.suspensionForce=0)}else a.suspensionForce=0}},RaycastVehicle.prototype.removeFromWorld=function(t){this.constraints,t.remove(this.chassisBody),t.removeEventListener("preStep",this.preStepCallback),this.world=null};var l=new r,p=new r;RaycastVehicle.prototype.castRay=function(t){var e=l,n=p;this.updateWheelTransformWorld(t);var i=this.chassisBody,o=-1,a=t.suspensionRestLength+t.radius;t.directionWorld.scale(a,e);var s=t.chassisConnectionPointWorld;s.vadd(e,n);var c=t.raycastResult;c.reset();var u=i.collisionResponse;i.collisionResponse=!1,this.world.rayTest(s,n,c),i.collisionResponse=u;var h=c.body;if(t.raycastResult.groundObject=0,h){o=c.distance,t.raycastResult.hitNormalWorld=c.hitNormalWorld,t.isInContact=!0;var f=c.distance;t.suspensionLength=f-t.radius;var d=t.suspensionRestLength-t.maxSuspensionTravel,y=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<d&&(t.suspensionLength=d),t.suspensionLength>y&&(t.suspensionLength=y,t.raycastResult.reset());var m=t.raycastResult.hitNormalWorld.dot(t.directionWorld),v=new r;i.getVelocityAtWorldPoint(t.raycastResult.hitPointWorld,v);var g=t.raycastResult.hitNormalWorld.dot(v);if(m>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{var _=-1/m;t.suspensionRelativeVelocity=g*_,t.clippedInvContactDotSuspension=_}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return o},RaycastVehicle.prototype.updateWheelTransformWorld=function(t){t.isInContact=!1;var e=this.chassisBody;e.pointToWorldFrame(t.chassisConnectionPointLocal,t.chassisConnectionPointWorld),e.vectorToWorldFrame(t.directionLocal,t.directionWorld),e.vectorToWorldFrame(t.axleLocal,t.axleWorld)},RaycastVehicle.prototype.updateWheelTransform=function(t){var e=s,n=c,r=u,o=this.wheelInfos[t];this.updateWheelTransformWorld(o),o.directionLocal.scale(-1,e),n.copy(o.axleLocal),e.cross(n,r),r.normalize(),n.normalize();var a=o.steering,l=new i;l.setFromAxisAngle(e,a);var p=new i;p.setFromAxisAngle(n,o.rotation);var h=o.worldTransform.quaternion;this.chassisBody.quaternion.mult(l,h),h.mult(p,h),h.normalize();var f=o.worldTransform.position;f.copy(o.directionWorld),f.scale(o.suspensionLength,f),f.vadd(o.chassisConnectionPointWorld,f)};var h=[new r(1,0,0),new r(0,1,0),new r(0,0,1)];RaycastVehicle.prototype.getWheelTransformWorld=function(t){return this.wheelInfos[t].worldTransform};var f=new r,d=[],y=[];RaycastVehicle.prototype.updateFriction=function(t){for(var e=f,n=this.wheelInfos,i=n.length,o=this.chassisBody,a=y,s=d,c=0;c<i;c++){var u=n[c],l=u.raycastResult.body;u.sideImpulse=0,u.forwardImpulse=0,a[c]||(a[c]=new r),s[c]||(s[c]=new r)}for(var c=0;c<i;c++){var u=n[c],l=u.raycastResult.body;if(l){var p=s[c],m=this.getWheelTransformWorld(c);m.vectorToWorldFrame(h[this.indexRightAxis],p);var v=u.raycastResult.hitNormalWorld,g=p.dot(v);v.scale(g,e),p.vsub(e,p),p.normalize(),v.cross(p,a[c]),a[c].normalize(),u.sideImpulse=resolveSingleBilateral(o,u.raycastResult.hitPointWorld,l,u.raycastResult.hitPointWorld,p),u.sideImpulse*=1}}this.sliding=!1;for(var c=0;c<i;c++){var u=n[c],l=u.raycastResult.body,_=0;if(u.slipInfo=1,l){var b=u.brake?u.brake:0;_=calcRollingFriction(o,l,u.raycastResult.hitPointWorld,a[c],b),_+=u.engineForce*t;var w=b/_;u.slipInfo*=w}if(u.forwardImpulse=0,u.skidInfo=1,l){u.skidInfo=1;var x=u.suspensionForce*t*u.frictionSlip,P=x,O=x*P;u.forwardImpulse=_;var C=.5*u.forwardImpulse,S=1*u.sideImpulse,j=C*C+S*S;if(u.sliding=!1,j>O){this.sliding=!0,u.sliding=!0;var w=x/Math.sqrt(j);u.skidInfo*=w}}}if(this.sliding)for(var c=0;c<i;c++){var u=n[c];0!==u.sideImpulse&&u.skidInfo<1&&(u.forwardImpulse*=u.skidInfo,u.sideImpulse*=u.skidInfo)}for(var c=0;c<i;c++){var u=n[c],R=new r;if(R.copy(u.raycastResult.hitPointWorld),0!==u.forwardImpulse){var T=new r;a[c].scale(u.forwardImpulse,T),o.applyImpulse(T,R)}if(0!==u.sideImpulse){var l=u.raycastResult.body,E=new r;E.copy(u.raycastResult.hitPointWorld);var B=new r;s[c].scale(u.sideImpulse,B),o.pointToLocalFrame(R,R),R["xyz"[this.indexUpAxis]]*=u.rollInfluence,o.pointToWorldFrame(R,R),o.applyImpulse(B,R),B.scale(-1,B),l.applyImpulse(B,E)}}};var m=new r,v=new r,g=new r;function calcRollingFriction(t,e,n,r,i){var o=0,a=n,s=m,c=v,u=g;t.getVelocityAtWorldPoint(a,s),e.getVelocityAtWorldPoint(a,c),s.vsub(c,u);var l=r.dot(u),p=computeImpulseDenominator(t,n,r),h=computeImpulseDenominator(e,n,r),f=1/(p+h);return i<(o=-l*f)&&(o=i),o<-i&&(o=-i),o}var _=new r,b=new r,w=new r,x=new r;function computeImpulseDenominator(t,e,n){var r=_,i=b,o=w,a=x;return e.vsub(t.position,r),r.cross(n,i),t.invInertiaWorld.vmult(i,a),a.cross(r,o),t.invMass+n.dot(o)}var P=new r,O=new r,C=new r;function resolveSingleBilateral(t,e,n,r,i,o){var a=i.norm2();if(a>1.1)return 0;var s=P,c=O,u=C;t.getVelocityAtWorldPoint(e,s),n.getVelocityAtWorldPoint(r,c),s.vsub(c,u);var l=i.dot(u),p=1/(t.invMass+n.invMass),o=-.2*l*p;return o}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,e,n){var r=t("./Body"),i=t("../shapes/Sphere"),o=t("../shapes/Box"),a=t("../math/Vec3"),s=t("../constraints/HingeConstraint");function RigidVehicle(t){if(this.wheelBodies=[],this.coordinateSystem=void 0===t.coordinateSystem?new a(1,2,3):t.coordinateSystem.clone(),this.chassisBody=t.chassisBody,!this.chassisBody){var e=new o(new a(5,2,.5));this.chassisBody=new r(1,e)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}e.exports=RigidVehicle,RigidVehicle.prototype.addWheel=function(t){var e=(t=t||{}).body;e||(e=new r(1,new i(1.2))),this.wheelBodies.push(e),this.wheelForces.push(0),new a;var n=void 0!==t.position?t.position.clone():new a,o=new a;this.chassisBody.pointToWorldFrame(n,o),e.position.set(o.x,o.y,o.z);var c=void 0!==t.axis?t.axis.clone():new a(0,1,0);this.wheelAxes.push(c);var u=new s(this.chassisBody,e,{pivotA:n,axisA:c,pivotB:a.ZERO,axisB:c,collideConnected:!1});return this.constraints.push(u),this.wheelBodies.length-1},RigidVehicle.prototype.setSteeringValue=function(t,e){var n=this.wheelAxes[e],r=Math.cos(t),i=Math.sin(t),o=n.x,a=n.y;this.constraints[e].axisA.set(r*o-i*a,i*o+r*a,0)},RigidVehicle.prototype.setMotorSpeed=function(t,e){var n=this.constraints[e];n.enableMotor(),n.motorTargetVelocity=t},RigidVehicle.prototype.disableMotor=function(t){var e=this.constraints[t];e.disableMotor()};var c=new a;RigidVehicle.prototype.setWheelForce=function(t,e){this.wheelForces[e]=t},RigidVehicle.prototype.applyWheelForce=function(t,e){var n=this.wheelAxes[e],r=this.wheelBodies[e],i=r.torque;n.scale(t,c),r.vectorToWorldFrame(c,c),i.vadd(c,i)},RigidVehicle.prototype.addToWorld=function(t){for(var e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),r=0;r<n.length;r++)t.add(n[r]);for(var r=0;r<e.length;r++)t.addConstraint(e[r]);t.addEventListener("preStep",this._update.bind(this))},RigidVehicle.prototype._update=function(){for(var t=this.wheelForces,e=0;e<t.length;e++)this.applyWheelForce(t[e],e)},RigidVehicle.prototype.removeFromWorld=function(t){for(var e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),r=0;r<n.length;r++)t.remove(n[r]);for(var r=0;r<e.length;r++)t.removeConstraint(e[r])};var u=new a;RigidVehicle.prototype.getWheelSpeed=function(t){var e=this.wheelAxes[t],n=this.wheelBodies[t],r=n.angularVelocity;return this.chassisBody.vectorToWorldFrame(e,u),r.dot(u)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,e,n){e.exports=SPHSystem,t("../shapes/Shape");var r=t("../math/Vec3");function SPHSystem(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material"),SPHSystem.prototype.add=function(t){this.particles.push(t),this.neighbors.length<this.particles.length&&this.neighbors.push([])},SPHSystem.prototype.remove=function(t){var e=this.particles.indexOf(t);-1!==e&&(this.particles.splice(e,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var i=new r;SPHSystem.prototype.getNeighbors=function(t,e){for(var n=this.particles.length,r=t.id,o=this.smoothingRadius*this.smoothingRadius,a=i,s=0;s!==n;s++){var c=this.particles[s];c.position.vsub(t.position,a),r!==c.id&&a.norm2()<o&&e.push(c)}};var o=new r,a=new r,s=new r,c=new r,u=new r,l=new r;SPHSystem.prototype.update=function(){for(var t=this.particles.length,e=o,n=this.speedOfSound,r=this.eps,i=0;i!==t;i++){var p=this.particles[i],h=this.neighbors[i];h.length=0,this.getNeighbors(p,h),h.push(this.particles[i]);for(var f=h.length,d=0,y=0;y!==f;y++){p.position.vsub(h[y].position,e);var m=e.norm(),v=this.w(m);d+=h[y].mass*v}this.densities[i]=d,this.pressures[i]=n*n*(this.densities[i]-this.density)}for(var g=a,_=s,b=c,w=u,x=l,i=0;i!==t;i++){var P,O,C=this.particles[i];g.set(0,0,0),_.set(0,0,0);for(var h=this.neighbors[i],f=h.length,y=0;y!==f;y++){var S=h[y];C.position.vsub(S.position,w);var j=w.norm();P=-S.mass*(this.pressures[i]/(this.densities[i]*this.densities[i]+r)+this.pressures[y]/(this.densities[y]*this.densities[y]+r)),this.gradw(w,b),b.mult(P,b),g.vadd(b,g),S.velocity.vsub(C.velocity,x),x.mult(1/(1e-4+this.densities[i]*this.densities[y])*this.viscosity*S.mass,x),O=this.nablaw(j),x.mult(O,x),_.vadd(x,_)}_.mult(C.mass,_),g.mult(C.mass,g),C.force.vadd(_,C.force),C.force.vadd(g,C.force)}},SPHSystem.prototype.w=function(t){var e=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(e,9))*Math.pow(e*e-t*t,3)},SPHSystem.prototype.gradw=function(t,e){var n=t.norm(),r=this.smoothingRadius;t.mult(945/(32*Math.PI*Math.pow(r,9))*Math.pow(r*r-n*n,2),e)},SPHSystem.prototype.nablaw=function(t){var e=this.smoothingRadius,n=945/(32*Math.PI*Math.pow(e,9))*(e*e-t*t)*(7*t*t-3*e*e);return n}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,e,n){var r=t("../math/Vec3");function Spring(t,e,n){n=n||{},this.restLength="number"==typeof n.restLength?n.restLength:1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=t,this.bodyB=e,this.localAnchorA=new r,this.localAnchorB=new r,n.localAnchorA&&this.localAnchorA.copy(n.localAnchorA),n.localAnchorB&&this.localAnchorB.copy(n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB)}e.exports=Spring,Spring.prototype.setWorldAnchorA=function(t){this.bodyA.pointToLocalFrame(t,this.localAnchorA)},Spring.prototype.setWorldAnchorB=function(t){this.bodyB.pointToLocalFrame(t,this.localAnchorB)},Spring.prototype.getWorldAnchorA=function(t){this.bodyA.pointToWorldFrame(this.localAnchorA,t)},Spring.prototype.getWorldAnchorB=function(t){this.bodyB.pointToWorldFrame(this.localAnchorB,t)};var i=new r,o=new r,a=new r,s=new r,c=new r,u=new r,l=new r,p=new r,h=new r,f=new r,d=new r;Spring.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,n=this.restLength,r=this.bodyA,y=this.bodyB,m=i,v=o,g=a,_=s,b=d,w=c,x=u,P=l,O=p,C=h,S=f;this.getWorldAnchorA(w),this.getWorldAnchorB(x),w.vsub(r.position,P),x.vsub(y.position,O),x.vsub(w,m);var j=m.norm();v.copy(m),v.normalize(),y.velocity.vsub(r.velocity,g),y.angularVelocity.cross(O,b),g.vadd(b,g),r.angularVelocity.cross(P,b),g.vsub(b,g),v.mult(-t*(j-n)-e*g.dot(v),_),r.force.vsub(_,r.force),y.force.vadd(_,y.force),P.cross(_,C),O.cross(_,S),r.torque.vsub(C,r.torque),y.torque.vadd(S,y.torque)}},{"../math/Vec3":30}],36:[function(t,e,n){var r=t("../math/Vec3"),i=t("../math/Transform"),o=t("../collision/RaycastResult"),a=t("../utils/Utils");function WheelInfo(t){t=a.defaults(t,{chassisConnectionPointLocal:new r,chassisConnectionPointWorld:new r,directionLocal:new r,directionWorld:new r,axleLocal:new r,axleWorld:new r,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointWorld.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionWorld.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleWorld.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new o,this.worldTransform=new i,this.isInContact=!1}e.exports=WheelInfo;var s=new r,c=new r,s=new r;WheelInfo.prototype.updateWheel=function(t){var e=this.raycastResult;if(this.isInContact){var n=e.hitNormalWorld.dot(e.directionWorld);e.hitPointWorld.vsub(t.position,c),t.getVelocityAtWorldPoint(c,s);var r=e.hitNormalWorld.dot(s);if(n>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var i=-1/n;this.suspensionRelativeVelocity=r*i,this.clippedInvContactDotSuspension=i}}else e.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,e,n){e.exports=Box;var r=t("./Shape"),i=t("../math/Vec3"),o=t("./ConvexPolyhedron");function Box(t){r.call(this),this.type=r.types.BOX,this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}Box.prototype=new r,Box.prototype.constructor=Box,Box.prototype.updateConvexPolyhedronRepresentation=function(){var t=this.halfExtents.x,e=this.halfExtents.y,n=this.halfExtents.z,r=i,a=[new r(-t,-e,-n),new r(t,-e,-n),new r(t,e,-n),new r(-t,e,-n),new r(-t,-e,n),new r(t,-e,n),new r(t,e,n),new r(-t,e,n)],s=(new r(0,0,1),new r(0,1,0),new r(1,0,0),new o(a,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=s,s.material=this.material},Box.prototype.calculateLocalInertia=function(t,e){return e=e||new i,Box.calculateInertia(this.halfExtents,t,e),e},Box.calculateInertia=function(t,e,n){var r=t;n.x=1/12*e*(2*r.y*2*r.y+2*r.z*2*r.z),n.y=1/12*e*(2*r.x*2*r.x+2*r.z*2*r.z),n.z=1/12*e*(2*r.y*2*r.y+2*r.x*2*r.x)},Box.prototype.getSideNormals=function(t,e){var n=t,r=this.halfExtents;if(n[0].set(r.x,0,0),n[1].set(0,r.y,0),n[2].set(0,0,r.z),n[3].set(-r.x,0,0),n[4].set(0,-r.y,0),n[5].set(0,0,-r.z),void 0!==e)for(var i=0;i!==n.length;i++)e.vmult(n[i],n[i]);return n},Box.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},Box.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var a=new i;new i,Box.prototype.forEachWorldCorner=function(t,e,n){for(var r=this.halfExtents,i=[[r.x,r.y,r.z],[-r.x,r.y,r.z],[-r.x,-r.y,r.z],[-r.x,-r.y,-r.z],[r.x,-r.y,-r.z],[r.x,r.y,-r.z],[-r.x,r.y,-r.z],[r.x,-r.y,r.z]],o=0;o<i.length;o++)a.set(i[o][0],i[o][1],i[o][2]),e.vmult(a,a),t.vadd(a,a),n(a.x,a.y,a.z)};var s=[new i,new i,new i,new i,new i,new i,new i,new i];Box.prototype.calculateWorldAABB=function(t,e,n,r){var i=this.halfExtents;s[0].set(i.x,i.y,i.z),s[1].set(-i.x,i.y,i.z),s[2].set(-i.x,-i.y,i.z),s[3].set(-i.x,-i.y,-i.z),s[4].set(i.x,-i.y,-i.z),s[5].set(i.x,i.y,-i.z),s[6].set(-i.x,i.y,-i.z),s[7].set(i.x,-i.y,i.z);var o=s[0];e.vmult(o,o),t.vadd(o,o),r.copy(o),n.copy(o);for(var a=1;a<8;a++){var o=s[a];e.vmult(o,o),t.vadd(o,o);var c=o.x,u=o.y,l=o.z;c>r.x&&(r.x=c),u>r.y&&(r.y=u),l>r.z&&(r.z=l),c<n.x&&(n.x=c),u<n.y&&(n.y=u),l<n.z&&(n.z=l)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,e,n){e.exports=ConvexPolyhedron;var r=t("./Shape"),i=t("../math/Vec3"),o=(t("../math/Quaternion"),t("../math/Transform"));function ConvexPolyhedron(t,e,n){r.call(this),this.type=r.types.CONVEXPOLYHEDRON,this.vertices=t||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=e||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=n?n.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}ConvexPolyhedron.prototype=new r,ConvexPolyhedron.prototype.constructor=ConvexPolyhedron;var a=new i;ConvexPolyhedron.prototype.computeEdges=function(){var t=this.faces,e=this.vertices,n=(e.length,this.uniqueEdges);n.length=0;for(var r=a,i=0;i!==t.length;i++)for(var o=t[i],s=o.length,c=0;c!==s;c++){var u=(c+1)%s;e[o[c]].vsub(e[o[u]],r),r.normalize();for(var l=!1,p=0;p!==n.length;p++)if(n[p].almostEquals(r)||n[p].almostEquals(r)){l=!0;break}l||n.push(r.clone())}},ConvexPolyhedron.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var t=0;t<this.faces.length;t++){for(var e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error("Vertex "+this.faces[t][e]+" not found!");var n=this.faceNormals[t]||new i;this.getFaceNormal(t,n),n.negate(n),this.faceNormals[t]=n;var r=this.vertices[this.faces[t][0]];if(n.dot(r)<0){console.error(".faceNormals["+t+"] = Vec3("+n.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var e=0;e<this.faces[t].length;e++)console.warn(".vertices["+this.faces[t][e]+"] = Vec3("+this.vertices[this.faces[t][e]].toString()+")")}}};var s=new i,c=new i;ConvexPolyhedron.computeNormal=function(t,e,n,r){e.vsub(t,c),n.vsub(e,s),s.cross(c,r),r.isZero()||r.normalize()},ConvexPolyhedron.prototype.getFaceNormal=function(t,e){var n=this.faces[t],r=this.vertices[n[0]],i=this.vertices[n[1]],o=this.vertices[n[2]];return ConvexPolyhedron.computeNormal(r,i,o,e)};var u=new i;ConvexPolyhedron.prototype.clipAgainstHull=function(t,e,n,r,o,a,s,c,l){for(var p=u,h=-1,f=-Number.MAX_VALUE,d=0;d<n.faces.length;d++){p.copy(n.faceNormals[d]),o.vmult(p,p);var y=p.dot(a);y>f&&(f=y,h=d)}for(var m=[],v=n.faces[h],g=v.length,_=0;_<g;_++){var b=n.vertices[v[_]],w=new i;w.copy(b),o.vmult(w,w),r.vadd(w,w),m.push(w)}h>=0&&this.clipFaceAgainstHull(a,t,e,m,s,c,l)};var l=new i,p=new i,h=new i,f=new i,d=new i,y=new i;ConvexPolyhedron.prototype.findSeparatingAxis=function(t,e,n,r,i,o,a,s){var c=l,u=p,m=h,v=f,g=d,_=y,b=Number.MAX_VALUE;if(this.uniqueAxes)for(var w=0;w!==this.uniqueAxes.length;w++){n.vmult(this.uniqueAxes[w],c);var x=this.testSepAxis(c,t,e,n,r,i);if(!1===x)return!1;x<b&&(b=x,o.copy(c))}else for(var P=a?a.length:this.faces.length,w=0;w<P;w++){var O=a?a[w]:w;c.copy(this.faceNormals[O]),n.vmult(c,c);var x=this.testSepAxis(c,t,e,n,r,i);if(!1===x)return!1;x<b&&(b=x,o.copy(c))}if(t.uniqueAxes)for(var w=0;w!==t.uniqueAxes.length;w++){i.vmult(t.uniqueAxes[w],u);var x=this.testSepAxis(u,t,e,n,r,i);if(!1===x)return!1;x<b&&(b=x,o.copy(u))}else for(var C=s?s.length:t.faces.length,w=0;w<C;w++){var O=s?s[w]:w;u.copy(t.faceNormals[O]),i.vmult(u,u);var x=this.testSepAxis(u,t,e,n,r,i);if(!1===x)return!1;x<b&&(b=x,o.copy(u))}for(var S=0;S!==this.uniqueEdges.length;S++){n.vmult(this.uniqueEdges[S],v);for(var j=0;j!==t.uniqueEdges.length;j++)if(i.vmult(t.uniqueEdges[j],g),v.cross(g,_),!_.almostZero()){_.normalize();var R=this.testSepAxis(_,t,e,n,r,i);if(!1===R)return!1;R<b&&(b=R,o.copy(_))}}return r.vsub(e,m),m.dot(o)>0&&o.negate(o),!0};var m=[],v=[];ConvexPolyhedron.prototype.testSepAxis=function(t,e,n,r,i,o){ConvexPolyhedron.project(this,t,n,r,m),ConvexPolyhedron.project(e,t,i,o,v);var a=m[0],s=m[1],c=v[0],u=v[1];if(a<u||c<s)return!1;var l=a-u,p=c-s,h=l<p?l:p;return h};var g=new i,_=new i;ConvexPolyhedron.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(g,_);var n=_.x-g.x,r=_.y-g.y,i=_.z-g.z;e.x=1/12*t*(2*r*2*r+2*i*2*i),e.y=1/12*t*(2*n*2*n+2*i*2*i),e.z=1/12*t*(2*r*2*r+2*n*2*n)},ConvexPolyhedron.prototype.getPlaneConstantOfFace=function(t){var e=this.faces[t],n=this.faceNormals[t],r=this.vertices[e[0]],i=-n.dot(r);return i};var b=new i,w=new i,x=new i,P=new i,O=new i,C=new i,S=new i,j=new i;ConvexPolyhedron.prototype.clipFaceAgainstHull=function(t,e,n,r,i,o,a){for(var s=b,c=w,u=x,l=P,p=O,h=C,f=S,d=j,y=r,m=[],v=-1,g=Number.MAX_VALUE,_=0;_<this.faces.length;_++){s.copy(this.faceNormals[_]),n.vmult(s,s);var R=s.dot(t);R<g&&(g=R,v=_)}if(!(v<0)){var T=this.faces[v];T.connectedFaces=[];for(var E=0;E<this.faces.length;E++)for(var B=0;B<this.faces[E].length;B++)-1!==T.indexOf(this.faces[E][B])&&E!==v&&-1===T.connectedFaces.indexOf(E)&&T.connectedFaces.push(E);y.length;for(var A=T.length,I=0;I<A;I++){var M=this.vertices[T[I]],z=this.vertices[T[(I+1)%A]];M.vsub(z,c),u.copy(c),n.vmult(u,u),e.vadd(u,u),l.copy(this.faceNormals[v]),n.vmult(l,l),e.vadd(l,l),u.cross(l,p),p.negate(p),h.copy(M),n.vmult(h,h),e.vadd(h,h),h.dot(p);var k=T.connectedFaces[I];f.copy(this.faceNormals[k]);var D=this.getPlaneConstantOfFace(k);d.copy(f),n.vmult(d,d);var F=D-d.dot(e);for(this.clipFaceAgainstPlane(y,m,d,F);y.length;)y.shift();for(;m.length;)y.push(m.shift())}f.copy(this.faceNormals[v]);var D=this.getPlaneConstantOfFace(v);d.copy(f),n.vmult(d,d);for(var F=D-d.dot(e),E=0;E<y.length;E++){var L=d.dot(y[E])+F;if(L<=i&&(console.log("clamped: depth="+L+" to minDist="+i),L=i),L<=o){var N=y[E];if(L<=0){var V={point:N,normal:d,depth:L};a.push(V)}}}}},ConvexPolyhedron.prototype.clipFaceAgainstPlane=function(t,e,n,r){var o,a,s=t.length;if(s<2)return e;var c=t[t.length-1],u=t[0];o=n.dot(c)+r;for(var l=0;l<s;l++){if(u=t[l],a=n.dot(u)+r,o<0)if(a<0){var p=new i;p.copy(u),e.push(p)}else{var p=new i;c.lerp(u,o/(o-a),p),e.push(p)}else if(a<0){var p=new i;c.lerp(u,o/(o-a),p),e.push(p),e.push(u)}c=u,o=a}return e},ConvexPolyhedron.prototype.computeWorldVertices=function(t,e){for(var n=this.vertices.length;this.worldVertices.length<n;)this.worldVertices.push(new i);for(var r=this.vertices,o=this.worldVertices,a=0;a!==n;a++)e.vmult(r[a],o[a]),t.vadd(o[a],o[a]);this.worldVerticesNeedsUpdate=!1},new i,ConvexPolyhedron.prototype.computeLocalAABB=function(t,e){var n=this.vertices.length,r=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var i=0;i<n;i++){var o=r[i];o.x<t.x?t.x=o.x:o.x>e.x&&(e.x=o.x),o.y<t.y?t.y=o.y:o.y>e.y&&(e.y=o.y),o.z<t.z?t.z=o.z:o.z>e.z&&(e.z=o.z)}},ConvexPolyhedron.prototype.computeWorldFaceNormals=function(t){for(var e=this.faceNormals.length;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new i);for(var n=this.faceNormals,r=this.worldFaceNormals,o=0;o!==e;o++)t.vmult(n[o],r[o]);this.worldFaceNormalsNeedsUpdate=!1},ConvexPolyhedron.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,n=0,r=e.length;n!==r;n++){var i=e[n].norm2();i>t&&(t=i)}this.boundingSphereRadius=Math.sqrt(t)};var R=new i;ConvexPolyhedron.prototype.calculateWorldAABB=function(t,e,n,r){for(var i,o,a,s,c,u,l=this.vertices.length,p=this.vertices,h=0;h<l;h++){R.copy(p[h]),e.vmult(R,R),t.vadd(R,R);var f=R;f.x<i||void 0===i?i=f.x:(f.x>s||void 0===s)&&(s=f.x),f.y<o||void 0===o?o=f.y:(f.y>c||void 0===c)&&(c=f.y),f.z<a||void 0===a?a=f.z:(f.z>u||void 0===u)&&(u=f.z)}n.set(i,o,a),r.set(s,c,u)},ConvexPolyhedron.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},ConvexPolyhedron.prototype.getAveragePointLocal=function(t){t=t||new i;for(var e=this.vertices.length,n=this.vertices,r=0;r<e;r++)t.vadd(n[r],t);return t.mult(1/e,t),t},ConvexPolyhedron.prototype.transformAllPoints=function(t,e){var n=this.vertices.length,r=this.vertices;if(e){for(var i=0;i<n;i++){var o=r[i];e.vmult(o,o)}for(var i=0;i<this.faceNormals.length;i++){var o=this.faceNormals[i];e.vmult(o,o)}}if(t)for(var i=0;i<n;i++){var o=r[i];o.vadd(t,o)}};var T=new i,E=new i,B=new i;ConvexPolyhedron.prototype.pointIsInside=function(t){var e=this.vertices.length,n=this.vertices,r=this.faces,i=this.faceNormals,o=this.faces.length,a=T;this.getAveragePointLocal(a);for(var s=0;s<o;s++){this.faces[s].length;var e=i[s],c=n[r[s][0]],u=E;t.vsub(c,u);var l=e.dot(u),p=B;a.vsub(c,p);var h=e.dot(p);if(l<0&&h>0||l>0&&h<0)return!1}return-1},new i;var A=new i,I=new i;ConvexPolyhedron.project=function(t,e,n,r,i){var a=t.vertices.length,s=A,c=0,u=0,l=I,p=t.vertices;l.setZero(),o.vectorToLocalFrame(n,r,e,s),o.pointToLocalFrame(n,r,l,l);var h=l.dot(s);u=c=p[0].dot(s);for(var f=1;f<a;f++){var d=p[f].dot(s);d>c&&(c=d),d<u&&(u=d)}if((u-=h)>(c-=h)){var y=u;u=c,c=y}i[0]=c,i[1]=u}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,e,n){e.exports=Cylinder;var r=t("./Shape"),i=t("../math/Vec3"),o=(t("../math/Quaternion"),t("./ConvexPolyhedron"));function Cylinder(t,e,n,a){var s=a,c=[],u=[],l=[],p=[],h=[],f=Math.cos,d=Math.sin;c.push(new i(e*f(0),e*d(0),.5*-n)),p.push(0),c.push(new i(t*f(0),t*d(0),.5*n)),h.push(1);for(var y=0;y<s;y++){var m=2*Math.PI/s*(y+1),v=2*Math.PI/s*(y+.5);y<s-1?(c.push(new i(e*f(m),e*d(m),.5*-n)),p.push(2*y+2),c.push(new i(t*f(m),t*d(m),.5*n)),h.push(2*y+3),l.push([2*y+2,2*y+3,2*y+1,2*y])):l.push([0,1,2*y+1,2*y]),(s%2==1||y<s/2)&&u.push(new i(f(v),d(v),0))}l.push(h),u.push(new i(0,0,1));for(var g=[],y=0;y<p.length;y++)g.push(p[p.length-y-1]);l.push(g),this.type=r.types.CONVEXPOLYHEDRON,o.call(this,c,l,u)}Cylinder.prototype=new o},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,e,n){var r=t("./Shape"),i=t("./ConvexPolyhedron"),o=t("../math/Vec3"),a=t("../utils/Utils");function Heightfield(t,e){e=a.defaults(e,{maxValue:null,minValue:null,elementSize:1}),this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementSize=e.elementSize,null===e.minValue&&this.updateMinValue(),null===e.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,r.call(this),this.pillarConvex=new i,this.pillarOffset=new o,this.type=r.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}e.exports=Heightfield,Heightfield.prototype=new r,Heightfield.prototype.update=function(){this._cachedPillars={}},Heightfield.prototype.updateMinValue=function(){for(var t=this.data,e=t[0][0],n=0;n!==t.length;n++)for(var r=0;r!==t[n].length;r++){var i=t[n][r];i<e&&(e=i)}this.minValue=e},Heightfield.prototype.updateMaxValue=function(){for(var t=this.data,e=t[0][0],n=0;n!==t.length;n++)for(var r=0;r!==t[n].length;r++){var i=t[n][r];i>e&&(e=i)}this.maxValue=e},Heightfield.prototype.setHeightValueAtIndex=function(t,e,n){var r=this.data;r[t][e]=n,this.clearCachedConvexTrianglePillar(t,e,!1),t>0&&(this.clearCachedConvexTrianglePillar(t-1,e,!0),this.clearCachedConvexTrianglePillar(t-1,e,!1)),e>0&&(this.clearCachedConvexTrianglePillar(t,e-1,!0),this.clearCachedConvexTrianglePillar(t,e-1,!1)),e>0&&t>0&&this.clearCachedConvexTrianglePillar(t-1,e-1,!0)},Heightfield.prototype.getRectMinMax=function(t,e,n,r,i){i=i||[];for(var o=this.data,a=this.minValue,s=t;s<=n;s++)for(var c=e;c<=r;c++){var u=o[s][c];u>a&&(a=u)}i[0]=this.minValue,i[1]=a},Heightfield.prototype.getIndexOfPosition=function(t,e,n,r){var i=this.elementSize,o=this.data,a=Math.floor(t/i),s=Math.floor(e/i);return n[0]=a,n[1]=s,r&&(a<0&&(a=0),s<0&&(s=0),a>=o.length-1&&(a=o.length-1),s>=o[0].length-1&&(s=o[0].length-1)),!(a<0||s<0||a>=o.length-1||s>=o[0].length-1)},Heightfield.prototype.getHeightAt=function(t,e,n){var r=[];this.getIndexOfPosition(t,e,r,n);var i=[];return this.getRectMinMax(r[0],r[1]+1,r[0],r[1]+1,i),(i[0]+i[1])/2},Heightfield.prototype.getCacheConvexTrianglePillarKey=function(t,e,n){return t+"_"+e+"_"+(n?1:0)},Heightfield.prototype.getCachedConvexTrianglePillar=function(t,e,n){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]},Heightfield.prototype.setCachedConvexTrianglePillar=function(t,e,n,r,i){this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]={convex:r,offset:i}},Heightfield.prototype.clearCachedConvexTrianglePillar=function(t,e,n){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]},Heightfield.prototype.getConvexTrianglePillar=function(t,e,n){var r=this.pillarConvex,a=this.pillarOffset;if(this.cacheEnabled){var s=this.getCachedConvexTrianglePillar(t,e,n);if(s)return this.pillarConvex=s.convex,void(this.pillarOffset=s.offset);r=new i,a=new o,this.pillarConvex=r,this.pillarOffset=a}var s=this.data,c=this.elementSize,u=r.faces;r.vertices.length=6;for(var l=0;l<6;l++)r.vertices[l]||(r.vertices[l]=new o);u.length=5;for(var l=0;l<5;l++)u[l]||(u[l]=[]);var p=r.vertices,h=(Math.min(s[t][e],s[t+1][e],s[t][e+1],s[t+1][e+1])-this.minValue)/2+this.minValue;n?(a.set((t+.75)*c,(e+.75)*c,h),p[0].set(.25*c,.25*c,s[t+1][e+1]-h),p[1].set(-.75*c,.25*c,s[t][e+1]-h),p[2].set(.25*c,-.75*c,s[t+1][e]-h),p[3].set(.25*c,.25*c,-h-1),p[4].set(-.75*c,.25*c,-h-1),p[5].set(.25*c,-.75*c,-h-1),u[0][0]=0,u[0][1]=1,u[0][2]=2,u[1][0]=5,u[1][1]=4,u[1][2]=3,u[2][0]=2,u[2][1]=5,u[2][2]=3,u[2][3]=0,u[3][0]=3,u[3][1]=4,u[3][2]=1,u[3][3]=0,u[4][0]=1,u[4][1]=4,u[4][2]=5,u[4][3]=2):(a.set((t+.25)*c,(e+.25)*c,h),p[0].set(-.25*c,-.25*c,s[t][e]-h),p[1].set(.75*c,-.25*c,s[t+1][e]-h),p[2].set(-.25*c,.75*c,s[t][e+1]-h),p[3].set(-.25*c,-.25*c,-h-1),p[4].set(.75*c,-.25*c,-h-1),p[5].set(-.25*c,.75*c,-h-1),u[0][0]=0,u[0][1]=1,u[0][2]=2,u[1][0]=5,u[1][1]=4,u[1][2]=3,u[2][0]=0,u[2][1]=2,u[2][2]=5,u[2][3]=3,u[3][0]=1,u[3][1]=0,u[3][2]=3,u[3][3]=4,u[4][0]=4,u[4][1]=5,u[4][2]=2,u[4][3]=1),r.computeNormals(),r.computeEdges(),r.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(t,e,n,r,a)},Heightfield.prototype.calculateLocalInertia=function(t,e){return(e=e||new o).set(0,0,0),e},Heightfield.prototype.volume=function(){return Number.MAX_VALUE},Heightfield.prototype.calculateWorldAABB=function(t,e,n,r){n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),r.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},Heightfield.prototype.updateBoundingSphereRadius=function(){var t=this.data,e=this.elementSize;this.boundingSphereRadius=new o(t.length*e,t[0].length*e,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,e,n){e.exports=Particle;var r=t("./Shape"),i=t("../math/Vec3");function Particle(){r.call(this),this.type=r.types.PARTICLE}Particle.prototype=new r,Particle.prototype.constructor=Particle,Particle.prototype.calculateLocalInertia=function(t,e){return(e=e||new i).set(0,0,0),e},Particle.prototype.volume=function(){return 0},Particle.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},Particle.prototype.calculateWorldAABB=function(t,e,n,r){n.copy(t),r.copy(t)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,e,n){e.exports=Plane;var r=t("./Shape"),i=t("../math/Vec3");function Plane(){r.call(this),this.type=r.types.PLANE,this.worldNormal=new i,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}Plane.prototype=new r,Plane.prototype.constructor=Plane,Plane.prototype.computeWorldNormal=function(t){var e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1},Plane.prototype.calculateLocalInertia=function(t,e){return e=e||new i},Plane.prototype.volume=function(){return Number.MAX_VALUE};var o=new i;Plane.prototype.calculateWorldAABB=function(t,e,n,r){o.set(0,0,1),e.vmult(o,o);var i=Number.MAX_VALUE;n.set(-i,-i,-i),r.set(i,i,i),1===o.x&&(r.x=t.x),1===o.y&&(r.y=t.y),1===o.z&&(r.z=t.z),-1===o.x&&(n.x=t.x),-1===o.y&&(n.y=t.y),-1===o.z&&(n.z=t.z)},Plane.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,e,n){e.exports=r;var r=t("./Shape");function r(){this.id=r.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material"),r.prototype.constructor=r,r.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},r.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},r.prototype.calculateLocalInertia=function(t,e){throw"calculateLocalInertia() not implemented for shape type "+this.type},r.idCounter=0,r.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,e,n){e.exports=Sphere;var r=t("./Shape"),i=t("../math/Vec3");function Sphere(t){if(r.call(this),this.radius=void 0!==t?Number(t):1,this.type=r.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}Sphere.prototype=new r,Sphere.prototype.constructor=Sphere,Sphere.prototype.calculateLocalInertia=function(t,e){e=e||new i;var n=2*t*this.radius*this.radius/5;return e.x=n,e.y=n,e.z=n,e},Sphere.prototype.volume=function(){return 4*Math.PI*this.radius/3},Sphere.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},Sphere.prototype.calculateWorldAABB=function(t,e,n,r){for(var i=this.radius,o=["x","y","z"],a=0;a<o.length;a++){var s=o[a];n[s]=t[s]-i,r[s]=t[s]+i}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,e,n){e.exports=Trimesh;var r=t("./Shape"),i=t("../math/Vec3"),o=(t("../math/Quaternion"),t("../math/Transform")),a=t("../collision/AABB"),s=t("../utils/Octree");function Trimesh(t,e){r.call(this),this.type=r.types.TRIMESH,this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new a,this.edges=null,this.scale=new i(1,1,1),this.tree=new s,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}Trimesh.prototype=new r,Trimesh.prototype.constructor=Trimesh;var c=new i;Trimesh.prototype.updateTree=function(){var t=this.tree;t.reset(),t.aabb.copy(this.aabb);var e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;for(var n=new a,r=new i,o=new i,s=new i,c=[r,o,s],u=0;u<this.indices.length/3;u++){var l=3*u;this._getUnscaledVertex(this.indices[l],r),this._getUnscaledVertex(this.indices[l+1],o),this._getUnscaledVertex(this.indices[l+2],s),n.setFromPoints(c),t.insert(n,u)}t.removeEmptyNodes()};var u=new a;Trimesh.prototype.getTrianglesInAABB=function(t,e){u.copy(t);var n=this.scale,r=n.x,i=n.y,o=n.z,a=u.lowerBound,s=u.upperBound;return a.x/=r,a.y/=i,a.z/=o,s.x/=r,s.y/=i,s.z/=o,this.tree.aabbQuery(u,e)},Trimesh.prototype.setScale=function(t){var e=this.scale.x===this.scale.y===this.scale.z,n=t.x===t.y===t.z;e&&n||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()},Trimesh.prototype.updateNormals=function(){for(var t=c,e=this.normals,n=0;n<this.indices.length/3;n++){var r=3*n,i=this.indices[r],o=this.indices[r+1],a=this.indices[r+2];this.getVertex(i,d),this.getVertex(o,y),this.getVertex(a,m),Trimesh.computeNormal(y,d,m,t),e[r]=t.x,e[r+1]=t.y,e[r+2]=t.z}},Trimesh.prototype.updateEdges=function(){for(var t={},e=function(e,n){var r=i<o?i+"_"+o:o+"_"+i;t[r]=!0},n=0;n<this.indices.length/3;n++){var r=3*n,i=this.indices[r],o=this.indices[r+1];this.indices[r+2];e(),e(),e()}var a=Object.keys(t);this.edges=new Int16Array(2*a.length);for(var n=0;n<a.length;n++){var s=a[n].split("_");this.edges[2*n]=parseInt(s[0],10),this.edges[2*n+1]=parseInt(s[1],10)}},Trimesh.prototype.getEdgeVertex=function(t,e,n){var r=this.edges[2*t+(e?1:0)];this.getVertex(r,n)};var l=new i,p=new i;Trimesh.prototype.getEdgeVector=function(t,e){var n=l,r=p;this.getEdgeVertex(t,0,n),this.getEdgeVertex(t,1,r),r.vsub(n,e)};var h=new i,f=new i;Trimesh.computeNormal=function(t,e,n,r){e.vsub(t,f),n.vsub(e,h),h.cross(f,r),r.isZero()||r.normalize()};var d=new i,y=new i,m=new i;Trimesh.prototype.getVertex=function(t,e){var n=this.scale;return this._getUnscaledVertex(t,e),e.x*=n.x,e.y*=n.y,e.z*=n.z,e},Trimesh.prototype._getUnscaledVertex=function(t,e){var n=3*t,r=this.vertices;return e.set(r[n],r[n+1],r[n+2])},Trimesh.prototype.getWorldVertex=function(t,e,n,r){return this.getVertex(t,r),o.pointToWorldFrame(e,n,r,r),r},Trimesh.prototype.getTriangleVertices=function(t,e,n,r){var i=3*t;this.getVertex(this.indices[i],e),this.getVertex(this.indices[i+1],n),this.getVertex(this.indices[i+2],r)},Trimesh.prototype.getNormal=function(t,e){var n=3*t;return e.set(this.normals[n],this.normals[n+1],this.normals[n+2])};var v=new a;Trimesh.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(v);var n=v.upperBound.x-v.lowerBound.x,r=v.upperBound.y-v.lowerBound.y,i=v.upperBound.z-v.lowerBound.z;return e.set(1/12*t*(2*r*2*r+2*i*2*i),1/12*t*(2*n*2*n+2*i*2*i),1/12*t*(2*r*2*r+2*n*2*n))};var g=new i;Trimesh.prototype.computeLocalAABB=function(t){var e=t.lowerBound,n=t.upperBound,r=this.vertices.length,i=(this.vertices,g);this.getVertex(0,i),e.copy(i),n.copy(i);for(var o=0;o!==r;o++)this.getVertex(o,i),i.x<e.x?e.x=i.x:i.x>n.x&&(n.x=i.x),i.y<e.y?e.y=i.y:i.y>n.y&&(n.y=i.y),i.z<e.z?e.z=i.z:i.z>n.z&&(n.z=i.z)},Trimesh.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},Trimesh.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,n=new i,r=0,o=e.length/3;r!==o;r++){this.getVertex(r,n);var a=n.norm2();a>t&&(t=a)}this.boundingSphereRadius=Math.sqrt(t)},new i;var _=new o,b=new a;Trimesh.prototype.calculateWorldAABB=function(t,e,n,r){var i=_,o=b;i.position=t,i.quaternion=e,this.aabb.toWorldFrame(i,o),n.copy(o.lowerBound),r.copy(o.upperBound)},Trimesh.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},Trimesh.createTorus=function(t,e,n,r,i){t=t||1,e=e||.5,n=n||8,r=r||6,i=i||2*Math.PI;for(var o=[],a=[],s=0;s<=n;s++)for(var c=0;c<=r;c++){var u=c/r*i,l=s/n*Math.PI*2,p=(t+e*Math.cos(l))*Math.cos(u),h=(t+e*Math.cos(l))*Math.sin(u),f=e*Math.sin(l);o.push(p,h,f)}for(var s=1;s<=n;s++)for(var c=1;c<=r;c++){var d=(r+1)*s+c-1,y=(r+1)*(s-1)+c-1,m=(r+1)*(s-1)+c,v=(r+1)*s+c;a.push(d,y,v),a.push(y,m,v)}return new Trimesh(o,a)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,e,n){e.exports=GSSolver,t("../math/Vec3"),t("../math/Quaternion");var r=t("./Solver");function GSSolver(){r.call(this),this.iterations=10,this.tolerance=1e-7}GSSolver.prototype=new r;var i=[],o=[],a=[];GSSolver.prototype.solve=function(t,e){var n,r,s,c,u,l,p=0,h=this.iterations,f=this.tolerance*this.tolerance,d=this.equations,y=d.length,m=e.bodies,v=m.length,g=t;if(0!==y)for(var _=0;_!==v;_++)m[_].updateSolveMassProperties();var b=o,w=a,x=i;b.length=y,w.length=y,x.length=y;for(var _=0;_!==y;_++){var P=d[_];x[_]=0,w[_]=P.computeB(g),b[_]=1/P.computeC()}if(0!==y){for(var _=0;_!==v;_++){var O=m[_],C=O.vlambda,S=O.wlambda;C.set(0,0,0),S&&S.set(0,0,0)}for(p=0;p!==h;p++){c=0;for(var j=0;j!==y;j++){var P=d[j];n=w[j],r=b[j],l=x[j],u=P.computeGWlambda(),s=r*(n-u-P.eps*l),l+s<P.minForce?s=P.minForce-l:l+s>P.maxForce&&(s=P.maxForce-l),x[j]+=s,c+=s>0?s:-s,P.addToWlambda(s)}if(c*c<f)break}for(var _=0;_!==v;_++){var O=m[_],R=O.velocity,T=O.angularVelocity;R.vadd(O.vlambda,R),T&&T.vadd(O.wlambda,T)}}return p}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,e,n){function Solver(){this.equations=[]}e.exports=Solver,Solver.prototype.solve=function(t,e){return 0},Solver.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},Solver.prototype.removeEquation=function(t){var e=this.equations,n=e.indexOf(t);-1!==n&&e.splice(n,1)},Solver.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,e,n){e.exports=SplitSolver,t("../math/Vec3"),t("../math/Quaternion");var r=t("./Solver"),i=t("../objects/Body");function SplitSolver(t){for(r.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=t,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}SplitSolver.prototype=new r;var o=[],a=[],s={bodies:[]},c=i.STATIC;function getUnvisitedNode(t){for(var e=t.length,n=0;n!==e;n++){var r=t[n];if(!(r.visited||r.body.type&c))return r}return!1}var u=[];function bfs(t,e,n,r){for(u.push(t),t.visited=!0,e(t,n,r);u.length;)for(var i,o=u.pop();i=getUnvisitedNode(o.children);)i.visited=!0,e(i,n,r),u.push(i)}function visitFunc(t,e,n){e.push(t.body);for(var r=t.eqs.length,i=0;i!==r;i++){var o=t.eqs[i];-1===n.indexOf(o)&&n.push(o)}}function sortById(t,e){return e.id-t.id}SplitSolver.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},SplitSolver.prototype.solve=function(t,e){for(var n=o,r=this.nodePool,i=e.bodies,c=this.equations,u=c.length,l=i.length,p=this.subsolver;r.length<l;)r.push(this.createNode());n.length=l;for(var h=0;h<l;h++)n[h]=r[h];for(var h=0;h!==l;h++){var f=n[h];f.body=i[h],f.children.length=0,f.eqs.length=0,f.visited=!1}for(var d=0;d!==u;d++){var y=c[d],h=i.indexOf(y.bi),m=i.indexOf(y.bj),v=n[h],g=n[m];v.children.push(g),v.eqs.push(y),g.children.push(v),g.eqs.push(y)}var _,b=0,w=a;p.tolerance=this.tolerance,p.iterations=this.iterations;for(var x=s;_=getUnvisitedNode(n);){w.length=0,x.bodies.length=0,bfs(_,visitFunc,x.bodies,w);var P=w.length;w=w.sort(sortById);for(var h=0;h!==P;h++)p.addEquation(w[h]);p.solve(t,x),p.removeAllEquations(),b++}return b}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,e,n){var r=function(){};e.exports=r,r.prototype={constructor:r,addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e),this},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return this;var n=this._listeners;if(void 0===n[t])return this;var r=n[t].indexOf(e);return-1!==r&&n[t].splice(r,1),this},dispatchEvent:function(t){if(void 0===this._listeners)return this;var e=this._listeners,n=e[t.type];if(void 0!==n){t.target=this;for(var r=0,i=n.length;r<i;r++)n[r].call(this,t)}return this}}},{}],50:[function(t,e,n){var r=t("../collision/AABB"),i=t("../math/Vec3");function OctreeNode(t){t=t||{},this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new r,this.data=[],this.children=[]}function Octree(t,e){(e=e||{}).root=null,e.aabb=t,OctreeNode.call(this,e),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}e.exports=Octree,Octree.prototype=new OctreeNode,OctreeNode.prototype.reset=function(t,e){this.children.length=this.data.length=0},OctreeNode.prototype.insert=function(t,e,n){var r=this.data;if(n=n||0,!this.aabb.contains(t))return!1;var i=this.children;if(n<(this.maxDepth||this.root.maxDepth)){var o=!1;i.length||(this.subdivide(),o=!0);for(var a=0;8!==a;a++)if(i[a].insert(t,e,n+1))return!0;o&&(i.length=0)}return r.push(e),!0};var o=new i;OctreeNode.prototype.subdivide=function(){var t=this.aabb,e=t.lowerBound,n=t.upperBound,a=this.children;a.push(new OctreeNode({aabb:new r({lowerBound:new i(0,0,0)})}),new OctreeNode({aabb:new r({lowerBound:new i(1,0,0)})}),new OctreeNode({aabb:new r({lowerBound:new i(1,1,0)})}),new OctreeNode({aabb:new r({lowerBound:new i(1,1,1)})}),new OctreeNode({aabb:new r({lowerBound:new i(0,1,1)})}),new OctreeNode({aabb:new r({lowerBound:new i(0,0,1)})}),new OctreeNode({aabb:new r({lowerBound:new i(1,0,1)})}),new OctreeNode({aabb:new r({lowerBound:new i(0,1,0)})})),n.vsub(e,o),o.scale(.5,o);for(var s=this.root||this,c=0;8!==c;c++){var u=a[c];u.root=s;var l=u.aabb.lowerBound;l.x*=o.x,l.y*=o.y,l.z*=o.z,l.vadd(e,l),l.vadd(o,u.aabb.upperBound)}},OctreeNode.prototype.aabbQuery=function(t,e){this.data,this.children;for(var n=[this];n.length;){var r=n.pop();r.aabb.overlaps(t)&&Array.prototype.push.apply(e,r.data),Array.prototype.push.apply(n,r.children)}return e};var a=new r;OctreeNode.prototype.rayQuery=function(t,e,n){return t.getAABB(a),a.toLocalFrame(e,a),this.aabbQuery(a,n),n},OctreeNode.prototype.removeEmptyNodes=function(){for(var t=[this];t.length;){for(var e=t.pop(),n=e.children.length-1;n>=0;n--)e.children[n].data.length||e.children.splice(n,1);Array.prototype.push.apply(t,e.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,e,n){function Pool(){this.objects=[],this.type=Object}e.exports=Pool,Pool.prototype.release=function(){for(var t=arguments.length,e=0;e!==t;e++)this.objects.push(arguments[e])},Pool.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},Pool.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,e,n){function TupleDictionary(){this.data={keys:[]}}e.exports=TupleDictionary,TupleDictionary.prototype.get=function(t,e){if(t>e){var n=e;e=t,t=n}return this.data[t+"-"+e]},TupleDictionary.prototype.set=function(t,e,n){if(t>e){var r=e;e=t,t=r}var i=t+"-"+e;this.get(t,e)||this.data.keys.push(i),this.data[i]=n},TupleDictionary.prototype.reset=function(){for(var t=this.data,e=t.keys;e.length>0;){var n=e.pop();delete t[n]}}},{}],53:[function(t,e,n){function Utils(){}e.exports=Utils,Utils.defaults=function(t,e){for(var n in t=t||{},e)n in t||(t[n]=e[n]);return t}},{}],54:[function(t,e,n){e.exports=Vec3Pool;var r=t("../math/Vec3"),i=t("./Pool");function Vec3Pool(){i.call(this),this.type=r}Vec3Pool.prototype=new i,Vec3Pool.prototype.constructObject=function(){return new r}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,e,n){e.exports=Narrowphase;var r=t("../collision/AABB"),i=t("../shapes/Shape"),o=t("../collision/Ray"),a=t("../math/Vec3"),s=t("../math/Transform"),c=(t("../shapes/ConvexPolyhedron"),t("../math/Quaternion")),u=(t("../solver/Solver"),t("../utils/Vec3Pool")),l=t("../equations/ContactEquation"),p=t("../equations/FrictionEquation");function Narrowphase(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new u,this.world=t,this.currentContactMaterial=null,this.enableFrictionReduction=!1}Narrowphase.prototype.createContactEquation=function(t,e,n,r,i,o){var a;this.contactPointPool.length?((a=this.contactPointPool.pop()).bi=t,a.bj=e):a=new l(t,e),a.enabled=t.collisionResponse&&e.collisionResponse&&n.collisionResponse&&r.collisionResponse;var s=this.currentContactMaterial;a.restitution=s.restitution,a.setSpookParams(s.contactEquationStiffness,s.contactEquationRelaxation,this.world.dt);var c=n.material||t.material,u=r.material||e.material;return c&&u&&c.restitution>=0&&u.restitution>=0&&(a.restitution=c.restitution*u.restitution),a.si=i||n,a.sj=o||r,a},Narrowphase.prototype.createFrictionEquationsFromContact=function(t,e){var n=t.bi,r=t.bj,i=t.si,o=t.sj,a=this.world,s=this.currentContactMaterial,c=s.friction,u=i.material||n.material,l=o.material||r.material;if(u&&l&&u.friction>=0&&l.friction>=0&&(c=u.friction*l.friction),c>0){var h=c*a.gravity.length(),f=n.invMass+r.invMass;f>0&&(f=1/f);var d=this.frictionEquationPool,y=d.length?d.pop():new p(n,r,h*f),m=d.length?d.pop():new p(n,r,h*f);return y.bi=m.bi=n,y.bj=m.bj=r,y.minForce=m.minForce=-h*f,y.maxForce=m.maxForce=h*f,y.ri.copy(t.ri),y.rj.copy(t.rj),m.ri.copy(t.ri),m.rj.copy(t.rj),t.ni.tangents(y.t,m.t),y.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),m.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),y.enabled=m.enabled=t.enabled,e.push(y,m),!0}return!1};var h=new a,f=new a,d=new a;Narrowphase.prototype.createFrictionFromAverage=function(t){var e=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(e,this.frictionResult)&&1!==t){var n=this.frictionResult[this.frictionResult.length-2],r=this.frictionResult[this.frictionResult.length-1];h.setZero(),f.setZero(),d.setZero();for(var i=e.bi,o=(e.bj,0);o!==t;o++)(e=this.result[this.result.length-1-o]).bodyA!==i?(h.vadd(e.ni,h),f.vadd(e.ri,f),d.vadd(e.rj,d)):(h.vsub(e.ni,h),f.vadd(e.rj,f),d.vadd(e.ri,d));var a=1/t;f.scale(a,n.ri),d.scale(a,n.rj),r.ri.copy(n.ri),r.rj.copy(n.rj),h.normalize(),h.tangents(n.t,r.t)}};var y=new a,m=new a,v=new c,g=new c;Narrowphase.prototype.getContacts=function(t,e,n,r,i,o,a){this.contactPointPool=i,this.frictionEquationPool=a,this.result=r,this.frictionResult=o;for(var s=v,c=g,u=y,l=m,p=0,h=t.length;p!==h;p++){var f=t[p],d=e[p],_=null;f.material&&d.material&&(_=n.getContactMaterial(f.material,d.material)||null);for(var b=0;b<f.shapes.length;b++){f.quaternion.mult(f.shapeOrientations[b],s),f.quaternion.vmult(f.shapeOffsets[b],u),u.vadd(f.position,u);for(var w=f.shapes[b],x=0;x<d.shapes.length;x++){d.quaternion.mult(d.shapeOrientations[x],c),d.quaternion.vmult(d.shapeOffsets[x],l),l.vadd(d.position,l);var P=d.shapes[x];if(!(u.distanceTo(l)>w.boundingSphereRadius+P.boundingSphereRadius)){var O=null;w.material&&P.material&&(O=n.getContactMaterial(w.material,P.material)||null),this.currentContactMaterial=O||_||n.defaultContactMaterial;var C=this[w.type|P.type];C&&(w.type<P.type?C.call(this,w,P,u,l,s,c,f,d,w,P):C.call(this,P,w,l,u,c,s,d,f,w,P))}}}}},Narrowphase.prototype[i.types.BOX|i.types.BOX]=Narrowphase.prototype.boxBox=function(t,e,n,r,i,o,a,s){t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,n,r,i,o,a,s,t,e)},Narrowphase.prototype[i.types.BOX|i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.boxConvex=function(t,e,n,r,i,o,a,s){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,n,r,i,o,a,s,t,e)},Narrowphase.prototype[i.types.BOX|i.types.PARTICLE]=Narrowphase.prototype.boxParticle=function(t,e,n,r,i,o,a,s){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,n,r,i,o,a,s,t,e)},Narrowphase.prototype[i.types.SPHERE]=Narrowphase.prototype.sphereSphere=function(t,e,n,r,i,o,a,s){var c=this.createContactEquation(a,s,t,e);r.vsub(n,c.ni),c.ni.normalize(),c.ri.copy(c.ni),c.rj.copy(c.ni),c.ri.mult(t.radius,c.ri),c.rj.mult(-e.radius,c.rj),c.ri.vadd(n,c.ri),c.ri.vsub(a.position,c.ri),c.rj.vadd(r,c.rj),c.rj.vsub(s.position,c.rj),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)};var _=new a,b=new a,w=new a;Narrowphase.prototype[i.types.PLANE|i.types.TRIMESH]=Narrowphase.prototype.planeTrimesh=function(t,e,n,r,i,o,c,u){var l=new a,p=_;p.set(0,0,1),i.vmult(p,p);for(var h=0;h<e.vertices.length/3;h++){e.getVertex(h,l);var f=new a;f.copy(l),s.pointToWorldFrame(r,o,f,l);var d=b;l.vsub(n,d);var y=p.dot(d);if(y<=0){var m=this.createContactEquation(c,u,t,e);m.ni.copy(p);var v=w;p.scale(d.dot(p),v),l.vsub(v,v),m.ri.copy(v),m.ri.vsub(c.position,m.ri),m.rj.copy(l),m.rj.vsub(u.position,m.rj),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}};var x=new a,P=new a,O=(new a,new a),C=new a,S=new a,j=new a,R=new a,T=new a,E=new a,B=new a,A=new a,I=new a,M=new a,z=new r,k=[];Narrowphase.prototype[i.types.SPHERE|i.types.TRIMESH]=Narrowphase.prototype.sphereTrimesh=function(t,e,n,r,i,a,c,u){var l=S,p=j,h=R,f=T,d=E,y=B,m=z,v=C,g=P,_=k;s.pointToLocalFrame(r,a,n,d);var b=t.radius;m.lowerBound.set(d.x-b,d.y-b,d.z-b),m.upperBound.set(d.x+b,d.y+b,d.z+b),e.getTrianglesInAABB(m,_);for(var w=O,D=t.radius*t.radius,F=0;F<_.length;F++)for(var L=0;L<3;L++)if(e.getVertex(e.indices[3*_[F]+L],w),w.vsub(d,g),g.norm2()<=D){v.copy(w),s.pointToWorldFrame(r,a,v,w),w.vsub(n,g);var N=this.createContactEquation(c,u,t,e);N.ni.copy(g),N.ni.normalize(),N.ri.copy(N.ni),N.ri.scale(t.radius,N.ri),N.ri.vadd(n,N.ri),N.ri.vsub(c.position,N.ri),N.rj.copy(w),N.rj.vsub(u.position,N.rj),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult)}for(var F=0;F<_.length;F++)for(var L=0;L<3;L++){e.getVertex(e.indices[3*_[F]+L],l),e.getVertex(e.indices[3*_[F]+(L+1)%3],p),p.vsub(l,h),d.vsub(p,y);var V=y.dot(h);d.vsub(l,y);var U=y.dot(h);if(U>0&&V<0){d.vsub(l,y),f.copy(h),f.normalize(),U=y.dot(f),f.scale(U,y),y.vadd(l,y);var W=y.distanceTo(d);if(W<t.radius){var N=this.createContactEquation(c,u,t,e);y.vsub(d,N.ni),N.ni.normalize(),N.ni.scale(t.radius,N.ri),s.pointToWorldFrame(r,a,y,y),y.vsub(u.position,N.rj),s.vectorToWorldFrame(a,N.ni,N.ni),s.vectorToWorldFrame(a,N.ri,N.ri),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult)}}}for(var q=A,G=I,H=M,K=x,F=0,X=_.length;F!==X;F++){e.getTriangleVertices(_[F],q,G,H),e.getNormal(_[F],K),d.vsub(q,y);var W=y.dot(K);if(K.scale(W,y),d.vsub(y,y),W=y.distanceTo(d),o.pointInTriangle(y,q,G,H)&&W<t.radius){var N=this.createContactEquation(c,u,t,e);y.vsub(d,N.ni),N.ni.normalize(),N.ni.scale(t.radius,N.ri),s.pointToWorldFrame(r,a,y,y),y.vsub(u.position,N.rj),s.vectorToWorldFrame(a,N.ni,N.ni),s.vectorToWorldFrame(a,N.ri,N.ri),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult)}}_.length=0};var D=new a,F=new a;Narrowphase.prototype[i.types.SPHERE|i.types.PLANE]=Narrowphase.prototype.spherePlane=function(t,e,n,r,i,o,a,s){var c=this.createContactEquation(a,s,t,e);if(c.ni.set(0,0,1),o.vmult(c.ni,c.ni),c.ni.negate(c.ni),c.ni.normalize(),c.ni.mult(t.radius,c.ri),n.vsub(r,D),c.ni.mult(c.ni.dot(D),F),D.vsub(F,c.rj),-D.dot(c.ni)<=t.radius){var u=c.ri,l=c.rj;u.vadd(n,u),u.vsub(a.position,u),l.vadd(r,l),l.vsub(s.position,l),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}};var L=new a,N=new a,V=new a;function pointInPolygon(t,e,n){for(var r=null,i=t.length,o=0;o!==i;o++){var a=t[o],s=L;t[(o+1)%i].vsub(a,s);var c=N;s.cross(e,c);var u=V;n.vsub(a,u);var l=c.dot(u);if(!(null===r||l>0&&!0===r||l<=0&&!1===r))return!1;null===r&&(r=l>0)}return!0}var U=new a,W=new a,q=new a,G=new a,H=[new a,new a,new a,new a,new a,new a],K=new a,X=new a,Q=new a,Y=new a;Narrowphase.prototype[i.types.SPHERE|i.types.BOX]=Narrowphase.prototype.sphereBox=function(t,e,n,r,i,o,a,s){var c=this.v3pool,u=H;n.vsub(r,U),e.getSideNormals(u,o);for(var l=t.radius,p=!1,h=X,f=Q,d=Y,y=null,m=0,v=0,g=0,_=null,b=0,w=u.length;b!==w&&!1===p;b++){var x=W;x.copy(u[b]);var P=x.norm();x.normalize();var O=U.dot(x);if(O<P+l&&O>0){var C=q,S=G;C.copy(u[(b+1)%3]),S.copy(u[(b+2)%3]);var j=C.norm(),R=S.norm();C.normalize(),S.normalize();var T=U.dot(C),E=U.dot(S);if(T<j&&T>-j&&E<R&&E>-R){var B=Math.abs(O-P-l);(null===_||B<_)&&(_=B,v=T,g=E,y=P,h.copy(x),f.copy(C),d.copy(S),m++)}}}if(m){p=!0;var A=this.createContactEquation(a,s,t,e);h.mult(-l,A.ri),A.ni.copy(h),A.ni.negate(A.ni),h.mult(y,h),f.mult(v,f),h.vadd(f,h),d.mult(g,d),h.vadd(d,A.rj),A.ri.vadd(n,A.ri),A.ri.vsub(a.position,A.ri),A.rj.vadd(r,A.rj),A.rj.vsub(s.position,A.rj),this.result.push(A),this.createFrictionEquationsFromContact(A,this.frictionResult)}for(var I=c.get(),M=K,z=0;2!==z&&!p;z++)for(var k=0;2!==k&&!p;k++)for(var D=0;2!==D&&!p;D++)if(I.set(0,0,0),z?I.vadd(u[0],I):I.vsub(u[0],I),k?I.vadd(u[1],I):I.vsub(u[1],I),D?I.vadd(u[2],I):I.vsub(u[2],I),r.vadd(I,M),M.vsub(n,M),M.norm2()<l*l){p=!0;var A=this.createContactEquation(a,s,t,e);A.ri.copy(M),A.ri.normalize(),A.ni.copy(A.ri),A.ri.mult(l,A.ri),A.rj.copy(I),A.ri.vadd(n,A.ri),A.ri.vsub(a.position,A.ri),A.rj.vadd(r,A.rj),A.rj.vsub(s.position,A.rj),this.result.push(A),this.createFrictionEquationsFromContact(A,this.frictionResult)}c.release(I),I=null;for(var F=c.get(),L=c.get(),A=c.get(),N=c.get(),B=c.get(),V=u.length,z=0;z!==V&&!p;z++)for(var k=0;k!==V&&!p;k++)if(z%3!=k%3){u[k].cross(u[z],F),F.normalize(),u[z].vadd(u[k],L),A.copy(n),A.vsub(L,A),A.vsub(r,A);var Z=A.dot(F);F.mult(Z,N);for(var D=0;D===z%3||D===k%3;)D++;B.copy(n),B.vsub(N,B),B.vsub(L,B),B.vsub(r,B);var J=Math.abs(Z),$=B.norm();if(J<u[D].norm()&&$<l){p=!0;var tt=this.createContactEquation(a,s,t,e);L.vadd(N,tt.rj),tt.rj.copy(tt.rj),B.negate(tt.ni),tt.ni.normalize(),tt.ri.copy(tt.rj),tt.ri.vadd(r,tt.ri),tt.ri.vsub(n,tt.ri),tt.ri.normalize(),tt.ri.mult(l,tt.ri),tt.ri.vadd(n,tt.ri),tt.ri.vsub(a.position,tt.ri),tt.rj.vadd(r,tt.rj),tt.rj.vsub(s.position,tt.rj),this.result.push(tt),this.createFrictionEquationsFromContact(tt,this.frictionResult)}}c.release(F,L,A,N,B)};var Z=new a,J=new a,$=new a,tt=new a,et=new a,nt=new a,rt=new a,it=new a,ot=new a,at=new a;Narrowphase.prototype[i.types.SPHERE|i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.sphereConvex=function(t,e,n,r,i,o,a,s){var c=this.v3pool;n.vsub(r,Z);for(var u=e.faceNormals,l=e.faces,p=e.vertices,h=t.radius,f=0;f!==p.length;f++){var d=p[f],y=et;o.vmult(d,y),r.vadd(y,y);var m=tt;if(y.vsub(n,m),m.norm2()<h*h){g=!0;var v=this.createContactEquation(a,s,t,e);return v.ri.copy(m),v.ri.normalize(),v.ni.copy(v.ri),v.ri.mult(h,v.ri),y.vsub(r,v.rj),v.ri.vadd(n,v.ri),v.ri.vsub(a.position,v.ri),v.rj.vadd(r,v.rj),v.rj.vsub(s.position,v.rj),this.result.push(v),void this.createFrictionEquationsFromContact(v,this.frictionResult)}}for(var g=!1,f=0,_=l.length;f!==_&&!1===g;f++){var b=u[f],w=l[f],x=nt;o.vmult(b,x);var P=rt;o.vmult(p[w[0]],P),P.vadd(r,P);var O=it;x.mult(-h,O),n.vadd(O,O);var C=ot;O.vsub(P,C);var S=C.dot(x),j=at;if(n.vsub(P,j),S<0&&j.dot(x)>0){for(var R=[],T=0,E=w.length;T!==E;T++){var B=c.get();o.vmult(p[w[T]],B),r.vadd(B,B),R.push(B)}if(pointInPolygon(R,x,n)){g=!0;var v=this.createContactEquation(a,s,t,e);x.mult(-h,v.ri),x.negate(v.ni);var A=c.get();x.mult(-S,A);var I=c.get();x.mult(-h,I),n.vsub(r,v.rj),v.rj.vadd(I,v.rj),v.rj.vadd(A,v.rj),v.rj.vadd(r,v.rj),v.rj.vsub(s.position,v.rj),v.ri.vadd(n,v.ri),v.ri.vsub(a.position,v.ri),c.release(A),c.release(I),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult);for(var T=0,M=R.length;T!==M;T++)c.release(R[T]);return}for(var T=0;T!==w.length;T++){var z=c.get(),k=c.get();o.vmult(p[w[(T+1)%w.length]],z),o.vmult(p[w[(T+2)%w.length]],k),r.vadd(z,z),r.vadd(k,k);var D=J;k.vsub(z,D);var F=$;D.unit(F);var L=c.get(),N=c.get();n.vsub(z,N);var V=N.dot(F);F.mult(V,L),L.vadd(z,L);var U=c.get();if(L.vsub(n,U),V>0&&V*V<D.norm2()&&U.norm2()<h*h){var v=this.createContactEquation(a,s,t,e);L.vsub(r,v.rj),L.vsub(n,v.ni),v.ni.normalize(),v.ni.mult(h,v.ri),v.rj.vadd(r,v.rj),v.rj.vsub(s.position,v.rj),v.ri.vadd(n,v.ri),v.ri.vsub(a.position,v.ri),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult);for(var T=0,M=R.length;T!==M;T++)c.release(R[T]);return c.release(z),c.release(k),c.release(L),c.release(U),void c.release(N)}c.release(z),c.release(k),c.release(L),c.release(U),c.release(N)}for(var T=0,M=R.length;T!==M;T++)c.release(R[T])}}},new a,new a,Narrowphase.prototype[i.types.PLANE|i.types.BOX]=Narrowphase.prototype.planeBox=function(t,e,n,r,i,o,a,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.planeConvex(t,e.convexPolyhedronRepresentation,n,r,i,o,a,s)};var st=new a,ct=new a,ut=new a,lt=new a;Narrowphase.prototype[i.types.PLANE|i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.planeConvex=function(t,e,n,r,i,o,a,s){var c=st,u=ct;u.set(0,0,1),i.vmult(u,u);for(var l=0,p=ut,h=0;h!==e.vertices.length;h++){c.copy(e.vertices[h]),o.vmult(c,c),r.vadd(c,c),c.vsub(n,p);var f=u.dot(p);if(f<=0){var d=this.createContactEquation(a,s,t,e),y=lt;u.mult(u.dot(p),y),c.vsub(y,y),y.vsub(n,d.ri),d.ni.copy(u),c.vsub(r,d.rj),d.ri.vadd(n,d.ri),d.ri.vsub(a.position,d.ri),d.rj.vadd(r,d.rj),d.rj.vsub(s.position,d.rj),this.result.push(d),l++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(d,this.frictionResult)}}this.enableFrictionReduction&&l&&this.createFrictionFromAverage(l)};var pt=new a,ht=new a;Narrowphase.prototype[i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.convexConvex=function(t,e,n,r,i,o,a,s,c,u,l,p){var h=pt;if(!(n.distanceTo(r)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,n,i,r,o,h,l,p)){var f=[],d=ht;t.clipAgainstHull(n,i,e,r,o,h,-100,100,f);for(var y=0,m=0;m!==f.length;m++){var v=this.createContactEquation(a,s,t,e,c,u),g=v.ri,_=v.rj;h.negate(v.ni),f[m].normal.negate(d),d.mult(f[m].depth,d),f[m].point.vadd(d,g),_.copy(f[m].point),g.vsub(n,g),_.vsub(r,_),g.vadd(n,g),g.vsub(a.position,g),_.vadd(r,_),_.vsub(s.position,_),this.result.push(v),y++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(v,this.frictionResult)}this.enableFrictionReduction&&y&&this.createFrictionFromAverage(y)}};var ft=new a,dt=new a,yt=new a;Narrowphase.prototype[i.types.PLANE|i.types.PARTICLE]=Narrowphase.prototype.planeParticle=function(t,e,n,r,i,o,a,s){var c=ft;c.set(0,0,1),a.quaternion.vmult(c,c);var u=dt;r.vsub(a.position,u);var l=c.dot(u);if(l<=0){var p=this.createContactEquation(s,a,e,t);p.ni.copy(c),p.ni.negate(p.ni),p.ri.set(0,0,0);var h=yt;c.mult(c.dot(r),h),r.vsub(h,h),p.rj.copy(h),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}};var mt=new a;Narrowphase.prototype[i.types.PARTICLE|i.types.SPHERE]=Narrowphase.prototype.sphereParticle=function(t,e,n,r,i,o,a,s){var c=mt;c.set(0,0,1),r.vsub(n,c);var u=c.norm2();if(u<=t.radius*t.radius){var l=this.createContactEquation(s,a,e,t);c.normalize(),l.rj.copy(c),l.rj.mult(t.radius,l.rj),l.ni.copy(c),l.ni.negate(l.ni),l.ri.set(0,0,0),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)}};var vt=new c,gt=new a,_t=(new a,new a),bt=new a,wt=new a;Narrowphase.prototype[i.types.PARTICLE|i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.convexParticle=function(t,e,n,r,i,o,a,s){var c=-1,u=_t,l=wt,p=null,h=gt;if(h.copy(r),h.vsub(n,h),i.conjugate(vt),vt.vmult(h,h),t.pointIsInside(h)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(n,i),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(i);for(var f=0,d=t.faces.length;f!==d;f++){var y=[t.worldVertices[t.faces[f][0]]],m=t.worldFaceNormals[f];r.vsub(y[0],bt);var v=-m.dot(bt);(null===p||Math.abs(v)<Math.abs(p))&&(p=v,c=f,u.copy(m))}if(-1!==c){var g=this.createContactEquation(s,a,e,t);u.mult(p,l),l.vadd(r,l),l.vsub(n,l),g.rj.copy(l),u.negate(g.ni),g.ri.set(0,0,0);var _=g.ri,b=g.rj;_.vadd(r,_),_.vsub(s.position,_),b.vadd(n,b),b.vsub(a.position,b),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},Narrowphase.prototype[i.types.BOX|i.types.HEIGHTFIELD]=Narrowphase.prototype.boxHeightfield=function(t,e,n,r,i,o,a,s){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,n,r,i,o,a,s)};var xt=new a,Pt=new a,Ot=[0];Narrowphase.prototype[i.types.CONVEXPOLYHEDRON|i.types.HEIGHTFIELD]=Narrowphase.prototype.convexHeightfield=function(t,e,n,r,i,o,a,c){var u=e.data,l=e.elementSize,p=t.boundingSphereRadius,h=Pt,f=Ot,d=xt;s.pointToLocalFrame(r,o,n,d);var y=Math.floor((d.x-p)/l)-1,m=Math.ceil((d.x+p)/l)+1,v=Math.floor((d.y-p)/l)-1,g=Math.ceil((d.y+p)/l)+1;if(!(m<0||g<0||y>u.length||v>u[0].length)){y<0&&(y=0),m<0&&(m=0),v<0&&(v=0),g<0&&(g=0),y>=u.length&&(y=u.length-1),m>=u.length&&(m=u.length-1),g>=u[0].length&&(g=u[0].length-1),v>=u[0].length&&(v=u[0].length-1);var _=[];e.getRectMinMax(y,v,m,g,_);var b=_[0],w=_[1];if(!(d.z-p>w||d.z+p<b))for(var x=y;x<m;x++)for(var P=v;P<g;P++)e.getConvexTrianglePillar(x,P,!1),s.pointToWorldFrame(r,o,e.pillarOffset,h),n.distanceTo(h)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,n,h,i,o,a,c,null,null,f,null),e.getConvexTrianglePillar(x,P,!0),s.pointToWorldFrame(r,o,e.pillarOffset,h),n.distanceTo(h)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,n,h,i,o,a,c,null,null,f,null)}};var Ct=new a,St=new a;Narrowphase.prototype[i.types.SPHERE|i.types.HEIGHTFIELD]=Narrowphase.prototype.sphereHeightfield=function(t,e,n,r,i,o,a,c){var u=e.data,l=t.radius,p=e.elementSize,h=St,f=Ct;s.pointToLocalFrame(r,o,n,f);var d=Math.floor((f.x-l)/p)-1,y=Math.ceil((f.x+l)/p)+1,m=Math.floor((f.y-l)/p)-1,v=Math.ceil((f.y+l)/p)+1;if(!(y<0||v<0||d>u.length||v>u[0].length)){d<0&&(d=0),y<0&&(y=0),m<0&&(m=0),v<0&&(v=0),d>=u.length&&(d=u.length-1),y>=u.length&&(y=u.length-1),v>=u[0].length&&(v=u[0].length-1),m>=u[0].length&&(m=u[0].length-1);var g=[];e.getRectMinMax(d,m,y,v,g);var _=g[0],b=g[1];if(!(f.z-l>b||f.z+l<_))for(var w=this.result,x=d;x<y;x++)for(var P=m;P<v;P++){var O=w.length;e.getConvexTrianglePillar(x,P,!1),s.pointToWorldFrame(r,o,e.pillarOffset,h),n.distanceTo(h)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,n,h,i,o,a,c),e.getConvexTrianglePillar(x,P,!0),s.pointToWorldFrame(r,o,e.pillarOffset,h),n.distanceTo(h)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,n,h,i,o,a,c);var C=w.length-O;if(C>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,e,n){e.exports=World;var r=t("../shapes/Shape"),i=t("../math/Vec3"),o=t("../math/Quaternion"),a=t("../solver/GSSolver"),s=(t("../utils/Vec3Pool"),t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("./Narrowphase")),c=t("../utils/EventTarget"),u=t("../collision/ArrayCollisionMatrix"),l=t("../material/Material"),p=t("../material/ContactMaterial"),h=t("../objects/Body"),f=t("../utils/TupleDictionary"),d=t("../collision/RaycastResult"),y=t("../collision/AABB"),m=t("../collision/Ray"),v=t("../collision/NaiveBroadphase");function World(){c.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new i,this.broadphase=new v,this.bodies=[],this.solver=new a,this.constraints=[],this.narrowphase=new s(this),this.collisionMatrix=new u,this.collisionMatrixPrevious=new u,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new f,this.defaultMaterial=new l("default"),this.defaultContactMaterial=new p(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}World.prototype=new c,new y;var g=new m;if(World.prototype.getContactMaterial=function(t,e){return this.contactMaterialTable.get(t.id,e.id)},World.prototype.numObjects=function(){return this.bodies.length},World.prototype.collisionMatrixTick=function(){var t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset()},World.prototype.add=World.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof h&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.dispatchEvent(this.addBodyEvent))},World.prototype.addConstraint=function(t){this.constraints.push(t)},World.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)},World.prototype.rayTest=function(t,e,n){n instanceof d?this.raycastClosest(t,e,{skipBackfaces:!0},n):this.raycastAll(t,e,{skipBackfaces:!0},n)},World.prototype.raycastAll=function(t,e,n,r){return n.mode=m.ALL,n.from=t,n.to=e,n.callback=r,g.intersectWorld(this,n)},World.prototype.raycastAny=function(t,e,n,r){return n.mode=m.ANY,n.from=t,n.to=e,n.result=r,g.intersectWorld(this,n)},World.prototype.raycastClosest=function(t,e,n,r){return n.mode=m.CLOSEST,n.from=t,n.to=e,n.result=r,g.intersectWorld(this,n)},World.prototype.remove=function(t){t.world=null;var e=this.bodies.length-1,n=this.bodies,r=n.indexOf(t);if(-1!==r){n.splice(r,1);for(var i=0;i!==n.length;i++)n[i].index=i;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,this.dispatchEvent(this.removeBodyEvent)}},World.prototype.removeBody=World.prototype.remove,World.prototype.addMaterial=function(t){this.materials.push(t)},World.prototype.addContactMaterial=function(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)},"undefined"==typeof performance&&(performance={}),!performance.now){var _=Date.now();performance.timing&&performance.timing.navigationStart&&(_=performance.timing.navigationStart),performance.now=function(){return Date.now()-_}}var b=new i;World.prototype.step=function(t,e,n){if(n=n||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{var r=Math.floor((this.time+e)/t)-Math.floor(this.time/t);r=Math.min(r,n);for(var i=performance.now(),o=0;o!==r&&(this.internalStep(t),!(performance.now()-i>1e3*t));o++);this.time+=e;for(var a=this.time%t,s=a/t,c=b,u=this.bodies,l=0;l!==u.length;l++){var p=u[l];p.type!==h.STATIC&&p.sleepState!==h.SLEEPING?(p.position.vsub(p.previousPosition,c),c.scale(s,c),p.position.vadd(c,p.interpolatedPosition)):(p.interpolatedPosition.copy(p.position),p.interpolatedQuaternion.copy(p.quaternion))}}};var w={type:"postStep"},x={type:"preStep"},P={type:"collide",body:null,contact:null},O=[],C=[],S=[],j=[],R=(new i,new i,new i,new i,new i,new i,new i,new i,new i,new o,new o),T=new o,E=new i;World.prototype.internalStep=function(t){this.dt=t;var e,n=this.contacts,i=S,o=j,a=this.numObjects(),s=this.bodies,c=this.solver,u=this.gravity,l=this.doProfiling,p=this.profile,f=h.DYNAMIC,d=this.constraints,y=C,m=(u.norm(),u.x),v=u.y,g=u.z,_=0;for(l&&(e=performance.now()),_=0;_!==a;_++){var b=s[_];if(b.type&f){var B=b.force,A=b.mass;B.x+=A*m,B.y+=A*v,B.z+=A*g}}for(var _=0,I=this.subsystems.length;_!==I;_++)this.subsystems[_].update();l&&(e=performance.now()),i.length=0,o.length=0,this.broadphase.collisionPairs(this,i,o),l&&(p.broadphase=performance.now()-e);var M=d.length;for(_=0;_!==M;_++){var z=d[_];if(!z.collideConnected)for(var k=i.length-1;k>=0;k-=1)(z.bodyA===i[k]&&z.bodyB===o[k]||z.bodyB===i[k]&&z.bodyA===o[k])&&(i.splice(k,1),o.splice(k,1))}this.collisionMatrixTick(),l&&(e=performance.now());var D=O,F=n.length;for(_=0;_!==F;_++)D.push(n[_]);n.length=0;var L=this.frictionEquations.length;for(_=0;_!==L;_++)y.push(this.frictionEquations[_]);this.frictionEquations.length=0,this.narrowphase.getContacts(i,o,this,n,D,this.frictionEquations,y),l&&(p.narrowphase=performance.now()-e),l&&(e=performance.now());for(var _=0;_<this.frictionEquations.length;_++)c.addEquation(this.frictionEquations[_]);for(var N=n.length,V=0;V!==N;V++){var z=n[V],b=z.bi,U=z.bj;if(z.si,z.sj,(b.material&&U.material&&this.getContactMaterial(b.material,U.material)||this.defaultContactMaterial).friction,b.material&&U.material&&(b.material.friction>=0&&U.material.friction>=0&&(b.material.friction,U.material.friction),b.material.restitution>=0&&U.material.restitution>=0&&(z.restitution=b.material.restitution*U.material.restitution)),c.addEquation(z),b.allowSleep&&b.type===h.DYNAMIC&&b.sleepState===h.SLEEPING&&U.sleepState===h.AWAKE&&U.type!==h.STATIC){var W=U.velocity.norm2()+U.angularVelocity.norm2(),q=Math.pow(U.sleepSpeedLimit,2);W>=2*q&&(b._wakeUpAfterNarrowphase=!0)}if(U.allowSleep&&U.type===h.DYNAMIC&&U.sleepState===h.SLEEPING&&b.sleepState===h.AWAKE&&b.type!==h.STATIC){var G=b.velocity.norm2()+b.angularVelocity.norm2(),H=Math.pow(b.sleepSpeedLimit,2);G>=2*H&&(U._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(b,U,!0),this.collisionMatrixPrevious.get(b,U)||(P.body=U,P.contact=z,b.dispatchEvent(P),P.body=b,U.dispatchEvent(P))}for(l&&(p.makeContactConstraints=performance.now()-e,e=performance.now()),_=0;_!==a;_++){var b=s[_];b._wakeUpAfterNarrowphase&&(b.wakeUp(),b._wakeUpAfterNarrowphase=!1)}var M=d.length;for(_=0;_!==M;_++){var z=d[_];z.update();for(var k=0,K=z.equations.length;k!==K;k++){var X=z.equations[k];c.addEquation(X)}}c.solve(t,this),l&&(p.solve=performance.now()-e),c.removeAllEquations();var Q=Math.pow;for(_=0;_!==a;_++){var b=s[_];if(b.type&f){var Y=Q(1-b.linearDamping,t),Z=b.velocity;Z.mult(Y,Z);var J=b.angularVelocity;if(J){var $=Q(1-b.angularDamping,t);J.mult($,J)}}}for(this.dispatchEvent(x),_=0;_!==a;_++){var b=s[_];b.preStep&&b.preStep.call(b)}l&&(e=performance.now());var tt=R,et=T,nt=this.stepnumber,rt=h.DYNAMIC|h.KINEMATIC,it=nt%(this.quatNormalizeSkip+1)==0,ot=this.quatNormalizeFast,at=.5*t;for(r.types.PLANE,r.types.CONVEXPOLYHEDRON,_=0;_!==a;_++){var st=s[_],ct=st.force,ut=st.torque;if(st.type&rt&&st.sleepState!==h.SLEEPING){var lt=st.velocity,pt=st.angularVelocity,ht=st.position,ft=st.quaternion,dt=st.invMass,yt=st.invInertiaWorld;lt.x+=ct.x*dt*t,lt.y+=ct.y*dt*t,lt.z+=ct.z*dt*t,st.angularVelocity&&(yt.vmult(ut,E),E.mult(t,E),E.vadd(pt,pt)),ht.x+=lt.x*t,ht.y+=lt.y*t,ht.z+=lt.z*t,st.angularVelocity&&(tt.set(pt.x,pt.y,pt.z,0),tt.mult(ft,et),ft.x+=at*et.x,ft.y+=at*et.y,ft.z+=at*et.z,ft.w+=at*et.w,it&&(ot?ft.normalizeFast():ft.normalize())),st.aabb&&(st.aabbNeedsUpdate=!0),st.updateInertiaWorld&&st.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,l&&(p.integrate=performance.now()-e),this.time+=t,this.stepnumber+=1,this.dispatchEvent(w),_=0;_!==a;_++){var b=s[_],mt=b.postStep;mt&&mt.call(b)}if(this.allowSleep)for(_=0;_!==a;_++)s[_].sleepTick(this.time)},World.prototype.clearForces=function(){for(var t=this.bodies,e=t.length,n=0;n!==e;n++){var r=t[n];r.force,r.torque,r.force.set(0,0,0),r.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)},function(t,e,n){"use strict";function GenericWorker(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}GenericWorker.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var n=0;n<this._listeners[t].length;n++)this._listeners[t][n].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var t=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},t.exports=GenericWorker},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";(function(t){if(e.base64=!0,e.array=!0,e.string=!0,e.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,e.nodebuffer=void 0!==t,e.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)e.blob=!1;else{var r=new ArrayBuffer(0);try{e.blob=0===new Blob([r],{type:"application/zip"}).size}catch(t){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(r),e.blob=0===i.getBlob("application/zip").size}catch(t){e.blob=!1}}}try{e.nodestream=!!n(32).Readable}catch(t){e.nodestream=!1}}).call(this,n(8).Buffer)},function(t,e,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function _has(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var n=e.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var r in n)_has(n,r)&&(t[r]=n[r])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var i={arraySet:function(t,e,n,r,i){if(e.subarray&&t.subarray)t.set(e.subarray(n,n+r),i);else for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){var e,n,r,i,o,a;for(r=0,e=0,n=t.length;e<n;e++)r+=t[e].length;for(a=new Uint8Array(r),i=0,e=0,n=t.length;e<n;e++)o=t[e],a.set(o,i),i+=o.length;return a}},o={arraySet:function(t,e,n,r,i){for(var o=0;o<r;o++)t[i+o]=e[n+o]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,i)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,o))},e.setTyped(r)},function(t,e,n){"use strict";var r=n(16),i=Object.keys||function(t){var e=[];for(var n in t)e.push(n);return e};t.exports=Duplex;var o=n(12);o.inherits=n(10);var a=n(33),s=n(24);o.inherits(Duplex,a);for(var c=i(s.prototype),u=0;u<c.length;u++){var l=c[u];Duplex.prototype[l]||(Duplex.prototype[l]=s.prototype[l])}function Duplex(t){if(!(this instanceof Duplex))return new Duplex(t);a.call(this,t),s.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||r.nextTick(onEndNT,this)}function onEndNT(t){t.end()}Object.defineProperty(Duplex.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),Duplex.prototype._destroy=function(t,e){this.push(null),this.end(),r.nextTick(e,t)}},function(t,e,n){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var r=n(62),i=n(63),o=n(64);function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(t,e){if(kMaxLength()<e)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=Buffer.prototype:(null===t&&(t=new Buffer(e)),t.length=e),t}function Buffer(t,e,n){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,t)}return from(this,t,e,n)}function from(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function fromArrayBuffer(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);Buffer.TYPED_ARRAY_SUPPORT?(t=e).__proto__=Buffer.prototype:t=fromArrayLike(t,e);return t}(t,e,n,r):"string"==typeof e?function fromString(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!Buffer.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|byteLength(e,n),i=(t=createBuffer(t,r)).write(e,n);i!==r&&(t=t.slice(0,i));return t}(t,e,n):function fromObject(t,e){if(Buffer.isBuffer(e)){var n=0|checked(e.length);return 0===(t=createBuffer(t,n)).length?t:(e.copy(t,0,0,n),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function isnan(t){return t!=t}(e.length)?createBuffer(t,0):fromArrayLike(t,e);if("Buffer"===e.type&&o(e.data))return fromArrayLike(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function assertSize(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(t,e){if(assertSize(e),t=createBuffer(t,e<0?0:0|checked(e)),!Buffer.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function fromArrayLike(t,e){var n=e.length<0?0:0|checked(e.length);t=createBuffer(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function checked(t){if(t>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function byteLength(t,e){if(Buffer.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return base64ToBytes(t).length;default:if(r)return utf8ToBytes(t).length;e=(""+e).toLowerCase(),r=!0}}function swap(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function bidirectionalIndexOf(t,e,n,r,i){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof e&&(e=Buffer.from(e,r)),Buffer.isBuffer(e))return 0===e.length?-1:arrayIndexOf(t,e,n,r,i);if("number"==typeof e)return e&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):arrayIndexOf(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,e,n,r,i){var o,a=1,s=t.length,c=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;a=2,s/=2,c/=2,n/=2}function read(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var u=-1;for(o=n;o<s;o++)if(read(t,o)===read(e,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===c)return u*a}else-1!==u&&(o-=o-u),u=-1}else for(n+c>s&&(n=s-c),o=n;o>=0;o--){for(var l=!0,p=0;p<c;p++)if(read(t,o+p)!==read(e,p)){l=!1;break}if(l)return o}return-1}function hexWrite(t,e,n,r){n=Number(n)||0;var i=t.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var a=0;a<r;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[n+a]=s}return a}function utf8Write(t,e,n,r){return blitBuffer(utf8ToBytes(e,t.length-n),t,n,r)}function asciiWrite(t,e,n,r){return blitBuffer(function asciiToBytes(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function latin1Write(t,e,n,r){return asciiWrite(t,e,n,r)}function base64Write(t,e,n,r){return blitBuffer(base64ToBytes(e),t,n,r)}function ucs2Write(t,e,n,r){return blitBuffer(function utf16leToBytes(t,e){for(var n,r,i,o=[],a=0;a<t.length&&!((e-=2)<0);++a)n=t.charCodeAt(a),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(e,t.length-n),t,n,r)}function base64Slice(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function utf8Slice(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,s,c,u,l=t[i],p=null,h=l>239?4:l>223?3:l>191?2:1;if(i+h<=n)switch(h){case 1:l<128&&(p=l);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&l)<<6|63&o)>127&&(p=u);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(u=(15&l)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(p=u);break;case 4:o=t[i+1],s=t[i+2],c=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&c)&&(u=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&c)>65535&&u<1114112&&(p=u)}null===p?(p=65533,h=1):p>65535&&(p-=65536,r.push(p>>>10&1023|55296),p=56320|1023&p),r.push(p),i+=h}return function decodeCodePointsArray(t){var e=t.length;if(e<=a)return String.fromCharCode.apply(String,t);var n="",r=0;for(;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=a));return n}(r)}e.Buffer=Buffer,e.SlowBuffer=function SlowBuffer(t){+t!=t&&(t=0);return Buffer.alloc(+t)},e.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function typedArraySupport(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.from=function(t,e,n){return from(null,t,e,n)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(t,e,n){return function alloc(t,e,n,r){return assertSize(e),e<=0?createBuffer(t,e):void 0!==n?"string"==typeof r?createBuffer(t,e).fill(n,r):createBuffer(t,e).fill(n):createBuffer(t,e)}(null,t,e,n)},Buffer.allocUnsafe=function(t){return allocUnsafe(null,t)},Buffer.allocUnsafeSlow=function(t){return allocUnsafe(null,t)},Buffer.isBuffer=function isBuffer(t){return!(null==t||!t._isBuffer)},Buffer.compare=function compare(t,e){if(!Buffer.isBuffer(t)||!Buffer.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,i=0,o=Math.min(n,r);i<o;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},Buffer.isEncoding=function isEncoding(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=Buffer.allocUnsafe(e),i=0;for(n=0;n<t.length;++n){var a=t[n];if(!Buffer.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)swap(this,e,e+1);return this},Buffer.prototype.swap32=function swap32(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)swap(this,e,e+3),swap(this,e+1,e+2);return this},Buffer.prototype.swap64=function swap64(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)swap(this,e,e+7),swap(this,e+1,e+6),swap(this,e+2,e+5),swap(this,e+3,e+4);return this},Buffer.prototype.toString=function toString(){var t=0|this.length;return 0===t?"":0===arguments.length?utf8Slice(this,0,t):function slowToString(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return hexSlice(this,e,n);case"utf8":case"utf-8":return utf8Slice(this,e,n);case"ascii":return asciiSlice(this,e,n);case"latin1":case"binary":return latin1Slice(this,e,n);case"base64":return base64Slice(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},Buffer.prototype.equals=function equals(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t)},Buffer.prototype.inspect=function inspect(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function compare(t,e,n,r,i){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(e>>>=0),s=Math.min(o,a),c=this.slice(r,i),u=t.slice(e,n),l=0;l<s;++l)if(c[l]!==u[l]){o=c[l],a=u[l];break}return o<a?-1:a<o?1:0},Buffer.prototype.includes=function includes(t,e,n){return-1!==this.indexOf(t,e,n)},Buffer.prototype.indexOf=function indexOf(t,e,n){return bidirectionalIndexOf(this,t,e,n,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(t,e,n){return bidirectionalIndexOf(this,t,e,n,!1)},Buffer.prototype.write=function write(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return hexWrite(this,t,e,n);case"utf8":case"utf-8":return utf8Write(this,t,e,n);case"ascii":return asciiWrite(this,t,e,n);case"latin1":case"binary":return latin1Write(this,t,e,n);case"base64":return base64Write(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,e,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var a=4096;function asciiSlice(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function latin1Slice(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function hexSlice(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=e;o<n;++o)i+=toHex(t[o]);return i}function utf16leSlice(t,e,n){for(var r=t.slice(e,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function checkOffset(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,e,n,r,i,o){if(!Buffer.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function objectWriteUInt16(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function objectWriteUInt32(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function checkIEEE754(t,e,n,r,i,o){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function writeFloat(t,e,n,r,o){return o||checkIEEE754(t,0,n,4),i.write(t,e,n,r,23,4),n+4}function writeDouble(t,e,n,r,o){return o||checkIEEE754(t,0,n,8),i.write(t,e,n,r,52,8),n+8}Buffer.prototype.slice=function slice(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),Buffer.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=Buffer.prototype;else{var i=e-t;n=new Buffer(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+t]}return n},Buffer.prototype.readUIntLE=function readUIntLE(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r},Buffer.prototype.readUIntBE=function readUIntBE(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var r=this[t+--e],i=1;e>0&&(i*=256);)r+=this[t+--e]*i;return r},Buffer.prototype.readUInt8=function readUInt8(t,e){return e||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function readUInt16LE(t,e){return e||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(t,e){return e||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(t,e){return e||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(t,e){return e||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function readIntLE(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var r=this[t],i=1,o=0;++o<e&&(i*=256);)r+=this[t+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*e)),r},Buffer.prototype.readIntBE=function readIntBE(t,e,n){t|=0,e|=0,n||checkOffset(t,e,this.length);for(var r=e,i=1,o=this[t+--r];r>0&&(i*=256);)o+=this[t+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},Buffer.prototype.readInt8=function readInt8(t,e){return e||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function readInt16LE(t,e){e||checkOffset(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},Buffer.prototype.readInt16BE=function readInt16BE(t,e){e||checkOffset(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},Buffer.prototype.readInt32LE=function readInt32LE(t,e){return e||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(t,e){return e||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function readFloatLE(t,e){return e||checkOffset(t,4,this.length),i.read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(t,e){return e||checkOffset(t,4,this.length),i.read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(t,e){return e||checkOffset(t,8,this.length),i.read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(t,e){return e||checkOffset(t,8,this.length),i.read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(t,e,n,r){(t=+t,e|=0,n|=0,r)||checkInt(this,t,e,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[e]=255&t;++o<n&&(i*=256);)this[e+o]=t/i&255;return e+n},Buffer.prototype.writeUIntBE=function writeUIntBE(t,e,n,r){(t=+t,e|=0,n|=0,r)||checkInt(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},Buffer.prototype.writeUInt8=function writeUInt8(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeIntLE=function writeIntLE(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);checkInt(this,t,e,n,i-1,-i)}var o=0,a=1,s=0;for(this[e]=255&t;++o<n&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+n},Buffer.prototype.writeIntBE=function writeIntBE(t,e,n,r){if(t=+t,e|=0,!r){var i=Math.pow(2,8*n-1);checkInt(this,t,e,n,i-1,-i)}var o=n-1,a=1,s=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+n},Buffer.prototype.writeInt8=function writeInt8(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},Buffer.prototype.writeInt16LE=function writeInt16LE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeInt16BE=function writeInt16BE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeInt32LE=function writeInt32LE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeInt32BE=function writeInt32BE(t,e,n){return t=+t,e|=0,n||checkInt(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeFloatLE=function writeFloatLE(t,e,n){return writeFloat(this,t,e,!0,n)},Buffer.prototype.writeFloatBE=function writeFloatBE(t,e,n){return writeFloat(this,t,e,!1,n)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(t,e,n){return writeDouble(this,t,e,!0,n)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(t,e,n){return writeDouble(this,t,e,!1,n)},Buffer.prototype.copy=function copy(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},Buffer.prototype.fill=function fill(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!Buffer.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var o;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(o=e;o<n;++o)this[o]=t;else{var a=Buffer.isBuffer(t)?t:utf8ToBytes(new Buffer(t,r).toString()),s=a.length;for(o=0;o<n-e;++o)this[o+e]=a[o%s]}return this};var s=/[^+\/0-9A-Za-z-_]/g;function toHex(t){return t<16?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t,e){var n;e=e||1/0;for(var r=t.length,i=null,o=[],a=0;a<r;++a){if((n=t.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===r){(e-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;o.push(n)}else if(n<2048){if((e-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function base64ToBytes(t){return r.toByteArray(function base64clean(t){if((t=function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(s,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function blitBuffer(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}}).call(this,n(4))},function(t,e,n){"use strict";for(var r=n(1),i=n(5),o=n(18),a=n(3),s=new Array(256),c=0;c<256;c++)s[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;s[254]=s[254]=1;function Utf8DecodeWorker(){a.call(this,"utf-8 decode"),this.leftOver=null}function Utf8EncodeWorker(){a.call(this,"utf-8 encode")}e.utf8encode=function utf8encode(t){return i.nodebuffer?o.newBufferFrom(t,"utf-8"):function(t){var e,n,r,o,a,s=t.length,c=0;for(o=0;o<s;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),c+=n<128?1:n<2048?2:n<65536?3:4;for(e=i.uint8array?new Uint8Array(c):new Array(c),a=0,o=0;a<c;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e}(t)},e.utf8decode=function utf8decode(t){return i.nodebuffer?r.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,n,i,o,a=t.length,c=new Array(2*a);for(n=0,e=0;e<a;)if((i=t[e++])<128)c[n++]=i;else if((o=s[i])>4)c[n++]=65533,e+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&e<a;)i=i<<6|63&t[e++],o--;o>1?c[n++]=65533:i<65536?c[n++]=i:(i-=65536,c[n++]=55296|i>>10&1023,c[n++]=56320|1023&i)}return c.length!==n&&(c.subarray?c=c.subarray(0,n):c.length=n),r.applyFromCharCode(c)}(t=r.transformTo(i.uint8array?"uint8array":"array",t))},r.inherits(Utf8DecodeWorker,a),Utf8DecodeWorker.prototype.processChunk=function(t){var n=r.transformTo(i.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var o=n;(n=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),n.set(o,this.leftOver.length)}else n=this.leftOver.concat(n);this.leftOver=null}var a=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0?e:0===n?e:n+s[t[n]]>e?n:e}(n),c=n;a!==n.length&&(i.uint8array?(c=n.subarray(0,a),this.leftOver=n.subarray(a,n.length)):(c=n.slice(0,a),this.leftOver=n.slice(a,n.length))),this.push({data:e.utf8decode(c),meta:t.meta})},Utf8DecodeWorker.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:e.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},e.Utf8DecodeWorker=Utf8DecodeWorker,r.inherits(Utf8EncodeWorker,a),Utf8EncodeWorker.prototype.processChunk=function(t){this.push({data:e.utf8encode(t.data),meta:t.meta})},e.Utf8EncodeWorker=Utf8EncodeWorker},function(t,e){"function"==typeof Object.create?t.exports=function inherits(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function inherits(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}},function(t,e){var n,r,i=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(n===setTimeout)return setTimeout(t,0);if((n===defaultSetTimout||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){n=defaultSetTimout}try{r="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){r=defaultClearTimeout}}();var o,a=[],s=!1,c=-1;function cleanUpNextTick(){s&&o&&(s=!1,o.length?a=o.concat(a):c=-1,a.length&&drainQueue())}function drainQueue(){if(!s){var t=runTimeout(cleanUpNextTick);s=!0;for(var e=a.length;e;){for(o=a,a=[];++c<e;)o&&o[c].run();c=-1,e=a.length}o=null,s=!1,function runClearTimeout(t){if(r===clearTimeout)return clearTimeout(t);if((r===defaultClearTimeout||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{return r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function Item(t,e){this.fun=t,this.array=e}function noop(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];a.push(new Item(t,e)),1!==a.length||s||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=noop,i.addListener=noop,i.once=noop,i.off=noop,i.removeListener=noop,i.removeAllListeners=noop,i.emit=noop,i.prependListener=noop,i.prependOnceListener=noop,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,n){(function(t){function objectToString(t){return Object.prototype.toString.call(t)}e.isArray=function isArray(t){return Array.isArray?Array.isArray(t):"[object Array]"===objectToString(t)},e.isBoolean=function isBoolean(t){return"boolean"==typeof t},e.isNull=function isNull(t){return null===t},e.isNullOrUndefined=function isNullOrUndefined(t){return null==t},e.isNumber=function isNumber(t){return"number"==typeof t},e.isString=function isString(t){return"string"==typeof t},e.isSymbol=function isSymbol(t){return"symbol"==typeof t},e.isUndefined=function isUndefined(t){return void 0===t},e.isRegExp=function isRegExp(t){return"[object RegExp]"===objectToString(t)},e.isObject=function isObject(t){return"object"==typeof t&&null!==t},e.isDate=function isDate(t){return"[object Date]"===objectToString(t)},e.isError=function isError(t){return"[object Error]"===objectToString(t)||t instanceof Error},e.isFunction=function isFunction(t){return"function"==typeof t},e.isPrimitive=function isPrimitive(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=t.isBuffer}).call(this,n(8).Buffer)},function(t,e,n){"use strict";var r=null;r="undefined"!=typeof Promise?Promise:n(79),t.exports={Promise:r}},function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return r});var r=function(){function NativeU8Array(e){if(e){var n=t.from(e,"base64");this.array=new Uint8Array(n)}}return Object.defineProperty(NativeU8Array.prototype,"length",{set:function(t){this.array&&t===this.array.length||(this.array=new Uint8Array(t))},enumerable:!0,configurable:!0}),NativeU8Array.prototype.serialize=function(){if(this.array)return t.from(this.array.buffer).toString("base64")},NativeU8Array}()}).call(this,n(8).Buffer)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function BaseEvent(){}return BaseEvent.prototype.attach=function(t,e){this._attach(t,e,!1)},BaseEvent.prototype.once=function(t,e){this._attach(t,e,!0)},BaseEvent.prototype._attach=function(t,e,n){var r,i,o;if("function"==typeof t)i=t;else if(e||"function"!=typeof t.post){if("object"!=typeof t)throw new Error("Expect a function or object as first argument");if("function"!=typeof e)throw new Error("Expect a function as second argument");r=t,i=e}else o=t;this._listeners?this._listeners=this._listeners.slice():this._listeners=[],this._listeners.push({deleted:!1,boundTo:r,handler:i,event:o,once:n})},BaseEvent.prototype.detach=function(){for(var t,e,n,r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];this._listeners&&0!==this._listeners.length&&(r.length>=1&&("function"==typeof r[0]?e=r[0]:1===r.length&&"function"==typeof r[0].post?n=r[0]:t=r[0]),r.length>=2&&(e=r[1]),this._listeners=this._listeners.filter(function(r){return void 0!==e&&r.handler!==e||void 0!==n&&r.event!==n||void 0!==t&&r.boundTo!==t||(r.deleted=!0,!1)}),0===this._listeners.length&&delete this._listeners)},BaseEvent.prototype.post=function(t){throw new Error("abstract")},BaseEvent.prototype.listenerCount=function(){return this._listeners?this._listeners.length:0},BaseEvent.prototype._call=function(t,e){t.deleted||(t.once&&(t.deleted=!0,this._listeners=this._listeners.filter(function(e){return e!==t}),0===this._listeners.length&&delete this._listeners),t.event?t.event.post.apply(t.event,e):t.handler.apply("object"==typeof t.boundTo?t.boundTo:this,e))},BaseEvent}();e.BaseEvent=r},function(t,e,n){"use strict";(function(e){!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function nextTick(t,n,r,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,a,s=arguments.length;switch(s){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function afterTickOne(){t.call(null,n)});case 3:return e.nextTick(function afterTickTwo(){t.call(null,n,r)});case 4:return e.nextTick(function afterTickThree(){t.call(null,n,r,i)});default:for(o=new Array(s-1),a=0;a<o.length;)o[a++]=arguments[a];return e.nextTick(function afterTick(){t.apply(null,o)})}}}:t.exports=e}).call(this,n(11))},function(t,e,n){var r=n(8),i=r.Buffer;function copyProps(t,e){for(var n in t)e[n]=t[n]}function SafeBuffer(t,e,n){return i(t,e,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(copyProps(r,e),e.Buffer=SafeBuffer),copyProps(i,SafeBuffer),SafeBuffer.from=function(t,e,n){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,n)},SafeBuffer.alloc=function(t,e,n){if("number"!=typeof t)throw new TypeError("Argument must be a number");var r=i(t);return void 0!==e?"string"==typeof n?r.fill(e,n):r.fill(e):r.fill(0),r},SafeBuffer.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},SafeBuffer.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}},function(t,e,n){"use strict";(function(e){t.exports={isNode:void 0!==e,newBufferFrom:function(t,n){if(e.from&&e.from!==Uint8Array.from)return e.from(t,n);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new e(t,n)},allocBuffer:function(t){if(e.alloc)return e.alloc(t);var n=new e(t);return n.fill(0),n},isBuffer:function(t){return e.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}}).call(this,n(8).Buffer)},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function __(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function SyncEvent(){var e=null!==t&&t.apply(this,arguments)||this;return e._recursion=0,e}return i(SyncEvent,t),SyncEvent.prototype.post=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this._listeners&&0!==this._listeners.length){if(this._recursion++,SyncEvent.MAX_RECURSION_DEPTH>0&&this._recursion>SyncEvent.MAX_RECURSION_DEPTH)throw new Error("event fired recursively");for(var n=this._listeners,r=0;r<n.length;++r){var i=n[r];this._call(i,t)}this._recursion--}},SyncEvent.MAX_RECURSION_DEPTH=10,SyncEvent}(n(15).BaseEvent);e.SyncEvent=o;var a=function(t){function VoidSyncEvent(){return null!==t&&t.apply(this,arguments)||this}return i(VoidSyncEvent,t),VoidSyncEvent.prototype.post=function(){t.prototype.post.call(this,void 0)},VoidSyncEvent}(o);e.VoidSyncEvent=a;var s=function(t){function ErrorSyncEvent(){return null!==t&&t.apply(this,arguments)||this}return i(ErrorSyncEvent,t),ErrorSyncEvent.prototype.post=function(e){if(0===this.listenerCount())throw new Error("error event posted while no listeners attached. Error: "+e.message);t.prototype.post.call(this,e)},ErrorSyncEvent}(o);e.ErrorSyncEvent=s},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(19),i=function(){function EventQueue(){this.evtFilled=new r.SyncEvent,this.evtDrained=new r.SyncEvent,this._queue=[],this._flushing=!1}return EventQueue.global=function(){return EventQueue._instance||EventQueue.resetGlobal(),EventQueue._instance},EventQueue.resetGlobal=function(){EventQueue._instance=new EventQueue},EventQueue.prototype.empty=function(){return 0===this._queue.length},EventQueue.prototype.add=function(t){this._queue.push(t),1!==this._queue.length||this._flushing||this.evtFilled.post(this)},EventQueue.prototype.flushOnce=function(){var t=0===this._queue.length,e=this._flushing;this._flushing=!0;try{var n=this._queue;this._queue=[];for(var r=0;r<n.length;++r)n[r]()}finally{this._flushing=e,t||e||0!==this._queue.length||this.evtDrained.post(this)}},EventQueue.prototype.flush=function(t){void 0===t&&(t=10);var e=0===this._queue.length,n=this._flushing;this._flushing=!0;try{for(var r=0;this._queue.length>0;){if("number"==typeof t&&r>=t)throw this._queue=[],new Error("unable to flush the queue due to recursively added event. Clearing queue now");this.flushOnce(),++r}}finally{this._flushing=n,e||n||0!==this._queue.length||this.evtDrained.post(this)}},EventQueue}();e.default=i},function(t,e,n){(function(t){var r=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function Timeout(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new Timeout(i.call(setTimeout,r,arguments),clearTimeout)},e.setInterval=function(){return new Timeout(i.call(setInterval,r,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(r,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function onTimeout(){t._onTimeout&&t._onTimeout()},e))},n(59),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,n(4))},function(t,e,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function ReflectApply(t,e,n){return Function.prototype.apply.call(t,e,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function ReflectOwnKeys(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function ReflectOwnKeys(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function NumberIsNaN(t){return t!=t};function EventEmitter(){EventEmitter.init.call(this)}t.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var s=10;function $getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function _addListener(t,e,n,r){var i,o,a;if("function"!=typeof n)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof n);if(void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),a=o[e]),void 0===a)a=o[e]=n,++t._eventsCount;else if("function"==typeof a?a=o[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=$getMaxListeners(t))>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=e,s.count=a.length,function ProcessEmitWarning(t){console&&console.warn&&console.warn(t)}(s)}return t}function _onceWrap(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=function onceWrapper(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,t))}.bind(r);return i.listener=n,r.wrapFn=i,i}function _listeners(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function unwrapListeners(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):arrayClone(i,i.length)}function listenerCount(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function arrayClone(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");s=t}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function setMaxListeners(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function emit(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=i[t];if(void 0===c)return!1;if("function"==typeof c)o(c,this,e);else{var u=c.length,l=arrayClone(c,u);for(n=0;n<u;++n)o(l[n],this,e)}return!0},EventEmitter.prototype.addListener=function addListener(t,e){return _addListener(this,t,e,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(t,e){return _addListener(this,t,e,!0)},EventEmitter.prototype.once=function once(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.removeListener=function removeListener(t,e){var n,r,i,o,a;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===e||n[o].listener===e){a=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function spliceOne(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,a||e)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},EventEmitter.prototype.listeners=function listeners(t){return _listeners(this,t,!0)},EventEmitter.prototype.rawListeners=function rawListeners(t){return _listeners(this,t,!1)},EventEmitter.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):listenerCount.call(t,e)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?r(this._events):[]}},function(t,e,n){(e=t.exports=n(33)).Stream=e,e.Readable=e,e.Writable=n(24),e.Duplex=n(7),e.Transform=n(37),e.PassThrough=n(73)},function(t,e,n){"use strict";(function(e,r,i){var o=n(16);function CorkedRequest(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function onCorkedFinish(t,e,n){var r=t.entry;t.entry=null;for(;r;){var i=r.callback;e.pendingcb--,i(n),r=r.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=Writable;var a,s=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?r:o.nextTick;Writable.WritableState=WritableState;var c=n(12);c.inherits=n(10);var u={deprecate:n(72)},l=n(34),p=n(17).Buffer,h=i.Uint8Array||function(){};var f,d=n(35);function nop(){}function WritableState(t,e){a=a||n(7),t=t||{};var r=e instanceof a;this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,c=t.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(c||0===c)?c:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===t.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function onwrite(t,e){var n=t._writableState,r=n.sync,i=n.writecb;if(function onwriteStateUpdate(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(n),e)!function onwriteError(t,e,n,r,i){--e.pendingcb,n?(o.nextTick(i,r),o.nextTick(finishMaybe,t,e),t._writableState.errorEmitted=!0,t.emit("error",r)):(i(r),t._writableState.errorEmitted=!0,t.emit("error",r),finishMaybe(t,e))}(t,n,r,e,i);else{var a=needFinish(n);a||n.corked||n.bufferProcessing||!n.bufferedRequest||clearBuffer(t,n),r?s(afterWrite,t,n,a,i):afterWrite(t,n,a,i)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(t){if(a=a||n(7),!(f.call(Writable,this)||this instanceof a))return new Writable(t);this._writableState=new WritableState(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),l.call(this)}function doWrite(t,e,n,r,i,o,a){e.writelen=r,e.writecb=a,e.writing=!0,e.sync=!0,n?t._writev(i,e.onwrite):t._write(i,o,e.onwrite),e.sync=!1}function afterWrite(t,e,n,r){n||function onwriteDrain(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,r(),finishMaybe(t,e)}function clearBuffer(t,e){e.bufferProcessing=!0;var n=e.bufferedRequest;if(t._writev&&n&&n.next){var r=e.bufferedRequestCount,i=new Array(r),o=e.corkedRequestsFree;o.entry=n;for(var a=0,s=!0;n;)i[a]=n,n.isBuf||(s=!1),n=n.next,a+=1;i.allBuffers=s,doWrite(t,e,!0,e.length,i,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new CorkedRequest(e),e.bufferedRequestCount=0}else{for(;n;){var c=n.chunk,u=n.encoding,l=n.callback;if(doWrite(t,e,!1,e.objectMode?1:c.length,c,u,l),n=n.next,e.bufferedRequestCount--,e.writing)break}null===n&&(e.lastBufferedRequest=null)}e.bufferedRequest=n,e.bufferProcessing=!1}function needFinish(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function callFinal(t,e){t._final(function(n){e.pendingcb--,n&&t.emit("error",n),e.prefinished=!0,t.emit("prefinish"),finishMaybe(t,e)})}function finishMaybe(t,e){var n=needFinish(e);return n&&(!function prefinish(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,o.nextTick(callFinal,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),n}c.inherits(Writable,l),WritableState.prototype.getBuffer=function getBuffer(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:u.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(f=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(t){return!!f.call(this,t)||this===Writable&&(t&&t._writableState instanceof WritableState)}})):f=function(t){return t instanceof this},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(t,e,n){var r=this._writableState,i=!1,a=!r.objectMode&&function _isUint8Array(t){return p.isBuffer(t)||t instanceof h}(t);return a&&!p.isBuffer(t)&&(t=function _uint8ArrayToBuffer(t){return p.from(t)}(t)),"function"==typeof e&&(n=e,e=null),a?e="buffer":e||(e=r.defaultEncoding),"function"!=typeof n&&(n=nop),r.ended?function writeAfterEnd(t,e){var n=new Error("write after end");t.emit("error",n),o.nextTick(e,n)}(this,n):(a||function validChunk(t,e,n,r){var i=!0,a=!1;return null===n?a=new TypeError("May not write null values to stream"):"string"==typeof n||void 0===n||e.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(t.emit("error",a),o.nextTick(r,a),i=!1),i}(this,r,t,n))&&(r.pendingcb++,i=function writeOrBuffer(t,e,n,r,i,o){if(!n){var a=function decodeChunk(t,e,n){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=p.from(e,n));return e}(e,r,i);r!==a&&(n=!0,i="buffer",r=a)}var s=e.objectMode?1:r.length;e.length+=s;var c=e.length<e.highWaterMark;c||(e.needDrain=!0);if(e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest={chunk:r,encoding:i,isBuf:n,callback:o,next:null},u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else doWrite(t,e,!1,s,r,i,o);return c}(this,r,a,t,e,n)),i},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||clearBuffer(this,t))},Writable.prototype.setDefaultEncoding=function setDefaultEncoding(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(Writable.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Writable.prototype._write=function(t,e,n){n(new Error("_write() is not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(t,e,n){var r=this._writableState;"function"==typeof t?(n=t,t=null,e=null):"function"==typeof e&&(n=e,e=null),null!=t&&this.write(t,e),r.corked&&(r.corked=1,this.uncork()),r.ending||r.finished||function endWritable(t,e,n){e.ending=!0,finishMaybe(t,e),n&&(e.finished?o.nextTick(n):t.once("finish",n));e.ended=!0,t.writable=!1}(this,r,n)},Object.defineProperty(Writable.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),Writable.prototype.destroy=d.destroy,Writable.prototype._undestroy=d.undestroy,Writable.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,n(11),n(21).setImmediate,n(4))},function(t,e,n){"use strict";var r=n(13),i=n(41),o=n(42),a=n(43);o=n(42);function CompressedObject(t,e,n,r,i){this.compressedSize=t,this.uncompressedSize=e,this.crc32=n,this.compression=r,this.compressedContent=i}CompressedObject.prototype={getContentWorker:function(){var t=new i(r.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new i(r.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},CompressedObject.createWorkerFrom=function(t,e,n){return t.pipe(new a).pipe(new o("uncompressedSize")).pipe(e.compressWorker(n)).pipe(new o("compressedSize")).withStreamInfo("compression",e)},t.exports=CompressedObject},function(t,e,n){"use strict";var r=n(1);var i=function makeTable(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();t.exports=function crc32wrapper(t,e){return void 0!==t&&t.length?"string"!==r.getTypeOf(t)?function crc32(t,e,n,r){var o=i,a=r+n;t^=-1;for(var s=r;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}(0|e,t,t.length,0):function crc32str(t,e,n,r){var o=i,a=r+n;t^=-1;for(var s=r;s<a;s++)t=t>>>8^o[255&(t^e.charCodeAt(s))];return-1^t}(0|e,t,t.length,0):0}},function(t,e,n){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,e){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);t.exports=function whatwgRNG(){return n(r),r}}else{var i=new Array(16);t.exports=function mathRNG(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}},function(t,e){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);t.exports=function bytesToUuid(t,e){var r=e||0,i=n;return[i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],"-",i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]],i[t[r++]]].join("")}},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function __(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});Object.defineProperty(e,"__esModule",{value:!0});var o=n(15),a=n(20),s=function(t){function QueuedEvent(e){var n=t.call(this)||this;n._queued=!1,n.options=e;var r=e||{};return"boolean"==typeof r.condensed?n._condensed=r.condensed:n._condensed=!1,"object"==typeof r.queue&&null!==r.queue&&(n._queue=r.queue),n}return i(QueuedEvent,t),QueuedEvent.prototype.post=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this._listeners&&0!==this._listeners.length){var r=this._queue?this._queue:a.default.global();if(this._condensed){if(this._queuedData=e,this._queuedListeners=this._listeners,this._queued)return;this._queued=!0,r.add(function(){t._queued=!1;for(var e=t._queuedData,n=t._queuedListeners,r=0;r<n.length;++r){var i=n[r];t._call(i,e)}})}else{var i=this._listeners;r.add(function(){for(var n=0;n<i.length;++n){var r=i[n];t._call(r,e)}})}}},QueuedEvent}(o.BaseEvent);e.QueuedEvent=s;var c=function(t){function VoidQueuedEvent(){return null!==t&&t.apply(this,arguments)||this}return i(VoidQueuedEvent,t),VoidQueuedEvent.prototype.post=function(){t.prototype.post.call(this,void 0)},VoidQueuedEvent}(s);e.VoidQueuedEvent=c;var u=function(t){function ErrorQueuedEvent(){return null!==t&&t.apply(this,arguments)||this}return i(ErrorQueuedEvent,t),ErrorQueuedEvent.prototype.post=function(e){if(!this._listeners||0===this._listeners.length)throw new Error("error event posted while no listeners attached. Error: "+e.message);t.prototype.post.call(this,e)},ErrorQueuedEvent}(s);e.ErrorQueuedEvent=u},function(t,e,n){"use strict";(function(t){var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function __(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function AsyncEvent(t){var n=e.call(this)||this;n._queued=!1,n.options=t;var r=t||{};return"boolean"==typeof r.condensed?n._condensed=r.condensed:n._condensed=!1,n}return i(AsyncEvent,e),AsyncEvent.defaultScheduler=function(e){"undefined"!=typeof window?setTimeout(e,0):t(e)},AsyncEvent.setScheduler=function(t){AsyncEvent._scheduler=t},AsyncEvent.prototype.post=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this._listeners&&0!==this._listeners.length)if(this._condensed){if(this._queuedData=e,this._queuedListeners=this._listeners,this._queued)return;this._queued=!0,AsyncEvent._scheduler(function(){t._queued=!1;for(var e=t._queuedData,n=t._queuedListeners,r=0;r<n.length;++r){var i=n[r];t._call(i,e)}})}else{var r=this._listeners;AsyncEvent._scheduler(function(){for(var n=0;n<r.length;++n){var i=r[n];t._call(i,e)}})}},AsyncEvent.prototype._call=function(t,n){t.event&&t.event instanceof AsyncEvent?t.event._postDirect(n):e.prototype._call.call(this,t,n)},AsyncEvent.prototype._postDirect=function(t){if(this._listeners&&0!==this._listeners.length)for(var e=this._listeners,n=0;n<e.length;++n){var r=e[n];this._call(r,t)}},AsyncEvent._scheduler=AsyncEvent.defaultScheduler,AsyncEvent}(n(15).BaseEvent);e.AsyncEvent=o;var a=function(t){function VoidAsyncEvent(){return null!==t&&t.apply(this,arguments)||this}return i(VoidAsyncEvent,t),VoidAsyncEvent.prototype.post=function(){t.prototype.post.call(this,void 0)},VoidAsyncEvent}(o);e.VoidAsyncEvent=a;var s=function(t){function ErrorAsyncEvent(){return null!==t&&t.apply(this,arguments)||this}return i(ErrorAsyncEvent,t),ErrorAsyncEvent.prototype.post=function(e){if(0===this.listenerCount())throw new Error("error event posted while no listeners attached. Error: "+e.message);t.prototype.post.call(this,e)},ErrorAsyncEvent}(o);e.ErrorAsyncEvent=s}).call(this,n(21).setImmediate)},function(t,e,n){t.exports=n(67)},function(t,e,n){"use strict";(function(e,r){var i=n(16);t.exports=Readable;var o,a=n(68);Readable.ReadableState=ReadableState;n(22).EventEmitter;var s=function(t,e){return t.listeners(e).length},c=n(34),u=n(17).Buffer,l=e.Uint8Array||function(){};var p=n(12);p.inherits=n(10);var h=n(69),f=void 0;f=h&&h.debuglog?h.debuglog("stream"):function(){};var d,y=n(70),m=n(35);p.inherits(Readable,c);var v=["error","close","destroy","pause","resume"];function ReadableState(t,e){t=t||{};var r=e instanceof(o=o||n(7));this.objectMode=!!t.objectMode,r&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,a=t.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:r&&(a||0===a)?a:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new y,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(d||(d=n(36).StringDecoder),this.decoder=new d(t.encoding),this.encoding=t.encoding)}function Readable(t){if(o=o||n(7),!(this instanceof Readable))return new Readable(t);this._readableState=new ReadableState(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),c.call(this)}function readableAddChunk(t,e,n,r,i){var o,a=t._readableState;null===e?(a.reading=!1,function onEofChunk(t,e){if(e.ended)return;if(e.decoder){var n=e.decoder.end();n&&n.length&&(e.buffer.push(n),e.length+=e.objectMode?1:n.length)}e.ended=!0,emitReadable(t)}(t,a)):(i||(o=function chunkInvalid(t,e){var n;(function _isUint8Array(t){return u.isBuffer(t)||t instanceof l})(e)||"string"==typeof e||void 0===e||t.objectMode||(n=new TypeError("Invalid non-string/buffer chunk"));return n}(a,e)),o?t.emit("error",o):a.objectMode||e&&e.length>0?("string"==typeof e||a.objectMode||Object.getPrototypeOf(e)===u.prototype||(e=function _uint8ArrayToBuffer(t){return u.from(t)}(e)),r?a.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):addChunk(t,a,e,!0):a.ended?t.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!n?(e=a.decoder.write(e),a.objectMode||0!==e.length?addChunk(t,a,e,!1):maybeReadMore(t,a)):addChunk(t,a,e,!1))):r||(a.reading=!1));return function needMoreData(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(a)}function addChunk(t,e,n,r){e.flowing&&0===e.length&&!e.sync?(t.emit("data",n),t.read(0)):(e.length+=e.objectMode?1:n.length,r?e.buffer.unshift(n):e.buffer.push(n),e.needReadable&&emitReadable(t)),maybeReadMore(t,e)}Object.defineProperty(Readable.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),Readable.prototype.destroy=m.destroy,Readable.prototype._undestroy=m.undestroy,Readable.prototype._destroy=function(t,e){this.push(null),e(t)},Readable.prototype.push=function(t,e){var n,r=this._readableState;return r.objectMode?n=!0:"string"==typeof t&&((e=e||r.defaultEncoding)!==r.encoding&&(t=u.from(t,e),e=""),n=!0),readableAddChunk(this,t,e,!1,n)},Readable.prototype.unshift=function(t){return readableAddChunk(this,t,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(t){return d||(d=n(36).StringDecoder),this._readableState.decoder=new d(t),this._readableState.encoding=t,this};var g=8388608;function howMuchToRead(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function computeNewHighWaterMark(t){return t>=g?t=g:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function emitReadable(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(f("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?i.nextTick(emitReadable_,t):emitReadable_(t))}function emitReadable_(t){f("emit readable"),t.emit("readable"),flow(t)}function maybeReadMore(t,e){e.readingMore||(e.readingMore=!0,i.nextTick(maybeReadMore_,t,e))}function maybeReadMore_(t,e){for(var n=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(f("maybeReadMore read 0"),t.read(0),n!==e.length);)n=e.length;e.readingMore=!1}function nReadingNextTick(t){f("readable nexttick read 0"),t.read(0)}function resume_(t,e){e.reading||(f("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),flow(t),e.flowing&&!e.reading&&t.read(0)}function flow(t){var e=t._readableState;for(f("flow",e.flowing);e.flowing&&null!==t.read(););}function fromList(t,e){return 0===e.length?null:(e.objectMode?n=e.buffer.shift():!t||t>=e.length?(n=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):n=function fromListPartial(t,e,n){var r;t<e.head.data.length?(r=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):r=t===e.head.data.length?e.shift():n?function copyFromBufferString(t,e){var n=e.head,r=1,i=n.data;t-=i.length;for(;n=n.next;){var o=n.data,a=t>o.length?o.length:t;if(a===o.length?i+=o:i+=o.slice(0,t),0===(t-=a)){a===o.length?(++r,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=o.slice(a));break}++r}return e.length-=r,i}(t,e):function copyFromBuffer(t,e){var n=u.allocUnsafe(t),r=e.head,i=1;r.data.copy(n),t-=r.data.length;for(;r=r.next;){var o=r.data,a=t>o.length?o.length:t;if(o.copy(n,n.length-t,0,a),0===(t-=a)){a===o.length?(++i,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=o.slice(a));break}++i}return e.length-=i,n}(t,e);return r}(t,e.buffer,e.decoder),n);var n}function endReadable(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,i.nextTick(endReadableNT,e,t))}function endReadableNT(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function indexOf(t,e){for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}Readable.prototype.read=function(t){f("read",t),t=parseInt(t,10);var e=this._readableState,n=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return f("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?endReadable(this):emitReadable(this),null;if(0===(t=howMuchToRead(t,e))&&e.ended)return 0===e.length&&endReadable(this),null;var r,i=e.needReadable;return f("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&f("length less than watermark",i=!0),e.ended||e.reading?f("reading or ended",i=!1):i&&(f("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=howMuchToRead(n,e))),null===(r=t>0?fromList(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),n!==t&&e.ended&&endReadable(this)),null!==r&&this.emit("data",r),r},Readable.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},Readable.prototype.pipe=function(t,e){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=t;break;case 1:o.pipes=[o.pipes,t];break;default:o.pipes.push(t)}o.pipesCount+=1,f("pipe count=%d opts=%j",o.pipesCount,e);var c=(!e||!1!==e.end)&&t!==r.stdout&&t!==r.stderr?onend:unpipe;function onunpipe(e,r){f("onunpipe"),e===n&&r&&!1===r.hasUnpiped&&(r.hasUnpiped=!0,function cleanup(){f("cleanup"),t.removeListener("close",onclose),t.removeListener("finish",onfinish),t.removeListener("drain",u),t.removeListener("error",onerror),t.removeListener("unpipe",onunpipe),n.removeListener("end",onend),n.removeListener("end",unpipe),n.removeListener("data",ondata),l=!0,!o.awaitDrain||t._writableState&&!t._writableState.needDrain||u()}())}function onend(){f("onend"),t.end()}o.endEmitted?i.nextTick(c):n.once("end",c),t.on("unpipe",onunpipe);var u=function pipeOnDrain(t){return function(){var e=t._readableState;f("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&s(t,"data")&&(e.flowing=!0,flow(t))}}(n);t.on("drain",u);var l=!1;var p=!1;function ondata(e){f("ondata"),p=!1,!1!==t.write(e)||p||((1===o.pipesCount&&o.pipes===t||o.pipesCount>1&&-1!==indexOf(o.pipes,t))&&!l&&(f("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,p=!0),n.pause())}function onerror(e){f("onerror",e),unpipe(),t.removeListener("error",onerror),0===s(t,"error")&&t.emit("error",e)}function onclose(){t.removeListener("finish",onfinish),unpipe()}function onfinish(){f("onfinish"),t.removeListener("close",onclose),unpipe()}function unpipe(){f("unpipe"),n.unpipe(t)}return n.on("data",ondata),function prependListener(t,e,n){if("function"==typeof t.prependListener)return t.prependListener(e,n);t._events&&t._events[e]?a(t._events[e])?t._events[e].unshift(n):t._events[e]=[n,t._events[e]]:t.on(e,n)}(t,"error",onerror),t.once("close",onclose),t.once("finish",onfinish),t.emit("pipe",n),o.flowing||(f("pipe resume"),n.resume()),t},Readable.prototype.unpipe=function(t){var e=this._readableState,n={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,n),this);if(!t){var r=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<i;o++)r[o].emit("unpipe",this,n);return this}var a=indexOf(e.pipes,t);return-1===a?this:(e.pipes.splice(a,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,n),this)},Readable.prototype.on=function(t,e){var n=c.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var r=this._readableState;r.endEmitted||r.readableListening||(r.readableListening=r.needReadable=!0,r.emittedReadable=!1,r.reading?r.length&&emitReadable(this):i.nextTick(nReadingNextTick,this))}return n},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var t=this._readableState;return t.flowing||(f("resume"),t.flowing=!0,function resume(t,e){e.resumeScheduled||(e.resumeScheduled=!0,i.nextTick(resume_,t,e))}(this,t)),this},Readable.prototype.pause=function(){return f("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(f("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(t){var e=this,n=this._readableState,r=!1;for(var i in t.on("end",function(){if(f("wrapped end"),n.decoder&&!n.ended){var t=n.decoder.end();t&&t.length&&e.push(t)}e.push(null)}),t.on("data",function(i){(f("wrapped data"),n.decoder&&(i=n.decoder.write(i)),n.objectMode&&null==i)||(n.objectMode||i&&i.length)&&(e.push(i)||(r=!0,t.pause()))}),t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));for(var o=0;o<v.length;o++)t.on(v[o],this.emit.bind(this,v[o]));return this._read=function(e){f("wrapped _read",e),r&&(r=!1,t.resume())},this},Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Readable._fromList=fromList}).call(this,n(4),n(11))},function(t,e,n){t.exports=n(22).EventEmitter},function(t,e,n){"use strict";var r=n(16);function emitErrorNT(t,e){t.emit("error",e)}t.exports={destroy:function destroy(t,e){var n=this,i=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return i||o?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||r.nextTick(emitErrorNT,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(r.nextTick(emitErrorNT,n,t),n._writableState&&(n._writableState.errorEmitted=!0)):e&&e(t)}),this)},undestroy:function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,e,n){"use strict";var r=n(17).Buffer,i=r.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function StringDecoder(t){var e;switch(this.encoding=function normalizeEncoding(t){var e=function _normalizeEncoding(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(r.isEncoding===i||!i(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,e=4;break;case"utf8":this.fillLast=utf8FillLast,e=4;break;case"base64":this.text=base64Text,this.end=base64End,e=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=r.allocUnsafe(e)}function utf8CheckByte(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function utf8FillLast(t){var e=this.lastTotal-this.lastNeed,n=function utf8CheckExtraBytes(t,e,n){if(128!=(192&e[0]))return t.lastNeed=0,"�";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�"}}(this,t);return void 0!==n?n:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function utf16Text(t,e){if((t.length-e)%2==0){var n=t.toString("utf16le",e);if(n){var r=n.charCodeAt(n.length-1);if(r>=55296&&r<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],n.slice(0,-1)}return n}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function utf16End(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var n=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,n)}return e}function base64Text(t,e){var n=(t.length-e)%3;return 0===n?t.toString("base64",e):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-n))}function base64End(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function simpleWrite(t){return t.toString(this.encoding)}function simpleEnd(t){return t&&t.length?this.write(t):""}e.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(t){if(0===t.length)return"";var e,n;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";n=this.lastNeed,this.lastNeed=0}else n=0;return n<t.length?e?e+this.text(t,n):this.text(t,n):e||""},StringDecoder.prototype.end=function utf8End(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�":e},StringDecoder.prototype.text=function utf8Text(t,e){var n=function utf8CheckIncomplete(t,e,n){var r=e.length-1;if(r<n)return 0;var i=utf8CheckByte(e[r]);if(i>=0)return i>0&&(t.lastNeed=i-1),i;if(--r<n||-2===i)return 0;if((i=utf8CheckByte(e[r]))>=0)return i>0&&(t.lastNeed=i-2),i;if(--r<n||-2===i)return 0;if((i=utf8CheckByte(e[r]))>=0)return i>0&&(2===i?i=0:t.lastNeed=i-3),i;return 0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=n;var r=t.length-(n-this.lastNeed);return t.copy(this.lastChar,0,r),t.toString("utf8",e,r)},StringDecoder.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,e,n){"use strict";t.exports=Transform;var r=n(7),i=n(12);function afterTransform(t,e){var n=this._transformState;n.transforming=!1;var r=n.writecb;if(!r)return this.emit("error",new Error("write callback called multiple times"));n.writechunk=null,n.writecb=null,null!=e&&this.push(e),r(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function Transform(t){if(!(this instanceof Transform))return new Transform(t);r.call(this,t),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",prefinish)}function prefinish(){var t=this;"function"==typeof this._flush?this._flush(function(e,n){done(t,e,n)}):done(this,null,null)}function done(t,e,n){if(e)return t.emit("error",e);if(null!=n&&t.push(n),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}i.inherits=n(10),i.inherits(Transform,r),Transform.prototype.push=function(t,e){return this._transformState.needTransform=!1,r.prototype.push.call(this,t,e)},Transform.prototype._transform=function(t,e,n){throw new Error("_transform() is not implemented")},Transform.prototype._write=function(t,e,n){var r=this._transformState;if(r.writecb=n,r.writechunk=t,r.writeencoding=e,!r.transforming){var i=this._readableState;(r.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},Transform.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},Transform.prototype._destroy=function(t,e){var n=this;r.prototype._destroy.call(this,t,function(t){e(t),n.emit("close")})}},function(t,e,n){"use strict";var r=n(1),i=n(5),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.encode=function(t){for(var e,n,i,a,s,c,u,l=[],p=0,h=t.length,f=h,d="string"!==r.getTypeOf(t);p<t.length;)f=h-p,d?(e=t[p++],n=p<h?t[p++]:0,i=p<h?t[p++]:0):(e=t.charCodeAt(p++),n=p<h?t.charCodeAt(p++):0,i=p<h?t.charCodeAt(p++):0),a=e>>2,s=(3&e)<<4|n>>4,c=f>1?(15&n)<<2|i>>6:64,u=f>2?63&i:64,l.push(o.charAt(a)+o.charAt(s)+o.charAt(c)+o.charAt(u));return l.join("")},e.decode=function(t){var e,n,r,a,s,c,u=0,l=0;if("data:"===t.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var p,h=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===o.charAt(64)&&h--,t.charAt(t.length-2)===o.charAt(64)&&h--,h%1!=0)throw new Error("Invalid base64 input, bad content length.");for(p=i.uint8array?new Uint8Array(0|h):new Array(0|h);u<t.length;)e=o.indexOf(t.charAt(u++))<<2|(a=o.indexOf(t.charAt(u++)))>>4,n=(15&a)<<4|(s=o.indexOf(t.charAt(u++)))>>2,r=(3&s)<<6|(c=o.indexOf(t.charAt(u++))),p[l++]=e,64!==s&&(p[l++]=n),64!==c&&(p[l++]=r);return p}},function(t,e,n){"use strict";(function(e){var r=n(1),i=n(81),o=n(3),a=n(38),s=n(5),c=n(13),u=null;if(s.nodestream)try{u=n(82)}catch(t){}function accumulate(t,n){return new c.Promise(function(i,o){var s=[],c=t._internalType,u=t._outputType,l=t._mimeType;t.on("data",function(t,e){s.push(t),n&&n(e)}).on("error",function(t){s=[],o(t)}).on("end",function(){try{var t=function transformZipOutput(t,e,n){switch(t){case"blob":return r.newBlob(r.transformTo("arraybuffer",e),n);case"base64":return a.encode(e);default:return r.transformTo(t,e)}}(u,function concat(t,n){var r,i=0,o=null,a=0;for(r=0;r<n.length;r++)a+=n[r].length;switch(t){case"string":return n.join("");case"array":return Array.prototype.concat.apply([],n);case"uint8array":for(o=new Uint8Array(a),r=0;r<n.length;r++)o.set(n[r],i),i+=n[r].length;return o;case"nodebuffer":return e.concat(n);default:throw new Error("concat : unsupported type '"+t+"'")}}(c,s),l);i(t)}catch(t){o(t)}s=[]}).resume()})}function StreamHelper(t,e,n){var a=e;switch(e){case"blob":case"arraybuffer":a="uint8array";break;case"base64":a="string"}try{this._internalType=a,this._outputType=e,this._mimeType=n,r.checkSupport(a),this._worker=t.pipe(new i(a)),t.lock()}catch(t){this._worker=new o("error"),this._worker.error(t)}}StreamHelper.prototype={accumulate:function(t){return accumulate(this,t)},on:function(t,e){var n=this;return"data"===t?this._worker.on(t,function(t){e.call(n,t.data,t.meta)}):this._worker.on(t,function(){r.delay(e,arguments,n)}),this},resume:function(){return r.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(r.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:"nodebuffer"!==this._outputType},t)}},t.exports=StreamHelper}).call(this,n(8).Buffer)},function(t,e,n){"use strict";e.base64=!1,e.binary=!1,e.dir=!1,e.createFolders=!0,e.date=null,e.compression=null,e.compressionOptions=null,e.comment=null,e.unixPermissions=null,e.dosPermissions=null},function(t,e,n){"use strict";var r=n(1),i=n(3);function DataWorker(t){i.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=r.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}r.inherits(DataWorker,i),DataWorker.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},DataWorker.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,r.delay(this._tickAndRepeat,[],this)),!0)},DataWorker.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(r.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},DataWorker.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=DataWorker},function(t,e,n){"use strict";var r=n(1),i=n(3);function DataLengthProbe(t){i.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}r.inherits(DataLengthProbe,i),DataLengthProbe.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}i.prototype.processChunk.call(this,t)},t.exports=DataLengthProbe},function(t,e,n){"use strict";var r=n(3),i=n(26);function Crc32Probe(){r.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}n(1).inherits(Crc32Probe,r),Crc32Probe.prototype.processChunk=function(t){this.streamInfo.crc32=i(t.data,this.streamInfo.crc32||0),this.push(t)},t.exports=Crc32Probe},function(t,e,n){"use strict";var r=n(3);e.STORE={magic:"\0\0",compressWorker:function(t){return new r("STORE compression")},uncompressWorker:function(){return new r("STORE decompression")}},e.DEFLATE=n(85)},function(t,e,n){"use strict";t.exports=function adler32(t,e,n,r){for(var i=65535&t|0,o=t>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(i=i+e[r++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},function(t,e,n){"use strict";var r=function makeTable(){for(var t,e=[],n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e}();t.exports=function crc32(t,e,n,i){var o=r,a=i+n;t^=-1;for(var s=i;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}},function(t,e,n){"use strict";var r=n(6),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var a=new r.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function buf2binstring(t,e){if(e<65534&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,r.shrinkBuf(t,e));for(var n="",a=0;a<e;a++)n+=String.fromCharCode(t[a]);return n}a[254]=a[254]=1,e.string2buf=function(t){var e,n,i,o,a,s=t.length,c=0;for(o=0;o<s;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),c+=n<128?1:n<2048?2:n<65536?3:4;for(e=new r.Buf8(c),a=0,o=0;a<c;o++)55296==(64512&(n=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?e[a++]=n:n<2048?(e[a++]=192|n>>>6,e[a++]=128|63&n):n<65536?(e[a++]=224|n>>>12,e[a++]=128|n>>>6&63,e[a++]=128|63&n):(e[a++]=240|n>>>18,e[a++]=128|n>>>12&63,e[a++]=128|n>>>6&63,e[a++]=128|63&n);return e},e.buf2binstring=function(t){return buf2binstring(t,t.length)},e.binstring2buf=function(t){for(var e=new r.Buf8(t.length),n=0,i=e.length;n<i;n++)e[n]=t.charCodeAt(n);return e},e.buf2string=function(t,e){var n,r,i,o,s=e||t.length,c=new Array(2*s);for(r=0,n=0;n<s;)if((i=t[n++])<128)c[r++]=i;else if((o=a[i])>4)c[r++]=65533,n+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&n<s;)i=i<<6|63&t[n++],o--;o>1?c[r++]=65533:i<65536?c[r++]=i:(i-=65536,c[r++]=55296|i>>10&1023,c[r++]=56320|1023&i)}return buf2binstring(c,r)},e.utf8border=function(t,e){var n;for((e=e||t.length)>t.length&&(e=t.length),n=e-1;n>=0&&128==(192&t[n]);)n--;return n<0?e:0===n?e:n+a[t[n]]>e?n:e}},function(t,e,n){"use strict";t.exports=function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,e,n){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,e,n){"use strict";e.LOCAL_FILE_HEADER="PK",e.CENTRAL_FILE_HEADER="PK",e.CENTRAL_DIRECTORY_END="PK",e.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",e.ZIP64_CENTRAL_DIRECTORY_END="PK",e.DATA_DESCRIPTOR="PK\b"},function(t,e,n){"use strict";var r=n(1),i=n(5),o=n(52),a=n(99),s=n(100),c=n(54);t.exports=function(t){var e=r.getTypeOf(t);return r.checkSupport(e),"string"!==e||i.uint8array?"nodebuffer"===e?new s(t):i.uint8array?new c(r.transformTo("uint8array",t)):new o(r.transformTo("array",t)):new a(t)}},function(t,e,n){"use strict";var r=n(53);function ArrayReader(t){r.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}n(1).inherits(ArrayReader,r),ArrayReader.prototype.byteAt=function(t){return this.data[this.zero+t]},ArrayReader.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),n=t.charCodeAt(1),r=t.charCodeAt(2),i=t.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===e&&this.data[o+1]===n&&this.data[o+2]===r&&this.data[o+3]===i)return o-this.zero;return-1},ArrayReader.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),n=t.charCodeAt(1),r=t.charCodeAt(2),i=t.charCodeAt(3),o=this.readData(4);return e===o[0]&&n===o[1]&&r===o[2]&&i===o[3]},ArrayReader.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},t.exports=ArrayReader},function(t,e,n){"use strict";var r=n(1);function DataReader(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}DataReader.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,n=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)n=(n<<8)+this.byteAt(e);return this.index+=t,n},readString:function(t){return r.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},t.exports=DataReader},function(t,e,n){"use strict";var r=n(52);function Uint8ArrayReader(t){r.call(this,t)}n(1).inherits(Uint8ArrayReader,r),Uint8ArrayReader.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},t.exports=Uint8ArrayReader},function(t,e,n){(function(t,e){
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n;!function(n){!function(r){var i="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),o=makeExporter(n);function makeExporter(t,e){return function(n,r){"function"!=typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}void 0===i.Reflect?i.Reflect=n:o=makeExporter(i.Reflect,o),function(e){var n=Object.prototype.hasOwnProperty,r="function"==typeof Symbol,i=r&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=r&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,s={__proto__:[]}instanceof Array,c=!a&&!s,u={create:a?function(){return MakeDictionary(Object.create(null))}:s?function(){return MakeDictionary({__proto__:null})}:function(){return MakeDictionary({})},has:c?function(t,e){return n.call(t,e)}:function(t,e){return e in t},get:c?function(t,e){return n.call(t,e)?t[e]:void 0}:function(t,e){return t[e]}},l=Object.getPrototypeOf(Function),p="object"==typeof t&&t.env&&"true"===t.env.REFLECT_METADATA_USE_MAP_POLYFILL,h=p||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function CreateMapPolyfill(){var t={},e=[],n=function(){function MapIterator(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return MapIterator.prototype["@@iterator"]=function(){return this},MapIterator.prototype[o]=function(){return this},MapIterator.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},MapIterator.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},MapIterator.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},MapIterator}();return function(){function Map(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(Map.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Map.prototype.has=function(t){return this._find(t,!1)>=0},Map.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},Map.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},Map.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},Map.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},Map.prototype.keys=function(){return new n(this._keys,this._values,getKey)},Map.prototype.values=function(){return new n(this._keys,this._values,getValue)},Map.prototype.entries=function(){return new n(this._keys,this._values,getEntry)},Map.prototype["@@iterator"]=function(){return this.entries()},Map.prototype[o]=function(){return this.entries()},Map.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},Map}();function getKey(t,e){return t}function getValue(t,e){return e}function getEntry(t,e){return[t,e]}}():Map,f=p||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function CreateSetPolyfill(){return function(){function Set(){this._map=new h}return Object.defineProperty(Set.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Set.prototype.has=function(t){return this._map.has(t)},Set.prototype.add=function(t){return this._map.set(t,t),this},Set.prototype.delete=function(t){return this._map.delete(t)},Set.prototype.clear=function(){this._map.clear()},Set.prototype.keys=function(){return this._map.keys()},Set.prototype.values=function(){return this._map.values()},Set.prototype.entries=function(){return this._map.entries()},Set.prototype["@@iterator"]=function(){return this.keys()},Set.prototype[o]=function(){return this.keys()},Set}()}():Set,d=new(p||"function"!=typeof WeakMap?function CreateWeakMapPolyfill(){var t=16,e=u.create(),r=CreateUniqueKey();return function(){function WeakMap(){this._key=CreateUniqueKey()}return WeakMap.prototype.has=function(t){var e=GetOrCreateWeakMapTable(t,!1);return void 0!==e&&u.has(e,this._key)},WeakMap.prototype.get=function(t){var e=GetOrCreateWeakMapTable(t,!1);return void 0!==e?u.get(e,this._key):void 0},WeakMap.prototype.set=function(t,e){var n=GetOrCreateWeakMapTable(t,!0);return n[this._key]=e,this},WeakMap.prototype.delete=function(t){var e=GetOrCreateWeakMapTable(t,!1);return void 0!==e&&delete e[this._key]},WeakMap.prototype.clear=function(){this._key=CreateUniqueKey()},WeakMap}();function CreateUniqueKey(){var t;do{t="@@WeakMap@@"+CreateUUID()}while(u.has(e,t));return e[t]=!0,t}function GetOrCreateWeakMapTable(t,e){if(!n.call(t,r)){if(!e)return;Object.defineProperty(t,r,{value:u.create()})}return t[r]}function FillRandomBytes(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function CreateUUID(){var e=function GenRandomBytes(t){if("function"==typeof Uint8Array)return"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):FillRandomBytes(new Uint8Array(t),t);return FillRandomBytes(new Array(t),t)}(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",r=0;r<t;++r){var i=e[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function GetOrCreateMetadataMap(t,e,n){var r=d.get(t);if(IsUndefined(r)){if(!n)return;r=new h,d.set(t,r)}var i=r.get(e);if(IsUndefined(i)){if(!n)return;i=new h,r.set(e,i)}return i}function OrdinaryHasOwnMetadata(t,e,n){var r=GetOrCreateMetadataMap(e,n,!1);return!IsUndefined(r)&&function ToBoolean(t){return!!t}(r.has(t))}function OrdinaryGetOwnMetadata(t,e,n){var r=GetOrCreateMetadataMap(e,n,!1);if(!IsUndefined(r))return r.get(t)}function OrdinaryDefineOwnMetadata(t,e,n,r){var i=GetOrCreateMetadataMap(n,r,!0);i.set(t,e)}function OrdinaryOwnMetadataKeys(t,e){var n=[],r=GetOrCreateMetadataMap(t,e,!1);if(IsUndefined(r))return n;for(var i=r.keys(),a=function GetIterator(t){var e=GetMethod(t,o);if(!IsCallable(e))throw new TypeError;var n=e.call(t);if(!IsObject(n))throw new TypeError;return n}(i),s=0;;){var c=IteratorStep(a);if(!c)return n.length=s,n;var u=c.value;try{n[s]=u}catch(t){try{IteratorClose(a)}finally{throw t}}s++}}function Type(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function IsUndefined(t){return void 0===t}function IsNull(t){return null===t}function IsObject(t){return"object"==typeof t?null!==t:"function"==typeof t}function ToPrimitive(t,e){switch(Type(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var n=3===e?"string":5===e?"number":"default",r=GetMethod(t,i);if(void 0!==r){var o=r.call(t,n);if(IsObject(o))throw new TypeError;return o}return function OrdinaryToPrimitive(t,e){if("string"===e){var n=t.toString;if(IsCallable(n)){var r=n.call(t);if(!IsObject(r))return r}var i=t.valueOf;if(IsCallable(i)){var r=i.call(t);if(!IsObject(r))return r}}else{var i=t.valueOf;if(IsCallable(i)){var r=i.call(t);if(!IsObject(r))return r}var o=t.toString;if(IsCallable(o)){var r=o.call(t);if(!IsObject(r))return r}}throw new TypeError}(t,"default"===n?"number":n)}function ToPropertyKey(t){var e=ToPrimitive(t,3);return function IsSymbol(t){return"symbol"==typeof t}(e)?e:function ToString(t){return""+t}(e)}function IsArray(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function IsCallable(t){return"function"==typeof t}function IsConstructor(t){return"function"==typeof t}function GetMethod(t,e){var n=t[e];if(null!=n){if(!IsCallable(n))throw new TypeError;return n}}function IteratorStep(t){var e=t.next();return!e.done&&e}function IteratorClose(t){var e=t.return;e&&e.call(t)}function OrdinaryGetPrototypeOf(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===l)return e;if(e!==l)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!=typeof i?e:i===t?e:i}function MakeDictionary(t){return t.__=void 0,delete t.__,t}e("decorate",function decorate(t,e,n,r){if(IsUndefined(n)){if(!IsArray(t))throw new TypeError;if(!IsConstructor(e))throw new TypeError;return function DecorateConstructor(t,e){for(var n=t.length-1;n>=0;--n){var r=t[n],i=r(e);if(!IsUndefined(i)&&!IsNull(i)){if(!IsConstructor(i))throw new TypeError;e=i}}return e}(t,e)}if(!IsArray(t))throw new TypeError;if(!IsObject(e))throw new TypeError;if(!IsObject(r)&&!IsUndefined(r)&&!IsNull(r))throw new TypeError;return IsNull(r)&&(r=void 0),n=ToPropertyKey(n),function DecorateProperty(t,e,n,r){for(var i=t.length-1;i>=0;--i){var o=t[i],a=o(e,n,r);if(!IsUndefined(a)&&!IsNull(a)){if(!IsObject(a))throw new TypeError;r=a}}return r}(t,e,n,r)}),e("metadata",function metadata(t,e){return function decorator(n,r){if(!IsObject(n))throw new TypeError;if(!IsUndefined(r)&&!function IsPropertyKey(t){switch(Type(t)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;OrdinaryDefineOwnMetadata(t,e,n,r)}}),e("defineMetadata",function defineMetadata(t,e,n,r){if(!IsObject(n))throw new TypeError;IsUndefined(r)||(r=ToPropertyKey(r));return OrdinaryDefineOwnMetadata(t,e,n,r)}),e("hasMetadata",function hasMetadata(t,e,n){if(!IsObject(e))throw new TypeError;IsUndefined(n)||(n=ToPropertyKey(n));return function OrdinaryHasMetadata(t,e,n){var r=OrdinaryHasOwnMetadata(t,e,n);if(r)return!0;var i=OrdinaryGetPrototypeOf(e);if(!IsNull(i))return OrdinaryHasMetadata(t,i,n);return!1}(t,e,n)}),e("hasOwnMetadata",function hasOwnMetadata(t,e,n){if(!IsObject(e))throw new TypeError;IsUndefined(n)||(n=ToPropertyKey(n));return OrdinaryHasOwnMetadata(t,e,n)}),e("getMetadata",function getMetadata(t,e,n){if(!IsObject(e))throw new TypeError;IsUndefined(n)||(n=ToPropertyKey(n));return function OrdinaryGetMetadata(t,e,n){var r=OrdinaryHasOwnMetadata(t,e,n);if(r)return OrdinaryGetOwnMetadata(t,e,n);var i=OrdinaryGetPrototypeOf(e);if(!IsNull(i))return OrdinaryGetMetadata(t,i,n);return}(t,e,n)}),e("getOwnMetadata",function getOwnMetadata(t,e,n){if(!IsObject(e))throw new TypeError;IsUndefined(n)||(n=ToPropertyKey(n));return OrdinaryGetOwnMetadata(t,e,n)}),e("getMetadataKeys",function getMetadataKeys(t,e){if(!IsObject(t))throw new TypeError;IsUndefined(e)||(e=ToPropertyKey(e));return function OrdinaryMetadataKeys(t,e){var n=OrdinaryOwnMetadataKeys(t,e);var r=OrdinaryGetPrototypeOf(t);if(null===r)return n;var i=OrdinaryMetadataKeys(r,e);if(i.length<=0)return n;if(n.length<=0)return i;var o=new f;var a=[];for(var s=0,c=n;s<c.length;s++){var u=c[s],l=o.has(u);l||(o.add(u),a.push(u))}for(var p=0,h=i;p<h.length;p++){var u=h[p],l=o.has(u);l||(o.add(u),a.push(u))}return a}(t,e)}),e("getOwnMetadataKeys",function getOwnMetadataKeys(t,e){if(!IsObject(t))throw new TypeError;IsUndefined(e)||(e=ToPropertyKey(e));return OrdinaryOwnMetadataKeys(t,e)}),e("deleteMetadata",function deleteMetadata(t,e,n){if(!IsObject(e))throw new TypeError;IsUndefined(n)||(n=ToPropertyKey(n));var r=GetOrCreateMetadataMap(e,n,!1);if(IsUndefined(r))return!1;if(!r.delete(t))return!1;if(r.size>0)return!0;var i=d.get(e);return i.delete(n),i.size>0||(d.delete(e),!0)})}(o)}()}(n||(n={}))}).call(this,n(11),n(4))},function(t,e,n){var r=n(57),i=n(58),o=i;o.v1=r,o.v4=i,t.exports=o},function(t,e,n){var r,i,o=n(28),a=n(29),s=0,c=0;t.exports=function v1(t,e,n){var u=e&&n||0,l=e||[],p=(t=t||{}).node||r,h=void 0!==t.clockseq?t.clockseq:i;if(null==p||null==h){var f=o();null==p&&(p=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==h&&(h=i=16383&(f[6]<<8|f[7]))}var d=void 0!==t.msecs?t.msecs:(new Date).getTime(),y=void 0!==t.nsecs?t.nsecs:c+1,m=d-s+(y-c)/1e4;if(m<0&&void 0===t.clockseq&&(h=h+1&16383),(m<0||d>s)&&void 0===t.nsecs&&(y=0),y>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=d,c=y,i=h;var v=(1e4*(268435455&(d+=122192928e5))+y)%4294967296;l[u++]=v>>>24&255,l[u++]=v>>>16&255,l[u++]=v>>>8&255,l[u++]=255&v;var g=d/4294967296*1e4&268435455;l[u++]=g>>>8&255,l[u++]=255&g,l[u++]=g>>>24&15|16,l[u++]=g>>>16&255,l[u++]=h>>>8|128,l[u++]=255&h;for(var _=0;_<6;++_)l[u+_]=p[_];return e||a(l)}},function(t,e,n){var r=n(28),i=n(29);t.exports=function v4(t,e,n){var o=e&&n||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var a=(t=t||{}).random||(t.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var s=0;s<16;++s)e[o+s]=a[s];return e||i(a)}},function(t,e,n){(function(t,e){!function(t,n){"use strict";if(!t.setImmediate){var r,i=1,o={},a=!1,s=t.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(t);c=c&&c.setTimeout?c:t,"[object process]"==={}.toString.call(t.process)?function installNextTickImplementation(){r=function(t){e.nextTick(function(){runIfPresent(t)})}}():!function canUsePostMessage(){if(t.postMessage&&!t.importScripts){var e=!0,n=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=n,e}}()?t.MessageChannel?function installMessageChannelImplementation(){var t=new MessageChannel;t.port1.onmessage=function(t){runIfPresent(t.data)},r=function(e){t.port2.postMessage(e)}}():s&&"onreadystatechange"in s.createElement("script")?function installReadyStateChangeImplementation(){var t=s.documentElement;r=function(e){var n=s.createElement("script");n.onreadystatechange=function(){runIfPresent(e),n.onreadystatechange=null,t.removeChild(n),n=null},t.appendChild(n)}}():function installSetTimeoutImplementation(){r=function(t){setTimeout(runIfPresent,0,t)}}():function installPostMessageImplementation(){var e="setImmediate$"+Math.random()+"$",n=function(n){n.source===t&&"string"==typeof n.data&&0===n.data.indexOf(e)&&runIfPresent(+n.data.slice(e.length))};t.addEventListener?t.addEventListener("message",n,!1):t.attachEvent("onmessage",n),r=function(n){t.postMessage(e+n,"*")}}(),c.setImmediate=function setImmediate(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),n=0;n<e.length;n++)e[n]=arguments[n+1];var a={callback:t,args:e};return o[i]=a,r(i),i++},c.clearImmediate=clearImmediate}function clearImmediate(t){delete o[t]}function runIfPresent(t){if(a)setTimeout(runIfPresent,0,t);else{var e=o[t];if(e){a=!0;try{!function run(t){var e=t.callback,r=t.args;switch(r.length){case 0:e();break;case 1:e(r[0]);break;case 2:e(r[0],r[1]);break;case 3:e(r[0],r[1],r[2]);break;default:e.apply(n,r)}}(e)}finally{clearImmediate(t),a=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,n(4),n(11))},function(t,e,n){"use strict";var r,i=this&&this.__extends||(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function __(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});Object.defineProperty(e,"__esModule",{value:!0});var o,a=n(61),s=n(19),c=n(31),u=n(30);!function(t){t[t.Sync=0]="Sync",t[t.Async=1]="Async",t[t.Queued=2]="Queued"}(o=e.EventType||(e.EventType={}));var l=function(){function AnyEvent(t){this._events=[],t&&t.monitorAttach&&(this.evtFirstAttached=new p,this.evtLastDetached=new p)}return AnyEvent.prototype.attach=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=o.Sync;t.length>0&&"number"==typeof t[0]&&(n=t.shift());var r,i,a,s=this;"function"==typeof t[0]||t[0]&&"object"==typeof t[0]&&"function"==typeof t[0].post?("function"==typeof t[0]?r=t[0]:a=t[0],i=t[1]):(s=t[0],r=t[1],i=t[2]),this._attach(n,s,r,a,i,!1)},AnyEvent.prototype.once=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=o.Sync;t.length>0&&"number"==typeof t[0]&&(n=t.shift());var r,i,a,s=this;"function"==typeof t[0]||t[0]&&"object"==typeof t[0]&&"function"==typeof t[0].post?("function"==typeof t[0]?r=t[0]:a=t[0],i=t[1]):(s=t[0],r=t[1],i=t[2]),this._attach(n,s,r,a,i,!0)},AnyEvent.prototype._attach=function(t,e,n,r,i,l){var p,h=this.evtFirstAttached?this.listenerCount():0;switch(t){case o.Sync:for(var f=0,d=this._events;f<d.length;f++){(_=d[f])instanceof s.SyncEvent&&(p=_)}p||(p=new s.SyncEvent,this._events.push(p));break;case o.Async:for(var y=0,m=this._events;y<m.length;y++){(_=m[y])instanceof c.AsyncEvent&&a.shallowEquals(_.options,i)&&(p=_)}p||(p=new c.AsyncEvent(i),this._events.push(p));break;case o.Queued:for(var v=0,g=this._events;v<g.length;v++){var _;(_=g[v])instanceof u.QueuedEvent&&a.shallowEquals(_.options,i)&&(p=_)}p||(p=new u.QueuedEvent(i),this._events.push(p));break;default:throw new Error("unknown EventType")}l?r?p.once(r):p.once(e,n):r?p.attach(r):p.attach(e,n),this.evtFirstAttached&&0===h&&this.evtFirstAttached.post()},AnyEvent.prototype.attachSync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift(o.Sync),this.attach.apply(this,t)},AnyEvent.prototype.onceSync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift(o.Sync),this.once.apply(this,t)},AnyEvent.prototype.attachAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift(o.Async),this.attach.apply(this,t)},AnyEvent.prototype.onceAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift(o.Async),this.once.apply(this,t)},AnyEvent.prototype.attachQueued=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift(o.Queued),this.attach.apply(this,t)},AnyEvent.prototype.onceQueued=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift(o.Queued),this.once.apply(this,t)},AnyEvent.prototype.detach=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this.evtLastDetached?this.listenerCount():0,r=0;r<this._events.length;++r)this._events[r].detach.apply(this._events[r],t);this.evtLastDetached&&n>0&&0===this.listenerCount()&&this.evtLastDetached.post()},AnyEvent.prototype.post=function(t){for(var e=[],n=0;n<this._events.length;++n)e.push(this._events[n]);for(n=0;n<e.length;++n)e[n].post(t)},AnyEvent.prototype.listenerCount=function(){for(var t=0,e=0;e<this._events.length;++e)t+=this._events[e].listenerCount();return t},AnyEvent}();e.AnyEvent=l;var p=function(t){function VoidAnyEvent(){return null!==t&&t.apply(this,arguments)||this}return i(VoidAnyEvent,t),VoidAnyEvent.prototype.post=function(){t.prototype.post.call(this,void 0)},VoidAnyEvent}(l);e.VoidAnyEvent=p;var h=function(t){function ErrorAnyEvent(){return null!==t&&t.apply(this,arguments)||this}return i(ErrorAnyEvent,t),ErrorAnyEvent.prototype.post=function(e){if(0===this.listenerCount())throw new Error("error event posted while no listeners attached. Error: "+e.message);t.prototype.post.call(this,e)},ErrorAnyEvent}(l);e.ErrorAnyEvent=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shallowEquals=function shallowEquals(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;switch(typeof t){case"boolean":case"number":case"string":case"function":case"symbol":case"undefined":return!1;case"object":if(null===t||null===e)return!1;if(Array.isArray(t)||Array.isArray(e)){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}var r=[],i=[];for(var o in t)t.hasOwnProperty(o)&&r.push(o);for(var a in e)e.hasOwnProperty(a)&&i.push(a);if(r.sort(),i.sort(),r.join(",")!==i.join(","))return!1;for(n=0;n<r.length;++n)if(t[r[n]]!==e[r[n]])return!1;return!0;default:return!1}}},function(t,e,n){"use strict";e.byteLength=function byteLength(t){var e=getLens(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function toByteArray(t){for(var e,n=getLens(t),r=n[0],a=n[1],s=new o(function _byteLength(t,e,n){return 3*(e+n)/4-n}(0,r,a)),c=0,u=a>0?r-4:r,l=0;l<u;l+=4)e=i[t.charCodeAt(l)]<<18|i[t.charCodeAt(l+1)]<<12|i[t.charCodeAt(l+2)]<<6|i[t.charCodeAt(l+3)],s[c++]=e>>16&255,s[c++]=e>>8&255,s[c++]=255&e;2===a&&(e=i[t.charCodeAt(l)]<<2|i[t.charCodeAt(l+1)]>>4,s[c++]=255&e);1===a&&(e=i[t.charCodeAt(l)]<<10|i[t.charCodeAt(l+1)]<<4|i[t.charCodeAt(l+2)]>>2,s[c++]=e>>8&255,s[c++]=255&e);return s},e.fromByteArray=function fromByteArray(t){for(var e,n=t.length,i=n%3,o=[],a=0,s=n-i;a<s;a+=16383)o.push(encodeChunk(t,a,a+16383>s?s:a+16383));1===i?(e=t[n-1],o.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],o.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=a.length;s<c;++s)r[s]=a[s],i[a.charCodeAt(s)]=s;function getLens(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function encodeChunk(t,e,n){for(var i,o,a=[],s=e;s<n;s+=3)i=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),a.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,r,i){var o,a,s=8*i-r-1,c=(1<<s)-1,u=c>>1,l=-7,p=n?i-1:0,h=n?-1:1,f=t[e+p];for(p+=h,o=f&(1<<-l)-1,f>>=-l,l+=s;l>0;o=256*o+t[e+p],p+=h,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+t[e+p],p+=h,l-=8);if(0===o)o=1-u;else{if(o===c)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),o-=u}return(f?-1:1)*a*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var a,s,c,u=8*o-i-1,l=(1<<u)-1,p=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:o-1,d=r?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),(e+=a+p>=1?h/c:h*Math.pow(2,1-p))*c>=2&&(a++,c/=2),a+p>=l?(s=0,a=l):a+p>=1?(s=(e*c-1)*Math.pow(2,i),a+=p):(s=e*Math.pow(2,p-1)*Math.pow(2,i),a=0));i>=8;t[n+f]=255&s,f+=d,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;t[n+f]=255&a,f+=d,a/=256,u-=8);t[n+f-d]|=128*y}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){"use strict";function JSZip(){if(!(this instanceof JSZip))return new JSZip;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new JSZip;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}JSZip.prototype=n(66),JSZip.prototype.loadAsync=n(97),JSZip.support=n(5),JSZip.defaults=n(40),JSZip.version="3.2.0",JSZip.loadAsync=function(t,e){return(new JSZip).loadAsync(t,e)},JSZip.external=n(13),t.exports=JSZip},function(t,e,n){"use strict";var r=n(9),i=n(1),o=n(3),a=n(39),s=n(40),c=n(25),u=n(83),l=n(84),p=n(18),h=n(96),f=function(t,e,n){var r,a=i.getTypeOf(e),l=i.extend(n||{},s);l.date=l.date||new Date,null!==l.compression&&(l.compression=l.compression.toUpperCase()),"string"==typeof l.unixPermissions&&(l.unixPermissions=parseInt(l.unixPermissions,8)),l.unixPermissions&&16384&l.unixPermissions&&(l.dir=!0),l.dosPermissions&&16&l.dosPermissions&&(l.dir=!0),l.dir&&(t=y(t)),l.createFolders&&(r=d(t))&&m.call(this,r,!0);var f="string"===a&&!1===l.binary&&!1===l.base64;n&&void 0!==n.binary||(l.binary=!f),(e instanceof c&&0===e.uncompressedSize||l.dir||!e||0===e.length)&&(l.base64=!1,l.binary=!0,e="",l.compression="STORE",a="string");var v=null;v=e instanceof c||e instanceof o?e:p.isNode&&p.isStream(e)?new h(t,e):i.prepareContent(t,e,l.binary,l.optimizedBinaryString,l.base64);var g=new u(t,v,l);this.files[t]=g},d=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return e>0?t.substring(0,e):""},y=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},m=function(t,e){return e=void 0!==e?e:s.createFolders,t=y(t),this.files[t]||f.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function isRegExp(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,n,r;for(e in this.files)this.files.hasOwnProperty(e)&&(r=this.files[e],(n=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(n,r))},filter:function(t){var e=[];return this.forEach(function(n,r){t(n,r)&&e.push(r)}),e},file:function(t,e,n){if(1===arguments.length){if(isRegExp(t)){var r=t;return this.filter(function(t,e){return!e.dir&&r.test(t)})}var i=this.files[this.root+t];return i&&!i.dir?i:null}return t=this.root+t,f.call(this,t,e,n),this},folder:function(t){if(!t)return this;if(isRegExp(t))return this.filter(function(e,n){return n.dir&&t.test(e)});var e=this.root+t,n=m.call(this,e),r=this.clone();return r.root=n.name,r},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var n=this.filter(function(e,n){return n.name.slice(0,t.length)===t}),r=0;r<n.length;r++)delete this.files[n[r].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,n={};try{if((n=i.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=n.type.toLowerCase(),n.compression=n.compression.toUpperCase(),"binarystring"===n.type&&(n.type="string"),!n.type)throw new Error("No output type specified.");i.checkSupport(n.type),"darwin"!==n.platform&&"freebsd"!==n.platform&&"linux"!==n.platform&&"sunos"!==n.platform||(n.platform="UNIX"),"win32"===n.platform&&(n.platform="DOS");var s=n.comment||this.comment||"";e=l.generateWorker(this,n,s)}catch(t){(e=new o("error")).error(t)}return new a(e,n.type||"string",n.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};t.exports=v},function(t,e,n){t.exports=Stream;var r=n(22).EventEmitter;function Stream(){r.call(this)}n(10)(Stream,r),Stream.Readable=n(23),Stream.Writable=n(74),Stream.Duplex=n(75),Stream.Transform=n(76),Stream.PassThrough=n(77),Stream.Stream=Stream,Stream.prototype.pipe=function(t,e){var n=this;function ondata(e){t.writable&&!1===t.write(e)&&n.pause&&n.pause()}function ondrain(){n.readable&&n.resume&&n.resume()}n.on("data",ondata),t.on("drain",ondrain),t._isStdio||e&&!1===e.end||(n.on("end",onend),n.on("close",onclose));var i=!1;function onend(){i||(i=!0,t.end())}function onclose(){i||(i=!0,"function"==typeof t.destroy&&t.destroy())}function onerror(t){if(cleanup(),0===r.listenerCount(this,"error"))throw t}function cleanup(){n.removeListener("data",ondata),t.removeListener("drain",ondrain),n.removeListener("end",onend),n.removeListener("close",onclose),n.removeListener("error",onerror),t.removeListener("error",onerror),n.removeListener("end",cleanup),n.removeListener("close",cleanup),t.removeListener("close",cleanup)}return n.on("error",onerror),t.on("error",onerror),n.on("end",cleanup),n.on("close",cleanup),t.on("close",cleanup),t.emit("pipe",n),t}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e){},function(t,e,n){"use strict";var r=n(17).Buffer,i=n(71);t.exports=function(){function BufferList(){!function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,BufferList),this.head=null,this.tail=null,this.length=0}return BufferList.prototype.push=function push(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},BufferList.prototype.unshift=function unshift(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},BufferList.prototype.shift=function shift(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},BufferList.prototype.clear=function clear(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function join(t){if(0===this.length)return"";for(var e=this.head,n=""+e.data;e=e.next;)n+=t+e.data;return n},BufferList.prototype.concat=function concat(t){if(0===this.length)return r.alloc(0);if(1===this.length)return this.head.data;for(var e,n,i,o=r.allocUnsafe(t>>>0),a=this.head,s=0;a;)e=a.data,n=o,i=s,e.copy(n,i),s+=a.data.length,a=a.next;return o},BufferList}(),i&&i.inspect&&i.inspect.custom&&(t.exports.prototype[i.inspect.custom]=function(){var t=i.inspect({length:this.length});return this.constructor.name+" "+t})},function(t,e){},function(t,e,n){(function(e){function config(t){try{if(!e.localStorage)return!1}catch(t){return!1}var n=e.localStorage[t];return null!=n&&"true"===String(n).toLowerCase()}t.exports=function deprecate(t,e){if(config("noDeprecation"))return t;var n=!1;return function deprecated(){if(!n){if(config("throwDeprecation"))throw new Error(e);config("traceDeprecation")?console.trace(e):console.warn(e),n=!0}return t.apply(this,arguments)}}}).call(this,n(4))},function(t,e,n){"use strict";t.exports=PassThrough;var r=n(37),i=n(12);function PassThrough(t){if(!(this instanceof PassThrough))return new PassThrough(t);r.call(this,t)}i.inherits=n(10),i.inherits(PassThrough,r),PassThrough.prototype._transform=function(t,e,n){n(null,t)}},function(t,e,n){t.exports=n(24)},function(t,e,n){t.exports=n(7)},function(t,e,n){t.exports=n(23).Transform},function(t,e,n){t.exports=n(23).PassThrough},function(t,e,n){"use strict";(function(e){t.exports="function"==typeof e?e:function setImmediate(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}}).call(this,n(21).setImmediate)},function(t,e,n){"use strict";var r=n(80);function INTERNAL(){}var i={},o=["REJECTED"],a=["FULFILLED"],s=["PENDING"];function Promise(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,t!==INTERNAL&&safelyResolveThenable(this,t)}function QueueItem(t,e,n){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function unwrap(t,e,n){r(function(){var r;try{r=e(n)}catch(e){return i.reject(t,e)}r===t?i.reject(t,new TypeError("Cannot resolve promise with itself")):i.resolve(t,r)})}function getThen(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function appyThen(){e.apply(t,arguments)}}function safelyResolveThenable(t,e){var n=!1;function onError(e){n||(n=!0,i.reject(t,e))}function onSuccess(e){n||(n=!0,i.resolve(t,e))}var r=tryCatch(function tryToUnwrap(){e(onSuccess,onError)});"error"===r.status&&onError(r.value)}function tryCatch(t,e){var n={};try{n.value=t(e),n.status="success"}catch(t){n.status="error",n.value=t}return n}t.exports=Promise,Promise.prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then(function resolve(n){return e.resolve(t()).then(function yes(){return n})},function reject(n){return e.resolve(t()).then(function no(){throw n})})},Promise.prototype.catch=function(t){return this.then(null,t)},Promise.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===o)return this;var n=new this.constructor(INTERNAL);this.state!==s?unwrap(n,this.state===a?t:e,this.outcome):this.queue.push(new QueueItem(n,t,e));return n},QueueItem.prototype.callFulfilled=function(t){i.resolve(this.promise,t)},QueueItem.prototype.otherCallFulfilled=function(t){unwrap(this.promise,this.onFulfilled,t)},QueueItem.prototype.callRejected=function(t){i.reject(this.promise,t)},QueueItem.prototype.otherCallRejected=function(t){unwrap(this.promise,this.onRejected,t)},i.resolve=function(t,e){var n=tryCatch(getThen,e);if("error"===n.status)return i.reject(t,n.value);var r=n.value;if(r)safelyResolveThenable(t,r);else{t.state=a,t.outcome=e;for(var o=-1,s=t.queue.length;++o<s;)t.queue[o].callFulfilled(e)}return t},i.reject=function(t,e){t.state=o,t.outcome=e;for(var n=-1,r=t.queue.length;++n<r;)t.queue[n].callRejected(e);return t},Promise.resolve=function resolve(t){if(t instanceof this)return t;return i.resolve(new this(INTERNAL),t)},Promise.reject=function reject(t){var e=new this(INTERNAL);return i.reject(e,t)},Promise.all=function all(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);var o=new Array(n),a=0,s=-1,c=new this(INTERNAL);for(;++s<n;)allResolver(t[s],s);return c;function allResolver(t,s){e.resolve(t).then(function resolveFromAll(t){o[s]=t,++a!==n||r||(r=!0,i.resolve(c,o))},function(t){r||(r=!0,i.reject(c,t))})}},Promise.race=function race(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var n=t.length,r=!1;if(!n)return this.resolve([]);var o=-1,a=new this(INTERNAL);for(;++o<n;)s=t[o],e.resolve(s).then(function(t){r||(r=!0,i.resolve(a,t))},function(t){r||(r=!0,i.reject(a,t))});var s;return a}},function(t,e,n){"use strict";(function(e){var n,r,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,a=new i(nextTick),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){nextTick(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(nextTick,0)};else{var c=new e.MessageChannel;c.port1.onmessage=nextTick,n=function(){c.port2.postMessage(0)}}var u=[];function nextTick(){var t,e;r=!0;for(var n=u.length;n;){for(e=u,u=[],t=-1;++t<n;)e[t]();n=u.length}r=!1}t.exports=function immediate(t){1!==u.push(t)||r||n()}}).call(this,n(4))},function(t,e,n){"use strict";var r=n(3),i=n(1);function ConvertWorker(t){r.call(this,"ConvertWorker to "+t),this.destType=t}i.inherits(ConvertWorker,r),ConvertWorker.prototype.processChunk=function(t){this.push({data:i.transformTo(this.destType,t.data),meta:t.meta})},t.exports=ConvertWorker},function(t,e,n){"use strict";var r=n(32).Readable;function NodejsStreamOutputAdapter(t,e,n){r.call(this,e),this._helper=t;var i=this;t.on("data",function(t,e){i.push(t)||i._helper.pause(),n&&n(e)}).on("error",function(t){i.emit("error",t)}).on("end",function(){i.push(null)})}n(1).inherits(NodejsStreamOutputAdapter,r),NodejsStreamOutputAdapter.prototype._read=function(){this._helper.resume()},t.exports=NodejsStreamOutputAdapter},function(t,e,n){"use strict";var r=n(39),i=n(41),o=n(9),a=n(25),s=n(3),c=function(t,e,n){this.name=t,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this.unixPermissions=n.unixPermissions,this.dosPermissions=n.dosPermissions,this._data=e,this._dataBinary=n.binary,this.options={compression:n.compression,compressionOptions:n.compressionOptions}};c.prototype={internalStream:function(t){var e=null,n="string";try{if(!t)throw new Error("No output type specified.");var i="string"===(n=t.toLowerCase())||"text"===n;"binarystring"!==n&&"text"!==n||(n="string"),e=this._decompressWorker();var a=!this._dataBinary;a&&!i&&(e=e.pipe(new o.Utf8EncodeWorker)),!a&&i&&(e=e.pipe(new o.Utf8DecodeWorker))}catch(t){(e=new s("error")).error(t)}return new r(e,n,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof a&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var n=this._decompressWorker();return this._dataBinary||(n=n.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(n,t,e)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof s?this._data:new i(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],l=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<u.length;p++)c.prototype[u[p]]=l;t.exports=c},function(t,e,n){"use strict";var r=n(44),i=n(95);e.generateWorker=function(t,e,n){var o=new i(e.streamFiles,n,e.platform,e.encodeFileName),a=0;try{t.forEach(function(t,n){a++;var i=function(t,e){var n=t||e,i=r[n];if(!i)throw new Error(n+" is not a valid compression method !");return i}(n.options.compression,e.compression),s=n.options.compressionOptions||e.compressionOptions||{},c=n.dir,u=n.date;n._compressWorker(i,s).withStreamInfo("file",{name:t,dir:c,date:u,comment:n.comment||"",unixPermissions:n.unixPermissions,dosPermissions:n.dosPermissions}).pipe(o)}),o.entriesCount=a}catch(t){o.error(t)}return o}},function(t,e,n){"use strict";var r="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=n(86),o=n(1),a=n(3),s=r?"uint8array":"array";function FlateWorker(t,e){a.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}e.magic="\b\0",o.inherits(FlateWorker,a),FlateWorker.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(o.transformTo(s,t.data),!1)},FlateWorker.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},FlateWorker.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},FlateWorker.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},e.compressWorker=function(t){return new FlateWorker("Deflate",t)},e.uncompressWorker=function(){return new FlateWorker("Inflate",{})}},function(t,e,n){"use strict";var r={};(0,n(6).assign)(r,n(87),n(90),n(49)),t.exports=r},function(t,e,n){"use strict";var r=n(88),i=n(6),o=n(47),a=n(27),s=n(48),c=Object.prototype.toString,u=0,l=-1,p=0,h=8;function Deflate(t){if(!(this instanceof Deflate))return new Deflate(t);this.options=i.assign({level:l,method:h,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=r.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==u)throw new Error(a[n]);if(e.header&&r.deflateSetHeader(this.strm,e.header),e.dictionary){var f;if(f="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(n=r.deflateSetDictionary(this.strm,f))!==u)throw new Error(a[n]);this._dict_set=!0}}function deflate(t,e){var n=new Deflate(e);if(n.push(t,!0),n.err)throw n.msg||a[n.err];return n.result}Deflate.prototype.push=function(t,e){var n,a,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0,"string"==typeof t?s.input=o.string2buf(t):"[object ArrayBuffer]"===c.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(l),s.next_out=0,s.avail_out=l),1!==(n=r.deflate(s,a))&&n!==u)return this.onEnd(n),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==n);return 4===a?(n=r.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===u):2!==a||(this.onEnd(u),s.avail_out=0,!0)},Deflate.prototype.onData=function(t){this.chunks.push(t)},Deflate.prototype.onEnd=function(t){t===u&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=Deflate,e.deflate=deflate,e.deflateRaw=function deflateRaw(t,e){return(e=e||{}).raw=!0,deflate(t,e)},e.gzip=function gzip(t,e){return(e=e||{}).gzip=!0,deflate(t,e)}},function(t,e,n){"use strict";var r,i=n(6),o=n(89),a=n(45),s=n(46),c=n(27),u=0,l=1,p=3,h=4,f=5,d=0,y=1,m=-2,v=-3,g=-5,_=-1,b=1,w=2,x=3,P=4,O=0,C=2,S=8,j=9,R=15,T=8,E=286,B=30,A=19,I=2*E+1,M=15,z=3,k=258,D=k+z+1,F=32,L=42,N=69,V=73,U=91,W=103,q=113,G=666,H=1,K=2,X=3,Q=4,Y=3;function err(t,e){return t.msg=c[e],e}function rank(t){return(t<<1)-(t>4?9:0)}function zero(t){for(var e=t.length;--e>=0;)t[e]=0}function flush_pending(t){var e=t.state,n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(i.arraySet(t.output,e.pending_buf,e.pending_out,n,t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))}function flush_block_only(t,e){o._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,flush_pending(t.strm)}function put_byte(t,e){t.pending_buf[t.pending++]=e}function putShortMSB(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function longest_match(t,e){var n,r,i=t.max_chain_length,o=t.strstart,a=t.prev_length,s=t.nice_match,c=t.strstart>t.w_size-D?t.strstart-(t.w_size-D):0,u=t.window,l=t.w_mask,p=t.prev,h=t.strstart+k,f=u[o+a-1],d=u[o+a];t.prev_length>=t.good_match&&(i>>=2),s>t.lookahead&&(s=t.lookahead);do{if(u[(n=e)+a]===d&&u[n+a-1]===f&&u[n]===u[o]&&u[++n]===u[o+1]){o+=2,n++;do{}while(u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&u[++o]===u[++n]&&o<h);if(r=k-(h-o),o=h-k,r>a){if(t.match_start=e,a=r,r>=s)break;f=u[o+a-1],d=u[o+a]}}}while((e=p[e&l])>c&&0!=--i);return a<=t.lookahead?a:t.lookahead}function fill_window(t){var e,n,r,o,c,u,l,p,h,f,d=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=d+(d-D)){i.arraySet(t.window,t.window,d,d,0),t.match_start-=d,t.strstart-=d,t.block_start-=d,e=n=t.hash_size;do{r=t.head[--e],t.head[e]=r>=d?r-d:0}while(--n);e=n=d;do{r=t.prev[--e],t.prev[e]=r>=d?r-d:0}while(--n);o+=d}if(0===t.strm.avail_in)break;if(u=t.strm,l=t.window,p=t.strstart+t.lookahead,h=o,f=void 0,(f=u.avail_in)>h&&(f=h),n=0===f?0:(u.avail_in-=f,i.arraySet(l,u.input,u.next_in,f,p),1===u.state.wrap?u.adler=a(u.adler,l,f,p):2===u.state.wrap&&(u.adler=s(u.adler,l,f,p)),u.next_in+=f,u.total_in+=f,f),t.lookahead+=n,t.lookahead+t.insert>=z)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+z-1])&t.hash_mask,t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<z)););}while(t.lookahead<D&&0!==t.strm.avail_in)}function deflate_fast(t,e){for(var n,r;;){if(t.lookahead<D){if(fill_window(t),t.lookahead<D&&e===u)return H;if(0===t.lookahead)break}if(n=0,t.lookahead>=z&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+z-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-D&&(t.match_length=longest_match(t,n)),t.match_length>=z)if(r=o._tr_tally(t,t.strstart-t.match_start,t.match_length-z),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=z){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+z-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else r=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(flush_block_only(t,!1),0===t.strm.avail_out))return H}return t.insert=t.strstart<z-1?t.strstart:z-1,e===h?(flush_block_only(t,!0),0===t.strm.avail_out?X:Q):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?H:K}function deflate_slow(t,e){for(var n,r,i;;){if(t.lookahead<D){if(fill_window(t),t.lookahead<D&&e===u)return H;if(0===t.lookahead)break}if(n=0,t.lookahead>=z&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+z-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=z-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-D&&(t.match_length=longest_match(t,n),t.match_length<=5&&(t.strategy===b||t.match_length===z&&t.strstart-t.match_start>4096)&&(t.match_length=z-1)),t.prev_length>=z&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-z,r=o._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-z),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+z-1])&t.hash_mask,n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=z-1,t.strstart++,r&&(flush_block_only(t,!1),0===t.strm.avail_out))return H}else if(t.match_available){if((r=o._tr_tally(t,0,t.window[t.strstart-1]))&&flush_block_only(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return H}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=o._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<z-1?t.strstart:z-1,e===h?(flush_block_only(t,!0),0===t.strm.avail_out?X:Q):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?H:K}function Config(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*I),this.dyn_dtree=new i.Buf16(2*(2*B+1)),this.bl_tree=new i.Buf16(2*(2*A+1)),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(M+1),this.heap=new i.Buf16(2*E+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*E+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=C,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?L:q,t.adler=2===e.wrap?0:1,e.last_flush=u,o._tr_init(e),d):err(t,m)}function deflateReset(t){var e=deflateResetKeep(t);return e===d&&function lm_init(t){t.window_size=2*t.w_size,zero(t.head),t.max_lazy_match=r[t.level].max_lazy,t.good_match=r[t.level].good_length,t.nice_match=r[t.level].nice_length,t.max_chain_length=r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=z-1,t.match_available=0,t.ins_h=0}(t.state),e}function deflateInit2(t,e,n,r,o,a){if(!t)return m;var s=1;if(e===_&&(e=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),o<1||o>j||n!==S||r<8||r>15||e<0||e>9||a<0||a>P)return err(t,m);8===r&&(r=9);var c=new DeflateState;return t.state=c,c.strm=t,c.wrap=s,c.gzhead=null,c.w_bits=r,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=o+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+z-1)/z),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<o+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=e,c.strategy=a,c.method=n,deflateReset(t)}r=[new Config(0,0,0,0,function deflate_stored(t,e){var n=65535;for(n>t.pending_buf_size-5&&(n=t.pending_buf_size-5);;){if(t.lookahead<=1){if(fill_window(t),0===t.lookahead&&e===u)return H;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var r=t.block_start+n;if((0===t.strstart||t.strstart>=r)&&(t.lookahead=t.strstart-r,t.strstart=r,flush_block_only(t,!1),0===t.strm.avail_out))return H;if(t.strstart-t.block_start>=t.w_size-D&&(flush_block_only(t,!1),0===t.strm.avail_out))return H}return t.insert=0,e===h?(flush_block_only(t,!0),0===t.strm.avail_out?X:Q):(t.strstart>t.block_start&&(flush_block_only(t,!1),t.strm.avail_out),H)}),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],e.deflateInit=function deflateInit(t,e){return deflateInit2(t,e,S,R,T,O)},e.deflateInit2=deflateInit2,e.deflateReset=deflateReset,e.deflateResetKeep=deflateResetKeep,e.deflateSetHeader=function deflateSetHeader(t,e){return t&&t.state?2!==t.state.wrap?m:(t.state.gzhead=e,d):m},e.deflate=function deflate(t,e){var n,i,a,c;if(!t||!t.state||e>f||e<0)return t?err(t,m):m;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||i.status===G&&e!==h)return err(t,0===t.avail_out?g:m);if(i.strm=t,n=i.last_flush,i.last_flush=e,i.status===L)if(2===i.wrap)t.adler=0,put_byte(i,31),put_byte(i,139),put_byte(i,8),i.gzhead?(put_byte(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),put_byte(i,255&i.gzhead.time),put_byte(i,i.gzhead.time>>8&255),put_byte(i,i.gzhead.time>>16&255),put_byte(i,i.gzhead.time>>24&255),put_byte(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),put_byte(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(put_byte(i,255&i.gzhead.extra.length),put_byte(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=s(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=N):(put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),put_byte(i,Y),i.status=q);else{var v=S+(i.w_bits-8<<4)<<8;v|=(i.strategy>=w||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(v|=F),v+=31-v%31,i.status=q,putShortMSB(i,v),0!==i.strstart&&(putShortMSB(i,t.adler>>>16),putShortMSB(i,65535&t.adler)),t.adler=1}if(i.status===N)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),flush_pending(t),a=i.pending,i.pending!==i.pending_buf_size));)put_byte(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=V)}else i.status=V;if(i.status===V)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),flush_pending(t),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,put_byte(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.gzindex=0,i.status=U)}else i.status=U;if(i.status===U)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),flush_pending(t),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,put_byte(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.status=W)}else i.status=W;if(i.status===W&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&flush_pending(t),i.pending+2<=i.pending_buf_size&&(put_byte(i,255&t.adler),put_byte(i,t.adler>>8&255),t.adler=0,i.status=q)):i.status=q),0!==i.pending){if(flush_pending(t),0===t.avail_out)return i.last_flush=-1,d}else if(0===t.avail_in&&rank(e)<=rank(n)&&e!==h)return err(t,g);if(i.status===G&&0!==t.avail_in)return err(t,g);if(0!==t.avail_in||0!==i.lookahead||e!==u&&i.status!==G){var _=i.strategy===w?function deflate_huff(t,e){for(var n;;){if(0===t.lookahead&&(fill_window(t),0===t.lookahead)){if(e===u)return H;break}if(t.match_length=0,n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(flush_block_only(t,!1),0===t.strm.avail_out))return H}return t.insert=0,e===h?(flush_block_only(t,!0),0===t.strm.avail_out?X:Q):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?H:K}(i,e):i.strategy===x?function deflate_rle(t,e){for(var n,r,i,a,s=t.window;;){if(t.lookahead<=k){if(fill_window(t),t.lookahead<=k&&e===u)return H;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=z&&t.strstart>0&&(r=s[i=t.strstart-1])===s[++i]&&r===s[++i]&&r===s[++i]){a=t.strstart+k;do{}while(r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&r===s[++i]&&i<a);t.match_length=k-(a-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=z?(n=o._tr_tally(t,1,t.match_length-z),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(flush_block_only(t,!1),0===t.strm.avail_out))return H}return t.insert=0,e===h?(flush_block_only(t,!0),0===t.strm.avail_out?X:Q):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?H:K}(i,e):r[i.level].func(i,e);if(_!==X&&_!==Q||(i.status=G),_===H||_===X)return 0===t.avail_out&&(i.last_flush=-1),d;if(_===K&&(e===l?o._tr_align(i):e!==f&&(o._tr_stored_block(i,0,0,!1),e===p&&(zero(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),flush_pending(t),0===t.avail_out))return i.last_flush=-1,d}return e!==h?d:i.wrap<=0?y:(2===i.wrap?(put_byte(i,255&t.adler),put_byte(i,t.adler>>8&255),put_byte(i,t.adler>>16&255),put_byte(i,t.adler>>24&255),put_byte(i,255&t.total_in),put_byte(i,t.total_in>>8&255),put_byte(i,t.total_in>>16&255),put_byte(i,t.total_in>>24&255)):(putShortMSB(i,t.adler>>>16),putShortMSB(i,65535&t.adler)),flush_pending(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?d:y)},e.deflateEnd=function deflateEnd(t){var e;return t&&t.state?(e=t.state.status)!==L&&e!==N&&e!==V&&e!==U&&e!==W&&e!==q&&e!==G?err(t,m):(t.state=null,e===q?err(t,v):d):m},e.deflateSetDictionary=function deflateSetDictionary(t,e){var n,r,o,s,c,u,l,p,h=e.length;if(!t||!t.state)return m;if(2===(s=(n=t.state).wrap)||1===s&&n.status!==L||n.lookahead)return m;for(1===s&&(t.adler=a(t.adler,e,h,0)),n.wrap=0,h>=n.w_size&&(0===s&&(zero(n.head),n.strstart=0,n.block_start=0,n.insert=0),p=new i.Buf8(n.w_size),i.arraySet(p,e,h-n.w_size,n.w_size,0),e=p,h=n.w_size),c=t.avail_in,u=t.next_in,l=t.input,t.avail_in=h,t.next_in=0,t.input=e,fill_window(n);n.lookahead>=z;){r=n.strstart,o=n.lookahead-(z-1);do{n.ins_h=(n.ins_h<<n.hash_shift^n.window[r+z-1])&n.hash_mask,n.prev[r&n.w_mask]=n.head[n.ins_h],n.head[n.ins_h]=r,r++}while(--o);n.strstart=r,n.lookahead=z-1,fill_window(n)}return n.strstart+=n.lookahead,n.block_start=n.strstart,n.insert=n.lookahead,n.lookahead=0,n.match_length=n.prev_length=z-1,n.match_available=0,t.next_in=u,t.input=l,t.avail_in=c,n.wrap=s,d},e.deflateInfo="pako deflate (from Nodeca project)"},function(t,e,n){"use strict";var r=n(6),i=4,o=0,a=1,s=2;function zero(t){for(var e=t.length;--e>=0;)t[e]=0}var c=0,u=1,l=2,p=29,h=256,f=h+1+p,d=30,y=19,m=2*f+1,v=15,g=16,_=7,b=256,w=16,x=17,P=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],C=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],j=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],R=new Array(2*(f+2));zero(R);var T=new Array(2*d);zero(T);var E=new Array(512);zero(E);var B=new Array(256);zero(B);var A=new Array(p);zero(A);var I,M,z,k=new Array(d);function StaticTreeDesc(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}function TreeDesc(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function d_code(t){return t<256?E[t]:E[256+(t>>>7)]}function put_short(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function send_bits(t,e,n){t.bi_valid>g-n?(t.bi_buf|=e<<t.bi_valid&65535,put_short(t,t.bi_buf),t.bi_buf=e>>g-t.bi_valid,t.bi_valid+=n-g):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)}function send_code(t,e,n){send_bits(t,n[2*e],n[2*e+1])}function bi_reverse(t,e){var n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1}function gen_codes(t,e,n){var r,i,o=new Array(v+1),a=0;for(r=1;r<=v;r++)o[r]=a=a+n[r-1]<<1;for(i=0;i<=e;i++){var s=t[2*i+1];0!==s&&(t[2*i]=bi_reverse(o[s]++,s))}}function init_block(t){var e;for(e=0;e<f;e++)t.dyn_ltree[2*e]=0;for(e=0;e<d;e++)t.dyn_dtree[2*e]=0;for(e=0;e<y;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*b]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function bi_windup(t){t.bi_valid>8?put_short(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function smaller(t,e,n,r){var i=2*e,o=2*n;return t[i]<t[o]||t[i]===t[o]&&r[e]<=r[n]}function pqdownheap(t,e,n){for(var r=t.heap[n],i=n<<1;i<=t.heap_len&&(i<t.heap_len&&smaller(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!smaller(e,r,t.heap[i],t.depth));)t.heap[n]=t.heap[i],n=i,i<<=1;t.heap[n]=r}function compress_block(t,e,n){var r,i,o,a,s=0;if(0!==t.last_lit)do{r=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],i=t.pending_buf[t.l_buf+s],s++,0===r?send_code(t,i,e):(send_code(t,(o=B[i])+h+1,e),0!==(a=O[o])&&send_bits(t,i-=A[o],a),send_code(t,o=d_code(--r),n),0!==(a=C[o])&&send_bits(t,r-=k[o],a))}while(s<t.last_lit);send_code(t,b,e)}function build_tree(t,e){var n,r,i,o=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,c=e.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=m,n=0;n<c;n++)0!==o[2*n]?(t.heap[++t.heap_len]=u=n,t.depth[n]=0):o[2*n+1]=0;for(;t.heap_len<2;)o[2*(i=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[i]=0,t.opt_len--,s&&(t.static_len-=a[2*i+1]);for(e.max_code=u,n=t.heap_len>>1;n>=1;n--)pqdownheap(t,o,n);i=c;do{n=t.heap[1],t.heap[1]=t.heap[t.heap_len--],pqdownheap(t,o,1),r=t.heap[1],t.heap[--t.heap_max]=n,t.heap[--t.heap_max]=r,o[2*i]=o[2*n]+o[2*r],t.depth[i]=(t.depth[n]>=t.depth[r]?t.depth[n]:t.depth[r])+1,o[2*n+1]=o[2*r+1]=i,t.heap[1]=i++,pqdownheap(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function gen_bitlen(t,e){var n,r,i,o,a,s,c=e.dyn_tree,u=e.max_code,l=e.stat_desc.static_tree,p=e.stat_desc.has_stree,h=e.stat_desc.extra_bits,f=e.stat_desc.extra_base,d=e.stat_desc.max_length,y=0;for(o=0;o<=v;o++)t.bl_count[o]=0;for(c[2*t.heap[t.heap_max]+1]=0,n=t.heap_max+1;n<m;n++)(o=c[2*c[2*(r=t.heap[n])+1]+1]+1)>d&&(o=d,y++),c[2*r+1]=o,r>u||(t.bl_count[o]++,a=0,r>=f&&(a=h[r-f]),s=c[2*r],t.opt_len+=s*(o+a),p&&(t.static_len+=s*(l[2*r+1]+a)));if(0!==y){do{for(o=d-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[d]--,y-=2}while(y>0);for(o=d;0!==o;o--)for(r=t.bl_count[o];0!==r;)(i=t.heap[--n])>u||(c[2*i+1]!==o&&(t.opt_len+=(o-c[2*i+1])*c[2*i],c[2*i+1]=o),r--)}}(t,e),gen_codes(o,u,t.bl_count)}function scan_tree(t,e,n){var r,i,o=-1,a=e[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=a,a=e[2*(r+1)+1],++s<c&&i===a||(s<u?t.bl_tree[2*i]+=s:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[2*w]++):s<=10?t.bl_tree[2*x]++:t.bl_tree[2*P]++,s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4))}function send_tree(t,e,n){var r,i,o=-1,a=e[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),r=0;r<=n;r++)if(i=a,a=e[2*(r+1)+1],!(++s<c&&i===a)){if(s<u)do{send_code(t,i,t.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(send_code(t,i,t.bl_tree),s--),send_code(t,w,t.bl_tree),send_bits(t,s-3,2)):s<=10?(send_code(t,x,t.bl_tree),send_bits(t,s-3,3)):(send_code(t,P,t.bl_tree),send_bits(t,s-11,7));s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4)}}zero(k);var D=!1;function _tr_stored_block(t,e,n,i){send_bits(t,(c<<1)+(i?1:0),3),function copy_block(t,e,n,i){bi_windup(t),i&&(put_short(t,n),put_short(t,~n)),r.arraySet(t.pending_buf,t.window,e,n,t.pending),t.pending+=n}(t,e,n,!0)}e._tr_init=function _tr_init(t){D||(function tr_static_init(){var t,e,n,r,i,o=new Array(v+1);for(n=0,r=0;r<p-1;r++)for(A[r]=n,t=0;t<1<<O[r];t++)B[n++]=r;for(B[n-1]=r,i=0,r=0;r<16;r++)for(k[r]=i,t=0;t<1<<C[r];t++)E[i++]=r;for(i>>=7;r<d;r++)for(k[r]=i<<7,t=0;t<1<<C[r]-7;t++)E[256+i++]=r;for(e=0;e<=v;e++)o[e]=0;for(t=0;t<=143;)R[2*t+1]=8,t++,o[8]++;for(;t<=255;)R[2*t+1]=9,t++,o[9]++;for(;t<=279;)R[2*t+1]=7,t++,o[7]++;for(;t<=287;)R[2*t+1]=8,t++,o[8]++;for(gen_codes(R,f+1,o),t=0;t<d;t++)T[2*t+1]=5,T[2*t]=bi_reverse(t,5);I=new StaticTreeDesc(R,O,h+1,f,v),M=new StaticTreeDesc(T,C,0,d,v),z=new StaticTreeDesc(new Array(0),S,0,y,_)}(),D=!0),t.l_desc=new TreeDesc(t.dyn_ltree,I),t.d_desc=new TreeDesc(t.dyn_dtree,M),t.bl_desc=new TreeDesc(t.bl_tree,z),t.bi_buf=0,t.bi_valid=0,init_block(t)},e._tr_stored_block=_tr_stored_block,e._tr_flush_block=function _tr_flush_block(t,e,n,r){var c,p,f=0;t.level>0?(t.strm.data_type===s&&(t.strm.data_type=function detect_data_type(t){var e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return o;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(e=32;e<h;e++)if(0!==t.dyn_ltree[2*e])return a;return o}(t)),build_tree(t,t.l_desc),build_tree(t,t.d_desc),f=function build_bl_tree(t){var e;for(scan_tree(t,t.dyn_ltree,t.l_desc.max_code),scan_tree(t,t.dyn_dtree,t.d_desc.max_code),build_tree(t,t.bl_desc),e=y-1;e>=3&&0===t.bl_tree[2*j[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),c=t.opt_len+3+7>>>3,(p=t.static_len+3+7>>>3)<=c&&(c=p)):c=p=n+5,n+4<=c&&-1!==e?_tr_stored_block(t,e,n,r):t.strategy===i||p===c?(send_bits(t,(u<<1)+(r?1:0),3),compress_block(t,R,T)):(send_bits(t,(l<<1)+(r?1:0),3),function send_all_trees(t,e,n,r){var i;for(send_bits(t,e-257,5),send_bits(t,n-1,5),send_bits(t,r-4,4),i=0;i<r;i++)send_bits(t,t.bl_tree[2*j[i]+1],3);send_tree(t,t.dyn_ltree,e-1),send_tree(t,t.dyn_dtree,n-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,f+1),compress_block(t,t.dyn_ltree,t.dyn_dtree)),init_block(t),r&&bi_windup(t)},e._tr_tally=function _tr_tally(t,e,n){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&n,t.last_lit++,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(B[n]+h+1)]++,t.dyn_dtree[2*d_code(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function _tr_align(t){send_bits(t,u<<1,3),send_code(t,b,R),function bi_flush(t){16===t.bi_valid?(put_short(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},function(t,e,n){"use strict";var r=n(91),i=n(6),o=n(47),a=n(49),s=n(27),c=n(48),u=n(94),l=Object.prototype.toString;function Inflate(t){if(!(this instanceof Inflate))return new Inflate(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var n=r.inflateInit2(this.strm,e.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);if(this.header=new u,r.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=o.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=r.inflateSetDictionary(this.strm,e.dictionary))!==a.Z_OK))throw new Error(s[n])}function inflate(t,e){var n=new Inflate(e);if(n.push(t,!0),n.err)throw n.msg||s[n.err];return n.result}Inflate.prototype.push=function(t,e){var n,s,c,u,p,h=this.strm,f=this.options.chunkSize,d=this.options.dictionary,y=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?h.input=o.binstring2buf(t):"[object ArrayBuffer]"===l.call(t)?h.input=new Uint8Array(t):h.input=t,h.next_in=0,h.avail_in=h.input.length;do{if(0===h.avail_out&&(h.output=new i.Buf8(f),h.next_out=0,h.avail_out=f),(n=r.inflate(h,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&d&&(n=r.inflateSetDictionary(this.strm,d)),n===a.Z_BUF_ERROR&&!0===y&&(n=a.Z_OK,y=!1),n!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;h.next_out&&(0!==h.avail_out&&n!==a.Z_STREAM_END&&(0!==h.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(c=o.utf8border(h.output,h.next_out),u=h.next_out-c,p=o.buf2string(h.output,c),h.next_out=u,h.avail_out=f-u,u&&i.arraySet(h.output,h.output,c,u,0),this.onData(p)):this.onData(i.shrinkBuf(h.output,h.next_out)))),0===h.avail_in&&0===h.avail_out&&(y=!0)}while((h.avail_in>0||0===h.avail_out)&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(n=r.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),h.avail_out=0,!0)},Inflate.prototype.onData=function(t){this.chunks.push(t)},Inflate.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=Inflate,e.inflate=inflate,e.inflateRaw=function inflateRaw(t,e){return(e=e||{}).raw=!0,inflate(t,e)},e.ungzip=inflate},function(t,e,n){"use strict";var r=n(6),i=n(45),o=n(46),a=n(92),s=n(93),c=0,u=1,l=2,p=4,h=5,f=6,d=0,y=1,m=2,v=-2,g=-3,_=-4,b=-5,w=8,x=1,P=2,O=3,C=4,S=5,j=6,R=7,T=8,E=9,B=10,A=11,I=12,M=13,z=14,k=15,D=16,F=17,L=18,N=19,V=20,U=21,W=22,q=23,G=24,H=25,K=26,X=27,Q=28,Y=29,Z=30,J=31,$=32,tt=852,et=592,nt=15;function zswap32(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new r.Buf16(320),this.work=new r.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=x,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new r.Buf32(tt),e.distcode=e.distdyn=new r.Buf32(et),e.sane=1,e.back=-1,d):v}function inflateReset(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,inflateResetKeep(t)):v}function inflateReset2(t,e){var n,r;return t&&t.state?(r=t.state,e<0?(n=0,e=-e):(n=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?v:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,inflateReset(t))):v}function inflateInit2(t,e){var n,r;return t?(r=new InflateState,t.state=r,r.window=null,(n=inflateReset2(t,e))!==d&&(t.state=null),n):v}var rt,it,ot=!0;function fixedtables(t){if(ot){var e;for(rt=new r.Buf32(512),it=new r.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(s(u,t.lens,0,288,rt,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;s(l,t.lens,0,32,it,0,t.work,{bits:5}),ot=!1}t.lencode=rt,t.lenbits=9,t.distcode=it,t.distbits=5}function updatewindow(t,e,n,i){var o,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new r.Buf8(a.wsize)),i>=a.wsize?(r.arraySet(a.window,e,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>i&&(o=i),r.arraySet(a.window,e,n-i,o,a.wnext),(i-=o)?(r.arraySet(a.window,e,n-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}e.inflateReset=inflateReset,e.inflateReset2=inflateReset2,e.inflateResetKeep=inflateResetKeep,e.inflateInit=function inflateInit(t){return inflateInit2(t,nt)},e.inflateInit2=inflateInit2,e.inflate=function inflate(t,e){var n,tt,et,nt,rt,it,ot,at,st,ct,ut,lt,pt,ht,ft,dt,yt,mt,vt,gt,_t,bt,wt,xt,Pt=0,Ot=new r.Buf8(4),Ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return v;(n=t.state).mode===I&&(n.mode=M),rt=t.next_out,et=t.output,ot=t.avail_out,nt=t.next_in,tt=t.input,it=t.avail_in,at=n.hold,st=n.bits,ct=it,ut=ot,bt=d;t:for(;;)switch(n.mode){case x:if(0===n.wrap){n.mode=M;break}for(;st<16;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}if(2&n.wrap&&35615===at){n.check=0,Ot[0]=255&at,Ot[1]=at>>>8&255,n.check=o(n.check,Ot,2,0),at=0,st=0,n.mode=P;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&at)<<8)+(at>>8))%31){t.msg="incorrect header check",n.mode=Z;break}if((15&at)!==w){t.msg="unknown compression method",n.mode=Z;break}if(st-=4,_t=8+(15&(at>>>=4)),0===n.wbits)n.wbits=_t;else if(_t>n.wbits){t.msg="invalid window size",n.mode=Z;break}n.dmax=1<<_t,t.adler=n.check=1,n.mode=512&at?B:I,at=0,st=0;break;case P:for(;st<16;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}if(n.flags=at,(255&n.flags)!==w){t.msg="unknown compression method",n.mode=Z;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=Z;break}n.head&&(n.head.text=at>>8&1),512&n.flags&&(Ot[0]=255&at,Ot[1]=at>>>8&255,n.check=o(n.check,Ot,2,0)),at=0,st=0,n.mode=O;case O:for(;st<32;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}n.head&&(n.head.time=at),512&n.flags&&(Ot[0]=255&at,Ot[1]=at>>>8&255,Ot[2]=at>>>16&255,Ot[3]=at>>>24&255,n.check=o(n.check,Ot,4,0)),at=0,st=0,n.mode=C;case C:for(;st<16;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}n.head&&(n.head.xflags=255&at,n.head.os=at>>8),512&n.flags&&(Ot[0]=255&at,Ot[1]=at>>>8&255,n.check=o(n.check,Ot,2,0)),at=0,st=0,n.mode=S;case S:if(1024&n.flags){for(;st<16;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}n.length=at,n.head&&(n.head.extra_len=at),512&n.flags&&(Ot[0]=255&at,Ot[1]=at>>>8&255,n.check=o(n.check,Ot,2,0)),at=0,st=0}else n.head&&(n.head.extra=null);n.mode=j;case j:if(1024&n.flags&&((lt=n.length)>it&&(lt=it),lt&&(n.head&&(_t=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),r.arraySet(n.head.extra,tt,nt,lt,_t)),512&n.flags&&(n.check=o(n.check,tt,lt,nt)),it-=lt,nt+=lt,n.length-=lt),n.length))break t;n.length=0,n.mode=R;case R:if(2048&n.flags){if(0===it)break t;lt=0;do{_t=tt[nt+lt++],n.head&&_t&&n.length<65536&&(n.head.name+=String.fromCharCode(_t))}while(_t&&lt<it);if(512&n.flags&&(n.check=o(n.check,tt,lt,nt)),it-=lt,nt+=lt,_t)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=T;case T:if(4096&n.flags){if(0===it)break t;lt=0;do{_t=tt[nt+lt++],n.head&&_t&&n.length<65536&&(n.head.comment+=String.fromCharCode(_t))}while(_t&&lt<it);if(512&n.flags&&(n.check=o(n.check,tt,lt,nt)),it-=lt,nt+=lt,_t)break t}else n.head&&(n.head.comment=null);n.mode=E;case E:if(512&n.flags){for(;st<16;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}if(at!==(65535&n.check)){t.msg="header crc mismatch",n.mode=Z;break}at=0,st=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=I;break;case B:for(;st<32;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}t.adler=n.check=zswap32(at),at=0,st=0,n.mode=A;case A:if(0===n.havedict)return t.next_out=rt,t.avail_out=ot,t.next_in=nt,t.avail_in=it,n.hold=at,n.bits=st,m;t.adler=n.check=1,n.mode=I;case I:if(e===h||e===f)break t;case M:if(n.last){at>>>=7&st,st-=7&st,n.mode=X;break}for(;st<3;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}switch(n.last=1&at,st-=1,3&(at>>>=1)){case 0:n.mode=z;break;case 1:if(fixedtables(n),n.mode=V,e===f){at>>>=2,st-=2;break t}break;case 2:n.mode=F;break;case 3:t.msg="invalid block type",n.mode=Z}at>>>=2,st-=2;break;case z:for(at>>>=7&st,st-=7&st;st<32;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}if((65535&at)!=(at>>>16^65535)){t.msg="invalid stored block lengths",n.mode=Z;break}if(n.length=65535&at,at=0,st=0,n.mode=k,e===f)break t;case k:n.mode=D;case D:if(lt=n.length){if(lt>it&&(lt=it),lt>ot&&(lt=ot),0===lt)break t;r.arraySet(et,tt,nt,lt,rt),it-=lt,nt+=lt,ot-=lt,rt+=lt,n.length-=lt;break}n.mode=I;break;case F:for(;st<14;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}if(n.nlen=257+(31&at),at>>>=5,st-=5,n.ndist=1+(31&at),at>>>=5,st-=5,n.ncode=4+(15&at),at>>>=4,st-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=Z;break}n.have=0,n.mode=L;case L:for(;n.have<n.ncode;){for(;st<3;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}n.lens[Ct[n.have++]]=7&at,at>>>=3,st-=3}for(;n.have<19;)n.lens[Ct[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,wt={bits:n.lenbits},bt=s(c,n.lens,0,19,n.lencode,0,n.work,wt),n.lenbits=wt.bits,bt){t.msg="invalid code lengths set",n.mode=Z;break}n.have=0,n.mode=N;case N:for(;n.have<n.nlen+n.ndist;){for(;dt=(Pt=n.lencode[at&(1<<n.lenbits)-1])>>>16&255,yt=65535&Pt,!((ft=Pt>>>24)<=st);){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}if(yt<16)at>>>=ft,st-=ft,n.lens[n.have++]=yt;else{if(16===yt){for(xt=ft+2;st<xt;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}if(at>>>=ft,st-=ft,0===n.have){t.msg="invalid bit length repeat",n.mode=Z;break}_t=n.lens[n.have-1],lt=3+(3&at),at>>>=2,st-=2}else if(17===yt){for(xt=ft+3;st<xt;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}st-=ft,_t=0,lt=3+(7&(at>>>=ft)),at>>>=3,st-=3}else{for(xt=ft+7;st<xt;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}st-=ft,_t=0,lt=11+(127&(at>>>=ft)),at>>>=7,st-=7}if(n.have+lt>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=Z;break}for(;lt--;)n.lens[n.have++]=_t}}if(n.mode===Z)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=Z;break}if(n.lenbits=9,wt={bits:n.lenbits},bt=s(u,n.lens,0,n.nlen,n.lencode,0,n.work,wt),n.lenbits=wt.bits,bt){t.msg="invalid literal/lengths set",n.mode=Z;break}if(n.distbits=6,n.distcode=n.distdyn,wt={bits:n.distbits},bt=s(l,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,wt),n.distbits=wt.bits,bt){t.msg="invalid distances set",n.mode=Z;break}if(n.mode=V,e===f)break t;case V:n.mode=U;case U:if(it>=6&&ot>=258){t.next_out=rt,t.avail_out=ot,t.next_in=nt,t.avail_in=it,n.hold=at,n.bits=st,a(t,ut),rt=t.next_out,et=t.output,ot=t.avail_out,nt=t.next_in,tt=t.input,it=t.avail_in,at=n.hold,st=n.bits,n.mode===I&&(n.back=-1);break}for(n.back=0;dt=(Pt=n.lencode[at&(1<<n.lenbits)-1])>>>16&255,yt=65535&Pt,!((ft=Pt>>>24)<=st);){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}if(dt&&0==(240&dt)){for(mt=ft,vt=dt,gt=yt;dt=(Pt=n.lencode[gt+((at&(1<<mt+vt)-1)>>mt)])>>>16&255,yt=65535&Pt,!(mt+(ft=Pt>>>24)<=st);){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}at>>>=mt,st-=mt,n.back+=mt}if(at>>>=ft,st-=ft,n.back+=ft,n.length=yt,0===dt){n.mode=K;break}if(32&dt){n.back=-1,n.mode=I;break}if(64&dt){t.msg="invalid literal/length code",n.mode=Z;break}n.extra=15&dt,n.mode=W;case W:if(n.extra){for(xt=n.extra;st<xt;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}n.length+=at&(1<<n.extra)-1,at>>>=n.extra,st-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=q;case q:for(;dt=(Pt=n.distcode[at&(1<<n.distbits)-1])>>>16&255,yt=65535&Pt,!((ft=Pt>>>24)<=st);){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}if(0==(240&dt)){for(mt=ft,vt=dt,gt=yt;dt=(Pt=n.distcode[gt+((at&(1<<mt+vt)-1)>>mt)])>>>16&255,yt=65535&Pt,!(mt+(ft=Pt>>>24)<=st);){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}at>>>=mt,st-=mt,n.back+=mt}if(at>>>=ft,st-=ft,n.back+=ft,64&dt){t.msg="invalid distance code",n.mode=Z;break}n.offset=yt,n.extra=15&dt,n.mode=G;case G:if(n.extra){for(xt=n.extra;st<xt;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}n.offset+=at&(1<<n.extra)-1,at>>>=n.extra,st-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=Z;break}n.mode=H;case H:if(0===ot)break t;if(lt=ut-ot,n.offset>lt){if((lt=n.offset-lt)>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=Z;break}lt>n.wnext?(lt-=n.wnext,pt=n.wsize-lt):pt=n.wnext-lt,lt>n.length&&(lt=n.length),ht=n.window}else ht=et,pt=rt-n.offset,lt=n.length;lt>ot&&(lt=ot),ot-=lt,n.length-=lt;do{et[rt++]=ht[pt++]}while(--lt);0===n.length&&(n.mode=U);break;case K:if(0===ot)break t;et[rt++]=n.length,ot--,n.mode=U;break;case X:if(n.wrap){for(;st<32;){if(0===it)break t;it--,at|=tt[nt++]<<st,st+=8}if(ut-=ot,t.total_out+=ut,n.total+=ut,ut&&(t.adler=n.check=n.flags?o(n.check,et,ut,rt-ut):i(n.check,et,ut,rt-ut)),ut=ot,(n.flags?at:zswap32(at))!==n.check){t.msg="incorrect data check",n.mode=Z;break}at=0,st=0}n.mode=Q;case Q:if(n.wrap&&n.flags){for(;st<32;){if(0===it)break t;it--,at+=tt[nt++]<<st,st+=8}if(at!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=Z;break}at=0,st=0}n.mode=Y;case Y:bt=y;break t;case Z:bt=g;break t;case J:return _;case $:default:return v}return t.next_out=rt,t.avail_out=ot,t.next_in=nt,t.avail_in=it,n.hold=at,n.bits=st,(n.wsize||ut!==t.avail_out&&n.mode<Z&&(n.mode<X||e!==p))&&updatewindow(t,t.output,t.next_out,ut-t.avail_out)?(n.mode=J,_):(ct-=t.avail_in,ut-=t.avail_out,t.total_in+=ct,t.total_out+=ut,n.total+=ut,n.wrap&&ut&&(t.adler=n.check=n.flags?o(n.check,et,ut,t.next_out-ut):i(n.check,et,ut,t.next_out-ut)),t.data_type=n.bits+(n.last?64:0)+(n.mode===I?128:0)+(n.mode===V||n.mode===k?256:0),(0===ct&&0===ut||e===p)&&bt===d&&(bt=b),bt)},e.inflateEnd=function inflateEnd(t){if(!t||!t.state)return v;var e=t.state;return e.window&&(e.window=null),t.state=null,d},e.inflateGetHeader=function inflateGetHeader(t,e){var n;return t&&t.state?0==(2&(n=t.state).wrap)?v:(n.head=e,e.done=!1,d):v},e.inflateSetDictionary=function inflateSetDictionary(t,e){var n,r=e.length;return t&&t.state?0!==(n=t.state).wrap&&n.mode!==A?v:n.mode===A&&i(1,e,r,0)!==n.check?g:updatewindow(t,e,r,r)?(n.mode=J,_):(n.havedict=1,d):v},e.inflateInfo="pako inflate (from Nodeca project)"},function(t,e,n){"use strict";t.exports=function inflate_fast(t,e){var n,r,i,o,a,s,c,u,l,p,h,f,d,y,m,v,g,_,b,w,x,P,O,C,S;n=t.state,r=t.next_in,C=t.input,i=r+(t.avail_in-5),o=t.next_out,S=t.output,a=o-(e-t.avail_out),s=o+(t.avail_out-257),c=n.dmax,u=n.wsize,l=n.whave,p=n.wnext,h=n.window,f=n.hold,d=n.bits,y=n.lencode,m=n.distcode,v=(1<<n.lenbits)-1,g=(1<<n.distbits)-1;t:do{d<15&&(f+=C[r++]<<d,d+=8,f+=C[r++]<<d,d+=8),_=y[f&v];e:for(;;){if(f>>>=b=_>>>24,d-=b,0===(b=_>>>16&255))S[o++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=y[(65535&_)+(f&(1<<b)-1)];continue e}if(32&b){n.mode=12;break t}t.msg="invalid literal/length code",n.mode=30;break t}w=65535&_,(b&=15)&&(d<b&&(f+=C[r++]<<d,d+=8),w+=f&(1<<b)-1,f>>>=b,d-=b),d<15&&(f+=C[r++]<<d,d+=8,f+=C[r++]<<d,d+=8),_=m[f&g];n:for(;;){if(f>>>=b=_>>>24,d-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=m[(65535&_)+(f&(1<<b)-1)];continue n}t.msg="invalid distance code",n.mode=30;break t}if(x=65535&_,d<(b&=15)&&(f+=C[r++]<<d,(d+=8)<b&&(f+=C[r++]<<d,d+=8)),(x+=f&(1<<b)-1)>c){t.msg="invalid distance too far back",n.mode=30;break t}if(f>>>=b,d-=b,x>(b=o-a)){if((b=x-b)>l&&n.sane){t.msg="invalid distance too far back",n.mode=30;break t}if(P=0,O=h,0===p){if(P+=u-b,b<w){w-=b;do{S[o++]=h[P++]}while(--b);P=o-x,O=S}}else if(p<b){if(P+=u+p-b,(b-=p)<w){w-=b;do{S[o++]=h[P++]}while(--b);if(P=0,p<w){w-=b=p;do{S[o++]=h[P++]}while(--b);P=o-x,O=S}}}else if(P+=p-b,b<w){w-=b;do{S[o++]=h[P++]}while(--b);P=o-x,O=S}for(;w>2;)S[o++]=O[P++],S[o++]=O[P++],S[o++]=O[P++],w-=3;w&&(S[o++]=O[P++],w>1&&(S[o++]=O[P++]))}else{P=o-x;do{S[o++]=S[P++],S[o++]=S[P++],S[o++]=S[P++],w-=3}while(w>2);w&&(S[o++]=S[P++],w>1&&(S[o++]=S[P++]))}break}}break}}while(r<i&&o<s);r-=w=d>>3,f&=(1<<(d-=w<<3))-1,t.next_in=r,t.next_out=o,t.avail_in=r<i?i-r+5:5-(r-i),t.avail_out=o<s?s-o+257:257-(o-s),n.hold=f,n.bits=d}},function(t,e,n){"use strict";var r=n(6),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function inflate_table(t,e,n,c,u,l,p,h){var f,d,y,m,v,g,_,b,w,x=h.bits,P=0,O=0,C=0,S=0,j=0,R=0,T=0,E=0,B=0,A=0,I=null,M=0,z=new r.Buf16(16),k=new r.Buf16(16),D=null,F=0;for(P=0;P<=15;P++)z[P]=0;for(O=0;O<c;O++)z[e[n+O]]++;for(j=x,S=15;S>=1&&0===z[S];S--);if(j>S&&(j=S),0===S)return u[l++]=20971520,u[l++]=20971520,h.bits=1,0;for(C=1;C<S&&0===z[C];C++);for(j<C&&(j=C),E=1,P=1;P<=15;P++)if(E<<=1,(E-=z[P])<0)return-1;if(E>0&&(0===t||1!==S))return-1;for(k[1]=0,P=1;P<15;P++)k[P+1]=k[P]+z[P];for(O=0;O<c;O++)0!==e[n+O]&&(p[k[e[n+O]]++]=O);if(0===t?(I=D=p,g=19):1===t?(I=i,M-=257,D=o,F-=257,g=256):(I=a,D=s,g=-1),A=0,O=0,P=C,v=l,R=j,T=0,y=-1,m=(B=1<<j)-1,1===t&&B>852||2===t&&B>592)return 1;for(;;){_=P-T,p[O]<g?(b=0,w=p[O]):p[O]>g?(b=D[F+p[O]],w=I[M+p[O]]):(b=96,w=0),f=1<<P-T,C=d=1<<R;do{u[v+(A>>T)+(d-=f)]=_<<24|b<<16|w|0}while(0!==d);for(f=1<<P-1;A&f;)f>>=1;if(0!==f?(A&=f-1,A+=f):A=0,O++,0==--z[P]){if(P===S)break;P=e[n+p[O]]}if(P>j&&(A&m)!==y){for(0===T&&(T=j),v+=C,E=1<<(R=P-T);R+T<S&&!((E-=z[R+T])<=0);)R++,E<<=1;if(B+=1<<R,1===t&&B>852||2===t&&B>592)return 1;u[y=A&m]=j<<24|R<<16|v-l|0}}return 0!==A&&(u[v+A]=P-T<<24|64<<16|0),h.bits=j,0}},function(t,e,n){"use strict";t.exports=function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(t,e,n){"use strict";var r=n(1),i=n(3),o=n(9),a=n(26),s=n(50),c=function(t,e){var n,r="";for(n=0;n<e;n++)r+=String.fromCharCode(255&t),t>>>=8;return r},u=function(t,e,n,i,u,l){var p,h,f=t.file,d=t.compression,y=l!==o.utf8encode,m=r.transformTo("string",l(f.name)),v=r.transformTo("string",o.utf8encode(f.name)),g=f.comment,_=r.transformTo("string",l(g)),b=r.transformTo("string",o.utf8encode(g)),w=v.length!==f.name.length,x=b.length!==g.length,P="",O="",C="",S=f.dir,j=f.date,R={crc32:0,compressedSize:0,uncompressedSize:0};e&&!n||(R.crc32=t.crc32,R.compressedSize=t.compressedSize,R.uncompressedSize=t.uncompressedSize);var T=0;e&&(T|=8),y||!w&&!x||(T|=2048);var E,B,A,I=0,M=0;S&&(I|=16),"UNIX"===u?(M=798,I|=(E=f.unixPermissions,B=S,A=E,E||(A=B?16893:33204),(65535&A)<<16)):(M=20,I|=63&(f.dosPermissions||0)),p=j.getUTCHours(),p<<=6,p|=j.getUTCMinutes(),p<<=5,p|=j.getUTCSeconds()/2,h=j.getUTCFullYear()-1980,h<<=4,h|=j.getUTCMonth()+1,h<<=5,h|=j.getUTCDate(),w&&(O=c(1,1)+c(a(m),4)+v,P+="up"+c(O.length,2)+O),x&&(C=c(1,1)+c(a(_),4)+b,P+="uc"+c(C.length,2)+C);var z="";return z+="\n\0",z+=c(T,2),z+=d.magic,z+=c(p,2),z+=c(h,2),z+=c(R.crc32,4),z+=c(R.compressedSize,4),z+=c(R.uncompressedSize,4),z+=c(m.length,2),z+=c(P.length,2),{fileRecord:s.LOCAL_FILE_HEADER+z+m+P,dirRecord:s.CENTRAL_FILE_HEADER+c(M,2)+z+c(_.length,2)+"\0\0\0\0"+c(I,4)+c(i,4)+m+P+_}},l=function(t){return s.DATA_DESCRIPTOR+c(t.crc32,4)+c(t.compressedSize,4)+c(t.uncompressedSize,4)};function ZipFileWorker(t,e,n,r){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=n,this.encodeFileName=r,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}r.inherits(ZipFileWorker,i),ZipFileWorker.prototype.push=function(t){var e=t.meta.percent||0,n=this.entriesCount,r=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,i.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:n?(e+100*(n-r-1))/n:100}}))},ZipFileWorker.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var n=u(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:n.fileRecord,meta:{percent:0}})}else this.accumulate=!0},ZipFileWorker.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,n=u(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(n.dirRecord),e)this.push({data:l(t),meta:{percent:100}});else for(this.push({data:n.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},ZipFileWorker.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var n=this.bytesWritten-t,i=function(t,e,n,i,o){var a=r.transformTo("string",o(i));return s.CENTRAL_DIRECTORY_END+"\0\0\0\0"+c(t,2)+c(t,2)+c(e,4)+c(n,4)+c(a.length,2)+a}(this.dirRecords.length,n,t,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},ZipFileWorker.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},ZipFileWorker.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},ZipFileWorker.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},ZipFileWorker.prototype.error=function(t){var e=this._sources;if(!i.prototype.error.call(this,t))return!1;for(var n=0;n<e.length;n++)try{e[n].error(t)}catch(t){}return!0},ZipFileWorker.prototype.lock=function(){i.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},t.exports=ZipFileWorker},function(t,e,n){"use strict";var r=n(1),i=n(3);function NodejsStreamInputAdapter(t,e){i.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}r.inherits(NodejsStreamInputAdapter,i),NodejsStreamInputAdapter.prototype._bindStream=function(t){var e=this;this._stream=t,t.pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},NodejsStreamInputAdapter.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},NodejsStreamInputAdapter.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=NodejsStreamInputAdapter},function(t,e,n){"use strict";var r=n(1),i=n(13),o=n(9),a=(r=n(1),n(98)),s=n(43),c=n(18);function checkEntryCRC32(t){return new i.Promise(function(e,n){var r=t.decompressed.getContentWorker().pipe(new s);r.on("error",function(t){n(t)}).on("end",function(){r.streamInfo.crc32!==t.decompressed.crc32?n(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}t.exports=function(t,e){var n=this;return e=r.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(t)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):r.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then(function(t){var n=new a(e);return n.load(t),n}).then(function checkCRC32(t){var n=[i.Promise.resolve(t)],r=t.files;if(e.checkCRC32)for(var o=0;o<r.length;o++)n.push(checkEntryCRC32(r[o]));return i.Promise.all(n)}).then(function addFiles(t){for(var r=t.shift(),i=r.files,o=0;o<i.length;o++){var a=i[o];n.file(a.fileNameStr,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:e.createFolders})}return r.zipComment.length&&(n.comment=r.zipComment),n})}},function(t,e,n){"use strict";var r=n(51),i=n(1),o=n(50),a=n(101),s=(n(9),n(5));function ZipEntries(t){this.files=[],this.loadOptions=t}ZipEntries.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(e)+", expected "+i.pretty(t)+")")}},isSignature:function(t,e){var n=this.reader.index;this.reader.setIndex(t);var r=this.reader.readString(4)===e;return this.reader.setIndex(n),r},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=s.uint8array?"uint8array":"array",n=i.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(n)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,n,r=this.zip64EndOfCentralSize-44;0<r;)t=this.reader.readInt(2),e=this.reader.readInt(4),n=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(t=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(t<0)throw!this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(t);var e=t;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var n=this.centralDirOffset+this.centralDirSize;this.zip64&&(n+=20,n+=12+this.zip64EndOfCentralSize);var r=e-n;if(r>0)this.isSignature(e,o.CENTRAL_FILE_HEADER)||(this.reader.zero=r);else if(r<0)throw new Error("Corrupted zip: missing "+Math.abs(r)+" bytes.")},prepareReader:function(t){this.reader=r(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=ZipEntries},function(t,e,n){"use strict";var r=n(53);function StringReader(t){r.call(this,t)}n(1).inherits(StringReader,r),StringReader.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},StringReader.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},StringReader.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},StringReader.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},t.exports=StringReader},function(t,e,n){"use strict";var r=n(54);function NodeBufferReader(t){r.call(this,t)}n(1).inherits(NodeBufferReader,r),NodeBufferReader.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},t.exports=NodeBufferReader},function(t,e,n){"use strict";var r=n(51),i=n(1),o=n(25),a=n(26),s=n(9),c=n(44),u=n(5);function ZipEntry(t,e){this.options=t,this.loadOptions=e}ZipEntry.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,n;if(t.skip(22),this.fileNameLength=t.readInt(2),n=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(n),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in c)if(c.hasOwnProperty(e)&&c[e].magic===t)return c[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===t&&(this.dosPermissions=63&this.externalFileAttributes),3===t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=r(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,n,r,i=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index<i;)e=t.readInt(2),n=t.readInt(2),r=t.readData(n),this.extraFields[e]={id:e,length:n,value:r}},handleUTF8:function(){var t=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var n=i.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(n)}var r=this.findExtraFieldUnicodeComment();if(null!==r)this.fileCommentStr=r;else{var o=i.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(o)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=r(t.value);return 1!==e.readInt(1)?null:a(this.fileName)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=r(t.value);return 1!==e.readInt(1)?null:a(this.fileComment)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null}},t.exports=ZipEntry},function(t,e,n){"use strict";n.r(e),n.d(e,"Bone2D",function(){return Bone2D}),n.d(e,"Bone3D",function(){return Bone3D}),n.d(e,"Chain2D",function(){return Chain2D}),n.d(e,"Chain3D",function(){return Chain3D}),n.d(e,"DOWN",function(){return I}),n.d(e,"END",function(){return C}),n.d(e,"GLOBAL_ABSOLUTE",function(){return g}),n.d(e,"GLOBAL_HINGE",function(){return y}),n.d(e,"GLOBAL_ROTOR",function(){return d}),n.d(e,"HISolver",function(){return HISolver}),n.d(e,"IKSolver",function(){return IKSolver}),n.d(e,"J_BALL",function(){return w}),n.d(e,"J_GLOBAL",function(){return P}),n.d(e,"J_LOCAL",function(){return x}),n.d(e,"Joint2D",function(){return Joint2D}),n.d(e,"Joint3D",function(){return Joint3D}),n.d(e,"LEFT",function(){return M}),n.d(e,"LOCAL_ABSOLUTE",function(){return b}),n.d(e,"LOCAL_HINGE",function(){return v}),n.d(e,"LOCAL_RELATIVE",function(){return _}),n.d(e,"LOCAL_ROTOR",function(){return m}),n.d(e,"M3",function(){return M3}),n.d(e,"MAX_VALUE",function(){return u}),n.d(e,"NONE",function(){return f}),n.d(e,"PI",function(){return l}),n.d(e,"PRECISION",function(){return s}),n.d(e,"PRECISION_DEG",function(){return c}),n.d(e,"REVISION",function(){return a}),n.d(e,"RIGHT",function(){return z}),n.d(e,"START",function(){return O}),n.d(e,"Structure2D",function(){return Structure2D}),n.d(e,"Structure3D",function(){return Structure3D}),n.d(e,"TODEG",function(){return h}),n.d(e,"TORAD",function(){return p}),n.d(e,"UP",function(){return A}),n.d(e,"V2",function(){return V2}),n.d(e,"V3",function(){return V3}),n.d(e,"X_AXE",function(){return S}),n.d(e,"X_NEG",function(){return T}),n.d(e,"Y_AXE",function(){return j}),n.d(e,"Y_NEG",function(){return E}),n.d(e,"Z_AXE",function(){return R}),n.d(e,"Z_NEG",function(){return B}),n.d(e,"_Math",function(){return o}),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e});var r,i=function(t){console.error(t)},o={toRad:Math.PI/180,toDeg:180/Math.PI,pi90:.5*Math.PI,findAngle:function(t,e){var n,r,i=t.end.minus(e.end).lengthSq(),o=t.end.minus(t.start).lengthSq();return n=(r=(i+o-e.end.minus(t.start).lengthSq())/Math.sqrt(4*i*o))<=-1?Math.PI:r>=1?0:Math.acos(r),t.end.x*e.end.y-t.end.y*e.end.x>=0?n:-n},clamp:function(t,e,n){return t=(t=t<e?e:t)>n?n:t},lerp:function(t,e,n){return(1-n)*t+n*e},rand:function(t,e){return t+Math.random()*(e-t)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},nearEquals:function(t,e,n){return Math.abs(t-e)<=n},perpendicular:function(t,e){return!!o.nearEquals(t.dot(e),0,.01)},genPerpendicularVectorQuick:function(t){var e=t.clone();return Math.abs(t.y)<.99?e.set(-t.z,0,t.x).normalize():e.set(0,t.z,-t.y).normalize()},genPerpendicularVectorFrisvad:function(t){var e=t.clone();if(t.z<-.9999999)return e.set(0,-1,0);var n=1/(1+t.z);return e.set(1-t.x*t.x*n,-t.x*t.y*n,-t.x).normalize()},rotateXDegs:function(t,e){return t.clone().rotate(e*o.toRad,"X")},rotateYDegs:function(t,e){return t.clone().rotate(e*o.toRad,"Y")},rotateZDegs:function(t,e){return t.clone().rotate(e*o.toRad,"Z")},withinManhattanDistance:function(t,e,n){return!(Math.abs(e.x-t.x)>n)&&(!(Math.abs(e.y-t.y)>n)&&!(Math.abs(e.z-t.z)>n))},manhattanDistanceBetween:function(t,e){return Math.abs(e.x-t.x)+Math.abs(e.x-t.x)+Math.abs(e.x-t.x)},distanceBetween:function(t,e){var n=e.x-t.x,r=e.y-t.y,i=void 0!==t.z?e.z-t.z:0;return Math.sqrt(n*n+r*r+i*i)},rotateDegs:function(t,e){return t.clone().rotate(e*o.toRad)},validateDirectionUV:function(t){t.length()<0&&i("vector direction unit vector cannot be zero.")},validateLength:function(t){t<0&&i("Length must be a greater than or equal to zero.")}};function V2(t,e){this.x=t||0,this.y=e||0}function V3(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}function M3(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("M3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(V2.prototype,{isVector2:!0,set:function(t,e){return this.x=t||0,this.y=e||0,this},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divideScalar:function(t){return this.multiplyScalar(1/t)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length()||1)},normalised:function(){return new V2(this.x,this.y).normalize()},lengthSq:function(){return this.x*this.x+this.y*this.y},add:function(t){return this.x+=t.x,this.y+=t.y,this},plus:function(t){return new V2(this.x+t.x,this.y+t.y)},min:function(t){return this.x-=t.x,this.y-=t.y,this},minus:function(t){return new V2(this.x-t.x,this.y-t.y)},divideBy:function(t){return new V2(this.x,this.y).divideScalar(t)},dot:function(t,e){return this.x*t.x+this.y*t.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},negated:function(){return new V2(-this.x,-this.y)},clone:function(){return new V2(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},cross:function(t){return this.x*t.y-this.y*t.x},sign:function(t){return this.cross(t)>=0?1:-1},approximatelyEquals:function(t,e){if(e<0)return!1;var n=Math.abs(this.x-t.x),r=Math.abs(this.y-t.y);return n<e&&r<e},rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=this.x*e-this.y*n,i=this.x*n+this.y*e;return this.x=r,this.y=i,this},angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return e<=-1?Math.PI:e>=1?0:Math.acos(e)},getSignedAngle:function(t){var e=this.angleTo(t);return 1===this.sign(t)?e:-e},constrainedUV:function(t,e,n){var r=t.getSignedAngle(this);return r>n&&this.copy(t).rotate(n),r<e&&this.copy(t).rotate(e),this}}),Object.assign(V3.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t||0,this.y=e||0,this.z=n||0,this},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},abs:function(){return new V3(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){return this.divideScalar(this.length()||1)},normalised:function(){return new V3(this.x,this.y,this.z).normalize()},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},min:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},plus:function(t){return new V3(this.x+t.x,this.y+t.y,this.z+t.z)},minus:function(t){return new V3(this.x-t.x,this.y-t.y,this.z-t.z)},divideBy:function(t){return new V3(this.x/t,this.y/t,this.z/t)},multiply:function(t){return new V3(this.x*t,this.y*t,this.z*t)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},divideScalar:function(t){return this.multiplyScalar(1/t)},cross:function(t){return new V3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},crossVectors:function(t,e){var n=t.x,r=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this.x=r*s-i*a,this.y=i*o-n*s,this.z=n*a-r*o,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},negated:function(){return new V3(-this.x,-this.y,-this.z)},clone:function(){return new V3(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},approximatelyEquals:function(t,e){if(e<0)return!1;var n=Math.abs(this.x-t.x),r=Math.abs(this.y-t.y),i=Math.abs(this.z-t.z);return n<e&&r<e&&i<e},zero:function(){return this.x=0,this.y=0,this.z=0,this},rotate:function(t,e){var n,r,i,o=Math.cos(t),a=Math.sin(t);switch(e){case"X":n=this.x,r=this.y*o-this.z*a,i=this.y*a+this.z*o;break;case"Y":n=this.z*a+this.x*o,r=this.y,i=this.z*o-this.x*a;break;case"Z":n=this.x*o-this.y*a,r=this.x*a+this.y*o,i=this.z}return this.x=n,this.y=r,this.z=i,this},projectOnVector:function(t){var e=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(e)},projectOnPlane:(r=new V3,function projectOnPlane(t){return r.copy(this).projectOnVector(t.normalised()),this.min(r).normalize()}),applyM3:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[1]*n+i[2]*r,this.y=i[3]*e+i[4]*n+i[5]*r,this.z=i[6]*e+i[7]*n+i[8]*r,this.normalize()},applyMatrix3:function(t){var e=this.x,n=this.y,r=this.z,i=t.elements;return this.x=i[0]*e+i[3]*n+i[6]*r,this.y=i[1]*e+i[4]*n+i[7]*r,this.z=i[2]*e+i[5]*n+i[8]*r,this},applyQuaternion:function(t){var e=this.x,n=this.y,r=this.z,i=t.x,o=t.y,a=t.z,s=t.w,c=s*e+o*r-a*n,u=s*n+a*e-i*r,l=s*r+i*n-o*e,p=-i*e-o*n-a*r;return this.x=c*s+p*-i+u*-a-l*-o,this.y=u*s+p*-o+l*-i-c*-a,this.z=l*s+p*-a+c*-o-u*-i,this},sign:function(t,e){return this.cross(t).dot(e)>=0?1:-1},angleTo:function(t){var e=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return e<=-1?Math.PI:e>=1?0:Math.acos(e)},getSignedAngle:function(t,e){var n=this.angleTo(t);return 1===this.sign(t,e)?n:-n},constrainedUV:function(t,e,n,r,i){var o=t.getSignedAngle(this,e);return o>i&&this.copy(n.rotateAboutAxis(t,i,e)),o<r&&this.copy(n.rotateAboutAxis(t,r,e)),this},limitAngle:function(t,e,n){if(t.angleTo(this)>n){var r=t.normalised().cross(this).normalize();this.copy(e.rotateAboutAxis(t,n,r))}return this}}),Object.assign(M3.prototype,{isMatrix3:!0,set:function(t,e,n,r,i,o,a,s,c){var u=this.elements;return u[0]=t,u[1]=r,u[2]=a,u[3]=e,u[4]=i,u[5]=s,u[6]=n,u[7]=o,u[8]=c,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},setV3:function(t,e,n){var r=this.elements;return r[0]=t.x,r[3]=t.y,r[6]=t.z,r[1]=e.x,r[4]=e.y,r[7]=e.z,r[2]=n.x,r[5]=n.y,r[8]=n.z,this},transpose:function(){var t,e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},createRotationMatrix:function(t){var e=t,n=new V3(1,0,0),r=new V3(0,1,0);if(t.z<-.9999999)n.set(1,0,0),r.set(0,1,0);else{var i=1/(1+e.z),o=-e.x*e.y*i;n.set(1-e.x*e.x*i,o,-e.x).normalize(),r.set(o,1-e.y*e.y*i,-e.y).normalize()}return this.setV3(n,r,e)},rotateAboutAxis:function(t,e,n){var r=Math.sin(e),i=Math.cos(e),o=1-i,a=n.x*n.y*o,s=n.x*n.z*o,c=n.y*n.z*o,u=this.elements;return u[0]=n.x*n.x*o+i,u[3]=a+n.z*r,u[6]=s-n.y*r,u[1]=a-n.z*r,u[4]=n.y*n.y*o+i,u[7]=c+n.x*r,u[2]=s+n.y*r,u[5]=c-n.x*r,u[8]=n.z*n.z*o+i,t.clone().applyM3(this)}});var a="1.3.3",s=.001,c=.01,u=1/0,l=Math.PI,p=Math.PI/180,h=180/Math.PI,f=1,d=2,y=3,m=4,v=5,g=6,_=7,b=8,w=10,x=11,P=12,O=20,C=21,S=new V3(1,0,0),j=new V3(0,1,0),R=new V3(0,0,1),T=new V3(-1,0,0),E=new V3(0,-1,0),B=new V3(0,0,-1),A=new V2(0,1),I=new V2(0,-1),M=new V2(-1,0),z=new V2(1,0);function Joint3D(){this.rotor=l,this.min=-l,this.max=l,this.freeHinge=!0,this.rotationAxisUV=new V3,this.referenceAxisUV=new V3,this.type=w}function Bone3D(t,e,n,r,i){this.joint=new Joint3D,this.start=new V3,this.end=new V3,this.boneConnectionPoint=C,this.length=0,this.color=i||16777215,this.name="",this.init(t,e,n,r)}function Chain3D(t){this.tmpTarget=new V3,this.tmpMtx=new M3,this.bones=[],this.name="",this.color=t||16777215,this.solveDistanceThreshold=1,this.minIterationChange=.01,this.maxIteration=20,this.precision=.001,this.chainLength=0,this.numBones=0,this.baseLocation=new V3,this.fixedBaseMode=!0,this.baseboneConstraintType=f,this.baseboneConstraintUV=new V3,this.baseboneRelativeConstraintUV=new V3,this.baseboneRelativeReferenceConstraintUV=new V3,this.lastTargetLocation=new V3(u,u,u),this.lastBaseLocation=new V3(u,u,u),this.currentSolveDistance=u,this.connectedChainNumber=-1,this.connectedBoneNumber=-1,this.boneConnectionPoint=C,this.isFullForward=!1,this.embeddedTarget=new V3,this.useEmbeddedTarget=!1}function Structure3D(){this.fixedBaseMode=!0,this.chains=[],this.targets=[],this.numChains=0,this.tmpMtx=new FIK.M3}function Joint2D(t,e,n){this.coordinateSystem=n||x,t<0&&(t*=-1),this.min=void 0!==t?-t*p:-l,this.max=void 0!==e?e*p:l}function Bone2D(t,e,n,r,i,o,a){this.start=new V2,this.end=new V2,this.length=r||0,this.joint=new Joint2D(i,o),this.globalConstraintUV=new V2(1,0),this.boneConnectionPoint=C,this.color=a||null,this.name="",this.setStartLocation(t),e?(this.setEndLocation(e),0===this.length&&(this.length=this.getLength())):n&&this.setEndLocation(this.start.plus(n.normalised().multiplyScalar(this.length)))}function Chain2D(t){this.tmpTarget=new V2,this.bones=[],this.name="",this.solveDistanceThreshold=1,this.minIterationChange=.01,this.maxIteration=15,this.precision=.001,this.chainLength=0,this.numBones=0,this.baseLocation=new V2,this.fixedBaseMode=!0,this.baseboneConstraintType=f,this.baseboneConstraintUV=new V2,this.baseboneRelativeConstraintUV=new V2,this.lastTargetLocation=new V2(u,u),this.lastBaseLocation=new V2(u,u),this.boneConnectionPoint=C,this.currentSolveDistance=u,this.connectedChainNumber=-1,this.connectedBoneNumber=-1,this.color=t||16777215,this.embeddedTarget=new V2,this.useEmbeddedTarget=!1}function Structure2D(){this.fixedBaseMode=!0,this.chains=[],this.targets=[],this.numChains=0}function IKSolver(t){this.startBones=null,this.endBones=null,this.target=null,this.goal=null,this.swivelAngle=0,this.iteration=40,this.thresholds={position:.1,rotation:.1},this.solver=null,this.chain=null}function HISolver(t){this.startBones=null,this.endBones=null,this.scene=t.scene,this.target=null,this.goal=null,this.swivelAngle=0,this.iteration=15,this.thresholds={position:.1,rotation:.1},this.solver=new FIK.Structure2D(this.scene),this.bones=[],this.numBones=0,this.rotation=[],this.initStructure(t)}Object.assign(Joint3D.prototype,{isJoint3D:!0,clone:function(){var t=new Joint3D;return t.type=this.type,t.rotor=this.rotor,t.max=this.max,t.min=this.min,t.freeHinge=this.freeHinge,t.rotationAxisUV.copy(this.rotationAxisUV),t.referenceAxisUV.copy(this.referenceAxisUV),t},testAngle:function(){this.max===l&&this.min===-l?this.freeHinge=!0:this.freeHinge=!1},validateAngle:function(t){return t=(t=t<0?0:t)>180?180:t},setAsBallJoint:function(t){this.rotor=this.validateAngle(t)*p,this.type=w},setHinge:function(t,e,n,r,i){this.type=t,n<0&&(n*=-1),this.min=-this.validateAngle(n)*p,this.max=this.validateAngle(r)*p,this.testAngle(),this.rotationAxisUV.copy(e).normalize(),this.referenceAxisUV.copy(i).normalize()},getHingeReferenceAxis:function(){return this.referenceAxisUV},getHingeRotationAxis:function(){return this.rotationAxisUV},setBallJointConstraintDegs:function(t){this.rotor=this.validateAngle(t)*p},setHingeClockwise:function(t){t<0&&(t*=-1),this.min=-this.validateAngle(t)*p,this.testAngle()},setHingeAnticlockwise:function(t){this.max=this.validateAngle(t)*p,this.testAngle()}}),Object.assign(Bone3D.prototype,{isBone3D:!0,init:function(t,e,n,r){this.setStartLocation(t),e?(this.setEndLocation(e),this.length=this.getLength()):(this.setLength(r),this.setEndLocation(this.start.plus(n.normalised().multiplyScalar(r))))},clone:function(){var t=new Bone3D(this.start,this.end);return t.joint=this.joint.clone(),t},setColor:function(t){this.color=t},setBoneConnectionPoint:function(t){this.boneConnectionPoint=t},setHingeClockwise:function(t){this.joint.setHingeClockwise(t)},setHingeAnticlockwise:function(t){this.joint.setHingeAnticlockwise(t)},setBallJointConstraintDegs:function(t){this.joint.setBallJointConstraintDegs(t)},setStartLocation:function(t){this.start.copy(t)},setEndLocation:function(t){this.end.copy(t)},setLength:function(t){t>0&&(this.length=t)},setJoint:function(t){this.joint=t},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getDirectionUV:function(){return this.end.minus(this.start).normalize()},getLength:function(){return this.start.distanceTo(this.end)}}),Object.assign(Chain3D.prototype,{isChain3D:!0,clone:function(){var t=new Chain3D;return t.solveDistanceThreshold=this.solveDistanceThreshold,t.minIterationChange=this.minIterationChange,t.maxIteration=this.maxIteration,t.precision=this.precision,t.bones=this.cloneBones(),t.baseLocation.copy(this.baseLocation),t.lastTargetLocation.copy(this.lastTargetLocation),t.lastBaseLocation.copy(this.lastBaseLocation),this.baseboneConstraintType!==f&&(t.baseboneConstraintUV.copy(this.baseboneConstraintUV),t.baseboneRelativeConstraintUV.copy(this.baseboneRelativeConstraintUV)),t.fixedBaseMode=this.fixedBaseMode,t.chainLength=this.chainLength,t.numBones=this.numBones,t.currentSolveDistance=this.currentSolveDistance,t.boneConnectionPoint=this.boneConnectionPoint,t.connectedChainNumber=this.connectedChainNumber,t.connectedBoneNumber=this.connectedBoneNumber,t.baseboneConstraintType=this.baseboneConstraintType,t.color=this.color,t.embeddedTarget=this.embeddedTarget.clone(),t.useEmbeddedTarget=this.useEmbeddedTarget,t},clear:function(){for(var t=this.numBones;t--;)this.removeBone(t);this.numBones=0},addBone:function(t){t.setColor(this.color),this.bones.push(t),this.numBones++,1===this.numBones&&(this.baseLocation.copy(t.start),this.baseboneConstraintUV.copy(t.getDirectionUV())),this.updateChainLength()},removeBone:function(t){t<this.numBones&&(this.bones.splice(t,1),this.numBones--,this.updateChainLength())},addConsecutiveBone:function(t,e){this.numBones>0&&this.addBone(new Bone3D(this.bones[this.numBones-1].end,void 0,t.normalised(),e))},addConsecutiveFreelyRotatingHingedBone:function(t,e,n,r){this.addConsecutiveHingedBone(t,e,n,r,180,180,o.genPerpendicularVectorQuick(r))},addConsecutiveHingedBone:function(t,e,n,r,i,o,a){if(0!==this.numBones){var s=t.normalised(),c=r.normalised(),u=new Bone3D(this.bones[this.numBones-1].end,void 0,s,e,this.color);n=n||"global",u.joint.setHinge("global"===n?P:x,c,i,o,a),this.addBone(u)}},addConsecutiveRotorConstrainedBone:function(t,e,n){if(0!==this.numBones){t=t.normalised();var r=new Bone3D(this.bones[this.numBones-1].end,void 0,t,e);r.joint.setAsBallJoint(n),this.addBone(r)}},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getConnectedBoneNumber:function(){return this.connectedBoneNumber},getConnectedChainNumber:function(){return this.connectedChainNumber},getBaseboneConstraintType:function(){return this.baseboneConstraintType},getBaseboneConstraintUV:function(){if(this.baseboneConstraintType!==f)return this.baseboneConstraintUV},getBaseLocation:function(){return this.bones[0].start},getEffectorLocation:function(){return this.bones[this.numBones-1].end},getLastTargetLocation:function(){return this.lastTargetLocation},getLiveChainLength:function(){for(var t=0,e=this.numBones;e--;)t+=this.bones[e].getLength();return t},getBaseboneRelativeReferenceConstraintUV:function(){return this.baseboneRelativeReferenceConstraintUV},setConnectedBoneNumber:function(t){this.connectedBoneNumber=t},setConnectedChainNumber:function(t){this.connectedChainNumber=t},setBoneConnectionPoint:function(t){this.boneConnectionPoint=t},setColor:function(t){this.color=t;for(var e=this.numBones;e--;)this.bones[e].setColor(this.color)},setBaseboneRelativeConstraintUV:function(t){this.baseboneRelativeConstraintUV=t.normalised()},setBaseboneRelativeReferenceConstraintUV:function(t){this.baseboneRelativeReferenceConstraintUV=t.normalised()},setBaseboneConstraintUV:function(t){this.baseboneConstraintUV=t.normalised()},setRotorBaseboneConstraint:function(t,e,n){0!==this.numBones?e.length()>0?(t=t||"global",this.baseboneConstraintType="global"===t?d:m,this.baseboneConstraintUV=e.normalised(),this.baseboneRelativeConstraintUV.copy(this.baseboneConstraintUV),this.bones[0].joint.setAsBallJoint(n)):i("Constraint axis cannot be zero."):i("Chain must contain a basebone before we can specify the basebone constraint type.")},setHingeBaseboneConstraint:function(t,e,n,r,a){0!==this.numBones?e.length()<=0?i("Hinge rotation axis cannot be zero."):a.length()<=0?i("Hinge reference axis cannot be zero."):o.perpendicular(e,a)?(t=t||"global",this.baseboneConstraintType="global"===t?y:v,this.baseboneConstraintUV=e.normalised(),this.bones[0].joint.setHinge("global"===t?P:x,e,n,r,a)):i("The hinge reference axis must be in the plane of the hinge rotation axis, that is, they must be perpendicular."):i("Chain must contain a basebone before we can specify the basebone constraint type.")},setFreelyRotatingGlobalHingedBasebone:function(t){this.setHingeBaseboneConstraint("global",t,180,180,o.genPerpendicularVectorQuick(t))},setGlobalHingedBasebone:function(t,e,n,r){this.setHingeBaseboneConstraint("global",t,e,n,r)},setFreelyRotatingLocalHingedBasebone:function(t){this.setHingeBaseboneConstraint("local",t,180,180,o.genPerpendicularVectorQuick(t))},setLocalHingedBasebone:function(t,e,n,r){this.setHingeBaseboneConstraint("local",t,e,n,r)},setBaseLocation:function(t){this.baseLocation.copy(t)},setFixedBaseMode:function(t){(t||-1===this.connectedChainNumber)&&(this.baseboneConstraintType!==d||t)&&(this.fixedBaseMode=t)},setMaxIterationAttempts:function(t){t<1||(this.maxIteration=t)},setMinIterationChange:function(t){t<0||(this.minIterationChange=t)},setSolveDistanceThreshold:function(t){t<0||(this.solveDistanceThreshold=t)},solveForEmbeddedTarget:function(){if(this.useEmbeddedTarget)return this.solveForTarget(this.embeddedTarget)},resetTarget:function(){this.lastBaseLocation=new V3(u,u,u),this.currentSolveDistance=u},solveForTarget:function(t){this.tmpTarget.set(t.x,t.y,t.z);var e,n=this.precision,r=this.lastBaseLocation.approximatelyEquals(this.baseLocation,n);if(this.lastTargetLocation.approximatelyEquals(this.tmpTarget,n)&&r)return this.currentSolveDistance;var i=null;r?(e=this.bones[this.numBones-1].end.distanceTo(this.tmpTarget),i=this.cloneBones()):e=u;for(var o,a=[],s=u,c=u,l=this.maxIteration;l--;){if((o=this.solveIK(this.tmpTarget))<s){if(s=o,a=this.cloneBones(),o<=this.solveDistanceThreshold)break}else if(Math.abs(o-c)<this.minIterationChange)break;c=o}return s<e?(this.currentSolveDistance=s,this.bones=a):(this.currentSolveDistance=e,this.bones=i),this.lastBaseLocation.copy(this.baseLocation),this.lastTargetLocation.copy(this.tmpTarget),this.currentSolveDistance},solveIK:function(t){if(0!==this.numBones){for(var e,n,r,i,o=this.tmpMtx,a=this.numBones;a--;)if(n=(e=this.bones[a]).length,i=(r=e.joint).type,a!==this.numBones-1){var s=this.bones[a+1].getDirectionUV().negate(),c=e.getDirectionUV().negate();switch(i){case w:c.limitAngle(s,o,r.rotor);break;case P:g=r.getHingeRotationAxis(),c.projectOnPlane(g);break;case x:a>0?(o.createRotationMatrix(this.bones[a-1].getDirectionUV()),g=r.getHingeRotationAxis().clone().applyM3(o)):g=this.baseboneRelativeConstraintUV,c.projectOnPlane(g)}var u=e.end.plus(c.multiplyScalar(n));e.setStartLocation(u),a>0&&this.bones[a-1].setEndLocation(u)}else{e.setEndLocation(t);c=e.getDirectionUV().negated();switch(i){case w:break;case P:g=r.getHingeRotationAxis(),c.projectOnPlane(g);break;case x:o.createRotationMatrix(this.bones[a-1].getDirectionUV()),g=r.getHingeRotationAxis().clone().applyM3(o),c.projectOnPlane(g)}u=t.plus(c.multiplyScalar(n));e.setStartLocation(u),a>0&&this.bones[a-1].setEndLocation(u)}for(a=0;a<this.numBones;a++)if(n=(e=this.bones[a]).length,i=(r=e.joint).type,0!==a){var l=e.getDirectionUV(),p=this.bones[a-1].getDirectionUV();switch(i){case w:l.limitAngle(p,o,r.rotor);break;case P:g=r.getHingeRotationAxis(),_=r.getHingeReferenceAxis(),l.projectOnPlane(g),r.freeHinge||l.constrainedUV(_,g,o,r.min,r.max);break;case x:o.createRotationMatrix(p),g=r.getHingeRotationAxis().clone().applyM3(o),_=r.getHingeReferenceAxis().clone().applyM3(o),l.projectOnPlane(g),r.freeHinge||l.constrainedUV(_,g,o,r.min,r.max)}var h=e.start.plus(l.multiplyScalar(n));e.setEndLocation(h),a<this.numBones-1&&this.bones[a+1].setStartLocation(h)}else{this.fixedBaseMode?e.setStartLocation(this.baseLocation):e.setStartLocation(e.end.minus(e.getDirectionUV().multiplyScalar(n)));var g,_;l=e.getDirectionUV();switch(this.baseboneConstraintType){case f:break;case d:l.limitAngle(this.baseboneConstraintUV,o,r.rotor);break;case m:l.limitAngle(this.baseboneRelativeConstraintUV,o,r.rotor);break;case y:g=r.getHingeRotationAxis(),_=r.getHingeReferenceAxis(),l.projectOnPlane(g),r.freeHinge||l.constrainedUV(_,g,o,r.min,r.max);break;case v:g=this.baseboneRelativeConstraintUV,_=this.baseboneRelativeReferenceConstraintUV,l.projectOnPlane(g),r.freeHinge||l.constrainedUV(_,g,o,r.min,r.max)}h=e.start.plus(l.multiplyScalar(n));e.setEndLocation(h),this.numBones>1&&this.bones[1].setStartLocation(h)}return this.lastTargetLocation.copy(t),this.bones[this.numBones-1].end.distanceTo(t)}},updateChainLength:function(){this.chainLength=0;for(var t=this.numBones;t--;)this.chainLength+=this.bones[t].length},cloneBones:function(){for(var t=[],e=0,n=this.bones.length;e<n;e++)t.push(this.bones[e].clone());return t}}),Object.assign(Structure3D.prototype,{update:function(){for(var t,e,n,r,i,o=0;o<this.numChains;o++){if(t=this.chains[o],e=this.targets[o],-1!==(n=t.getConnectedChainNumber()))switch(r=this.chains[n].bones[t.getConnectedBoneNumber()],t.setBaseLocation(t.getBoneConnectionPoint()===O?r.start:r.end),i=t.getBaseboneConstraintType()){case f:case d:case y:break;case m:case v:this.tmpMtx.createRotationMatrix(r.getDirectionUV());var a=t.getBaseboneConstraintUV().clone().applyM3(this.tmpMtx);t.setBaseboneRelativeConstraintUV(a),i===v&&t.setBaseboneRelativeReferenceConstraintUV(t.bones[0].joint.getHingeReferenceAxis().clone().applyM3(this.tmpMtx))}t.useEmbeddedTarget?t.solveForEmbeddedTarget():t.solveForTarget(e)}},clear:function(){var t;for(t=this.numChains;t--;)this.remove(t);this.chains=[],this.targets=[]},add:function(t,e){this.chains.push(t),this.targets.push(e),this.numChains++},remove:function(t){this.chains[t].clear(),this.chains.splice(t,1),this.targets.splice(t,1),this.numChains--},setFixedBaseMode:function(t){this.fixedBaseMode=t;for(var e=this.numChains;e--;)-1===this.chains[e].getConnectedChainNumber()&&this.chains[e].setFixedBaseMode(this.fixedBaseMode)},getNumChains:function(){return this.numChains},getChain:function(t){return this.chains[t]},connectChain:function(t,e,n,r,i,o,a){var s=e,c=n;if(!(e>this.numChains||n>this.chains[e].numBones)){var u=t.clone();void 0!==a&&u.setColor(a),u.setBoneConnectionPoint("end"===r?C:O),u.setConnectedChainNumber(s),u.setConnectedBoneNumber(c);var l="end"===r?this.chains[s].bones[c].end:this.chains[s].bones[c].start;u.setBaseLocation(l),u.setFixedBaseMode(!0);for(var p=0;p<u.numBones;p++)u.bones[p].start.add(l),u.bones[p].end.add(l);this.add(u,i,o)}}}),Object.assign(Joint2D.prototype,{isJoint2D:!0,clone:function(){var t=new Joint2D;return t.coordinateSystem=this.coordinateSystem,t.max=this.max,t.min=this.min,t},validateAngle:function(t){return t=(t=t<0?0:t)>180?180:t},set:function(t){this.max=t.max,this.min=t.min,this.coordinateSystem=t.coordinateSystem},setClockwiseConstraintDegs:function(t){t<0&&(t*=-1),this.min=-this.validateAngle(t)*p},setAnticlockwiseConstraintDegs:function(t){this.max=this.validateAngle(t)*p},setConstraintCoordinateSystem:function(t){this.coordinateSystem=t},getConstraintCoordinateSystem:function(){return this.coordinateSystem}}),Object.assign(Bone2D.prototype,{isBone2D:!0,clone:function(){var t=new Bone2D(this.start,this.end);return t.length=this.length,t.globalConstraintUV=this.globalConstraintUV,t.boneConnectionPoint=this.boneConnectionPoint,t.joint=this.joint.clone(),t.color=this.color,t.name=this.name,t},setName:function(t){this.name=t},setColor:function(t){this.color=t},setBoneConnectionPoint:function(t){this.boneConnectionPoint=t},setStartLocation:function(t){this.start.copy(t)},setEndLocation:function(t){this.end.copy(t)},setLength:function(t){t>0&&(this.length=t)},setGlobalConstraintUV:function(t){this.globalConstraintUV=t},setJoint:function(t){this.joint=t},setClockwiseConstraintDegs:function(t){this.joint.setClockwiseConstraintDegs(t)},setAnticlockwiseConstraintDegs:function(t){this.joint.setAnticlockwiseConstraintDegs(t)},setJointConstraintCoordinateSystem:function(t){this.joint.setConstraintCoordinateSystem(t)},getGlobalConstraintUV:function(){return this.globalConstraintUV},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getDirectionUV:function(){return this.end.minus(this.start).normalize()},getLength:function(){return this.start.distanceTo(this.end)}}),Object.assign(Chain2D.prototype,{isChain2D:!0,clone:function(){var t=new Chain2D;return t.solveDistanceThreshold=this.solveDistanceThreshold,t.minIterationChange=this.minIterationChange,t.maxIteration=this.maxIteration,t.precision=this.precision,t.bones=this.cloneBones(),t.baseLocation.copy(this.baseLocation),t.lastTargetLocation.copy(this.lastTargetLocation),t.lastBaseLocation.copy(this.lastBaseLocation),this.baseboneConstraintType!==f&&(t.baseboneConstraintUV.copy(this.baseboneConstraintUV),t.baseboneRelativeConstraintUV.copy(this.baseboneRelativeConstraintUV)),t.fixedBaseMode=this.fixedBaseMode,t.chainLength=this.chainLength,t.numBones=this.numBones,t.currentSolveDistance=this.currentSolveDistance,t.boneConnectionPoint=this.boneConnectionPoint,t.connectedChainNumber=this.connectedChainNumber,t.connectedBoneNumber=this.connectedBoneNumber,t.baseboneConstraintType=this.baseboneConstraintType,t.color=this.color,t.embeddedTarget=this.embeddedTarget.clone(),t.useEmbeddedTarget=this.useEmbeddedTarget,t},clear:function(){for(var t=this.numBones;t--;)this.removeBone(t)},addBone:function(t){null===t.color&&t.setColor(this.color),this.bones.push(t),0===this.numBones&&(this.baseLocation.copy(t.start),this.baseboneConstraintUV.copy(t.getDirectionUV())),this.numBones++,this.updateChainLength()},removeBone:function(t){t<this.numBones&&(this.bones.splice(t,1),this.numBones--,this.updateChainLength())},addConsecutiveBone:function(t,e,n,r,a){if(0!==this.numBones){if(t.isBone2D){var s=t,c=s.getDirectionUV();o.validateDirectionUV(c);var u=s.length;o.validateLength(u);var l=this.bones[this.numBones-1].end;s.setStartLocation(l),s.setEndLocation(l.plus(c.multiplyScalar(u))),this.addBone(s)}else if(t.isVector2){a=a||this.color,o.validateDirectionUV(t),o.validateLength(e);l=this.bones[this.numBones-1].end;this.addBone(new Bone2D(l,null,t.normalised(),e,n,r,a))}}else i("Chain is empty ! need first bone")},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getConnectedBoneNumber:function(){return this.connectedBoneNumber},getConnectedChainNumber:function(){return this.connectedChainNumber},getEmbeddedTarget:function(){return this.embeddedTarget},getBaseboneConstraintType:function(){return this.baseboneConstraintType},getBaseboneConstraintUV:function(){if(this.baseboneConstraintType!==f)return this.baseboneConstraintUV},getBaseLocation:function(){return this.bones[0].start},getEffectorLocation:function(){return this.bones[this.numBones-1].end},getLastTargetLocation:function(){return this.lastTargetLocation},getLiveChainLength:function(){for(var t=0,e=this.numBones;e--;)t+=this.bones[e].getLength();return t},setColor:function(t){this.color=t;for(var e=this.numBones;e--;)this.bones[e].setColor(this.color)},setBaseboneRelativeConstraintUV:function(t){this.baseboneRelativeConstraintUV=t},setConnectedBoneNumber:function(t){this.connectedBoneNumber=t},setConnectedChainNumber:function(t){this.connectedChainNumber=t},setBoneConnectionPoint:function(t){this.boneConnectionPoint=t},setBaseboneConstraintUV:function(t){o.validateDirectionUV(t),this.baseboneConstraintUV.copy(t.normalised())},setBaseLocation:function(t){this.baseLocation.copy(t)},setBaseboneConstraintType:function(t){this.baseboneConstraintType=t},setFixedBaseMode:function(t){(t||-1===this.connectedChainNumber)&&(this.baseboneConstraintType!==g||t)&&(this.fixedBaseMode=t)},setMaxIterationAttempts:function(t){t<1||(this.maxIteration=t)},setMinIterationChange:function(t){t<0||(this.minIterationChange=t)},setSolveDistanceThreshold:function(t){t<0||(this.solveDistanceThreshold=t)},solveForEmbeddedTarget:function(){if(this.useEmbeddedTarget)return this.solveForTarget(this.embeddedTarget)},resetTarget:function(){this.lastBaseLocation=new V2(u,u),this.currentSolveDistance=u},solveForTarget:function(t){this.tmpTarget.set(t.x,t.y);var e,n=this.precision,r=this.lastBaseLocation.approximatelyEquals(this.baseLocation,n);if(this.lastTargetLocation.approximatelyEquals(this.tmpTarget,n)&&r)return this.currentSolveDistance;var i=null;r?(e=this.bones[this.numBones-1].end.distanceTo(this.tmpTarget),i=this.cloneBones()):e=u;for(var o,a=[],s=u,c=u,l=this.maxIteration;l--;){if((o=this.solveIK(this.tmpTarget))<s){if(s=o,a=this.cloneBones(),o<=this.solveDistanceThreshold)break}else if(Math.abs(o-c)<this.minIterationChange)break;c=o}return s<e?(this.currentSolveDistance=s,this.bones=a):(this.currentSolveDistance=e,this.bones=i),this.lastBaseLocation.copy(this.baseLocation),this.lastTargetLocation.copy(this.tmpTarget),this.currentSolveDistance},solveIK:function(t){if(0!==this.numBones){for(var e,n,r,i,o,a,s,c=this.numBones;c--;)n=(e=this.bones[c]).length,c!==this.numBones-1?(r=this.bones[c+1],a=e.getDirectionUV().negate(),s=e.joint.coordinateSystem===x?r.getDirectionUV().negate():e.getGlobalConstraintUV().negated(),a.constrainedUV(s,r.joint.min,r.joint.max),i=e.end.plus(a.multiplyScalar(n)),e.setStartLocation(i),c>0&&this.bones[c-1].setEndLocation(i)):(e.setEndLocation(t),a=e.getDirectionUV().negate(),c>0?(s=e.joint.coordinateSystem===x?this.bones[c-1].getDirectionUV().negate():e.getGlobalConstraintUV().negated(),a.constrainedUV(s,e.joint.min,e.joint.max)):e.joint.coordinateSystem!==x&&(s=e.getGlobalConstraintUV().negated(),a.constrainedUV(s,e.joint.min,e.joint.max)),i=e.end.plus(a.multiplyScalar(n)),e.setStartLocation(i),c>0&&this.bones[c-1].setEndLocation(i));for(c=0;c<this.numBones;c++)n=(e=this.bones[c]).length,0!==c?(a=e.getDirectionUV(),s=e.joint.coordinateSystem===x?this.bones[c-1].getDirectionUV():e.getGlobalConstraintUV(),a.constrainedUV(s,e.joint.min,e.joint.max),o=e.start.plus(a.multiplyScalar(n)),e.setEndLocation(o),c<this.numBones-1&&this.bones[c+1].setStartLocation(o)):(this.fixedBaseMode?e.setStartLocation(this.baseLocation):(i=e.end.minus(e.getDirectionUV().multiplyScalar(n)),e.setStartLocation(i)),a=e.getDirectionUV(),this.baseboneConstraintType===f?(o=e.start.plus(a.multiplyScalar(n)),e.setEndLocation(o),this.numBones>1&&this.bones[1].setStartLocation(o)):(s=this.baseboneConstraintType===b?this.baseboneRelativeConstraintUV:this.baseboneConstraintUV,a.constrainedUV(s,e.joint.min,e.joint.max),o=e.start.plus(a.multiplyScalar(n)),e.setEndLocation(o),c<this.numBones-1&&this.bones[c+1].setStartLocation(o)));return this.lastTargetLocation.copy(t),this.bones[this.numBones-1].end.distanceTo(t)}},updateChainLength:function(){this.chainLength=0;for(var t=this.numBones;t--;)this.chainLength+=this.bones[t].length},cloneBones:function(){for(var t=[],e=0,n=this.bones.length;e<n;e++)t.push(this.bones[e].clone());return t}}),Object.assign(Structure2D.prototype,{isStructure2D:!0,update:function(){new THREE.Vector3;for(var t,e,n,r,i=0;i<this.numChains;i++){if(t=this.chains[i],e=this.targets[i]||null,n=t.getConnectedChainNumber(),r=t.getBaseboneConstraintType(),-1!==n&&r!==g){var o=this.chains[n].bones[t.getConnectedBoneNumber()];t.setBaseLocation(t.getBoneConnectionPoint()===O?o.start:o.end);var a=o.getDirectionUV();if(r===_)t.setBaseboneConstraintUV(a);else if(r===b){var s=A.getSignedAngle(a),c=t.getBaseboneConstraintUV().clone().rotate(s);t.setBaseboneRelativeConstraintUV(c)}}t.useEmbeddedTarget?console.log("embed",t.solveForEmbeddedTarget()):t.solveForTarget(e)}},setFixedBaseMode:function(t){this.fixedBaseMode=t;for(var e=this.numChains;e--;)-1===this.chains[e].getConnectedChainNumber()&&this.chains[e].setFixedBaseMode(this.fixedBaseMode)},clear:function(){var t;for(t=this.numChains;t--;)this.remove(t);this.chains=[],this.targets=[]},add:function(t,e){this.chains.push(t),this.numChains++,e&&this.targets.push(e)},remove:function(t){this.chains[t].clear(),this.chains.splice(t,1),this.targets.splice(t,1),this.numChains--},getNumChains:function(){return this.numChains},getChain:function(t){return this.chains[t]},connectChain:function(t,e,n,r,o,a,s){var c=e,u=n;if(r=r||"end",c>this.numChains)i("Chain not existe !");else if(u>this.chains[c].numBones)i("Bone not existe !");else{var l=t.clone();l.setBoneConnectionPoint("end"===r?C:O),l.setConnectedChainNumber(c),l.setConnectedBoneNumber(u);var p="end"===r?this.chains[c].bones[u].end:this.chains[c].bones[u].start;l.setBaseLocation(p),l.setFixedBaseMode(!0);for(var h=0;h<l.numBones;h++)l.bones[h].start.add(p),l.bones[h].end.add(p);this.add(l,o,a)}}}),Object.assign(IKSolver.prototype,{isIKSolver:!0}),Object.assign(HISolver.prototype,{isHISolver:!0,initStructure:function(t){this.startBones=t.start,this.endBones=t.end,this.angles=t.angles;var e=this.startBones,n=e.children[0];this.bones.push(e);for(var r=0;r<100;r++){if(this.bones.push(n),n===this.endBones){this.createChain();break}n=(e=n).children[0]}},createChain:function(){this.numBones=this.bones.length;var t=new Chain2D;t.setFixedBaseMode(!0),t.setBaseboneConstraintType(FIK.LOCAL_ABSOLUTE),this.fakeBone=new Bone2D(new V2(0,-1),new V2(0,0)),this.target=new THREE.Vector3;for(var e=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3,i=new V2,o=0,a=0;a<this.numBones;a++)a>0&&(this.target.add(this.bones[a].position),o=e.distanceTo(this.bones[a].position),this.bones[a-1].getWorldPosition(n),this.bones[a].getWorldPosition(r),r.sub(n).normalize(),0===r.z?i.set(r.x,r.y):0===r.x&&i.set(r.z,r.y),1===a?t.addBone(new Bone2D(new V2(0,0),null,i,o,this.angles[a-1][0],this.angles[a-1][1])):t.addConsecutiveBone(i,o,this.angles[a-1][0],this.angles[a-1][1]));this.target.set(10,20,0),this.solver.add(t,this.target,!0)},update:function(){this.solver.update();for(var t,e=this.solver.chains[0].bones,n=this.numBones-1,r=0;r<n;r++)t=0===r?o.findAngle(this.fakeBone,e[r]):o.findAngle(e[r-1],e[r]),this.rotation[r]=t*o.toDeg,this.rotation[r]+=t<0?180:-180,this.rotation[r]*=-1;for(r=0;r<n;r++)this.bones[r].rotation.z=this.rotation[r]*o.toRad;console.log(this.rotation)}})},function(t,e,n){"use strict";var r;n.r(e),n.d(e,"FileInMemory",function(){return i}),function(t){t.files={}}(r||(r={}));var i=function(){function FileInMemory(){}return FileInMemory.prototype.read=function(t){return new Promise(function(e,n){var i=r.files[t];i?e(i):n("Can't open '"+t+"'")})},FileInMemory.prototype.write=function(t,e){return new Promise(function(n,i){r.files[t]=e,n()})},FileInMemory.prototype.delete=function(t){return console.assert(!1,"Not Implemented"),Promise.reject()},FileInMemory.prototype.renameFile=function(t,e){return console.assert(!1,"Not Implemented"),Promise.reject()},FileInMemory.prototype.renameFolder=function(t,e){return console.assert(!1,"Not Implemented"),Promise.reject()},FileInMemory.prototype.clearAllFiles=function(){return console.assert(!1,"Not Implemented"),Promise.reject()},FileInMemory.prototype.temporaryGetFiles=function(){return r.files},FileInMemory}()},function(t,e,n){"use strict";var r;n.r(e),n.d(e,"FileStandaloneWeb",function(){return i}),r||(r={});var i=function(){function FileStandaloneWeb(t){console.assert(!r.defaultAssets),console.assert(t),r.defaultAssets=t}return FileStandaloneWeb.prototype.read=function(t){var e=r.defaultAssets[t];return e?Promise.resolve(e):new Promise(function(e,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){r.readyState===XMLHttpRequest.DONE&&(200===r.status||0===r.status?e(r.responseText):n("Can't open '"+t+"', status: "+r.status))},r.open("GET",t,!0),r.send(null)})},FileStandaloneWeb.prototype.write=function(t,e){return Promise.reject()},FileStandaloneWeb.prototype.delete=function(t){return Promise.reject()},FileStandaloneWeb.prototype.renameFile=function(t,e){return Promise.reject()},FileStandaloneWeb.prototype.renameFolder=function(t,e){return Promise.reject()},FileStandaloneWeb.prototype.clearAllFiles=function(){return Promise.reject()},FileStandaloneWeb}()},function(t,e,n){"use strict";n.r(e);var r,i,o,a,s,c,u=(r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function __(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),l=function(t){function Reference(e,n){var r=t.call(this)||this;return r.baseTypeName=function(){return e.name},r.getInstance=function(){return r.instance},r.instance=n,r}return u(Reference,t),Reference}(function(){return function ReferenceBase(){}}());!function(t){t[t.None=0]="None",t[t.Linear=1]="Linear",t[t.Additive=2]="Additive"}(i||(i={})),function(t){t[t.Linear=0]="Linear",t[t.Nearest=1]="Nearest"}(o||(o={})),function(t){t[t.Back=0]="Back",t[t.Front=1]="Front",t[t.None=2]="None"}(a||(a={})),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent"}(s||(s={})),function(t){t[t._8=8]="_8",t[t._16=16]="_16",t[t._32=32]="_32",t[t._64=64]="_64",t[t._256=256]="_256",t[t._512=512]="_512",t[t._1024=1024]="_1024",t[t._2048=2048]="_2048",t[t._4096=4096]="_4096"}(c||(c={}));var p,h;n(55);function Attributes_hidden(){return Reflect.metadata("hidden",!0)}function unserializable(){return Reflect.metadata("unserializable",!0)}function editable(t){return Reflect.metadata("editable",t)}function creatable(t){return Reflect.metadata("creatable",t)}function referencable(t){return Reflect.metadata("referencable",t)}function mandatory(){return Reflect.metadata("mandatory",!0)}function hasDedicatedEditor(t){return Reflect.metadata("hasDedicatedEditor",t)}function displayName(t){return Reflect.metadata("displayName",t)}function sortOrder(t){return Reflect.metadata("sortOrder",t)}function helpUrl(t){return Reflect.metadata("helpUrl",t)}function Attributes_enumLiterals(t,e){var n,r={},i=Object.entries(t);console.assert(i.length%2==0);for(var o=i.length/2;o<i.length;++o)Object.assign(r,((n={})[i[o][0]]=i[o][1],n));return Reflect.metadata("enumLiterals",{literals:r,getDisplayName:e})}function exclusiveWith(t){return Reflect.metadata("exclusiveWith",t)}!function(t){t.rootTypeName="SerializableObject",t.rawTypeInfos=[],t.findTypeNode=function findTypeNode(t,e){if(t.typeName===e)return t;for(var n=0,r=t.derivedTypes;n<r.length;n++){var i=findTypeNode(r[n],e);if(i)return i}},t.getTypesUnderNode=function getTypesUnderNode(t,e){for(var n=0,r=t.derivedTypes;n<r.length;n++){var i=r[n];e.push(i.typeName),getTypesUnderNode(i,e)}}}(p||(p={})),function(t){t.buildTypeTree=function buildTypeTree(){p.typeTree={typeName:p.rootTypeName,derivedTypes:[]};for(var t=function(t){for(var e=t,n=0;e!==p.rootTypeName;){++n;var r=p.rawTypeInfos.filter(function(t){return t.derivedTypes.some(function(t){return t===e})}),i=r.length?r[0]:void 0;if(!i)return console.assert(!1,"Cannot find parent type for '"+e+"', please register it using Factory.registerObject()"),-1;e=i.typeName}return n},e=0,n=p.rawTypeInfos;e<n.length;e++){var r=n[e];r.depth=t(r.typeName)}p.rawTypeInfos.sort(function(t,e){return t.depth-e.depth});for(var i=0,o=p.rawTypeInfos;i<o.length;i++){var a=o[i],s=p.findTypeNode(p.typeTree,a.typeName);if(s)for(var c=0,u=a.derivedTypes;c<u.length;c++){var l=u[c];s.derivedTypes.push({parent:s,typeName:l,derivedTypes:[]})}}},t.registerRawTypeInfo=function registerRawTypeInfo(t,e){var n=p.rawTypeInfos.filter(function(e){return e.typeName===t}),r=n.length?n[0]:void 0;r?r.derivedTypes.push(e):p.rawTypeInfos.push({typeName:t,derivedTypes:[e],depth:-1})}}(h||(h={}));var f,d=function(){function RTTI(){}return RTTI.isObjectOfType=function(t,e){for(var n=p.findTypeNode(p.typeTree,t);n;){if(n.typeName===e)return!0;n=n.parent}return!1},RTTI.getAncestorTypes=function(t,e){for(var n=[],r=p.findTypeNode(p.typeTree,t);r&&r.parent&&r.parent.typeName!==e;)n.push(r.parent.typeName),r=p.findTypeNode(p.typeTree,r.parent.typeName);return n},RTTI.getDerivedObjectTypes=function(t){var e=[],n=p.findTypeNode(p.typeTree,t);return n&&p.getTypesUnderNode(n,e),e},RTTI}();f||(f={});var y,m=function(){function ISerializerInternal(){}return Object.defineProperty(ISerializerInternal,"instance",{get:function(){return f.instance},set:function(t){f.instance=t},enumerable:!0,configurable:!0}),ISerializerInternal}();y||(y={});var v,g=function(){function IFactoryInternal(){}return Object.defineProperty(IFactoryInternal,"instance",{get:function(){return y.instance},set:function(t){y.instance=t},enumerable:!0,configurable:!0}),IFactoryInternal}(),_=function(){function SerializableObject(){}return SerializableObject.prototype.isA=function(t){return d.isObjectOfType(this.constructor.name,t.name)},SerializableObject.prototype.copy=function(){var t=g.instance.createObject(this.constructor.name);return t.deserialize(this.serialize()),t},SerializableObject.prototype.destroy=function(){},SerializableObject.prototype.setProperty=function(t,e){this[t]=e},SerializableObject.prototype.serialize=function(){return m.instance.serializeObject(this)},SerializableObject.prototype.deserialize=function(t){return m.instance.deserializeObject(this,t),Promise.resolve(this)},SerializableObject.prototype.upgrade=function(t,e){return t},SerializableObject.prototype.setState=function(t){var e=this;Object.entries(t).forEach(function(t){var n,r=t[0],i=t[1];Object.assign(e,((n={})[r]=i,n))})},SerializableObject}(),b=n(56),w=function(){function EngineUtils(){}return EngineUtils.isObjectLoaded=function(t){for(var e=0,n=Object.values(t);e<n.length;e++){var r=n[e];if(null!==r)if("AssetReference"===(r.constructor?r.constructor.name:null)){var i=r;if(!EngineUtils.isAssetRefLoaded(i))return!1}}return!0},EngineUtils.isAssetRefLoaded=function(t){return!!t.isResolved&&!(t.asset&&!t.asset.isLoaded())},EngineUtils.makeUniqueId=function(){return b()},EngineUtils}(),x=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),P=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},O=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},C=function(t){function UniqueObject(){var e=t.call(this)||this;return e.id=w.makeUniqueId(),e.name=e.constructor.name,e}return x(UniqueObject,t),UniqueObject.prototype.copy=function(){var t=g.instance.createObject(this.constructor.name);return t.templatePath=this.templatePath,t.deserialize(this.serialize()),t.id=w.makeUniqueId(),t},P([Attributes_hidden(),O("design:type",String)],UniqueObject.prototype,"id",void 0),P([Attributes_hidden(),O("design:type",String)],UniqueObject.prototype,"name",void 0),P([unserializable(),O("design:type",String)],UniqueObject.prototype,"templatePath",void 0),UniqueObject}(_),S=n(0);v||(v={});var j,R=function(){function IObjectManagerInternal(){}return Object.defineProperty(IObjectManagerInternal,"instance",{get:function(){return v.instance},set:function(t){v.instance=t},enumerable:!0,configurable:!0}),IObjectManagerInternal}(),T=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),E=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},B=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},A=function(t){function Asset(){var e=null!==t&&t.apply(this,arguments)||this;return e.isPersistent=!1,e.deleted=new S.AsyncEvent,e}return T(Asset,t),Asset.prototype.isLoaded=function(){return!0},Asset.prototype.save=function(){return this.isPersistent?R.instance.saveObject(this):Promise.resolve()},Asset.prototype.destroy=function(){this.deleted.post(this.id),t.prototype.destroy.call(this)},E([unserializable(),B("design:type",Object)],Asset.prototype,"isPersistent",void 0),E([unserializable(),B("design:type",Object)],Asset.prototype,"deleted",void 0),Asset}(C);!function(t){t.externalLogger=function(){}}(j||(j={}));var I,M,z,k=function(){function Debug(){}return Debug.log=function(t){console.log(t),j.externalLogger(t)},Debug.logError=function(t){console.error(t),j.externalLogger(t)},Debug.logWarning=function(t){console.warn(t),j.externalLogger(t)},Debug.logVector3=function(t){var e=t.x+", "+t.y+", "+t.z;console.log(e),j.externalLogger(e)},Debug.logVector2=function(t){var e=t.x+", "+t.y;console.log(e),j.externalLogger(e)},Debug}(),D=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),F=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},L=function(t){function GraphicAsset(){return null!==t&&t.apply(this,arguments)||this}return D(GraphicAsset,t),GraphicAsset.prototype.destroy=function(){this.graphicUnload(),t.prototype.destroy.call(this)},GraphicAsset.prototype.graphicLoad=function(){return!0},GraphicAsset.prototype.graphicUnload=function(){},GraphicAsset=F([creatable(!1),referencable(!1)],GraphicAsset)}(A),N=function(){function ObjectPool(t,e){this._size=0,this._initialCapacity=e,this._capacity=e,this._objects=[],this._objects.length=e;for(var n=0;n<e;++n)this._objects[n]=new t;this._creator=function(){return new t}}return Object.defineProperty(ObjectPool.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),ObjectPool.prototype.flush=function(){this._size=0},ObjectPool.prototype.peek=function(t){return this._objects[t]},ObjectPool.prototype.get=function(){return this._size===this._capacity&&this.grow(),this._objects[this._size++]},ObjectPool.prototype.shrink=function(){this._capacity=this._initialCapacity,this._objects.length=this._capacity,this._size=Math.min(this._size,this._capacity)},ObjectPool.prototype.grow=function(){k.log(this._objects[0].constructor.name+" pool capacity reached, doubling the pool. Consider allocating a bigger pool.");var t=2*this._capacity;this._objects.length=t;for(var e=this._capacity;e<t;++e)this._objects[e]=this._creator();this._capacity=t},ObjectPool}(),V=function(){function Vector3(t,e,n){this._x=t||0,this._y=e||0,this._z=n||0}return Object.defineProperty(Vector3.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(Vector3.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(Vector3.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t},enumerable:!0,configurable:!0}),Object.defineProperty(Vector3.prototype,"length",{get:function(){return Math.sqrt(this.lengthSq)},enumerable:!0,configurable:!0}),Object.defineProperty(Vector3.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!0,configurable:!0}),Vector3.distance=function(t,e){return Math.sqrt(Vector3.distanceSq(t,e))},Vector3.distanceSq=function(t,e){var n=t.x-e.x,r=t.y-e.y,i=t.z-e.z;return n*n+r*r+i*i},Vector3.fromPool=function(){return Vector3.pool.get()},Vector3.fromArray=function(t,e){var n=e||0;return new Vector3(t[n],t[n+1],t[n+2])},Vector3.prototype.flip=function(){var t=this.x,e=this.y,n=this.z;return this._x=-t,this._y=-e,this.z=-n,this},Vector3.prototype.cross=function(t){return this.crossVectors(this,t)},Vector3.prototype.crossVectors=function(t,e){var n=t._x,r=t._y,i=t._z,o=e._x,a=e._y,s=e._z;return this._x=r*s-i*a,this._y=i*o-n*s,this.z=n*a-r*o,this},Vector3.prototype.dot=function(t){return this._x*t._x+this._y*t._y+this._z*t._z},Vector3.prototype.substract=function(t){return this.substractVectors(this,t)},Vector3.prototype.substractVectors=function(t,e){return this._x=t._x-e._x,this._y=t._y-e._y,this.z=t._z-e._z,this},Vector3.prototype.add=function(t){return this.addVectors(this,t)},Vector3.prototype.addVectors=function(t,e){return this._x=t._x+e._x,this._y=t._y+e._y,this.z=t._z+e._z,this},Vector3.prototype.multiply=function(t){return this._x*=t,this._y*=t,this.z*=t,this},Vector3.prototype.multiplyVector=function(t){return this._x*=t._x,this._y*=t._y,this.z*=t._z,this},Vector3.prototype.divide=function(t){var e=1/t;return this._x*=e,this._y*=e,this.z*=e,this},Vector3.prototype.divideVector=function(t){return this._x/=t._x,this._y/=t._y,this.z/=t._z,this},Vector3.prototype.min=function(){return Math.min(this._x,this._y,this._z)},Vector3.prototype.max=function(){return Math.max(this._x,this._y,this._z)},Vector3.prototype.normalize=function(){var t=this.length;return 0===t?this:this.divide(t)},Vector3.prototype.lerp=function(t,e){return this.lerpVectors(this,t,e)},Vector3.prototype.lerpVectors=function(t,e,n){return this._x=t._x+(e._x-t._x)*n,this._y=t._y+(e._y-t._y)*n,this.z=t._z+(e._z-t._z)*n,this},Vector3.prototype.slerp=function(t,e){return this.slerpVectors(this,t,e)},Vector3.prototype.slerpVectors=function(t,e,n){var r=t.dot(e);r=Math.max(Math.min(r,1),-1);var i=Math.acos(r)*n,o=Vector3.dummy.copy(t).multiply(-r).add(e),a=o.length;return a>0&&o.multiply(1/a).multiply(Math.sin(i)),this.copy(t).multiply(Math.cos(i)).add(o)},Vector3.prototype.distFromSq=function(t){var e=this._x-t._x,n=this._y-t._y,r=this._z-t._z;return e*e+n*n+r*r},Vector3.prototype.distFrom=function(t){return Math.sqrt(this.distFromSq(t))},Vector3.prototype.set=function(t,e,n){return this._x=t,this._y=e,this.z=n,this},Vector3.prototype.setFromArray=function(t,e){var n=e||0;return console.assert(t.length>n+2),this._x=t[n],this._y=t[n+1],this.z=t[n+2],this},Vector3.prototype.setFromMatrix=function(t){return this._x=t.data[12],this._y=t.data[13],this.z=t.data[14],this},Vector3.prototype.setFromMatrixColumn=function(t,e){return this.setFromArray(t.data,4*e)},Vector3.prototype.rotate=function(t){var e=this._x,n=this._y,r=this._z,i=t.x,o=t.y,a=t.z,s=t.w,c=s*e+o*r-a*n,u=s*n+a*e-i*r,l=s*r+i*n-o*e,p=-i*e-o*n-a*r;return this._x=c*s+p*-i+u*-a-l*-o,this._y=u*s+p*-o+l*-i-c*-a,this.z=l*s+p*-a+c*-o-u*-i,this},Vector3.prototype.transform=function(t){var e=this._x,n=this._y,r=this._z,i=t.data;this._x=i[0]*e+i[4]*n+i[8]*r+i[12],this._y=i[1]*e+i[5]*n+i[9]*r+i[13],this._z=i[2]*e+i[6]*n+i[10]*r+i[14];var o=i[3]*e+i[7]*n+i[11]*r+i[15];return this.multiply(1/o)},Vector3.prototype.transformDirection=function(t){var e=this._x,n=this._y,r=this._z,i=t.data;return this._x=i[0]*e+i[4]*n+i[8]*r,this._y=i[1]*e+i[5]*n+i[9]*r,this._z=i[2]*e+i[6]*n+i[10]*r,this.normalize()},Vector3.prototype.copy=function(t){return this._x=t._x,this._y=t._y,this.z=t._z,this},Vector3.prototype.equals=function(t){return this._x===t._x&&this._y===t._y&&this._z===t._z},Vector3.prototype.asArray=function(){return this._array?(this._array[0]=this._x,this._array[1]=this._y,this._array[2]=this._z,this._array):(this._array=[this._x,this._y,this._z],this._array)},Vector3.prototype.toArray=function(t,e){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t},Vector3.prototype.projectOnLine=function(t,e){var n=Vector3.dummy,r=Vector3.dummy2;return n.substractVectors(e,t).normalize(),r.substractVectors(this,t),n.dot(r)},Vector3.prototype.projectOnVector=function(t){var e=t.length;if(e<Number.EPSILON)return this;var n=Vector3.dummy.copy(t).multiply(1/e),r=this.dot(n);return this.copy(n).multiply(r)},Vector3.prototype.plus=function(t){return Vector3.dummy.copy(this).add(t)},Vector3.prototype.minus=function(t){return Vector3.dummy.copy(this).substract(t)},Vector3.prototype.reflect=function(t){Vector3.dummy.copy(t).multiply(2*this.dot(t)),this.substract(Vector3.dummy)},Vector3.zero=new Vector3,Vector3.one=new Vector3(1,1,1),Vector3.right=new Vector3(1,0,0),Vector3.up=new Vector3(0,1,0),Vector3.forward=new Vector3(0,0,1),Vector3.dummy=new Vector3,Vector3.dummy2=new Vector3,Vector3.pool=new N(Vector3,128),Vector3}();z=I||(I={}),(M=z.getClosestPointOnLine||(z.getClosestPointOnLine={})).vc=new V,M.vd=new V;var U,W=function(){function MathEx(){}return MathEx.toRadians=function(t){return t*MathEx.degreesToRadians},MathEx.toDegrees=function(t){return t*MathEx.radiansToDegrees},MathEx.clamp=function(t,e,n){return t<e?e:t>n?n:t},MathEx.isZero=function(t){return t>-MathEx.EPSILON&&t<MathEx.EPSILON},MathEx.isEqual=function(t,e){return MathEx.isZero(Math.abs(t-e))},MathEx.lerp=function(t,e,n){return t+(e-t)*n},MathEx.ceilPowerOfTwo=function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},MathEx.sphericalToCartesian=function(t,e,n,r){return r.x=t*Math.cos(e)*Math.sin(n),r.y=t*Math.sin(e)*Math.sin(n),r.z=t*Math.cos(n),r},MathEx.getClosestPointOnLine=function(t,e,n,r){var i=I.getClosestPointOnLine,o=i.vc,a=i.vd;o.substractVectors(t,e),a.substractVectors(n,e);var s=a.length;a.multiply(1/s);var c=a.dot(o);return c<0?e:c>s?n:r.copy(a).multiply(c).add(e)},MathEx.getNextPow2=function(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},MathEx.isPowerOf2=function(t){return 0==(t&t-1)},MathEx.euclideanModulo=function(t,e){return(t%e+e)%e},MathEx.PI2=2*Math.PI,MathEx.EPSILON=1e-6,MathEx.degreesToRadians=.017453288,MathEx.radiansToDegrees=57.29579143,MathEx}();!function(t){(U||(U={})).hue2rgb=function hue2rgb(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*(e-t)*n:n<.5?e:n<2/3?t+6*(e-t)*(2/3-n):t}}();var q,G,H=function(){function Color(t,e,n,r){this.set(t||0,e||0,n||0,r)}return Color.lerp=function(t,e,n,r){return r||(r=Color.dummy),r.r=W.lerp(t.r,e.r,n),r.g=W.lerp(t.g,e.g,n),r.b=W.lerp(t.b,e.b,n),r.a=W.lerp(t.a,e.a,n),r},Color.prototype.set=function(t,e,n,r){return this.r=t,this.g=e,this.b=n,this.a=void 0!==r?r:1,this},Color.prototype.setFromArray=function(t){return this.r=t.length>0?t[0]:0,this.g=t.length>1?t[1]:0,this.b=t.length>2?t[2]:0,this.a=t.length>3?t[3]:1,this},Color.prototype.setFromChromeColor=function(t,e,n,r){return this.r=t/255,this.g=e/255,this.b=n/255,this.a=r,this},Color.prototype.toChromeColor=function(){return{r:Math.round(255*this.r),g:Math.round(255*this.g),b:Math.round(255*this.b),a:this.a}},Color.prototype.asArray=function(){return this._array?(this._array[0]=this.r,this._array[1]=this.g,this._array[2]=this.b,this._array[3]=this.a,this._array):(this._array=[this.r,this.g,this.b,this.a],this._array)},Color.prototype.copy=function(t){return this.set(t.r,t.g,t.b,t.a)},Color.prototype.equals=function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},Color.prototype.setAlpha=function(t){return this.a=t,this},Color.prototype.multiplyColor=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this.a*=t.a,this},Color.prototype.multiply=function(t){return this.r=Math.min(this.r*t,1),this.g=Math.min(this.g*t,1),this.b=Math.min(this.b*t,1),this.a=Math.min(this.a*t,1),this},Color.prototype.add=function(t){return this.r=Math.min(this.r+t.r,1),this.g=Math.min(this.g+t.g,1),this.b=Math.min(this.b+t.b,1),this.a=Math.min(this.a+t.a,1),this},Color.prototype.setHSL=function(t,e,n){if(t=W.euclideanModulo(t,1),e=W.clamp(e,0,1),n=W.clamp(n,0,1),0===e)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+e):n+e-n*e,i=2*n-r;this.r=U.hue2rgb(i,r,t+1/3),this.g=U.hue2rgb(i,r,t),this.b=U.hue2rgb(i,r,t-1/3)}return this},Color.black=new Color,Color.white=new Color(1,1,1),Color.red=new Color(1,0,0),Color.green=new Color(0,1,0),Color.blue=new Color(0,0,1),Color.yellow=new Color(1,1,0),Color.pink=new Color(1,0,1),Color.orange=new Color(1,.5,0),Color.grey=new Color(.7,.7,.7),Color.dummy=new Color,Color}(),K=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),X=function(t){function Fog(){var e=null!==t&&t.apply(this,arguments)||this;return e.color=new H(.7,.7,.7,1),e}return K(Fog,t),Fog}(_),Q=function(t){function ExponentialFog(){var e=null!==t&&t.apply(this,arguments)||this;return e.density=.005,e}return K(ExponentialFog,t),ExponentialFog}(X),Y=function(t){function LinearFog(){var e=null!==t&&t.apply(this,arguments)||this;return e.near=700,e.far=1e3,e}return K(LinearFog,t),LinearFog}(X);!function(t){t.deltaTimeCap=.1,t.previousTime=performance.now(),t.time=0,t.deltaTime=0,t.smoothDeltaTime=0,t.frameTimer=0,t.frameCount=0,t.fps=0,t.currentFrame=0}(q||(q={})),function(t){t.updateDeltaTime=function updateDeltaTime(){var t=performance.now(),e=Math.min((t-q.previousTime)/1e3,q.deltaTimeCap);q.smoothDeltaTime=W.lerp(q.deltaTime,e,.5),q.deltaTime=e,q.time+=e,q.previousTime=t,q.frameTimer+=q.deltaTime,q.frameCount++,q.frameTimer>=1&&(q.fps=q.frameCount/q.frameTimer,q.frameCount=0,q.frameTimer=0)},t.resetCurrentFrame=function resetCurrentFrame(){q.currentFrame=0},t.incrementCurrentFrame=function incrementCurrentFrame(){++q.currentFrame}}(G||(G={}));var Z,J=function(){function Time(){}return Object.defineProperty(Time,"time",{get:function(){return q.time},enumerable:!0,configurable:!0}),Object.defineProperty(Time,"deltaTime",{get:function(){return q.deltaTime},enumerable:!0,configurable:!0}),Object.defineProperty(Time,"smoothDeltaTime",{get:function(){return q.smoothDeltaTime},enumerable:!0,configurable:!0}),Object.defineProperty(Time,"fps",{get:function(){return q.fps},enumerable:!0,configurable:!0}),Object.defineProperty(Time,"currentFrame",{get:function(){return q.currentFrame},enumerable:!0,configurable:!0}),Time}(),$=function(){function Vector2(t,e){this.x=t||0,this.y=e||0}return Object.defineProperty(Vector2.prototype,"length",{get:function(){return Math.sqrt(this.lengthSq)},enumerable:!0,configurable:!0}),Object.defineProperty(Vector2.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y},enumerable:!0,configurable:!0}),Vector2.fromArray=function(t){var e=new Vector2;t.length>0&&(e.x=t[0]),t.length>1&&(e.y=t[1])},Vector2.fromPool=function(){return Vector2.pool.get()},Vector2.prototype.set=function(t,e){return this.x=t,this.y=e,this},Vector2.prototype.add=function(t){return this.addVectors(this,t)},Vector2.prototype.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},Vector2.prototype.substract=function(t){return this.substractVectors(this,t)},Vector2.prototype.substractVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},Vector2.prototype.normalize=function(){var t=this.length;return t<Number.EPSILON?this:this.multiplyScalar(1/t)},Vector2.prototype.multiplyScalar=function(t){return this.x=this.x*t,this.y=this.y*t,this},Vector2.prototype.dot=function(t){return this.x*t.x+this.y*t.y},Vector2.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},Vector2.prototype.asArray=function(){return this._array?(this._array[0]=this.x,this._array[1]=this.y,this._array):(this._array=[this.x,this.y],this._array)},Vector2.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},Vector2.zero=new Vector2,Vector2.one=new Vector2(1,1),Vector2.right=new Vector2(1,0),Vector2.up=new Vector2(0,1),Vector2.pool=new N(Vector2,128),Vector2.dummy=new Vector2,Vector2}(),tt=function(){function Vector4(t,e,n,r){this.set(t||0,e||0,n||0,r||0)}return Object.defineProperty(Vector4.prototype,"manhattanLength",{get:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},enumerable:!0,configurable:!0}),Object.defineProperty(Vector4.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(Vector4.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(Vector4.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t},enumerable:!0,configurable:!0}),Object.defineProperty(Vector4.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t},enumerable:!0,configurable:!0}),Vector4.fromArray=function(t){var e=new Vector4;t.length>0&&(e.x=t[0]),t.length>1&&(e.y=t[1]),t.length>2&&(e.z=t[2]),t.length>3&&(e.w=t[3])},Vector4.fromPool=function(){return Vector4.pool.get()},Vector4.prototype.set=function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},Vector4.prototype.copy=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this.w=t.w,this},Vector4.prototype.multiplyScalar=function(t){return this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t,this},Vector4.prototype.toArray=function(){return this._array?(this._array[0]=this.x,this._array[1]=this.y,this._array[2]=this.z,this._array[3]=this.w,this._array):(this._array=[this.x,this.y,this.z,this.w],this._array)},Vector4.prototype.transform=function(t){var e=this.x,n=this.y,r=this.z,i=this.w,o=t.data;return this.x=o[0]*e+o[4]*n+o[8]*r+o[12]*i,this.y=o[1]*e+o[5]*n+o[9]*r+o[13]*i,this.z=o[2]*e+o[6]*n+o[10]*r+o[14]*i,this.w=o[3]*e+o[7]*n+o[11]*r+o[15]*i,this},Vector4.prototype.getVec3=function(t){return t.set(this.x,this.y,this.z)},Vector4.dummy=new Vector4,Vector4.pool=new N(Vector4,128),Vector4}();!function(t){t.dummy=new V,t.dummy2=new V,t.dummy3=new V}(Z||(Z={}));var et,nt=function(){function Matrix44(t){this.data=t||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return Matrix44.fromArray=function(t){var e=new Matrix44;return e.data=t.slice(),e},Matrix44.fromPool=function(){return Matrix44.pool.get()},Matrix44.prototype.makeOrthoProjection=function(t,e,n,r,i,o){var a=this.data,s=1/(e-t),c=1/(n-r),u=1/(o-i),l=(e+t)*s,p=(n+r)*c,h=(o+i)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-p,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-h,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},Matrix44.prototype.makePerspectiveProjection=function(t,e,n,r){var i=this.data,o=1/Math.tan(t/2),a=1/(n-r),s=(r+n)*a,c=n*r*2*a;return i[0]=o/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=s,i[11]=-1,i[12]=0,i[13]=0,i[14]=c,i[15]=0,this},Matrix44.prototype.setRotation=function(t){var e=this.data,n=t.x,r=t.y,i=t.z,o=t.w,a=n+n,s=r+r,c=i+i,u=n*a,l=n*s,p=n*c,h=r*s,f=r*c,d=i*c,y=o*a,m=o*s,v=o*c;return e[0]=1-(h+d),e[4]=l-v,e[8]=p+m,e[1]=l+v,e[5]=1-(u+d),e[9]=f-y,e[2]=p-m,e[6]=f+y,e[10]=1-(u+h),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},Matrix44.prototype.getRotation=function(t){return this.decompose(V.dummy,t,V.dummy),t},Matrix44.prototype.rotate=function(t){return this.multiply(Matrix44.dummy.setRotation(t))},Matrix44.prototype.makeLookAt=function(t,e){var n=Z.dummy,r=Z.dummy2,i=Z.dummy3;i.copy(t).normalize(),n.crossVectors(e,i),0===n.lengthSq&&(i.z+=1e-4,n.crossVectors(e,i)),n.normalize(),r.crossVectors(i,n);var o=this.data;return o[0]=n.x,o[4]=n.y,o[8]=n.z,o[12]=0,o[1]=r.x,o[5]=r.y,o[9]=r.z,o[13]=0,o[2]=i.x,o[6]=i.y,o[10]=i.z,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},Matrix44.prototype.setIdentity=function(){var t=this.data;return t[0]=1,t[4]=0,t[8]=0,t[12]=0,t[1]=0,t[5]=1,t[9]=0,t[13]=0,t[2]=0,t[6]=0,t[10]=1,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,this},Matrix44.prototype.set=function(t,e,n,r,i,o,a,s,c,u,l,p,h,f,d,y){var m=this.data;return m[0]=t,m[4]=e,m[8]=n,m[12]=r,m[1]=i,m[5]=o,m[9]=a,m[13]=s,m[2]=c,m[6]=u,m[10]=l,m[14]=p,m[3]=h,m[7]=f,m[11]=d,m[15]=y,this},Matrix44.prototype.toEuler=function(t){var e=this.data,n=e[0],r=(e[4],e[8]),i=e[1],o=e[5],a=e[9],s=e[2],c=(e[6],e[10]);return t.x=Math.asin(-W.clamp(a,-1,1)),Math.abs(a)<.99999?(t.y=Math.atan2(r,c),t.z=Math.atan2(i,o)):(t.y=Math.atan2(-s,n),t.z=0),t},Matrix44.prototype.scale=function(t){return this.scaleFromCoords(t.x,t.y,t.z)},Matrix44.prototype.scaleFromCoords=function(t,e,n){var r=this.data;return r[0]*=t,r[4]*=e,r[8]*=n,r[1]*=t,r[5]*=e,r[9]*=n,r[2]*=t,r[6]*=e,r[10]*=n,r[3]*=t,r[7]*=e,r[11]*=n,this},Matrix44.prototype.setPosition=function(t){return this.setPositionFromCoords(t.x,t.y,t.z)},Matrix44.prototype.getPosition=function(t){var e=this.data;t.x=e[12],t.y=e[13],t.z=e[14]},Matrix44.prototype.setPositionFromCoords=function(t,e,n){var r=this.data;return r[12]=t,r[13]=e,r[14]=n,this},Matrix44.prototype.translate=function(t){return this.translateFromCoords(t.x,t.y,t.z)},Matrix44.prototype.translateFromCoords=function(t,e,n){var r=this.data;return r[12]+=t,r[13]+=e,r[14]+=n,this},Matrix44.prototype.compose=function(t,e,n){return this.setRotation(e),this.scale(n),this.setPosition(t),this},Matrix44.prototype.decompose=function(t,e,n){var r=Z.dummy,i=Matrix44.dummy,o=this.data,a=r.set(o[0],o[1],o[2]).length,s=r.set(o[4],o[5],o[6]).length,c=r.set(o[8],o[9],o[10]).length;this.determinant()<0&&(a=-a),t.x=o[12],t.y=o[13],t.z=o[14],this.copy.call(i,this);var u=1/(a||W.EPSILON),l=1/(s||W.EPSILON),p=1/(c||W.EPSILON);return i.data[0]*=u,i.data[1]*=u,i.data[2]*=u,i.data[4]*=l,i.data[5]*=l,i.data[6]*=l,i.data[8]*=p,i.data[9]*=p,i.data[10]*=p,e.setFromMatrix(i),n.x=a,n.y=s,n.z=c,this},Matrix44.prototype.determinant=function(){var t=this.data,e=t[0],n=t[4],r=t[8],i=t[12],o=t[1],a=t[5],s=t[9],c=t[13],u=t[2],l=t[6],p=t[10],h=t[14];return t[3]*(+i*s*l-r*c*l-i*a*p+n*c*p+r*a*h-n*s*h)+t[7]*(+e*s*h-e*c*p+i*o*p-r*o*h+r*c*u-i*s*u)+t[11]*(+e*c*l-e*a*h-i*o*l+n*o*h+i*a*u-n*c*u)+t[15]*(-r*a*u-e*s*l+e*a*p+r*o*l-n*o*p+n*s*u)},Matrix44.prototype.transpose=function(){var t,e=this.data;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},Matrix44.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},Matrix44.prototype.multiplyMatrices=function(t,e){var n=t.data,r=e.data,i=this.data,o=n[0],a=n[4],s=n[8],c=n[12],u=n[1],l=n[5],p=n[9],h=n[13],f=n[2],d=n[6],y=n[10],m=n[14],v=n[3],g=n[7],_=n[11],b=n[15],w=r[0],x=r[4],P=r[8],O=r[12],C=r[1],S=r[5],j=r[9],R=r[13],T=r[2],E=r[6],B=r[10],A=r[14],I=r[3],M=r[7],z=r[11],k=r[15];return i[0]=o*w+a*C+s*T+c*I,i[4]=o*x+a*S+s*E+c*M,i[8]=o*P+a*j+s*B+c*z,i[12]=o*O+a*R+s*A+c*k,i[1]=u*w+l*C+p*T+h*I,i[5]=u*x+l*S+p*E+h*M,i[9]=u*P+l*j+p*B+h*z,i[13]=u*O+l*R+p*A+h*k,i[2]=f*w+d*C+y*T+m*I,i[6]=f*x+d*S+y*E+m*M,i[10]=f*P+d*j+y*B+m*z,i[14]=f*O+d*R+y*A+m*k,i[3]=v*w+g*C+_*T+b*I,i[7]=v*x+g*S+_*E+b*M,i[11]=v*P+g*j+_*B+b*z,i[15]=v*O+g*R+_*A+b*k,this},Matrix44.prototype.invert=function(){return this.getInverse(this)},Matrix44.prototype.getInverse=function(t){var e=this.data,n=t.data,r=n[0],i=n[1],o=n[2],a=n[3],s=n[4],c=n[5],u=n[6],l=n[7],p=n[8],h=n[9],f=n[10],d=n[11],y=n[12],m=n[13],v=n[14],g=n[15],_=h*v*l-m*f*l+m*u*d-c*v*d-h*u*g+c*f*g,b=y*f*l-p*v*l-y*u*d+s*v*d+p*u*g-s*f*g,w=p*m*l-y*h*l+y*c*d-s*m*d-p*c*g+s*h*g,x=y*h*u-p*m*u-y*c*f+s*m*f+p*c*v-s*h*v,P=r*_+i*b+o*w+a*x;if(0===P)return this.setIdentity();var O=1/P;return e[0]=_*O,e[1]=(m*f*a-h*v*a-m*o*d+i*v*d+h*o*g-i*f*g)*O,e[2]=(c*v*a-m*u*a+m*o*l-i*v*l-c*o*g+i*u*g)*O,e[3]=(h*u*a-c*f*a-h*o*l+i*f*l+c*o*d-i*u*d)*O,e[4]=b*O,e[5]=(p*v*a-y*f*a+y*o*d-r*v*d-p*o*g+r*f*g)*O,e[6]=(y*u*a-s*v*a-y*o*l+r*v*l+s*o*g-r*u*g)*O,e[7]=(s*f*a-p*u*a+p*o*l-r*f*l-s*o*d+r*u*d)*O,e[8]=w*O,e[9]=(y*h*a-p*m*a-y*i*d+r*m*d+p*i*g-r*h*g)*O,e[10]=(s*m*a-y*c*a+y*i*l-r*m*l-s*i*g+r*c*g)*O,e[11]=(p*c*a-s*h*a-p*i*l+r*h*l+s*i*d-r*c*d)*O,e[12]=x*O,e[13]=(p*m*o-y*h*o+y*i*f-r*m*f-p*i*v+r*h*v)*O,e[14]=(y*c*o-s*m*o-y*i*u+r*m*u+s*i*v-r*c*v)*O,e[15]=(s*h*o-p*c*o+p*i*u-r*h*u-s*i*f+r*c*f)*O,this},Matrix44.prototype.getScale=function(t){var e=this.data,n=t.set(e[0],e[1],e[2]).length,r=t.set(e[4],e[5],e[6]).length,i=t.set(e[8],e[9],e[10]).length;return t.set(n,r,i)},Matrix44.prototype.extractRotation=function(t){var e=this.data,n=t.data,r=Z.dummy,i=1/r.setFromMatrixColumn(t,0).length,o=1/r.setFromMatrixColumn(t,1).length,a=1/r.setFromMatrixColumn(t,2).length;return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=0,e[4]=n[4]*o,e[5]=n[5]*o,e[6]=n[6]*o,e[7]=0,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},Matrix44.prototype.copyPosition=function(t){var e=this.data,n=t.data;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},Matrix44.prototype.copy=function(t){var e=this.data,n=t.data;return e[0]=n[0],e[4]=n[4],e[8]=n[8],e[12]=n[12],e[1]=n[1],e[5]=n[5],e[9]=n[9],e[13]=n[13],e[2]=n[2],e[6]=n[6],e[10]=n[10],e[14]=n[14],e[3]=n[3],e[7]=n[7],e[11]=n[11],e[15]=n[15],this},Matrix44.prototype.toArray=function(t,e){var n=this.data;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t},Matrix44.identity=new Matrix44,Matrix44.dummy=new Matrix44,Matrix44.pool=new N(Matrix44,64),Matrix44}();(et||(et={})).dummy=new nt;var rt,it=function(){function Quaternion(t,e,n,r){this._x=t||0,this._y=e||0,this._z=n||0,this._w=r||1}return Object.defineProperty(Quaternion.prototype,"length",{get:function(){return Math.sqrt(this.lengthSq)},enumerable:!0,configurable:!0}),Object.defineProperty(Quaternion.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},enumerable:!0,configurable:!0}),Object.defineProperty(Quaternion.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(Quaternion.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(Quaternion.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t},enumerable:!0,configurable:!0}),Object.defineProperty(Quaternion.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t},enumerable:!0,configurable:!0}),Quaternion.fromPool=function(){return Quaternion.pool.get()},Quaternion.fromEulerAngles=function(t,e,n,r){return void 0===r&&(r="YXZ"),(new Quaternion).setFromEulerAngles(t,e,n,r)},Quaternion.fromAxisAngle=function(t,e){return(new Quaternion).setFromAxisAngle(t,e)},Quaternion.fromUnitVectors=function(t,e){return(new Quaternion).setFromUnitVectors(t,e)},Quaternion.prototype.set=function(t,e,n,r){this._x=t,this._y=e,this._z=n,this.w=r},Quaternion.prototype.setFromAxisAngle=function(t,e){var n=e/2,r=Math.sin(n);return this._x=t.x*r,this._y=t.y*r,this._z=t.z*r,this._w=Math.cos(n),this.normalize()},Quaternion.prototype.setFromEulerAngles=function(t,e,n,r){void 0===r&&(r="YXZ");var i=Math.cos(t/2),o=Math.cos(e/2),a=Math.cos(n/2),s=Math.sin(t/2),c=Math.sin(e/2),u=Math.sin(n/2);return"YXZ"===r?(this._x=s*o*a+i*c*u,this._y=i*c*a-s*o*u,this._z=i*o*u-s*c*a,this._w=i*o*a+s*c*u):"ZYX"===r?(this._x=s*o*a-i*c*u,this._y=i*c*a+s*o*u,this._z=i*o*u-s*c*a,this._w=i*o*a+s*c*u):"XYZ"===r?(this._x=s*o*a+i*c*u,this._y=i*c*a-s*o*u,this._z=i*o*u+s*c*a,this._w=i*o*a-s*c*u):"ZXY"===r?(this._x=s*o*a-i*c*u,this._y=i*c*a+s*o*u,this._z=i*o*u+s*c*a,this._w=i*o*a-s*c*u):"YZX"===r?(this._x=s*o*a+i*c*u,this._y=i*c*a+s*o*u,this._z=i*o*u-s*c*a,this._w=i*o*a-s*c*u):"XZY"===r&&(this._x=s*o*a-i*c*u,this._y=i*c*a-s*o*u,this._z=i*o*u+s*c*a,this._w=i*o*a+s*c*u),this.normalize()},Quaternion.prototype.setFromEulerVector=function(t){return this.setFromEulerAngles(t.x,t.y,t.z)},Quaternion.prototype.setFromUnitVectors=function(t,e){var n=V.dummy,r=t.dot(e)+1;return r<1e-6?(r=0,Math.abs(t.x)>Math.abs(t.z)?n.set(-t.y,t.x,0):n.set(0,-t.z,t.y)):n.crossVectors(t,e),this._x=n.x,this._y=n.y,this._z=n.z,this._w=r,this.normalize()},Quaternion.prototype.setFromMatrix=function(t){var e,n=t.data,r=n[0],i=n[4],o=n[8],a=n[1],s=n[5],c=n[9],u=n[2],l=n[6],p=n[10],h=r+s+p;return h>0?(e=.5/Math.sqrt(h+1),this._w=.25/e,this._x=(l-c)*e,this._y=(o-u)*e,this._z=(a-i)*e):r>s&&r>p?(e=2*Math.sqrt(1+r-s-p),this._w=(l-c)/e,this._x=.25*e,this._y=(i+a)/e,this._z=(o+u)/e):s>p?(e=2*Math.sqrt(1+s-r-p),this._w=(o-u)/e,this._x=(i+a)/e,this._y=.25*e,this._z=(c+l)/e):(e=2*Math.sqrt(1+p-r-s),this._w=(a-i)/e,this._x=(o+u)/e,this._y=(c+l)/e,this._z=.25*e),this.normalize()},Quaternion.prototype.lookAt=function(t,e){var n=et.dummy;return n.makeLookAt(t,e).transpose(),this.setFromMatrix(n)},Quaternion.prototype.normalize=function(){var t=this.length;return 0===t||(t=1/t,this._x*=t,this._y*=t,this._z*=t,this.w*=t),this},Quaternion.prototype.multiply=function(t){return this.multiplyQuaternions(this,t)},Quaternion.prototype.multiplyQuaternions=function(t,e){var n=e._x,r=e._y,i=e._z,o=e._w,a=t._x,s=t._y,c=t._z,u=t._w;return this._x=n*u+o*a+r*c-i*s,this._y=r*u+o*s+i*a-n*c,this._z=i*u+o*c+n*s-r*a,this.w=o*u-n*a-r*s-i*c,this},Quaternion.prototype.toEuler=function(t){return et.dummy.setRotation(this).toEuler(t)},Quaternion.prototype.equals=function(t){return this._x===t._x&&this._y===t._y&&this._z===t._z&&this._w===t._w},Quaternion.prototype.copy=function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this.w=t._w,this},Quaternion.prototype.invert=function(){return this.conjugate()},Quaternion.prototype.getInverse=function(t){return t.copy(this).invert()},Quaternion.prototype.conjugate=function(){return this._x*=-1,this._y*=-1,this.z*=-1,this},Quaternion.prototype.slerpQuaternions=function(t,e,n){return this.copy(t).slerp(e,n)},Quaternion.prototype.slerp=function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var n=this._x,r=this._y,i=this._z,o=this._w,a=o*t._w+n*t._x+r*t._y+i*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=n,this._y=r,this.z=i,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this.w),this._x=.5*(n+this.x),this._y=.5*(r+this.y),this.z=.5*(i+this.z),this;var c=Math.atan2(s,a),u=Math.sin((1-e)*c)/s,l=Math.sin(e*c)/s;return this._w=o*u+this.w*l,this._x=n*u+this.x*l,this._y=r*u+this.y*l,this.z=i*u+this.z*l,this},Quaternion.identity=new Quaternion,Quaternion.dummy=new Quaternion,Quaternion.pool=new N(Quaternion,64),Quaternion}(),ot=function(){function Matrix33(t){this.data=t||[1,0,0,0,1,0,0,0,1]}return Matrix33.fromPool=function(){return Matrix33.pool.get()},Matrix33.prototype.setIdentity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},Matrix33.prototype.set=function(t,e,n,r,i,o,a,s,c){var u=this.data;return u[0]=t,u[3]=e,u[6]=n,u[1]=r,u[4]=i,u[7]=o,u[2]=a,u[5]=s,u[8]=c,this},Matrix33.prototype.setFromMatrix4=function(t){var e=t.data;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},Matrix33.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},Matrix33.prototype.multiplyMatrices=function(t,e){var n=t.data,r=e.data,i=this.data,o=n[0],a=n[3],s=n[6],c=n[1],u=n[4],l=n[7],p=n[2],h=n[5],f=n[8],d=r[0],y=r[3],m=r[6],v=r[1],g=r[4],_=r[7],b=r[2],w=r[5],x=r[8];return i[0]=o*d+a*v+s*b,i[3]=o*y+a*g+s*w,i[6]=o*m+a*_+s*x,i[1]=c*d+u*v+l*b,i[4]=c*y+u*g+l*w,i[7]=c*m+u*_+l*x,i[2]=p*d+h*v+f*b,i[5]=p*y+h*g+f*w,i[8]=p*m+h*_+f*x,this},Matrix33.prototype.multiplyScalar=function(t){var e=this.data;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},Matrix33.prototype.determinant=function(){var t=this.data,e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],u=t[8];return e*o*u-e*a*c-n*i*u+n*a*s+r*i*c-r*o*s},Matrix33.prototype.getInverse=function(t){var e=t.data,n=this.data,r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],u=e[6],l=e[7],p=e[8],h=p*s-c*l,f=c*u-p*a,d=l*a-s*u,y=r*h+i*f+o*d;if(0===y)return this.setIdentity();var m=1/y;return n[0]=h*m,n[1]=(o*l-p*i)*m,n[2]=(c*i-o*s)*m,n[3]=f*m,n[4]=(p*r-o*u)*m,n[5]=(o*a-c*r)*m,n[6]=d*m,n[7]=(i*u-l*r)*m,n[8]=(s*r-i*a)*m,this},Matrix33.prototype.transpose=function(){var t,e=this.data;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},Matrix33.prototype.getNormalMatrix=function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},Matrix33.prototype.scale=function(t,e){var n=this.data;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},Matrix33.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t),r=this.data,i=r[0],o=r[3],a=r[6],s=r[1],c=r[4],u=r[7];return r[0]=e*i+n*s,r[3]=e*o+n*c,r[6]=e*a+n*u,r[1]=-n*i+e*s,r[4]=-n*o+e*c,r[7]=-n*a+e*u,this},Matrix33.prototype.translate=function(t,e){var n=this.data;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},Matrix33.identity=new Matrix33,Matrix33.pool=new N(Matrix33,8),Matrix33}(),at=function(){function AABB(t,e){this.min=t||new V,this.max=e||new V}return AABB.fromVertexArray=function(t,e,n){var r=new AABB;if("TRIANGLES"===e){r.min.copy(V.one).multiply(999999),r.max.copy(V.one).multiply(-999999);for(var i=0;i<t.length;i+=3)r.min.x>t[i]&&(r.min.x=t[i]),r.max.x<t[i]&&(r.max.x=t[i]),r.min.y>t[i+1]&&(r.min.y=t[i+1]),r.max.y<t[i+1]&&(r.max.y=t[i+1]),r.min.z>t[i+2]&&(r.min.z=t[i+2]),r.max.z<t[i+2]&&(r.max.z=t[i+2])}return r},AABB.prototype.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},AABB.prototype.contains=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},AABB}(),st=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ct=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Auto=0]="Auto",t[t.Relative=1]="Relative",t[t.Absolute=2]="Absolute"}(rt||(rt={}));var ut,lt=function(){function UISize(t,e){this.type=rt.Auto,this.value=256,void 0!==t&&(this.type=t),void 0!==e&&(this.value=e)}return st([Attributes_enumLiterals(rt),ct("design:type",Object)],UISize.prototype,"type",void 0),UISize}();ut||(ut={});var pt,ht=function(){function WebGL(){}return Object.defineProperty(WebGL,"context",{get:function(){return ut.context},enumerable:!0,configurable:!0}),WebGL.create=function(t,e){t.enable(t.DEPTH_TEST),t.clearDepth(1),t.depthFunc(t.LEQUAL),t.frontFace(t.CCW),WebGL.primitiveTypes={POINTS:t.POINTS,LINE_STRIP:t.LINE_STRIP,LINE_LOOP:t.LINE_LOOP,LINES:t.LINES,TRIANGLE_STRIP:t.TRIANGLE_STRIP,TRIANGLE_FAN:t.TRIANGLE_FAN,TRIANGLES:t.TRIANGLES},WebGL.extensions.OES_texture_float=e>1,WebGL.extensions.OES_standard_derivatives=e>1,WebGL.extensions.OES_standard_derivatives&&t.hint(t.FRAGMENT_SHADER_DERIVATIVE_HINT,t.FASTEST);for(var n=0,r=Object.keys(this.extensions);n<r.length;n++){var i=r[n];this.extensions[i]=this.extensions[i]||t.getExtension(i)}console.assert(this.extensions.OES_texture_float,"OES_texture_float extension is required for skinning."),console.assert(this.extensions.OES_standard_derivatives,"OES_standard_derivatives not supported, required for enhanced wireframe visualization."),WebGL.caps.maxVertexUniforms=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),WebGL.version=e,ut.context=t},WebGL.do=function(t){var e=t(),n=ut.context.getError();return n&&k.log("WebGL error '"+n+"'"),e},WebGL.extensions={OES_texture_float:!1,OES_standard_derivatives:!1},WebGL.version=1,WebGL.caps={maxVertexUniforms:0},WebGL}();pt||(pt={});var ft,dt=function(){function IRendererInternal(){}return Object.defineProperty(IRendererInternal,"instance",{get:function(){return pt.instance},set:function(t){pt.instance=t},enumerable:!0,configurable:!0}),IRendererInternal}();ft||(ft={});var yt,mt,vt=function(){function IFileInternal(){}return Object.defineProperty(IFileInternal,"instance",{get:function(){return ft.instance},set:function(t){ft.instance=t},enumerable:!0,configurable:!0}),IFileInternal}(),gt=function(){function Interfaces(){}return Object.defineProperty(Interfaces,"renderer",{get:function(){return dt.instance},enumerable:!0,configurable:!0}),Object.defineProperty(Interfaces,"factory",{get:function(){return g.instance},enumerable:!0,configurable:!0}),Object.defineProperty(Interfaces,"file",{get:function(){return vt.instance},enumerable:!0,configurable:!0}),Object.defineProperty(Interfaces,"serializer",{get:function(){return m.instance},enumerable:!0,configurable:!0}),Object.defineProperty(Interfaces,"objectManager",{get:function(){return R.instance},enumerable:!0,configurable:!0}),Interfaces}(),_t=function(){function VertexBuffer(t){var e=this;this._attributes={},this._vertexCount=0,this._metaData={},this._isLoaded=!1,this._isDynamic=!1,this._id=w.makeUniqueId(),t&&Object.entries(t).forEach(function(t){var n,r=t[0],i=t[1];Object.assign(e,((n={})[r]=i,n))})}return Object.defineProperty(VertexBuffer.prototype,"vertexCount",{get:function(){return this._vertexCount},set:function(t){this._vertexCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"primitiveType",{get:function(){return this._primitiveType},set:function(t){this._primitiveType=t},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"isDynamic",{get:function(){return this._isDynamic},set:function(t){this._isDynamic=t},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"attributes",{get:function(){return this._attributes},set:function(t){var e=this;Object.entries(t).forEach(function(t){var n=t[0],r=t[1];e.setAttribute(n,r)})},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"indices",{get:function(){return this._indices},set:function(t){this._indices=t,t?this._indicesMetaData={glBuffer:null,isDirty:!0}:delete this._indicesMetaData},enumerable:!0,configurable:!0}),VertexBuffer.prototype.copy=function(){return gt.serializer.copyVertexBuffer(this)},VertexBuffer.prototype.setAttribute=function(t,e){this._attributes[t]=e,this._metaData[t]={glBuffer:null,isDirty:!0},"position"===t&&(this._vertexCount=e.length/3)},VertexBuffer.prototype.dirtifyAttribute=function(t){t in this._metaData?(this._metaData[t].isDirty=!0,"position"===t&&gt.renderer.showWireFrame&&this.loadBarycentricCoords(ht.context)):k.log("Attribute '"+t+"' not found on VertexBuffer'")},VertexBuffer.prototype.updateBufferDatas=function(t){for(var e=0,n=Object.keys(this._metaData);e<n.length;e++){var r=n[e];this.updateBufferDataIfNecessary(t,r)}},VertexBuffer.prototype.begin=function(t,e){this.bindBuffers(t),this.bindAttributes(t,e.getAttributes())},VertexBuffer.prototype.bindBuffers=function(t){if(this._isLoaded){var e=gt.renderer.showWireFrame;e!==this.hasBarycentricCoords()&&(e?this.loadBarycentricCoords(t):(t.deleteBuffer(this._metaData.barycentricCoord.glBuffer),delete this._attributes.barycentricCoord,delete this._metaData.barycentricCoord))}else this.load(t),gt.renderer.showWireFrame&&this.loadBarycentricCoords(t),this._isLoaded=!0;this._indicesMetaData&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indicesMetaData.glBuffer)},VertexBuffer.prototype.end=function(t,e){this.unbindAttributes(t,e.getAttributes())},VertexBuffer.prototype.draw=function(t){if(0!==this._vertexCount){var e=ht.primitiveTypes[this._primitiveType];this._indices?t.drawElements(e,this._indices.length,t.UNSIGNED_SHORT,0):t.drawArrays(e,0,this._vertexCount)}},VertexBuffer.prototype.load=function(t){for(var e=0,n=Object.keys(this._attributes);e<n.length;e++){var r=n[e];(i=t.createBuffer())&&(t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this._attributes[r]),this._isDynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW),this._metaData[r].glBuffer=i,this._metaData[r].isDirty=!1)}var i;if(this._indices&&(i=t.createBuffer())){var o=this._indicesMetaData;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this._indices),t.STATIC_DRAW),o.glBuffer=i,o.isDirty=!1}},VertexBuffer.prototype.unload=function(t){if(this._isLoaded){for(var e=0,n=Object.keys(this._attributes);e<n.length;e++){var r=n[e];this._metaData[r].glBuffer&&(t.deleteBuffer(this._metaData[r].glBuffer),this._metaData[r].glBuffer=null)}if(this._indices){var i=this._indicesMetaData;i.glBuffer&&(t.deleteBuffer(i.glBuffer),i.glBuffer=null)}this._isLoaded=!1}},VertexBuffer.prototype.bindAttributes=function(t,e){for(var n=0,r=Object.keys(this._metaData);n<r.length;n++){var i=r[n];if(i in e){var o=e[i].location;this._metaData[i].glBuffer&&o>=0&&(this.updateBufferDataIfNecessary(t,i)||t.bindBuffer(t.ARRAY_BUFFER,this._metaData[i].glBuffer),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,e[i].componentCount,t.FLOAT,!1,0,0))}}},VertexBuffer.prototype.unbindAttributes=function(t,e){for(var n=0,r=Object.keys(this._metaData);n<r.length;n++){var i=r[n];if(i in e){var o=e[i].location;o>=0&&t.disableVertexAttribArray(o)}}},VertexBuffer.prototype.hasAttribute=function(t){return t in this._metaData},VertexBuffer.prototype.updateBufferDataIfNecessary=function(t,e){return!!this._metaData[e].isDirty&&(t.bindBuffer(t.ARRAY_BUFFER,this._metaData[e].glBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this._attributes[e]),this._isDynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW),this._metaData[e].isDirty=!1,!0)},VertexBuffer.prototype.loadBarycentricCoords=function(t){if(this._attributes.position&&"TRIANGLES"===this.primitiveType){var e=this.hasBarycentricCoords(),n=e?this._attributes.barycentricCoord:[];if(n.length=this._attributes.position.length,this._indices);else for(var r=n.length/9,i=0;i<r;++i){var o=9*i;n[o+0]=1,n[o+1]=0,n[o+2]=0,n[o+3]=0,n[o+4]=1,n[o+5]=0,n[o+6]=0,n[o+7]=0,n[o+8]=1}if(e)this.dirtifyAttribute("barycentricCoord");else{this.setAttribute("barycentricCoord",n);var a=t.createBuffer();a&&(t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),this._isDynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW),this._metaData.barycentricCoord.glBuffer=a,this._metaData.barycentricCoord.isDirty=!1)}}},VertexBuffer.prototype.hasBarycentricCoords=function(){return"barycentricCoord"in this._attributes},VertexBuffer}(),bt=function(){function Rect(t,e,n,r){this.left=t||0,this.top=e||0,this.right=n||0,this.bottom=r||0}return Rect.prototype.set=function(t,e,n,r){this.left=t,this.top=e,this.right=n,this.bottom=r},Rect}(),wt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),xt=function(t){function ArrayProperty(e,n){var r=t.call(this)||this;return r.grow=function(t){return r.data.push(t||new e)},r.typeName=function(){return e.name},r.getData=function(){return r.data},r.data=n||[],r}return wt(ArrayProperty,t),ArrayProperty.prototype.clear=function(){this.data.length=0},ArrayProperty}(function(){return function IArrayProperty(){}}()),Pt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Ot=function(t){function ReferenceArray(e,n){var r=t.call(this)||this;return r.grow=function(t){return r.data.push(new l(e,t))},r.typeName=function(){return e.name},r.getData=function(){return r.data},r.data=n||[],r._clone=function(){for(var t=new ReferenceArray(e),n=0,i=r.data;n<i.length;n++){var o=i[n];o.instance&&t.grow(o.instance.copy())}return t},r}return Pt(ReferenceArray,t),ReferenceArray.prototype.get=function(t){return this.data[t].instance},ReferenceArray.prototype.copy=function(){return this._clone()},ReferenceArray.prototype.clear=function(){this.data.length=0},ReferenceArray}(function(){return function ReferenceArrayBase(){}}()),Ct=function(){return function FileProperty(t,e,n){this.format=t,this.fileName=n,this.data=e}}(),St=function(){return function ThumbnailProperty(t){this.data=t}}(),jt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Rt=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Tt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Et=function(t){function Component(){var e=null!==t&&t.apply(this,arguments)||this;return e._id=w.makeUniqueId(),e._active=!0,e}return jt(Component,t),Object.defineProperty(Component.prototype,"parent",{get:function(){return this._entity.parent},enumerable:!0,configurable:!0}),Object.defineProperty(Component.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),Object.defineProperty(Component.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(Component.prototype,"active",{get:function(){return this._active},set:function(t){this._active=t},enumerable:!0,configurable:!0}),Component.prototype.setEntity=function(t){this._entity=t},Component.prototype.isLoaded=function(){return w.isObjectLoaded(this)},Component.prototype.reset=function(){var t=this.constructor.name,e=g.instance.createObject(t);au.setComponentFromInstance(this.entity,e)},Rt([Attributes_hidden(),unserializable(),Tt("design:type",Component)],Component.prototype,"controller",void 0),Rt([Attributes_hidden(),unserializable(),Tt("design:type",hu)],Component.prototype,"_entity",void 0),Rt([unserializable(),Tt("design:type",Object)],Component.prototype,"_id",void 0),Rt([Attributes_hidden(),Tt("design:type",Object)],Component.prototype,"_active",void 0),Component}(_),Bt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),At=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},It=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};(yt||(yt={})).changeCallbacks=[],function(t){t.positionKey="_position",t.rotationKey="_rotation",t.scaleKey="_scale",t.xKey="_x",t.yKey="_y",t.zKey="_z",t.wKey="_w"}(mt||(mt={}));var Mt,zt=function(t){function Transform(e){var n=t.call(this)||this;return n.changed=new S.VoidSyncEvent,n._position=new V,n._rotation=new it,n._scale=new V(1,1,1),n._worldMatrix=new nt,n._invWorldMatrix=new nt,n._worldMatrixDirty=!0,n._invWorldMatrixDirty=!0,n._localMatrix=new nt,n._localMatrixDirty=!0,n._disableDirtification=!1,n._eventsEnabled=!0,e&&n.setState(e),n.attachToPosition(),n.attachToRotation(),n.attachToScale(),n}return Bt(Transform,t),Object.defineProperty(Transform.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"position",{get:function(){return this._position},set:function(t){this._position.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"eventsEnabled",{set:function(t){this._eventsEnabled=t},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"localMatrix",{get:function(){return this._localMatrixDirty&&(this._localMatrix.compose(this._position,this._rotation,this._scale),this._localMatrixDirty=!1),this._localMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldMatrix",{get:function(){if(this._worldMatrixDirty){this._worldMatrix.copy(this.localMatrix);var t=this.entity.parent?this.entity.parent.transform:void 0;t&&this._worldMatrix.multiplyMatrices(t.worldMatrix,this._worldMatrix),this._worldMatrixDirty=!1}return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"invWorldMatrix",{get:function(){return this._invWorldMatrixDirty&&(this._invWorldMatrix.getInverse(this.worldMatrix),this._invWorldMatrixDirty=!1),this._invWorldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldRight",{get:function(){return this.worldMatrix.decompose(V.dummy,it.dummy,V.dummy),V.fromPool().copy(V.right).rotate(it.dummy).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldForward",{get:function(){return this.worldMatrix.decompose(V.dummy,it.dummy,V.dummy),V.fromPool().copy(V.forward).rotate(it.dummy).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldUp",{get:function(){return this.worldMatrix.decompose(V.dummy,it.dummy,V.dummy),V.fromPool().copy(V.up).rotate(it.dummy).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"right",{get:function(){return V.fromPool().copy(V.right).rotate(this.rotation).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"forward",{get:function(){return V.fromPool().copy(V.forward).rotate(this.rotation).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"up",{get:function(){return V.fromPool().copy(V.up).rotate(this.rotation).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldPosition",{get:function(){return V.fromPool().setFromMatrix(this.worldMatrix)},set:function(t){this._position.copy(t);var e=this.entity.parent?this.entity.parent.transform:null;if(e){var n=nt.fromPool().copy(e.worldMatrix).invert();this._position.transform(n)}},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldRotation",{get:function(){return this.worldMatrix.getRotation(it.fromPool())},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldScale",{get:function(){return this.worldMatrix.getScale(V.fromPool())},enumerable:!0,configurable:!0}),Transform.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n),e===mt.positionKey?(this.attachToPosition(),this.dirtifyWorldMatrix()):e===mt.rotationKey?(this.attachToRotation(),this.dirtifyWorldMatrix()):e===mt.scaleKey&&(this.attachToScale(),this.dirtifyWorldMatrix())},Transform.prototype.translate=function(t){this.position.add(t)},Transform.prototype.upgrade=function(t,e){var n;return 1===e&&(Object.assign(t.properties,((n={})[mt.positionKey]=t.properties.position,n[mt.rotationKey]=t.properties.rotation,n[mt.scaleKey]=t.properties.scale,n)),delete t.properties.position,delete t.properties.rotation,delete t.properties.scale),t},Transform.prototype.worldToLocal=function(t,e){return e.copy(t).transform(this.invWorldMatrix)},Transform.prototype.localToWorld=function(t,e){return e.copy(t).transform(this.worldMatrix)},Transform.prototype.worldToLocalDirection=function(t,e){return tt.fromPool().set(t.x,t.y,t.z,0).transform(this.invWorldMatrix).getVec3(e)},Transform.prototype.worldToLocalRotation=function(t,e){return e.copy(t).multiply(it.dummy.setFromMatrix(this.invWorldMatrix))},Transform.prototype.dirtifyWorldMatrix=function(){if(!this._disableDirtification){if(this._localMatrixDirty=!0,this._worldMatrixDirty=!0,this._invWorldMatrixDirty=!0,this.entity&&this.entity.traverse(function(t){var e=t.transform;return!!e&&(e._worldMatrixDirty=!0,e._invWorldMatrixDirty=!0,yt.changeCallbacks.push(e.changed),!0)}),this._eventsEnabled){for(var t=0,e=yt.changeCallbacks;t<e.length;t++){e[t].post()}this.changed.post()}yt.changeCallbacks.length=0}},Transform.prototype.setLocalMatrix=function(t){this._localMatrix.copy(t),this._localMatrix.decompose(this._position,this._rotation,this._scale),this._localMatrixDirty=!1,this._worldMatrixDirty=!0},Transform.prototype.reset=function(){this._disableDirtification=!0,this._position.copy(V.zero),this._rotation.copy(it.identity),this._scale.copy(V.one),this._disableDirtification=!1,this.dirtifyWorldMatrix()},Transform.prototype.attachToPosition=function(){var t=this;Object.defineProperty(this._position,"x",{set:function(e){t._position[mt.xKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._position[mt.xKey]}}),Object.defineProperty(this._position,"y",{set:function(e){t._position[mt.yKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._position[mt.yKey]}}),Object.defineProperty(this._position,"z",{set:function(e){t._position[mt.zKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._position[mt.zKey]}})},Transform.prototype.attachToScale=function(){var t=this;Object.defineProperty(this._scale,"x",{set:function(e){t._scale[mt.xKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._scale[mt.xKey]}}),Object.defineProperty(this._scale,"y",{set:function(e){t._scale[mt.yKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._scale[mt.yKey]}}),Object.defineProperty(this._scale,"z",{set:function(e){t._scale[mt.zKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._scale[mt.zKey]}})},Transform.prototype.attachToRotation=function(){var t=this;Object.defineProperty(this._rotation,"x",{set:function(e){t._rotation[mt.xKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._rotation[mt.xKey]}}),Object.defineProperty(this._rotation,"y",{set:function(e){t._rotation[mt.yKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._rotation[mt.yKey]}}),Object.defineProperty(this._rotation,"z",{set:function(e){t._rotation[mt.zKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._rotation[mt.zKey]}}),Object.defineProperty(this._rotation,"w",{set:function(e){t._rotation[mt.wKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._rotation[mt.wKey]}})},At([unserializable(),It("design:type",Object)],Transform.prototype,"changed",void 0),At([unserializable(),It("design:type",Object)],Transform.prototype,"_worldMatrix",void 0),At([unserializable(),It("design:type",Object)],Transform.prototype,"_invWorldMatrix",void 0),At([unserializable(),It("design:type",Object)],Transform.prototype,"_worldMatrixDirty",void 0),At([unserializable(),It("design:type",Object)],Transform.prototype,"_invWorldMatrixDirty",void 0),At([unserializable(),It("design:type",Object)],Transform.prototype,"_localMatrix",void 0),At([unserializable(),It("design:type",Object)],Transform.prototype,"_localMatrixDirty",void 0),At([unserializable(),It("design:type",Object)],Transform.prototype,"_disableDirtification",void 0),At([unserializable(),It("design:type",Object)],Transform.prototype,"_eventsEnabled",void 0),Transform=At([mandatory(),sortOrder(0),It("design:paramtypes",[Object])],Transform)}(Et);(Mt||(Mt={})).defaultPRS={position:V.zero,rotation:it.identity,scale:V.one};var kt,Dt=function(){function Entities(){}return Entities.create=function(t){var e,n=t?t.prefab:null;n?(e=n.root.copy()).name=n.name:e=new hu;var r=t?t.prs:null;r&&e.setComponent(zt,{position:r.position||Mt.defaultPRS.position,rotation:r.rotation||Mt.defaultPRS.rotation,scale:r.scale||Mt.defaultPRS.scale});var i=t?t.children:null;if(i)for(var o=0,a=i;o<a.length;o++){var s=a[o];e.addChild(Entities.create(s))}var c=pu.list();return 0===c.length&&(Tu.create(),console.assert(1===c.length)),c[0].root.addChild(e),au.collectEntityOperations&&au.entitiesJustCreated.push(e),e},Entities.find=function(t){for(var e=0,n=pu.list();e<n.length;e++){var r=n[e];if(t===r.root.name)return r.root;var i=r.root.findChild(t);if(i)return i}return null},Entities.get=function(t){for(var e=0,n=pu.list();e<n.length;e++){var r=n[e];if(t===r.root.id)return r.root;var i=r.root.findChildById(t);if(i)return i}return null},Entities}(),Ft=function(){function EntityReference(t){this._entity=null,this._resolved=!1,this._id=t,this._resolved=!1}return Object.defineProperty(EntityReference.prototype,"id",{get:function(){return this._id},set:function(t){t!==this._id&&(this._id=t,this._resolved=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(EntityReference.prototype,"entity",{get:function(){return this._id?(this._resolved||(this._entity=Dt.get(this._id),this._entity||k.log("A missing entity (id: '"+this._id+"') is still referenced by the scene."),this._resolved=!0),this._entity):null},set:function(t){t?(this._id=t.id,this._entity=t):(delete this._id,delete this._entity),this._resolved=!0},enumerable:!0,configurable:!0}),EntityReference}(),Lt=function(){function ComponentReference(t,e){this._entity=null,this._resolved=!1,this._componentTypeName=t.name,this._entityId=e,this._resolved=!1}return Object.defineProperty(ComponentReference.prototype,"entityId",{get:function(){return this._entityId},set:function(t){t!==this._entityId&&(this._entityId=t,this._resolved=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(ComponentReference.prototype,"componentTypeName",{get:function(){return this._componentTypeName},enumerable:!0,configurable:!0}),Object.defineProperty(ComponentReference.prototype,"component",{get:function(){return this._entityId?(this._resolved||(this._entity=Dt.get(this._entityId),this._entity||k.logWarning("A missing entity (id: '"+this._entityId+"') is still referenced by the scene"),this._resolved=!0),this._entity?au.getComponentByName(this._entity,this._componentTypeName):null):null},set:function(t){t?(this._componentTypeName=t.constructor.name,this._entity=t.entity,this._entityId=t.entity.id):(delete this._entity,delete this._entityId),this._resolved=!0},enumerable:!0,configurable:!0}),ComponentReference}(),Nt=function(){function Random(){}return Random.range=function(t,e){return W.lerp(t,e,Math.random())},Random.rangeInt=function(t,e){return Math.round(Random.range(t,e))},Random}(),Vt=function(){function Range(t,e){this.min=t||0,this.max=e||0}return Range.prototype.random=function(){return Nt.range(this.min,this.max)},Range}(),Ut=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Wt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Absolute=0]="Absolute",t[t.Relative=1]="Relative"}(kt||(kt={}));var qt,Gt=function(){function Size(t,e){this.type=void 0!==t?t:kt.Relative,this.value=e||(this.type===kt.Relative?1:1024)}return Size.prototype.equals=function(t){return this.value===t.value&&this.type===t.type},Ut([Attributes_enumLiterals(kt),Wt("design:type",Number)],Size.prototype,"type",void 0),Size}(),Ht=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Kt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Xt=void 0;(function(t){t[t.Loading=0]="Loading",t[t.Resolved=1]="Resolved"})(qt||(qt={}));var Qt,Yt=function(){function AssetReference(t,e){this.assetChanged=new S.SyncEvent,this._asset=null,this._state=qt.Resolved,this.typeName=function(){return t.name},this.onAssetDeleted=this.onAssetDeleted.bind(this),e&&(this._asset=e,this._id=e.id,this._state=qt.Resolved)}return Object.defineProperty(AssetReference.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t,this._state=qt.Loading},enumerable:!0,configurable:!0}),Object.defineProperty(AssetReference.prototype,"asset",{get:function(){return this._asset},set:function(t){var e=this._asset;this._asset=t,this._state=qt.Resolved,this._id=t?t.templatePath:void 0,t!==e&&this.assetChanged.post({oldAsset:e,newAsset:t})},enumerable:!0,configurable:!0}),Object.defineProperty(AssetReference.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t},enumerable:!0,configurable:!0}),Object.defineProperty(AssetReference.prototype,"isResolved",{get:function(){return this._state===qt.Resolved},enumerable:!0,configurable:!0}),AssetReference.prototype.clear=function(){this.asset=null},AssetReference.prototype.setAssetFast=function(t){this._asset=t},AssetReference.prototype.detach=function(){this._asset=null},AssetReference.prototype.onAssetDeleted=function(t){this.detach(),Xt&&Xt.assetReferenceCleared.post(t)},Ht([unserializable(),Kt("design:type",Object)],AssetReference.prototype,"assetChanged",void 0),Ht([unserializable(),Kt("design:type",Object)],AssetReference.prototype,"_asset",void 0),Ht([unserializable(),Kt("design:type",Object)],AssetReference.prototype,"_state",void 0),AssetReference}(),Zt=function(){function AssetReferenceArray(t,e){var n=this;this.grow=function(e){return n.data.push(new Yt(t,e))},this.typeName=function(){return t.name},this.data=e||[]}return AssetReferenceArray.prototype.detach=function(){for(var t=0,e=this.data;t<e.length;t++){e[t].detach()}},AssetReferenceArray}(),Jt=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),$t=function(){function NativeArray(t,e){this._typeName=t,this.data=e||[]}return Object.defineProperty(NativeArray.prototype,"typeName",{get:function(){return this._typeName},enumerable:!0,configurable:!0}),NativeArray}(),te=function(t){function NumberNativeArray(e){return t.call(this,"number",e)||this}return Jt(NumberNativeArray,t),NumberNativeArray}($t),ee=function(t){function StringNativeArray(e){return t.call(this,"string",e)||this}return Jt(StringNativeArray,t),StringNativeArray}($t),ne=function(t){function BooleanNativeArray(e){return t.call(this,"boolean",e)||this}return Jt(BooleanNativeArray,t),BooleanNativeArray}($t);(Qt||(Qt={})).factory={number:function(t){return new te(t)},string:function(t){return new ee(t)},boolean:function(t){return new ne(t)}};var re,ie=function(){function NativeArrayFactory(){}return NativeArrayFactory.create=function(t,e){return Qt.factory[t](e)},NativeArrayFactory}(),oe=n(14);!function(t){t[t.Front=0]="Front",t[t.Back=1]="Back",t[t.Planar=2]="Planar"}(re||(re={}));var ae,se=function(){function Plane(t,e){this.normal=(new V).copy(V.up),this.distFromOrigin=0,this.normal=t||(new V).copy(V.up),this.distFromOrigin=e||0}return Plane.fromPool=function(){return Plane.pool.get()},Plane.prototype.set=function(t,e){return this.normal.copy(t),this.distFromOrigin=e,this},Plane.prototype.setFromPoint=function(t,e){return this.normal.copy(t),this.distFromOrigin=e.dot(t),this},Plane.prototype.setFromPoints=function(t,e,n){var r=V.dummy;return r.substractVectors(t,e),this.normal.copy(n).substract(t).cross(r).normalize(),this.setFromPoint(this.normal,t)},Plane.prototype.copy=function(t){this.normal.copy(t.normal),this.distFromOrigin=t.distFromOrigin},Plane.prototype.classifyPoint=function(t){var e=this.normal.dot(t)-this.distFromOrigin;return e>1e-6?re.Front:e<-1e-6?re.Back:re.Planar},Plane.prototype.getSignedDistance=function(t){return t.dot(this.normal)-this.distFromOrigin},Plane.pool=new N(Plane,64),Plane}(),ce=function(){function NativeSerializer(t){this.type=t,this.readProperty=function(e){return"object"==typeof e?new(t.bind.apply(t,[void 0].concat(Object.keys(e).map(function(t){return e[t]})))):e}}return NativeSerializer.prototype.writeProperty=function(t){return t},NativeSerializer}(),ue=function(){function PropertyFactory(){}return PropertyFactory.properties={Vector3:new ce(V),Vector2:new ce($),Vector4:new ce(tt),Quaternion:new ce(it),Color:new ce(H),Matrix44:new ce(nt),Matrix33:new ce(ot),Rect:new ce(bt),FileProperty:new ce(Ct),ThumbnailProperty:new ce(St),String:new ce(String),Number:new ce(Number),Boolean:new ce(Boolean),Range:new ce(Vt),NativeArray:{type:$t,readProperty:function(t){return ie.create(t.typeName,t.data)},writeProperty:function(t){return{typeName:t.typeName,data:t.data}}},NativeU8Array:{type:oe.a,readProperty:function(t){return new oe.a(t)},writeProperty:function(t){return t.serialize()}},Object:{type:Object,readProperty:function(t){return JSON.parse(JSON.stringify(t))},writeProperty:function(t){return t}},AABB:{type:at,readProperty:function(t){var e=t.min,n=t.max;return new at(new V(e.x,e.y,e.z),new V(n.x,n.y,n.z))},writeProperty:function(t){return{min:{x:t.min.x,y:t.min.y,z:t.min.z},max:{x:t.max.x,y:t.max.y,z:t.max.z}}}},Plane:{type:se,readProperty:function(t){var e=t.normal,n=t.distFromOrigin;return new se(new V(e.x,e.y,e.z),n)},writeProperty:function(t){var e=t.normal;return{normal:{x:e.x,y:e.y,z:e.z},distFromOrigin:t.distFromOrigin}}},UISize:{type:lt,readProperty:function(t){var e=new lt;return"object"==typeof t.type?e.type=t.type.value:e.type=t.type,e.value=t.value,e},writeProperty:function(t){return{type:t.type,value:t.value}}},Size:{type:Gt,readProperty:function(t){var e=new Gt;return"object"==typeof t.type?e.type=t.type.value:e.type=t.type,e.value=t.value,e},writeProperty:function(t){return{type:t.type,value:t.value}}},VertexBuffer:{type:_t,readProperty:function(t){for(var e=new _t,n=0,r=Object.keys(t.attributes);n<r.length;n++){var i=r[n];e.setAttribute(i,t.attributes[i])}return e.primitiveType=t.primitiveType,e.isDynamic=t.isDynamic,e.name=t.name,e.indices=t.indices,e},writeProperty:function(t){return{attributes:t.attributes,vertexCount:t.vertexCount,primitiveType:t.primitiveType,isDynamic:t.isDynamic,name:t.name,indices:t.indices}}},ArrayProperty:{type:xt,readProperty:function(t){var e=[];e.length=t.data.length;for(var n=0;n<t.data.length;++n)su.deserializeProperty(e,n,t.typeName,t.data[n]);return d.isObjectOfType(t.typeName,"SerializableObject")?gt.factory.createObjectArray(t.typeName,e):t.typeName in PropertyFactory.properties?new xt(PropertyFactory.properties[t.typeName].type,e):void k.logError("Unknown type: "+t.typeName)},writeProperty:function(t){var e=d.isObjectOfType(t.typeName(),"SerializableObject");return{typeName:t.typeName(),data:t.getData().map(function(n){var r=su.serializeProperty(n,t.typeName());return e&&delete r.typeName,r})}}},Reference:{type:l,readProperty:function(t){if(t.data){var e=gt.factory.createObject(t.data.typeName);return null!==e&&e.deserialize(t.data),gt.factory.createReference(t.baseTypeName,e)}return gt.factory.createReference(t.baseTypeName)},writeProperty:function(t){var e=t.getInstance();return{baseTypeName:t.baseTypeName(),data:e?e.serialize():void 0}}},ReferenceArray:{type:Ot,readProperty:function(t){var e=t.data.map(function(t){return PropertyFactory.properties.Reference.readProperty(t)});return gt.factory.createReferenceArray(t.typeName,e)},writeProperty:function(t){return{typeName:t.typeName(),data:t.getData().map(function(t){return PropertyFactory.properties.Reference.writeProperty(t)})}}},AssetReferenceArray:{type:Zt,readProperty:function(t){var e=[];e.length=t.data.length;for(var n=0;n<t.data.length;++n)su.deserializeProperty(e,n,"AssetReference",t.data[n]);return gt.factory.createAssetReferenceArray(t.typeName,e)},writeProperty:function(t){return{typeName:t.typeName(),data:t.data.map(function(t){return su.serializeProperty(t)})}}},EntityReference:{type:Ft,readProperty:function(t){return new Ft(t)},writeProperty:function(t){return t.id}},ComponentReference:{type:Lt,readProperty:function(t){var e=t.componentTypeName,n=gt.factory.createComponentReference(e);return n.entityId=t.entityId,n},writeProperty:function(t){return{entityId:t.entityId,componentTypeName:t.componentTypeName}}}},PropertyFactory}(),le=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),pe=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},he=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Input=0]="Input",t[t.Output=1]="Output",t[t.InputOutput=2]="InputOutput"}(ae||(ae={}));var fe,de=function(t){function PinReference(e,n){var r=t.call(this)||this;return r.operatorId=e||w.makeUniqueId(),r.pinId=n||w.makeUniqueId(),r}return le(PinReference,t),PinReference.prototype.equals=function(t){return this.operatorId===t.operatorId&&this.pinId===t.pinId},PinReference}(_),ye=function(t){function BasePin(e,n,r){var i=t.call(this)||this;return i.id=r||e||w.makeUniqueId(),i.name=e||"NewPin",i.type=n||ae.Input,i}return le(BasePin,t),Object.defineProperty(BasePin.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),BasePin.prototype.upgrade=function(t,e){return 1===e&&(t.properties.id=t.properties.name),t},pe([Attributes_hidden(),he("design:type",String)],BasePin.prototype,"id",void 0),pe([Attributes_hidden(),he("design:type",String)],BasePin.prototype,"name",void 0),pe([Attributes_hidden(),he("design:type",Number)],BasePin.prototype,"type",void 0),BasePin}(_),me=function(t){function SignalPin(){return null!==t&&t.apply(this,arguments)||this}return le(SignalPin,t),SignalPin=pe([displayName("Signal")],SignalPin)}(ye),ve=function(t){function DataPin(){return null!==t&&t.apply(this,arguments)||this}return le(DataPin,t),DataPin.prototype.setData=function(t){},DataPin.prototype.getData=function(){},DataPin}(ye),ge=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),_e=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},be=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},we=function(t){function ObjectDeclaration(){var e=null!==t&&t.apply(this,arguments)||this;return e.pinChanged=new S.AsyncEvent,e._pins=new Ot(ye),e}return ge(ObjectDeclaration,t),Object.defineProperty(ObjectDeclaration.prototype,"pins",{get:function(){return this._pins},enumerable:!0,configurable:!0}),_e([unserializable(),be("design:type",Object)],ObjectDeclaration.prototype,"pinChanged",void 0),ObjectDeclaration=_e([displayName("Object Declaration")],ObjectDeclaration)}(A),xe=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Pe=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Oe=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ce=function(t){function Prefab(){var e=t.call(this)||this;return e.root=new hu,e}return xe(Prefab,t),Object.defineProperty(Prefab.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Prefab.prototype.isLoaded=function(){return this.root.isLoaded()},Prefab.prototype.serialize=function(){return{typeName:this.constructor.name,version:this.version,id:this.id,name:this.name,root:su.serializeEntity(this.root)}},Prefab.prototype.deserialize=function(t){var e=t;if(1===e.version){var n=t;e.root=n.properties.root,e.id=n.properties.id,e.name=n.properties.name}return this.id=e.id,this.name=e.name,su.deserializeEntity(this.root,e.root,!0),Promise.resolve(this)},Prefab=Pe([editable(!1),creatable(!1),Oe("design:paramtypes",[])],Prefab)}(A),Se=function(){function Basis(){this.right=(new V).copy(V.right),this.up=(new V).copy(V.up),this.forward=(new V).copy(V.forward)}return Basis.fromMatrix=function(t){return(new Basis).setFromMatrix(t)},Basis.fromNormal=function(t){return(new Basis).setFromNormal(t)},Basis.fromForward=function(t){return(new Basis).setFromForward(t)},Basis.prototype.setFromMatrix=function(t){var e=t.data;return this.right.set(e[0],e[1],e[2]),this.up.set(e[4],e[5],e[6]),this.forward.set(e[8],e[9],e[10]),this},Basis.prototype.setFromNormal=function(t){this.up.copy(t);var e=this.up.dot(V.forward);return Math.abs(e)<1?this.right.crossVectors(this.up,V.forward).normalize():this.right.copy(V.right).multiply(Math.sign(e)),this.forward.crossVectors(this.right,this.up).normalize(),this},Basis.prototype.setFromForward=function(t){this.forward.copy(t);var e=t.dot(V.up);return Math.abs(e)<1?this.right.crossVectors(V.up,this.forward).normalize():this.right.copy(V.right).multiply(Math.sign(e)),this.up.crossVectors(this.forward,this.right).normalize(),this},Basis}(),je=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Re=function(){return function RayPlaneCollisionResult(){}}(),Te=function(){return function RayAABBCollisionResult(){this.intersection1=new V,this.intersection2=new V,this.normal1=new V,this.normal2=new V}}(),Ee=function(t){function RaySphereCollisionResult(){return null!==t&&t.apply(this,arguments)||this}return je(RaySphereCollisionResult,t),RaySphereCollisionResult}(Te);!function(t){t.dummy=new V,t.dummy2=new V,t.rayAABBResult=new Te,t.raySphereResult=new Ee,t.rayPlaneResult=new Re,t.basis=new Se}(fe||(fe={}));var Be,Ae=function(){function Ray(t,e,n){this._origin=t||new V,this._direction=e||(new V).copy(V.forward),this._length=n||999999}return Object.defineProperty(Ray.prototype,"origin",{get:function(){return this._origin},set:function(t){this._origin.copy(t),delete this._destination},enumerable:!0,configurable:!0}),Object.defineProperty(Ray.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction.copy(t),delete this._destination},enumerable:!0,configurable:!0}),Object.defineProperty(Ray.prototype,"destination",{get:function(){return this._destination||(this._destination=(new V).copy(this._direction).multiply(this._length).add(this._origin)),this._destination},enumerable:!0,configurable:!0}),Object.defineProperty(Ray.prototype,"length",{get:function(){return this._length},set:function(t){t!==this._length&&(this._length=t,delete this._destination)},enumerable:!0,configurable:!0}),Ray.fromPerspectiveView=function(t,e,n,r,i,o){return(new Ray).setFromPerspectiveView(t,e,n,r,i,o)},Ray.fromOrthographicView=function(t,e,n,r,i,o){return(new Ray).setFromOrthographicView(t,e,n,r,i,o)},Ray.prototype.set=function(t,e,n){this._origin.copy(t),this._direction.copy(e),void 0!==n&&(this._length=n)},Ray.prototype.copy=function(t){return this._origin.copy(t.origin),this._direction.copy(t.direction),this._length=t.length,delete this._destination,this},Ray.prototype.transform=function(t){this._origin.transform(t),this._direction.transformDirection(t),delete this._destination},Ray.prototype.setFromPerspectiveView=function(t,e,n,r,i,o){var a=i/o,s=1/Math.tan(t/2),c=(2*n/i-1)/(s/a),u=-(2*r/o-1)/s,l=e.data;return this.direction.x=c*l[0]+u*l[4]+-1*l[8],this.direction.y=c*l[1]+u*l[5]+-1*l[9],this.direction.z=c*l[2]+u*l[6]+-1*l[10],this.direction.normalize(),this.origin.setFromMatrix(e),this},Ray.prototype.setFromOrthographicView=function(t,e,n,r,i,o){var a=2*t*(1-r/(o-1))-t,s=i*t/o,c=n/(i-1)*(2*s)-s,u=fe.basis;return u.setFromMatrix(e),this.origin.setFromMatrix(e).add(u.right.multiply(c)).add(u.up.multiply(a)),this.direction.copy(u.forward).flip().normalize(),this},Ray.prototype.castOnSphere=function(t,e){var n=fe.dummy,r=fe.raySphereResult,i=n.substractVectors(this.origin,t),o=i.dot(this.direction),a=o*o-(i.dot(i)-e*e);if(a<0)return null;var s=-o-(a=Math.sqrt(a)),c=-o+a,u=s,l=c;if(s<0){if(c<0)return null;u=c,l=s}return r.intersection1.copy(this.direction).multiply(u).add(this.origin),r.normal1.copy(r.intersection1).substract(t).normalize(),r.intersection2.copy(this.direction).multiply(l).add(this.origin),r.normal2.copy(r.intersection2).substract(t).normalize(),r},Ray.prototype.castOnPlane=function(t){var e=fe.rayPlaneResult,n=t.normal.dot(this.origin)-t.distFromOrigin;if(W.isZero(n))e.intersection=V.dummy.copy(this.origin),e.classification=re.Planar;else{var r=t.normal.dot(this.direction);if(W.isZero(r))e.intersection=null;else{var i=-n/r;e.intersection=i<0?null:V.dummy.copy(this.direction).multiply(i).add(this.origin)}e.classification=n>0?re.Front:re.Back}return e},Ray.prototype.castOnAABB=function(t){var e=fe.rayAABBResult,n=fe.dummy,r=fe.dummy2,i=V.dummy.substractVectors(t.min,this.origin).divideVector(this.direction),o=V.dummy2.substractVectors(t.max,this.origin).divideVector(this.direction),a=n.set(Math.min(i.x,o.x),Math.min(i.y,o.y),Math.min(i.z,o.z)),s=r.set(Math.max(i.x,o.x),Math.max(i.y,o.y),Math.max(i.z,o.z)),c=a.max(),u=s.min();if(u>=c){var l=c,p=u;if(c<0){if(u<0)return null;l=u,p=c}return e.intersection1.copy(this.direction).multiply(l).add(this.origin),e.intersection2.copy(this.direction).multiply(p).add(this.origin),e.normal1.copy(this.getAABBNormal(t,e.intersection1)),e.normal2.copy(this.getAABBNormal(t,e.intersection2)),e}return null},Ray.prototype.getAABBNormal=function(t,e){var n=e.x,r=e.y,i=e.z;return W.isEqual(n,t.min.x)?V.dummy.set(-1,0,0):W.isEqual(n,t.max.x)?V.dummy.set(1,0,0):W.isEqual(r,t.min.y)?V.dummy.set(0,-1,0):W.isEqual(r,t.max.y)?V.dummy.set(0,1,0):W.isEqual(i,t.min.z)?V.dummy.set(0,0,-1):W.isEqual(i,t.max.z)?V.dummy.set(0,0,1):V.dummy.set(0,1,0)},Ray.dummy=new Ray,Ray}(),Ie=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Me=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ze=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.defaultComponentType="Transform",t.defaultAssetType="Material"}(Be||(Be={}));var ke,De=function(t){function TDataPin(e,n){var r=t.call(this,e,n)||this;return Object.defineProperty(r,TDataPin.runtimeValueAccessor,{get:function(){return r.value},set:function(t){return r.value=t},configurable:!0}),r}return Ie(TDataPin,t),TDataPin.prototype.setData=function(t){this.value=t},TDataPin.prototype.getData=function(){return this.value},TDataPin.runtimeValueAccessor="_value",TDataPin}(ve),Fe=function(t){function NumberPin(e,n,r){var i=t.call(this,e,n)||this;return i.value=r||0,i}return Ie(NumberPin,t),NumberPin=Me([displayName("Number"),ze("design:paramtypes",[String,Number,Number])],NumberPin)}(De),Le=function(t){function StringPin(e,n){var r=t.call(this,e,n)||this;return r.value="",r}return Ie(StringPin,t),StringPin=Me([displayName("String"),ze("design:paramtypes",[String,Number])],StringPin)}(De),Ne=function(t){function BooleanPin(e,n){var r=t.call(this,e,n)||this;return r.value=!1,r}return Ie(BooleanPin,t),BooleanPin=Me([displayName("Boolean"),ze("design:paramtypes",[String,Number])],BooleanPin)}(De),Ve=function(t){function Vector2Pin(e,n){var r=t.call(this,e,n)||this;return r.value=new $,r}return Ie(Vector2Pin,t),Vector2Pin.prototype.setData=function(t){this.value.copy(t)},Vector2Pin=Me([displayName("Vector2"),ze("design:paramtypes",[String,Number])],Vector2Pin)}(De),Ue=function(t){function Vector3Pin(e,n){var r=t.call(this,e,n)||this;return r.value=new V,r}return Ie(Vector3Pin,t),Vector3Pin.prototype.setData=function(t){this.value.copy(t)},Vector3Pin=Me([displayName("Vector3"),ze("design:paramtypes",[String,Number])],Vector3Pin)}(De),We=function(t){function Vector4Pin(e,n){var r=t.call(this,e,n)||this;return r.value=new tt,r}return Ie(Vector4Pin,t),Vector4Pin.prototype.setData=function(t){this.value.copy(t)},Vector4Pin=Me([displayName("Vector4"),ze("design:paramtypes",[String,Number])],Vector4Pin)}(De),qe=function(t){function ColorPin(e,n){var r=t.call(this,e,n)||this;return r.value=new H,r}return Ie(ColorPin,t),ColorPin.prototype.setData=function(t){this.value.copy(t)},ColorPin=Me([displayName("Color"),ze("design:paramtypes",[String,Number])],ColorPin)}(De),Ge=function(t){function RayPin(e,n){var r=t.call(this,e,n)||this;return r.value=new Ae,r}return Ie(RayPin,t),RayPin.prototype.setData=function(t){this.value.copy(t)},RayPin=Me([displayName("Ray"),ze("design:paramtypes",[String,Number])],RayPin)}(De),He=function(t){function PrefabPin(e,n){var r=t.call(this,e,n)||this;return r.value=new Yt(Ce),Object.defineProperty(r,De.runtimeValueAccessor,{get:function(){return r.value.asset},set:function(t){return r.value.asset=t}}),r}return Ie(PrefabPin,t),PrefabPin=Me([displayName("Prefab"),ze("design:paramtypes",[String,Number])],PrefabPin)}(De),Ke=function(t){function EntityReferencePin(e,n){var r=t.call(this,e,n)||this;return r.value=new Ft,Object.defineProperty(r,De.runtimeValueAccessor,{get:function(){return r.value.entity},set:function(t){return r.value.entity=t}}),r}return Ie(EntityReferencePin,t),EntityReferencePin=Me([displayName("Entity"),ze("design:paramtypes",[String,Number])],EntityReferencePin)}(De),Xe=function(t){function ComponentReferencePin(e,n,r){var i=t.call(this,e,n)||this;return i._componentType=r||Be.defaultComponentType,Object.defineProperty(i,De.runtimeValueAccessor,{get:function(){return i.value.component},set:function(t){return i.value.component=t}}),i}return Ie(ComponentReferencePin,t),Object.defineProperty(ComponentReferencePin.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(ComponentReferencePin.prototype,"componentType",{get:function(){return this._componentType},set:function(t){this.value=gt.factory.createComponentReference(t),this._componentType=t},enumerable:!0,configurable:!0}),ComponentReferencePin.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n),"_componentType"!==e||this.value||(this.componentType=n)},ComponentReferencePin.prototype.upgrade=function(e,n){if(1===n)e=t.prototype.upgrade.call(this,e,n);else if(2===n){var r=e.properties._componentType;"UIImage"===r?Object.assign(e.properties,{_componentType:"Image"}):"UIText"===r&&Object.assign(e.properties,{_componentType:"Text"})}return e},ComponentReferencePin=Me([displayName("Component"),ze("design:paramtypes",[String,Number,String])],ComponentReferencePin)}(De),Qe=function(t){function CollisionInfoPin(e,n){return t.call(this,e,n)||this}return Ie(CollisionInfoPin,t),CollisionInfoPin=Me([displayName("CollisionInfo"),ze("design:paramtypes",[String,Number])],CollisionInfoPin)}(De),Ye=function(t){function ObjectReferencePin(e,n,r){var i=t.call(this,n,r)||this;return i.value=new eu(e),Object.defineProperty(i,De.runtimeValueAccessor,{get:function(){return i.value.asset},set:function(t){return i.value.asset=t}}),i}return Ie(ObjectReferencePin,t),Object.defineProperty(ObjectReferencePin.prototype,"declarationId",{get:function(){return this.value.declarationId},set:function(t){this.value=new eu(t)},enumerable:!0,configurable:!0}),ObjectReferencePin.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n),"_declarationId"===e&&this.value.declarationId!==n&&(this.value=new eu(n))},ObjectReferencePin}(De),Ze=function(t){function ArrayPin(e,n,r){var i=t.call(this,e,n)||this;return i._isDirty=!0,Object.defineProperty(i,De.runtimeValueAccessor,{get:function(){return i._isDirty&&(i._runtimeData=i.value.data.map(function(t){return t[De.runtimeValueAccessor]}),i._isDirty=!1),i._runtimeData},set:function(t){i.value.data=t.map(function(t){var e=new De;return e.value=t,e}),i._isDirty=!0}}),i}return Ie(ArrayPin,t),Object.defineProperty(ArrayPin.prototype,"dataType",{get:function(){return this._dataType},set:function(t){t&&(this.value=gt.factory.createObjectArray(t)),this._dataType=t,delete this._declarationId},enumerable:!0,configurable:!0}),Object.defineProperty(ArrayPin.prototype,"declarationId",{get:function(){return this._declarationId},set:function(t){var e=this;t&&(this.value&&"ObjectReferencePin"===this.value.typeName()||(this.value=gt.factory.createObjectArray("ObjectReferencePin")),this.value.grow=function(n){n?n.declarationId=t:n=new Ye(t),e.value.data.push(n)}),this._declarationId=t,delete this._dataType},enumerable:!0,configurable:!0}),ArrayPin.prototype.setData=function(e){t.prototype.setData.call(this,e),this._isDirty=!0},ArrayPin.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n),"_dataType"!==e||this.value?"_declarationId"===e&&(this.declarationId=n):this.dataType=n},Me([unserializable(),ze("design:type",Object)],ArrayPin.prototype,"_isDirty",void 0),Me([unserializable(),ze("design:type",Array)],ArrayPin.prototype,"_runtimeData",void 0),ArrayPin=Me([displayName("Array"),ze("design:paramtypes",[String,Number,String])],ArrayPin)}(De),Je=function(t){function AssetPin(e,n,r){var i=t.call(this,e,n)||this;return i._assetType=r||Be.defaultAssetType,Object.defineProperty(i,De.runtimeValueAccessor,{get:function(){return i.value.asset},set:function(t){return i.value.asset=t}}),i}return Ie(AssetPin,t),Object.defineProperty(AssetPin.prototype,"assetType",{get:function(){return this._assetType},set:function(t){this.value=gt.factory.createAssetReference(t),this._assetType=t},enumerable:!0,configurable:!0}),AssetPin.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n),"_assetType"!==e||this.value||(this.assetType=n)},AssetPin=Me([displayName("Asset"),ze("design:paramtypes",[String,Number,String])],AssetPin)}(De);!function(t){t.dummy=new V,t.dummy2=new V,t.dummy3=new V,t.dummy4=new V,t.dummy5=new V}(ke||(ke={}));var $e,tn=function(){function Triangle(t,e,n){this.a=new V,this.b=new V,this.c=new V,this.set(t||V.zero,e||V.zero,n||V.zero)}return Triangle.fromPool=function(){return Triangle.pool.get()},Triangle.prototype.set=function(t,e,n){return this.a.copy(t),this.b.copy(e),this.c.copy(n),this},Triangle.prototype.contains=function(t,e){var n=this.getBarycentricCoords(t),r=e||.005;return n.y>=0-r&&n.z>=0-r&&n.y+n.z<=1+r},Triangle.prototype.getClosestPoint=function(t){var e=ke.dummy,n=ke.dummy2,r=ke.dummy3,i=ke.dummy4,o=ke.dummy5,a=e,s=n,c=r,u=i;W.getClosestPointOnLine(t,this.a,this.b,a),W.getClosestPointOnLine(t,this.b,this.c,s),W.getClosestPointOnLine(t,this.c,this.a,c);var l=u.substractVectors(t,a).length,p=u.substractVectors(t,s).length,h=l;return p<h?(h=p,o.copy(s)):o.copy(a),u.substractVectors(t,c).length<h&&o.copy(c),o},Triangle.prototype.getBarycentricCoords=function(t){var e=ke.dummy,n=ke.dummy2,r=ke.dummy3,i=ke.dummy4,o=e,a=n,s=r;o.substractVectors(this.b,this.a),a.substractVectors(this.c,this.a),s.substractVectors(t,this.a);var c=o.dot(o),u=o.dot(a),l=a.dot(a),p=s.dot(o),h=s.dot(a),f=c*l-u*u;if(0!==f){var d=(l*p-u*h)/f,y=(c*h-u*p)/f,m=1-d-y;return i.set(m,d,y)}return i.set(0,Number.MAX_VALUE,Number.MAX_VALUE)},Triangle.pool=new N(Triangle,64),Triangle}(),en=function(){function BehaviorAPIFactory(){}return BehaviorAPIFactory.createObject=function(t){for(var e,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var i=BehaviorAPIFactory.variableObjectFactory[t];return i?i.apply(void 0,n):(e=gt.factory).createObject.apply(e,[t].concat(n))},BehaviorAPIFactory.variableObjectFactory={Vector2:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new($.bind.apply($,[void 0].concat(t)))},Vector3:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new(V.bind.apply(V,[void 0].concat(t)))},Vector4:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new(tt.bind.apply(tt,[void 0].concat(t)))},Color:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new(H.bind.apply(H,[void 0].concat(t)))},Matrix44:function(t){return new nt(t)},Quaternion:function(t,e,n,r){return new it(t,e,n,r)},Map:function(){return new Map},Plane:function(t,e){return new se(t,e)},Triangle:function(t,e,n){return new tn(t,e,n)},Ray:function(t,e,n){return new Ae(t,e,n)},Basis:function(){return new Se},VertexBuffer:function(t){return new _t(t)}},BehaviorAPIFactory}();!function(t){t[t.Continue=0]="Continue",t[t.Finish=1]="Finish"}($e||($e={}));var nn,rn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),on=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},an=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},sn=function(t){function BehaviorNode(){var e=t.call(this)||this;return e.position=new $,e._pins=new Ot(ye),e.id=w.makeUniqueId(),e}return rn(BehaviorNode,t),Object.defineProperty(BehaviorNode.prototype,"pins",{get:function(){return this._pins},enumerable:!0,configurable:!0}),Object.defineProperty(BehaviorNode.prototype,"ownerBehavior",{get:function(){return this._ownerBehavior},set:function(t){this._ownerBehavior=t},enumerable:!0,configurable:!0}),BehaviorNode.prototype.onBehaviorStarted=function(){},BehaviorNode.prototype.findPin=function(t){var e=this._pins.data.find(function(e){return e.instance.id===t});return e?e.instance:void 0},BehaviorNode.prototype.findPinByName=function(t){var e=this._pins.data.find(function(e){return e.instance.name===t});return e?e.instance:void 0},BehaviorNode.prototype.filterPins=function(t){return this._pins.data.filter(function(e){return t(e.instance)}).map(function(t){return t.instance})},BehaviorNode.prototype.sendSignal=function(t){var e=this.findPinByName(t);e&&this._ownerBehavior.sendSignal(this.id,e.id)},BehaviorNode.prototype.isLoaded=function(){return!0},BehaviorNode.prototype.createPin=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];this[t]=(r=gt.factory).createObject.apply(r,[n.name,t,e].concat(i)),this.registerPin(this[t])},BehaviorNode.prototype.createComponentReferencePin=function(t,e,n){var r=new Xe(t,e,n.name);r.componentType=n.name,this[t]=r,this.registerPin(this[t])},BehaviorNode.prototype.createAssetPin=function(t,e,n){var r=new Je(t,e,n.name);r.assetType=n.name,this[t]=r,this.registerPin(this[t])},BehaviorNode.prototype.createArrayPin=function(t,e,n){var r=new Ze(t,e,n.name);r.dataType=n.name,this[t]=r,this.registerPin(this[t])},BehaviorNode.prototype.registerPin=function(t){this._pins.grow(t)},on([unserializable(),an("design:type",Number)],BehaviorNode.prototype,"widthInEditor",void 0),on([unserializable(),an("design:type",Object)],BehaviorNode.prototype,"_ownerBehavior",void 0),on([unserializable(),an("design:type",Object)],BehaviorNode.prototype,"_pins",void 0),BehaviorNode}(_),cn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),un=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ln=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.startPinId="_start",t.finishPinId="_finish"}(nn||(nn={}));var pn,hn=function(t){function Operator(){var e=t.call(this)||this;return e.createPin(nn.startPinId,ae.Input,me),e.createPin(nn.finishPinId,ae.Output,me),e}return cn(Operator,t),Operator.prototype.onStart=function(){return $e.Finish},Operator.prototype.onUpdate=function(){return $e.Finish},Operator.prototype.onFinish=function(){},Operator.prototype.onSignalReceived=function(t){},un([unserializable(),ln("design:type",me)],Operator.prototype,"_start",void 0),un([unserializable(),ln("design:type",me)],Operator.prototype,"_finish",void 0),Operator}(sn),fn=function(){function EngineEvents(){}return EngineEvents.assetLoaded=new S.AsyncEvent,EngineEvents.objectSaved=new S.AsyncEvent,EngineEvents}();(pn||(pn={})).errors=new Map;var dn,yn=function(){function BehaviorErrors(){}return BehaviorErrors.checkCodeBlock=function(t){},BehaviorErrors.forEach=function(t){pn.errors.forEach(t)},BehaviorErrors.clear=function(t){t?pn.errors.delete(t):pn.errors.clear()},BehaviorErrors}();!function(t){t.generateRuntimeCode=function(t){return console.assert(!1,"Not implemented in this run-time"),""}}(dn||(dn={}));var mn,vn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),gn=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},_n=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.codeProperty="_code",t.trimId=function(t){return t.split("-").join("")}}(mn||(mn={}));var bn,wn=function(t){function CodeBlock(){var e=null!==t&&t.apply(this,arguments)||this;return e.pinChanged=new S.VoidSyncEvent,e._pins=new Ot(ye),e._code="\nfunction onStart() {        \n    return ExecutionStatus.Continue;\n}\n\nfunction onUpdate() {\n    return ExecutionStatus.Finish;\n}\n",e._isLoaded=!1,e._isLoading=!0,e._hasCompileErrors=!1,e}return vn(CodeBlock,t),Object.defineProperty(CodeBlock.prototype,"version",{get:function(){return 6},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"pins",{get:function(){return this._pins},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"code",{get:function(){return this._code},set:function(t){this._code=t,this.clearErrors(),this._standaloneScript&&this._standaloneScript.parentNode&&this._standaloneScript.parentNode.removeChild(this._standaloneScript);try{console.assert(this.templatePath);var e=this.templatePath.replace(" ","_").replace("."+this.constructor.name,".js"),n=t;0;var r=window.location,i=r.protocol,o=r.hostname,a=r.port,s=n+"\r\n//# sourceURL="+i+"//"+o+(a&&a.length>0?":"+a:"")+"/"+e;this._standaloneScript=document.createElement("script"),this._standaloneScript.appendChild(document.createTextNode(s)),document.head.appendChild(this._standaloneScript)}catch(t){this.logRuntimeError(t.message)}finally{var c=this._isLoaded;this._isLoading=!1,this._isLoaded=!0,c||fn.assetLoaded.post(this),yn.checkCodeBlock(this)}},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"program",{get:function(){return this._program},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"hasCompileErrors",{get:function(){return this._hasCompileErrors},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"runtimeError",{get:function(){return this._runtimeError},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"functions",{get:function(){return this._functions},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!0,configurable:!0}),CodeBlock.prototype.logRuntimeError=function(t){k.logError("Error: '"+t+"' in '"+this.templatePath+"'"),this._runtimeError=[t,Date.now()]},CodeBlock.prototype.logCompileError=function(t){k.logError("Error: '"+t+"' in '"+this.templatePath+"'"),this._hasCompileErrors=!0},CodeBlock.prototype.clearRuntimeErrors=function(){delete this._runtimeError},CodeBlock.prototype.isLoaded=function(){return this._isLoaded},CodeBlock.prototype.destroy=function(){this._standaloneScript&&this._standaloneScript.parentNode&&this._standaloneScript.parentNode.removeChild(this._standaloneScript),t.prototype.destroy.call(this)},CodeBlock.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n),e===mn.codeProperty&&(this.code=n)},CodeBlock.prototype.upgrade=function(t,e){return 1===e?(t.properties._code=t.properties._code.replace(/getComponent\(("|')UIImage("|')\)/g,'getComponent("Image")'),t.properties._code=t.properties._code.replace(/getComponent\(("|')UIText("|')\)/g,'getComponent("Text")')):2===e?t.properties._code=t.properties._code.replace(/Engine.createFromPrefab/g,"Engine.createEntity"):3===e?t.properties._code=t.properties._code.replace(/Engine.root(\(\))?.findChild/g,"Engine.findEntity").replace(/transform.(_value.)?(position|rotation|scale|forward|right|up)/g,function(t,e,n){var r="transform.";return e&&(r=""+r+e),r=r+"world"+(n[0].toUpperCase()+n.substring(1))}).replace(/transform.(_value.)?local(Position|Rotation|Scale|Forward|Right|Up)/g,function(t,e,n){var r="transform.";return e&&(r=""+r+e),r=(""+r+n).toLowerCase()}):4===e?t.properties._code=t.properties._code.replace(/Engine.deltaTime/g,"Time.deltaTime").replace(/Engine.isOpenSource/g,"Project.isOpenSource").replace(/Engine.projectName/g,"Project.name").replace(/Engine.importToEditor/g,"Project.importToEditor").replace(/Engine.readSave/g,"SavedData.get").replace(/Engine.writeSave\([a-zA-Z]+\)/g,"SavedData.flush()").replace(/Engine.createEntity\(([a-zA-Z._]+)(, ([a-zA-Z 0-9\(\),]+))?\)/g,function(t,e,n,r){return r?"Entities.create("+e+", { position: "+r+" })":"Entities.create("+e+")"}).replace(/Engine.destroyEntity\(([a-zA-Z0-9._]+)\)/g,function(t,e,n){return e+".destroy()"}).replace(/Engine.findEntity\((['"a-zA-Z0-9._]+)\)/g,function(t,e,n){return"Entities.find("+e+")"}).replace(/Engine.getScreenSize\(\)/g,"Renderer.screenSize").replace(/Engine.loadScene\((['"a-zA-Z0-9_\/.]+)\)/g,function(t,e,n){return"Scenes.load("+e+")"}).replace(/Engine.loadAssetById\(([a-zA-Z0-9_.]+)\)/g,function(t,e,n){return"Assets.loadById("+e+")"}).replace(/Engine.loadAsset\((['"a-zA-Z0-9._]+)\)/g,function(t,e,n){return"Assets.load("+e+")"}):5===e&&(t.properties._code=t.properties._code.replace(/.owner./g,".entity.").replace(/.findEntities/g,".filterChildren").replace(/getComponent\(["']([a-zA-Z]+)["']\)/g,function(t,e){return'getComponentByName("'+e+'")'}).replace(/setComponent\(["']([a-zA-Z]+)["']\)/g,function(t,e){return'setComponentByName("'+e+'")'}).replace(/getOrSetComponent\(["']([a-zA-Z]+)["']\)/g,function(t,e){return'getOrSetComponentByName("'+e+'")'})),t},CodeBlock.prototype.clearErrors=function(){this._hasCompileErrors=!1,this.clearRuntimeErrors(),yn.clear(this)},gn([unserializable(),_n("design:type",Object)],CodeBlock.prototype,"pinChanged",void 0),gn([unserializable(),_n("design:type",Object)],CodeBlock.prototype,"sourceInfo",void 0),gn([unserializable(),_n("design:type",Object)],CodeBlock.prototype,"_program",void 0),gn([unserializable(),_n("design:type",Object)],CodeBlock.prototype,"_functions",void 0),gn([unserializable(),_n("design:type",Object)],CodeBlock.prototype,"_isLoaded",void 0),gn([unserializable(),_n("design:type",Object)],CodeBlock.prototype,"_isLoading",void 0),gn([unserializable(),_n("design:type",HTMLScriptElement)],CodeBlock.prototype,"_standaloneScript",void 0),gn([unserializable(),_n("design:type",String)],CodeBlock.prototype,"_scriptUrl",void 0),gn([unserializable(),_n("design:type",Object)],CodeBlock.prototype,"_hasCompileErrors",void 0),gn([unserializable(),_n("design:type",Array)],CodeBlock.prototype,"_runtimeError",void 0),CodeBlock=gn([displayName("Code Block"),hasDedicatedEditor(!0)],CodeBlock)}(A),xn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Pn=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},On=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Cn=function(t){function CodeBlockInstance(){var e=t.call(this)||this;return e._onStartExecutionPending=!1,e._initStateExecutionPending=!1,e._stateInitialized=!1,e._codeBlock=new Yt(wn),e.sendSignal=e.sendSignal.bind(e),e.onCodeBlockPinsChanged=e.onCodeBlockPinsChanged.bind(e),e.onCodeBlockChanged=e.onCodeBlockChanged.bind(e),e._codeBlock.assetChanged.attach(e.onCodeBlockChanged),e}return xn(CodeBlockInstance,t),Object.defineProperty(CodeBlockInstance.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlockInstance.prototype,"codeBlock",{get:function(){return this._codeBlock.asset},set:function(t){this._codeBlock.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlockInstance.prototype,"customPins",{get:function(){return this._customPins},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlockInstance.prototype,"stateVariables",{get:function(){return this._stateVariables},enumerable:!0,configurable:!0}),CodeBlockInstance.prototype.isLoaded=function(){return w.isAssetRefLoaded(this._codeBlock)},CodeBlockInstance.prototype.destroy=function(){if(this._stateInitialized){this.executeFunction("onDestroy");for(var e=0,n=Object.values(this._stateVariables);e<n.length;e++){var r=n[e];if(!r.isA||!r.isA(ve)){var i=r[De.runtimeValueAccessor];i&&i.constructor&&"VertexBuffer"===i.constructor.name&&i.unload(ht.context)}}}this._codeBlock.asset&&this._codeBlock.asset.pinChanged.detach(this.onCodeBlockPinsChanged),this._codeBlock.detach(),t.prototype.destroy.call(this)},CodeBlockInstance.prototype.onBehaviorStarted=function(){this.initializeStateIfNecessary(),this.executeFunction("onBehaviorStarted")},CodeBlockInstance.prototype.onStart=function(){var t=this.codeBlock;if(this.initializeStateIfNecessary(),t.runtimeError)return this._onStartExecutionPending=!0,$e.Continue;if(t.runtimeError||t.isLoading)return this._onStartExecutionPending=!0,$e.Continue;var e=this.executeFunction("onStart");return void 0!==e?e:t.runtimeError?(this._onStartExecutionPending=!0,$e.Continue):$e.Finish},CodeBlockInstance.prototype.onUpdate=function(){var t=this.codeBlock;if(t.runtimeError||t.isLoading)return $e.Continue;if(this._initStateExecutionPending){if(this.initializeStateIfNecessary(),t.runtimeError)return $e.Continue;this._initStateExecutionPending=!1}if(this._onStartExecutionPending){var e=this.executeFunction("onStart");return void 0!==e?(this._onStartExecutionPending=!1,e):t.runtimeError?$e.Continue:$e.Finish}var n=this.executeFunction("onUpdate");return void 0!==n?n:t.runtimeError?$e.Continue:$e.Finish},CodeBlockInstance.prototype.onFinish=function(){this.executeFunction("onFinish")},CodeBlockInstance.prototype.onSignalReceived=function(t){this.codeBlock.runtimeError||this.executeFunction("onSignalReceived",t)},CodeBlockInstance.prototype.onCodeBlockPinsChanged=function(){var t=this.codeBlock;this._customPins=t.pins.copy(),this._stateInitialized=!1},CodeBlockInstance.prototype.findPin=function(e){var n=t.prototype.findPin.call(this,e);if(!n){var r=this._customPins?this._customPins.data.find(function(t){return t.instance.id===e}):void 0;n=r?r.instance:void 0}return n},CodeBlockInstance.prototype.filterPins=function(e){return t.prototype.filterPins.call(this,e).concat(this._customPins.data.filter(function(t){return e(t.instance)}).map(function(t){return t.instance}))},CodeBlockInstance.prototype.findPinByName=function(e){var n=t.prototype.findPin.call(this,e);if(!n){var r=this._customPins.data.find(function(t){return t.instance.name===e});n=r?r.instance:void 0}return n},CodeBlockInstance.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_codeBlock:t.properties.codeBlock}),delete t.properties.codeBlock),t},CodeBlockInstance.prototype.executeFunction=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this.codeBlock;try{var i=t+"_"+mn.trimId(r.id);return i in window?(this.initializeStateIfNecessary(),window[i].apply(window,[this._stateVariables,Kc.api,en.createObject,this.sendSignal].concat(e))):void 0}catch(t){r.logRuntimeError("Runtime Error: '"+t.stack+"'")}},CodeBlockInstance.prototype.onCodeBlockChanged=function(t){var e=t.oldAsset;e&&e.pinChanged.detach(this.onCodeBlockPinsChanged);var n=t.newAsset;n&&(this._customPins=n.pins.copy(),this._stateInitialized=!1,n.pinChanged.attach(this.onCodeBlockPinsChanged))},CodeBlockInstance.prototype.initializeStateIfNecessary=function(){if(!this._stateInitialized){var t=this.codeBlock;try{this._stateVariables=Qc.initializeCodeBlockInstanceState(t,this.ownerBehavior.ownerComponent.entity,this._customPins,this.sendSignal),this._stateInitialized=!0}catch(e){this._initStateExecutionPending=!0,t.logRuntimeError("Runtime Error: '"+e.stack+"'")}}},Pn([unserializable(),On("design:type",Ot)],CodeBlockInstance.prototype,"_customPins",void 0),Pn([unserializable(),On("design:type",Object)],CodeBlockInstance.prototype,"_stateVariables",void 0),Pn([unserializable(),On("design:type",Object)],CodeBlockInstance.prototype,"_onStartExecutionPending",void 0),Pn([unserializable(),On("design:type",Object)],CodeBlockInstance.prototype,"_initStateExecutionPending",void 0),Pn([unserializable(),On("design:type",Object)],CodeBlockInstance.prototype,"_stateInitialized",void 0),CodeBlockInstance}(hn),Sn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),jn=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Rn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Tn=function(t){function BehaviorOperator(){var e=t.call(this)||this;return e._uniqueBehaviorInstance=null,e._behavior=new Yt(ir),e.onBehaviorPinsChanged=e.onBehaviorPinsChanged.bind(e),e.onBehaviorInlineVariableChanged=e.onBehaviorInlineVariableChanged.bind(e),e.onBehaviorChanged=e.onBehaviorChanged.bind(e),e._behavior.assetChanged.attach(e.onBehaviorChanged),e}return Sn(BehaviorOperator,t),Object.defineProperty(BehaviorOperator.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(BehaviorOperator.prototype,"behavior",{get:function(){return this._behavior.asset},set:function(t){this._behavior.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(BehaviorOperator.prototype,"customPins",{get:function(){return this._customPins},enumerable:!0,configurable:!0}),BehaviorOperator.prototype.destroy=function(){var e=this.behavior;e&&e.inlineVariableChanged.detach(this.onBehaviorInlineVariableChanged),this._behavior.detach(),this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.destroy(),this._uniqueBehaviorInstance=null),t.prototype.destroy.call(this)},BehaviorOperator.prototype.isLoaded=function(){return w.isAssetRefLoaded(this._behavior)},BehaviorOperator.prototype.onStart=function(){return this._uniqueBehaviorInstance?this._uniqueBehaviorInstance.sendSignal(this._uniqueBehaviorInstance.id,nn.startPinId):(this._uniqueBehaviorInstance=this.behavior.copy(!0),this._uniqueBehaviorInstance.ownerComponent=this.ownerBehavior.ownerComponent,this._uniqueBehaviorInstance.customPins=this._customPins,this._uniqueBehaviorInstance.start()),this.checkIfBehaviorFinished()},BehaviorOperator.prototype.onUpdate=function(){return this._uniqueBehaviorInstance.update(),this.checkIfBehaviorFinished()},BehaviorOperator.prototype.onSignalReceived=function(t){if(this._uniqueBehaviorInstance){var e=this._uniqueBehaviorInstance.activeOperators.length>0;this._uniqueBehaviorInstance.sendSignal(this._uniqueBehaviorInstance.id,t),this._uniqueBehaviorInstance.activeOperators.length>0&&!e&&this.ownerBehavior.activateOperator(this)}},BehaviorOperator.prototype.onCollision=function(t){this._uniqueBehaviorInstance&&this._uniqueBehaviorInstance.onCollision(t)},BehaviorOperator.prototype.onUIEvent=function(t){return!!this._uniqueBehaviorInstance&&this._uniqueBehaviorInstance.onUIEvent(t)},BehaviorOperator.prototype.onBehaviorPinsChanged=function(){this.behavior&&(this._customPins=this.behavior.customPins.copy())},BehaviorOperator.prototype.findPin=function(e){var n=t.prototype.findPin.call(this,e);if(!n){var r=this._customPins?this._customPins.data.find(function(t){return t.instance.id===e}):void 0;n=r?r.instance:void 0}return n},BehaviorOperator.prototype.filterPins=function(e){return t.prototype.filterPins.call(this,e).concat(this._customPins.data.filter(function(t){return e(t.instance)}).map(function(t){return t.instance}))},BehaviorOperator.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_behavior:t.properties.behavior}),delete t.properties.behavior),t},BehaviorOperator.prototype.checkIfBehaviorFinished=function(){var t=this._uniqueBehaviorInstance;return 0===t.activeOperators.length?(t.fetchInputData(t.id),$e.Finish):$e.Continue},BehaviorOperator.prototype.onBehaviorInlineVariableChanged=function(t){if(this._uniqueBehaviorInstance){var e=this.behavior.inlineVariables.data.find(function(e){return e.id===t});e&&this._uniqueBehaviorInstance.updateInlineVariable(t,e)}},BehaviorOperator.prototype.onBehaviorChanged=function(t){this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.destroy(),this._uniqueBehaviorInstance=null);var e=t.newAsset;e&&(this._customPins=e.customPins.copy())},jn([unserializable(),Rn("design:type",Object)],BehaviorOperator.prototype,"_uniqueBehaviorInstance",void 0),jn([unserializable(),Rn("design:type",Ot)],BehaviorOperator.prototype,"_customPins",void 0),BehaviorOperator}(hn),En=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Bn=function(t){function InlineVariable(){var e=t.call(this)||this;return e.data=new l(ye),e.position=new $,e.id=w.makeUniqueId(),e}return En(InlineVariable,t),InlineVariable}(_),An=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),In=function(t){function Converter(){return null!==t&&t.apply(this,arguments)||this}return An(Converter,t),Converter.prototype.convert=function(){},Converter}(sn),Mn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),zn=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},kn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Dn=function(t){function Collision(){var e=t.call(this)||this;return e.createPin("_collision",ae.Output,me),e.createPin("_collisionInfo",ae.Output,Qe),e}return Mn(Collision,t),Collision.prototype.onCollision=function(t){this._collisionInfo.setData(t),this.sendSignal(this._collision.name)},zn([unserializable(),kn("design:type",me)],Collision.prototype,"_collision",void 0),zn([unserializable(),kn("design:type",Qe)],Collision.prototype,"_collisionInfo",void 0),Collision}(sn),Fn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Ln=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Nn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Vn=function(t){function UIEvents(){var e=t.call(this)||this;return e.createPin("_stopPropagation",ae.Input,Ne),e.createPin("_click",ae.Output,me),e.createPin("_touchDown",ae.Output,me),e.createPin("_touchMove",ae.Output,me),e.createPin("_touchUp",ae.Output,me),e.createPin("_longPress",ae.Output,me),e.createPin("_target",ae.Output,Ke),e.createPin("_touchPos",ae.Output,Ve),e}return Fn(UIEvents,t),Object.defineProperty(UIEvents.prototype,"stopPropagation",{get:function(){return this._stopPropagation.getData()},enumerable:!0,configurable:!0}),Ln([unserializable(),Nn("design:type",me)],UIEvents.prototype,"_touchDown",void 0),Ln([unserializable(),Nn("design:type",me)],UIEvents.prototype,"_click",void 0),Ln([unserializable(),Nn("design:type",me)],UIEvents.prototype,"_touchMove",void 0),Ln([unserializable(),Nn("design:type",me)],UIEvents.prototype,"_touchUp",void 0),Ln([unserializable(),Nn("design:type",me)],UIEvents.prototype,"_touchEnter",void 0),Ln([unserializable(),Nn("design:type",me)],UIEvents.prototype,"_touchLeave",void 0),Ln([unserializable(),Nn("design:type",me)],UIEvents.prototype,"_longPress",void 0),Ln([unserializable(),Nn("design:type",Ke)],UIEvents.prototype,"_target",void 0),Ln([unserializable(),Nn("design:type",Ve)],UIEvents.prototype,"_touchPos",void 0),Ln([unserializable(),Nn("design:type",Ne)],UIEvents.prototype,"_stopPropagation",void 0),UIEvents=Ln([displayName("UI Events"),Nn("design:paramtypes",[])],UIEvents)}(sn),Un=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Wn=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},qn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Gn=function(t){function CodeBlockConverter(){var e=t.call(this)||this;return e._code="\nfunction convert() {                \n}\n",e}return Un(CodeBlockConverter,t),CodeBlockConverter=Wn([displayName("Converter"),qn("design:paramtypes",[])],CodeBlockConverter)}(wn),Hn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Kn=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Xn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Qn=function(t){function CodeBlockConverterInstance(){var e=t.call(this)||this;return e._stateInitialized=!1,e._codeBlock=new Yt(Gn),e.sendSignal=e.sendSignal.bind(e),e.onCodeBlockPinsChanged=e.onCodeBlockPinsChanged.bind(e),e.onCodeBlockChanged=e.onCodeBlockChanged.bind(e),e._codeBlock.assetChanged.attach(e.onCodeBlockChanged),e}return Hn(CodeBlockConverterInstance,t),Object.defineProperty(CodeBlockConverterInstance.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlockConverterInstance.prototype,"codeBlock",{get:function(){return this._codeBlock.asset},set:function(t){this._codeBlock.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlockConverterInstance.prototype,"customPins",{get:function(){return this._customPins},enumerable:!0,configurable:!0}),CodeBlockConverterInstance.prototype.destroy=function(){if(this._stateInitialized){this.executeFunction("onDestroy");for(var e=0,n=Object.keys(this._stateVariables);e<n.length;e++){var r=n[e],i=this._stateVariables[r].value;i&&i.constructor&&"VertexBuffer"===i.constructor.name&&i.unload(ht.context)}}this._codeBlock.asset&&this._codeBlock.asset.pinChanged.detach(this.onCodeBlockPinsChanged),this._codeBlock.detach(),t.prototype.destroy.call(this)},CodeBlockConverterInstance.prototype.isLoaded=function(){return w.isAssetRefLoaded(this._codeBlock)},CodeBlockConverterInstance.prototype.convert=function(){this.codeBlock.runtimeError||this.executeFunction("convert")},CodeBlockConverterInstance.prototype.onSignalReceived=function(t){this.codeBlock.runtimeError||this.executeFunction("onSignalReceived",t)},CodeBlockConverterInstance.prototype.onCodeBlockPinsChanged=function(){this.codeBlock&&(this._customPins=this.codeBlock.pins.copy())},CodeBlockConverterInstance.prototype.findPin=function(e){var n=t.prototype.findPin.call(this,e);if(!n){var r=this._customPins?this._customPins.data.find(function(t){return t.instance.id===e}):void 0;n=r?r.instance:void 0}return n},CodeBlockConverterInstance.prototype.filterPins=function(e){return t.prototype.filterPins.call(this,e).concat(this._customPins.data.filter(function(t){return e(t.instance)}).map(function(t){return t.instance}))},CodeBlockConverterInstance.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_codeBlock:t.properties.codeBlock}),delete t.properties.codeBlock),t},CodeBlockConverterInstance.prototype.executeFunction=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=this.codeBlock;try{var i=t+"_"+mn.trimId(r.id);return i in window?(this.initializeStateIfNecessary(),window[i].apply(window,[this._stateVariables,Kc.api,en.createObject,this.sendSignal].concat(e))):void 0}catch(t){r.logRuntimeError("Runtime Error: '"+t.stack+"'")}},CodeBlockConverterInstance.prototype.onCodeBlockChanged=function(t){var e=t.oldAsset;e&&e.pinChanged.detach(this.onCodeBlockPinsChanged);var n=t.newAsset;n&&(this._customPins=n.pins.copy(),this._stateInitialized=!1,n.pinChanged.attach(this.onCodeBlockPinsChanged))},CodeBlockConverterInstance.prototype.initializeStateIfNecessary=function(){this._stateInitialized||(this._stateVariables=Qc.initializeCodeBlockInstanceState(this.codeBlock,this.ownerBehavior.ownerComponent.entity,this._customPins,this.sendSignal),this._stateInitialized=!0)},Kn([unserializable(),Xn("design:type",Ot)],CodeBlockConverterInstance.prototype,"_customPins",void 0),Kn([unserializable(),Xn("design:type",Object)],CodeBlockConverterInstance.prototype,"_stateVariables",void 0),Kn([unserializable(),Xn("design:type",Object)],CodeBlockConverterInstance.prototype,"_stateInitialized",void 0),CodeBlockConverterInstance}(In),Yn=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Zn=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Jn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Signal=0]="Signal",t[t.Data=1]="Data"}(bn||(bn={}));var $n=function(t){function Connection(e,n,r){var i=t.call(this)||this;return i.src=e||new de,i.dest=n||new de,i.type=r||bn.Signal,i.id=w.makeUniqueId(),i}return Yn(Connection,t),Zn([unserializable(),Jn("design:type",String)],Connection.prototype,"id",void 0),Connection}(_),tr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),er=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},nr=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},rr=void 0;var ir=function(t){function Behavior(){var e=t.call(this)||this;return e.inputsPosition=new $,e.outputsPosition=new $(150,150),e.pinChanged=new S.VoidAsyncEvent,e.inlineVariableChanged=new S.AsyncEvent,e._operators=new Ot(sn),e._customPins=new Ot(ye),e._connections=new xt($n),e._inlineVariables=new xt(Bn),e._pins=new Ot(ye),e._activeOperators=[],e._finishedOperators=[],e._pins.grow(new me(nn.startPinId,ae.Input)),e}var e;return tr(Behavior,t),e=Behavior,Object.defineProperty(Behavior.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"operators",{get:function(){return this._operators.data},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"connections",{get:function(){return this._connections.data},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"pins",{get:function(){return this._pins},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"customPins",{get:function(){return this._customPins},set:function(t){this._customPins=t},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"inlineVariables",{get:function(){return this._inlineVariables},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"activeOperators",{get:function(){return this._activeOperators},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"ownerComponent",{get:function(){return this._ownerComponent},set:function(t){this._ownerComponent=t},enumerable:!0,configurable:!0}),Behavior.isConnectionValid=function(t,e,n){if(e.operatorId!==n.operatorId){var r=t.findPin(e.operatorId,e.pinId),i=t.findPin(n.operatorId,n.pinId);if(r&&i){var o=t.id;if(e.operatorId===o||n.operatorId===o){if(r.type===i.type)return Qc.pinsHaveSameType(r,i)}else if(r.type!==i.type)return Qc.pinsHaveSameType(r,i)}}return!1},Behavior.prototype.sendSignal=function(t,e){var n=this._signalConnectionMap[t];if(Boolean(n)){var r=n[e];if(Boolean(r))for(var i=0,o=r;i<o.length;i++){var a=o[i],s=this.findOperator(a.operatorId);s&&(this.fetchInputData(s.id),this.activateInputPin(s,a.pinId))}}},Behavior.prototype.fetchInputData=function(t){var e=this._dataConnectionMap[t];if(e)for(var n=0,r=Object.keys(e);n<r.length;n++){var i=r[n],o=e[i],a=void 0,s=void 0;if(o.operatorId===this.id)a=this.findBehaviorPin(o.pinId);else{var c=this.findOperator(o.operatorId);c?(a=c.findPin(o.pinId),c.isA(In)&&(s=c)):a=this.findVariablePin(o.operatorId)}if(a)if(a.isA(ve)){var u=o.operatorId===this.id?ae.Input:ae.Output;if(a.type!==u)k.log("Trying to get data from an input pin "+a.name);else{s&&(this.fetchInputData(s.id),s.convert(),this.checkCodeBlockError(s));var l=a.getData(),p=this.findPin(t,i);if(p)if(p.isA(ve)){var h=t===this.id?ae.Output:ae.Input;p.type!==h?k.log("Trying to set data on an output pin "+p.name):p.setData(l)}else k.log("Trying to set data on a signal pin "+p.name)}}else k.log("Trying to get data from a signal pin "+a.name)}},Behavior.prototype.activateOperator=function(t){this._activeOperators.indexOf(t)>=0||this._activeOperators.push(t)},Behavior.prototype.setProperty=function(e,n){if(t.prototype.setProperty.call(this,e,n),"_operators"===e)for(var r=0,i=this._operators.data;r<i.length;r++){var o=i[r];o.instance&&(o.instance.ownerBehavior=this)}},Behavior.prototype.isLoaded=function(){for(var t=0,e=this._operators.data;t<e.length;t++){if(!e[t].instance.isLoaded())return!1}for(var n=0,r=this._inlineVariables.data;n<r.length;n++){var i=r[n];if(!Qc.isPinLoaded(i.data.instance))return!1}return!0},Behavior.prototype.start=function(){this.buildConnectionMaps();for(var t=0,e=this._operators.data;t<e.length;t++){var n=e[t].instance;this.fetchInputData(n.id),n.onBehaviorStarted()}var r=this._signalConnectionMap[this.id];if(Boolean(r)){var i=r[nn.startPinId];if(Boolean(i))for(var o=0,a=i;o<a.length;o++){var s=a[o];(n=this.findOperator(s.operatorId))&&this.activateInputPin(n,s.pinId)}}},Behavior.prototype.update=function(){this._finishedOperators.length=0;for(var t=0,e=this._activeOperators;t<e.length;t++){var n=e[t];this.fetchInputData(n.id);var r=n.onUpdate();this.checkCodeBlockError(n),r===$e.Finish&&this._finishedOperators.push(n)}if(this._finishedOperators.length>0)for(var i=0,o=this._finishedOperators;i<o.length;i++){n=o[i];var a=this._activeOperators.indexOf(n);console.assert(a>=0),this._activeOperators.splice(a,1),this.finishOperator(n)}},Behavior.prototype.addConnection=function(t){this._connections.grow(t)},Behavior.prototype.removeConnection=function(t){var e=this._connections.data.indexOf(t);return e>=0&&this._connections.data.splice(e,1),this.clearOrphanVariables()},Behavior.prototype.removeVariable=function(t){for(var e=0;e<this._connections.data.length;){var n=this._connections.data[e];n.src.operatorId===t.id||n.dest.operatorId===t.id?this._connections.data.splice(e,1):++e}for(e=0;e<this._inlineVariables.data.length;++e){if(this._inlineVariables.data[e].id===t.id){this._inlineVariables.data.splice(e,1);break}}},Behavior.prototype.removeNode=function(t){for(var e=[],n=0;n<this._connections.data.length;){var r=this._connections.data[n];r.src.operatorId===t.id||r.dest.operatorId===t.id?(e.push(r),this._connections.data.splice(n,1)):++n}for(n=0;n<this._operators.data.length;++n){var i=this._operators.data[n];if(i.instance&&i.instance===t){this._operators.data.splice(n,1);break}}return{removedConnections:e,removedVariables:this.clearOrphanVariables()}},Behavior.prototype.clearOrphanVariables=function(){for(var t=[],e=0;e<this._inlineVariables.data.length;){for(var n=0,r=this._inlineVariables.data[e],i=0,o=this._connections.data;i<o.length;i++){var a=o[i];a.src.operatorId!==r.id&&a.dest.operatorId!==r.id||++n}0===n?(this._inlineVariables.data.splice(e,1),t.push(r)):++e}return t},Behavior.prototype.addNode=function(t){this._operators.grow(t),t.ownerBehavior=this},Behavior.prototype.addVariable=function(t){this._inlineVariables.grow(t)},Behavior.prototype.findOperator=function(t){for(var e=0,n=this._operators.data;e<n.length;e++){var r=n[e];if(r.instance&&r.instance.id===t)return r.instance}},Behavior.prototype.findVariable=function(t){return this._inlineVariables.data.find(function(e){return e.id===t})},Behavior.prototype.findPin=function(t,e){if(t===this.id)return this.findBehaviorPin(e);var n=this.findOperator(t);return n?n.findPin(e):this.findVariablePin(t)},Behavior.prototype.copy=function(e){var n=this.id,r=t.prototype.copy.call(this);if(!0!==e)for(var i=r.id,o=0,a=r._connections.data;o<a.length;o++){var s=a[o];s.src.operatorId===n?s.src.operatorId=i:s.dest.operatorId===n&&(s.dest.operatorId=i)}else r.id=n;return r},Behavior.prototype.deserialize=function(e){return t.prototype.deserialize.call(this,e)},Behavior.prototype.updateInlineVariable=function(t,e){var n=this._inlineVariables.data.find(function(e){return e.id===t});if(n){var r=n.data.instance,i=e.data.instance;r.setData(i.getData())}},Behavior.prototype.destroy=function(){for(var e=0,n=this._operators.data;e<n.length;e++){n[e].instance.destroy()}t.prototype.destroy.call(this)},Behavior.prototype.onCollision=function(t){for(var e=0,n=this._operators.data;e<n.length;e++){var r=n[e].instance;r.isA(Dn)?r.onCollision(t):r.isA(Tn)&&r.onCollision(t)}},Behavior.prototype.onUIEvent=function(t){for(var e=!1,n=0,r=this._operators.data;n<r.length;n++){var i=r[n].instance;if(i.isA(Vn)){if(t(i)){e=!0;break}}else if(i.isA(Tn)){if(i.onUIEvent(t)){e=!0;break}}}return e},Behavior.prototype.upgrade=function(t,e){if(1===e)for(var n=0,r=t.properties._operators.data;n<r.length;n++){var i=r[n];"ScreenToWorldRay"===i.data.typeName&&(i.data.typeName="ScreenToRay")}return t},Behavior.prototype.startOperator=function(t){var e=t.onStart();this.checkCodeBlockError(t),e===$e.Continue?this.activateOperator(t):this.finishOperator(t)},Behavior.prototype.finishOperator=function(t){t.onFinish(),this.sendSignal(t.id,nn.finishPinId)},Behavior.prototype.checkCodeBlockError=function(t){},Behavior.prototype.activateInputPin=function(t,e){if(e===nn.startPinId)this.startOperator(t);else{var n=t.findPin(e);n&&(t.onSignalReceived(n.name),this.checkCodeBlockError(t))}},Behavior.prototype.buildConnectionMaps=function(){var t,n,r,i,o,a;this._signalConnectionMap={},this._dataConnectionMap={};for(var s=0,c=this._connections.data;s<c.length;s++){var u=c[s];if(e.isConnectionValid(this,u.src,u.dest))if(u.type===bn.Signal){var l=u.src.operatorId,p=u.src.pinId,h={operatorId:u.dest.operatorId,pinId:u.dest.pinId};l in this._signalConnectionMap?p in this._signalConnectionMap[l]?this._signalConnectionMap[l][p].push(h):Object.assign(this._signalConnectionMap[l],((t={})[p]=[h],t)):Object.assign(this._signalConnectionMap,((n={})[l]=((r={})[p]=[h],r),n))}else{var f=u.dest.operatorId,d=u.dest.pinId,y={operatorId:u.src.operatorId,pinId:u.src.pinId};f in this._dataConnectionMap?d in this._dataConnectionMap[f]?this._dataConnectionMap[f][d]=y:Object.assign(this._dataConnectionMap[f],((i={})[d]=y,i)):Object.assign(this._dataConnectionMap,((o={})[f]=((a={})[d]=y,a),o))}}},Behavior.prototype.findBehaviorPin=function(t){var e=this._pins.data.find(function(e){return!!e.instance&&e.instance.id===t});return e||(e=this._customPins.data.find(function(e){return!!e.instance&&e.instance.id===t})),e?e.instance:void 0},Behavior.prototype.findVariablePin=function(t){var e=this.findVariable(t);return e?e.data.instance:void 0},Behavior.prototype.recordSignalFired=function(t,e,n,r){var i={timeStamp:Date.now(),entityId:this._ownerComponent.entity.id,behaviorPath:this.templatePath,srcOperatorId:t,srcPinId:e,destOperatorId:n,destPinId:r};localStorage.setItem("secondary_editor_signal_fired",JSON.stringify(i)),rr.signalFired.post(i)},er([unserializable(),nr("design:type",Object)],Behavior.prototype,"pinChanged",void 0),er([unserializable(),nr("design:type",Object)],Behavior.prototype,"inlineVariableChanged",void 0),er([unserializable(),nr("design:type",Object)],Behavior.prototype,"_pins",void 0),er([unserializable(),nr("design:type",Object)],Behavior.prototype,"_signalConnectionMap",void 0),er([unserializable(),nr("design:type",Object)],Behavior.prototype,"_dataConnectionMap",void 0),er([unserializable(),nr("design:type",Object)],Behavior.prototype,"_ownerComponent",void 0),er([unserializable(),nr("design:type",Array)],Behavior.prototype,"_activeOperators",void 0),er([unserializable(),nr("design:type",Array)],Behavior.prototype,"_finishedOperators",void 0),Behavior=e=er([hasDedicatedEditor(!0),nr("design:paramtypes",[])],Behavior)}(A),or=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ar=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},sr=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},cr=void 0;var ur,lr,pr,hr=function(t){function BehaviorComponent(){var e=t.call(this)||this;return e.autoStart=!0,e._customPins=new Ot(ye),e._uniqueBehaviorInstance=null,e._behavior=new Yt(ir),e.onBehaviorPinChanged=e.onBehaviorPinChanged.bind(e),e.onBehaviorInlineVariableChanged=e.onBehaviorInlineVariableChanged.bind(e),e.onBehaviorChanged=e.onBehaviorChanged.bind(e),e._behavior.assetChanged.attach(e.onBehaviorChanged),e}return or(BehaviorComponent,t),Object.defineProperty(BehaviorComponent.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(BehaviorComponent.prototype,"behavior",{get:function(){return this._behavior.asset},set:function(t){this._behavior.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(BehaviorComponent.prototype,"customPins",{get:function(){return this._customPins},enumerable:!0,configurable:!0}),Object.defineProperty(BehaviorComponent.prototype,"activeOperators",{get:function(){return this.behavior?this.behavior.activeOperators:[]},enumerable:!0,configurable:!0}),BehaviorComponent.prototype.isLoaded=function(){if(!t.prototype.isLoaded.call(this))return!1;if(this._customPins)for(var e=0,n=this._customPins.data;e<n.length;e++){var r=n[e];if(!Qc.isPinLoaded(r.instance))return!1}return w.isAssetRefLoaded(this._behavior)},BehaviorComponent.prototype.destroy=function(){var e=this.behavior;e&&(e.pinChanged.detach(this.onBehaviorPinChanged),e.inlineVariableChanged.detach(this.onBehaviorInlineVariableChanged)),this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.destroy(),this._uniqueBehaviorInstance=null),this._behavior.detach(),t.prototype.destroy.call(this)},BehaviorComponent.prototype.start=function(){var t=this.behavior;t&&(this._uniqueBehaviorInstance?this._uniqueBehaviorInstance.sendSignal(this._uniqueBehaviorInstance.id,nn.startPinId):(this._uniqueBehaviorInstance=t.copy(!0),this._uniqueBehaviorInstance.ownerComponent=this,this._customPins?this._uniqueBehaviorInstance.customPins=this._customPins:k.logWarning("BehaviorComponent.start: undefined customPins"),this._uniqueBehaviorInstance.start()))},BehaviorComponent.prototype.update=function(){this.behavior&&(this._uniqueBehaviorInstance?this._uniqueBehaviorInstance.update():this.autoStart&&this.start())},BehaviorComponent.prototype.onCollision=function(t){this._uniqueBehaviorInstance&&this._uniqueBehaviorInstance.onCollision(t)},BehaviorComponent.prototype.onUIEvent=function(t){return!!this._uniqueBehaviorInstance&&this._uniqueBehaviorInstance.onUIEvent(t)},BehaviorComponent.prototype.sendSignal=function(t){this._uniqueBehaviorInstance||this.start();var e=this._uniqueBehaviorInstance,n=e.customPins.data.find(function(e){return e.instance.name===t});n?e.sendSignal(e.id,n.instance.id):k.logWarning("Could not fire signal '"+t+"' (pin not found)")},BehaviorComponent.prototype.getPins=function(){return this._customPins},BehaviorComponent.prototype.setPins=function(t){this._customPins=t},BehaviorComponent.prototype.findPinByName=function(t){for(var e=0,n=this._customPins.data;e<n.length;e++){var r=n[e].instance;if(r.name===t)return r}},BehaviorComponent.prototype.upgrade=function(t,e){if(1===e)Object.assign(t.properties,{_behavior:t.properties.behavior}),delete t.properties.behavior;else if(2===e){var n=t.properties._customPins,r=t.properties._behavior;delete t.properties._customPins,delete t.properties._behavior,t.properties._customPins=n.data,t.properties._behavior=r}return t},BehaviorComponent.prototype.onBehaviorChanged=function(t){this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.destroy(),this._uniqueBehaviorInstance=null);var e=t.newAsset;e&&this.buildCustomPins(e)},BehaviorComponent.prototype.buildCustomPins=function(t){for(var e=new Ot(ye),n=[],r=function(t){var r=t.instance;if(r){var o=void 0;if(i._customPins){var a=i._customPins.data.find(function(t){return t.instance.id===r.id}),s=a?a.instance:void 0;s&&s.type===r.type&&Qc.pinsHaveSameType(s,r)&&((o=s).name=r.name)}o?e.grow(o):(e.grow(r.copy()),n.push(r.id))}},i=this,o=0,a=t.customPins.data;o<a.length;o++){r(a[o])}return this._customPins=e,Qc.updatePinAccessors(this),n},BehaviorComponent.prototype.onBehaviorPinChanged=function(){var t=this.behavior,e=this.buildCustomPins(t);this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.customPins=this._customPins),cr&&cr.behaviorComponentPinsChanged.post({ownerId:t.id,pinIds:e})},BehaviorComponent.prototype.onBehaviorInlineVariableChanged=function(t){if(this._uniqueBehaviorInstance){var e=this.behavior.inlineVariables.data.find(function(e){return e.id===t});e&&this._uniqueBehaviorInstance.updateInlineVariable(t,e)}},ar([Attributes_hidden(),sr("design:type",Object)],BehaviorComponent.prototype,"_customPins",void 0),ar([unserializable(),sr("design:type",Object)],BehaviorComponent.prototype,"_uniqueBehaviorInstance",void 0),BehaviorComponent=ar([helpUrl("https://docs.spiderengine.io/behavior.html"),sr("design:paramtypes",[])],BehaviorComponent)}(Et);!function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right",t[t.Stretch=3]="Stretch"}(ur||(ur={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Bottom=2]="Bottom",t[t.Stretch=3]="Stretch"}(lr||(lr={})),function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(pr||(pr={}));var fr,dr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),yr=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},mr=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},vr=function(t){function Layout(){var e=null!==t&&t.apply(this,arguments)||this;return e._horizontalAlignment=ur.Left,e._verticalAlignment=lr.Top,e._pivot=new $,e._offset=new V,e._width=new lt,e._height=new lt,e._margin=new bt,e._rotation=new it,e._scale=new $(1,1),e._tint=new H(1,1,1,1),e._inheritTint=!0,e._worldMatrix=new nt,e._actualWidth=0,e._actualHeight=0,e._finalTint=new H(1,1,1,1),e}return dr(Layout,t),Object.defineProperty(Layout.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"offset",{get:function(){return this._offset},set:function(t){this._offset.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"pivot",{get:function(){return this._pivot},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"horizontalAlignment",{get:function(){return this._horizontalAlignment},set:function(t){this._horizontalAlignment=t},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"verticalAlignment",{get:function(){return this._verticalAlignment},set:function(t){this._verticalAlignment=t},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"margin",{get:function(){return this._margin},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"inheritTint",{get:function(){return this._inheritTint},set:function(t){this._inheritTint=t},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"actualWidth",{get:function(){return this._actualWidth},set:function(t){this._actualWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"actualHeight",{get:function(){return this._actualHeight},set:function(t){this._actualHeight=t},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"worldMatrix",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"finalTint",{get:function(){return this._finalTint},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"right",{get:function(){return this._worldMatrix.decompose(V.dummy,it.dummy,V.dummy),V.fromPool().copy(V.right).rotate(it.dummy).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"forward",{get:function(){return this._worldMatrix.decompose(V.dummy,it.dummy,V.dummy),V.fromPool().copy(V.forward).rotate(it.dummy).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"up",{get:function(){return this._worldMatrix.decompose(V.dummy,it.dummy,V.dummy),V.fromPool().copy(V.up).rotate(it.dummy).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"localRight",{get:function(){return V.fromPool().copy(V.right).rotate(this.rotation).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"localForward",{get:function(){return V.fromPool().copy(V.forward).rotate(this.rotation).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"localUp",{get:function(){return V.fromPool().copy(V.up).rotate(this.rotation).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"absoluteScale",{get:function(){return this.worldMatrix.getScale(V.fromPool())},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"absolutePos",{get:function(){return V.fromPool().setFromMatrix(this.worldMatrix)},enumerable:!0,configurable:!0}),Layout.prototype.upgrade=function(t,e){return 1===e?(t.properties.offset=t.properties.position,delete t.properties.position):2===e&&(Object.assign(t.properties,{_horizontalAlignment:t.properties.horizontalAlignment,_verticalAlignment:t.properties.verticalAlignment,_pivot:t.properties.pivot,_offset:t.properties.offset,_width:t.properties.width,_height:t.properties.height,_margin:t.properties.margin,_rotation:t.properties.rotation,_scale:t.properties.scale}),delete t.properties.horizontalAlignment,delete t.properties.verticalAlignment,delete t.properties.pivot,delete t.properties.offset,delete t.properties.width,delete t.properties.height,delete t.properties.margin,delete t.properties.rotation,delete t.properties.scale),t},Layout.horizontalAlignmentPropertyKey="_horizontalAlignment",Layout.verticalAlignmentPropertyKey="_verticalAlignment",Layout.rotationKey="_rotation",Layout.offsetKey="_offset",Layout.scaleKey="_scale",yr([Attributes_enumLiterals(ur),mr("design:type",Object)],Layout.prototype,"_horizontalAlignment",void 0),yr([Attributes_enumLiterals(lr),mr("design:type",Object)],Layout.prototype,"_verticalAlignment",void 0),yr([unserializable(),mr("design:type",Object)],Layout.prototype,"_worldMatrix",void 0),yr([unserializable(),mr("design:type",Object)],Layout.prototype,"_actualWidth",void 0),yr([unserializable(),mr("design:type",Object)],Layout.prototype,"_actualHeight",void 0),yr([unserializable(),mr("design:type",Object)],Layout.prototype,"_finalTint",void 0),Layout=yr([mandatory(),sortOrder(0),helpUrl("https://docs.spiderengine.io/2d/layout.html")],Layout)}(Et),gr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),_r=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},br=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},wr=function(t){function Texture(){var e=null!==t&&t.apply(this,arguments)||this;return e._textureId=null,e}return gr(Texture,t),Object.defineProperty(Texture.prototype,"textureId",{get:function(){return this._textureId},enumerable:!0,configurable:!0}),Texture.prototype.getWidth=function(){return 0},Texture.prototype.getHeight=function(){return 0},Texture.prototype.begin=function(t){return!1},Texture.prototype.graphicUnload=function(){this._textureId&&(ht.context.deleteTexture(this._textureId),this._textureId=null)},_r([unserializable(),br("design:type",Object)],Texture.prototype,"_textureId",void 0),Texture}(L),xr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Pr=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Or=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Cr=void 0;(function(t){t[t.JPEG=0]="JPEG",t[t.PNG=1]="PNG"})(fr||(fr={}));var Sr;!function(){function TexturePublishFormatMetadata(){}TexturePublishFormatMetadata.literals={JPEG:0,PNG:1}}();(Sr||(Sr={})).textureDataPropertyKey="_textureData";var jr,Rr=function(t){function Texture2D(e){var n=t.call(this)||this;return n._filtering=o.Linear,n._repeat=!0,n._mipMaps=!0,n._publishFormat=fr.JPEG,n._textureDataLoaded=!1,e&&n.setState(e),n}return xr(Texture2D,t),Object.defineProperty(Texture2D.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(Texture2D.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),Object.defineProperty(Texture2D.prototype,"publishFormat",{get:function(){return this._publishFormat},set:function(t){this._publishFormat=t},enumerable:!0,configurable:!0}),Object.defineProperty(Texture2D.prototype,"textureData",{get:function(){return this._textureData},set:function(t){var e=this;this._textureId&&this.graphicUnload(),this._textureDataLoaded=!1,this._textureData=t,delete this._canvas,delete this._pixels,this.loadTextureData(function(){Cr&&Cr.textureDataLoaded.post(e)})},enumerable:!0,configurable:!0}),Texture2D.prototype.getWidth=function(){return this._textureDataLoaded?this._image.width:0},Texture2D.prototype.getHeight=function(){return this._textureDataLoaded?this._image.height:0},Texture2D.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n),e===Sr.textureDataPropertyKey?this.textureData=n:this._textureId&&this.setupTexture()},Texture2D.prototype.isLoaded=function(){return this._textureDataLoaded},Texture2D.prototype.begin=function(t){if(!this._textureId){if(!this._textureDataLoaded)return!1;if(!this.graphicLoad())return!1}var e=ht.context;return e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),!0},Texture2D.prototype.loadTextureData=function(t){var e=this;this._textureDataLoaded?t():(this._image=new Image,this._image.onload=function(){e._textureDataLoaded=!0,t()},this._image.src=this._textureData)},Texture2D.prototype.graphicLoad=function(){return!!this._textureId||!!this.setupTexture()},Texture2D.prototype.getPixel=function(t,e,n){if(!this._canvas){this._canvas=document.createElement("canvas"),this._canvas.width=this._image.width,this._canvas.height=this._image.height;var r=this._canvas.getContext("2d");r&&(r.drawImage(this._image,0,0),this._pixels=r.getImageData(0,0,this._canvas.width,this._canvas.height).data)}var i=e*this._canvas.width*4+4*t;n.r=this._pixels[i+0],n.g=this._pixels[i+1],n.b=this._pixels[i+2],n.a=this._pixels[i+3]},Texture2D.prototype.upgrade=function(t,e){return 2===e&&(Object.assign(t.properties,{_mipMaps:t.properties._generateMipMaps}),delete t.properties._generateMipMaps),t},Texture2D.prototype.setupTexture=function(){if(console.assert(this.isLoaded()),!this.isLoaded())return k.logWarning("Trying to render with a texture that is not loaded yet '"+this.templatePath+"'"),!1;var t=ht.context;this._textureId||(this._textureId=t.createTexture()),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._textureId),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this._image),this._filtering===o.Nearest?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);var e=ht.version>1;if(e||(e=W.isPowerOf2(this._image.width)&&W.isPowerOf2(this._image.height)),e){var n=this._repeat?t.REPEAT:t.CLAMP_TO_EDGE;t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,n),this._mipMaps?(this._filtering===o.Nearest?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_LINEAR):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.generateMipmap(t.TEXTURE_2D)):this._filtering===o.Nearest?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)}else t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._filtering===o.Nearest?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR);return!0},Pr([Attributes_enumLiterals(o),Or("design:type",Object)],Texture2D.prototype,"_filtering",void 0),Pr([Attributes_enumLiterals(fr),Or("design:type",Object)],Texture2D.prototype,"_publishFormat",void 0),Pr([Attributes_hidden(),Or("design:type",String)],Texture2D.prototype,"_textureData",void 0),Pr([unserializable(),Or("design:type",Object)],Texture2D.prototype,"_textureDataLoaded",void 0),Pr([unserializable(),Or("design:type",HTMLImageElement)],Texture2D.prototype,"_image",void 0),Pr([unserializable(),Or("design:type",HTMLCanvasElement)],Texture2D.prototype,"_canvas",void 0),Pr([unserializable(),Or("design:type",Uint8ClampedArray)],Texture2D.prototype,"_pixels",void 0),Texture2D=Pr([displayName("Texture 2D"),referencable(!0),Or("design:paramtypes",[Object])],Texture2D)}(wr),Tr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Er=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Br=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Stretch=0]="Stretch",t[t.Tile=1]="Tile"}(jr||(jr={}));var Ar,Ir=function(t){function Sprite(){var e=null!==t&&t.apply(this,arguments)||this;return e.texture=new Yt(Rr),e.borderSize=new $,e.renderMode=jr.Stretch,e.borderMode=jr.Stretch,e}return Tr(Sprite,t),Sprite.prototype.destroy=function(){this.texture.detach(),t.prototype.destroy.call(this)},Sprite.prototype.isLoaded=function(){return w.isAssetRefLoaded(this.texture)},Sprite.prototype.tesselateInPixelsUnits=function(t,e,n,r,i){var o=this.texture.asset;o&&this.tesselateInternal(t,r,i,o.getWidth(),o.getHeight(),this.borderSize.x,this.borderSize.y,e,n)},Sprite.prototype.tesselateInWorldUnits=function(t){var e=this.texture.asset;e&&this.tesselateInternal(t,1,1,1,1,this.borderSize.x/e.getWidth(),this.borderSize.y/e.getHeight(),0,0)},Sprite.prototype.tesselateInternal=function(t,e,n,r,i,o,a,s,c){var u=8,l=0,p=0;if(this.renderMode===jr.Tile){var h=(e-2*o)/(x=r-2*o),f=Math.floor(h);p=f,h-f>0&&++p;var d=(n-2*a)/(P=i-2*a),y=Math.floor(d);l=y,d-y>0&&++l,p=Math.max(p,1),u+=(l=Math.max(l,1))*p}else u++;var m=6*u,v=t.attributes.position;v.length=3*m;var g=t.attributes.uv;g.length=2*m,t.vertexCount=m;var _=this.makeQuadPos(v,0,0,0,o,a,s,c);if(_=this.makeQuadPos(v,_,o,0,e-2*o,a,s,c),_=this.makeQuadPos(v,_,e-o,0,o,a,s,c),_=this.makeQuadPos(v,_,0,a,o,n-2*a,s,c),this.renderMode===jr.Tile)for(var b=o,w=a,x=r-2*o,P=i-2*a,O=0;O<l;++O){w+(R=P)>n-a&&(R=Math.max(n-a-w,0));for(var C=0;C<p;++C){b+(B=x)>e-o&&(B=Math.max(e-o-b,0)),_=this.makeQuadPos(v,_,b,w,B,R,s,c),b+=x}b=o,w+=P}else _=this.makeQuadPos(v,_,o,a,e-2*o,n-2*a,s,c);_=this.makeQuadPos(v,_,e-o,a,o,n-2*a,s,c),_=this.makeQuadPos(v,_,0,n-a,o,a,s,c),_=this.makeQuadPos(v,_,o,n-a,e-2*o,a,s,c),_=this.makeQuadPos(v,_,e-o,n-a,o,a,s,c),console.assert(_===3*t.vertexCount);var S=o/r,j=a/i;if(_=this.makeQuadUv(g,0,0,1,S,1-j),_=this.makeQuadUv(g,_,S,1,1-S,1-j),_=this.makeQuadUv(g,_,1-S,1,1,1-j),_=this.makeQuadUv(g,_,0,1-j,S,j),this.renderMode===jr.Tile)for(b=o,w=a,x=r-2*o,P=i-2*a,O=0;O<l;++O){var R,T=1-S,E=j;w+(R=P)>n-a&&(E+=(P-(R=n-a-w))/i);for(C=0;C<p;++C){var B;b+(B=x)>e-o&&(T-=(x-(B=e-o-b))/r),_=this.makeQuadUv(g,_,S,1-j,T,E),b+=x}b=o,w+=P}else _=this.makeQuadUv(g,_,S,1-j,1-S,j);_=this.makeQuadUv(g,_,1-S,1-j,1,j),_=this.makeQuadUv(g,_,0,j,S,0),_=this.makeQuadUv(g,_,S,j,1-S,0),_=this.makeQuadUv(g,_,1-S,j,1,0),console.assert(_===2*t.vertexCount),t.dirtifyAttribute("position"),t.dirtifyAttribute("uv")},Sprite.prototype.makeQuadPos=function(t,e,n,r,i,o,a,s){var c=n+a,u=n+i+a,l=r+s,p=r+o+s;return t[e+0]=c,t[e+1]=l,t[e+2]=0,t[e+3]=u,t[e+4]=l,t[e+5]=0,t[e+6]=c,t[e+7]=p,t[e+8]=0,t[e+9]=c,t[e+10]=p,t[e+11]=0,t[e+12]=u,t[e+13]=l,t[e+14]=0,t[e+15]=u,t[e+16]=p,t[e+17]=0,e+18},Sprite.prototype.makeQuadUv=function(t,e,n,r,i,o){return t[e+0]=n,t[e+1]=r,t[e+2]=i,t[e+3]=r,t[e+4]=n,t[e+5]=o,t[e+6]=n,t[e+7]=o,t[e+8]=i,t[e+9]=r,t[e+10]=i,t[e+11]=o,e+12},Er([Attributes_enumLiterals(jr),Br("design:type",Object)],Sprite.prototype,"renderMode",void 0),Er([Attributes_enumLiterals(jr),Br("design:type",Object)],Sprite.prototype,"borderMode",void 0),Sprite}(A),Mr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),zr=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};!function(t){(Ar||(Ar={})).countTiles=function countTiles(t,e){var n=t.getWidth()/Math.max(e.x,1);return t.getHeight()/Math.max(e.y,1)*n}}();var kr,Dr=function(t){function SpriteSheet(){var e=null!==t&&t.apply(this,arguments)||this;return e._texture=new Yt(Rr),e._tileSize=new $(32,32),e._tileCount=4,e}return Mr(SpriteSheet,t),Object.defineProperty(SpriteSheet.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheet.prototype,"texture",{get:function(){return this._texture.asset},set:function(t){this._texture.asset=t,t&&(this._tileCount=Ar.countTiles(t,this._tileSize))},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheet.prototype,"tileSize",{get:function(){return this._tileSize},set:function(t){this._tileSize.copy(t),this.texture&&(this._tileCount=Ar.countTiles(this.texture,this._tileSize))},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheet.prototype,"tileCount",{get:function(){return this._tileCount},enumerable:!0,configurable:!0}),SpriteSheet.prototype.isLoaded=function(){return w.isAssetRefLoaded(this._texture)},SpriteSheet.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_tileSize:t.properties.tileSize,_tileCount:t.properties.tileCount}),delete t.properties.tileSize,delete t.properties.tileCount),t},SpriteSheet=zr([displayName("Sprite Sheet")],SpriteSheet)}(A),Fr=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Lr=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Nr=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Vr=function(t){function UIFill(){return null!==t&&t.apply(this,arguments)||this}return Fr(UIFill,t),UIFill.prototype.isLoaded=function(){return!0},UIFill}(_),Ur=function(t){function MaterialFill(){var e=null!==t&&t.apply(this,arguments)||this;return e._material=new Yt(qu),e}return Fr(MaterialFill,t),Object.defineProperty(MaterialFill.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(MaterialFill.prototype,"material",{get:function(){return this._material.asset},set:function(t){this._material.asset=t},enumerable:!0,configurable:!0}),MaterialFill.prototype.isLoaded=function(){return w.isAssetRefLoaded(this._material)},MaterialFill.prototype.destroy=function(){this._material.detach(),t.prototype.destroy.call(this)},MaterialFill.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_material:t.properties.material}),delete t.properties.material),t},MaterialFill=Lr([displayName("Material")],MaterialFill)}(Vr),Wr=function(t){function SpriteFill(e){var n=t.call(this)||this;return n.sprite=new Yt(Ir),n._color=new H(1,1,1,1),n._isDirty=!0,n._width=0,n._height=0,n._offsetX=0,n._offsetY=0,n._renderMode=jr.Stretch,n._borderMode=jr.Stretch,e&&(n.sprite.asset=e),n}return Fr(SpriteFill,t),Object.defineProperty(SpriteFill.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteFill.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),SpriteFill.prototype.isLoaded=function(){return w.isAssetRefLoaded(this.sprite)},SpriteFill.prototype.destroy=function(){this._vertexBuffer&&this._vertexBuffer.unload(ht.context),this.sprite.detach(),t.prototype.destroy.call(this)},SpriteFill.prototype.tesselate=function(t){this._vertexBuffer||(this._vertexBuffer=new _t,this._vertexBuffer.isDynamic=!0,this._vertexBuffer.primitiveType="TRIANGLES",this._vertexBuffer.setAttribute("position",[]),this._vertexBuffer.setAttribute("uv",[])),t.actualWidth!==this._width&&(this._width=t.actualWidth,this._isDirty=!0),t.actualHeight!==this._height&&(this._height=t.actualHeight,this._isDirty=!0);var e=-t.pivot.x*t.actualWidth,n=-t.pivot.y*t.actualHeight;e!==this._offsetX&&(this._offsetX=e,this._isDirty=!0),n!==this._offsetY&&(this._offsetY=n,this._isDirty=!0);var r=this.sprite.asset,i=r?r.texture.asset:null;return r&&i&&(r.renderMode!==this._renderMode&&(this._renderMode=r.renderMode,this._isDirty=!0),r.borderMode!==this._borderMode&&(this._borderMode=r.borderMode,this._isDirty=!0),r.texture.id!==this._textureId&&(this._textureId=r.texture.id,this._isDirty=!0),this._isDirty&&(r.tesselateInPixelsUnits(this._vertexBuffer,e,n,t.actualWidth,t.actualHeight),this._isDirty=!1)),this._vertexBuffer},SpriteFill.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_color:t.properties.tint}),delete t.properties.tint),t},Lr([unserializable(),Nr("design:type",_t)],SpriteFill.prototype,"_vertexBuffer",void 0),Lr([unserializable(),Nr("design:type",Object)],SpriteFill.prototype,"_isDirty",void 0),Lr([unserializable(),Nr("design:type",Object)],SpriteFill.prototype,"_width",void 0),Lr([unserializable(),Nr("design:type",Object)],SpriteFill.prototype,"_height",void 0),Lr([unserializable(),Nr("design:type",Object)],SpriteFill.prototype,"_offsetX",void 0),Lr([unserializable(),Nr("design:type",Object)],SpriteFill.prototype,"_offsetY",void 0),Lr([unserializable(),Nr("design:type",Object)],SpriteFill.prototype,"_renderMode",void 0),Lr([unserializable(),Nr("design:type",Object)],SpriteFill.prototype,"_borderMode",void 0),Lr([unserializable(),Nr("design:type",Object)],SpriteFill.prototype,"_textureId",void 0),SpriteFill=Lr([displayName("Sprite"),Nr("design:paramtypes",[Ir])],SpriteFill)}(Vr),qr=function(t){function TextureFill(e,n){var r=t.call(this)||this;return r._color=new H(1,1,1,1),r._texture=new Yt(wr),e&&(r.texture=e),n&&r._color.copy(n),r}return Fr(TextureFill,t),Object.defineProperty(TextureFill.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(TextureFill.prototype,"texture",{get:function(){return this._texture.asset},set:function(t){this._texture.setAssetFast(t)},enumerable:!0,configurable:!0}),Object.defineProperty(TextureFill.prototype,"textureRef",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(TextureFill.prototype,"color",{get:function(){return this._color},set:function(t){this._color.copy(t)},enumerable:!0,configurable:!0}),TextureFill.prototype.isLoaded=function(){return w.isAssetRefLoaded(this._texture)},TextureFill.prototype.destroy=function(){this._texture.detach(),t.prototype.destroy.call(this)},TextureFill.prototype.upgrade=function(t,e){return 1===e?(Object.assign(t.properties,{_texture:t.properties.texture}),delete t.properties.texture):2===e&&(Object.assign(t.properties,{_color:t.properties.tint}),delete t.properties.tint),t},TextureFill=Lr([displayName("Texture"),Nr("design:paramtypes",[wr,H])],TextureFill)}(Vr),Gr=function(t){function ColorFill(e){var n=t.call(this)||this;return n.color=new H(1,1,1,1),e&&n.color.copy(e),n}return Fr(ColorFill,t),ColorFill=Lr([displayName("Color"),Nr("design:paramtypes",[H])],ColorFill)}(Vr),Hr=function(t){function SpriteSheetFill(e){var n=t.call(this)||this;return n._color=new H(1,1,1,1),n._spriteSheet=new Yt(Dr),n._currentTile=0,n._isDirty=!0,n._offsetX=0,n._offsetY=0,n._currentTesselatedTile=0,e&&(n._spriteSheet.asset=e),n}return Fr(SpriteSheetFill,t),Object.defineProperty(SpriteSheetFill.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"texture",{get:function(){return this._spriteSheet.asset?this._spriteSheet.asset.texture:null},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"tileSize",{get:function(){return this._spriteSheet.asset?this._spriteSheet.asset.tileSize:$.zero},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"currentTile",{get:function(){return this._currentTile},set:function(t){this._currentTile=t},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"spriteSheet",{get:function(){return this._spriteSheet.asset},set:function(t){this._spriteSheet.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),SpriteSheetFill.prototype.isLoaded=function(){return w.isAssetRefLoaded(this._spriteSheet)},SpriteSheetFill.prototype.destroy=function(){this._vertexBuffer&&this._vertexBuffer.unload(ht.context),this._spriteSheet.detach(),t.prototype.destroy.call(this)},SpriteSheetFill.prototype.tesselate=function(t){this._vertexBuffer||(this._vertexBuffer=new _t,this._vertexBuffer.isDynamic=!0,this._vertexBuffer.setAttribute("position",[0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,1,1,0]),this._vertexBuffer.setAttribute("uv",[0,1,1,1,0,0,0,0,1,1,1,0]),this._vertexBuffer.primitiveType="TRIANGLES");var e=this.texture;if(e){var n=-t.pivot.x*t.actualWidth,r=-t.pivot.y*t.actualHeight;if(n!==this._offsetX&&(this._offsetX=n,this._isDirty=!0),r!==this._offsetY&&(this._offsetY=r,this._isDirty=!0),this._currentTesselatedTile!==this._currentTile&&(this._currentTesselatedTile=this._currentTile,this._isDirty=!0),this._isDirty){var i=this._vertexBuffer.attributes.position;i[0]=0+n,i[1]=0+r,i[2]=0,i[3]=t.actualWidth+n,i[4]=0+r,i[5]=0,i[6]=0+n,i[7]=t.actualHeight+r,i[8]=0,i[9]=0+n,i[10]=t.actualHeight+r,i[11]=0,i[12]=t.actualWidth+n,i[13]=0+r,i[14]=0,i[15]=t.actualWidth+n,i[16]=t.actualHeight+r,i[17]=0;var o=e.getWidth()/Math.max(this.tileSize.x,1),a=e.getHeight()/Math.max(this.tileSize.y,1),s=Math.floor(this.currentTile/o),c=Math.round(this.currentTile)%o,u=this._vertexBuffer.attributes.uv,l=1/o,p=1/a,h=1/e.getWidth()/2*(c>0?1:0),f=1/e.getHeight()/2*(s>0?1:0);u[0]=l*c+h,u[1]=1-(p*s+f),u[2]=l*c+l-h,u[3]=1-(p*s+f),u[4]=l*c+h,u[5]=1-(p*s+p-f),u[6]=l*c+h,u[7]=1-(p*s+p-f),u[8]=l*c+l-h,u[9]=1-(p*s+f),u[10]=l*c+l-h,u[11]=1-(p*s+p-f),this._vertexBuffer.dirtifyAttribute("position"),this._vertexBuffer.dirtifyAttribute("uv"),this._isDirty=!1}}return this._vertexBuffer},SpriteSheetFill.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_color:t.properties.tint}),delete t.properties.tint),t},Lr([unserializable(),Nr("design:type",_t)],SpriteSheetFill.prototype,"_vertexBuffer",void 0),Lr([unserializable(),Nr("design:type",Object)],SpriteSheetFill.prototype,"_isDirty",void 0),Lr([unserializable(),Nr("design:type",Object)],SpriteSheetFill.prototype,"_offsetX",void 0),Lr([unserializable(),Nr("design:type",Object)],SpriteSheetFill.prototype,"_offsetY",void 0),Lr([unserializable(),Nr("design:type",Object)],SpriteSheetFill.prototype,"_currentTesselatedTile",void 0),SpriteSheetFill=Lr([displayName("SpriteSheet"),Nr("design:paramtypes",[Dr])],SpriteSheetFill)}(Vr),Kr=function(t){function SpriteSheetMaterialFill(){var e=null!==t&&t.apply(this,arguments)||this;return e._material=new Yt(qu),e}return Fr(SpriteSheetMaterialFill,t),Object.defineProperty(SpriteSheetMaterialFill.prototype,"material",{get:function(){return this._material.asset},set:function(t){this._material.asset=t},enumerable:!0,configurable:!0}),SpriteSheetMaterialFill.prototype.isLoaded=function(){return!!t.prototype.isLoaded.call(this)&&w.isAssetRefLoaded(this._material)},SpriteSheetMaterialFill.prototype.destroy=function(){this._material.detach(),t.prototype.destroy.call(this)},SpriteSheetMaterialFill=Lr([displayName("SpriteSheet Material")],SpriteSheetMaterialFill)}(Hr),Xr=function(){function GraphicUtils(){}return GraphicUtils.drawVertexBuffer=function(t,e,n){e.begin(t,n),e.draw(t),e.end(t,n)},GraphicUtils}();!function(t){t.quad=new _t({attributes:{position:[0,0,0,1,0,0,1,1,0,0,0,0,1,1,0,0,1,0],uv:[0,0,1,0,1,1,0,0,1,1,0,1],normal:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]},primitiveType:"TRIANGLES"}),t.centeredQuad=new _t({attributes:{position:[-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0],uv:t.quad.attributes.uv,normal:t.quad.attributes.normal},primitiveType:"TRIANGLES"}),t.uiQuad=new _t({attributes:{position:[0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,1,1,0],uv:[0,1,1,1,0,0,0,0,1,1,1,0]},primitiveType:"TRIANGLES"})}(kr||(kr={}));var Qr,Yr,Zr,Jr,$r,ti=function(){function GeometryProvider(){}return Object.defineProperty(GeometryProvider,"quad",{get:function(){return kr.quad},enumerable:!0,configurable:!0}),Object.defineProperty(GeometryProvider,"centeredQuad",{get:function(){return kr.centeredQuad},enumerable:!0,configurable:!0}),Object.defineProperty(GeometryProvider,"uiQuad",{get:function(){return kr.uiQuad},enumerable:!0,configurable:!0}),Object.defineProperty(GeometryProvider,"skyBox",{get:function(){if(!kr.skyBox){var t=new _t({attributes:{position:[-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1]},primitiveType:"TRIANGLES"});kr.skyBox=t}return kr.skyBox},enumerable:!0,configurable:!0}),GeometryProvider.unload=function(t){kr.centeredQuad.unload(t),kr.quad.unload(t),kr.uiQuad.unload(t),kr.skyBox&&kr.skyBox.unload(t)},GeometryProvider}();(Yr=Qr||(Qr={})).materials||(Yr.materials={}),Yr.shaders||(Yr.shaders={}),Yr.primitives||(Yr.primitives={}),(Zr||(Zr={})).definitions=[{path:"Assets/DefaultAssets/Materials/Particles.Material",set:function(t){return Qr.materials.particles=t},get:function(){return Qr.materials.particles}},{path:"Assets/DefaultAssets/Materials/UI.Material",set:function(t){return Qr.materials.ui=t},get:function(){return Qr.materials.ui}},{path:"Assets/DefaultAssets/Materials/Sky.Material",set:function(t){return Qr.materials.sky=t},get:function(){return Qr.materials.sky}},{path:"Assets/DefaultAssets/Materials/CubeMap.Material",set:function(t){return Qr.materials.cubeMap=t},get:function(){return Qr.materials.cubeMap}},{path:"Assets/DefaultAssets/Shaders/RenderDepth.Shader",set:function(t){return Qr.shaders.renderDepth=t},get:function(){return Qr.shaders.renderDepth}},{path:"Assets/DefaultAssets/Shaders/SkinnedRenderDepth.Shader",set:function(t){return Qr.shaders.skinnedRenderDepth=t},get:function(){return Qr.shaders.skinnedRenderDepth}},{path:"Assets/DefaultAssets/Shaders/FullScreen.Shader",set:function(t){return Qr.shaders.fullScreen=t},get:function(){return Qr.shaders.fullScreen}},{path:"Assets/DefaultAssets/Shaders/PostFX/BloomStep1.Shader",set:function(t){return Qr.shaders.bloom=t},get:function(){return Qr.shaders.bloom}},{path:"Assets/DefaultAssets/Shaders/PostFX/Blur.Shader",set:function(t){return Qr.shaders.blur=t},get:function(){return Qr.shaders.blur}},{path:"Assets/DefaultAssets/Shaders/PostFX/Compose.Shader",set:function(t){return Qr.shaders.compose=t},get:function(){return Qr.shaders.compose}},{path:"Assets/DefaultAssets/Shaders/Phong.PhongShader",set:function(t){return Qr.shaders.phong=t},get:function(){return Qr.shaders.phong}},{path:"Assets/DefaultAssets/Shaders/Diffuse.Shader",set:function(t){return Qr.shaders.diffuse=t},get:function(){return Qr.shaders.diffuse}},{path:"Assets/DefaultAssets/Geometry/Meshes/Cube.StaticMeshAsset",set:function(t){return Qr.primitives.box=t},get:function(){return Qr.primitives.box}},{path:"Assets/DefaultAssets/Geometry/Meshes/Sphere.StaticMeshAsset",set:function(t){return Qr.primitives.sphere=t},get:function(){return Qr.primitives.sphere}},{path:"Assets/DefaultAssets/Geometry/Meshes/Plane.StaticMeshAsset",set:function(t){return Qr.primitives.plane=t},get:function(){return Qr.primitives.plane}},{path:"Assets/DefaultAssets/Geometry/Meshes/Cone.StaticMeshAsset",set:function(t){return Qr.primitives.cone=t},get:function(){return Qr.primitives.cone}},{path:"Assets/DefaultAssets/Textures/WhiteSquare.Texture2D",set:function(t){return Qr.whiteTexture=t},get:function(){return Qr.whiteTexture}},{path:"Assets/DefaultAssets/Transition/Transition.Scene",set:function(t){return Qr.transitionScene=t},get:function(){return Qr.transitionScene}}],function(t){t.load=function load(){return Promise.all(Zr.definitions.map(function(t){return R.instance.loadObject(t.path).then(function(e){return t.set(e[0])})})).then(function(){return mo.load()})},t.isLoaded=function isLoaded(){for(var t=0,e=Zr.definitions;t<e.length;t++)if(!e[t].get().isLoaded())return!1;return mo.isLoaded()}}(Jr||(Jr={})),function(t){t.tint=new H,t.getUIElementVertexBuffer=function getUIElementVertexBuffer(t){var e=ti.uiQuad,n=e.attributes.position,r=t.actualWidth,i=t.actualHeight,o=-t.pivot.x*r,a=-t.pivot.y*i;return n[0]=0+o,n[1]=0+a,n[2]=0,n[3]=r+o,n[4]=0+a,n[5]=0,n[6]=0+o,n[7]=i+a,n[8]=0,n[9]=0+o,n[10]=i+a,n[11]=0,n[12]=r+o,n[13]=0+a,n[14]=0,n[15]=r+o,n[16]=i+a,n[17]=0,e.dirtifyAttribute("position"),e}}($r||($r={}));var ei,ni=function(){function UIFillUtils(){}return UIFillUtils.getVertexBuffer=function(t,e){if(e){if(e.isA(Wr))return e.tesselate(t);if(e.isA(Hr))return e.tesselate(t)}return $r.getUIElementVertexBuffer(t)},UIFillUtils.renderFill=function(t,e,n,r,i,o){if(t.isA(Ur))(u=(a=t).material)&&u.shader&&(u.queueParameter("projectionMatrix",e.getParameter("projectionMatrix")),u.queueParameter("modelViewMatrix",n),u.queueParameter("tint",o),u.begin()&&Xr.drawVertexBuffer(i,r,u.shader));else if(t.isA(Gr)){var a=t,s=Qr.whiteTexture;e.queueReferenceParameter(UIFillUtils.uiShaderTextureParam,s),e.queueParameter(UIFillUtils.uiShaderColorParam,$r.tint.copy(a.color).multiplyColor(o)),e.begin()&&Xr.drawVertexBuffer(i,r,e.shader)}else if(t.isA(qr)){(a=t).texture&&(e.queueReferenceParameter(UIFillUtils.uiShaderTextureParam,a.texture),e.queueParameter(UIFillUtils.uiShaderColorParam,$r.tint.copy(a.color).multiplyColor(o)),e.begin()&&Xr.drawVertexBuffer(i,r,e.shader))}else if(t.isA(Wr)){var c=(a=t).sprite.asset?a.sprite.asset.texture.asset:null;c&&(e.queueReferenceParameter(UIFillUtils.uiShaderTextureParam,c),e.queueParameter(UIFillUtils.uiShaderColorParam,$r.tint.copy(a.color).multiplyColor(o)),e.begin()&&Xr.drawVertexBuffer(i,r,e.shader))}else if(t.isA(Kr)){var u;(u=(a=t).material)&&u.shader&&(u.queueParameter("projectionMatrix",e.getParameter("projectionMatrix")),u.queueParameter("modelViewMatrix",n),u.queueParameter("tint",o),u.begin()&&Xr.drawVertexBuffer(i,r,u.shader))}else if(t.isA(Hr)){(a=t).texture&&(e.queueReferenceParameter(UIFillUtils.uiShaderTextureParam,a.texture),e.queueParameter(UIFillUtils.uiShaderColorParam,$r.tint.copy(a.color).multiplyColor(o)),e.begin()&&Xr.drawVertexBuffer(i,r,e.shader))}},UIFillUtils.getFillSize=function(t,e){if(t.isA(qr))return(l=t.texture)?e?l.getWidth():l.getHeight():0;if(t.isA(Wr)){var n=t;return(l=n.sprite.asset?n.sprite.asset.texture.asset:null)?e?l.getWidth():l.getHeight():0}if(t.isA(Hr)){var r=t;return e?r.tileSize.x:r.tileSize.y}if(t.isA(Ur)){var i=t.material,o=i?i.shader:void 0;if(o)for(var a=o.getParams(),s=i.shaderParams,c=0,u=Object.keys(a);c<u.length;c++){var l,p=u[c];if("sampler2D"===a[p].type&&p in s)return(l=s[p].asset)?e?l.getWidth():l.getHeight():0}}return 256},UIFillUtils.uiShaderTextureParam="diffuse",UIFillUtils.uiShaderColorParam="ambient",UIFillUtils}(),ri=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ii=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},oi=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Clip=0]="Clip",t[t.Scroll=1]="Scroll"}(ei||(ei={}));var ai,si=function(t){function UIElement(){var e=null!==t&&t.apply(this,arguments)||this;return e._touchInside=!1,e._touchPressed=!1,e}return ri(UIElement,t),Object.defineProperty(UIElement.prototype,"isTouchInside",{get:function(){return this._touchInside},enumerable:!0,configurable:!0}),Object.defineProperty(UIElement.prototype,"isTouchPressed",{get:function(){return this._touchPressed},enumerable:!0,configurable:!0}),UIElement.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.clearComponent(zt),e.getOrSetComponent(vr)},UIElement.prototype.getVertexBuffer=function(){return ni.getVertexBuffer(this.entity.getComponent(vr))},UIElement.prototype.setTouchInside=function(t){this._touchInside=t},UIElement.prototype.setTouchPressed=function(t){this._touchPressed=t},ii([unserializable(),oi("design:type",Object)],UIElement.prototype,"_touchInside",void 0),ii([unserializable(),oi("design:type",Object)],UIElement.prototype,"_touchPressed",void 0),UIElement}(Et),ci=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ui=function(t){function Font(){return null!==t&&t.apply(this,arguments)||this}return ci(Font,t),Font.prototype.getTexture=function(){return console.assert(!1,"Calling Abstract Method"),0},Font.prototype.setText=function(t){},Font.prototype.setAlignment=function(t){},Font.prototype.getWidth=function(){return 0},Font.prototype.getHeight=function(){return 0},Font.prototype.isLoaded=function(){return!0},Font.prototype.prepareForRendering=function(t,e){},Font}(_),li=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),pi=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},hi=function(t){function FontMetrics(){var e=null!==t&&t.apply(this,arguments)||this;return e.widths={},e.cellWidth=32,e.cellHeight=32,e.textureWidth=512,e.textureHeight=256,e.startCharacter=32,e}return li(FontMetrics,t),FontMetrics=pi([displayName("Font Metrics"),creatable(!1)],FontMetrics)}(A),fi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),di=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},yi=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){(ai||(ai={})).wordWrap=function wordWrap(t,e,n){for(var r=[],i=e.split(" "),o="",a=0;a<i.length;a++){for(var s=o+i[a]+" ",c=0,u=0;u<s.length;++u){var l=s.charCodeAt(u);c+=t.widths[l]}c>n&&a>0?(r.push(o),o=i[a]+" "):o=s}return r.push(o),r}}();var mi,vi=function(t){function BitmapFont(){var e=null!==t&&t.apply(this,arguments)||this;return e.texture=new Yt(Rr),e.metrics=new Yt(hi),e.lineHeight=16,e.spacing=0,e._isDirty=!0,e._maxWidth=0,e._width=0,e._height=0,e._pivotX=0,e._pivotY=0,e}return fi(BitmapFont,t),Object.defineProperty(BitmapFont.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),BitmapFont.prototype.getTexture=function(){return this.texture.asset},BitmapFont.prototype.getWidth=function(){return this._width},BitmapFont.prototype.getHeight=function(){return this._height},BitmapFont.prototype.setText=function(t){t!==this._text&&(this._text=t,this._isDirty=!0)},BitmapFont.prototype.setAlignment=function(t){t!==this._alignment&&(this._alignment=t,this._isDirty=!0)},BitmapFont.prototype.isLoaded=function(){return w.isAssetRefLoaded(this.texture)&&w.isAssetRefLoaded(this.metrics)},BitmapFont.prototype.destroy=function(){this.texture.detach(),this._vertexBuffer&&this._vertexBuffer.unload(ht.context),t.prototype.destroy.call(this)},BitmapFont.prototype.upgrade=function(t,e){return 1===e&&(t.properties.metrics.typeName="FontMetrics"),t},BitmapFont.prototype.tesselate=function(t,e){this._vertexBuffer||(this._vertexBuffer=new _t,this._vertexBuffer.isDynamic=!0,this._vertexBuffer.primitiveType="TRIANGLES",this._vertexBuffer.setAttribute("position",[]),this._vertexBuffer.setAttribute("uv",[]));var n=this.getTexture(),r=this.metrics.asset;t!==this._pivotX&&(this._pivotX=t,this._isDirty=!0),e!==this._pivotY&&(this._pivotY=e,this._isDirty=!0);var i=this._text.split("\\n");if(this._isDirty&&n&&r&&i.length>0){if(this._maxWidth>0){for(var o=[],a=0,s=i;a<s.length;a++){var c=s[a];o=o.concat(ai.wordWrap(r,c,this._maxWidth))}this._width=this._maxWidth,this._height=this.lineHeight*o.length,this.drawText(o,this.lineHeight)}else this._height=this.lineHeight*i.length,this._width=0,this._width=this.drawText(i,this.lineHeight);this._vertexBuffer.dirtifyAttribute("position"),this._vertexBuffer.dirtifyAttribute("uv"),this._isDirty=!1}return this._vertexBuffer},BitmapFont.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n),"metrics"===e?this._isDirty||(this._isDirty=!0):"lineHeight"===e?this._isDirty||(this._isDirty=!0):"spacing"===e&&(this._isDirty||(this._isDirty=!0))},BitmapFont.prototype.prepareForRendering=function(t,e){this._maxWidth!==e&&(this._maxWidth=e,this._isDirty=!0)},BitmapFont.prototype.drawText=function(t,e){var n=this.getTexture(),r=this.metrics.asset,i=n.getWidth()/Math.max(r.cellWidth,1),o=n.getHeight()/Math.max(r.cellHeight,1),a=r.startCharacter,s=6*t.reduce(function(t,e){return t+e.length},0);this._vertexBuffer.vertexCount=s;var c=this._vertexBuffer.attributes.position,u=this._vertexBuffer.attributes.uv;c.length=3*s,u.length=2*s;for(var l=1/i,p=1/o,h=0,f=[],d=0;d<t.length;++d){for(var y=t[d],m=0,v=0;v<y.length;++v){var g=y.charCodeAt(v);m+=P=r.widths[g],v>0&&v<this._text.length&&(m+=this.spacing)}f[d]=m,m>h&&(h=m)}var _=-this._pivotX*(this._width||h),b=-this._pivotY*(e*t.length),w=0;for(d=0;d<t.length;++d){y=t[d];var x=0;this._alignment===pr.Center?x=((this._width||h)-f[d])/2:this._alignment===pr.Right&&(x=(this._width||h)-f[d]);for(v=0;v<y.length;++v){g=y.charCodeAt(v);var P=r.widths[g],O=g-a,C=Math.floor(O/i),S=Math.round(O)%i,j=18*w,R=x,T=d*e;c[j+0]=_+R,c[j+1]=b+T,c[j+2]=0,c[j+3]=_+R+P,c[j+4]=b+T,c[j+5]=0,c[j+6]=_+R,c[j+7]=b+T+e,c[j+8]=0,c[j+9]=_+R,c[j+10]=b+T+e,c[j+11]=0,c[j+12]=_+R+P,c[j+13]=b+T,c[j+14]=0,c[j+15]=_+R+P,c[j+16]=b+T+e,c[j+17]=0;var E=P/n.getWidth(),B=e/n.getHeight();u[(j=12*w)+0]=l*S,u[j+1]=1-p*C,u[j+2]=l*S+E,u[j+3]=1-p*C,u[j+4]=l*S,u[j+5]=1-(p*C+B),u[j+6]=l*S,u[j+7]=1-(p*C+B),u[j+8]=l*S+E,u[j+9]=1-p*C,u[j+10]=l*S+E,u[j+11]=1-(p*C+B),x+=P+this.spacing,++w}}return h},di([unserializable(),yi("design:type",_t)],BitmapFont.prototype,"_vertexBuffer",void 0),di([unserializable(),yi("design:type",String)],BitmapFont.prototype,"_text",void 0),di([unserializable(),yi("design:type",Object)],BitmapFont.prototype,"_isDirty",void 0),di([unserializable(),yi("design:type",Object)],BitmapFont.prototype,"_maxWidth",void 0),di([unserializable(),yi("design:type",Object)],BitmapFont.prototype,"_width",void 0),di([unserializable(),yi("design:type",Object)],BitmapFont.prototype,"_height",void 0),di([unserializable(),yi("design:type",Object)],BitmapFont.prototype,"_pivotX",void 0),di([unserializable(),yi("design:type",Object)],BitmapFont.prototype,"_pivotY",void 0),di([unserializable(),yi("design:type",Number)],BitmapFont.prototype,"_alignment",void 0),BitmapFont}(ui),gi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),_i=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},bi=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},wi=function(t){function FontShadow(){var e=null!==t&&t.apply(this,arguments)||this;return e.propertyChanged=new S.AsyncEvent,e}return gi(FontShadow,t),FontShadow.prototype.applyToContext=function(t){},_i([unserializable(),bi("design:type",Object)],FontShadow.prototype,"propertyChanged",void 0),FontShadow}(_),xi=function(t){function DefaultFontShadow(){var e=null!==t&&t.apply(this,arguments)||this;return e._offset=new $(1,1),e._blur=1,e._color=new H,e}return gi(DefaultFontShadow,t),Object.defineProperty(DefaultFontShadow.prototype,"offset",{set:function(t){this._offset.copy(t),this.propertyChanged.post("offset")},enumerable:!0,configurable:!0}),Object.defineProperty(DefaultFontShadow.prototype,"blur",{set:function(t){this._blur=t,this.propertyChanged.post("blur")},enumerable:!0,configurable:!0}),Object.defineProperty(DefaultFontShadow.prototype,"color",{set:function(t){this._color.copy(t),this.propertyChanged.post("color")},enumerable:!0,configurable:!0}),DefaultFontShadow.prototype.applyToContext=function(t){t.shadowOffsetX=this._offset.x,t.shadowOffsetY=this._offset.y;var e=this._color.toChromeColor(),n=e.r,r=e.g,i=e.b,o=e.a;t.shadowColor="rgba("+n+", "+r+", "+i+", "+o+")",t.shadowBlur=this._blur},DefaultFontShadow=_i([displayName("Default")],DefaultFontShadow)}(wi),Pi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Oi=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};!function(t){(mi||(mi={})).wordWrap=function wordWrap(t,e,n){for(var r=[],i=e.split(" "),o="",a=0;a<i.length;a++){var s=o+i[a]+" ";t.measureText(s).width>n&&a>0?(r.push(o),o=i[a]+" "):o=s}return r.push(o),r}}();var Ci,Si=function(t){function FontTexture(){var e=null!==t&&t.apply(this,arguments)||this;return e._isDirty=!0,e._maxWidth=0,e._scaleFactor=1,e}return Pi(FontTexture,t),Object.defineProperty(FontTexture.prototype,"scaleFactor",{set:function(t){t!==this._scaleFactor&&(this._isDirty=!0,this._scaleFactor=t)},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"maxWidth",{set:function(t){t!==this._maxWidth&&(this._isDirty=!0,this._maxWidth=t)},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"family",{set:function(t){t!==this._fontFamily&&(this._isDirty=!0,this._fontFamily=t)},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"text",{set:function(t){if(t!==this._text){if(this._text=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"size",{set:function(t){if(t!==this._fontSize){if(this._fontSize=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"bold",{set:function(t){if(t!==this._bold){if(this._bold=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"italic",{set:function(t){if(t!==this._italic){if(this._italic=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"alignment",{set:function(t){if(this._alignment!==t){if(this._alignment=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"shadow",{set:function(t){if(this._shadow!==t){if(this._shadow=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!0,configurable:!0}),FontTexture.prototype.dirtify=function(){this._isDirty=!0},FontTexture.prototype.getWidth=function(){return this._canvas?this._canvas.width/this._scaleFactor:0},FontTexture.prototype.getHeight=function(){return this._canvas?this._canvas.height/this._scaleFactor:0},FontTexture.prototype.begin=function(t){var e=ht.context,n=!0;if(this._textureId){if(this._isDirty){var r;(r=this._canvas.getContext("2d"))&&(n=this.updateTexture(r))}}else this._canvas||(this._canvas=document.createElement("canvas")),(r=this._canvas.getContext("2d"))&&(this._textureId=e.createTexture(),n=this.updateTexture(r));return!!n&&(e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),!0)},FontTexture.prototype.destroy=function(){delete this._canvas,t.prototype.destroy.call(this)},FontTexture.prototype.tryUpdateTextureInEditor=function(){return!1},FontTexture.prototype.updateTexture=function(t){var e=ht.context,n=this._italic?"italic ":"";n+=this._bold?"bold ":"",n+=this._fontSize*this._scaleFactor+"px "+this._fontFamily,t.font=n;var r=this._text.split("\\n");if(0===r.length)return!1;if(this._maxWidth>0){for(var i=this._maxWidth*this._scaleFactor,o=[],a=0,s=r;a<s.length;a++){var c=s[a];o=o.concat(mi.wordWrap(t,c,i))}if(0===o.length)return!1;var u=this.getTextHeight(n,o[0]);this._canvas.width=i,this._canvas.height=u*o.length,this.drawText(t,n,o,u)}else{for(var l=t.measureText(r[0]).width,p=1;p<r.length;++p)l=Math.max(l,t.measureText(r[p]).width);if(0===l)return!1;i=l;var h=(u=this.getTextHeight(n,r[0]))*r.length;this._canvas.width=i,this._canvas.height=h,this.drawText(t,n,r,u)}return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._textureId),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._canvas),this._isDirty=!1,!0},FontTexture.prototype.getTextHeight=function(t,e){var n=document.createElement("span");n.setAttribute("style","font: "+t+";"),n.textContent=e,document.body.appendChild(n);var r=n.offsetHeight;return document.body.removeChild(n),r},FontTexture.prototype.drawText=function(t,e,n,r){t.font=e,t.textBaseline="top",t.fillStyle="white",this._shadow?this._shadow.applyToContext(t):delete t.shadowColor,t.clearRect(0,0,this._canvas.width,this._canvas.height);for(var i=0;i<n.length;++i){var o=0;this._alignment===pr.Center?o=(this._canvas.width-t.measureText(n[i]).width)/2:this._alignment===pr.Right&&(o=this._canvas.width-t.measureText(n[i]).width),t.fillText(n[i],o,i*r)}},FontTexture=Oi([displayName("Font Texture")],FontTexture)}(wr),ji=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Ri=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Ti=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ei=function(t){function FontFamily(){var e=t.call(this)||this;return e.family="Arial",e.size=14,e.bold=!1,e.italic=!1,e._shadow=new l(wi),e.texture=new Si,e.texture.size=e.size,e.texture.family=e.family,e.onShadowPropertyChanged=e.onShadowPropertyChanged.bind(e),e.shadow=new xi,e}return ji(FontFamily,t),Object.defineProperty(FontFamily.prototype,"shadow",{set:function(t){var e=this._shadow.instance;this._shadow.instance=t,e&&e.propertyChanged.detach(this.onShadowPropertyChanged),t&&t.propertyChanged.attach(this.onShadowPropertyChanged),this.texture.shadow=t},enumerable:!0,configurable:!0}),FontFamily.prototype.setText=function(t){this.texture.text=t},FontFamily.prototype.setAlignment=function(t){this.texture.alignment=t},FontFamily.prototype.getTexture=function(){return this.texture},FontFamily.prototype.getWidth=function(){return this.texture.getWidth()},FontFamily.prototype.getHeight=function(){return this.texture.getHeight()},FontFamily.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n),"family"===e?this.texture.family=n:"size"===e?this.texture.size=n:"bold"===e?this.texture.bold=n:"italic"===e?this.texture.italic=n:"_shadow"===e&&(this.shadow=n.instance)},FontFamily.prototype.prepareForRendering=function(t,e){this.texture.scaleFactor=t,this.texture.maxWidth=e},FontFamily.prototype.destroy=function(){this.texture.destroy(),this._shadow.instance&&this._shadow.instance.propertyChanged.detach(this.onShadowPropertyChanged),t.prototype.destroy.call(this)},FontFamily.prototype.onShadowPropertyChanged=function(t){this.texture.dirtify()},Ri([unserializable(),Ti("design:type",Si)],FontFamily.prototype,"texture",void 0),FontFamily}(ui),Bi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Ai=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Ii=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Mi=function(t){function Text(){var e=t.call(this)||this;return e._font=new l(ui,new Ei),e.text="Empty Text",e._color=new H(1,1,1,1),e._alignment=pr.Left,e}return Bi(Text,t),Object.defineProperty(Text.prototype,"version",{get:function(){return 7},enumerable:!0,configurable:!0}),Object.defineProperty(Text.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t||"",this.font&&this.font.setText(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Text.prototype,"alignment",{set:function(t){this._alignment=t,this.font&&this.font.setAlignment(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Text.prototype,"color",{get:function(){return this._color},set:function(t){this._color.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Text.prototype,"font",{get:function(){return this._font.instance},enumerable:!0,configurable:!0}),Text.prototype.setProperty=function(e,n){if(t.prototype.setProperty.call(this,e,n),"_text"===e)this.text=n;else if("_alignment"===e)this.alignment=n;else if("_font"===e){var r=n.instance;r&&(r.setText(this._text),r.setAlignment(this._alignment))}},Text.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.getOrSetComponent(vr)},Text.prototype.destroy=function(){this.font&&this.font.destroy(),t.prototype.destroy.call(this)},Text.prototype.isLoaded=function(){return!!t.prototype.isLoaded.call(this)&&(!this.font||this.font.isLoaded())},Text.prototype.getVertexBuffer=function(){if(this.font&&this.font.isA(vi)){var e=this.entity.getComponent(vr);return this.font.tesselate(e.pivot.x,e.pivot.y)}return t.prototype.getVertexBuffer.call(this)},Text.prototype.upgrade=function(t,e){if(1===e)delete t.properties.font,delete t.properties.yOffset;else if(2===e)Object.assign(t.properties,{_text:t.properties.text}),delete t.properties.text;else if(3===e)Object.assign(t.properties,{font:{baseTypeName:"Font",data:{typeName:"FontFamily",properties:{family:t.properties.fontFamily}}}}),delete t.properties.fontFamily;else if(4===e)Object.assign(t.properties,{_font:t.properties.font,_bold:t.properties.bold,_italic:t.properties.italic,_tint:t.properties.tint}),Object.assign(t.properties._font.data.properties,{size:t.properties.size}),delete t.properties.font,delete t.properties.size,delete t.properties.bold,delete t.properties.italic,delete t.properties.tint;else if(5===e)Object.assign(t.properties,{_color:t.properties._tint}),delete t.properties._tint;else if(6===e){var n=t.properties._font.data;n&&"FontFamily"===n.typeName&&Object.assign(n.properties,{bold:t.properties._bold,italic:t.properties._italic}),delete t.properties._bold,delete t.properties._italic}return t},Ai([Attributes_enumLiterals(pr),Ii("design:type",Number)],Text.prototype,"_alignment",void 0),Text=Ai([helpUrl("https://docs.spiderengine.io/2d/text.html"),Ii("design:paramtypes",[])],Text)}(si),zi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ki=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Di=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Fi=function(t){function TouchInteractions(e){var n=t.call(this)||this;return e&&n.setState(e),n}var e;return zi(TouchInteractions,t),TouchInteractions=ki([(e="UIElement",Reflect.metadata("requires",e)),Di("design:paramtypes",[Object])],TouchInteractions)}(Et),Li=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Ni=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Vi=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ui=function(t){function CheckBox(){var e=null!==t&&t.apply(this,arguments)||this;return e.highlightColor=(new H).copy(H.white),e.pressedColor=(new H).copy(H.white),e.disabledColor=(new H).copy(H.grey),e._enabled=!0,e._isChecked=!1,e._checked=new l(Vr),e._unchecked=new l(Vr),e}return Li(CheckBox,t),Object.defineProperty(CheckBox.prototype,"checked",{get:function(){return this._checked.instance},enumerable:!0,configurable:!0}),Object.defineProperty(CheckBox.prototype,"unchecked",{get:function(){return this._unchecked.instance},enumerable:!0,configurable:!0}),Object.defineProperty(CheckBox.prototype,"isChecked",{get:function(){return this._isChecked},set:function(t){this._isChecked=t},enumerable:!0,configurable:!0}),Object.defineProperty(CheckBox.prototype,"enabled",{get:function(){return this._touchInteractions.active},set:function(t){this._enabled=this._touchInteractions.active=t},enumerable:!0,configurable:!0}),Object.defineProperty(CheckBox.prototype,"currentFill",{get:function(){return this._isChecked?this.checked:this.unchecked},enumerable:!0,configurable:!0}),Object.defineProperty(CheckBox.prototype,"currentColor",{get:function(){return this.enabled?this.isTouchPressed?this.pressedColor:this.isTouchInside?this.highlightColor:H.white:this.disabledColor},enumerable:!0,configurable:!0}),CheckBox.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),this._touchInteractions=new Fi({active:this._enabled,controller:this}),au.setComponentFromInstance(e,this._touchInteractions)},CheckBox.prototype.destroy=function(){this.entity.clearComponent(Fi),t.prototype.destroy.call(this)},CheckBox.prototype.isLoaded=function(){return!(this.checked&&!this.checked.isLoaded())&&!(this.unchecked&&!this.unchecked.isLoaded())},CheckBox.prototype.getVertexBuffer=function(){return ni.getVertexBuffer(this.entity.getComponent(vr),this.currentFill)},CheckBox.prototype.setTouchPressed=function(e){var n=this.isTouchPressed;t.prototype.setTouchPressed.call(this,e),!e&&n&&this.enabled&&(this.isChecked=!this.isChecked)},Ni([unserializable(),Vi("design:type",Fi)],CheckBox.prototype,"_touchInteractions",void 0),CheckBox}(si),Wi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),qi=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Gi=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Hi=function(t){function AnimationTrackDefinition(){var e=t.call(this)||this;return e._id=w.makeUniqueId(),e}return Wi(AnimationTrackDefinition,t),Object.defineProperty(AnimationTrackDefinition.prototype,"version",{get:function(){return 5},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationTrackDefinition.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),AnimationTrackDefinition.prototype.upgrade=function(t,e){return 1===e?t.properties.propertyPath&&t.properties.propertyPath.data.indexOf("Visual/material")>=0&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace("Visual/material","Visual/_material")):2===e?t.properties.propertyPath&&t.properties.propertyPath.data.indexOf("UIImage/fill")>=0&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace("UIImage/fill","UIImage/_fill")):3===e?(t.properties.propertyPath&&t.properties.propertyPath.data.indexOf("UIImage/")>=0&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace("UIImage/","Image/")),t.properties.propertyPath&&t.properties.propertyPath.data.indexOf("UIText/")>=0&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace("UIText/","Text/"))):4===e&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace(/Transform\/local(Position|Rotation|Scale)/,function(t,e){return"Transform/"+e.toLowerCase()})),t},qi([Attributes_hidden(),Gi("design:type",l)],AnimationTrackDefinition.prototype,"track",void 0),qi([unserializable(),Gi("design:type",Object)],AnimationTrackDefinition.prototype,"transition",void 0),AnimationTrackDefinition}(_),Ki=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Xi=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Qi=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Yi=function(t){function Animation(){var e=null!==t&&t.apply(this,arguments)||this;return e.tracks=new xt(Hi),e._duration=0,e._imported=!1,e}return Ki(Animation,t),Object.defineProperty(Animation.prototype,"duration",{get:function(){return this._duration},set:function(t){this._duration=t},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"imported",{get:function(){return this._imported},set:function(t){this._imported=t},enumerable:!0,configurable:!0}),Animation.prototype.isLoaded=function(){for(var t=0,e=this.tracks.data;t<e.length;t++){if(!e[t].track.instance.isLoaded())return!1}return!0},Animation.getPropertyAtPath=function(t,e){var n=function(t,e,r){var i=e[r];return i in t?r===e.length-1?t[i]:(console.assert("object"==typeof t),n(t[i],e,r+1)):void 0},r=e.split("/");if(r.length>1){var i=r[0],o=au.getComponentByName(t,i);if(o)return n(o,r,1)}},Xi([Attributes_hidden(),Qi("design:type",Object)],Animation.prototype,"tracks",void 0),Xi([Attributes_hidden(),Qi("design:type",Object)],Animation.prototype,"_imported",void 0),Animation=Xi([editable(!1)],Animation)}(A),Zi=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Ji=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},$i=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},to=function(t){function AnimationInstance(){var e=null!==t&&t.apply(this,arguments)||this;return e.loopCount=0,e.speed=1,e.autoPlay=!0,e._isPlaying=!1,e._localTime=0,e._playTime=0,e._stopRequested=!1,e._playCount=0,e._animation=new Yt(Yi),e}return Zi(AnimationInstance,t),Object.defineProperty(AnimationInstance.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"animation",{get:function(){return this._animation.asset},set:function(t){delete this.targets,this._animation.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"isPlaying",{get:function(){return this._isPlaying},set:function(t){this._isPlaying=t},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"localTime",{get:function(){return this._localTime},set:function(t){this._localTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"playTime",{get:function(){return this._playTime},set:function(t){this._playTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"stopRequested",{get:function(){return this._stopRequested},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"playCount",{get:function(){return this._playCount},set:function(t){this._playCount=t},enumerable:!0,configurable:!0}),AnimationInstance.prototype.requestStop=function(){this._stopRequested=!0},AnimationInstance.prototype.upgrade=function(t,e){return 1===e?(!0===t.properties.loop?Object.assign(t.properties,{loopCount:0}):Object.assign(t.properties,{loopCount:1}),delete t.properties.loop):2===e&&(Object.assign(t.properties,{_animation:t.properties.animation}),delete t.properties.animation),t},AnimationInstance.prototype.isLoaded=function(){return w.isAssetRefLoaded(this._animation)},AnimationInstance.prototype.destroy=function(){delete this.targets,this._animation.detach(),t.prototype.destroy.call(this)},Ji([unserializable(),$i("design:type",Object)],AnimationInstance.prototype,"targets",void 0),Ji([unserializable(),$i("design:type",Object)],AnimationInstance.prototype,"_isPlaying",void 0),Ji([unserializable(),$i("design:type",Object)],AnimationInstance.prototype,"_localTime",void 0),Ji([unserializable(),$i("design:type",Object)],AnimationInstance.prototype,"_playTime",void 0),Ji([unserializable(),$i("design:type",Object)],AnimationInstance.prototype,"_stopRequested",void 0),Ji([unserializable(),$i("design:type",Object)],AnimationInstance.prototype,"_playCount",void 0),AnimationInstance}(_);!function(t){t.evaluateProperty=function evaluateProperty(e,n,r,i,o,a){if(r===n.length-1){if(e){var s=i.getSample(o,e[n[r]]);void 0!==s&&a(e,n[r],s)}}else if(e){var c=n[r];if("Visual"===e.constructor.name&&"_material"===c){var u=e,l=u.animatedMaterial;!l&&u.material&&(l=u.material.copy(),u.animatedMaterial=l),t.evaluateProperty(l,n,r+2,i,o,a)}else t.evaluateProperty(e[c],n,r+1,i,o,a)}}}(Ci||(Ci={}));var eo,no=function(){function AnimationUtils(){}return AnimationUtils.evaluateTrack=function(t,e,n,r,i){var o=t.tokenCache[e];if(o||(o=e.split("/"),t.tokenCache[e]=o),o.length>1){var a=o[0],s=au.getComponentByName(n,a);s&&Ci.evaluateProperty(s,o,1,t,r,function(t,e,n){return i(t,e,n)})}},AnimationUtils.applyTrack=function(t,e,n,r){AnimationUtils.evaluateTrack(t.track.instance,t.propertyPath,e,n,function(e,n,i){if(t.transition)if(r<t.transition.duration){var o=r/t.transition.duration;e[n]=t.transition.blend(t.transition.sourceValue,i,o)}else e[n]=t.transition.blend(t.transition.sourceValue,i,1),delete t.transition;else e[n]=i})},AnimationUtils.evaluateAnimation=function(t,e,n,r){for(var i=0,o=t.tracks.data;i<o.length;i++){var a=o[i];if(a.track.instance){var s=e;a.targetName&&!(s=r?r[a.targetName]:e.name===a.targetName?e:e.findChild(a.targetName))||n(a,s)}}},AnimationUtils.applyAnimation=function(t,e,n,r,i){AnimationUtils.evaluateAnimation(t,e,function(t,e){AnimationUtils.applyTrack(t,e,n,r)},i)},AnimationUtils.playAnimation=function(t,e,n){AnimationUtils.playAnimationInstance(t,e,n),AnimationUtils.fetchTargetsIfNecessary(t,e),AnimationUtils.resetAnimationTransition(e)},AnimationUtils.playAnimationInstance=function(t,e,n){n&&void 0!==n.startTime&&(e.localTime=e.animation.duration*W.clamp(n.startTime,0,1)),e.isPlaying=!0,e.playCount=0,e.playTime=0},AnimationUtils.fetchTargetsIfNecessary=function(t,e){if(!e.targets){e.targets={};for(var n=0,r=e.animation.tracks.data;n<r.length;n++){var i=r[n];if(i.targetName){var o=t.name===i.targetName?t:t.findChild(i.targetName);o&&(e.targets[i.targetName]=o)}}}},AnimationUtils.resetAnimationTransition=function(t){for(var e=0,n=t.animation.tracks.data;e<n.length;e++){delete n[e].transition}},AnimationUtils}(),ro=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),io=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},oo=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.animationsKey="_animations",t.getAnimationInstance=function getAnimationInstance(t,e){var n=e[t];if(n)return n;for(var r=0,i=e;r<i.length;r++){var o=i[r],a=o.animation;if(a&&a.name===t)return o}return null}}(eo||(eo={}));var ao,so=function(t){function AnimationComponent(){var e=null!==t&&t.apply(this,arguments)||this;return e.animationFinished=new S.AsyncEvent,e._animations=new xt(to),e}return ro(AnimationComponent,t),Object.defineProperty(AnimationComponent.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationComponent.prototype,"animations",{get:function(){return this._animations.data},enumerable:!0,configurable:!0}),AnimationComponent.prototype.isLoaded=function(){if(!t.prototype.isLoaded.call(this))return!1;for(var e=0,n=this.animations;e<n.length;e++){if(!n[e].isLoaded())return!1}return!0},AnimationComponent.prototype.destroy=function(){for(var e=0,n=this.animations;e<n.length;e++){n[e].destroy()}t.prototype.destroy.call(this)},AnimationComponent.prototype.playAnimationByIndex=function(t,e){if(t<this.animations.length){var n=this.animations[t];no.playAnimation(this.entity,n,e)}},AnimationComponent.prototype.playAnimation=function(t,e){var n=eo.getAnimationInstance(t,this.animations);n&&no.playAnimation(this.entity,n,e)},AnimationComponent.prototype.transitionToAnimation=function(t,e,n){var r=eo.getAnimationInstance(e,this.animations),i=r?r.animation:null;if(i){var o=eo.getAnimationInstance(t,this.animations),a=o?o.animation:null;if(a&&!W.isZero(n.duration)){o.isPlaying=!1;no.evaluateAnimation(a,this.entity,function(t,e){var a=i.tracks.data.find(function(e){return e.propertyPath===t.propertyPath&&e.targetName===t.targetName});a&&no.evaluateTrack(t.track.instance,t.propertyPath,e,o.localTime,function(t,e,i){var o="Vector3"===i.constructor.name?function(t,e,n){return V.fromPool().lerpVectors(t,e,n)}:"Quaternion"===i.constructor.name?function(t,e,n){return it.fromPool().slerpQuaternions(t,e,n)}:"Number"===i.constructor.name?function(t,e,n){return W.lerp(t,e,n)}:(k.logWarning("Animation transitions not supported for tracks of type '"+i.constructor.name+"'"),null);if(o){var s=n.duration||.3,c=r.animation.duration,u=W.clamp(s,0,c-W.EPSILON);W.isZero(u)||(a.transition={sourceValue:JSON.parse(JSON.stringify(i)),duration:u,blend:o})}})}),no.playAnimationInstance(this.entity,r,n),no.fetchTargetsIfNecessary(this.entity,r)}else no.playAnimation(this.entity,r,n)}},AnimationComponent.prototype.stopAllAnimations=function(t){for(var e=0,n=this.animations;e<n.length;e++){var r=n[e];r.isPlaying&&(!0===t?r.requestStop():(r.animation&&this.animationFinished.post(r.animation.name),r.isPlaying=!1))}},AnimationComponent.prototype.stopAnimation=function(t,e){var n=eo.getAnimationInstance(t,this.animations);n&&n.isPlaying&&(!0===e?n.requestStop():(n.animation&&this.animationFinished.post(n.animation.name),n.isPlaying=!1))},AnimationComponent.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_animations:t.properties.animations}),delete t.properties.animations),t},AnimationComponent.prototype.addAnimation=function(t){var e=new to;e.animation=t,this._animations.grow(e)},io([unserializable(),oo("design:type",Object)],AnimationComponent.prototype,"animationFinished",void 0),AnimationComponent=io([displayName("AnimationComponent"),helpUrl("https://docs.spiderengine.io/animation.html")],AnimationComponent)}(Et),co=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),uo=function(t){function HudControl(e){var n=t.call(this)||this;return n.name=e,n}return co(HudControl,t),HudControl}(_),lo=function(t){function HudNumber(e,n,r,i,o){var a=t.call(this,e)||this;return a.initialValue=n,a.min=r,a.max=i,a.onChanged=o,a}return co(HudNumber,t),HudNumber}(uo),po=function(t){function HudBoolean(e,n,r){var i=t.call(this,e)||this;return i.initialValue=n,i.onChanged=r,i}return co(HudBoolean,t),HudBoolean}(uo),ho=function(t){function HudCommand(e,n){var r=t.call(this,e)||this;return r.onTriggered=n,r}return co(HudCommand,t),HudCommand}(uo);!function(t){var e,n,r;t.hud=null,t.constrolsInitializedOnce=!1,t.hudAssets=[{path:"Assets/DefaultAssets/Hud/Prefabs/EngineHud.Prefab",set:function(e){return t.hudPrefab=e},get:function(){return t.hudPrefab}},{path:"Assets/DefaultAssets/Hud/Prefabs/Property.Prefab",set:function(e){return t.hudProperty=e},get:function(){return t.hudProperty}}],t.factory={HudCommand:{path:"Assets/DefaultAssets/Hud/Controls/Command/Command.Prefab",set:function(t){return e=t},get:function(){return e}},HudNumber:{path:"Assets/DefaultAssets/Hud/Controls/Slider/Slider.Prefab",set:function(t){return n=t},get:function(){return n}},HudBoolean:{path:"Assets/DefaultAssets/Hud/Controls/CheckBox/CheckBox.Prefab",set:function(t){return r=t},get:function(){return r}}},t.getHudAsset=function getHudAsset(e){return e in t.factory?t.factory[e].get():(console.assert(!1,"getHudAsset('"+e+"') returned null."),null)}}(ao||(ao={}));var fo,yo,mo=function(){function EngineHud(){}return EngineHud.load=function(){Promise.all(Object.keys(ao.factory).map(function(t){return new Promise(function(e,n){R.instance.loadObject(ao.factory[t].path).then(function(n){ao.factory[t].set(n[0]),e()}).catch(n)})})).then(function(){return Promise.all(ao.hudAssets.map(function(t){return new Promise(function(e,n){R.instance.loadObject(t.path).then(function(n){t.set(n[0]),e()}).catch(n)})}))})},EngineHud.isLoaded=function(){for(var t=0,e=Object.keys(ao.hudAssets);t<e.length;t++){var n=e[t];if(!ao.hudAssets[n].get().isLoaded())return!1}return!0},EngineHud.create=function(){return console.assert(!ao.hud),ao.hudPrefab?(ao.hud=Dt.create({prefab:ao.hudPrefab}),ao.hud):null},EngineHud.setControls=function(t){if(ao.hud||(ao.hud=EngineHud.create(),ao.hud)){var e=ao.hud.getComponent(hr),n=e.list;n.removeAllChildren();for(var r=4,i=function(e){var i=t[e],o=Dt.create({prefab:ao.getHudAsset(i.constructor.name)}),a=null;if(i.isA(lo)){var s=i;(a=Dt.create({prefab:ao.hudProperty})).findChild("Name").getComponent(Mi).text=s.name,Object.assign(au.setComponentByName(o,"Proxy"),{onChanged:function(t){var e=i.onChanged;e&&e(t)}});var c=o.getComponent(hr);c.initialValue=s.initialValue,c.min=s.min,c.max=s.max,Object.assign(c,{initialValue:s.initialValue}),a.findChild("Value").addChild(o)}else if(i.isA(po)){var u=i;(a=Dt.create({prefab:ao.hudProperty})).findChild("Name").getComponent(Mi).text=u.name,Object.assign(au.setComponentByName(o,"Proxy"),{onChanged:function(t){var e=i.onChanged;e&&e(t)}}),o.getComponent(Ui).isChecked=u.initialValue,a.findChild("Value").addChild(o)}else i.isA(ho)&&((a=o).findChild("Text").getComponent(Mi).text=i.name,Object.assign(au.setComponentByName(a,"Proxy"),{onClicked:function(){i.onTriggered()}}));a&&(a.getComponent(vr).offset.y=r,n.addChild(a),r+=34)},o=0;o<t.length;++o)i(o);var a=n.getComponent(vr);a.height.value=r;var s=e.close;if(s.getComponent(vr).offset.y=a.offset.y+r,!ao.constrolsInitializedOnce){n.active=!0;var c=n.getComponent(so);c.playAnimation(0),c.animationFinished.once(function(){return s.active=!0}),ao.constrolsInitializedOnce=!0}}},EngineHud.onSceneDestroyed=function(){ao.hud=null,ao.constrolsInitializedOnce=!1},EngineHud}();fo||(fo={}),function(t){t.setProjectId=function setProjectId(t){fo.projectId=t}}(yo||(yo={}));var vo,go,_o=function(){function Project(){}return Object.defineProperty(Project,"projectId",{get:function(){if(fo.projectId)return fo.projectId;var t=sessionStorage.getItem("project_info");return t?JSON.parse(t).info.projectId:"default_project_id"},enumerable:!0,configurable:!0}),Object.defineProperty(Project,"projectName",{get:function(){var t=sessionStorage.getItem("project_info");return t?JSON.parse(t).info.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(Project,"isOpenSource",{get:function(){var t=sessionStorage.getItem("project_info");return!!t&&JSON.parse(t).info.isOpenSource},enumerable:!0,configurable:!0}),Project.importToEditor=function(){var t=sessionStorage.getItem("project_info");if(t){var e=JSON.parse(t).importUrl;window.open(e)}else console.assert(!1,"Can't import project because import information is missing.")},Project}();vo||(vo={}),function(t){(go||(go={})).preload=function preload(){return new Promise(function(t,e){var n=_o.projectId,r=localStorage.getItem("saved_data_"+n);vo.savedData=r?JSON.parse(r):{},t()})}}();var bo,wo,xo=function(){function SavedData(){}return SavedData.get=function(){return vo.savedData},SavedData.flush=function(){localStorage.setItem("saved_data_"+_o.projectId,JSON.stringify(vo.savedData,null,2))},SavedData}();!function(t){t.gamepadEventsSupported="ongamepadconnected"in window,t.gamepadMap={},t.onGamepadConnected=function onGamepadConnected(e){var n=e;t.gamepadMap[n.gamepad.index]=n.gamepad},t.onGamepadDisconnected=function onGamepadDisconnected(e){var n=e;delete t.gamepadMap[n.gamepad.index]}}(bo||(bo={})),function(t){function scanGamepads(){if(!bo.gamepadEventsSupported){for(var t=navigator,e=navigator.getGamepads?navigator.getGamepads():t.webkitGetGamepads?t.webkitGetGamepads():[],n={},r=0;r<e.length;r++){if(e[r])n[a=e[r].index]=!0,bo.gamepadMap[a]=e[r]}for(var i=0,o=Object.keys(bo.gamepadMap);i<o.length;i++){var a;(a=o[i])in n||(bo.gamepadMap[a]=null)}}}t.scanGamepads=scanGamepads,t.initialize=function initialize(){bo.gamepadEventsSupported?(window.addEventListener("gamepadconnected",bo.onGamepadConnected),window.addEventListener("gamepaddisconnected",bo.onGamepadDisconnected)):setTimeout(scanGamepads,500)},t.destroy=function destroy(){bo.gamepadEventsSupported&&(window.removeEventListener("gamepadconnected",bo.onGamepadConnected),window.removeEventListener("gamepaddisconnected",bo.onGamepadDisconnected))}}(wo||(wo={}));var Po,Oo=function(){function Gamepads(){}return Gamepads.get=function(t){var e=bo.gamepadMap[t];return e||null},Gamepads.forEach=function(t){for(var e=Object.values(bo.gamepadMap),n=0;n<e.length;++n){var r=e[n];r&&t(r,n)}},Gamepads}();(Po||(Po={})).batchListeners={};var Co,So,jo=function(){function AsyncUtils(){}return AsyncUtils.processBatch=function(t,e,n){var r=w.makeUniqueId(),i=0,o=!1,a=function(){++i>=t.length&&r in Po.batchListeners&&(Po.batchListeners[r](o),delete Po.batchListeners[r])};if(t.length>0){Po.batchListeners[r]=n;for(var s=0,c=t;s<c.length;s++){e(c[s],a,function(){o=!0,a()})}}else n(!1);return r},AsyncUtils.detachBatchListener=function(t){delete Po.batchListeners[t]},AsyncUtils}();!function(t){t.objectCache={},t.objectLoadingInProgress={},t.loadObjectFromData=function loadObjectFromData(e,n){var r=JSON.parse(n),i=g.instance.createObject(r.typeName);return t.objectCache[e]=i,i.isA(A)&&(i.isPersistent=!0),i.templatePath=e,i.deserialize(r)}}(Co||(Co={})),function(t){function loadObject(t,e,n,r){var i=Co.objectCache[t];if(i){if(!r)return void e(i,!0);delete Co.objectCache[t]}var o={loaded:e,error:n},a=Co.objectLoadingInProgress[t];a?a.push(o):(Co.objectLoadingInProgress[t]=[o],vt.instance.read(t).then(function(e){Co.loadObjectFromData(t,e).then(function(e){for(var n=0,r=Co.objectLoadingInProgress[t];n<r.length;n++){r[n].loaded(e,!1)}delete Co.objectLoadingInProgress[t]})}).catch(function(e){for(var n=0,r=Co.objectLoadingInProgress[t];n<r.length;n++){r[n].error(e)}delete Co.objectLoadingInProgress[t]}))}t.loadObject=loadObject,t.loadObjectById=function loadObjectById(t,e,n){var r=Qo.getPath(t);r?loadObject(r,e,n,!1):n()},t.loadObjectIgnoreCache=function loadObjectIgnoreCache(t){return new Promise(function(e,n){loadObject(t,function(t){return e([t,!1])},n,!0)})},t.objectCache=function(){return Co.objectCache}}(So||(So={}));var Ro,To=function(){function ObjectManager(){}return ObjectManager.prototype.loadObject=function(t){return new Promise(function(e,n){So.loadObject(t,function(t,n){return e([t,n])},n,!1)})},ObjectManager.prototype.loadObjectById=function(t){return new Promise(function(e,n){So.loadObjectById(t,function(t,n){return e([t,n])},n)})},ObjectManager.prototype.getObject=function(t){var e=Qo.getPath(t);return e&&e in Co.objectCache?Co.objectCache[e]:null},ObjectManager.prototype.saveObject=function(t){var e=t.id,n=Qo.getPath(e);return n?this.saveObjectAtPath(t,n):(k.log("Could not save object with id '"+e+"' (could not resolve its path)"),Promise.reject())},ObjectManager.prototype.saveObjectAtPath=function(t,e,n){return new Promise(function(r,i){var o=JSON.stringify(t.serialize(),null,2);vt.instance.write(e,o).then(function(){n||ko.recordAssetChange(Ao.update,[t.id]),fn.objectSaved.post(t),r()}).catch(i)})},ObjectManager.prototype.renameObject=function(t,e){var n=this;ko.parseFilePath(e,function(r,i){if(t in Co.objectCache){var o=Co.objectCache[t];delete Co.objectCache[t],o.templatePath=e,Co.objectCache[e]=o,o.name=r,n.saveObjectAtPath(o,e)}else ko.parseFilePath(t,function(t,i){t!==r&&n.loadObject(e).then(function(t){var i=t[0];i.name=r,n.saveObjectAtPath(i,e)})})})},ObjectManager.prototype.deleteObject=function(t){t.destroy(),t.templatePath&&delete Co.objectCache[t.templatePath]},ObjectManager.prototype.deleteObjectById=function(t){var e=Qo.getPath(t);e&&this.deleteObjectByPath(e)},ObjectManager.prototype.deleteObjectByPath=function(t){var e=Co.objectCache[t];e&&(this.deleteObject(e),delete Co.objectCache[t])},ObjectManager.prototype.loadGraphicObjects=function(){for(var t=0,e=Object.values(Co.objectCache);t<e.length;t++){var n=e[t];n.isA(L)&&n.graphicLoad()}},ObjectManager.prototype.unloadGraphicObjects=function(){for(var t=0,e=Object.values(Co.objectCache);t<e.length;t++){var n=e[t];n.isA(L)&&n.graphicUnload()}},ObjectManager.prototype.addToCache=function(t){var e=t.templatePath;console.assert(e),console.assert(!(e in Co.objectCache)),Co.objectCache[e]=t},ObjectManager.prototype.clearCache=function(){for(var t=0,e=Object.values(Co.objectCache);t<e.length;t++){e[t].destroy()}Co.objectCache={}},ObjectManager.prototype.forEach=function(t){for(var e=0,n=Object.values(Co.objectCache);e<n.length;e++){t(n[e])}},ObjectManager}();!function(t){(So||(So={})).create=function create(){R.instance=new To}}(),function(t){t[t.IndexedDbCreationFailed=0]="IndexedDbCreationFailed",t[t.EngineSettingsLoadFailed=1]="EngineSettingsLoadFailed",t[t.AssetIdsLoadFailed=2]="AssetIdsLoadFailed",t[t.WebGLContextCreationFailed=3]="WebGLContextCreationFailed"}(Ro||(Ro={}));var Eo,Bo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();!function(t){t.path="spider-engine.json"}(Eo||(Eo={}));var Ao,Io=function(t){function EngineSettings(){var e=null!==t&&t.apply(this,arguments)||this;return e.canvasAlpha=!0,e.startupScene=void 0,e}return Bo(EngineSettings,t),Object.defineProperty(EngineSettings.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),EngineSettings.load=function(){var t=this;return new Promise(function(e,n){So.loadObjectIgnoreCache(Eo.path).then(function(n){t._instance=n[0],e()}).catch(function(){t._instance=new EngineSettings,console.warn("spider-engine.json not found. Falling back to factory settings."),e()})})},Object.defineProperty(EngineSettings,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),EngineSettings.prototype.upgrade=function(t,e){return 1===e?delete t.properties.startupScenePath:2===e&&(console.assert(!1),Object.assign(t.properties,{startupScene:Qo.getPath(t.properties.startupSceneId)}),console.assert(t.properties.startupScene),delete t.properties.startupSceneId),t},EngineSettings.prototype.save=function(){R.instance.saveObjectAtPath(this,Eo.path)},EngineSettings}(C),Mo=n(65);!function(t){t[t.update=0]="update",t[t.delete=1]="delete",t[t.create=2]="create"}(Ao||(Ao={}));var zo,ko=function(){function IOUtils(){}return IOUtils.recordAssetChange=function(t,e){var n=JSON.stringify(Date.now());localStorage.setItem("last_asset_write_time",n),localStorage.setItem("asset_changed",JSON.stringify({timeStamp:n,action:t,ids:e,metadata:IOUtils.assetChangeMetaData})),IOUtils.assetChangeMetaData&&(IOUtils.assetChangeMetaData=void 0)},IOUtils.parseFileName=function(t,e){var n=t.split(".");if(n.length>1){var r=n.pop();e(n.reduce(function(t,e){return t+"."+e}),r)}else e(t,"")},IOUtils.parseFilePath=function(t,e){var n=t.split(/[\/\\]+/);if(n.length>1){var r=n.slice(-1)[0];IOUtils.parseFileName(r,e)}else IOUtils.parseFileName(t,e)},IOUtils.parseFolderPath=function(t,e){var n=t.split(/[\/\\]+/);n.length>1?(n.pop(),e(n.reduce(function(t,e){return t+"/"+e}))):e(t)},IOUtils.parseFolderName=function(t,e){e(t.split(/[\/\\]+/).pop()||"")},IOUtils.importGameFromBlob=function(t,e,n){var r=function(t,r){t?e(r||!1):n()};(new Mo).loadAsync(t).then(function(t){var e={},n=Object.keys(t.files);jo.processBatch(n,function(n,r,i){var o=t.file(n);o?o.async("string").then(function(t){["Assets/EngineSettings.json"].some(function(t){return t===n})?n=Eo.path:["idDatabase"].some(function(t){return t===n})&&(n=Xo.path),e[n]=t,r()},i):r()},function(t){var n=Object.keys(e);jo.processBatch(n,function(t,n,r){var i=e[t];vt.instance.write(t,i).then(function(){return n()}).catch(function(){return r()})},function(t){r(!0,t)})})},function(){return r(!1)}).catch(function(){return r(!1)})},IOUtils.isDefaultAsset=function(t){var e=t.split("/");return e.length>1&&("Assets"===e[0]&&"DefaultAssets"===e[1])},IOUtils.assetChangeMetaData=void 0,IOUtils}(),Do=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Fo=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Lo=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},No=function(t){function Folder(){var e=null!==t&&t.apply(this,arguments)||this;return e.ids=new xt(String),e.folders=new xt(Folder),e.assetVersion=1,e}return Do(Folder,t),Folder.prototype.isAncestor=function(t){return this.parent===t||!!this.parent&&this.parent.isAncestor(t)},Folder.prototype.findFolder=function(t){return this.folders.data.find(function(e){return e.name===t})},Folder.prototype.assignParentNodes=function(){for(var t=0,e=this.folders.data;t<e.length;t++){var n=e[t];n.parent=this,n.assignParentNodes()}},Fo([Attributes_hidden(),Lo("design:type",Object)],Folder.prototype,"ids",void 0),Fo([Attributes_hidden(),Lo("design:type",Object)],Folder.prototype,"folders",void 0),Fo([unserializable(),Lo("design:type",Folder)],Folder.prototype,"parent",void 0),Fo([Attributes_hidden(),Lo("design:type",Object)],Folder.prototype,"assetVersion",void 0),Folder}(C);!function(t){function getFolderPath(t){for(var e=t.parent,n=t.name;e;)n=e.name+"/"+n,e=e.parent;return n}t.getFolderPath=getFolderPath,t.isDefault=function isDefault(t){var e=getFolderPath(t);return ko.isDefaultAsset(e)}}(zo||(zo={}));var Vo,Uo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Wo=function(t){function Folders(){var e=t.call(this)||this;return e.assets=new No,e.externals=new No,e}return Uo(Folders,t),Folders}(C);!function(t){function save(){return R.instance.saveObjectAtPath(t.folders,t.foldersPath)}t.foldersPath="Assets/folders.json",t.externalsPath="External Assets",t.load=function load(){return new Promise(function(e){So.loadObjectIgnoreCache(t.foldersPath).then(function(n){t.folders=n[0],t.folders.assets.assignParentNodes(),t.folders.externals.assignParentNodes(),e([t.folders,!1])}).catch(function(){t.folders=new Wo,t.folders.assets.name="Assets",t.folders.externals.name=t.externalsPath,save().then(function(){return e([t.folders,!0])})})})},t.save=save}(Vo||(Vo={}));var qo,Go=function(){return(Go=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};!function(t){t.idDatabase={},t.defaultAssetIds={},t.externalsIdDatabase={}}(qo||(qo={}));var Ho,Ko,Xo=function(){function AssetIdDatabaseInternal(){}return Object.defineProperty(AssetIdDatabaseInternal,"fileName",{get:function(){return"ids.json"},enumerable:!0,configurable:!0}),Object.defineProperty(AssetIdDatabaseInternal,"path",{get:function(){return"Assets/"+AssetIdDatabaseInternal.fileName},enumerable:!0,configurable:!0}),Object.defineProperty(AssetIdDatabaseInternal,"defaultAssetIds",{set:function(t){qo.defaultAssetIds=t,qo.idDatabase=Go({},qo.defaultAssetIds)},enumerable:!0,configurable:!0}),Object.defineProperty(AssetIdDatabaseInternal,"idDatabase",{get:function(){return qo.idDatabase},enumerable:!0,configurable:!0}),AssetIdDatabaseInternal.load=function(){return new Promise(function(t,e){vt.instance.read(AssetIdDatabaseInternal.path).then(function(e){qo.idDatabase=Go({},qo.defaultAssetIds,JSON.parse(e)),t()}).catch(function(){return e(Ro.AssetIdsLoadFailed)})})},AssetIdDatabaseInternal.reload=function(){return qo.idDatabase=Go({},qo.defaultAssetIds),AssetIdDatabaseInternal.load()},AssetIdDatabaseInternal.getPath=function(t){var e=qo.idDatabase[t];return e||null},AssetIdDatabaseInternal.setPath=function(t,e){qo.idDatabase[t]=e,AssetIdDatabaseInternal.save().then(function(){ko.recordAssetChange(Ao.create,[t])})},AssetIdDatabaseInternal.setPaths=function(t,e){Object.assign(qo.idDatabase,t),(void 0===e||e)&&AssetIdDatabaseInternal.save().then(function(){ko.recordAssetChange(Ao.create,Object.keys(t))})},AssetIdDatabaseInternal.save=function(){return vt.instance.write(AssetIdDatabaseInternal.path,JSON.stringify(qo.idDatabase,null,2))},AssetIdDatabaseInternal.deleteId=function(t){delete qo.idDatabase[t],AssetIdDatabaseInternal.save().then(function(){ko.recordAssetChange(Ao.delete,[t])}),AssetIdDatabaseInternal.events.assetsDeleted.post([t])},AssetIdDatabaseInternal.deleteIds=function(t,e){for(var n=0,r=t;n<r.length;n++){var i=r[n].valueOf();delete qo.idDatabase[i]}if(void 0===e||e){var o=t.map(function(t){return t.valueOf()});AssetIdDatabaseInternal.events.assetsDeleted.post(o),AssetIdDatabaseInternal.save().then(function(){ko.recordAssetChange(Ao.delete,o)})}},AssetIdDatabaseInternal.loadExternalIds=function(){qo.externalsIdDatabase={};var t=Vo.folders.externals.folders.data;return new Promise(function(e){jo.processBatch(t,function(t,e){AssetIdDatabaseInternal.addExternalIdDatabase(t.name,zo.getFolderPath(t)).then(e)},function(){return e()})})},AssetIdDatabaseInternal.addExternalIdDatabase=function(t,e){return new Promise(function(n){vt.instance.read(e+"/"+AssetIdDatabaseInternal.path).then(function(e){var r=JSON.parse(e);qo.externalsIdDatabase[t]=r,n()}).catch(n)})},AssetIdDatabaseInternal.deleteExternalIds=function(t){delete qo.externalsIdDatabase[t]},AssetIdDatabaseInternal.events={assetsDeleted:new S.AsyncEvent,assetMoved:new S.AsyncEvent},AssetIdDatabaseInternal}(),Qo=function(){function AssetIdDatabase(){}return AssetIdDatabase.getPath=function(t){return Xo.getPath(t)},AssetIdDatabase}();(Ho||(Ho={})).loadingMap=new Map,function(t){t.updateLoading=function updateLoading(){var t=Ho.loadingMap;if(0===t.size)return!1;var e=[];t.forEach(function(t,n){if(n.isLoaded()){for(var r=0,i=t;r<i.length;r++)i[r].post();e.push(n)}});for(var n=0,r=e;n<r.length;n++){var i=r[n];t.delete(i)}return t.size>0}}(Ko||(Ko={}));var Yo,Zo=function(){function Assets(){}return Assets.load=function(t){return new Promise(function(e,n){R.instance.loadObject(t).then(function(t){var n=t[0];if(n.isLoaded())e(n);else{var r=Ho.loadingMap,i=r.get(n);i?i.push(new S.VoidAsyncEvent):(i=[new S.VoidAsyncEvent],r.set(n,i)),i[i.length-1].once(function(){return e(n)})}}).catch(n)})},Assets.loadById=function(t){var e=Qo.getPath(t);return e?Assets.load(e):Promise.reject("Could not resolve path for asset with id '"+t+"'")},Assets}(),Jo=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),$o=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ta=function(t){function CollisionGroup(){return null!==t&&t.apply(this,arguments)||this}return Jo(CollisionGroup,t),CollisionGroup=$o([displayName("Collision Group")],CollisionGroup)}(A),ea=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),na=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ra=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};(Yo||(Yo={})).emptyArray=new Zt(ta);var ia,oa=function(t){function CollisionFilter(){return null!==t&&t.apply(this,arguments)||this}return ea(CollisionFilter,t),CollisionFilter.prototype.getIncluded=function(){return Yo.emptyArray},CollisionFilter.prototype.getExcluded=function(){return Yo.emptyArray},CollisionFilter.prototype.detach=function(){this.getExcluded().detach(),this.getIncluded().detach()},CollisionFilter.prototype.canCollideWith=function(t){var e=Boolean(t);return!(!!e&&this.getExcluded().data.some(function(e){return e.asset===t}))&&(!(this.getIncluded().data.length>0)||e&&this.getIncluded().data.some(function(e){return e.asset===t}))},CollisionFilter}(_),aa=function(t){function InclusionCollisionFilter(e){var n=t.call(this)||this;return n._included=new Zt(ta),e&&(n._included.data=e.map(function(t){return new Yt(ta,t)})),n}return ea(InclusionCollisionFilter,t),InclusionCollisionFilter.prototype.getIncluded=function(){return this._included},InclusionCollisionFilter=na([displayName("Include"),ra("design:paramtypes",[Array])],InclusionCollisionFilter)}(oa),sa=function(t){function ExclusionCollisionFilter(e){var n=t.call(this)||this;return n._excluded=new Zt(ta),e&&(n._excluded.data=e.map(function(t){return new Yt(ta,t)})),n}return ea(ExclusionCollisionFilter,t),ExclusionCollisionFilter.prototype.getExcluded=function(){return this._excluded},ExclusionCollisionFilter=na([displayName("Exclude"),ra("design:paramtypes",[Array])],ExclusionCollisionFilter)}(oa);!function(t){t[t.Normal=0]="Normal",t[t.Particles=1]="Particles"}(ia||(ia={}));var ca,ua=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),la=function(t){function CollisionShape(){return null!==t&&t.apply(this,arguments)||this}return ua(CollisionShape,t),CollisionShape.prototype.getTestPriority=function(){return ia.Normal},CollisionShape.prototype.checkCollisions=function(t,e,n,r){},CollisionShape}(_);!function(t){!function(t){t.boxMin=new V,t.boxMax=new V}(t.boxIntersectsWithSphere||(t.boxIntersectsWithSphere={})),function(t){t._sphereWorldPos=new V}(t.boxIntersectsWithSphereShape||(t.boxIntersectsWithSphereShape={})),function(t){t.box1Min=new V,t.box1Max=new V,t.box2Min=new V,t.box2Max=new V}(t.boxIntersectsWithBox||(t.boxIntersectsWithBox={})),function(t){t._sphere1WorldPos=new V,t._sphere2WorldPos=new V}(t.sphereIntersectsWithSphereShape||(t.sphereIntersectsWithSphereShape={})),t.getBoxShapeMin=function getBoxShapeMin(t,e,n){return n.set(t.center.x-t.extent.x+e.x,t.center.y-t.extent.y+e.y,t.center.z-t.extent.z+e.z).asArray()},t.getBoxShapeMax=function getBoxShapeMax(t,e,n){return n.set(t.center.x+t.extent.x+e.x,t.center.y+t.extent.y+e.y,t.center.z+t.extent.z+e.z).asArray()}}(ca||(ca={}));var pa,ha=function(){function CollisionUtils(){}return CollisionUtils.boxIntersectsWithSphereShape=function(t,e,n,r){var i=ca.boxIntersectsWithSphereShape._sphereWorldPos,o=V.dummy.copy(n.center).rotate(r.worldRotation);return i.addVectors(o,r.worldPosition),CollisionUtils.boxIntersectsWithSphere(t,e.worldPosition,i,n.radius)},CollisionUtils.boxIntersectsWithSphere=function(t,e,n,r){for(var i=0,o=0,a=ca.boxIntersectsWithSphere,s=a.boxMin,c=a.boxMax,u=ca.getBoxShapeMin(t,e,s),l=ca.getBoxShapeMax(t,e,c),p=n.asArray(),h=0;h<3;++h)p[h]<u[h]?o+=(i=p[h]-u[h])*i:p[h]>l[h]&&(o+=(i=p[h]-l[h])*i);return o<=r*r},CollisionUtils.boxIntersectsWithBox=function(t,e,n,r){for(var i=ca.boxIntersectsWithBox,o=i.box1Min,a=i.box1Max,s=i.box2Min,c=i.box2Max,u=ca.getBoxShapeMin(t,e,o),l=ca.getBoxShapeMax(t,e,a),p=ca.getBoxShapeMin(n,r,s),h=ca.getBoxShapeMax(n,r,c),f=0;f<3;++f)if(u[f]>h[f])return!1;for(f=0;f<3;++f)if(p[f]>l[f])return!1;return!0},CollisionUtils.sphereIntersectsWithSphereShape=function(t,e,n,r){var i=ca.sphereIntersectsWithSphereShape,o=i._sphere1WorldPos,a=i._sphere2WorldPos,s=V.dummy.copy(t.center).rotate(e.worldRotation),c=V.dummy2.copy(n.center).rotate(r.worldRotation);return o.addVectors(s,e.worldPosition),a.addVectors(c,r.worldPosition),this.sphereIntersectsWithSphere(o,t.radius,a,n.radius)},CollisionUtils.sphereIntersectsWithSphere=function(t,e,n,r){var i=e+r;return V.distanceSq(t,n)<i*i},CollisionUtils}(),fa=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),da=function(t){function SphereCollisionShape(e){var n=t.call(this)||this;return n.tag="Sphere",n.center=new V,n.radius=1,e&&n.setState(e),n}return fa(SphereCollisionShape,t),SphereCollisionShape.prototype.checkCollisions=function(t,e,n,r){if(t.isA(ma)){var i=t;ha.boxIntersectsWithSphereShape(i,n,this,e)&&r()}else if(t.isA(SphereCollisionShape)){var o=t;ha.sphereIntersectsWithSphereShape(this,e,o,n)&&r()}},SphereCollisionShape}(la),ya=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ma=function(t){function BoxCollisionShape(e){var n=t.call(this)||this;return n.tag="Box",n.center=new V,n.extent=new V(1,1,1),e&&n.setState(e),n}return ya(BoxCollisionShape,t),BoxCollisionShape.prototype.checkCollisions=function(t,e,n,r){if(t.isA(BoxCollisionShape)){var i=t;ha.boxIntersectsWithBox(this,e.worldPosition,i,n.worldPosition)&&r()}else if(t.isA(da)){var o=t;ha.boxIntersectsWithSphereShape(this,e,o,n)&&r()}},BoxCollisionShape}(la),va=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ga=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},_a=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ba=function(t){function Collider(e){var n=t.call(this)||this;return n._group=new Yt(ta),n._filter=new l(oa),n._shapes=new Ot(la),n._collision=new S.SyncEvent,e&&n.setState(e),0===n.shapes.length&&n._shapes.grow(new ma),n}var e,n;return va(Collider,t),Object.defineProperty(Collider.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Collider.prototype,"group",{get:function(){return this._group.asset},enumerable:!0,configurable:!0}),Object.defineProperty(Collider.prototype,"shapes",{get:function(){return this._shapes.data.filter(function(t){return Boolean(t.instance)}).map(function(t){return t.instance})},set:function(t){var e=this;this._shapes.clear(),t.forEach(function(t){return e._shapes.grow(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(Collider.prototype,"filter",{get:function(){return this._filter.instance},enumerable:!0,configurable:!0}),Object.defineProperty(Collider.prototype,"onCollision",{set:function(t){this._collision.detach(),t&&this._collision.attach(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Collider.prototype,"collision",{get:function(){return this._collision},enumerable:!0,configurable:!0}),Collider.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.getOrSetComponent(zt)},Collider.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_shapes:t.properties.shapes}),delete t.properties.shapes),t},Collider.prototype.destroy=function(){t.prototype.destroy.call(this),this._collision.detach(),this.filter&&this.filter.detach()},ga([(n="BoxCollisionShape",Reflect.metadata("defaultType",n)),(e=!1,Reflect.metadata("nullable",e)),_a("design:type",Object)],Collider.prototype,"_shapes",void 0),ga([unserializable(),_a("design:type",Object)],Collider.prototype,"_collision",void 0),Collider}(Et),wa=function(){return(wa=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},xa=function(){function Components(){}return Components.ofType=function(t){for(var e=[],n=0,r=pu.list();n<r.length;n++){var i=r[n];e=e.concat(i.root.getComponents(t))}return e},Components.ofTypes=function(t){var e=t.reduce(function(t,e){var n;return wa({},t,((n={})[e.name]=[],n))},{});return pu.list().forEach(function(n){n.root.traverse(function(n){if(!n.active)return!1;for(var r=0,i=t;r<i.length;r++){var o=i[r],a=n.getComponent(o);a&&a.active&&e[o.name].push(a)}return!0})}),e},Components}(),Pa=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Oa=function(t){function VisualCollisionShape(e){var n=t.call(this)||this;return n.tag="Visual",n._visual=new Lt(ul),e&&n.setState(e),n}return Pa(VisualCollisionShape,t),Object.defineProperty(VisualCollisionShape.prototype,"visualEntity",{set:function(t){this._visual.component=t.getComponent(ul)},enumerable:!0,configurable:!0}),Object.defineProperty(VisualCollisionShape.prototype,"visual",{get:function(){return this._visual.component},enumerable:!0,configurable:!0}),VisualCollisionShape.prototype.checkCollisions=function(t,e,n,r){},VisualCollisionShape}(la),Ca=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Sa=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ja=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ra=function(t){function StaticMeshAsset(){return null!==t&&t.apply(this,arguments)||this}return Ca(StaticMeshAsset,t),Object.defineProperty(StaticMeshAsset.prototype,"vertexBuffer",{get:function(){return this._vertexBuffer},set:function(t){this._vertexBuffer&&this.graphicUnload(),this._vertexBuffer=t,delete this._boundingBox},enumerable:!0,configurable:!0}),Object.defineProperty(StaticMeshAsset.prototype,"boundingBox",{get:function(){if(!this._boundingBox&&this._vertexBuffer){var t=this._vertexBuffer,e=t.attributes,n=t.primitiveType,r=t.indices;this._boundingBox=at.fromVertexArray(e.position,n,r)}return this._boundingBox},enumerable:!0,configurable:!0}),StaticMeshAsset.prototype.graphicUnload=function(){this._vertexBuffer.unload(ht.context)},Sa([unserializable(),ja("design:type",at)],StaticMeshAsset.prototype,"_boundingBox",void 0),StaticMeshAsset=Sa([displayName("Static Mesh"),editable(!1),referencable(!0)],StaticMeshAsset)}(L),Ta=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Ea=function(t){function MeshCollisionShape(e){var n=t.call(this)||this;return n.tag="Mesh",n.mesh=new Yt(Ra),e&&n.setState(e),n}return Ta(MeshCollisionShape,t),MeshCollisionShape.prototype.checkCollisions=function(t,e,n,r){},MeshCollisionShape}(la),Ba=function(){return function RaycastResult(){this.position=new V,this.normal=new V}}();!function(t){t.aabb=new at,t.result=new Ba,t.localRay=new Ae,t.invWorld=new nt,t.rotatedCenter=new V,t.v1=new V,t.v2=new V,t.v3=new V,t.plane=new se,t.triangle=new tn}(pa||(pa={}));var Aa,Ia,Ma,za=function(){function Physics(){}return Physics.rayCast=function(t,e){for(var n=xa.ofType(ba),r=!1,i=999999,o=pa.aabb,a=pa.result,s=pa.localRay,c=pa.invWorld,u=pa.rotatedCenter,l=pa.v1,p=pa.v2,h=pa.v3,f=pa.plane,d=pa.triangle,y=0,m=n;y<m.length;y++){var v=m[y];if(!e||e.canCollideWith(v.group)){var g=v.shapes[0],_=v.entity.transform;if(g)if(g.isA(da)){var b=g;c.copy(_.worldMatrix).translate(b.center).invert(),s.copy(t).transform(c);var w=s.castOnSphere(V.zero,b.radius);if(w){var x=w.intersection1.transform(_.worldMatrix);(I=V.distance(x,t.origin))<i&&(i=I,a.position.copy(x),a.normal.copy(w.normal1.rotate(_.worldRotation)),a.collider=v,a.shape=g,r=!0)}}else if(g.isA(ma)){var P=g;u.copy(P.center).rotate(_.worldRotation),o.min.set(u.x-P.extent.x,u.y-P.extent.y,u.z-P.extent.z),o.max.set(u.x+P.extent.x,u.y+P.extent.y,u.z+P.extent.z),c.getInverse(_.worldMatrix),s.copy(t).transform(c);var O=s.castOnAABB(o);if(O){x=O.intersection1.transform(_.worldMatrix);(I=V.distance(x,t.origin))<i&&(i=I,a.position.copy(x),a.normal.copy(O.normal1.rotate(_.worldRotation)),a.collider=v,a.shape=g,r=!0)}}else if(g.isA(Oa)||g.isA(Ea)){var C=null;if(g.isA(Oa)){var S=g.visual,j=S?S.geometry:void 0;C=j?j.getVertexBuffer():null}else{var R=g.mesh.asset;C=R?R.vertexBuffer:null}if(C){if("TRIANGLES"!==C.primitiveType||C.indices)continue;for(var T=C.attributes.position,E=T.length/3/3,B=0;B<E;++B){var A=9*B;l.set(T[A],T[A+1],T[A+2]).transform(_.worldMatrix),p.set(T[A+3],T[A+4],T[A+5]).transform(_.worldMatrix),h.set(T[A+6],T[A+7],T[A+8]).transform(_.worldMatrix),f.setFromPoints(l,p,h);var I,M=t.castOnPlane(f);if(M.intersection)if(M.classification===re.Front)if(d.set(l,p,h),d.contains(M.intersection))(I=V.distance(M.intersection,t.origin))<i&&(i=I,a.position.copy(M.intersection),a.normal.copy(f.normal),a.collider=v,a.shape=g,r=!0)}}}}}return r?a:null},Physics}(),ka=function(){function Config(){}return Config.isWeb=function(){return!0},Config.isDesktop=function(){return!1},Config.isProduction=function(){return!0},Config.isDevelopment=function(){return!1},Config.isEditor=function(){return!1},Config.isStandalone=function(){return!0},Config}(),Da=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Fa=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},La=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Na=function(t){function DrawableTexture(){var e=null!==t&&t.apply(this,arguments)||this;return e._width=1024,e._height=768,e._rgba=!1,e._filtering=o.Linear,e._data=new oe.a,e._structureDirty=!0,e._pixelsDirty=!0,e}return Da(DrawableTexture,t),Object.defineProperty(DrawableTexture.prototype,"rgba",{get:function(){return this._rgba},set:function(t){this._rgba=t,this._structureDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(DrawableTexture.prototype,"width",{set:function(t){t!==this._width&&(this._width=t,this._structureDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(DrawableTexture.prototype,"height",{set:function(t){t!==this._height&&(this._height=t,this._structureDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(DrawableTexture.prototype,"data",{set:function(t){this._data.array=t,this._pixelsDirty=!0},enumerable:!0,configurable:!0}),DrawableTexture.prototype.getWidth=function(){return this._width},DrawableTexture.prototype.getHeight=function(){return this._height},DrawableTexture.prototype.begin=function(t){var e=ht.context;return this._textureId?(e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),this._structureDirty&&this.updateStructure(),this._pixelsDirty&&this.uploadTexturePixels()):(this._textureId=e.createTexture(),e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),this._filtering===o.Nearest?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.updateStructure(),this.uploadTexturePixels()),!0},DrawableTexture.prototype.setPixel=function(t,e,n){if(t<0||t>this._width)k.logWarning("DrawableTexture.putPixel: pixel is out of bounds (x = "+t+", width = "+this._width+")");else if(e<0||e>this._height)k.logWarning("DrawableTexture.putPixel: pixel is out of bounds (y = "+t+", height = "+this._height+")");else if(this._textureId){this._structureDirty&&this.updateStructure();var r=this._width*this._bytesPerPixel*e+t*this._bytesPerPixel;this._data.array[r+0]=255*n.r,this._data.array[r+1]=255*n.g,this._data.array[r+2]=255*n.b,this.rgba&&(this._data.array[r+3]=255*n.a),this._pixelsDirty=!0}else k.logWarning("DrawableTexture.putPixel: texture not loaded yet")},DrawableTexture.prototype.updateStructure=function(){this._bytesPerPixel=this._rgba?4:3,this._data.length=this._width*this._height*this._bytesPerPixel,this._structureDirty=!1},DrawableTexture.prototype.uploadTexturePixels=function(){var t=ht.context;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1);var e=this._rgba?t.RGBA:t.RGB;t.texImage2D(t.TEXTURE_2D,0,e,this._width,this._height,0,e,t.UNSIGNED_BYTE,this._data.array),this._pixelsDirty=!1},Fa([Attributes_hidden(),La("design:type",Object)],DrawableTexture.prototype,"_data",void 0),Fa([unserializable(),La("design:type",Object)],DrawableTexture.prototype,"_structureDirty",void 0),Fa([unserializable(),La("design:type",Object)],DrawableTexture.prototype,"_pixelsDirty",void 0),Fa([unserializable(),La("design:type",Number)],DrawableTexture.prototype,"_bytesPerPixel",void 0),DrawableTexture=Fa([creatable(!0),referencable(!0),displayName("Drawable Texture")],DrawableTexture)}(wr);!function(t){t[t.Near=0]="Near",t[t.Far=1]="Far",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Bottom=4]="Bottom",t[t.Top=5]="Top",t[t.Count=6]="Count"}(Aa||(Aa={})),function(t){t[t.FarTopLeft=0]="FarTopLeft",t[t.FarTopRight=1]="FarTopRight",t[t.FarBottomLeft=2]="FarBottomLeft",t[t.FarBottomRight=3]="FarBottomRight",t[t.NearTopLeft=4]="NearTopLeft",t[t.NearTopRight=5]="NearTopRight",t[t.NearBottomLeft=6]="NearBottomLeft",t[t.NearBottomRight=7]="NearBottomRight",t[t.Count=8]="Count"}(Ia||(Ia={})),function(t){!function(t){t.fCenter=new V,t.nCenter=new V,t.temp1=new V,t.temp2=new V}(t.update||(t.update={}))}(Ma||(Ma={}));var Va,Ua=function(){function Frustum(){this._planes=[],this._planes.length=Aa.Count;for(var t=0;t<Aa.Count;++t)this._planes[t]=new se;this._corners=[],this._corners.length=Ia.Count;for(t=0;t<Ia.Count;++t)this._corners[t]=new V}return Object.defineProperty(Frustum.prototype,"corners",{get:function(){return this._corners},enumerable:!0,configurable:!0}),Frustum.prototype.isPointInside=function(t){for(var e=0,n=this._planes;e<n.length;e++){if(n[e].classifyPoint(t)===re.Front)return!1}return!0},Frustum.prototype.update=function(t,e,n,r,i,o,a){var s=Ma.update,c=s.fCenter,u=s.nCenter,l=s.temp1,p=s.temp2;c.copy(a.worldForward).multiply(-o).add(a.worldPosition),this._corners[Ia.FarTopLeft].addVectors(l.copy(a.worldUp).multiply(r),p.copy(a.worldRight).multiply(-n)).add(c),this._corners[Ia.FarTopRight].addVectors(l.copy(a.worldUp).multiply(r),p.copy(a.worldRight).multiply(n)).add(c),this._corners[Ia.FarBottomLeft].addVectors(l.copy(a.worldUp).multiply(-r),p.copy(a.worldRight).multiply(-n)).add(c),this._corners[Ia.FarBottomRight].addVectors(l.copy(a.worldUp).multiply(-r),p.copy(a.worldRight).multiply(n)).add(c),u.copy(a.worldForward).multiply(-i).add(a.worldPosition),this._corners[Ia.NearTopLeft].addVectors(l.copy(a.worldUp).multiply(e),p.copy(a.worldRight).multiply(-t)).add(u),this._corners[Ia.NearTopRight].addVectors(l.copy(a.worldUp).multiply(e),p.copy(a.worldRight).multiply(t)).add(u),this._corners[Ia.NearBottomLeft].addVectors(l.copy(a.worldUp).multiply(-e),p.copy(a.worldRight).multiply(-t)).add(u),this._corners[Ia.NearBottomRight].addVectors(l.copy(a.worldUp).multiply(-e),p.copy(a.worldRight).multiply(t)).add(u),this._planes[Aa.Top].setFromPoints(this._corners[Ia.NearTopLeft],this._corners[Ia.FarTopLeft],this._corners[Ia.FarTopRight]),this._planes[Aa.Bottom].setFromPoints(this._corners[Ia.NearBottomRight],this._corners[Ia.FarBottomRight],this._corners[Ia.FarBottomLeft]),this._planes[Aa.Left].setFromPoints(this._corners[Ia.FarBottomLeft],this._corners[Ia.FarTopLeft],this._corners[Ia.NearTopLeft]),this._planes[Aa.Right].setFromPoints(this._corners[Ia.NearBottomRight],this._corners[Ia.NearTopRight],this._corners[Ia.FarTopRight]),this._planes[Aa.Near].setFromPoints(this._corners[Ia.NearBottomLeft],this._corners[Ia.NearTopLeft],this._corners[Ia.NearTopRight]),this._planes[Aa.Far].setFromPoints(this._corners[Ia.FarBottomRight],this._corners[Ia.FarTopRight],this._corners[Ia.FarTopLeft])},Frustum}(),Wa=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),qa=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Ga=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ha=function(t){function Projector(){var e=null!==t&&t.apply(this,arguments)||this;return e.changed=new S.VoidSyncEvent,e.zNear=.2,e.zFar=1e3,e._frustum=new Ua,e}return Wa(Projector,t),Object.defineProperty(Projector.prototype,"frustum",{get:function(){return this._frustum},enumerable:!0,configurable:!0}),Projector.prototype.getProjectionMatrix=function(){return nt.identity},Projector.prototype.updateFrustum=function(t,e){},qa([unserializable(),Ga("design:type",Object)],Projector.prototype,"changed",void 0),qa([unserializable(),Ga("design:type",Object)],Projector.prototype,"_frustum",void 0),Projector}(_),Ka=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Xa=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Qa=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};(Va||(Va={})).worker=null;var Ya,Za=function(t){function Raytracer(e){var n=t.call(this)||this;return n.reflections=!0,n.shadows=!0,n.shadowRadius=.6,n.shadowResolution=6,n.maxBounces=3,n._target=new Yt(Na),n._projector=new l(Ha),n._initialized=!1,n._savePending=!1,e&&n.setState(e),n}return Ka(Raytracer,t),Object.defineProperty(Raytracer.prototype,"target",{set:function(t){this._target.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Raytracer.prototype,"projector",{set:function(t){this._projector.instance=t},enumerable:!0,configurable:!0}),Raytracer.prototype.update=function(){if(this._initialized){if(this._savePending){var t=this._target.asset;t&&t.save(),this._savePending=!1}}else Va.worker?k.logWarning("Only one raytracing worker allowed, ignoring Raytracer component on Entity '"+this.entity.name):this.raytrace()},Raytracer.prototype.destroy=function(){t.prototype.destroy.call(this),this.terminate()},Raytracer.prototype.restart=function(){this.terminate(),this.raytrace()},Raytracer.prototype.raytrace=function(){var t=this,e=this._target.asset,n=this._projector.instance;if(e&&n){var r=new Worker("/dist/spider_raytracer_prod.js"),i={config:"standalone",scenePath:pu.list()[0].templatePath,targetWidth:e.getWidth(),targetHeight:e.getHeight(),rgba:e.rgba,projector:n.serialize(),worldMatrix:this.entity.transform.worldMatrix,settings:{reflections:this.reflections,shadows:this.shadows,shadowRadius:this.shadowRadius,shadowResolution:this.shadowResolution,maxBounces:this.maxBounces}};Object.assign(i,{standaloneFiles:gt.file.temporaryGetFiles()}),r.postMessage(i),r.onmessage=function(n){n.data?e.data=new Uint8Array(n.data):(k.log("Raytracer finished."),Va.worker=null,t._savePending=!0)},Va.worker=r,this._initialized=!0}},Raytracer.prototype.terminate=function(){this._initialized&&Va.worker&&(k.log("Terminating Raytracer.."),Va.worker.terminate(),Va.worker=null,this._initialized=!1)},Xa([unserializable(),Qa("design:type",Object)],Raytracer.prototype,"_initialized",void 0),Xa([unserializable(),Qa("design:type",Object)],Raytracer.prototype,"_savePending",void 0),Raytracer}(Et),Ja=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),$a=function(t){function Volume(){return null!==t&&t.apply(this,arguments)||this}return Ja(Volume,t),Volume.prototype.emitPoint=function(t){return t},Volume.prototype.getCenter=function(t){return t},Volume}(_),ts=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();!function(t){t[t.Changed=0]="Changed",t[t.Unchanged=1]="Unchanged"}(Ya||(Ya={}));var es,ns=function(t){function Geometry(){return null!==t&&t.apply(this,arguments)||this}return ts(Geometry,t),Geometry.prototype.getVertexBuffer=function(){return null},Geometry.prototype.getBoundingBox=function(){return null},Geometry.prototype.getWorldTransform=function(t){return t.worldMatrix},Geometry.prototype.graphicUpdate=function(t,e,n,r,i){return Ya.Unchanged},Geometry}(_),rs=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),is=function(t){function ParticleShape(){return null!==t&&t.apply(this,arguments)||this}return rs(ParticleShape,t),ParticleShape.prototype.getPositions=function(t,e,n){t[e+0]=-n,t[e+1]=-n,t[e+2]=0,t[e+3]=n,t[e+4]=-n,t[e+5]=0,t[e+6]=n,t[e+7]=n,t[e+8]=0,t[e+9]=-n,t[e+10]=-n,t[e+11]=0,t[e+12]=n,t[e+13]=n,t[e+14]=0,t[e+15]=-n,t[e+16]=n,t[e+17]=0},ParticleShape.prototype.getUvs=function(t,e){t[e+0]=0,t[e+1]=0,t[e+2]=1,t[e+3]=0,t[e+4]=1,t[e+5]=1,t[e+6]=0,t[e+7]=0,t[e+8]=1,t[e+9]=1,t[e+10]=0,t[e+11]=1},ParticleShape.prototype.makeLocalTransform=function(t,e){t.makeLookAt(e.worldForward,e.worldUp).transpose()},ParticleShape.prototype.makeParticleTransform=function(t,e){},ParticleShape.prototype.vertexCount=function(){return 6},ParticleShape.prototype.destroy=function(){},ParticleShape}(_),os=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),as=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ss=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.dataOffsets={position:0,velocity:3,color:6,life:10,remainingLife:11,size:12,active:13,MAX:14},t.getDataOffset=function getDataOffset(e,n,r){return n*t.dataOffsets.MAX+t.dataOffsets[e]+r},t.particlePos=new V,t.particleVelocity=new V,t.color=new H,t.localTransform=new nt}(es||(es={}));var cs,us,ls=function(t){function ParticlesGeometry(e,n){var r=t.call(this)||this;return r._worldTransform=new nt,r._worldSpace=!1,r._particleCount=0,r._maxParticles=0,r._shape=n,n&&(n.onPropertyChanged=function(t){return r.onParticleShapePropertyChanged(t)}),e&&(r._maxParticles=e),r._maxParticles&&r.initVertexBuffer(r._maxParticles),r}return os(ParticlesGeometry,t),Object.defineProperty(ParticlesGeometry.prototype,"vb",{get:function(){return this._vb},enumerable:!0,configurable:!0}),Object.defineProperty(ParticlesGeometry.prototype,"worldSpace",{set:function(t){this._worldSpace=t},enumerable:!0,configurable:!0}),Object.defineProperty(ParticlesGeometry.prototype,"particleCount",{set:function(t){this._particleCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(ParticlesGeometry.prototype,"shape",{set:function(t){var e=this;this._shape&&delete this._shape.onPropertyChanged,this._shape=t,t&&(t.onPropertyChanged=function(t){return e.onParticleShapePropertyChanged(t)}),this.initVertexBuffer(this._maxParticles)},enumerable:!0,configurable:!0}),ParticlesGeometry.prototype.destroy=function(){this._vb&&this._vb.unload(ht.context),t.prototype.destroy.call(this)},ParticlesGeometry.prototype.getVertexBuffer=function(){return this._vb},ParticlesGeometry.prototype.getWorldTransform=function(t){return this._worldTransform.copy(nt.identity),this._worldSpace||(this._worldTransform.scale(t.worldScale),this._worldTransform.setPosition(t.worldPosition)),this._worldTransform},ParticlesGeometry.prototype.graphicUpdate=function(t,e,n,r,i){if(!this._shape)return this._vb.vertexCount=0,Ya.Unchanged;var o=es.particlePos,a=es.particleVelocity,s=es.color,c=es.localTransform,u=this._vb.attributes.position,l=this._vb.attributes.color,p=0,h=0;this._shape.makeLocalTransform(c,t.entity.transform);for(var f=this._shape.vertexCount(),d=this._particleCount,y=V.fromPool(),m=0;m<this._maxParticles&&0!==d;++m){if(0!==this.getData("active",m)){this.getVector3("position",m,o),this.getVector3("velocity",m,a),this._shape.makeParticleTransform(c,a),c.setPosition(o);var v=this.getData("size",m);this._shape.getPositions(u,p,v);for(var g=0;g<f;++g){var _=3*g;y.setFromArray(u,p+_).transform(c).toArray(u,p+_)}p+=3*f,this.getColor(m,s);for(g=0;g<f;++g){l[(_=h+4*g)+0]=s.r,l[_+1]=s.g,l[_+2]=s.b,l[_+3]=s.a}h+=4*f,--d}}return this._vb.vertexCount=p/3,this._vb.dirtifyAttribute("position"),this._vb.dirtifyAttribute("color"),Ya.Changed},ParticlesGeometry.prototype.initVertexBuffer=function(t){if(this._vb&&this._vb.unload(ht.context),this._vb=new _t,this._maxParticles=t,this._interleavedData||(this._interleavedData=[]),this.resetData(t),this._shape){var e=this._shape.vertexCount();if(0!==e){var n=[];n.length=e*t,this._vb.setAttribute("position",n);var r=[];r.length=4*this._vb.vertexCount,this._vb.setAttribute("color",r);var i=[];i.length=2*this._vb.vertexCount;for(var o=0,a=0;a<t;++a)this._shape.getUvs(i,o),o+=2*e;this._vb.setAttribute("uv",i),this._vb.isDynamic=!0,this._vb.primitiveType="TRIANGLES"}}},ParticlesGeometry.prototype.resetData=function(t){var e=t*es.dataOffsets.MAX;this._interleavedData.length=e;for(var n=0;n<e;++n)this._interleavedData[n]=0},ParticlesGeometry.prototype.getData=function(t,e,n){var r=es.getDataOffset(t,e,n||0);return this._interleavedData[r]},ParticlesGeometry.prototype.setData=function(t,e,n,r){var i=es.getDataOffset(t,e,r||0);this._interleavedData[i]=n},ParticlesGeometry.prototype.setVector3=function(t,e,n){this.setData(t,e,n.x,0),this.setData(t,e,n.y,1),this.setData(t,e,n.z,2)},ParticlesGeometry.prototype.getVector3=function(t,e,n){n.x=this.getData(t,e,0),n.y=this.getData(t,e,1),n.z=this.getData(t,e,2)},ParticlesGeometry.prototype.setColor=function(t,e){this.setData("color",t,e.r,0),this.setData("color",t,e.g,1),this.setData("color",t,e.b,2),this.setData("color",t,e.a,3)},ParticlesGeometry.prototype.getColor=function(t,e){e.r=this.getData("color",t,0),e.g=this.getData("color",t,1),e.b=this.getData("color",t,2),e.a=this.getData("color",t,3)},ParticlesGeometry.prototype.onParticleShapePropertyChanged=function(t){this.initVertexBuffer(this._maxParticles)},as([unserializable(),ss("design:type",_t)],ParticlesGeometry.prototype,"_vb",void 0),as([unserializable(),ss("design:type",Array)],ParticlesGeometry.prototype,"_interleavedData",void 0),as([unserializable(),ss("design:type",Object)],ParticlesGeometry.prototype,"_worldTransform",void 0),as([unserializable(),ss("design:type",Object)],ParticlesGeometry.prototype,"_worldSpace",void 0),as([unserializable(),ss("design:type",Object)],ParticlesGeometry.prototype,"_particleCount",void 0),as([unserializable(),ss("design:type",Object)],ParticlesGeometry.prototype,"_maxParticles",void 0),as([unserializable(),ss("design:type",is)],ParticlesGeometry.prototype,"_shape",void 0),ParticlesGeometry=as([creatable(!1),displayName("Particles"),ss("design:paramtypes",[Number,is])],ParticlesGeometry)}(ns),ps=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),hs=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},fs=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ds=function(t){function BoxVolume(e){var n=t.call(this)||this;return n.center=new V,n.extent=new V(1,1,1),e&&n.setState(e),n}return ps(BoxVolume,t),BoxVolume.prototype.emitPoint=function(t){return t.x=this.center.x+W.lerp(-this.extent.x,this.extent.x,Math.random()),t.y=this.center.y+W.lerp(-this.extent.y,this.extent.y,Math.random()),t.z=this.center.z+W.lerp(-this.extent.z,this.extent.z,Math.random()),t},BoxVolume.prototype.getCenter=function(t){return t.copy(this.center)},BoxVolume=hs([displayName("Box"),fs("design:paramtypes",[Object])],BoxVolume)}($a),ys=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ms=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},vs=function(t){function VisualGroup(){return null!==t&&t.apply(this,arguments)||this}return ys(VisualGroup,t),VisualGroup=ms([displayName("Visual Group")],VisualGroup)}(A),gs=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),_s=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},bs=function(t){function BillboardParticle(){return null!==t&&t.apply(this,arguments)||this}return gs(BillboardParticle,t),BillboardParticle=_s([displayName("Billboard")],BillboardParticle)}(is),ws=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),xs=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Ps=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Up=0]="Up",t[t.Forward=1]="Forward",t[t.Right=2]="Right",t[t.AwayFromCenter=3]="AwayFromCenter"}(cs||(cs={})),function(t){var e;t.shapeWorldPos=new V,t.particlePos=new V,t.particleVelocity=new V,t.particleColor=new H,t.worldPos=new V,t.makeDirection=((e={})[cs.Up]=function(t,e,n,r){return r.copy(t.worldUp)},e[cs.Forward]=function(t,e,n,r){return r.copy(t.worldForward)},e[cs.Right]=function(t,e,n,r){return r.copy(t.worldRight)},e[cs.AwayFromCenter]=function(t,e,n,r){r.copy(e).substract(n);var i=r.length;return i>0?r.multiply(1/i):r.set(Nt.range(-1,1),Nt.range(-1,1),Nt.range(-1,1)).normalize()},e)}(us||(us={}));var Os,Cs=function(t){function ParticleValueOverLife(e,n){var r=t.call(this)||this;return r.life=0,r.life=e||0,void 0!==n&&(r.value=n),r}return ws(ParticleValueOverLife,t),ParticleValueOverLife.evaluate=function(t,e,n){var r=t.filter(function(t){return t.life>e});if(r.length===t.length)return n&&n.copy(r[0].value),r[0].value;var i=t.filter(function(t){return t.life<=e});console.assert(i.length>0);var o=i[i.length-1];if(i.length===t.length)return n&&n.copy(o.value),o.value;console.assert(r.length>0);var a=r[0],s=(e-o.life)/(a.life-o.life);return o.lerp(o.value,a.value,s,n)},ParticleValueOverLife.prototype.lerp=function(t,e,n,r){},ParticleValueOverLife}(_),Ss=function(t){function ParticleNumberOverLife(e,n){return t.call(this,e,n||0)||this}return ws(ParticleNumberOverLife,t),ParticleNumberOverLife.prototype.lerp=function(t,e,n){return W.lerp(t,e,n)},ParticleNumberOverLife}(Cs),js=function(t){function ParticleColorOverLife(e,n){return t.call(this,e,n||new H)||this}return ws(ParticleColorOverLife,t),ParticleColorOverLife.prototype.lerp=function(t,e,n,r){return H.lerp(t,e,n,r)},ParticleColorOverLife}(Cs),Rs=function(t){function Particles(e){var n=t.call(this)||this;return n.duration=6,n.isLooping=!1,n.worldSpace=!1,n.maxParticles=128,n.particlesPerSecond=30,n.life=new Vt(1,2),n.gravity=9.8,n.direction=cs.Up,n.initialSpeed=new Vt(1,2),n.initialSize=new Vt(1,2),n.initialColor=new H(1,1,1,1),n._volume=new l($a),n._shape=new l(is),n._speedOverLife=new xt(Ss),n._sizeOverLife=new xt(Ss),n._colorOverLife=new xt(js),n._group=new Yt(vs),n._material=new Yt(qu),n._particleCount=0,n._newParticlesCounter=0,n._isEmitting=!0,n._emitTime=-1,n._emitCenter=new V,e&&n.setState(e),n.onMaterialChanged=n.onMaterialChanged.bind(n),n.onGroupChanged=n.onGroupChanged.bind(n),n._material.assetChanged.attach(n.onMaterialChanged),n._group.assetChanged.attach(n.onGroupChanged),n._volume.instance||(n._volume.instance=new ds),n._material.asset||(n._material.asset=Qr.materials.particles),n._shape.instance||(n._shape.instance=new bs),n}return ws(Particles,t),Object.defineProperty(Particles.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"visual",{get:function(){return this.entity.getComponent(ul)},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"geometry",{get:function(){return this.visual.geometry},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"volume",{set:function(t){this._volume.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"shape",{set:function(t){this._shape.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"speedOverLife",{set:function(t){var e=this;this._speedOverLife.clear(),t.forEach(function(t){return e._speedOverLife.grow(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"sizeOverLife",{set:function(t){var e=this;this._sizeOverLife.clear(),t.forEach(function(t){return e._sizeOverLife.grow(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"colorOverLife",{set:function(t){var e=this;this._colorOverLife.clear(),t.forEach(function(t){return e._colorOverLife.grow(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"group",{set:function(t){this._group.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"material",{set:function(t){this._material.asset=t},enumerable:!0,configurable:!0}),Particles.prototype.setParticleLife=function(t,e){this.geometry.setData("remainingLife",t,e)},Particles.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.getOrSetComponent(zt),e.setComponent(ul,{geometry:new ls(this.maxParticles,this._shape.instance),material:this._material.asset,group:this._group.asset,castShadows:!1,controller:this}),this.initEmitter()},Particles.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n)},Particles.prototype.destroy=function(){t.prototype.destroy.call(this),this.entity.clearComponent(ul),this._shape.instance&&this._shape.instance.destroy(),this._material.detach(),this._group.detach()},Particles.prototype.emitParticle=function(){this._volume.instance&&this._newParticlesCounter++},Particles.prototype.update=function(){var t=J.deltaTime,e=this._volume.instance,n=0;this._isEmitting&&(this._emitTime<=0&&(this.isLooping?this._emitTime+=this.duration:this._isEmitting=!1),this._isEmitting&&e&&(this._newParticlesCounter+=t*this.particlesPerSecond)),n=Math.floor(this._newParticlesCounter),this._particleCount+n>this.maxParticles&&(n=this.maxParticles-this._particleCount);for(var r=0,i=n+this._particleCount,o=us.particlePos,a=us.particleVelocity,s=us.particleColor,c=0;c<this.maxParticles&&0!==i;++c){if(0===this.geometry.getData("active",c)){if(r<n){this.geometry.setData("active",c,1);var u=this.life.random();this.geometry.setData("life",c,u),this.geometry.setData("remainingLife",c,u),this.geometry.setData("size",c,this.initialSize.random()),e.emitPoint(o),e.getCenter(this._emitCenter),us.makeDirection[this.direction](this.entity.transform,o,this._emitCenter,a),a.multiply(this.initialSpeed.random()),this.worldSpace&&o.add(this.entity.transform.worldPosition),this.geometry.setVector3("position",c,o),this.geometry.setVector3("velocity",c,a),this.geometry.setColor(c,this.initialColor),++r,++this._particleCount,--i}}else{var l=this.geometry.getData("remainingLife",c)-t;if(l<0)this.geometry.setData("active",c,0),--this._particleCount;else{var p=1-l/(u=this.geometry.getData("life",c));if(this.geometry.getVector3("velocity",c,a),a.y+=-this.gravity*t,this.geometry.setData("velocity",c,a.y,1),this._speedOverLife.data.length>0){var h=Cs.evaluate(this._speedOverLife.data,p);a.normalize().multiply(h)}if(this.geometry.getVector3("position",c,o),o.add(a.multiply(t)),this.geometry.setVector3("position",c,o),this._colorOverLife.data.length>0&&(Cs.evaluate(this._colorOverLife.data,p,s),this.geometry.setColor(c,s)),this._sizeOverLife.data.length>0){var f=Cs.evaluate(this._sizeOverLife.data,p);this.geometry.setData("size",c,f)}this.geometry.setData("remainingLife",c,l)}--i}}this._newParticlesCounter-=n,this._isEmitting&&(this._emitTime-=t),this.geometry.particleCount=this._particleCount},Particles.prototype.checkCollisions=function(t,e,n){var r=this,i=us.shapeWorldPos;if(t.isA(ma)){var o=t;i.copy(o.center).add(e.worldPosition),this.checkCollisionsInternal(function(t,e){ha.boxIntersectsWithSphere(o,i,e,r.geometry.getData("size",t))&&n(t)})}else if(t.isA(da)){var a=t;i.copy(a.center).add(e.worldPosition),this.checkCollisionsInternal(function(t,e){ha.sphereIntersectsWithSphere(i,a.radius,e,r.geometry.getData("size",t))&&n(t)})}},Particles.prototype.upgrade=function(t,e){if(1===e){Object.assign(t.properties,{_volume:t.properties.volume,_shape:t.properties.shape,_speedOverLife:t.properties.speedOverLife,_sizeOverLife:t.properties.sizeOverLife,_colorOverLife:t.properties.colorOverLife,_group:t.properties.group,_material:t.properties.material}),delete t.properties.volume,delete t.properties.shape,delete t.properties.speedOverLife,delete t.properties.sizeOverLife,delete t.properties.colorOverLife,delete t.properties.group,delete t.properties.material,t.properties._volume.baseTypeName="Volume";var n=t.properties._volume.data.typeName;t.properties._volume.data.typeName=n+"Volume"}return t},Particles.prototype.checkCollisionsInternal=function(t){for(var e=this._particleCount,n=0;n<this.maxParticles&&0!==e;++n){if(0!==this.geometry.getData("active",n)){var r=us.worldPos;this.geometry.getVector3("position",n,r),this.worldSpace||r.add(this.entity.transform.worldPosition),t(n,r),--e}}},Particles.prototype.initEmitter=function(){this._newParticlesCounter=0,this._particleCount=0,this._emitTime=this.duration,this._isEmitting=!0,this.geometry.worldSpace=this.worldSpace},Particles.prototype.onMaterialChanged=function(t){this.entity&&(this.visual.material=t.newAsset)},Particles.prototype.onGroupChanged=function(t){this.entity&&(this.visual.group=t.newAsset)},xs([Attributes_enumLiterals(cs),Ps("design:type",Object)],Particles.prototype,"direction",void 0),xs([unserializable(),Ps("design:type",Object)],Particles.prototype,"_particleCount",void 0),xs([unserializable(),Ps("design:type",Object)],Particles.prototype,"_newParticlesCounter",void 0),xs([unserializable(),Ps("design:type",Object)],Particles.prototype,"_isEmitting",void 0),xs([unserializable(),Ps("design:type",Object)],Particles.prototype,"_emitTime",void 0),xs([unserializable(),Ps("design:type",Object)],Particles.prototype,"_emitCenter",void 0),Particles=xs([helpUrl("https://docs.spiderengine.io/3d/particles.html"),Ps("design:paramtypes",[Object])],Particles)}(Et),Ts=function(){function AnimationSystem(){}return AnimationSystem.update=function(t){t.forEach(function(t){t.animations.forEach(function(e){var n=e.animation;if(n){if(!e.isPlaying){if(!e.autoPlay)return;no.playAnimation(t.entity,e),e.autoPlay=!1}var r=J.smoothDeltaTime*e.speed;e.localTime+=r,e.playTime+=r,no.applyAnimation(n,t.entity,e.localTime,e.playTime,e.targets),e.localTime<n.duration||(e.loopCount>0?(++e.playCount,e.playCount===e.loopCount?(t.animationFinished.post(n.name),e.isPlaying=!1):e.localTime-=n.duration):e.stopRequested?(t.animationFinished.post(n.name),e.isPlaying=!1):e.localTime-=n.duration)}})})},AnimationSystem}(),Es=n(2),Bs=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),As=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Is=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Naive=0]="Naive",t[t.Grid=1]="Grid",t[t.SAP=2]="SAP"}(Os||(Os={}));var Ms,zs,ks,Ds=function(){function PhysicsBroadPhaseFactory(){}return PhysicsBroadPhaseFactory.create=function(t){switch(t){case Os.Grid:return new Es.GridBroadphase;case Os.SAP:return new Es.SAPBroadphase;default:return new Es.NaiveBroadphase}},PhysicsBroadPhaseFactory}(),Fs=function(t){function PhysicsContext(){var e=null!==t&&t.apply(this,arguments)||this;return e._gravity=new V(0,-9.8,0),e._broadPhase=Os.Naive,e._solverIterations=10,e}return Bs(PhysicsContext,t),Object.defineProperty(PhysicsContext.prototype,"broadPhase",{set:function(t){this._broadPhase=t,this._world&&(this._world.broadphase=Ds.create(this._broadPhase))},enumerable:!0,configurable:!0}),Object.defineProperty(PhysicsContext.prototype,"gravity",{set:function(t){this._gravity=t,this._world&&this._world.gravity.set(this._gravity.x,this._gravity.y,this._gravity.z)},enumerable:!0,configurable:!0}),Object.defineProperty(PhysicsContext.prototype,"solverIterations",{set:function(t){this._solverIterations=t,this._world&&(this._world.solver.iterations=this._solverIterations)},enumerable:!0,configurable:!0}),Object.defineProperty(PhysicsContext.prototype,"world",{get:function(){return this._world},set:function(t){this._world=t},enumerable:!0,configurable:!0}),PhysicsContext.prototype.update=function(){this._world||(this._world=new Es.World,this._world.gravity.set(this._gravity.x,this._gravity.y,this._gravity.z),this._world.broadphase=Ds.create(this._broadPhase),this._world.solver.iterations=this._solverIterations,this._world.defaultContactMaterial.contactEquationStiffness=1e9,this._world.defaultContactMaterial.contactEquationRelaxation=4,this.beginContact=this.beginContact.bind(this),this.endContact=this.endContact.bind(this),this._world.addEventListener("beginContact",this.beginContact),this._world.addEventListener("endContact",this.endContact)),this._world.step(1/60,J.deltaTime,3)},PhysicsContext.prototype.destroy=function(){this._world&&(this._world.removeEventListener("beginContact",this.beginContact),this._world.removeEventListener("endContact",this.endContact))},PhysicsContext.prototype.beginContact=function(t){},PhysicsContext.prototype.endContact=function(t){},As([Attributes_enumLiterals(Os),Is("design:type",Object)],PhysicsContext.prototype,"_broadPhase",void 0),As([unserializable(),Is("design:type",Es.World)],PhysicsContext.prototype,"_world",void 0),PhysicsContext}(Et),Ls=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Ns=function(t){function PlaneCollisionShape(){return null!==t&&t.apply(this,arguments)||this}return Ls(PlaneCollisionShape,t),PlaneCollisionShape.prototype.checkCollisions=function(t,e,n,r){},PlaneCollisionShape}(la),Vs=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Us=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Ws=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},qs=function(){function PhysicsShapeFactory(){}return PhysicsShapeFactory.create=function(t,e){var n=e.scale;if(t.isA(ma)){var r=t,i=new Es.Vec3(r.extent.x*n.x,r.extent.y*n.y,r.extent.z*n.z);return{shape:new Es.Box(i),offset:r.center}}if(t.isA(da)){var o=t;return{shape:new Es.Sphere(o.radius*n.x),offset:o.center}}return t.isA(Ns)?{shape:new Es.Plane,offset:e.worldPosition}:null},PhysicsShapeFactory}();(zs=Ms||(Ms={}))[zs.Static=Es.Body.STATIC]="Static",zs[zs.Dynamic=Es.Body.DYNAMIC]="Dynamic",zs[zs.Kinematic=Es.Body.KINEMATIC]="Kinematic",function(t){(ks||(ks={})).applyRigidBodyToTransform=function applyRigidBodyToTransform(t,e,n){var r=t.x,i=t.y,o=t.z;n.position.set(r,i,o),r=e.x,i=e.y,o=e.z;var a=e.w;n.rotation.set(r,i,o,a)}}();var Gs,Hs=function(t){function RigidBody(){var e=null!==t&&t.apply(this,arguments)||this;return e._mass=1,e._type=Ms.Dynamic,e._cannonPlaneRotationAdjustment=!1,e}return Vs(RigidBody,t),Object.defineProperty(RigidBody.prototype,"mass",{get:function(){return this._mass},set:function(t){t<=0?(t=0,this._type=Ms.Static):this._type===Ms.Static&&(this._type=Ms.Dynamic),this._mass=t,this._rigidBody&&(this._rigidBody.mass=t,this._rigidBody.type=this._type)},enumerable:!0,configurable:!0}),Object.defineProperty(RigidBody.prototype,"body",{get:function(){return this._rigidBody},enumerable:!0,configurable:!0}),Object.defineProperty(RigidBody.prototype,"type",{set:function(t){this._type=t,t===Ms.Static?this._mass=0:this._mass<=0&&(this._mass=1),this._rigidBody&&(this._rigidBody.mass=this._mass,this._rigidBody.type=this._type)},enumerable:!0,configurable:!0}),RigidBody.prototype.update=function(t){var e=this.entity.transform;if(this._rigidBody)this._type===Ms.Static?this.applyTransformToRigidBody(e,this._rigidBody.position,this._rigidBody.quaternion):ks.applyRigidBodyToTransform(this._rigidBody.position,this._rigidBody.quaternion,e);else{this._rigidBody=new Es.Body,this._rigidBody.mass=this._mass,this._rigidBody.type=this._type;var n=this.entity.getComponent(ba);if(n)for(var r=0,i=n.shapes;r<i.length;r++){var o=i[r];if(o){var a=qs.create(o,this.entity.transform);if(a){var s=a.offset,c=s.x,u=s.y,l=s.z;this._rigidBody.addShape(a.shape,new Es.Vec3(c,u,l)),o.isA(Ns)&&(this._cannonPlaneRotationAdjustment=!0)}}}this.applyTransformToRigidBody(e,this._rigidBody.position,this._rigidBody.quaternion),t.world.addBody(this._rigidBody),this._rigidBody.addEventListener("collide",this.onCollision)}},RigidBody.prototype.destroy=function(){if(this._rigidBody){this._rigidBody.removeEventListener("collide",this.onCollision);var t=this.entity.getAncestorOfType(Fs);t&&t.world.remove(this._rigidBody)}},RigidBody.prototype.onCollision=function(t){},RigidBody.prototype.applyTransformToRigidBody=function(t,e,n){var r=t.position,i=r.x,o=r.y,a=r.z;e.set(i,o,a);var s=t.rotation;this._cannonPlaneRotationAdjustment&&(s=it.fromPool().copy(s).multiply(it.fromPool().setFromAxisAngle(V.right,-Math.PI/2)));i=s.x,o=s.y,a=s.z;var c=s.w;n.set(i,o,a,c)},Us([Attributes_enumLiterals(Ms),Ws("design:type",Object)],RigidBody.prototype,"_type",void 0),Us([unserializable(),Ws("design:type",Es.Body)],RigidBody.prototype,"_rigidBody",void 0),Us([unserializable(),Ws("design:type",Object)],RigidBody.prototype,"_cannonPlaneRotationAdjustment",void 0),RigidBody}(Et),Ks=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Xs=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Qs=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ys=function(t){function Button(e){var n=t.call(this)||this;return n._enabled=!0,n._pushed=!1,n._normal=new l(Vr),n._highlighted=new l(Vr),n._pressed=new l(Vr),n._disabled=new l(Vr),e&&n.setState(e),n}return Ks(Button,t),Object.defineProperty(Button.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"normal",{get:function(){return this._normal.instance},set:function(t){this._normal.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"highlighted",{get:function(){return this._highlighted.instance},set:function(t){this._highlighted.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"pressed",{get:function(){return this._pressed.instance},set:function(t){this._pressed.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"disabled",{get:function(){return this._disabled.instance},set:function(t){this._disabled.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"pushed",{get:function(){return this._pushed},set:function(t){this._pushed=t},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"enabled",{get:function(){return this._touchInteractions.active},set:function(t){this._enabled=this._touchInteractions.active=t},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"currentFill",{get:function(){return this.enabled?this.isTouchPressed||this._pushed?this.pressed||this.normal:this.isTouchInside&&this.highlighted||this.normal:this.disabled||this.normal},enumerable:!0,configurable:!0}),Button.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.getOrSetComponent(vr),this._touchInteractions=new Fi({active:this._enabled,controller:this}),au.setComponentFromInstance(e,this._touchInteractions)},Button.prototype.destroy=function(){this.entity.clearComponent(Fi),t.prototype.destroy.call(this)},Button.prototype.isLoaded=function(){return!(this.normal&&!this.normal.isLoaded())&&(!(this.highlighted&&!this.highlighted.isLoaded())&&(!(this.pressed&&!this.pressed.isLoaded())&&!(this.disabled&&!this.disabled.isLoaded())))},Button.prototype.getVertexBuffer=function(){return ni.getVertexBuffer(this.entity.getComponent(vr),this.currentFill)},Button.prototype.upgrade=function(t,e){return 1===e?(Object.assign(t.properties,{_normal:t.properties.normal,_highlighted:t.properties.highlighted,_pressed:t.properties.pressed,_disabled:t.properties.disabled}),delete t.properties.normal,delete t.properties.highlighted,delete t.properties.pressed,delete t.properties.disabled):2===e&&(Object.assign(t.properties,{_enabled:t.properties.enabled}),delete t.properties.enabled),t},Xs([unserializable(),Qs("design:type",Fi)],Button.prototype,"_touchInteractions",void 0),Button=Xs([displayName("Button"),helpUrl("https://docs.spiderengine.io/2d/button.html"),Qs("design:paramtypes",[Object])],Button)}(si);!function(t){t.swipeThreshold=20,t.keyEvent={pressed:!1,keyCode:0},t.touchEvent={pressed:!1,x:0,y:0,swipe:!1,swipeVelocity:new $,button:0},t.initialTouchPos=new $}(Gs||(Gs={}));var Zs,Js=function(){function Input(){}return Object.defineProperty(Input,"touchX",{get:function(){return Gs.touchEvent.x},set:function(t){Gs.touchEvent.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(Input,"touchY",{get:function(){return Gs.touchEvent.y},set:function(t){Gs.touchEvent.y=t},enumerable:!0,configurable:!0}),Input.detachAll=function(){Input.touchPressed.detach(),Input.touchMoved.detach(),Input.touchReleased.detach(),Input.wheelMoved.detach(),Input.keyChanged.detach()},Input.touchPressed=new S.SyncEvent,Input.touchMoved=new S.SyncEvent,Input.touchReleased=new S.SyncEvent,Input.wheelMoved=new S.SyncEvent,Input.keyChanged=new S.SyncEvent,Input}(),$s=function(){function InputInternal(){}return InputInternal.create=function(t){Gs.touchEvent.x=t.x,Gs.touchEvent.y=t.y},Object.defineProperty(InputInternal,"keyChangedInfo",{get:function(){return Gs.keyEvent},enumerable:!0,configurable:!0}),InputInternal.onTouchDown=function(t,e,n){t<0||e<0||(Gs.touchEvent.pressed=!0,Gs.touchEvent.swipe=!1,Gs.touchEvent.x=t,Gs.touchEvent.y=e,Gs.touchEvent.button=n,Gs.initialTouchPos.set(t,e),Js.touchPressed.post(Gs.touchEvent))},InputInternal.onTouchMove=function(t,e,n){t<0||e<0||(Gs.touchEvent.swipe=!1,Gs.touchEvent.x=t,Gs.touchEvent.y=e,Gs.touchEvent.button=n,Js.touchMoved.post(Gs.touchEvent))},InputInternal.onTouchUp=function(t,e,n){if(!(t<0||e<0)){var r=t-Gs.initialTouchPos.x,i=e-Gs.initialTouchPos.y;Gs.touchEvent.pressed=!1,Gs.touchEvent.swipe=Math.max(Math.abs(r),Math.abs(i))>Gs.swipeThreshold,Gs.touchEvent.x=t,Gs.touchEvent.y=e,Gs.touchEvent.swipeVelocity.set(r,i),Gs.touchEvent.button=n,Js.touchReleased.post(Gs.touchEvent)}},InputInternal.onMouseWheel=function(t){Js.wheelMoved.post(t)},InputInternal}(),tc=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ec=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},nc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},rc=function(t){function Image(e){var n=t.call(this)||this;return n._fill=new l(Vr),e&&n.setState(e),n}return tc(Image,t),Object.defineProperty(Image.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Image.prototype,"fill",{get:function(){return this._fill.instance},set:function(t){this._fill.instance=t},enumerable:!0,configurable:!0}),Image.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.getOrSetComponent(vr)},Image.prototype.isLoaded=function(){return!this._fill.instance||this._fill.instance.isLoaded()},Image.prototype.getVertexBuffer=function(){return ni.getVertexBuffer(this.entity.getComponent(vr),this._fill.instance)},Image.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_fill:t.properties.fill}),delete t.properties.fill),t},Image=ec([helpUrl("https://docs.spiderengine.io/2d/image.html"),nc("design:paramtypes",[Object])],Image)}(si),ic=function(){function LayoutUtils(){}return LayoutUtils.getLayoutActualSize=function(t,e,n,r,i,o){var a=0;if(n)a=e-i;else if(r.type===rt.Auto){var s=t.entity.getComponent(rc);if(s&&s.fill)return ni.getFillSize(s.fill,o);var c=t.entity.getComponent(Ys);if(c&&c.currentFill)return ni.getFillSize(c.currentFill,o);var u=t.entity.getComponent(Ui);if(u&&u.currentFill)return ni.getFillSize(u.currentFill,o);var l=t.entity.getComponent(Mi),p=l?l.font:null;if(p)return o?p.getWidth():p.getHeight()}else r.type===rt.Relative?a=e*r.value-i:r.type===rt.Absolute&&(a=r.value);return a},LayoutUtils.updateLayoutWorldMatrix=function(t,e,n){var r=e,i=r.x,o=r.y,a=t.entity.parent?t.entity.parent.getComponent(vr):void 0,s=t.offset.x,c=t.offset.y;a&&(i=a.actualWidth,o=a.actualHeight,s-=a.pivot.x*i,c-=a.pivot.y*o),t.actualWidth=LayoutUtils.getLayoutActualSize(t,i,t.horizontalAlignment===ur.Stretch,t.width,t.margin.left+t.margin.right,!0),t.actualHeight=LayoutUtils.getLayoutActualSize(t,o,t.verticalAlignment===lr.Stretch,t.height,t.margin.top+t.margin.bottom,!1);var u=t.entity.parent&&!t.entity.parent.hasComponent("Layout"),l=t.horizontalAlignment===ur.Stretch;l?s+=t.margin.left:t.horizontalAlignment===ur.Left?(s+=t.margin.left,u&&(s+=n.x)):t.horizontalAlignment===ur.Right?(s+=i-t.margin.right,u&&(s-=n.x)):t.horizontalAlignment===ur.Center&&(s+=i/2);var p=t.verticalAlignment===lr.Stretch;p?c+=t.margin.top:t.verticalAlignment===lr.Bottom?(c+=o-t.margin.bottom,u&&(c-=n.y)):t.verticalAlignment===lr.Top?(c+=t.margin.top,u&&(c+=n.y)):t.verticalAlignment===lr.Center&&(c+=o/2),t.worldMatrix.setRotation(t.rotation),t.worldMatrix.scaleFromCoords(t.scale.x,t.scale.y,1),t.worldMatrix.translateFromCoords(s+(l?t.pivot.x*t.actualWidth:0),c+(p?t.pivot.y*t.actualHeight:0),0),t.finalTint.copy(t.tint),a&&(t.worldMatrix.multiplyMatrices(a.worldMatrix,t.worldMatrix),t.inheritTint&&t.finalTint.multiplyColor(a.finalTint))},LayoutUtils}(),oc=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ac=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},sc=function(t){function Resolution(){var e=null!==t&&t.apply(this,arguments)||this;return e.size=new $(800,600),e.adaptiveWidth=!1,e}return oc(Resolution,t),Resolution}(_),cc=function(t){function CustomResolution(){return null!==t&&t.apply(this,arguments)||this}return oc(CustomResolution,t),CustomResolution=ac([displayName("Custom")],CustomResolution)}(sc),uc=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),lc=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},pc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.longPressDuration=.5,t.touchMovedTreshold=3,t.tintColor=new H,t.invModelView=new nt,t._2dPickingAABB=new at,t.localCoords=new V}(Zs||(Zs={}));var hc,fc,dc=function(t){function Screen(){var e=null!==t&&t.apply(this,arguments)||this;return e._resolution=new l(sc),e._cache=[],e._cacheIndex=0,e._offset=new $,e._translationX=0,e._translationY=0,e._scale=1,e._pressDuration=-1,e._initialTouchPos=new $,e._screenTransform=new nt,e}return uc(Screen,t),Object.defineProperty(Screen.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"cache",{get:function(){return this._cache},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"cacheSize",{get:function(){return this._cacheIndex},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"offset",{get:function(){return this._offset},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"translationX",{get:function(){return this._translationX},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"translationY",{get:function(){return this._translationY},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"screenTransform",{get:function(){return this._screenTransform},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"resolution",{get:function(){return this._resolution.instance},enumerable:!0,configurable:!0}),Screen.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.clearComponent(vr),e.getOrSetComponent(zt),this.onTouchPressed=this.onTouchPressed.bind(this),this.onTouchMoved=this.onTouchMoved.bind(this),this.onTouchReleased=this.onTouchReleased.bind(this),Js.touchPressed.attach(this.onTouchPressed),Js.touchMoved.attach(this.onTouchMoved),Js.touchReleased.attach(this.onTouchReleased)},Screen.prototype.destroy=function(){Js.touchPressed.detach(this.onTouchPressed),Js.touchMoved.detach(this.onTouchMoved),Js.touchReleased.detach(this.onTouchReleased),t.prototype.destroy.call(this)},Screen.prototype.getResolution=function(t){return this.resolution?this.resolution.size:t},Screen.prototype.updateTransforms=function(){var t=this,e=gt.renderer.screenSize;this._scale=1,this._translationX=0,this._translationY=0,this._screenTransform.copy(this.entity.transform.worldMatrix);var n=this.resolution;if(n){var r=n.size.x/n.size.y;if(n.adaptiveWidth){var i=e.y*r;this._translationX=(e.x-i)/2,this._scale=e.y/n.size.y}else{var o=e.x/r;this._translationY=(e.y-o)/2,this._scale=e.x/n.size.x}this._screenTransform.data[12]*=this._scale,this._screenTransform.data[13]*=this._scale}this._screenTransform.scaleFromCoords(this._scale,this._scale,1),this._screenTransform.translateFromCoords(this._translationX,this._translationY,0),this._offset.x=Math.max(-this._translationX,0),this._offset.y=Math.max(-this._translationY,0),this._offset.x=this._offset.x/this._scale,this._offset.y=this._offset.y/this._scale,this.entity.traverse(function(n){var r=n.getComponent(vr);return r&&ic.updateLayoutWorldMatrix(r,t.getResolution(e),t.offset),!0})},Screen.prototype.update=function(){var t=this._pressDuration>=0,e=this._pressedElement;e&&t&&(this._pressDuration+=J.deltaTime,this._pressDuration>Zs.longPressDuration&&(this.onEvent(e.entity,function(t,n){return t._target.value.entity=e.entity,t.sendSignal(t._longPress.name),t._stopPropagation.getData()}),this._pressDuration=-1))},Screen.prototype.render=function(t){var e=this,n=Zs.tintColor;this._cacheIndex=0,this.entity.traverse(function(t){return e.addToCache(t)});for(var r=nt.fromPool(),i=ht.context,o=0;o<this._cacheIndex;++o){var a=this._cache[o].element,s=a.worldMatrix;s.data[12]=s.data[12],s.data[13]=s.data[13],s.data[14]=s.data[14],r.multiplyMatrices(this._screenTransform,s),t.queueParameter("modelViewMatrix",r);var c=a.entity.getComponent(rc);if(c)c.active&&c.fill&&ni.renderFill(c.fill,t,r,c.getVertexBuffer(),i,a.finalTint);else{var u=a.entity.getComponent(Ys);if(u){var l=u.currentFill;u.active&&l&&ni.renderFill(l,t,r,u.getVertexBuffer(),i,a.finalTint)}else{var p=a.entity.getComponent(Ui);if(p){var h=p.currentFill;p.active&&h&&ni.renderFill(h,t,r,p.getVertexBuffer(),i,a.finalTint.multiplyColor(p.currentColor))}else{var f=a.entity.getComponent(Mi);if(f){var d=f.font;if(f.active&&d){var y=0;a.width.type!==rt.Auto&&(y=a.actualWidth),d.prepareForRendering(this.scale,y),t.queueReferenceParameter(ni.uiShaderTextureParam,d.getTexture()),t.queueParameter(ni.uiShaderColorParam,n.copy(f.color).multiplyColor(a.finalTint)),t.begin()&&Xr.drawVertexBuffer(i,f.getVertexBuffer(),t.shader)}}else;}}}}},Screen.prototype.upgrade=function(t,e){return 1===e&&(t.properties.useResolution&&Object.assign(t.properties,{_resolution:{baseTypeName:"Resolution",data:{typeName:"CustomResolution",version:1,properties:{size:JSON.parse(JSON.stringify(t.properties.resolution)),adaptiveWidth:t.properties.matchHeight}}}}),delete t.properties.resolution,delete t.properties.useResolution,delete t.properties.matchHeight),t},Screen.prototype.addToCache=function(t){if(!t.active)return!1;if(this._cacheIndex>=this._cache.length){var e=Math.max(32,2*this._cache.length);this._cache.length=e;for(var n=this._cacheIndex;n<e;++n)this._cache[n]={drawOrder:999999,element:Zs.dummyLayout}}var r=t.getComponent(vr);if(r){var i=this._cache[this._cacheIndex];i.element=r,i.drawOrder=this._cacheIndex,this._cacheIndex++}return!0},Screen.prototype.onTouchPressed=function(t){var e=this;this._initialTouchPos.set(t.x,t.y),this.onTouchChanged(t);var n=this._pressedElement;n&&this.onEvent(n.entity,function(r,i){return r._target.value.entity=n.entity,r._touchPos.getData().set(t.x/e._scale-e._translationX,t.y/e._scale-e._translationY),r.sendSignal(r._touchDown.name),r._stopPropagation.getData()})},Screen.prototype.onTouchMoved=function(t){var e=this,n=this.onTouchChanged(t);if(this._pressDuration>=0){var r=t.x-this._initialTouchPos.x,i=t.y-this._initialTouchPos.y;Math.max(Math.abs(r),Math.abs(i))>Zs.touchMovedTreshold&&(this._pressDuration=-1)}var o=this._pressedElement||n;o&&this.onEvent(o.entity,function(n,r){return n._target.value.entity=o.entity,n._touchPos.getData().set(t.x/e._scale-e._translationX,t.y/e._scale-e._translationY),n.sendSignal(n._touchMove.name),n._stopPropagation.getData()})},Screen.prototype.onTouchReleased=function(t){var e=this;this.onTouchChanged(t);var n=this._pressedElement;if(n){var r=n.entity;this.onEvent(r,function(n,i){return n._target.value.entity=r,n._touchPos.getData().set(t.x/e._scale-e._translationX,t.y/e._scale-e._translationY),n.sendSignal(n._touchUp.name),n._stopPropagation.getData()})}if(t.swipe&&delete this._pressedElement,n=this._pressedElement){if(n.isTouchInside){var i=n.entity;this.onEvent(i,function(n,r){return n._target.value.entity=i,n._touchPos.getData().set(t.x/e._scale-e._translationX,t.y/e._scale-e._translationY),n.sendSignal(n._click.name),n._stopPropagation.getData()})}delete this._pressedElement}},Screen.prototype.onTouchChanged=function(t){for(var e=Zs._2dPickingAABB,n=Zs.invModelView,r=Zs.localCoords,i=!0,o=null,a=this._cacheIndex-1;a>=0;--a){var s=this._cache[a].element,c=s.entity,u=c.getComponent(Fi);if(u&&u.active){var l=c.getComponent(Ys)||c.getComponent(rc)||c.getComponent(Mi)||c.getComponent(Ui);if(l){var p=s.actualWidth,h=s.actualHeight;e.min.set(-s.pivot.x*p,-s.pivot.y*h,-999999),e.max.set(p-s.pivot.x*p,h-s.pivot.y*h,999999),n.multiplyMatrices(this._screenTransform,s.worldMatrix).invert(),r.set(t.x,t.y,0).transform(n),e.contains(r)?(l.isTouchInside?i||l.setTouchInside(!1):i&&(l.setTouchInside(!0),o=l),i=!1):l.isTouchInside&&(l.setTouchInside(!1),o=null),!0===t.pressed?l.isTouchInside&&!l.isTouchPressed&&(l.setTouchPressed(!0),this._pressedElement=l,this._pressDuration=0):!1===t.pressed&&l.isTouchPressed&&l.setTouchPressed(!1)}}}return o},Screen.prototype.onEvent=function(t,e){for(au.collectEntityOperations=!0;t;){var n=t.getComponent(hr);if(n)if(n.onUIEvent(function(n){return e(n,t)}))break;if(t===this.entity)break;t=t.parent}au.collectEntityOperations=!1},lc([displayName("Scaling"),pc("design:type",Object)],Screen.prototype,"_resolution",void 0),lc([unserializable(),Attributes_hidden(),pc("design:type",Array)],Screen.prototype,"_cache",void 0),lc([unserializable(),Attributes_hidden(),pc("design:type",Object)],Screen.prototype,"_cacheIndex",void 0),lc([unserializable(),pc("design:type",Object)],Screen.prototype,"_offset",void 0),lc([unserializable(),pc("design:type",Object)],Screen.prototype,"_translationX",void 0),lc([unserializable(),pc("design:type",Object)],Screen.prototype,"_translationY",void 0),lc([unserializable(),pc("design:type",Object)],Screen.prototype,"_scale",void 0),lc([unserializable(),pc("design:type",si)],Screen.prototype,"_pressedElement",void 0),lc([unserializable(),pc("design:type",Object)],Screen.prototype,"_pressDuration",void 0),lc([unserializable(),pc("design:type",Object)],Screen.prototype,"_initialTouchPos",void 0),lc([unserializable(),pc("design:type",Object)],Screen.prototype,"_screenTransform",void 0),Screen=lc([helpUrl("https://docs.spiderengine.io/2d/screen.html")],Screen)}(Et),yc=function(){return function CollisionInfo(){}}();!function(t){t.collisions=new N(yc,64),t.checkCollision=function checkCollision(e,n){for(var r=function(r){if(!r)return"continue";for(var i=function(i){if(!i)return"continue";r.getTestPriority()>i.getTestPriority()?r.checkCollisions(i,e.entity.transform,n.entity.transform,function(o){var a=t.collisions.get();a.self=e,a.collider=n,a.myShape=r,a.otherShape=i,a.particleIndex=o}):i.checkCollisions(r,n.entity.transform,e.entity.transform,function(o){var a=t.collisions.get();a.self=e,a.collider=n,a.myShape=r,a.otherShape=i,a.particleIndex=o})},o=0,a=n.shapes;o<a.length;o++)i(a[o])},i=0,o=e.shapes;i<o.length;i++)r(o[i])}}(hc||(hc={})),function(t){t.clearCollisions=function clearCollisions(){hc.collisions.flush()}}(fc||(fc={}));var mc,vc,gc=function(){function CollisionSystem(){}return CollisionSystem.update=function(t,e){var n,r;hc.collisions.flush();for(var i={},o=0,a=t;o<a.length;o++)for(var s=a[o],c=0,u=t;c<u.length;c++){var l=u[c];if(s!==l){var p=i[s.id];if(!(p&&l.id in p)){(s.filter?s.filter.canCollideWith(l.group):!l.filter||l.filter.canCollideWith(s.group))&&hc.checkCollision(s,l),p?p[l.id]=!0:i[s.id]=((n={})[l.id]=!0,n);var h=i[l.id];h?h[s.id]=!0:i[l.id]=((r={})[s.id]=!0,r)}}}e.forEach(function(e){return e.update(t)});for(var f=0;f<hc.collisions.size;++f){var d=hc.collisions.peek(f);d.self.collision.post(d);var y=d.self.entity.getComponent(hr);y&&y.onCollision(d);var m={self:d.collider,collider:d.self,myShape:d.otherShape,otherShape:d.myShape,particleIndex:d.particleIndex};d.collider.collision.post(m);var v=d.collider.entity.getComponent(hr);v&&v.onCollision(m)}},CollisionSystem}(),_c=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),bc=function(t){function IKSolverBase(){var e=null!==t&&t.apply(this,arguments)||this;return e.getEntity=function(){return null},e.getEffector=function(){return null},e}return _c(IKSolverBase,t),IKSolverBase.prototype.update=function(){},IKSolverBase}(_),wc=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),xc=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Pc=function(t){function IKEffector(){var e=null!==t&&t.apply(this,arguments)||this;return e._influence=1,e}return wc(IKEffector,t),Object.defineProperty(IKEffector.prototype,"influence",{get:function(){return this._influence},set:function(t){this._influence=W.clamp(t,0,1)},enumerable:!0,configurable:!0}),IKEffector.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.getOrSetComponent(zt)},IKEffector=xc([exclusiveWith("IKSolver")],IKEffector)}(Et),Oc=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Cc=function(t){function IKConstraint(){return null!==t&&t.apply(this,arguments)||this}return Oc(IKConstraint,t),IKConstraint}(_),Sc=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),jc=function(t){function IKNode(){var e=null!==t&&t.apply(this,arguments)||this;return e.constraint=new l(Cc),e}return Sc(IKNode,t),IKNode}(Et),Rc=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Tc=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Ec=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Bc=n(102);!function(t){t.basis=new Se,t.dummy=new Bc.V3}(mc||(mc={})),function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"}(vc||(vc={}));var Ac,Ic=function(t){function BaseRotation(){var e=null!==t&&t.apply(this,arguments)||this;return e.axis=vc.Y,e.angle=-90,e}return Rc(BaseRotation,t),Tc([Attributes_enumLiterals(vc),Ec("design:type",Object)],BaseRotation.prototype,"axis",void 0),BaseRotation}(_),Mc=function(t){function IKGenericSolver(){var e=null!==t&&t.apply(this,arguments)||this;return e.baseRotation=new Ic,e._entity=null,e._chainTransformChanged=!1,e._effectorTransformChanged=!1,e}return Rc(IKGenericSolver,t),IKGenericSolver.prototype.update=function(){var t=this,e=this.getEntity(),n=this.getEffector();if(e&&n){if(this._ikSolver){if(this._chainTransformChanged){a=this._ikSolver.chains[0];var r=this._nodes[0].entity.transform.worldPosition;a.setBaseLocation(mc.dummy.set(r.x,r.y,r.z));for(var i=0;i<this._nodes.length-1;++i){c=this._nodes[i].entity.transform.worldPosition,u=this._nodes[i+1].entity.transform.worldPosition;a.bones[i].start.set(c.x,c.y,c.z),a.bones[i].end.set(u.x,u.y,u.z)}a.updateChainLength(),a.resetTarget()}}else{var o=[];if(e.traverse(function(t){if(t.hasComponentByType(Dc)&&t!==e)return!1;var n=t.getComponent(jc);return n&&n.active&&o.push(n),!0},!0),o.length<1)return;Object.assign(window,{FIK:Bc}),this._ikSolver=new Bc.Structure3D,this._nodes=o,this._entity=e,this._chainTransformChanged=!0;for(var a=new Bc.Chain3D,s=0;s<o.length-1;++s){var c=o[s].entity.transform.worldPosition,u=o[s+1].entity.transform.worldPosition,l=new Bc.Bone3D(new Bc.V3(c.x,c.y,c.z),new Bc.V3(u.x,u.y,u.z));a.addBone(l)}this._ikSolver.add(a,new Proxy(n,{get:function(t,e){return t.entity.transform.worldPosition[e]}})),e.transform.changed.attach(function(){t._chainTransformChanged=!0}),n.entity.transform.changed.attach(function(){t._effectorTransformChanged=!0})}if(this._chainTransformChanged||this._effectorTransformChanged){this._ikSolver.update();var p=this._ikSolver.chains[0],h=V.fromPool(),f=it.fromPool(),d=it.fromPool(),y=nt.fromPool(),m=nt.fromPool();e.transform.eventsEnabled=!1;for(s=0;s<p.numBones;++s){l=p.bones[s];h.set(l.end.x-l.start.x,l.end.y-l.start.y,l.end.z-l.start.z).normalize(),mc.basis.setFromForward(h),f.lookAt(h,mc.basis.up),0!==this.baseRotation.angle&&(d.setFromAxisAngle(t.baseRotation.axis===vc.Y?mc.basis.up:t.baseRotation.axis===vc.X?mc.basis.right:mc.basis.forward,W.toRadians(this.baseRotation.angle)),f.multiply(d));var v=this._nodes[s],g=v.entity.parent?v.entity.parent.transform:null;if(g){m.copy(g.worldMatrix).invert();var _=m.multiply(y.setRotation(f)).getRotation(it.fromPool());v.entity.transform.rotation.slerp(_,n.influence)}else v.entity.transform.rotation.slerp(f,n.influence)}e.transform.eventsEnabled=!0,this._chainTransformChanged=!1,this._effectorTransformChanged=!1}}},IKGenericSolver.prototype.destroy=function(){this._entity&&this._entity.transform.changed.detach();var t=this.getEffector();t&&t.entity.transform.changed.detach()},Tc([unserializable(),Ec("design:type",Object)],IKGenericSolver.prototype,"_ikSolver",void 0),Tc([unserializable(),Ec("design:type",Array)],IKGenericSolver.prototype,"_nodes",void 0),Tc([unserializable(),Ec("design:type",Object)],IKGenericSolver.prototype,"_entity",void 0),Tc([unserializable(),Ec("design:type",Object)],IKGenericSolver.prototype,"_chainTransformChanged",void 0),Tc([unserializable(),Ec("design:type",Object)],IKGenericSolver.prototype,"_effectorTransformChanged",void 0),IKGenericSolver}(bc),zc=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),kc=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Dc=function(t){function IKSolver(){var e=null!==t&&t.apply(this,arguments)||this;return e._solver=new l(bc,new Mc),e._effector=new Lt(Pc),e}return zc(IKSolver,t),Object.defineProperty(IKSolver.prototype,"effector",{get:function(){return this._effector.component},set:function(t){this._effector.component=t},enumerable:!0,configurable:!0}),Object.defineProperty(IKSolver.prototype,"solver",{set:function(t){var e=this,n=this._solver.instance;n&&Object.assign(n,{getEntity:function(){return null},getEffector:function(){return null}}),this._solver.instance=t,t&&Object.assign(t,{getEntity:function(){return e.entity},getEffector:function(){return e.effector}})},enumerable:!0,configurable:!0}),IKSolver.prototype.update=function(){var t=this._solver.instance;t&&t.update()},IKSolver.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),this.solver=this._solver.instance},IKSolver=kc([exclusiveWith("IKEffector")],IKSolver)}(Et),Fc=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Lc=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Nc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){var e,n,r={selfIntersectionPoint:new V,intersectionPoint:new V,toIntersection:0};function detectCollision(i,o,a,s){var c=!1;r.toIntersection=999999;for(var u=function getBoxMesh(){return e||(e=Qr.primitives.box.vertexBuffer),e}().attributes.position,l=function getSphereMesh(){return n||(n=Qr.primitives.sphere.vertexBuffer),n}().attributes.position,p=V.fromPool(),h=V.fromPool(),f=V.fromPool(),d=tn.fromPool(),y=se.fromPool(),m=V.fromPool(),v=V.fromPool(),g=V.fromPool(),_=V.fromPool(),b=V.fromPool(),w=o.length,x=0,P=s;x<P.length;x++)for(var O=P[x],C=0,S=O.shapes;C<S.length;C++){var j=S[C];if(j){var R=null,T=null,E=void 0;if(j.isA(ma))R=j,E=u;else if(j.isA(da))T=j,E=l;else{if(!j.isA(Ea))continue;var B=j.mesh.asset;if(!B)continue;if("TRIANGLES"!==B.vertexBuffer.primitiveType)continue;if(B.vertexBuffer.indices)continue;E=B.vertexBuffer.attributes.position}for(var A=E.length/3/3,I=O.entity.transform.worldMatrix,M=0;M<A;++M){var z=9*M;if(R?(p.set(E[z]*R.extent.x+R.center.x,E[z+1]*R.extent.y+R.center.y,E[z+2]*R.extent.z+R.center.z).transform(I).divideVector(a),h.set(E[z+3]*R.extent.x+R.center.x,E[z+4]*R.extent.y+R.center.y,E[z+5]*R.extent.z+R.center.z).transform(I).divideVector(a),f.set(E[z+6]*R.extent.x+R.center.x,E[z+7]*R.extent.y+R.center.y,E[z+8]*R.extent.z+R.center.z).transform(I).divideVector(a)):T?(p.set(E[z]*T.radius+T.center.x,E[z+1]*T.radius+T.center.y,E[z+2]*T.radius+T.center.z).transform(I).divideVector(a),h.set(E[z+3]*T.radius+T.center.x,E[z+4]*T.radius+T.center.y,E[z+5]*T.radius+T.center.z).transform(I).divideVector(a),f.set(E[z+6]*T.radius+T.center.x,E[z+7]*T.radius+T.center.y,E[z+8]*T.radius+T.center.z).transform(I).divideVector(a)):(p.set(E[z],E[z+1],E[z+2]).transform(I).divideVector(a),h.set(E[z+3],E[z+4],E[z+5]).transform(I).divideVector(a),f.set(E[z+6],E[z+7],E[z+8]).transform(I).divideVector(a)),y.setFromPoints(p,h,f),y.classifyPoint(i)===re.Front){var k=y.normal.dot(o);if(!(k>0)){var D=-1,F=-1,L=y.getSignedDistance(i),N=!1;if(0!==k){if((D=(1-L)/k)>(F=(-1-L)/k)){var U=F;F=D,D=U}if(D>1||F<0)continue;D=W.clamp(D,0,1),F=W.clamp(F,0,1)}else{if(!(Math.abs(L)<1))continue;D=0,F=1,N=!0}var q=!1,G=1;if(N||(v.copy(y.normal).flip().add(i),g.copy(o).multiply(D).add(v),d.set(p,h,f),d.contains(g)&&(q=!0,G=D)),!q){var H=o.lengthSq,K=void 0,X=void 0,Q=void 0;K=H,m.copy(i).substract(p),X=2*o.dot(m),Q=m.lengthSq-1;var Y=t.getLowestRoot(K,X,Q,G);null!==Y&&(G=Y,q=!0,g.copy(p)),m.copy(i).substract(h),X=2*o.dot(m),Q=m.lengthSq-1,null!==(Y=t.getLowestRoot(K,X,Q,G))&&(G=Y,q=!0,g.copy(h)),m.copy(i).substract(f),X=2*o.dot(m),Q=m.lengthSq-1,null!==(Y=t.getLowestRoot(K,X,Q,G))&&(G=Y,q=!0,g.copy(f)),_.substractVectors(h,p),b.substractVectors(p,i);var Z,J=_.lengthSq,$=_.dot(o),tt=_.dot(b);if(K=J*-H+$*$,X=J*(2*o.dot(b))-2*$*tt,Q=J*(1-b.lengthSq)+tt*tt,null!==(Y=t.getLowestRoot(K,X,Q,G)))(Z=($*Y-tt)/J)>=0&&Z<=1&&(G=Y,q=!0,g.copy(_).multiply(Z).add(p));if(_.copy(f).substract(h),b.copy(h).substract(i),J=_.lengthSq,$=_.dot(o),tt=_.dot(b),K=J*-H+$*$,X=J*(2*o.dot(b))-2*$*tt,Q=J*(1-b.lengthSq)+tt*tt,null!==(Y=t.getLowestRoot(K,X,Q,G)))(Z=($*Y-tt)/J)>=0&&Z<=1&&(G=Y,q=!0,g.copy(_).multiply(Z).add(h));if(_.copy(p).substract(f),b.copy(f).substract(i),J=_.lengthSq,$=_.dot(o),tt=_.dot(b),K=J*-H+$*$,X=J*(2*o.dot(b))-2*$*tt,Q=J*(1-b.lengthSq)+tt*tt,null!==(Y=t.getLowestRoot(K,X,Q,G)))(Z=($*Y-tt)/J)>=0&&Z<=1&&(G=Y,q=!0,g.copy(_).multiply(Z).add(f))}if(q){var et=G*w;et<r.toIntersection&&(r.selfIntersectionPoint.copy(v),r.intersectionPoint.copy(g),r.toIntersection=et,c=!0)}}}}}}return c?r:null}t.getLowestRoot=function getLowestRoot(t,e,n,r){var i=e*e-4*t*n;if(i<0)return null;var o=Math.sqrt(i),a=(-e-o)/(2*t),s=(-e+o)/(2*t);if(a>s){var c=s;s=a,a=c}return a>0&&a<r?a:s>0&&s<r?s:null},t.collisionDetectionAndResponse=function collisionDetectionAndResponse(t,e,n,r,i){for(var o=V.fromPool().copy(t).divideVector(n),a=V.fromPool().copy(e).divideVector(n),s=function(t){return t.multiplyVector(n)},c=V.fromPool().addVectors(o,a),u=se.fromPool(),l=se.fromPool(),p=V.fromPool(),h=V.fromPool(),f=V.fromPool(),d=V.fromPool(),y=V.fromPool(),m=0;m<3;++m){var v=a.length;if(W.isZero(v))return void i.copy(s(c));var g=detectCollision(o,a,n,r);if(!g)return void i.copy(s(c));p.copy(a).divide(v);var _=Math.max(g.toIntersection-.001,0);if(o.add(p.multiply(_)),0===m){h.copy(g.intersectionPoint),f.copy(o).substract(g.intersectionPoint).normalize(),u.setFromPoint(f,h);var b=u.getSignedDistance(c);c.substract(f.multiply(b-1.001)),a.substractVectors(c,o)}else if(1===m){h.copy(g.intersectionPoint),f.copy(o).substract(g.intersectionPoint).normalize(),l.setFromPoint(f,h),d.crossVectors(u.normal,l.normal).normalize();var w=y.substractVectors(c,o).dot(d);a.copy(d).multiply(w),c.addVectors(o,a)}}i.copy(s(o))}}(Ac||(Ac={}));var Vc,Uc,Wc=function(t){function CharacterCollider(){var e=null!==t&&t.apply(this,arguments)||this;return e.gravity=-10,e.radius=new V(1,1,1),e._group=new Yt(ta),e._filter=new l(oa),e._velocity=new V,e._desiredVelocity=new V,e}return Fc(CharacterCollider,t),Object.defineProperty(CharacterCollider.prototype,"desiredVelocity",{set:function(t){this._desiredVelocity.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(CharacterCollider.prototype,"velocity",{get:function(){return this._velocity},enumerable:!0,configurable:!0}),Object.defineProperty(CharacterCollider.prototype,"group",{get:function(){return this._group.asset},enumerable:!0,configurable:!0}),CharacterCollider.prototype.update=function(t){var e=this._filter.instance,n=e?t.filter(function(t){return e.canCollideWith(t.group)}):t,r=V.fromPool().set(0,this.radius.y,0),i=V.fromPool().copy(this.entity.transform.worldPosition).add(r),o=V.fromPool(),a=this._velocity.y;this._velocity.set(this._desiredVelocity.x,0,this._desiredVelocity.z);var s=V.fromPool().copy(this._velocity).multiply(J.deltaTime);Ac.collisionDetectionAndResponse(i,s,this.radius,n,o),this._velocity.set(0,this._desiredVelocity.y||a,0),this._velocity.y+=this.gravity*J.deltaTime,s.copy(this._velocity).multiply(J.deltaTime),i.copy(o),Ac.collisionDetectionAndResponse(i,s,this.radius,n,o),W.isEqual(o.y,i.y+s.y)||(this._velocity.y=0),this._velocity.x=(o.x-i.x)/J.deltaTime,this._velocity.z=(o.z-i.z)/J.deltaTime,this.entity.transform.worldPosition=o.substract(r)},Lc([unserializable(),Nc("design:type",Object)],CharacterCollider.prototype,"_velocity",void 0),Lc([unserializable(),Nc("design:type",Object)],CharacterCollider.prototype,"_desiredVelocity",void 0),CharacterCollider}(Et);(Vc||(Vc={})).updateHook=new S.VoidSyncEvent,function(t){function iterateComponents(t,e,n){e[t.name].forEach(n)}(Uc||(Uc={})).update=function update(){wo.scanGamepads();var t=xa.ofTypes([Fs,hr,so]);iterateComponents(Fs,t,function(t){t.update(),t.entity.getComponents(Hs).forEach(function(e){return e.update(t)})}),au.collectEntityOperations=!0,Ts.update(t.AnimationComponent),iterateComponents(hr,t,function(t){return t.update()});try{Vc.updateHook.post()}catch(t){console.error("Runtime Error"),console.error(t.toString()),Vc.updateHook.detach()}au.collectEntityOperations=!1;for(var e=0,n=au.entitiesJustDestroyed;e<n.length;e++){var r=n[e];au.destroyEntity(r)}au.entitiesJustDestroyed.length=0;for(var i=0,o=au.entitiesJustCreated;i<o.length;i++){var a=(r=o[i]).getComponent(hr);a&&a.active&&a.update()}au.entitiesJustCreated.length=0,t=xa.ofTypes([Dc,Rs,dc,Za,ba,Wc]),iterateComponents(Dc,t,function(t){return t.update()}),iterateComponents(Rs,t,function(t){return t.update()}),iterateComponents(dc,t,function(t){return t.update()}),iterateComponents(Za,t,function(t){return t.update()}),gc.update(t.Collider,t.CharacterCollider),G.incrementCurrentFrame()}}();var qc,Gc=function(){function Update(){}return Object.defineProperty(Update,"hook",{get:function(){return Vc.updateHook},enumerable:!0,configurable:!0}),Update}();(qc||(qc={})).transientState={};var Hc,Kc=function(){function BehaviorAPI(){}return BehaviorAPI.api={Math:{PI:function(){return Math.PI},sin:function(t){return Math.sin(t)},cos:function(t){return Math.cos(t)},tan:function(t){return Math.tan(t)},sqrt:function(t){return Math.sqrt(t)},min:function(t,e){return Math.min(t,e)},max:function(t,e){return Math.max(t,e)},random:function(){return Math.random()},abs:function(t){return Math.abs(t)},sign:function(t){return Math.sign(t)},floor:function(t){return Math.floor(t)},ceil:function(t){return Math.ceil(t)},round:function(t){return Math.round(t)},acos:function(t){return Math.acos(t)},atan:function(t){return Math.atan(t)},atan2:function(t,e){return Math.atan2(t,e)},pow:function(t,e){return Math.pow(t,e)}},MathEx:{toRadians:function(t){return W.toRadians(t)},toDegrees:function(t){return W.toDegrees(t)},clamp:function(t,e,n){return W.clamp(t,e,n)},degreesToRadians:function(){return W.degreesToRadians},radiansToDegrees:function(){return W.radiansToDegrees},lerp:function(t,e,n){return W.lerp(t,e,n)}},console:{log:function(t){return k.log(t)},assert:function(t,e){return console.assert(t,e)},clear:function(){return console.clear()},logVector3:function(t){return k.logVector3(t)}},location:{reload:function(){return location.reload()}},window:{open:function(t){return window.open(t)}},JSON:{stringify:function(t){return JSON.stringify(t,null,2)},parse:function(t){return JSON.parse(t)}},Random:{range:function(t,e){return Nt.range(t,e)},rangeInt:function(t,e){return Nt.rangeInt(t,e)}},Scenes:{load:function(t,e){return Tu.load(t,e)}},Assets:{load:function(t){return Zo.load(t)},loadById:function(t){return Zo.loadById(t)}},Renderer:{screenSize:function(){return gt.renderer.screenSize}},Entities:{create:function(t){return Dt.create(t)},find:function(t){return Dt.find(t)}},Gamepads:{forEach:function(t){return Oo.forEach(t)},get:function(t){return Oo.get(t)}},Input:{touchX:function(){return Js.touchX},touchY:function(){return Js.touchY},touchPressed:function(){return Js.touchPressed},touchMoved:function(){return Js.touchMoved},touchReleased:function(){return Js.touchReleased},wheelMoved:function(){return Js.wheelMoved},keyChanged:function(){return Js.keyChanged}},Time:{deltaTime:function(){return J.deltaTime},smoothDeltaTime:function(){return J.smoothDeltaTime},fps:function(){return J.fps},currentFrame:function(){return J.currentFrame},time:function(){return J.time}},Project:{name:function(){return _o.projectName},isOpenSource:function(){return _o.isOpenSource},importToEditor:function(){return _o.importToEditor()}},SavedData:{get:function(){return xo.get()},flush:function(){return xo.flush()}},Update:{hook:function(){return Gc.hook}},Game:{state:function(){return qc.transientState}},ExecutionStatus:{Continue:function(){return $e.Continue},Finish:function(){return $e.Finish}},Vector3:{up:function(){return V.fromPool().copy(V.up)},right:function(){return V.fromPool().copy(V.right)},forward:function(){return V.fromPool().copy(V.forward)},zero:function(){return V.fromPool().copy(V.zero)},distance:function(t,e){return V.distance(t,e)},distanceSq:function(t,e){return V.distanceSq(t,e)},fromPool:function(){return V.fromPool()}},Plane:{fromPool:function(){return se.fromPool()}},Basis:{fromMatrix:function(t){return Se.fromMatrix(t)}},Matrix44:{identity:function(){return nt.fromPool().copy(nt.identity)},fromPool:function(){return nt.fromPool()}},Quaternion:{identity:function(){return it.fromPool().copy(it.identity)},fromPool:function(){return it.fromPool()},fromEulerAngles:function(t,e,n,r){return it.fromEulerAngles(t,e,n,r)},fromAxisAngle:function(t,e){return it.fromAxisAngle(t,e)}},Color:{white:function(){return H.dummy.copy(H.white)},black:function(){return H.dummy.copy(H.black)}},Object:{keys:function(t){return Object.keys(t)},values:function(t){return Object.values(t)},entries:function(t){return Object.entries(t)},assign:function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return Object.assign(t,e)}},Promise:{all:function(t){return Promise.all(t)}},HorizontalAlignment:{left:function(){return 0},center:function(){return 1},right:function(){return 2},stretch:function(){return 3}},VerticalAlignment:{top:function(){return 0},center:function(){return 1},bottom:function(){return 2},stretch:function(){return 3}},Array:{isArray:function(t){return Array.isArray(t)},from:function(t){return Array.from(t)}},Physics:{rayCast:function(t,e){return za.rayCast(t,e)}},Collision:{rayCastOnSphere:function(t,e,n){return t.castOnSphere(e,n)}},EngineHud:{setControls:function(t){return mo.setControls(t)}},Config:{isWeb:function(){return ka.isWeb()},isDesktop:function(){return ka.isDesktop()},isProduction:function(){return ka.isProduction()},isDevelopment:function(){return ka.isDevelopment()},isEditor:function(){return ka.isEditor()},isStandalone:function(){return ka.isStandalone()}}},BehaviorAPI}(),Xc=function(){return(Xc=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Qc=function(){function BehaviorUtils(){}return BehaviorUtils.pinsHaveSameType=function(t,e){if(t.constructor.name===e.constructor.name){if(t.isA(Xe)){var n=t.componentType,r=e.componentType;return n===r||"Component"===n||"Component"===r}return t.isA(Je)?t.assetType===e.assetType:t.isA(Ze)?t.dataType===e.dataType&&t.declarationId===e.declarationId:!t.isA(Ye)||t.declarationId===e.declarationId}return!1},BehaviorUtils.isPinLoaded=function(t){if(t.isA(He)){var e=t.value;if(!w.isAssetRefLoaded(e))return!1}else if(t.isA(Je)){var n=t.value;if(!w.isAssetRefLoaded(n))return!1}else if(t.isA(Ze))for(var r=0,i=t.value.data;r<i.length;r++){var o=i[r];if(!BehaviorUtils.isPinLoaded(o))return!1}else if(t.isA(Ye)){n=t.value;if(!w.isAssetRefLoaded(n))return!1}return!0},BehaviorUtils.buildPins=function(t,e){for(var n=new Ot(ye),r=function(e){var r=e.instance;if(r){var i=void 0;if(t.getPins()){var o=t.getPins().data.find(function(t){return t.instance.id===r.id}),a=o?o.instance:void 0;a&&a.type===r.type&&BehaviorUtils.pinsHaveSameType(a,r)&&((i=a).name=r.name)}i?n.grow(i):n.grow(r.copy())}},i=0,o=e.pins.data;i<o.length;i++){r(o[i])}t.setPins(n)},BehaviorUtils.updatePinAccessors=function(t){for(var e=function(e){var n=e.instance.name;Object.defineProperty(t,n,{get:function(){return t.findPinByName(n)[De.runtimeValueAccessor]},set:function(e){t.findPinByName(n)[De.runtimeValueAccessor]=e},configurable:!0})},n=0,r=t.getPins().data.filter(function(t){return t.instance.isA(ve)});n<r.length;n++){e(r[n])}},BehaviorUtils.initializeCodeBlockInstanceState=function(t,e,n,r){for(var i,o,a={this:(i={},i[De.runtimeValueAccessor]=e,i),transform:(o={},o[De.runtimeValueAccessor]=e.transform,o)},s=0,c=n.data.filter(function(t){return void 0!==t.instance&&t.instance.isA(ve)}).map(function(t){return t.instance});s<c.length;s++){var u=c[s];a[u.name]=u}var l="initState_"+mn.trimId(t.id);return l in window&&window[l](a,Kc.api,en.createObject,r),a},BehaviorUtils.getVariables=function(t){return t.pins.data.map(function(t){return t.instance}).filter(function(t){return void 0!==t}).reduce(function(t,e){var n;return Xc({},t,((n={})[e.name]=e.constructor.name,n))},{this:"Entity",transform:"Transform"})},BehaviorUtils}(),Yc=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Zc=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Jc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},$c=function(t){function ObjectDefinition(){var e=t.call(this)||this;return e._pins=new Ot(ye),e._declaration=new Yt(we),e.onDeclarationPinChanged=e.onDeclarationPinChanged.bind(e),e.onDeclarationChanged=e.onDeclarationChanged.bind(e),e._declaration.assetChanged.attach(e.onDeclarationChanged),e}return Yc(ObjectDefinition,t),Object.defineProperty(ObjectDefinition.prototype,"declaration",{get:function(){return this._declaration.asset},set:function(t){this._declaration.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(ObjectDefinition.prototype,"declarationId",{get:function(){return this._declaration.id},enumerable:!0,configurable:!0}),Object.defineProperty(ObjectDefinition.prototype,"pins",{get:function(){return this._pins},enumerable:!0,configurable:!0}),ObjectDefinition.prototype.isLoaded=function(){for(var t=0,e=this._pins.data;t<e.length;t++){var n=e[t];if(!Qc.isPinLoaded(n.instance))return!1}return!0},ObjectDefinition.prototype.destroy=function(){this.declaration&&this.declaration.pinChanged.detach(this.onDeclarationPinChanged),this._declaration.detach(),t.prototype.destroy.call(this)},ObjectDefinition.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n),"_pins"===e&&Qc.updatePinAccessors(this)},ObjectDefinition.prototype.getPins=function(){return this._pins},ObjectDefinition.prototype.setPins=function(t){this._pins=t},ObjectDefinition.prototype.findPinByName=function(t){return this._pins.data.map(function(t){return t.instance}).find(function(e){return e.name===t})},ObjectDefinition.prototype.onDeclarationPinChanged=function(t){this.declaration&&(Qc.buildPins(this,this.declaration),Qc.updatePinAccessors(this))},ObjectDefinition.prototype.onDeclarationChanged=function(t){var e=t.oldAsset;e&&e.pinChanged.detach(this.onDeclarationPinChanged);var n=t.newAsset;n&&(Qc.buildPins(this,n),n.pinChanged.attach(this.onDeclarationPinChanged))},ObjectDefinition=Zc([displayName("Object Definition"),creatable(!1),Jc("design:paramtypes",[])],ObjectDefinition)}(A),tu=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),eu=function(t){function ObjectReference(e){var n=t.call(this,$c)||this;return n._declarationId=e,n}return tu(ObjectReference,t),Object.defineProperty(ObjectReference.prototype,"declarationId",{get:function(){return this._declarationId},set:function(t){this._declarationId=t},enumerable:!0,configurable:!0}),ObjectReference}(Yt);Hc||(Hc={});var nu,ru,iu=function(){function IEntityUtilsInternal(){}return Object.defineProperty(IEntityUtilsInternal,"instance",{get:function(){return Hc.instance},set:function(t){Hc.instance=t},enumerable:!0,configurable:!0}),IEntityUtilsInternal}(),ou=function(){return(ou=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};!function(t){t.serializeNonPersistentObjects=void 0,t.nonPersistentObjectCache=null,t.mockInstanceCache={}}(nu||(nu={})),function(t){t.serializeIdsAsPaths=!1}(ru||(ru={}));var au,su=function(){function SerializerUtils(){}return SerializerUtils.serializeEntity=function(t,e){SerializerUtils.serializeNonPersistentObjects(e);var n=t.children.map(function(t){return SerializerUtils.serializeEntity(t,e)}),r=[];t.iterateComponents(function(t){t.controller||r.push(t)});var i=iu.instance.sortComponents(r),o=SerializerUtils.serializeComponents(i);return SerializerUtils.serializeNonPersistentObjects(!1),{id:t.id,name:t.name,active:t.active,prefabId:t.prefabId,components:r.length>0?o:void 0,children:n.length>0?n:void 0}},SerializerUtils.deserializeEntity=function(t,e,n){if(t.name=e.name,t.id=e.id,t.initializeActive(e.active),t.prefabId=e.prefabId,e.components){if(Array.isArray(e.components)){for(var r={},i=0,o=e.components;i<o.length;i++){var a=o[i],s=a.typeName;delete a.typeName,r[s]=a}e.components=r}for(var c=0,u=Object.keys(e.components);c<u.length;c++){s=u[c];var l=e.components[s],p=g.instance.createObject(s);SerializerUtils.deserializeObject(p,l),au.setComponentFromInstance(t,p)}}if(e.children)for(var h=0,f=e.children;h<f.length;h++){var d=f[h],y=new hu;t.addChild(y),SerializerUtils.deserializeEntity(y,d,n)}},SerializerUtils.serializeEntityWithPrefabRefs=function(t){if(t.prefabId)return{id:t.id,name:t.name,active:t.active,prefabId:t.prefabId};var e=t.children.map(function(t){return SerializerUtils.serializeEntityWithPrefabRefs(t)}),n=[];t.iterateComponents(function(t){t.controller||n.push(t)});var r=iu.instance.sortComponents(n),i=SerializerUtils.serializeComponents(r);return{id:t.id,name:t.name,active:t.active,components:n.length>0?i:void 0,children:e.length>0?e:void 0}},SerializerUtils.serializeObject=function(t){var e={typeName:t.constructor.name,version:SerializerUtils.getObjectVersion(t),properties:{}};return SerializerUtils.serializeProperties(t,e),e},SerializerUtils.deserializeObject=function(t,e){var n=e,r=e.version||1,i=SerializerUtils.getObjectVersion(t);if(r<i)for(var o=r;o<i;++o)(n=t.upgrade(e,o)).version=o+1;for(var a=0,s=Object.keys(n.properties);a<s.length;a++){var c=s[a];if(SerializerUtils.isPropertySerializable(t.constructor.name,c)){var u,l=n.properties[c];if(SerializerUtils.isDynamicProperty(t.constructor.name,c))(u=l.typeName)&&SerializerUtils.deserializeProperty(t,c,u,l.data);else(u=SerializerUtils.getPropertyTypeName(t[c]))&&SerializerUtils.deserializeProperty(t,c,u,l)}}},SerializerUtils.serializeNonPersistentObjects=function(t){nu.serializeNonPersistentObjects=t},SerializerUtils.clearNonPersistentObjectCache=function(){nu.nonPersistentObjectCache=null},SerializerUtils.serializeProperty=function(t,e){var n=e||SerializerUtils.getPropertyTypeName(t);if(["AssetReference","ObjectReference"].indexOf(n)>=0){var r=t,i=r.id;r.asset&&!r.asset.isPersistent&&(nu.serializeNonPersistentObjects?(nu.nonPersistentObjectCache||(nu.nonPersistentObjectCache={}),nu.nonPersistentObjectCache[r.asset.id]=r.asset):i=void 0);var o={typeName:r.typeName(),id:i};return"ObjectReference"===n&&Object.assign(o,{declarationId:t.declarationId}),o}if("Entity"===n)return SerializerUtils.serializeEntity(t);if(d.isObjectOfType(n,"SerializableObject"))return t.serialize();var a=ue.properties;return n in a?a[n].writeProperty(t):(k.logWarning("Cannot serialize property of type '"+n+"'"),"__serializeFailed__")},SerializerUtils.deserializeProperty=function(t,e,n,r,i){if(void 0===i&&(i=!1),["AssetReference","ObjectReference"].indexOf(n)>=0){var o=r,a=o.id,s=t[e];if("AssetReference"===n)s||(s=g.instance.createAssetReference(o.typeName),t[e]=s);else{var c=r;s?s.declarationId=c.declarationId:(s=new eu(c.declarationId),t[e]=s)}if(s.id=a,a)if(nu.nonPersistentObjectCache&&a in nu.nonPersistentObjectCache)s.asset=nu.nonPersistentObjectCache[a],SerializerUtils.setProperty(t,e,s,i);else{So.loadObject(a,function(n,r){var o=n,a=t[e];a.asset=o,SerializerUtils.setProperty(t,e,a,i),!1===r&&fn.assetLoaded.post(o)},function(){var n=t[e];n.setAssetFast(null),n.state=qt.Resolved,SerializerUtils.setProperty(t,e,n,i);var r=t.templatePath;r=r?"in '"+r+"'":"in '"+t.constructor.name+"'",k.logError("Missing asset still referenced '"+e+"', id: '"+a+"' "+(r||""))},!1)}else s.asset=null,SerializerUtils.setProperty(t,e,s,i)}else if("Entity"===n){var u=new hu;SerializerUtils.deserializeEntity(u,r,!0),SerializerUtils.setProperty(t,e,u,i)}else if(d.isObjectOfType(n,"SerializableObject")){(u=g.instance.createObject(n))&&(u.deserialize(r),SerializerUtils.setProperty(t,e,u,i))}else{if("Number"===n){var l=Reflect.getMetadata("enumLiterals",t,e);if(l){if("number"==typeof r)SerializerUtils.setProperty(t,e,r,i);else if("object"==typeof r)SerializerUtils.setProperty(t,e,r.value,i);else{var p=l.literals[r];console.assert(void 0!==p),SerializerUtils.setProperty(t,e,p,i)}return}}var h=ue.properties,f=n in h?h[n].readProperty(r,t,e):r;void 0!==f&&SerializerUtils.setProperty(t,e,f,i)}},SerializerUtils.getPropertyTypeName=function(t){var e=typeof t;return"object"===e?t.constructor.name:e=e[0].toUpperCase()+e.substring(1)},SerializerUtils.copyProperty=function(t,e,n){var r=SerializerUtils.getSerializablePropertyTypeName(t,n);if(null===r)return!1;var i=SerializerUtils.serializeProperty(t[n],r);return SerializerUtils.deserializeProperty(e,n,r,i),!0},SerializerUtils.getSerializablePropertyTypeName=function(t,e){var n=t[e];return"function"==typeof n?null:Reflect.getMetadata("unserializable",t,e)?null:SerializerUtils.getPropertyTypeName(n)},SerializerUtils.setProperty=function(t,e,n,r){void 0===r&&(r=!1);var i=function(){Array.isArray(t)?t[e]=n:t.setProperty(e,n)};if(r)if("string"==typeof e&&e.startsWith("_")){var o=e.slice(1),a=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),o);a&&a.set?"Reference"===n.constructor.name?a.set.call(t,n.getInstance()):"AssetReference"===n.constructor.name?a.set.call(t,n.asset):"EntityReference"===n.constructor.name?a.set.call(t,n.entity):"ComponentReference"===n.constructor.name?a.set.call(t,n.component):"ReferenceArray"===n.constructor.name?a.set.call(t,n.getData().map(function(t){return t.getInstance()})):a.set.call(t,n):i()}else i();else i()},SerializerUtils.isDynamicProperty=function(t,e){var n=nu.mockInstanceCache[t];return n||(n=g.instance.createObject(t),nu.mockInstanceCache[t]=n),!(e in n)},SerializerUtils.isPropertySerializable=function(t,e){var n=nu.mockInstanceCache[t];return n||(n=g.instance.createObject(t),nu.mockInstanceCache[t]=n),!Reflect.getMetadata("unserializable",n,e)},SerializerUtils.getObjectVersion=function(t){return t.version||1},SerializerUtils.serializeProperties=function(t,e){for(var n=function(n){if(Reflect.getMetadata("unserializable",t,n))return"continue";var r=t[n];if("function"==typeof r||null==r)return"continue";var i=SerializerUtils.getPropertyTypeName(r);if("Number"===i){var o=Reflect.getMetadata("enumLiterals",t,n);if(o){var a=Object.keys(o.literals).find(function(t){return o.literals[t]===r});console.assert(a),r=a,i="String"}}var s=SerializerUtils.serializeProperty(r,i);"__serializeFailed__"!==s&&(SerializerUtils.isDynamicProperty(t.constructor.name,n)?e.properties[n]={typeName:i,data:s}:e.properties[n]=s)},r=0,i=Object.keys(t);r<i.length;r++){n(i[r])}},SerializerUtils.serializeComponent=function(t){var e={version:SerializerUtils.getObjectVersion(t),properties:{}};return SerializerUtils.serializeProperties(t,e),e},SerializerUtils.serializeComponents=function(t){return t.reduce(function(t,e){var n;return ou({},t,((n={})[e.constructor.name]=SerializerUtils.serializeComponent(e),n))},{})},SerializerUtils}(),cu=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),uu=void 0;(function(t){function clearComponent(t,e){var n=t._components[e];return!!n&&(n.destroy(),delete t._components[e],!0)}function setComponentFromInstance(t,e){clearComponent(t,e.constructor.name),t._components[e.constructor.name]=e,e.setEntity(t)}t.entitiesJustDestroyed=[],t.entitiesJustCreated=[],t.collectEntityOperations=!1,t.destroyEntity=function destroyEntity(t){for(var e=0,n=Object.keys(t._components).map(function(e){return t._components[e]}).filter(function(t){return!t.controller});e<n.length;e++)n[e].destroy();for(var r=0,i=t.children.slice();r<i.length;r++)i[r].destroy();t._components={},t.children=[]},t.setComponentFromInstance=setComponentFromInstance,t.setComponentByName=function setComponentByName(t,e,n){var r=g.instance.createObject(e,n);return setComponentFromInstance(t,r),uu&&uu.componentAddedOrRemovedByRuntime.post(t),r},t.getComponentByName=function getComponentByName(t,e){return t._components[e]||null},t.clearComponentByName=function clearComponentByName(t,e){clearComponent(t,e)&&uu&&uu.componentAddedOrRemovedByRuntime.post(t)}})(au||(au={}));var lu,pu,hu=function(t){function Entity(){var e=null!==t&&t.apply(this,arguments)||this;return e.children=[],e._components={},e._tags={},e._active=!0,e}return cu(Entity,t),Object.defineProperty(Entity.prototype,"transform",{get:function(){return this.getComponent(zt)},enumerable:!0,configurable:!0}),Object.defineProperty(Entity.prototype,"active",{get:function(){return this._active},set:function(t){this._active=t,uu&&uu.entityActivated.post(this)},enumerable:!0,configurable:!0}),Entity.prototype.isLoaded=function(){var t=!0;return this.traverse(function(e){for(var n=0,r=Object.values(e._components);n<r.length;n++){if(!r[n].isLoaded())return t=!1,!1}return!0},!0),t},Entity.prototype.setComponent=function(t,e){var n=new t(e);return au.setComponentFromInstance(this,n),this},Entity.prototype.setComponentByName=function(t,e){return au.setComponentByName(this,t,e),this},Entity.prototype.getComponent=function(t){return au.getComponentByName(this,t.name)},Entity.prototype.getComponentByName=function(t){return au.getComponentByName(this,t)},Entity.prototype.clearComponent=function(t){return au.clearComponentByName(this,t.name),this},Entity.prototype.updateComponent=function(t,e){return this.updateComponentByName(t.name,e)},Entity.prototype.updateComponentByName=function(t,e){var n=this.getComponentByName(t);return n&&n.setState(e),this},Entity.prototype.getOrSetComponent=function(t){return this.getOrSetComponentByName(t.name)},Entity.prototype.getOrSetComponentByName=function(t){return au.getComponentByName(this,t)||au.setComponentByName(this,t)},Entity.prototype.getComponents=function(t){var e=[];return this.getComponentsInChildren(t.name,e),e},Entity.prototype.addChild=function(t,e){void 0===e&&(e=!1);var n=t.parent;return n&&(e&&iu.instance.preserveWorldPosition(t,this),n.removeChild(t)),t.parent=this,this.children.push(t),iu.instance.dirtifyWorldMatrixIfNecessary(t),iu.instance.updateLayoutMatrixIfNecessary(t),uu&&uu.entityHierarchyChanged.post(),this},Entity.prototype.insertChild=function(t,e,n){void 0===n&&(n=!1);var r=t.parent;return r&&(n&&iu.instance.preserveWorldPosition(t,this),r.removeChild(t)),t.parent=this,this.children.splice(e,0,t),iu.instance.dirtifyWorldMatrixIfNecessary(t),iu.instance.updateLayoutMatrixIfNecessary(t),uu&&uu.entityHierarchyChanged.post(),this},Entity.prototype.removeChild=function(t){delete t.parent;var e=this.children.indexOf(t);return this.children.splice(e,1),uu&&uu.entityHierarchyChanged.post(),this},Entity.prototype.removeAllChildren=function(){for(var t=0,e=this.children.slice();t<e.length;t++){e[t].destroy()}return this},Entity.prototype.findChildById=function(t){if(this.id===t)return this;for(var e=0,n=this.children;e<n.length;e++){if((o=n[e]).id===t)return o}for(var r=0,i=this.children;r<i.length;r++){var o,a=(o=i[r]).findChildById(t);if(a)return a}},Entity.prototype.findChild=function(t){for(var e=0,n=this.children;e<n.length;e++){if((o=n[e]).name===t)return o}for(var r=0,i=this.children;r<i.length;r++){var o,a=(o=i[r]).findChild(t);if(a)return a}},Entity.prototype.filterChildren=function(t){var e=[];return this.traverse(function(n){return t(n)&&e.push(n),!0}),e},Entity.prototype.isAncestor=function(t){return this.parent===t||!!this.parent&&this.parent.isAncestor(t)},Entity.prototype.setTag=function(t){var e;return Object.assign(this._tags,((e={})[t]=!0,e)),this},Entity.prototype.hasTag=function(t){return t in this._tags},Entity.prototype.traverse=function(t,e){void 0===e&&(e=!1);var n=!0;e&&(n=t(this)),!1!==n&&this.traverseInternal(this,t)},Entity.prototype.traverseAncestors=function(t,e){void 0===e&&(e=!1);var n=!0;e&&(n=t(this)),!1!==n&&this.traverseAncestorsInternal(this,t)},Entity.prototype.iterateComponents=function(t){for(var e=0,n=Object.values(this._components);e<n.length;e++){t(n[e])}},Entity.prototype.getAncestor=function(t){var e=au.getComponentByName(this,t);return e&&e.active?e:this.parent?this.parent.getAncestor(t):null},Entity.prototype.getAncestorOfType=function(t){return this.getAncestor(t.name)},Entity.prototype.destroy=function(){this.parent&&this.parent.removeChild(this),au.collectEntityOperations?au.entitiesJustDestroyed.push(this):au.destroyEntity(this)},Entity.prototype.hasComponent=function(t){return t in this._components},Entity.prototype.hasComponentByType=function(t){return this.hasComponent(t.name)},Entity.prototype.serialize=function(){return console.assert(!1),{typeName:"InvalidEntityData",version:1,properties:{}}},Entity.prototype.deserialize=function(t){return console.assert(!1),Promise.reject()},Entity.prototype.copyWithIdMap=function(t){return this.copyInternal(t,void 0)},Entity.prototype.copy=function(t,e){return this.copyInternal(void 0,t)},Entity.prototype.initializeActive=function(t){this._active=t},Entity.prototype.copyInternal=function(t,e){var n=new Entity;n.prefabId=this.prefabId,su.deserializeEntity(n,su.serializeEntity(this,!0));var r=t||e||{};return n.traverse(function(e){if(t){var n=t[e.id];if(n)return e.id=n,!0}var i=w.makeUniqueId();return r[e.id]=i,e.id=i,!0},!0),iu.instance.translateReferences(n,r),n},Entity.prototype.getComponentsInChildren=function(t,e){if(this.active){var n=au.getComponentByName(this,t);n&&n.active&&e.push(n);for(var r=0,i=this.children;r<i.length;r++){i[r].getComponentsInChildren(t,e)}}},Entity.prototype.traverseInternal=function(t,e){for(var n=0,r=t.children;n<r.length;n++){var i=r[n];e(i)&&this.traverseInternal(i,e)}},Entity.prototype.traverseAncestorsInternal=function(t,e){t.parent&&e(t.parent)&&this.traverseAncestorsInternal(t.parent,e)},Entity}(C),fu=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),du=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},yu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},mu=function(t){function StaticCubemap(){var e=null!==t&&t.apply(this,arguments)||this;return e.front=new Yt(Rr),e.back=new Yt(Rr),e.top=new Yt(Rr),e.bottom=new Yt(Rr),e.left=new Yt(Rr),e.right=new Yt(Rr),e}return fu(StaticCubemap,t),StaticCubemap.prototype.setProperty=function(e,n){var r=this;if(t.prototype.setProperty.call(this,e,n),this._textureId){var i=n.asset;if(i){this.initConfigIfNecessary();var o=this._config.find(function(t){return t.id===e});o&&i.loadTextureData(function(){var t=ht.context;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,r._textureId),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.texImage2D(o.side,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.image)})}}},StaticCubemap.prototype.isLoaded=function(){return this.initConfigIfNecessary(),this._config.every(function(t){return w.isAssetRefLoaded(t.texture)})},StaticCubemap.prototype.begin=function(t){if(!this._textureId&&!this.graphicLoad())return!1;var e=ht.context;return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._textureId),!0},StaticCubemap.prototype.graphicLoad=function(){if(this._textureId)return!0;var t=ht.context;this._textureId=t.createTexture(),this.initConfigIfNecessary();for(var e=0,n=this._config;e<n.length;e++){var r=n[e],i=r.texture.asset;i&&(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,this._textureId),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.texImage2D(r.side,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.image))}return t.bindTexture(t.TEXTURE_CUBE_MAP,this._textureId),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),!0},StaticCubemap.prototype.graphicUnload=function(){this._textureId&&(ht.context.deleteTexture(this._textureId),this._textureId=null)},StaticCubemap.prototype.makeConfig=function(t){return[{id:"front",texture:this.front,side:t.TEXTURE_CUBE_MAP_POSITIVE_Z},{id:"back",texture:this.back,side:t.TEXTURE_CUBE_MAP_NEGATIVE_Z},{id:"top",texture:this.top,side:t.TEXTURE_CUBE_MAP_POSITIVE_Y},{id:"bottom",texture:this.bottom,side:t.TEXTURE_CUBE_MAP_NEGATIVE_Y},{id:"left",texture:this.left,side:t.TEXTURE_CUBE_MAP_NEGATIVE_X},{id:"right",texture:this.right,side:t.TEXTURE_CUBE_MAP_POSITIVE_X}]},StaticCubemap.prototype.initConfigIfNecessary=function(){this._config||(this._config=this.makeConfig(ht.context))},du([unserializable(),yu("design:type",Object)],StaticCubemap.prototype,"_textureId",void 0),du([unserializable(),yu("design:type",Array)],StaticCubemap.prototype,"_config",void 0),StaticCubemap=du([creatable(!0),referencable(!0),displayName("Static Cubemap")],StaticCubemap)}(L),vu=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),gu=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},_u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},bu=function(t){function Environment(){return null!==t&&t.apply(this,arguments)||this}return vu(Environment,t),Environment}(_),wu=function(t){function ColorEnvironment(e){var n=t.call(this)||this;return n.color=e||new H,n.color.a=0,n}return vu(ColorEnvironment,t),ColorEnvironment=gu([displayName("Color"),_u("design:paramtypes",[H])],ColorEnvironment)}(bu),xu=function(t){function SkySimulation(){var e=null!==t&&t.apply(this,arguments)||this;return e.luminance=1,e.turbidity=2,e.rayleigh=1,e.mieCoefficient=.005,e.mieDirectionalG=.8,e.sunPosition=new V(0,1,1).normalize(),e}return vu(SkySimulation,t),SkySimulation}(bu),Pu=function(t){function SkyBoxEnvironment(){var e=null!==t&&t.apply(this,arguments)||this;return e._cubeMap=new Yt(mu),e}return vu(SkyBoxEnvironment,t),Object.defineProperty(SkyBoxEnvironment.prototype,"cubeMap",{get:function(){return this._cubeMap.asset},set:function(t){this._cubeMap.asset=t},enumerable:!0,configurable:!0}),SkyBoxEnvironment=gu([displayName("Skybox")],SkyBoxEnvironment)}(bu),Ou=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Cu=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Su=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ju=function(t){function Scene(){var e=t.call(this)||this;return e._isLoadedCache=!1,e.root=new hu,e.root.name="root",e._environment=new l(bu,new wu),e._fog=new l(X),e}return Ou(Scene,t),Object.defineProperty(Scene.prototype,"version",{get:function(){return 5},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"fog",{get:function(){return this._fog.instance},set:function(t){t!==this._fog.instance&&((this._fog.instance?this._fog.instance.constructor.name:void 0)!==(t?t.constructor.name:void 0)&&R.instance.forEach(function(t){t.isA(Lu)&&t.invalidateProgram()}),this._fog.instance=t)},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"environment",{get:function(){return this._environment.instance},enumerable:!0,configurable:!0}),Scene.prototype.isLoaded=function(){if(this._isLoadedCache)return this._isLoadedCache;var t=this.root.isLoaded();return t&&(this._isLoadedCache=!0),t},Scene.prototype.serialize=function(){var t={typeName:this.constructor.name,version:this.version,id:this.id,name:this.name,root:su.serializeEntityWithPrefabRefs(this.root),environment:su.serializeProperty(this._environment),fog:su.serializeProperty(this._fog)};return this.prefabInstances&&Object.keys(this.prefabInstances).length>0&&(t.prefabInstances=this.prefabInstances),t},Scene.prototype.deserialize=function(t){var e=this,n=t;if(1===n.version){var r=t;n.root=r.properties.root,n.id=r.properties.id,n.name=r.properties.name}else 2===n.version||(3===n.version?su.deserializeProperty(this,"_environment","Reference",n.environment):(su.deserializeProperty(this,"_environment","Reference",n.environment),su.deserializeProperty(this,"_fog","Reference",n.fog)));this.id=n.id,this.name=n.name,this.prefabInstances=n.prefabInstances,su.deserializeEntity(this.root,n.root,!0);var i=[];return this.root.traverse(function(t){return!t.prefabId||(i.push({prefabId:t.prefabId,instanceInScene:t}),!1)}),new Promise(function(t){jo.processBatch(i,function(t,n,r){e.setEntityFromPrefab(t.instanceInScene,t.prefabId).then(n).catch(r)},function(n){return t(e)})})},Scene.prototype.destroy=function(){this.root.destroy(),t.prototype.destroy.call(this)},Scene.prototype.setEntityFromPrefab=function(t,e){var n=this;return Promise.resolve().then(function(){return R.instance.loadObject(e)}).then(function(e){var r=e[0];return n.setEntityFromPrefabInstance(t,r),r})},Scene.prototype.setEntityFromPrefabInstance=function(t,e){var n=this;t.prefabId=e.id;var r,i=this.prefabInstances?this.prefabInstances[t.id]:void 0,o=i?i.prefabIdToInstanceId:void 0,a=!0;o||(a=!1,o={}),r=a?e.root.copyWithIdMap(o):e.root.copy(o,!0),console.assert(0===t.children.length);for(var s=0,c=r.children;s<c.length;s++){var u=c[s];u.parent=t,t.children.push(u)}if(r.iterateComponents(function(e){return au.setComponentFromInstance(t,e)}),a){var l=i;t.traverse(function(t){return l.overrides&&t.id in l.overrides&&n.overrideEntity(t,l.overrides[t.id]),!0},!0)}else this.prefabInstances||(this.prefabInstances={}),t.id=o[e.root.id],console.assert(void 0!==t.id),this.prefabInstances[t.id]={prefabIdToInstanceId:o}},Scene.prototype.overrideEntity=function(t,e){for(var n=0,r=Object.keys(e);n<r.length;n++)for(var i=r[n],o=0,a=Object.keys(e[i]);o<a.length;o++){var s=a[o],c=e[i][s],u=null;if(s in(u="Entity"===i?t:t.hasComponent(i)?au.getComponentByName(t,i):au.setComponentByName(t,i))){var l=su.getPropertyTypeName(u[s]);su.deserializeProperty(u,s,l,c)}}},Cu([Attributes_hidden(),Su("design:type",hu)],Scene.prototype,"root",void 0),Cu([Attributes_hidden(),Su("design:type",Object)],Scene.prototype,"prefabInstances",void 0),Cu([unserializable(),Su("design:type",Object)],Scene.prototype,"_isLoadedCache",void 0),Scene}(A);!function(t){function getTransitionAnimComponent(){return Qr.transitionScene.root.findChild("FadeQuad").getComponent(so)}function finalizeSceneLoad(){var e=0===t.scenes.length;if(t.sceneLoadInProgress){var n=t.sceneLoadInProgress,r=n.additive,i=n.scene,o=n.resolve;if(i){var a=!1;r||(t.scenes.forEach(function(t){a=t.templatePath===i.templatePath,R.instance.deleteObject(t)}),Yl.clearDefaultPerspectiveCamera(),G.resetCurrentFrame(),mo.onSceneDestroyed(),fc.clearCollisions(),t.scenes.length=0),a&&R.instance.addToCache(i),t.scenes.push(i),e?(mo.create(),R.instance.loadGraphicObjects()):R.instance.loadGraphicObjects(),t.sceneLoadInProgress=null,su.clearNonPersistentObjectCache(),o(i)}else console.assert(!1)}else console.assert(!1)}t.scenes=[],t.transitionInProgress=!1,t.sceneLoadInProgress=null,t.preloadedScenesInProgress=[],t.preloadedScenes=[],t.getTransitionAnimComponent=getTransitionAnimComponent,t.finalizeSceneLoad=finalizeSceneLoad,t.onTransitionAnimFinished=function onTransitionAnimFinished(e){var n=getTransitionAnimComponent();"FadeOut"===e?(t.scenes.pop(),finalizeSceneLoad(),n.animationFinished.once(onTransitionAnimFinished),n.playAnimation("FadeIn"),t.scenes.push(Qr.transitionScene)):"FadeIn"===e&&(t.scenes.pop(),t.transitionInProgress=!1)}}(lu||(lu={})),function(t){t.list=function list(){return lu.scenes},t.updateTransition=function updateTransition(){if(!lu.transitionInProgress&&lu.sceneLoadInProgress){var t=lu.sceneLoadInProgress.scene;if(t&&t.isLoaded())if(k.log("Scene '"+t.templatePath+"' loaded."),lu.scenes.length>0){var e=lu.getTransitionAnimComponent();e.animationFinished.once(lu.onTransitionAnimFinished),e.playAnimation("FadeOut"),lu.transitionInProgress=!0,lu.scenes.push(Qr.transitionScene)}else lu.finalizeSceneLoad()}},t.destroy=function destroy(){lu.scenes.forEach(function(t){return R.instance.deleteObject(t)}),lu.scenes=[]}}(pu||(pu={}));var Ru,Tu=function(){function Scenes(){}return Scenes.load=function(t,e){if(void 0===e&&(e=!1),lu.sceneLoadInProgress)return console.warn("Only one scene load is supported at a time. Loading '"+lu.sceneLoadInProgress.path+"', skipping '"+t+"'"),Promise.reject();if(lu.preloadedScenes.some(function(e){return e===t})){var n=lu.preloadedScenes.indexOf(t);console.assert(n>=0),lu.preloadedScenes.splice(n,1);var r=R.instance.getObject(t);return console.assert(r),lu.sceneLoadInProgress={scene:r,path:t,additive:e,resolve:function(){}},lu.finalizeSceneLoad(),Promise.resolve(r)}return new Promise(function(n,r){lu.sceneLoadInProgress={path:t,additive:e,resolve:n},So.loadObjectIgnoreCache(t).then(function(t){lu.sceneLoadInProgress.scene=t[0]}).catch(r)})},Scenes.loadById=function(t){var e=Qo.getPath(t);return e?Scenes.load(e):Promise.reject()},Scenes.unload=function(t){var e=lu.scenes.indexOf(t);e>=0?(t.destroy(),lu.scenes.splice(e,1)):console.warn("Trying to unload an unregistered scene instance")},Scenes.unloadByPath=function(t){var e=lu.scenes.find(function(e){return e.templatePath===t});e?Scenes.unload(e):console.warn("Trying to unload an unknown scene '"+t+"'")},Scenes.create=function(){var t=new ju;return lu.scenes.push(t),t},Scenes.preLoad=function(t){return lu.preloadedScenesInProgress.some(function(e){return e===t})?(console.warn("Scene '"+t+"' is already being pre-loaded. Skipping request."),Promise.reject()):lu.preloadedScenes.some(function(e){return e===t})?(console.warn("Scene '"+t+"' is already pre-loaded. Skipping request."),Promise.reject()):(lu.preloadedScenesInProgress.push(t),new Promise(function(e,n){So.loadObjectIgnoreCache(t).then(function(){lu.preloadedScenes.push(t);var n=lu.preloadedScenesInProgress.indexOf(t);console.assert(n>=0),lu.preloadedScenesInProgress.splice(n,1),e()}).catch(n)}))},Scenes.clear=function(){pu.destroy()},Scenes}();!function(t){(Ru||(Ru={})).getSections=function getSections(t){var e=t.match(/precision[' ']+(highp|mediump|lowp)[' ']+(float|int)[' ']*;/g),n=e?e.join("\n"):"",r=t.lastIndexOf("}");if(r>=0){var i=t;if(e&&e.length>0){var o=e[e.length-1],a=t.indexOf(o);i=t.substring(a+o.length,r)}else i=t.substring(0,r);return{qualifiers:n,coreMeat:i}}return k.logError("Invalid fragment shader syntax - could not locate closing bracket of entry block"),null}}();var Eu,Bu=function(){function ShaderCodeInjector(){}return ShaderCodeInjector.doVertexShader=function(t,e,n,r,i){var o="",a="",s="",c=!1;if(gt.renderer.showWireFrame&&(a+="\n    attribute vec3 barycentricCoord;\n    varying vec3 vBarycentric;",s+="\n    vBarycentric = barycentricCoord;",c=!0),!0===e&&(o+="\n    #define USE_SKINNING",c=!0),!0===n){var u=pu.list()[0].fog;u&&(o+="\n    #define USE_FOG",u.isA(Q)&&(o+="\n    #define USE_EXPONENTIAL_FOG"),c=!0)}if(!0===r&&(o+="\n    #define USE_SHADOW_MAP",c=!0),!0===i&&(o+="\n    #define USE_VERTEX_COLOR",c=!0),c){var l=Ru.getSections(t);if(l)return o+"\n                    "+l.qualifiers+"\n                    "+a+"\n                    "+l.coreMeat+"\n                    "+s+"\n                }\n                "}return t},ShaderCodeInjector.doFragmentShader=function(t,e,n,r){var i="",o="",a="",s=!1;if(gt.renderer.showWireFrame&&(ht.extensions.OES_standard_derivatives&&(1===ht.version&&(i+="\n    #extension GL_OES_standard_derivatives: enable"),i+="\n    #define Supports_GL_OES_standard_derivatives                \n                "),o+="\n    varying vec3 vBarycentric;\n    #ifdef Supports_GL_OES_standard_derivatives\n    float edgeFactor() {\n        vec3 d = fwidth(vBarycentric);\n        vec3 a3 = smoothstep(vec3(0.0), d * 1.2, vBarycentric);\n        return min(min(a3.x, a3.y), a3.z);\n    }\n    #endif",a+="\n    #ifdef Supports_GL_OES_standard_derivatives\n        gl_FragColor = mix(vec4(.8, .8, .8, 1.0), gl_FragColor, edgeFactor());    \n    #else\n        if(any(lessThan(vBarycentric, vec3(0.01)))) {\n            gl_FragColor = vec4(vec3(.7), 1.0);\n        }\n    #endif",s=!0),!0===e){var c=pu.list()[0].fog;c&&(i+="\n    #define USE_FOG",c.isA(Q)&&(i+="\n    #define USE_EXPONENTIAL_FOG"),s=!0)}if(!0===n&&(i+="\n    #define USE_SHADOW_MAP",s=!0),!0===r&&(i+="\n    #define USE_VERTEX_COLOR",s=!0),s){var u=Ru.getSections(t);if(u)return i+"\n                    "+u.qualifiers+"                    \n                    "+o+"\n                    "+u.coreMeat+"\n                    "+a+"\n                }\n                "}return t},ShaderCodeInjector}();!function(t){function flattenVectors(t){return t.reduce(function(t,e){return t.concat(e.asArray())},[])}function flattenMatrices(t){return t.reduce(function(t,e){return t.concat(e.data)},[])}t.engineManagedParams={screenSize:!0,projectionMatrix:!0,viewMatrix:!0,worldMatrix:!0,normalMatrix:!0,modelViewMatrix:!0,boneTexture:!0,boneTextureSize:!0,boneMatrices:!0,bindMatrix:!0,bindMatrixInverse:!0,fogColor:!0,fogDensity:!0,fogNear:!0,fogFar:!0,time:!0,deltaTime:!0,frame:!0,lightMatrix:!0,shadowMap:!0,"directionalLight.direction":!0,"directionalLight.color":!0,"directionalLight.shadow":!0,"directionalLight.shadowBias":!0,"directionalLight.shadowRadius":!0,"directionalLight.shadowMapSize":!0},t.shaderParamFactory={vec2:{typeName:"Vector2",create:function(){return new $},apply:function(t,e,n){return!!e.uniformLocation&&("Vector2"===n.constructor.name?t.uniform2f(e.uniformLocation,n.x,n.y):t.uniform2fv(e.uniformLocation,flattenVectors(n.data)),!0)}},vec3:{typeName:"Vector3",create:function(){return new V},apply:function(t,e,n){return!!e.uniformLocation&&("Vector3"===n.constructor.name?t.uniform3f(e.uniformLocation,n.x,n.y,n.z):t.uniform3fv(e.uniformLocation,flattenVectors(n.data)),!0)}},vec4:{typeName:"Color",create:function(){return new H},apply:function(t,e,n){return!!e.uniformLocation&&("Color"===n.constructor.name?t.uniform4f(e.uniformLocation,n.r,n.g,n.b,n.a):t.uniform4fv(e.uniformLocation,flattenVectors(n.data)),!0)}},mat4:{typeName:"Matrix44",create:function(){return new nt},apply:function(t,e,n){return!!e.uniformLocation&&("Matrix44"===n.constructor.name?t.uniformMatrix4fv(e.uniformLocation,!1,n.data):t.uniformMatrix4fv(e.uniformLocation,!1,flattenMatrices(n.data)),!0)}},mat3:{typeName:"Matrix33",create:function(){return new ot},apply:function(t,e,n){return!!e.uniformLocation&&("Matrix33"===n.constructor.name?t.uniformMatrix3fv(e.uniformLocation,!1,n.data):t.uniformMatrix3fv(e.uniformLocation,!1,flattenMatrices(n.data)),!0)}},sampler2D:{typeName:"Texture",create:function(){return new Yt(wr)},apply:function(t,e,n){if(!e.uniformLocation||void 0===e.textureStage)return!1;var r=n.asset;return r&&r.begin(e.textureStage)?(t.uniform1i(e.uniformLocation,e.textureStage),!0):!!Qr.whiteTexture.begin(e.textureStage)&&(t.uniform1i(e.uniformLocation,e.textureStage),!0)}},sampler1D:{typeName:"Texture",create:function(){return new Yt(wr)},apply:function(t,e,n){if(!e.uniformLocation||void 0===e.textureStage)return!1;var r=n.asset;return r&&r.begin(e.textureStage)?(t.uniform1i(e.uniformLocation,e.textureStage),!0):!!Qr.whiteTexture.begin(e.textureStage)&&(t.uniform1i(e.uniformLocation,e.textureStage),!0)}},samplerCube:{typeName:"StaticCubemap",create:function(){return new Yt(mu)},apply:function(t,e,n){if(!e.uniformLocation)return!1;var r=n.asset;return!(!r||!r.begin(0))&&(t.uniform1i(e.uniformLocation,0),!0)}},float:{typeName:"Number",create:function(){return 0},apply:function(t,e,n){return!!e.uniformLocation&&("number"==typeof n?t.uniform1f(e.uniformLocation,n):t.uniform1fv(e.uniformLocation,n.data),!0)}},int:{typeName:"Number",create:function(){return 0},apply:function(t,e,n){return!!e.uniformLocation&&("number"==typeof n?t.uniform1i(e.uniformLocation,n):t.uniform1iv(e.uniformLocation,n.data),!0)}},bool:{typeName:"Boolean",create:function(){return 0},apply:function(t,e,n){return!!e.uniformLocation&&("boolean"==typeof n?t.uniform1i(e.uniformLocation,n):t.uniform1iv(e.uniformLocation,n.data),!0)}}}}(Eu||(Eu={}));var Au,Iu=function(){function ShaderUtils(){}return ShaderUtils.applyShaderParam=function(t,e,n){return Eu.shaderParamFactory[e.type].apply(t,e,n)},ShaderUtils.buildMaterialParams=function(t,e,n){if(!t)return console.assert(!1),e;for(var r=new _,i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];if(!(a in Eu.engineManagedParams)){var s=t[a].type;if("mat4"!==s){var c=!1;if(a in e){var u=su.getPropertyTypeName(e[a]);if("AssetReference"===u)u=e[a].typeName();c=u===Eu.shaderParamFactory[s].typeName}r[a]=c?e[a]:Eu.shaderParamFactory[s].create()}}}return r},ShaderUtils.editorParamsToFocus="__EditorParamsToFocus__",ShaderUtils}(),Mu=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),zu=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ku=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.attributeTypeToComponentCount={float:1,vec2:2,vec3:3,vec4:4},t.ref=new Yt(L)}(Au||(Au={}));var Du,Fu,Lu=function(t){function Shader(e){var n=t.call(this)||this;return n.codeChanged=new S.AsyncEvent,n._instances={0:{attributes:null,params:null,program:null,vertexShader:null,fragmentShader:null}},n._shaderError=!1,n._executedOnce=!1,e&&n.setState(e),n}return Mu(Shader,t),Object.defineProperty(Shader.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Shader.prototype,"vertexCode",{get:function(){return this._vertexCode},set:function(t){this._vertexCode=t,this.invalidateProgram()},enumerable:!0,configurable:!0}),Object.defineProperty(Shader.prototype,"fragmentCode",{get:function(){return this._fragmentCode},set:function(t){this._fragmentCode=t,this.invalidateProgram()},enumerable:!0,configurable:!0}),Shader.prototype.beginWithParams=function(t){if(!this.begin())return!1;for(var e=0,n=Object.keys(t);e<n.length;e++){var r=n[e];if(!this.applyParameter(r,t[r]))return!1}return!0},Shader.prototype.begin=function(){if(this._executedOnce){if(this._shaderError)return!1}else this._executedOnce=!0;var t=ht.context;if(this._instances[0].program)t.useProgram(this._instances[0].program);else{var e=Bu.doVertexShader(this._vertexCode),n=this.createShader(t.VERTEX_SHADER,e,"vertex");if(!n)return this._shaderError=!0,!1;var r=Bu.doFragmentShader(this._fragmentCode),i=this.createShader(t.FRAGMENT_SHADER,r,"fragment");if(!i)return this._shaderError=!0,!1;if(!this.loadInstance(t,this._instances[0],n,i,e,r))return!1}return!0},Shader.prototype.beginWithVisual=function(t){if(this._executedOnce){if(this._shaderError)return null}else this._executedOnce=!0;var e=t.bucketId,n=this._instances[e];n||(n={program:null,vertexShader:null,fragmentShader:null,attributes:null,params:null},this._instances[e]=n);var r=ht.context;if(n.program)r.useProgram(n.program);else if(!this.setupInstance(n,r,t))return null;return n},Shader.prototype.applyParameter=function(t,e,n){var r=n||0,i=this._instances[r],o=(i?i.params:this._instances[0].params)[t];return!(void 0!==o&&!Iu.applyShaderParam(ht.context,o,e))},Shader.prototype.applyReferenceParameter=function(t,e,n){var r=n||0,i=this._instances[r],o=(i?i.params:this._instances[0].params)[t];if(void 0!==o){var a=Au.ref;if(a.setAssetFast(e),!Iu.applyShaderParam(ht.context,o,a))return!1}return!0},Shader.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n),"_fragmentCode"===e?this._vertexCode&&(this._instances[0].params=this.extractUniforms(this._vertexCode,this._fragmentCode)):"_vertexCode"===e&&this._fragmentCode&&(this._instances[0].params=this.extractUniforms(this._vertexCode,this._fragmentCode))},Shader.prototype.graphicUnload=function(){for(var t=0,e=Object.keys(this._instances);t<e.length;t++){var n=e[t],r=this._instances[n],i=r.program;if(i){var o=ht.context;o.deleteShader(r.vertexShader),o.deleteShader(r.fragmentShader),o.deleteProgram(i),r.vertexShader=null,r.fragmentShader=null,r.program=null,r.params=null,r.attributes=null}}},Shader.prototype.invalidateProgram=function(){this._executedOnce=!1,this._shaderError=!1,this.graphicUnload(),this._vertexCode&&this._fragmentCode&&(this._instances[0].params=this.extractUniforms(this._vertexCode,this._fragmentCode))},Shader.prototype.getAttributes=function(t){return this._instances[t||0].attributes},Shader.prototype.getParams=function(t){return this._instances[t||0].params},Shader.prototype.upgrade=function(t,e){return 1===e&&Object.assign(t.properties,{_vertexCode:{typeName:"String",data:t.properties._vertexCode},_fragmentCode:{typeName:"String",data:t.properties._fragmentCode}}),t},Shader.prototype.loadInstance=function(t,e,n,r,i,o){var a=t.createProgram();if(t.attachShader(a,n),t.attachShader(a,r),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))return k.logError("Shader error in "+this.name+":"),k.logError(t.getProgramInfoLog(a)),this._shaderError=!0,!1;t.useProgram(a),e.params||(e.params=this.extractUniforms(i,o));for(var s=0,c=Object.keys(e.params);s<c.length;s++){var u=c[s],l=t.getUniformLocation(a,u);e.params[u].uniformLocation=l}e.attributes=this.extractAttributes(i);for(var p=0,h=Object.keys(e.attributes);p<h.length;p++){var f=h[p],d=t.getAttribLocation(a,f);e.attributes[f].location=d}return e.vertexShader=n,e.fragmentShader=r,e.program=a,!0},Shader.prototype.createShader=function(t,e,n){var r=ht.context,i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),r.getShaderParameter(i,r.COMPILE_STATUS)?i:(k.log("Shader error in "+this.name+"."+n+":"),k.log(r.getShaderInfoLog(i)),null)},Shader.prototype.setupInstance=function(t,e,n){var r=Bu.doVertexShader(this._vertexCode,n.isSkinned,n.receiveFog,n.receiveShadows,n.hasVertexColor),i=this.createShader(e.VERTEX_SHADER,r,"vertex");if(!i)return this._shaderError=!0,!1;var o=Bu.doFragmentShader(this._fragmentCode,n.receiveFog,n.receiveShadows,n.hasVertexColor),a=this.createShader(e.FRAGMENT_SHADER,o,"fragment");return a?this.loadInstance(e,t,i,a,r,o):(this._shaderError=!0,!1)},Shader.prototype.extractAttributes=function(t){var e={},n=this.removeComments(t).match(/attribute (vec|float|uint|int|bool|mat|sampler|samplerCube)+[1234D]* [_a-zA-Z0-9]+/g);if(n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o.split(" "),s=a[1],c=a[2];if(s&&c){var u=Au.attributeTypeToComponentCount[s];void 0!==u?e[c]={location:-1,componentCount:u}:k.logWarning("Unsupported type: '"+s+"' for shader attribute '"+c+"', ignoring this attribute.")}else k.logWarning("Invalid shader attribute syntax: '"+o+"', ignoring this attribute.")}return e},Shader.prototype.extractUniforms=function(t,e){var n={},r=this.parseUniforms(t,n,0);return this.parseUniforms(e,n,r),n},Shader.prototype.parseUniforms=function(t,e,n){var r=this.removeComments(t).match(/uniform (vec|float|uint|int|bool|mat|sampler|samplerCube)+[234D]* [_a-zA-Z0-9]+/g);if(r)for(var i=0,o=r;i<o.length;i++){var a=o[i],s=a.split(" "),c=s[1],u=s[2];c&&u?e[u]={type:c,uniformLocation:null,textureStage:c.match(/sampler+[234D]*/)?n++:void 0}:k.logWarning("Invalid shader uniform syntax: '"+a+"', ignoring this uniform.")}return n},Shader.prototype.removeComments=function(t){return t.replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")},zu([unserializable(),ku("design:type",Object)],Shader.prototype,"codeChanged",void 0),zu([unserializable(),ku("design:type",Object)],Shader.prototype,"_instances",void 0),zu([Attributes_hidden(),ku("design:type",String)],Shader.prototype,"_vertexCode",void 0),zu([Attributes_hidden(),ku("design:type",String)],Shader.prototype,"_fragmentCode",void 0),zu([unserializable(),ku("design:type",Object)],Shader.prototype,"_shaderError",void 0),zu([unserializable(),ku("design:type",Object)],Shader.prototype,"_executedOnce",void 0),Shader=zu([creatable(!0),referencable(!0),hasDedicatedEditor(!0),ku("design:paramtypes",[Object])],Shader)}(L),Nu=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Vu=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Uu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};(Du||(Du={})).shaderParamsPropertySetter="shaderParams",function(t){t.shaderPropertyKey="_shader",t.shaderParamsPropertyKey="_"+Du.shaderParamsPropertySetter}(Fu||(Fu={}));var Wu,qu=function(t){function Material(e){var n,r=t.call(this)||this;if(r._blending=i.None,r._renderPass=s.Opaque,r._cullMode=a.Back,r._depthTest=!0,r._priority=0,r._shaderParams=new _,r._shader=new Yt(Lu),r.onShaderCodeChanged=r.onShaderCodeChanged.bind(r),r.onShaderChanged=r.onShaderChanged.bind(r),r._shader.assetChanged.attach(r.onShaderChanged),e){if(Du.shaderParamsPropertySetter in e){var o=e[Du.shaderParamsPropertySetter],c=e.shader;c&&(delete e[Du.shaderParamsPropertySetter],delete e.shader,Object.assign(e,((n={shader:c})[Du.shaderParamsPropertySetter]=o,n)))}r.setState(e)}return r}return Nu(Material,t),Object.defineProperty(Material.prototype,"version",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"shader",{get:function(){return this._shader.asset},set:function(t){this._shader.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"blending",{get:function(){return this._blending},set:function(t){this._blending=t},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"renderPass",{get:function(){return this._renderPass},set:function(t){this._renderPass=t},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"cullMode",{get:function(){return this._cullMode},set:function(t){this._cullMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"priority",{get:function(){return this._priority},set:function(t){this._priority=t},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"shaderParams",{get:function(){return this._shaderParams},set:function(t){if(this.shader){var e=this.shader.getParams();Object.keys(t).filter(function(t){return t in e&&("sampler2D"===e[t].type||"sampler1D"===e[t].type)}).forEach(function(e){var n=t[e];console.assert(n),"string"==typeof n?t[e]=new Yt(wr,new Rr({textureData:n})):n.isA&&n.isA(wr)?t[e]=new Yt(wr,n):console.error("Invalid sampler uniform '"+e+"', must be an Url or a Texture object.")}),this._shaderParams=Iu.buildMaterialParams(e,t,!1),this.updateRuntimeAccessors()}else console.error("Cannot set property 'shaderParams' on Material because it has no shader.")},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"depthTest",{get:function(){return this._depthTest},set:function(t){this._depthTest=t},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"buckedId",{get:function(){return""+(1<<this.blending|1<<i.Additive+1<<this.cullMode|1<<i.Additive+1+(a.None+1)<<(this._depthTest?0:1))},enumerable:!0,configurable:!0}),Material.prototype.begin=function(){var t=this.shader;return!(!t||!t.beginWithParams(this.shaderParams))&&(this.uploadState(),!0)},Material.prototype.uploadState=function(){var t=ht.context,e=this.blending;e===i.None?t.disable(t.BLEND):e===i.Linear?(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)):e===i.Additive&&(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE));var n=this.cullMode;n===a.Back?(t.enable(t.CULL_FACE),t.cullFace(t.BACK)):n===a.Front?(t.enable(t.CULL_FACE),t.cullFace(t.FRONT)):t.disable(t.CULL_FACE)},Material.prototype.destroy=function(){this._shader.asset&&this._shader.asset.codeChanged.detach(this.onShaderCodeChanged),this._shader.detach();for(var e=0,n=Object.values(this._shaderParams);e<n.length;e++){var r=n[e];"AssetReference"===r.constructor.name&&r.detach()}t.prototype.destroy.call(this)},Material.prototype.isLoaded=function(){return!!w.isAssetRefLoaded(this._shader)&&w.isObjectLoaded(this._shaderParams)},Material.prototype.queueParameter=function(t,e){this._shaderParams[t]=e},Material.prototype.queueReferenceParameter=function(t,e){var n=this._shaderParams[t];n?n.setAssetFast(e):k.logError("queueReferenceParameter failed")},Material.prototype.getParameter=function(t){return this._shaderParams[t]},Material.prototype.applyParameter=function(t,e){var n=this.shader;n&&(this._shaderParams[t]=e,n.applyParameter(t,e))},Material.prototype.applyReferenceParameter=function(t,e){var n=this.shader;if(n){var r=this._shaderParams[t];r.setAssetFast(e),n.applyParameter(t,r)}},Material.prototype.upgrade=function(t,e){if(1===e)Object.assign(t.properties,{_blending:t.properties.blending,_renderPass:t.properties.renderPass,_cullMode:t.properties.cullMode,_priority:t.properties.priority,_shaderParams:t.properties.shaderParams,_shader:t.properties.shader}),delete t.properties.blending,delete t.properties.renderPass,delete t.properties.cullMode,delete t.properties.priority,delete t.properties.shaderParams,delete t.properties.shader;else if(2===e)for(var n=t.properties._shaderParams,r=0,i=Object.keys(n.properties);r<i.length;r++){var o=i[r],a=n.properties[o];if("TextureReference"===a.typeName){var s=a.data.properties.texture;n.properties[o]={typeName:"AssetReference",data:JSON.parse(JSON.stringify(s))}}}else if(3===e){var c=t.properties._renderPass;"object"==typeof c&&(c=c.value),c>0&&Object.assign(t.properties,{_renderPass:c-1})}return t},Material.prototype.onShaderCodeChanged=function(t){var e=this.shader;e&&(this._shaderParams=Iu.buildMaterialParams(e.getParams(),this._shaderParams,!0),this.updateRuntimeAccessors())},Material.prototype.onShaderChanged=function(t){t.newAsset&&(this._shaderParams=Iu.buildMaterialParams(t.newAsset.getParams(),this._shaderParams,!1),this.updateRuntimeAccessors())},Material.prototype.updateRuntimeAccessors=function(){for(var t=this,e=function(e){var r=n._shaderParams[e];"AssetReference"===r.constructor.name?Object.defineProperty(n,e,{get:function(){return r.asset},set:function(t){r.asset=t},configurable:!0}):Object.defineProperty(n,e,{get:function(){return r},set:function(n){t._shaderParams[e]=n},configurable:!0})},n=this,r=0,i=Object.keys(this._shaderParams);r<i.length;r++){e(i[r])}},Vu([Attributes_enumLiterals(i),Uu("design:type",Object)],Material.prototype,"_blending",void 0),Vu([Attributes_enumLiterals(s),Uu("design:type",Object)],Material.prototype,"_renderPass",void 0),Vu([Attributes_enumLiterals(a),Uu("design:type",Object)],Material.prototype,"_cullMode",void 0),Material}(A),Gu=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Hu=function(t){function StaticMesh(){var e=null!==t&&t.apply(this,arguments)||this;return e.mesh=new Yt(Ra),e}return Gu(StaticMesh,t),StaticMesh.prototype.getVertexBuffer=function(){var t=this.mesh.asset;return t?t.vertexBuffer:null},StaticMesh.prototype.getBoundingBox=function(){var t=this.mesh.asset;return t?t.boundingBox:null},StaticMesh.prototype.destroy=function(){this.mesh.detach(),t.prototype.destroy.call(this)},StaticMesh}(ns),Ku=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Xu=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Qu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Yu=function(t){function Bone(e){var n=t.call(this)||this;return n.worldMatrix=new nt,n.inverseMatrix=new nt,n.fbxId=0,e&&n.setState(e),n}return Ku(Bone,t),Object.defineProperty(Bone.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Bone.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{worldMatrix:t.properties.boneWorldMatrix,inverseMatrix:t.properties.boneInverseMatrix}),delete t.properties.boneWorldMatrix,delete t.properties.boneInverseMatrix),t},Xu([Attributes_hidden(),Qu("design:type",Object)],Bone.prototype,"fbxId",void 0),Bone}(Et),Zu=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Ju=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},$u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},tl=function(t){function MemoryTexture(e,n,r,i,o){var a=t.call(this)||this;return a._isDirty=!0,a._data=e,a._width=n,a._height=r,a._format=i,a._type=o,a.isPersistent=!1,a}return Zu(MemoryTexture,t),MemoryTexture.prototype.getWidth=function(){return this._width},MemoryTexture.prototype.getHeight=function(){return this._height},MemoryTexture.prototype.begin=function(t){var e=ht.context;return this._textureId?(e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),this._isDirty&&(this.updateTexture(),this._isDirty=!1)):(this._textureId=e.createTexture(),e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.updateTexture()),!0},MemoryTexture.prototype.dirtify=function(){this._isDirty=!0},MemoryTexture.prototype.updateTexture=function(){var t=ht.context;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,this._format,this._width,this._height,0,this._format,this._type,this._data)},Ju([unserializable(),$u("design:type",Object)],MemoryTexture.prototype,"_isDirty",void 0),MemoryTexture=Ju([referencable(!1),$u("design:paramtypes",[Float32Array,Number,Number,Number,Number])],MemoryTexture)}(wr),el=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),nl=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},rl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};(Wu||(Wu={})).offsetMatrix=new nt;var il,ol=function(t){function SkinnedMesh(){var e=t.call(this)||this;return e._bindMatrix=new nt,e._bindMatrixInverse=new nt,e._boneFbxIds=new xt(Number),e._skeleton=new Ft(void 0),e}return el(SkinnedMesh,t),Object.defineProperty(SkinnedMesh.prototype,"skeleton",{get:function(){return this._skeleton.entity},set:function(t){this._skeleton.entity=t},enumerable:!0,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"bindMatrix",{get:function(){return this._bindMatrix},set:function(t){this._bindMatrix.copy(t),this._bindMatrixInverse.getInverse(t)},enumerable:!0,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"bindMatrixInverse",{get:function(){return this._bindMatrixInverse},enumerable:!0,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"boneTexture",{get:function(){return this._boneTexture},enumerable:!0,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"boneTextureSize",{get:function(){return this._boneTextureSize},enumerable:!0,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"boneMatrices",{get:function(){return this._boneMatrices},enumerable:!0,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"boneFbxIds",{set:function(t){this._boneFbxIds.data.length=0;for(var e=0,n=t;e<n.length;e++){var r=n[e];this._boneFbxIds.grow(r)}},enumerable:!0,configurable:!0}),SkinnedMesh.prototype.getVertexBuffer=function(){return t.prototype.getVertexBuffer.call(this)},SkinnedMesh.prototype.graphicUpdate=function(t,e,n,r,i){if(!this._skeleton.entity)return Ya.Unchanged;var o=ht.extensions.OES_texture_float;if(!this._boneMatrices){this._bones=[],this._boneInverses=[];for(var a=this._skeleton.entity.getComponents(Yu),s=0,c=function(t){var e=t.valueOf(),n=a.find(function(t){return t.fbxId===e});n?(u._bones[s]=n.entity,u._boneInverses[s]=n.inverseMatrix,++s):k.logWarning("Bone with ID '"+t+"' not found")},u=this,l=0,p=this._boneFbxIds.data;l<p.length;l++){c(p[l])}this._bones.length=s,this._boneInverses.length=s;var h=Math.sqrt(4*this._bones.length);if(h=W.ceilPowerOfTwo(h),h=Math.max(h,4),this._boneMatrices=new Float32Array(h*h*4),o){var f=ht.context;this._boneTexture=new tl(this._boneMatrices,h,h,f.RGBA,f.FLOAT),this._boneTextureSize=h}}return o?(this.updateMatrices(),this._boneTexture.dirtify(),e.applyReferenceParameter("boneTexture",this._boneTexture,n),e.applyParameter("boneTextureSize",this._boneTextureSize,n)):(this.updateMatrices(),e.applyParameter("boneMatrices",this._boneMatrices)),e.applyParameter("bindMatrix",this._bindMatrix,n),e.applyParameter("bindMatrixInverse",this._bindMatrixInverse,n),Ya.Unchanged},SkinnedMesh.prototype.destroy=function(){this._vb&&this._vb.unload(ht.context),t.prototype.destroy.call(this)},SkinnedMesh.prototype.updateMatrices=function(){for(var t=Wu.offsetMatrix,e=0;e<this._bones.length;++e){var n=this._bones[e]?this._bones[e].transform.worldMatrix:nt.identity;t.multiplyMatrices(n,this._boneInverses[e]),t.toArray(this._boneMatrices,16*e)}},SkinnedMesh.skeletonPropertyKey="_skeleton",nl([Attributes_hidden(),rl("design:type",Ft)],SkinnedMesh.prototype,"_skeleton",void 0),nl([Attributes_hidden(),rl("design:type",Object)],SkinnedMesh.prototype,"_boneFbxIds",void 0),nl([unserializable(),rl("design:type",_t)],SkinnedMesh.prototype,"_vb",void 0),nl([unserializable(),rl("design:type",tl)],SkinnedMesh.prototype,"_boneTexture",void 0),nl([unserializable(),rl("design:type",Number)],SkinnedMesh.prototype,"_boneTextureSize",void 0),nl([unserializable(),rl("design:type",Float32Array)],SkinnedMesh.prototype,"_boneMatrices",void 0),nl([unserializable(),rl("design:type",Array)],SkinnedMesh.prototype,"_boneInverses",void 0),nl([unserializable(),rl("design:type",Array)],SkinnedMesh.prototype,"_bones",void 0),SkinnedMesh}(Hu),al=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),sl=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},cl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ul=function(t){function Visual(e){var n=t.call(this)||this;return n.castShadows=!0,n.receiveShadows=!0,n.receiveFog=!0,n._group=new Yt(vs),n._geometry=new l(ns),n._material=new Yt(qu),e&&n.setState(e),n}return al(Visual,t),Object.defineProperty(Visual.prototype,"version",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"material",{get:function(){return this._material.asset},set:function(t){this._material.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"geometry",{get:function(){return this._geometry.instance},set:function(t){this._geometry.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"group",{get:function(){return this._group.asset},set:function(t){this._group.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"vertexBuffer",{get:function(){return this._geometry.instance?this._geometry.instance.getVertexBuffer():null},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"animatedMaterial",{get:function(){return this._uniqueAnimatedMaterialInstance},set:function(t){this._uniqueAnimatedMaterialInstance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"worldTransform",{get:function(){var t=this._geometry.instance;return t?t.getWorldTransform(this.entity.transform):this.entity.transform.worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"bucketId",{get:function(){var t=0;return this.receiveShadows&&(t=1),this.receiveFog&&(t|=2),this.isSkinned&&(t|=4),this.hasVertexColor&&(t|=8),""+t},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"isSkinned",{get:function(){return!!this._geometry.instance&&this._geometry.instance.isA(ol)},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"hasVertexColor",{get:function(){var t=this.geometry?this.geometry.getVertexBuffer():void 0;return!!t&&t.hasAttribute("color")},enumerable:!0,configurable:!0}),Visual.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.getOrSetComponent(zt)},Visual.prototype.graphicUpdate=function(t,e,n){var r=this._geometry.instance;return r?r.graphicUpdate(t,e,this.bucketId,this.entity.transform,n):Ya.Unchanged},Visual.prototype.destroy=function(){var e=this._geometry.instance;e&&e.destroy(),this._uniqueAnimatedMaterialInstance&&this._uniqueAnimatedMaterialInstance.destroy(),this._material.detach(),this._group.detach(),t.prototype.destroy.call(this)},Visual.prototype.upgrade=function(t,e){if(1===e){Object.assign(t.properties,{_group:t.properties.group,_material:t.properties.material});var n=t.properties.geometry.data;n&&"Particles"!==n.typeName&&Object.assign(t.properties,{_geometry:t.properties.geometry}),delete t.properties.group,delete t.properties.material,delete t.properties.geometry}else if(2===e){(r=t.properties._geometry.data)&&"SkyBox"===r.typeName&&delete t.properties._geometry.data}else if(3===e){var r;(r=t.properties._geometry.data)&&"Quad"===r.typeName&&(r.typeName="QuadGeometry")}return t},sl([unserializable(),Attributes_hidden(),cl("design:type",qu)],Visual.prototype,"_uniqueAnimatedMaterialInstance",void 0),Visual=sl([helpUrl("https://docs.spiderengine.io/3d/visual.html"),cl("design:paramtypes",[Object])],Visual)}(Et),ll=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),pl=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},hl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},fl=function(t){function RenderTarget(e,n,r,i,a){var s=t.call(this)||this;return s.sizeChanged=new S.VoidAsyncEvent,s._filtering=o.Linear,s._loadError=!1,s._width=e||new Gt,s._height=n||new Gt,s._rgba=void 0!==r&&r,s.isPersistent=void 0===i||i,void 0!==a&&(s._filtering=a),s}return ll(RenderTarget,t),Object.defineProperty(RenderTarget.prototype,"width",{set:function(t){t.equals(this._width)||(this._width=t,this._frameBuffer&&this.resize(ht.context),this.sizeChanged.post())},enumerable:!0,configurable:!0}),Object.defineProperty(RenderTarget.prototype,"height",{set:function(t){t.equals(this._height)||(this._height=t,this._frameBuffer&&this.resize(ht.context),this.sizeChanged.post())},enumerable:!0,configurable:!0}),Object.defineProperty(RenderTarget.prototype,"isValid",{get:function(){return this._frameBuffer},enumerable:!0,configurable:!0}),RenderTarget.prototype.getWidth=function(){return this._actualWidth},RenderTarget.prototype.getHeight=function(){return this._actualHeight},RenderTarget.prototype.bind=function(t){if(!this._frameBuffer){if(this._loadError)return!1;if(!this.graphicLoad())return!1}return t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.viewport(0,0,this._actualWidth,this._actualHeight),t.depthMask(!0),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),!0},RenderTarget.prototype.begin=function(t){if(!this._textureId)return!1;if(gt.renderer.renderTarget===this)return!1;var e=ht.context;return e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),!0},RenderTarget.prototype.graphicLoad=function(){if(this._frameBuffer)return!0;var t=ht.context;return this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),this._textureId=t.createTexture(),this._depthBuffer=t.createRenderbuffer(),this.resize(t),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._textureId,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this._depthBuffer),t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE||(k.logError("Could not create render target"),this._loadError=!0,!1)},RenderTarget.prototype.graphicUnload=function(){if(t.prototype.graphicUnload.call(this),this._frameBuffer){var e=ht.context;e.deleteFramebuffer(this._frameBuffer),e.deleteRenderbuffer(this._depthBuffer),this._frameBuffer=null,this._depthBuffer=null}},RenderTarget.prototype.resize=function(t){this._actualWidth=this._width.value,this._width.type===kt.Relative&&(this._actualWidth=gt.renderer.screenSize.x*this._actualWidth),this._actualHeight=this._height.value,this._height.type===kt.Relative&&(this._actualHeight=gt.renderer.screenSize.y*this._actualHeight),t.bindTexture(t.TEXTURE_2D,this._textureId),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._rgba?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._actualWidth,this._actualHeight,0,t.RGBA,t.UNSIGNED_BYTE,null):t.texImage2D(t.TEXTURE_2D,0,t.RGB,this._actualWidth,this._actualHeight,0,t.RGB,t.UNSIGNED_BYTE,null),this._filtering===o.Nearest?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)),t.bindRenderbuffer(t.RENDERBUFFER,this._depthBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this._actualWidth,this._actualHeight),t.bindRenderbuffer(t.RENDERBUFFER,null)},pl([unserializable(),hl("design:type",Object)],RenderTarget.prototype,"sizeChanged",void 0),pl([Attributes_enumLiterals(o),hl("design:type",Object)],RenderTarget.prototype,"_filtering",void 0),pl([unserializable(),hl("design:type",Object)],RenderTarget.prototype,"_frameBuffer",void 0),pl([unserializable(),hl("design:type",Object)],RenderTarget.prototype,"_depthBuffer",void 0),pl([unserializable(),hl("design:type",Object)],RenderTarget.prototype,"_loadError",void 0),pl([unserializable(),hl("design:type",Number)],RenderTarget.prototype,"_actualWidth",void 0),pl([unserializable(),hl("design:type",Number)],RenderTarget.prototype,"_actualHeight",void 0),RenderTarget=pl([creatable(!0),referencable(!0),displayName("Render Target"),hl("design:paramtypes",[Gt,Gt,Boolean,Boolean,Number])],RenderTarget)}(wr),dl=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),yl=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ml=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},vl=function(t){function PerspectiveProjector(){var e=null!==t&&t.apply(this,arguments)||this;return e._fov=60,e._zNear=.1,e._zFar=1e3,e._projectionMatrix=new nt,e}return dl(PerspectiveProjector,t),Object.defineProperty(PerspectiveProjector.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(PerspectiveProjector.prototype,"fov",{get:function(){return this._fov},set:function(t){this._fov=t,this.changed.post()},enumerable:!0,configurable:!0}),Object.defineProperty(PerspectiveProjector.prototype,"zNear",{get:function(){return this._zNear},set:function(t){this._zNear=t,this.changed.post()},enumerable:!0,configurable:!0}),Object.defineProperty(PerspectiveProjector.prototype,"zFar",{get:function(){return this._zFar},set:function(t){this._zFar=t,this.changed.post()},enumerable:!0,configurable:!0}),PerspectiveProjector.prototype.getProjectionMatrix=function(){return this._projectionMatrix},PerspectiveProjector.prototype.updateFrustum=function(t,e){var n=W.toRadians(this._fov);this._projectionMatrix.makePerspectiveProjection(n,e,this._zNear,this._zFar);var r=n/2,i=Math.tan(r)*this.zNear,o=i*e,a=Math.tan(r)*this.zFar,s=a*e;this._frustum.update(o,i,s,a,this.zNear,this.zFar,t)},PerspectiveProjector.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_zNear:t.properties.zNear,_zFar:t.properties.zFar,_fov:t.properties.fov}),delete t.properties.zNear,delete t.properties.zFar,delete t.properties.fov),t},yl([unserializable(),ml("design:type",Object)],PerspectiveProjector.prototype,"_projectionMatrix",void 0),PerspectiveProjector}(Ha),gl=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),_l=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},bl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},wl=function(t){function Bloom(){var e=null!==t&&t.apply(this,arguments)||this;return e.intensity=.2,e}return gl(Bloom,t),Bloom.prototype.render=function(t,e,n){return null},Bloom}(_),xl=function(t){function FastBloom(){var e=null!==t&&t.apply(this,arguments)||this;return e.threshold=.9,e._downSample=8,e}return gl(FastBloom,t),Object.defineProperty(FastBloom.prototype,"downSample",{set:function(t){var e=Math.max(t,1);if(this._buffer1&&e!==this._downSample){var n=this._buffer1.getWidth()*this._downSample/e,r=this._buffer1.getHeight()*this._downSample/e,i=new Gt(kt.Absolute,n),o=new Gt(kt.Absolute,r);this._buffer1.width=i,this._buffer1.height=o,this._buffer2.width=i,this._buffer2.height=o}this._downSample=e},enumerable:!0,configurable:!0}),FastBloom.prototype.render=function(t,e,n){if(!this._buffer1){var r=e.getWidth()/this._downSample,i=e.getHeight()/this._downSample,o=new Gt(kt.Absolute,r),a=new Gt(kt.Absolute,i);this._buffer1=new fl(o,a,!1,!1),this._buffer2=new fl(o,a,!1,!1)}var s=gt.renderer,c=Qr.shaders.fullScreen;if(!c.begin())return null;s.renderTarget=this._buffer1,c.applyReferenceParameter("texture",e),c.applyParameter("threshold",this.threshold),Xr.drawVertexBuffer(t,n,c);var u=Qr.shaders.blur;if(!u.begin())return null;var l=$.fromPool().set(1/this._buffer1.getWidth(),1/this._buffer1.getHeight());return s.renderTarget=this._buffer2,u.applyParameter("horizontal",!0),u.applyReferenceParameter("texture",this._buffer1),u.applyParameter("pixelSize",l),Xr.drawVertexBuffer(t,n,u),s.renderTarget=this._buffer1,u.applyParameter("horizontal",!1),u.applyReferenceParameter("texture",this._buffer2),Xr.drawVertexBuffer(t,n,u),this._buffer1},FastBloom.prototype.destroy=function(){this._buffer1&&this._buffer1.destroy(),this._buffer2&&this._buffer2.destroy()},_l([unserializable(),bl("design:type",fl)],FastBloom.prototype,"_buffer1",void 0),_l([unserializable(),bl("design:type",fl)],FastBloom.prototype,"_buffer2",void 0),FastBloom}(wl),Pl=function(t){function Desaturate(){return null!==t&&t.apply(this,arguments)||this}return gl(Desaturate,t),Desaturate}(_),Ol=function(t){function FastDesaturate(){var e=null!==t&&t.apply(this,arguments)||this;return e.rgbWeights=new V(.3,.59,.11),e}return gl(FastDesaturate,t),FastDesaturate}(Pl),Cl=function(t){function PostEffects(){var e=null!==t&&t.apply(this,arguments)||this;return e._bloom=new l(wl),e}return gl(PostEffects,t),Object.defineProperty(PostEffects.prototype,"bloom",{get:function(){return this._bloom.instance},enumerable:!0,configurable:!0}),PostEffects.prototype.destroy=function(){var t=this.bloom;t&&t.destroy()},PostEffects}(_),Sl=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),jl=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Rl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Tl=function(t){function OrthographicProjector(){var e=null!==t&&t.apply(this,arguments)||this;return e._zNear=.1,e._zFar=1e3,e._size=5,e._projectionMatrix=new nt,e}return Sl(OrthographicProjector,t),Object.defineProperty(OrthographicProjector.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(OrthographicProjector.prototype,"zNear",{get:function(){return this._zNear},set:function(t){this._zNear=t,this.changed.post()},enumerable:!0,configurable:!0}),Object.defineProperty(OrthographicProjector.prototype,"zFar",{get:function(){return this._zFar},set:function(t){this._zFar=t,this.changed.post()},enumerable:!0,configurable:!0}),Object.defineProperty(OrthographicProjector.prototype,"size",{get:function(){return this._size},set:function(t){this._size=t,this.changed.post()},enumerable:!0,configurable:!0}),OrthographicProjector.prototype.getProjectionMatrix=function(){return this._projectionMatrix},OrthographicProjector.prototype.updateFrustum=function(t,e){var n=this._size*e,r=this._size;this._projectionMatrix.makeOrthoProjection(-n,n,r,-r,this._zNear,this._zFar);var i=this._size*e,o=this._size;this._frustum.update(i,o,i,o,this._zNear,this._zFar,t)},OrthographicProjector.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_zNear:t.properties.zNear,_zFar:t.properties.zFar,_size:t.properties.size}),delete t.properties.zNear,delete t.properties.zFar,delete t.properties.size),t},jl([unserializable(),Rl("design:type",Object)],OrthographicProjector.prototype,"_projectionMatrix",void 0),OrthographicProjector}(Ha),El=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();(il||(il={})).emptyArray=new Zt(vs);var Bl,Al,Il=function(t){function VisualFilter(){return null!==t&&t.apply(this,arguments)||this}return El(VisualFilter,t),VisualFilter.prototype.getIncluded=function(){return il.emptyArray},VisualFilter.prototype.getExcluded=function(){return il.emptyArray},VisualFilter.prototype.detach=function(){this.getExcluded().detach(),this.getIncluded().detach()},VisualFilter.prototype.canRender=function(t){var e=Boolean(t);return!(!!e&&this.getExcluded().data.some(function(e){return e.asset===t}))&&(!(this.getIncluded().data.length>0)||e&&this.getIncluded().data.some(function(e){return e.asset===t}))},VisualFilter}(_),Ml=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),zl=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},kl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Environment=0]="Environment",t[t.None=1]="None"}(Bl||(Bl={})),(Al||(Al={})).projectorProperty="_projector";var Dl,Fl=function(t){function Camera(e){var n=t.call(this)||this;return n._projector=new l(Ha),n._clearValue=Bl.Environment,n._priority=0,n._filter=new l(Il),n._renderTarget=new Yt(fl),n._postEffects=new l(Cl),n._viewMatrix=new nt,n._viewMatrixDirty=!0,n._invalidFrustum=!0,e&&n.setState(e),n.onTransformChanged=n.onTransformChanged.bind(n),n.onProjectorChanged=n.onProjectorChanged.bind(n),n.onRenderTargetChanged=n.onRenderTargetChanged.bind(n),n.onRenderTargetSizeChanged=n.onRenderTargetSizeChanged.bind(n),n._renderTarget.assetChanged.attach(n.onRenderTargetChanged),n.projector||(n.projector=new vl),n}return Ml(Camera,t),Object.defineProperty(Camera.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"projector",{get:function(){return this._projector.instance},set:function(t){var e=this._projector.instance;e&&e.changed.detach(this.onProjectorChanged),this._projector.instance=t,t&&(t.changed.attach(this.onProjectorChanged),this.entity&&this.updateFrustum())},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"clearValue",{get:function(){return this._clearValue},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"postEffects",{get:function(){return this._postEffects.instance},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"renderTarget",{get:function(){return this._renderTarget.asset},set:function(t){this._renderTarget.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"priority",{get:function(){return this._priority},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"sceneRenderTarget",{get:function(){if(!this._sceneRenderTarget){var t=$.fromPool().copy(gt.renderer.screenSize),e=this.renderTarget;e&&(t.x=e.getWidth(),t.y=e.getHeight());var n=new Gt(kt.Absolute,t.x),r=new Gt(kt.Absolute,t.y);this._sceneRenderTarget=new fl(n,r,!1,!1)}return this._sceneRenderTarget},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"frustum",{get:function(){var t=this.projector;return t?(this._invalidFrustum&&this.updateFrustum(),t.frustum):null},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"filter",{set:function(t){this._filter.instance=t},enumerable:!0,configurable:!0}),Camera.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.getOrSetComponent(zt).changed.attach(this.onTransformChanged);var n=this.projector;n&&0===n.changed.listenerCount()&&n.changed.attach(this.onProjectorChanged),this.updateFrustum()},Camera.prototype.destroy=function(){this._filter.instance&&this._filter.instance.detach(),this._renderTarget.detach(),this._sceneRenderTarget&&this._sceneRenderTarget.destroy();var e=this.postEffects;e&&e.destroy();var n=this.entity.transform;n&&n.changed.detach(this.onTransformChanged),t.prototype.destroy.call(this)},Camera.prototype.canRenderGroup=function(t){return!this._filter.instance||this._filter.instance.canRender(t)},Camera.prototype.getProjectionMatrix=function(){var t=this.projector;return t?(this._invalidFrustum&&this.updateFrustum(),t.getProjectionMatrix()):nt.identity},Camera.prototype.getViewMatrix=function(){return this._viewMatrixDirty&&(this._viewMatrix.copy(this.entity.transform.worldMatrix),this._viewMatrix.invert(),this._viewMatrixDirty=!0),this._viewMatrix},Camera.prototype.getWorldRay=function(t,e){var n,r,i=this.projector;if(!i)return null;var o=this.renderTarget;if(o&&o.isValid)n=o.getWidth(),r=o.getHeight();else{var a=gt.renderer.screenSize;n=a.x,r=a.y}if(i.isA(vl)){var s=i;return Ae.dummy.setFromPerspectiveView(s.fov*W.degreesToRadians,this.entity.transform.worldMatrix,t,e,n,r)}if(i.isA(Tl)){var c=i;return Ae.dummy.setFromOrthographicView(c.size,this.entity.transform.worldMatrix,t,e,n,r)}return null},Camera.prototype.getViewPosition=function(t,e){var n=nt.fromPool().copy(this.getProjectionMatrix()).multiply(this.getViewMatrix()),r=tt.fromPool().set(t.x,t.y,t.z,1).transform(n);return!(r.w<=0)&&(e.set(r.x/r.w,r.y/r.w,r.z/r.w),!0)},Camera.prototype.getScreenPosition=function(t,e){if(this.getViewPosition(t,e)){var n=gt.renderer.screenSize;return e.x=n.x*(.5*(e.x+1)),e.y=n.y*(.5*(1-e.y)),!0}return!1},Camera.prototype.setupFrame=function(){this._viewMatrixDirty=!0},Camera.prototype.setProperty=function(e,n){e===Al.projectorProperty?this.projector=n.instance:t.prototype.setProperty.call(this,e,n)},Camera.prototype.upgrade=function(t,e){var n;if(1===e){var r={_projector:t.properties.projector,_clearValue:t.properties.clear,_excludedGroups:t.properties.excludedGroups,_includedGroups:t.properties.includedGroups,_renderTarget:t.properties.renderTarget,_priority:t.properties.priority};Object.assign(t.properties,r),delete t.properties.projector,delete t.properties.clear,delete t.properties.excludedGroups,delete t.properties.includedGroups,delete t.properties.renderTarget,delete t.properties.priority}else if(2===e){var i=t.properties._excludedGroups.data.map(function(t){return t.id}).filter(Boolean),o=t.properties._includedGroups.data.map(function(t){return t.id}).filter(Boolean);if(i.length>0||o.length>0){var a="ExclusionVisualFilter",s=i,c="_excluded";0===i.length&&(a="InclusionVisualFilter",s=o,c="_included"),Object.assign(t.properties,{_filter:{baseTypeName:"VisualFilter",data:{typeName:a,version:1,properties:(n={},n[c]={typeName:"VisualGroup",data:s.map(function(t){return{typeName:"VisualGroup",id:t}})},n)}}})}delete t.properties._excludedGroups,delete t.properties._includedGroups}return t},Camera.prototype.invalidateFrustum=function(){this._invalidFrustum=!0},Camera.prototype.updateFrustum=function(){var t=this.projector;if(t)if(this._invalidFrustum=!0,this._renderTarget.id){var e=this.renderTarget;if(e&&e.isValid){var n=e.getWidth()/e.getHeight();t.updateFrustum(this.entity.transform,n),this._invalidFrustum=!1}}else{var r=gt.renderer.screenSize;n=r.x/r.y;t.updateFrustum(this.entity.transform,n),this._invalidFrustum=!1}},Camera.prototype.onRenderTargetChanged=function(t){t.oldAsset&&t.oldAsset.sizeChanged.detach(this.onRenderTargetSizeChanged),t.newAsset&&t.newAsset.sizeChanged.attach(this.onRenderTargetSizeChanged),this.invalidateFrustum()},Camera.prototype.onTransformChanged=function(){this.invalidateFrustum()},Camera.prototype.onProjectorChanged=function(){this.invalidateFrustum()},Camera.prototype.onRenderTargetSizeChanged=function(){this.invalidateFrustum()},zl([Attributes_enumLiterals(Bl),kl("design:type",Object)],Camera.prototype,"_clearValue",void 0),zl([unserializable(),kl("design:type",fl)],Camera.prototype,"_sceneRenderTarget",void 0),zl([unserializable(),kl("design:type",Object)],Camera.prototype,"_viewMatrix",void 0),zl([unserializable(),kl("design:type",Object)],Camera.prototype,"_viewMatrixDirty",void 0),zl([unserializable(),kl("design:type",Object)],Camera.prototype,"_invalidFrustum",void 0),Camera=zl([helpUrl("https://docs.spiderengine.io/3d/camera.html"),kl("design:paramtypes",[Object])],Camera)}(Et),Ll=function(){function MapPool(t){this._size=0,this._initialCapacity=t,this._capacity=t,this._maps=[],this._maps.length=t;for(var e=0;e<t;++e)this._maps[e]=new Map}return MapPool.prototype.flush=function(){for(var t=0;t<this._size;++t)this._maps[t].clear();this._size=0},MapPool.prototype.get=function(){return this._size===this._capacity&&this.grow(),this._maps[this._size++]},MapPool.prototype.shrink=function(){this._capacity=this._initialCapacity,this._maps.length=this._capacity,this._size=Math.min(this._size,this._capacity)},MapPool.prototype.grow=function(){k.log("MapPool capacity reached, doubling the pool. Consider allocation a bigger pool.");var t=2*this._capacity;this._maps.length=t;for(var e=this._capacity;e<t;++e)this._maps[e]=new Map;this._capacity=t},MapPool}(),Nl=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Vl=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Ul=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Wl=function(t){function LightType(){return null!==t&&t.apply(this,arguments)||this}return Nl(LightType,t),LightType}(_),ql=function(t){function DirectionalLight(){return null!==t&&t.apply(this,arguments)||this}return Nl(DirectionalLight,t),DirectionalLight}(Wl),Gl=function(t){function PointLight(){var e=null!==t&&t.apply(this,arguments)||this;return e.radius=10,e}return Nl(PointLight,t),PointLight}(Wl);(Dl||(Dl={})).projectorProperty="_projector";var Hl,Kl=function(t){function Light(e){var n=t.call(this)||this;return n.intensity=1,n.color=new H(1,1,1,1),n.castShadows=!0,n.shadowBias=1e-6,n.shadowRadius=4,n.shadowMapSize=c._2048,n.viewMatrix=new nt,n._type=new l(Wl),n._projector=new l(Ha),n.onTransformChanged=n.onTransformChanged.bind(n),n.onProjectorChanged=n.onProjectorChanged.bind(n),e&&n.setState(e),n._type.instance||(n._type.instance=new ql),n._projector.instance||(n._projector.instance=new Tl),n}return Nl(Light,t),Object.defineProperty(Light.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Light.prototype,"projector",{get:function(){return this._projector.instance},set:function(t){var e=this._projector.instance;e&&e.changed.detach(this.onProjectorChanged),this._projector.instance=t,t&&(t.changed.attach(this.onProjectorChanged),this.entity&&this.updateFrustum())},enumerable:!0,configurable:!0}),Object.defineProperty(Light.prototype,"type",{set:function(t){this._type.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Light.prototype,"frustum",{get:function(){return this._projector.instance?this._projector.instance.frustum:null},enumerable:!0,configurable:!0}),Light.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.getOrSetComponent(zt),this.entity.transform.changed.attach(this.onTransformChanged);var n=this.projector;n&&0===n.changed.listenerCount()&&n.changed.attach(this.onProjectorChanged),this.updateFrustum()},Light.prototype.setProperty=function(e,n){e===Dl.projectorProperty?this.projector=n.instance:t.prototype.setProperty.call(this,e,n)},Light.prototype.destroy=function(){var e=this.entity.transform;e&&e.changed.detach(this.onTransformChanged),t.prototype.destroy.call(this)},Light.prototype.getProjectionMatrix=function(){var t=this._projector.instance;return t?t.getProjectionMatrix():nt.identity},Light.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_type:t.properties.type}),delete t.properties.type),t},Light.prototype.updateFrustum=function(){var t=this._projector.instance;t&&t.updateFrustum(this.entity.transform,1)},Light.prototype.onTransformChanged=function(){this.updateFrustum()},Light.prototype.onProjectorChanged=function(){this.updateFrustum()},Vl([Attributes_hidden(),Ul("design:type",Object)],Light.prototype,"shadowBias",void 0),Vl([Attributes_enumLiterals(c,function(t){return t.substring(1)}),Ul("design:type",Object)],Light.prototype,"shadowMapSize",void 0),Vl([unserializable(),Ul("design:type",Object)],Light.prototype,"viewMatrix",void 0),Light}(Et);!function(t){function makeLightViewMatrix(t,e){var n=nt.fromPool();return n.copy(e.entity.transform.worldMatrix),n.invert(),n}t.initialShadowCastersPoolSize=128,t.numRenderPasses=s.Transparent+1,t.initialCameraPoolSize=8,t.initialMaterialPoolSize=128,t.maxLights=1,t.defaultShadowMapSize=new $(2048,2048),t.defaultPerspectiveCamera=null,t.screenSize=new $,t.dummyMatrix=new nt,t.normalMatrix=new ot,t.uiProjectionMatrix=new nt,t.cameraToRenderPassMap=new Map,t.renderPassToDefinitionMapPool=new Ll(t.initialCameraPoolSize),t.renderStateBucketMapPool=new Ll(3*t.numRenderPasses),t.shaderToVisualBucketsMapPool=new Ll(16),t.visualBucketsMapPool=new Ll(16),t.vertexBufferToVisualsMapPool=new Ll(16),t.currentRenderTarget=null,t.showWireFrame=!1,t.lights=[],t.shadowCasters=new Map,t.shadowMaps=[],t.skinnedRenderDepthBonesTexture=new Yt(wr),t.doRenderPass=function doRenderPass(e,n,r){if(0!==e.renderStateBucketMap.size){var i=t.lights.length>0,o=pu.list()[0].fog;e.begin(n);for(var a=function(a){var s=e.renderStateBucketMap.get(a);s.reference.uploadState(),s.reference.depthTest?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST);var c=e.makeViewMatrix(r.getViewMatrix());s.shaderToVisualBucketsMap.forEach(function(a,s){a.forEach(function(a,u){var l=s.beginWithVisual(a.reference);if(l){if(s.applyParameter("projectionMatrix",r.getProjectionMatrix(),u),s.applyParameter("viewMatrix",c,u),i){var p=t.lights[0];if(a.reference.receiveShadows){var h=t.dummyMatrix.multiplyMatrices(p.getProjectionMatrix(),p.viewMatrix);s.applyParameter("lightMatrix",h,u),s.applyReferenceParameter("shadowMap",t.shadowMaps[0],u)}var f=V.fromPool().copy(p.entity.transform.worldForward);f.transformDirection(c),s.applyParameter("directionalLight.direction",f,u),s.applyParameter("directionalLight.color",p.color,u),s.applyParameter("directionalLight.shadow",p.castShadows,u),s.applyParameter("directionalLight.shadowBias",p.shadowBias,u),s.applyParameter("directionalLight.shadowRadius",p.shadowRadius,u),s.applyParameter("directionalLight.shadowMapSize",t.defaultShadowMapSize,u)}if(a.reference.receiveFog&&o)if(s.applyParameter("fogColor",o.color,u),o.isA(Q))s.applyParameter("fogDensity",o.density,u);else{var d=o;s.applyParameter("fogNear",d.near,u),s.applyParameter("fogFar",d.far,u)}var y=l.attributes;a.vertexBufferToVisualsMap.forEach(function(i,o){o.bindBuffers(n),o.bindAttributes(n,y);for(var a=0,l=i;a<l.length;a++){var p=l[a];p.graphicUpdate(r,s,J.deltaTime)===Ya.Changed&&o.updateBufferDatas(n);var h=e.makeWorldMatrix(p.worldTransform),f=p.isSkinned?c:t.dummyMatrix.multiplyMatrices(c,h);t.normalMatrix.getNormalMatrix(f),s.applyParameter("worldMatrix",h,u),s.applyParameter("modelViewMatrix",f,u),s.applyParameter("normalMatrix",t.normalMatrix,u),s.applyParameter("screenSize",t.screenSize,u),s.applyParameter("time",J.time,u),s.applyParameter("deltaTime",J.deltaTime,u),s.applyParameter("frame",J.currentFrame,u);for(var d=(p.animatedMaterial||p.material).shaderParams,m=0,v=Object.keys(d);m<v.length;m++){var g=v[m];s.applyParameter(g,d[g],u)}o.draw(n)}o.unbindAttributes(n,y)})}})})},s=0,c=Array.from(e.renderStateBucketMap.keys()).sort();s<c.length;s++)a(c[s])}},t.addToRenderMap=function addToRenderMap(e,n){var r=n.vertexBuffer;if(r){var i=n.animatedMaterial||n.material;if(i&&i.shader){var o=t.cameraToRenderPassMap.get(e).get(i.renderPass).renderStateBucketMap,a=i.buckedId,s=o.get(a);s||(s={reference:i,shaderToVisualBucketsMap:t.shaderToVisualBucketsMapPool.get()},o.set(a,s));var c=s.shaderToVisualBucketsMap.get(i.shader);c||(c=t.visualBucketsMapPool.get(),s.shaderToVisualBucketsMap.set(i.shader,c));var u=c.get(n.bucketId);u||(u={reference:n,vertexBufferToVisualsMap:t.vertexBufferToVisualsMapPool.get()},c.set(n.bucketId,u));var l=u.vertexBufferToVisualsMap.get(r);l?l.push(n):u.vertexBufferToVisualsMap.set(r,[n])}}},t.renderShadowMaps=function renderShadowMaps(e){t.shadowMaps.length=t.maxLights;var n=ht.context;n.enable(n.DEPTH_TEST),n.disable(n.BLEND),n.depthMask(!0),n.enable(n.CULL_FACE),n.cullFace(n.FRONT);for(var r=Math.min(t.lights.length,t.shadowMaps.length),i=null,a=function(r){var a=t.shadowMaps[r];if(!a){var s=new Gt(kt.Absolute,t.defaultShadowMapSize.x);a=new fl(s,s,!0,!1,o.Nearest),t.shadowMaps[r]=a}try{dt.instance.renderTarget=a,t.lights[r].viewMatrix.copy(makeLightViewMatrix(e,t.lights[r])),t.shadowCasters.forEach(function(e,o){var a=e[0].isSkinned,s=a?Qr.shaders.skinnedRenderDepth:Qr.shaders.renderDepth;s!==i&&(s.begin(),s.applyParameter("projectionMatrix",t.lights[r].getProjectionMatrix()),a&&s.applyParameter("viewMatrix",t.lights[r].viewMatrix),i=s),o.begin(n,s);for(var c=0,u=e;c<u.length;c++){var l=u[c];if(a){var p=l.geometry;if(!p.boneTexture)continue;s.applyParameter("bindMatrix",p.bindMatrix),s.applyParameter("bindMatrixInverse",p.bindMatrixInverse),ht.extensions.OES_texture_float?(t.skinnedRenderDepthBonesTexture.asset=p.boneTexture,s.applyParameter("boneTexture",t.skinnedRenderDepthBonesTexture),s.applyParameter("boneTextureSize",p.boneTextureSize)):s.applyParameter("boneMatrices",p.boneMatrices)}else{var h=t.dummyMatrix.multiplyMatrices(t.lights[r].viewMatrix,l.worldTransform);s.applyParameter("modelViewMatrix",h)}o.draw(n)}o.end(n,s)})}catch(t){}},s=0;s<r;++s)a(s)},t.setupCameraRenderPassDefinition=function setupCameraRenderPassDefinition(e){var n=t.renderPassToDefinitionMapPool.get();n.set(s.Opaque,{begin:function(t){t.enable(t.DEPTH_TEST),t.depthMask(!0)},makeViewMatrix:function(t){return t},makeWorldMatrix:function(t){return t},renderStateBucketMap:t.renderStateBucketMapPool.get()}),n.set(s.Transparent,{begin:function(t){t.enable(t.DEPTH_TEST),t.depthMask(!1)},makeViewMatrix:function(t){return t},makeWorldMatrix:function(t){return t},renderStateBucketMap:t.renderStateBucketMapPool.get()}),t.cameraToRenderPassMap.set(e,n)},t.makeSkyViewMatrix=function makeSkyViewMatrix(t){var e=nt.fromPool();return e.copy(t.entity.transform.worldMatrix).setPosition(V.zero),e.transpose(),e},t.makeLightViewMatrix=makeLightViewMatrix}(Hl||(Hl={}));var Xl,Ql=function(){function Renderer(){}return Object.defineProperty(Renderer.prototype,"screenSize",{get:function(){return Hl.screenSize},enumerable:!0,configurable:!0}),Object.defineProperty(Renderer.prototype,"defaultPerspectiveCamera",{get:function(){return Hl.defaultPerspectiveCamera},enumerable:!0,configurable:!0}),Object.defineProperty(Renderer.prototype,"renderTarget",{get:function(){return Hl.currentRenderTarget},set:function(t){var e=ht.context;if(t){if(!t.bind(e))throw"RenderTarget not ready for rendering";Hl.currentRenderTarget=t}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.screenSize.x,this.screenSize.y),Hl.currentRenderTarget=null},enumerable:!0,configurable:!0}),Object.defineProperty(Renderer.prototype,"showWireFrame",{get:function(){return Hl.showWireFrame},set:function(t){t!==Hl.showWireFrame&&(R.instance.forEach(function(t){t.isA(Lu)&&t.invalidateProgram()}),Hl.showWireFrame=t)},enumerable:!0,configurable:!0}),Renderer}(),Yl=function(){function RendererInternal(){}return RendererInternal.processCanvasDimensions=function(t){var e=t.clientWidth,n=t.clientHeight;0!==e&&0!==n&&(Hl.screenSize.set(e,n),Hl.uiProjectionMatrix.makeOrthoProjection(0,t.clientWidth,0,t.clientHeight,-100,100),t.width=t.clientWidth,t.height=t.clientHeight)},RendererInternal.create=function(t){dt.instance=new Ql,RendererInternal.processCanvasDimensions(t)},RendererInternal.render=function(t,e,n,r,i){Hl.renderPassToDefinitionMapPool.flush(),Hl.renderStateBucketMapPool.flush(),Hl.shaderToVisualBucketsMapPool.flush(),Hl.visualBucketsMapPool.flush(),Hl.vertexBufferToVisualsMapPool.flush(),Hl.cameraToRenderPassMap.clear();for(var o=0,a=e;o<a.length;o++){var c=a[o];Hl.setupCameraRenderPassDefinition(c)}Hl.defaultPerspectiveCamera=null,Hl.shadowCasters.clear();for(var u=0,l=xa.ofType(ul);u<l.length;u++){var p=l[u];if(p.vertexBuffer){for(var h=0,f=e;h<f.length;h++){(c=f[h]).canRenderGroup(p.group)&&Hl.addToRenderMap(c,p)}if(p.castShadows){var d=p.vertexBuffer,y=Hl.shadowCasters.get(d);y?y.push(p):Hl.shadowCasters.set(d,[p])}}}var m=ht.context;Hl.lights=xa.ofType(Kl),Hl.cameraToRenderPassMap.size>0?Hl.cameraToRenderPassMap.forEach(function(e,i){Hl.renderShadowMaps(i),i.setupFrame();var o=i.postEffects,a=o?o.bloom:void 0;if(dt.instance.renderTarget=a?i.sceneRenderTarget:i.renderTarget,!Hl.defaultPerspectiveCamera){var c=i.projector;c&&c.isA(vl)&&(Hl.defaultPerspectiveCamera=i)}if(i.clearValue===Bl.Environment&&t)if(t.isA(wu)){var u=t.color;m.clearColor(u.r,u.g,u.b,u.a),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT)}else if(t.isA(xu)){var l=t;m.enable(m.DEPTH_TEST),m.depthMask(!1),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT),(p=Qr.materials.sky).queueParameter("projectionMatrix",i.getProjectionMatrix()),p.queueParameter("modelViewMatrix",Hl.makeSkyViewMatrix(i)),p.queueParameter("sunPosition",l.sunPosition),p.queueParameter("rayleigh",l.rayleigh),p.queueParameter("turbidity",l.turbidity),p.queueParameter("mieCoefficient",l.mieCoefficient),p.queueParameter("luminance",l.luminance),p.queueParameter("mieDirectionalG",l.mieDirectionalG),p.begin()&&Xr.drawVertexBuffer(m,Qr.primitives.sphere.vertexBuffer,p.shader)}else if(t.isA(Pu)){var p;if((p=t).cubeMap){m.enable(m.DEPTH_TEST),m.depthMask(!1),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT);var h=Qr.materials.cubeMap;if(h.queueParameter("projectionMatrix",i.getProjectionMatrix()),h.queueParameter("modelViewMatrix",Hl.makeSkyViewMatrix(i)),h.queueReferenceParameter("cubemap",p.cubeMap),h.begin()){var f=ti.skyBox;Xr.drawVertexBuffer(m,f,h.shader)}}}if(n&&n(i),Hl.doRenderPass(e.get(s.Opaque),m,i),Hl.doRenderPass(e.get(s.Transparent),m,i),r&&r(i),a){var d=ti.centeredQuad,y=a.render(m,i.sceneRenderTarget,d),v=Qr.shaders.compose;v.begin()&&(dt.instance.renderTarget=i.renderTarget,v.applyReferenceParameter("scene",i.sceneRenderTarget),v.applyReferenceParameter("postFX",y),v.applyParameter("postFxIntensity",a.intensity),Xr.drawVertexBuffer(m,d,v))}}):(dt.instance.renderTarget=null,n&&e.length>0&&n(e[0]),r&&e.length>0&&r(e[0])),dt.instance.renderTarget=null,m.disable(m.DEPTH_TEST),Qr.materials.ui.queueParameter("projectionMatrix",Hl.uiProjectionMatrix);for(var v=0,g=xa.ofType(dc);v<g.length;v++){var _=g[v];_.updateTransforms(),_.render(Qr.materials.ui)}i&&i()},RendererInternal.clearDefaultPerspectiveCamera=function(){Hl.defaultPerspectiveCamera=null},Object.defineProperty(RendererInternal,"uiProjectionMatrix",{get:function(){return Hl.uiProjectionMatrix},enumerable:!0,configurable:!0}),RendererInternal}(),Zl=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Jl=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},$l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},tp=function(t){function CenteredQuad(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundingBox=new at(new V(-1,-1,-.1),new V(1,1,.1)),e}return Zl(CenteredQuad,t),CenteredQuad.prototype.getVertexBuffer=function(){return ti.centeredQuad},CenteredQuad.prototype.getBoundingBox=function(){return this._boundingBox},Jl([unserializable(),$l("design:type",Object)],CenteredQuad.prototype,"_boundingBox",void 0),CenteredQuad}(ns),ep=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),np=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},rp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ip=function(t){function Delay(){var e=t.call(this)||this;return e._remainingTime=0,e.createPin("_delay",ae.Input,Fe),e}return ep(Delay,t),Delay.prototype.onStart=function(){return this._remainingTime=this._delay.getData(),this._remainingTime>0?$e.Continue:$e.Finish},Delay.prototype.onUpdate=function(){return this._remainingTime-=J.deltaTime,this._remainingTime<0?$e.Finish:$e.Continue},np([unserializable(),rp("design:type",Fe)],Delay.prototype,"_delay",void 0),np([unserializable(),rp("design:type",Object)],Delay.prototype,"_remainingTime",void 0),Delay}(hn),op=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ap=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},sp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},cp=function(t){function ModelElement(){var e=t.call(this)||this;return e.userData={},e.children=new Ot(ModelElement),e.transform=new zt,e}return op(ModelElement,t),Object.defineProperty(ModelElement.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),ModelElement.prototype.addChild=function(t){this.children.grow(t),t._parent=this},ModelElement.prototype.traverse=function(t){t(this);for(var e=0,n=this.children.data.map(function(t){return t.instance});e<n.length;e++){var r=n[e];r&&r.traverse(t)}},ap([unserializable(),sp("design:type",Object)],ModelElement.prototype,"userData",void 0),ap([Attributes_hidden(),sp("design:type",Object)],ModelElement.prototype,"children",void 0),ap([Attributes_hidden(),sp("design:type",Number)],ModelElement.prototype,"fbxNodeId",void 0),ap([unserializable(),sp("design:type",ModelElement)],ModelElement.prototype,"_parent",void 0),ModelElement}(C),up=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),lp=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},pp=function(t){function Model(){var e=null!==t&&t.apply(this,arguments)||this;return e.fbxScaleFactor=1,e.elements=new Ot(cp),e._animations=new Zt(Yi),e}return up(Model,t),Object.defineProperty(Model.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Model.prototype,"animations",{get:function(){return this._animations.data.map(function(t){return t.asset})},enumerable:!0,configurable:!0}),Object.defineProperty(Model.prototype,"animationRefs",{get:function(){return this._animations},enumerable:!0,configurable:!0}),Model.prototype.clearAnimations=function(){this._animations.data.length=0},Model.prototype.addAnimation=function(t){this._animations.grow(t)},Model.prototype.destroy=function(){for(var e=0,n=this.elements.data;e<n.length;e++){var r=n[e];r.instance&&r.instance.destroy()}t.prototype.destroy.call(this)},Model.prototype.traverse=function(t){for(var e=0,n=this.elements.data.map(function(t){return t.instance});e<n.length;e++){var r=n[e];r&&r.traverse(t)}},Model.prototype.upgrade=function(t,e){if(1===e){for(var n={typeName:"ModelElement",data:[]},r=0,i=t.properties.meshes.data;r<i.length;r++){var o=i[r],a={baseTypeName:"ModelElement",data:{typeName:t.properties.meshes.typeName}};Object.assign(a.data,o),n.data.push(a)}Object.assign(t.properties,{elements:n}),delete t.properties.meshes}return t},Model=lp([creatable(!1)],Model)}(A),hp=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),fp=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},dp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},yp=function(t){function AnimationTrack(){var e=null!==t&&t.apply(this,arguments)||this;return e.tokenCache={},e}return hp(AnimationTrack,t),AnimationTrack.prototype.getKeys=function(){return[]},AnimationTrack.prototype.getSample=function(t,e){var n=this.getKeys();if(0!==n.length){var r=n.filter(function(e){return e.time>t});if(r.length===n.length)return r[0].getValue();var i=n.filter(function(e){return e.time<=t});console.assert(i.length>0);var o=i[i.length-1];if(i.length===n.length)return o.getValue();console.assert(r.length>0);var a=r[0],s=(t-o.time)/(a.time-o.time);return o.lerp(o,a,s,e)}},AnimationTrack.prototype.isLoaded=function(){return!0},AnimationTrack.prototype.createKey=function(t,e,n){},AnimationTrack.prototype.removeKey=function(t){},AnimationTrack.prototype.sortByTime=function(t){void 0===t&&(t=!0)},fp([unserializable(),dp("design:type",Object)],AnimationTrack.prototype,"tokenCache",void 0),AnimationTrack}(_),mp=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();!function(t){t.find=function find(t,e){return t.find(function(t){return t.time===e})}}(Xl||(Xl={}));var vp,gp=function(t){function AnimationKey(){return null!==t&&t.apply(this,arguments)||this}return mp(AnimationKey,t),AnimationKey.prototype.lerp=function(t,e,n,r){},AnimationKey.prototype.getValue=function(){},AnimationKey.prototype.setValue=function(t){},AnimationKey}(_),_p=function(t){function TAnimationKey(){return null!==t&&t.apply(this,arguments)||this}return mp(TAnimationKey,t),TAnimationKey.prototype.getValue=function(){return this.value},TAnimationKey.prototype.setValue=function(t){this.value=t},TAnimationKey}(gp),bp=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),wp=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},xp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Pp=function(t){function TouchInput(){var e=t.call(this)||this;return e.createPin("_x",ae.Output,Fe),e.createPin("_y",ae.Output,Fe),e.createPin("_wheelDelta",ae.Output,Fe),e.createPin("_button",ae.Output,Fe),e.createPin("_isPressed",ae.Output,Ne),e.createPin("_pressed",ae.Output,me),e.createPin("_released",ae.Output,me),e.createPin("_moved",ae.Output,me),e.createPin("_wheel",ae.Output,me),e.createPin("_swipe",ae.Output,me),e.createPin("_swipeVelocity",ae.Output,Ve),e}return bp(TouchInput,t),TouchInput.prototype.onBehaviorStarted=function(){this.onTouchPressed=this.onTouchPressed.bind(this),this.onTouchMoved=this.onTouchMoved.bind(this),this.onTouchReleased=this.onTouchReleased.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),Js.touchPressed.attach(this.onTouchPressed),Js.touchMoved.attach(this.onTouchMoved),Js.touchReleased.attach(this.onTouchReleased),Js.wheelMoved.attach(this.onMouseWheel),this._x.setData(Js.touchX),this._y.setData(Js.touchY)},TouchInput.prototype.destroy=function(){Js.touchPressed.detach(this.onTouchPressed),Js.touchMoved.detach(this.onTouchMoved),Js.touchReleased.detach(this.onTouchReleased),Js.wheelMoved.detach(this.onMouseWheel),t.prototype.destroy.call(this)},TouchInput.prototype.onTouchPressed=function(t){this._x.setData(t.x),this._y.setData(t.y),this._button.setData(t.button),this._isPressed.setData(t.pressed),this.sendSignal(this._pressed.name)},TouchInput.prototype.onTouchMoved=function(t){this._x.setData(t.x),this._y.setData(t.y),this.sendSignal(this._moved.name)},TouchInput.prototype.onTouchReleased=function(t){this._x.setData(t.x),this._y.setData(t.y),this._button.setData(t.button),this._isPressed.setData(t.pressed),t.swipe&&(this._swipeVelocity.value.copy(t.swipeVelocity),this.sendSignal(this._swipe.name)),this.sendSignal(this._released.name)},TouchInput.prototype.onMouseWheel=function(t){this._wheelDelta.setData(t),this.sendSignal(this._wheel.name)},wp([unserializable(),xp("design:type",Fe)],TouchInput.prototype,"_x",void 0),wp([unserializable(),xp("design:type",Fe)],TouchInput.prototype,"_y",void 0),wp([unserializable(),xp("design:type",Fe)],TouchInput.prototype,"_wheelDelta",void 0),wp([unserializable(),xp("design:type",Fe)],TouchInput.prototype,"_button",void 0),wp([unserializable(),xp("design:type",Ne)],TouchInput.prototype,"_isPressed",void 0),wp([unserializable(),xp("design:type",me)],TouchInput.prototype,"_pressed",void 0),wp([unserializable(),xp("design:type",me)],TouchInput.prototype,"_released",void 0),wp([unserializable(),xp("design:type",me)],TouchInput.prototype,"_moved",void 0),wp([unserializable(),xp("design:type",me)],TouchInput.prototype,"_wheel",void 0),wp([unserializable(),xp("design:type",me)],TouchInput.prototype,"_swipe",void 0),wp([unserializable(),xp("design:type",Ve)],TouchInput.prototype,"_swipeVelocity",void 0),TouchInput=wp([displayName("Touch Input"),xp("design:paramtypes",[])],TouchInput)}(sn),Op=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Cp=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Sp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},jp=function(t){function KeyInput(){var e=t.call(this)||this;return e.createPin("_keyCode",ae.Output,Fe),e.createPin("_keyDown",ae.Output,me),e.createPin("_keyUp",ae.Output,me),e}return Op(KeyInput,t),KeyInput.prototype.onBehaviorStarted=function(){this.onKeyChanged=this.onKeyChanged.bind(this),Js.keyChanged.attach(this.onKeyChanged)},KeyInput.prototype.destroy=function(){Js.keyChanged.detach(this.onKeyChanged),t.prototype.destroy.call(this)},KeyInput.prototype.onKeyChanged=function(t){this._keyCode.setData(t.keyCode),t.pressed?this.sendSignal(this._keyDown.name):this.sendSignal(this._keyUp.name)},Cp([unserializable(),Sp("design:type",Fe)],KeyInput.prototype,"_keyCode",void 0),Cp([unserializable(),Sp("design:type",me)],KeyInput.prototype,"_keyDown",void 0),Cp([unserializable(),Sp("design:type",me)],KeyInput.prototype,"_keyUp",void 0),KeyInput=Cp([displayName("Key Input"),Sp("design:paramtypes",[])],KeyInput)}(sn),Rp=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Tp=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Ep=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Bp=function(t){function SphereVolume(e){var n=t.call(this)||this;return n.center=new V,n.radius=1,e&&n.setState(e),n}return Rp(SphereVolume,t),SphereVolume.prototype.emitPoint=function(t){return W.sphericalToCartesian(this.radius*Math.random(),W.PI2*Math.random(),Math.PI*Math.random(),t)},SphereVolume.prototype.getCenter=function(t){return t.copy(this.center)},SphereVolume=Tp([displayName("Sphere"),Ep("design:paramtypes",[Object])],SphereVolume)}($a),Ap=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Ip=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Mp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},zp=function(t){function Billboard(){var e=null!==t&&t.apply(this,arguments)||this;return e.stretched=!1,e._orientMatrix=new nt,e._toTarget=new V,e}return Ap(Billboard,t),Billboard.prototype.getVertexBuffer=function(){return ti.centeredQuad},Billboard.prototype.getWorldTransform=function(t){return this._orientMatrix},Billboard.prototype.graphicUpdate=function(t,e,n,r,i){return this.stretched?(this._toTarget.copy(r.worldPosition).substract(t.entity.transform.worldPosition),this._orientMatrix.makeLookAt(this._toTarget,t.entity.transform.worldUp).transpose()):this._orientMatrix.makeLookAt(t.entity.transform.worldForward,t.entity.transform.worldUp).transpose(),this._orientMatrix.scale(r.worldScale),this._orientMatrix.setPosition(r.worldPosition),Ya.Unchanged},Ip([unserializable(),Mp("design:type",Object)],Billboard.prototype,"_orientMatrix",void 0),Ip([unserializable(),Mp("design:type",Object)],Billboard.prototype,"_toTarget",void 0),Billboard}(ns),kp=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Dp=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Fp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Lp=function(t){function QuadGeometry(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundingBox=new at(new V(0,0,-.1),new V(1,1,.1)),e}return kp(QuadGeometry,t),QuadGeometry.prototype.getVertexBuffer=function(){return ti.quad},QuadGeometry.prototype.getBoundingBox=function(){return this._boundingBox},Dp([unserializable(),Fp("design:type",Object)],QuadGeometry.prototype,"_boundingBox",void 0),QuadGeometry=Dp([displayName("Quad")],QuadGeometry)}(ns),Np=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Vp=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Up=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Wp=function(t){function Vector2Converter(){var e=t.call(this)||this;return e.createPin("_x",ae.Input,Fe),e.createPin("_y",ae.Input,Fe),e.createPin("_output",ae.Output,Ve),e}return Np(Vector2Converter,t),Vector2Converter.prototype.convert=function(){this._output.getData().set(this._x.getData(),this._y.getData())},Vp([unserializable(),Up("design:type",Fe)],Vector2Converter.prototype,"_x",void 0),Vp([unserializable(),Up("design:type",Fe)],Vector2Converter.prototype,"_y",void 0),Vp([unserializable(),Up("design:type",Ve)],Vector2Converter.prototype,"_output",void 0),Vector2Converter=Vp([displayName("Vector2"),Up("design:paramtypes",[])],Vector2Converter)}(In),qp=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Gp=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Hp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Kp=function(t){function ScreenToRay(){var e=t.call(this)||this;return e.createComponentReferencePin("_camera",ae.Input,Fl),e.createPin("_screenPos",ae.Input,Ve),e.createPin("_ray",ae.Output,Ge),e}return qp(ScreenToRay,t),ScreenToRay.prototype.convert=function(){var t=this._camera.value.component;if(t||(t=gt.renderer.defaultPerspectiveCamera),t){var e=this._screenPos.value,n=t.getWorldRay(e.x,e.y);n&&this._ray.setData(n)}},Gp([unserializable(),Hp("design:type",Ve)],ScreenToRay.prototype,"_screenPos",void 0),Gp([unserializable(),Hp("design:type",Xe)],ScreenToRay.prototype,"_camera",void 0),Gp([unserializable(),Hp("design:type",Ge)],ScreenToRay.prototype,"_ray",void 0),ScreenToRay=Gp([displayName("Screen to Ray"),Hp("design:paramtypes",[])],ScreenToRay)}(In),Xp=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Qp=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Yp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Zp=function(t){function RayCastOnPlane(){var e=t.call(this)||this;return e._plane=new se,e.createPin("_ray",ae.Input,Ge),e.createPin("_planeNormal",ae.Input,Ue),e.createPin("_planeDist",ae.Input,Fe),e.createPin("_intersects",ae.Output,Ne),e.createPin("_intersection",ae.Output,Ue),e}return Xp(RayCastOnPlane,t),RayCastOnPlane.prototype.convert=function(){this._plane.set(this._planeNormal.getData(),this._planeDist.getData());var t=this._ray.getData().castOnPlane(this._plane),e=null!==t.intersection;this._intersects.setData(e),e&&this._intersection.setData(t.intersection)},Qp([unserializable(),Yp("design:type",Ge)],RayCastOnPlane.prototype,"_ray",void 0),Qp([unserializable(),Yp("design:type",Ue)],RayCastOnPlane.prototype,"_planeNormal",void 0),Qp([unserializable(),Yp("design:type",Fe)],RayCastOnPlane.prototype,"_planeDist",void 0),Qp([unserializable(),Yp("design:type",Ne)],RayCastOnPlane.prototype,"_intersects",void 0),Qp([unserializable(),Yp("design:type",Ue)],RayCastOnPlane.prototype,"_intersection",void 0),Qp([unserializable(),Yp("design:type",Object)],RayCastOnPlane.prototype,"_plane",void 0),RayCastOnPlane=Qp([displayName("RayCast on Plane"),Yp("design:paramtypes",[])],RayCastOnPlane)}(In),Jp=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),$p=function(t){function ParticlesCollisionShape(e){var n=t.call(this)||this;return n.tag="Particles",n._particles=new Lt(Rs),e&&n.setState(e),n}return Jp(ParticlesCollisionShape,t),Object.defineProperty(ParticlesCollisionShape.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(ParticlesCollisionShape.prototype,"particlesEntity",{set:function(t){this._particles.component=t.getComponent(Rs)},enumerable:!0,configurable:!0}),Object.defineProperty(ParticlesCollisionShape.prototype,"particles",{get:function(){return this._particles.component},enumerable:!0,configurable:!0}),ParticlesCollisionShape.prototype.getTestPriority=function(){return ia.Particles},ParticlesCollisionShape.prototype.checkCollisions=function(t,e,n,r){var i=this._particles.component;i&&i.checkCollisions(t,n,r)},ParticlesCollisionShape.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_particles:t.properties.particles}),delete t.properties.particles),t},ParticlesCollisionShape}(la),th=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),eh=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},nh=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},rh=function(t){function SpriteGeometry(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=new Yt(Ir),e}return th(SpriteGeometry,t),SpriteGeometry.prototype.getVertexBuffer=function(){return this._vertexBuffer||(this._vertexBuffer=new _t,this._vertexBuffer.isDynamic=!0,this._vertexBuffer.primitiveType="TRIANGLES",this._vertexBuffer.setAttribute("position",[]),this._vertexBuffer.setAttribute("uv",[])),this.sprite.asset&&this.sprite.asset.tesselateInWorldUnits(this._vertexBuffer),this._vertexBuffer},SpriteGeometry.prototype.destroy=function(){this._vertexBuffer&&this._vertexBuffer.unload(ht.context),t.prototype.destroy.call(this)},eh([unserializable(),nh("design:type",_t)],SpriteGeometry.prototype,"_vertexBuffer",void 0),SpriteGeometry=eh([displayName("Sprite")],SpriteGeometry)}(ns),ih=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),oh=function(t){function Data(e){var n=t.call(this)||this;return n._pins=new Ot(ye),n._declaration=new Yt(we),e&&n.setState(e),n.onDeclarationPinChanged=n.onDeclarationPinChanged.bind(n),n.onDeclarationChanged=n.onDeclarationChanged.bind(n),n._declaration.assetChanged.attach(n.onDeclarationChanged),n}return ih(Data,t),Object.defineProperty(Data.prototype,"declaration",{get:function(){return this._declaration.asset},set:function(t){this._declaration.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Data.prototype,"declarationId",{get:function(){return this._declaration.id},enumerable:!0,configurable:!0}),Object.defineProperty(Data.prototype,"pins",{get:function(){return this._pins},enumerable:!0,configurable:!0}),Data.prototype.destroy=function(){this.declaration&&this.declaration.pinChanged.detach(this.onDeclarationPinChanged),this._declaration.detach(),t.prototype.destroy.call(this)},Data.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n),e===Data.pinsPropertyKey&&Qc.updatePinAccessors(this)},Data.prototype.getPins=function(){return this._pins},Data.prototype.setPins=function(t){this._pins=t},Data.prototype.findPinByName=function(t){return this._pins.data.map(function(t){return t.instance}).find(function(e){return e.name===t})},Data.prototype.isLoaded=function(){if(!t.prototype.isLoaded.call(this))return!1;for(var e=0,n=this._pins.data;e<n.length;e++){var r=n[e];if(!Qc.isPinLoaded(r.instance))return!1}return!0},Data.prototype.onDeclarationPinChanged=function(t){Qc.buildPins(this,this.declaration)},Data.prototype.onDeclarationChanged=function(t){var e=t.oldAsset;e&&e.pinChanged.detach(this.onDeclarationPinChanged);var n=t.newAsset;n&&(Qc.buildPins(this,n),n.pinChanged.attach(this.onDeclarationPinChanged))},Data.pinsPropertyKey="_pins",Data}(Et),ah=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),sh=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ch=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},uh=function(t){function DynamicGeometry(e){var n=t.call(this)||this;return e&&n.setState(e),n}return ah(DynamicGeometry,t),Object.defineProperty(DynamicGeometry.prototype,"vertexBuffer",{get:function(){return this._vb},set:function(t){this._vb=t},enumerable:!0,configurable:!0}),DynamicGeometry.prototype.getVertexBuffer=function(){return this._vb},DynamicGeometry.prototype.getBoundingBox=function(){if(!this._boundingBox&&this._vb){var t=this._vb,e=t.attributes,n=t.primitiveType,r=t.indices;this._boundingBox=at.fromVertexArray(e.position,n,r)}return this._boundingBox},sh([unserializable(),ch("design:type",_t)],DynamicGeometry.prototype,"_vb",void 0),sh([unserializable(),ch("design:type",at)],DynamicGeometry.prototype,"_boundingBox",void 0),DynamicGeometry}(ns),lh=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ph=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a};!function(t){t.diffuseKey="diffuse",t.diffuseMapKey="diffuseMap"}(vp||(vp={}));var hh,fh=function(t){function PhongShader(){return null!==t&&t.apply(this,arguments)||this}return lh(PhongShader,t),PhongShader.prototype.loadInstance=function(e,n,r,i,o,a){if(!t.prototype.loadInstance.call(this,e,n,r,i,o,a))return!1;for(var s=n.params,c=n.program,u={"directionalLight.direction":{type:"vec3",uniformLocation:null},"directionalLight.color":{type:"vec4",uniformLocation:null},"directionalLight.shadow":{type:"bool",uniformLocation:null},"directionalLight.shadowBias":{type:"float",uniformLocation:null},"directionalLight.shadowRadius":{type:"float",uniformLocation:null},"directionalLight.shadowMapSize":{type:"vec2",uniformLocation:null}},l=0,p=Object.keys(u);l<p.length;l++){var h=p[l],f=e.getUniformLocation(c,h);u[h].uniformLocation=f,console.assert(null!==f,"getUniformLocation("+h+") failed in shader '"+this.templatePath+"'")}return Object.assign(s,u),!0},PhongShader=ph([displayName("Phong Shader")],PhongShader)}(Lu),dh=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),yh=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},mh=function(t){function GamepadData(){var e=null!==t&&t.apply(this,arguments)||this;return e._data={},e}return dh(GamepadData,t),Object.defineProperty(GamepadData.prototype,"version",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(GamepadData.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.save()},enumerable:!0,configurable:!0}),GamepadData.prototype.serialize=function(){return{typeName:this.constructor.name,version:this.version,id:this.id,name:this.name,data:this._data}},GamepadData.prototype.deserialize=function(t){var e=t;return this.id=e.id,this.name=e.name,this._data=e.data,Promise.resolve(this)},GamepadData=yh([displayName("Gamepad Data")],GamepadData)}(A),vh=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),gh=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},_h=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},bh=function(t){function GamepadRecorder(){var e=t.call(this)||this;return e.createPin("_frameSkip",ae.Input,Fe),e.createPin("_gamePadIndex",ae.Input,Fe),e.createAssetPin("_dataStore",ae.Input,mh),e}return vh(GamepadRecorder,t),GamepadRecorder.prototype.onStart=function(){return this._data={},$e.Continue},GamepadRecorder.prototype.onUpdate=function(){var t=this._frameSkip.value+1,e=J.currentFrame;if(e%t==0){var n=this._gamePadIndex.value,r=Oo.get(n);r&&(this._data[e]={buttons:r.buttons.map(function(t){return t}),axes:JSON.parse(JSON.stringify(r.axes))})}return $e.Continue},GamepadRecorder.prototype.destroy=function(){var t=this._dataStore.value.asset;t&&(t.data=this._data)},gh([unserializable(),_h("design:type",Fe)],GamepadRecorder.prototype,"_frameSkip",void 0),gh([unserializable(),_h("design:type",Fe)],GamepadRecorder.prototype,"_gamePadIndex",void 0),gh([unserializable(),_h("design:type",Je)],GamepadRecorder.prototype,"_dataStore",void 0),gh([unserializable(),_h("design:type",Object)],GamepadRecorder.prototype,"_data",void 0),GamepadRecorder=gh([displayName("Gamepad Recorder"),_h("design:paramtypes",[])],GamepadRecorder)}(hn),wh=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),xh=function(t){function Proxy(){return null!==t&&t.apply(this,arguments)||this}return wh(Proxy,t),Proxy}(Et),Ph=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Oh=function(t){function NumberKey(){return null!==t&&t.apply(this,arguments)||this}return Ph(NumberKey,t),NumberKey.prototype.setValue=function(t){this.value=t},NumberKey.prototype.lerp=function(t,e,n){return W.lerp(t.value,e.value,n)},NumberKey}(_p),Ch=function(t){function BooleanKey(){return null!==t&&t.apply(this,arguments)||this}return Ph(BooleanKey,t),BooleanKey.prototype.lerp=function(t,e,n){return t.value},BooleanKey}(_p),Sh=function(t){function StringKey(){return null!==t&&t.apply(this,arguments)||this}return Ph(StringKey,t),StringKey.prototype.lerp=function(t,e,n){return t.value},StringKey}(_p),jh=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Rh=function(t){function ColorKey(){return null!==t&&t.apply(this,arguments)||this}return jh(ColorKey,t),ColorKey.prototype.lerp=function(t,e,n,r){return H.lerp(t.value,e.value,n,r)},ColorKey.prototype.setValue=function(t){this.value=new H(t.r,t.g,t.b,t.a)},ColorKey}(_p),Th=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Eh=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Bh=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ah=function(t){function AssetKey(){return null!==t&&t.apply(this,arguments)||this}return Th(AssetKey,t),AssetKey.prototype.lerp=function(t,e,n){return t.assetRef?t.assetRef.asset:null},AssetKey.prototype.initializeReference=function(e,n,r){var i=this;if(t.prototype.setValue.call(this,e),this.assetRef||(this.assetRef=g.instance.createAssetReference(n),this.assetRef.state=qt.Loading),void 0!==e){So.loadObject(e,function(t,e){i.assetRef.asset=t,r()},r,!1)}else this.assetRef.asset=null,r()},AssetKey.prototype.isLoaded=function(){return w.isAssetRefLoaded(this.assetRef)},AssetKey.prototype.getValue=function(){return this.assetRef.asset},Eh([unserializable(),Bh("design:type",Yt)],AssetKey.prototype,"assetRef",void 0),AssetKey}(_p),Ih=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Mh=function(t){function SingleTrack(e){var n=t.call(this)||this;return n.keys=new xt(e),n.internalCreateKey=function(){return new e},n}return Ih(SingleTrack,t),Object.defineProperty(SingleTrack.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),SingleTrack.prototype.getKeys=function(){return this.keys.data},SingleTrack.prototype.createKey=function(t,e,n){var r=Xl.find(this.keys.data,t);r?r.setValue(e):((r=this.internalCreateKey()).time=t,r.setValue(e),this.keys.grow(r),this.sortByTime()),n&&n(r)},SingleTrack.prototype.removeKey=function(t){for(var e=0;e<this.keys.data.length;++e)if(this.keys.data[e]===t){this.keys.data.splice(e,1);break}},SingleTrack.prototype.sortByTime=function(t){if(void 0===t&&(t=!0),this.keys.data.sort(function(t,e){return t.time-e.time}),t)for(var e=0;e<this.keys.data.length-1;){var n=this.keys.data[e],r=this.keys.data[e+1];n.time===r.time?this.keys.data.splice(e,1):++e}},SingleTrack.prototype.serialize=function(){return{typeName:this.constructor.name,version:this.version,times:this.keys.data.map(function(t){return t.time}),values:this.keys.data.map(function(t){return t.value})}},SingleTrack.prototype.deserialize=function(t){1===t.version&&console.assert(!1);for(var e=t,n=0;n<e.times.length;++n){var r=this.internalCreateKey();r.time=e.times[n],r.setValue(e.values[n]),this.keys.grow(r)}return Promise.resolve(this)},SingleTrack}(yp),zh=function(t){function BooleanTrack(){return t.call(this,Ch)||this}return Ih(BooleanTrack,t),BooleanTrack}(Mh),kh=function(t){function StringTrack(){return t.call(this,Sh)||this}return Ih(StringTrack,t),StringTrack}(Mh),Dh=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Fh=function(t){function NumberTrack(){return t.call(this,Oh)||this}return Dh(NumberTrack,t),Object.defineProperty(NumberTrack.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),NumberTrack.prototype.getSample=function(t){var e=this.getKeys();if(0!==e.length){var n=e.filter(function(e){return e.time>t});if(n.length===e.length)return n[0].value;var r=e.filter(function(e){return e.time<=t});console.assert(r.length>0);var i=r[r.length-1];if(r.length===e.length)return i.value;console.assert(n.length>0);var o=n[0],a=(t-i.time)/(o.time-i.time);return i.lerp(i,o,a)}},NumberTrack.prototype.serialize=function(){return{typeName:this.constructor.name,version:this.version,times:this.keys.data.map(function(t){return[t.time,t.tangents[0][0],t.tangents[1][0]]}),values:this.keys.data.map(function(t){return[t.value,t.tangents[0][1],t.tangents[1][1]]})}},NumberTrack.prototype.deserialize=function(t){if(1===t.version)console.assert(!1);else if(2===t.version){var e=t,n=e.times,r=e.values;Object.assign(t,{times:n.map(function(t){return[t,t,t]}),values:r.map(function(t){return[t,t,t]})})}for(var i=t,o=0;o<i.times.length;++o){var a=this.internalCreateKey();a.time=i.times[o][0],a.setValue(i.values[o][0]),a.tangents=[[i.times[o][1],i.values[o][1]],[i.times[o][2],i.values[o][2]]],this.keys.grow(a)}return Promise.resolve(this)},NumberTrack}(Mh),Lh=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Nh=function(t){function AnimationSubTrackDefinition(e,n){var r=t.call(this)||this;return r.componentId=e||"",r.track=n||new l(Fh),r}return Lh(AnimationSubTrackDefinition,t),AnimationSubTrackDefinition}(_),Vh=function(t){function CompositeTrack(){var e=null!==t&&t.apply(this,arguments)||this;return e.tracks=new xt(Nh),e}return Lh(CompositeTrack,t),CompositeTrack.prototype.getSample=function(t,e){for(var n=0,r=this.tracks.data;n<r.length;n++){var i=r[n],o=i.track.instance.getSample(t);void 0!==o&&(e[i.componentId]=o)}return e},CompositeTrack}(yp),Uh=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Wh=function(t){function AssetTrack(e){var n=t.call(this,Ah)||this;return n._typeName=e,n}return Uh(AssetTrack,t),Object.defineProperty(AssetTrack.prototype,"typeName",{get:function(){return this._typeName},enumerable:!0,configurable:!0}),AssetTrack.prototype.createKey=function(t,e,n){var r=Xl.find(this.keys.data,t);if(r)r.initializeReference(e,this._typeName,function(){n&&n(r)});else{var i=this.internalCreateKey();i.time=t,this.keys.grow(i),this.sortByTime(),i.initializeReference(e,this._typeName,function(){n&&n(i)})}},AssetTrack.prototype.isLoaded=function(){if(!this._typeName)return!1;if(this.keys)for(var t=0,e=this.keys.data;t<e.length;t++){if(!e[t].isLoaded())return!1}return!0},AssetTrack.prototype.serialize=function(){var t={typeName:this.constructor.name,version:this.version,times:this.keys.data.map(function(t){return t.time}),values:this.keys.data.map(function(t){return t.value})};return Object.assign(t,{_typeName:this._typeName}),t},AssetTrack.prototype.deserialize=function(e){1===e.version?this._typeName=e.properties._typeName.data:this._typeName=e._typeName,t.prototype.deserialize.call(this,e);for(var n=0,r=this.keys.data;n<r.length;n++){var i=r[n];i.initializeReference(i.value,this.typeName,function(){})}return Promise.resolve(this)},AssetTrack}(Mh),qh=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Gh=function(t){function ColorTrack(){return t.call(this,Rh)||this}return qh(ColorTrack,t),ColorTrack.prototype.createKey=function(t,e,n){var r=Xl.find(this.keys.data,t);r?r.getValue().copy(e):((r=this.internalCreateKey()).time=t,r.setValue((new H).copy(e)),this.keys.grow(r),this.sortByTime()),n&&n(r)},ColorTrack.prototype.getSample=function(t,e){var n=this.getKeys();if(0!==n.length&&e){var r=n.filter(function(e){return e.time>t});if(r.length===n.length)return e.copy(r[0].getValue());var i=n.filter(function(e){return e.time<=t});console.assert(i.length>0);var o=i[i.length-1];if(i.length===n.length)return e.copy(o.getValue());var a=r[0],s=(t-o.time)/(a.time-o.time);return o.lerp(o,a,s,e)}},ColorTrack}(Mh),Hh=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Kh=function(t){function RotationTrack(){var e=t.call(this)||this;return e.eulerOrder="YXZ",e.tracks.grow(new Nh("x",new l(Fh,new Fh))),e.tracks.grow(new Nh("y",new l(Fh,new Fh))),e.tracks.grow(new Nh("z",new l(Fh,new Fh))),e}return Hh(RotationTrack,t),RotationTrack.prototype.getSample=function(t,e){var n=this.tracks.data[0].track.instance,r=this.tracks.data[1].track.instance,i=this.tracks.data[2].track.instance;return e.setFromEulerAngles(n.getSample(t)||0,r.getSample(t)||0,i.getSample(t)||0,this.eulerOrder)},RotationTrack}(Vh),Xh=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Qh=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Yh=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};(hh||(hh={})).meshPropertyKey="mesh";var Zh,Jh=function(t){function MeshParticle(){var e=t.call(this)||this;return e.mesh=new Yt(Ra),e.scale=new V(1,1,1),e.onMeshChanged=e.onMeshChanged.bind(e),e.mesh.assetChanged.attach(e.onMeshChanged),e}return Xh(MeshParticle,t),MeshParticle.prototype.getPositions=function(t,e,n){var r=this.mesh.asset?this.mesh.asset.vertexBuffer:null;if(r)for(var i=r.attributes.position,o=0;o<r.vertexCount;++o){var a=3*o,s=e+a;t[s+0]=i[a+0]*n*this.scale.x,t[s+1]=i[a+1]*n*this.scale.y,t[s+2]=i[a+2]*n*this.scale.z}},MeshParticle.prototype.getUvs=function(t,e){var n=this.mesh.asset?this.mesh.asset.vertexBuffer:null;if(n)for(var r=n.attributes.uv,i=2*n.vertexCount,o=0;o<i;++o)t[e+o]=r[o]},MeshParticle.prototype.makeLocalTransform=function(t,e){},MeshParticle.prototype.makeParticleTransform=function(t,e){t.makeLookAt(e.normalize(),V.up).transpose()},MeshParticle.prototype.vertexCount=function(){return this.mesh.asset?this.mesh.asset.vertexBuffer.vertexCount:0},MeshParticle.prototype.setProperty=function(e,n){t.prototype.setProperty.call(this,e,n),this.onPropertyChanged&&this.onPropertyChanged(e)},MeshParticle.prototype.destroy=function(){this.mesh.detach()},MeshParticle.prototype.onMeshChanged=function(t){this.onPropertyChanged&&this.onPropertyChanged(hh.meshPropertyKey)},MeshParticle=Qh([displayName("Mesh"),Yh("design:paramtypes",[])],MeshParticle)}(is),$h=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),tf=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},ef=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},nf=function(t){function BoxGeometry(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundingBox=new at(new V(-1,-1,-1),new V(1,1,1)),e}return $h(BoxGeometry,t),BoxGeometry.prototype.getVertexBuffer=function(){return Qr.primitives.box.vertexBuffer},BoxGeometry.prototype.getBoundingBox=function(){return this._boundingBox},tf([unserializable(),ef("design:type",Object)],BoxGeometry.prototype,"_boundingBox",void 0),BoxGeometry=tf([displayName("Box")],BoxGeometry)}(ns),rf=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),of=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},af=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},sf=function(t){function SphereGeometry(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundingBox=new at(new V(-1,-1,-1),new V(1,1,1)),e}return rf(SphereGeometry,t),SphereGeometry.prototype.getVertexBuffer=function(){return Qr.primitives.sphere.vertexBuffer},SphereGeometry.prototype.getBoundingBox=function(){return this._boundingBox},of([unserializable(),af("design:type",Object)],SphereGeometry.prototype,"_boundingBox",void 0),SphereGeometry=of([displayName("Sphere")],SphereGeometry)}(ns),cf=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),uf=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},lf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},pf=function(t){function PlaneGeometry(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundingBox=new at(new V(-1,-.1,-1),new V(1,.1,1)),e}return cf(PlaneGeometry,t),PlaneGeometry.prototype.getVertexBuffer=function(){return Qr.primitives.plane.vertexBuffer},PlaneGeometry.prototype.getBoundingBox=function(){return this._boundingBox},uf([unserializable(),lf("design:type",Object)],PlaneGeometry.prototype,"_boundingBox",void 0),PlaneGeometry=uf([displayName("Plane")],PlaneGeometry)}(ns),hf=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ff=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},df=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},yf=function(t){function ConeGeometry(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundingBox=new at(new V(-1,-1,-1),new V(1,1,1)),e}return hf(ConeGeometry,t),ConeGeometry.prototype.getVertexBuffer=function(){return Qr.primitives.cone.vertexBuffer},ConeGeometry.prototype.getBoundingBox=function(){return this._boundingBox},ff([unserializable(),df("design:type",Object)],ConeGeometry.prototype,"_boundingBox",void 0),ConeGeometry=ff([displayName("Cone")],ConeGeometry)}(ns),mf=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),vf=function(t){function IKFootSolver(){return null!==t&&t.apply(this,arguments)||this}return mf(IKFootSolver,t),IKFootSolver.prototype.update=function(){var t=this.getEntity(),e=this.getEffector();if(t&&e&&t.parent){var n=t.getComponents(jc).filter(function(t){return t.active});if(!(n.length<3)){var r=n[0],i=n[1],o=(n[2],n.map(function(t){return t.entity.transform.worldPosition})),a=o[0],s=o[1],c=o[2],u=e.entity.transform.worldPosition,l=t.parent.transform,p=l.worldForward,h=l.worldUp,f=l.worldMatrix,d=V.fromPool().copy(u).substract(a).projectOnVector(h),y=V.distance(V.fromPool().copy(u).substract(d),a),m=V.fromPool().copy(p).multiply(y).add(a).add(d),v=nt.fromPool().compose(t.transform.position,it.identity,t.transform.scale),g=nt.fromPool().multiplyMatrices(f,v).invert(),_=V.fromPool().copy(m).transform(g).normalize(),b=V.distance(a,s),w=V.distance(s,c),x=V.distance(a,m),P=Math.atan2(_.z,-_.y);_.copy(u).transform(g).normalize();var O=Math.atan2(_.x,_.z),C=it.fromPool(),S=it.fromPool();if(x>=b+w)C.setFromEulerAngles(-P,O,0),S.copy(it.identity);else{var j=Math.acos((w*w-b*b-x*x)/(-2*b*x));C.setFromEulerAngles(-(P+j),O,0);var R=Math.acos((x*x-b*b-w*w)/(-2*b*w));S.setFromEulerAngles(Math.PI-R,0,0)}r.entity.transform.rotation.slerp(C,e.influence),i.entity.transform.rotation.slerp(S,e.influence)}}},IKFootSolver}(bc),gf=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),_f=function(t){function AnimationTransition(){var e=null!==t&&t.apply(this,arguments)||this;return e.from=new Yt(Yi),e.to=new Yt(Yi),e.duration=.3,e}return gf(AnimationTransition,t),AnimationTransition}(A),bf=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),wf=function(t){function ModelMesh(){var e=null!==t&&t.apply(this,arguments)||this;return e.material=new Yt(qu),e.mesh=new Yt(Ra),e}return bf(ModelMesh,t),Object.defineProperty(ModelMesh.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),ModelMesh.prototype.destroy=function(){this.material.detach(),this.mesh.detach()},ModelMesh.prototype.upgrade=function(t,e){if(1===e){for(var n={typeName:"ModelElement",data:[]},r=0,i=t.properties.children.data;r<i.length;r++){var o=i[r],a={baseTypeName:"ModelElement",data:{typeName:t.properties.children.typeName}};Object.assign(a.data,o),n.data.push(a)}t.properties.children=n}return t},ModelMesh}(cp),xf=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Pf=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},Of=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Cf=function(t){function ModelSkinnedMesh(){var e=null!==t&&t.apply(this,arguments)||this;return e._bindMatrix=new nt,e._bonesFbxIds=new xt(Number),e}return xf(ModelSkinnedMesh,t),Object.defineProperty(ModelSkinnedMesh.prototype,"bindMatrix",{get:function(){return this._bindMatrix},set:function(t){this._bindMatrix.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(ModelSkinnedMesh.prototype,"boneFbxIds",{get:function(){return this._bonesFbxIds.data.map(function(t){return t.valueOf()})},enumerable:!0,configurable:!0}),ModelSkinnedMesh.prototype.setBones=function(t){this._bonesFbxIds.data.length=0;for(var e=0,n=t;e<n.length;e++){var r=n[e];this._bonesFbxIds.grow(r.fbxNodeId)}},Pf([Attributes_hidden(),Of("design:type",Object)],ModelSkinnedMesh.prototype,"_bonesFbxIds",void 0),ModelSkinnedMesh}(wf),Sf=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),jf=function(t){function ModelBone(){var e=null!==t&&t.apply(this,arguments)||this;return e.worldMatrix=new nt,e}return Sf(ModelBone,t),ModelBone}(cp),Rf=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Tf=function(t){function ModelSubMesh(){var e=null!==t&&t.apply(this,arguments)||this;return e.geometry=new Yt(Ra),e.material=new Yt(qu),e}return Rf(ModelSubMesh,t),ModelSubMesh.prototype.destroy=function(){this.geometry.detach(),this.material.detach()},ModelSubMesh}(_),Ef=function(t){function ModelMultiMesh(){var e=null!==t&&t.apply(this,arguments)||this;return e.subMeshes=new xt(Tf),e}return Rf(ModelMultiMesh,t),ModelMultiMesh.prototype.destroy=function(){this.subMeshes.data.forEach(function(t){return t.destroy()})},ModelMultiMesh}(cp),Bf=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function __(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Af=function(t,e,n,r){var i,o=arguments.length,a=o<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,n,a):i(e,n))||a);return o>3&&a&&Object.defineProperty(e,n,a),a},If=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Mf=function(t){function InclusionVisualFilter(e){var n=t.call(this)||this;return n._included=new Zt(vs),e&&(n._included.data=e.map(function(t){return new Yt(vs,t)})),n}return Bf(InclusionVisualFilter,t),InclusionVisualFilter.prototype.getIncluded=function(){return this._included},InclusionVisualFilter=Af([displayName("Include"),If("design:paramtypes",[Array])],InclusionVisualFilter)}(Il),zf=function(t){function ExclusionVisualFilter(e){var n=t.call(this)||this;return n._excluded=new Zt(vs),e&&(n._excluded.data=e.map(function(t){return new Yt(vs,t)})),n}return Bf(ExclusionVisualFilter,t),ExclusionVisualFilter.prototype.getExcluded=function(){return this._excluded},ExclusionVisualFilter=Af([displayName("Exclude"),If("design:paramtypes",[Array])],ExclusionVisualFilter)}(Il),kf=function(){function TypeRegistration(){}return TypeRegistration.registerDefaultTypes=function(){var t=g.instance;t.registerObject(_),t.registerObject(C,_),t.registerObject(hu,C),t.registerObject(Ha,_),t.registerObject(A,C),t.registerObject(ju,A),t.registerObject(Ce,A),t.registerObject(Et,_,!0),t.registerObject(zt,Et),t.registerObject(Fl,Et),t.registerObject(Yu,Et),t.registerObject(Tl,Ha),t.registerObject(vl,Ha),t.registerObject(Io,C),t.registerObject(xh,Et),t.registerObject(uo,_),t.registerObject(lo,uo),t.registerObject(po,uo),t.registerObject(ul,Et),t.registerObject(ns,_),t.registerObject(tp,ns),t.registerObject(Lp,ns),t.registerObject(Hu,ns),t.registerObject(ol,Hu),t.registerObject(zp,ns),t.registerObject(rh,ns),t.registerObject(uh,ns),t.registerObject(nf,ns),t.registerObject(sf,ns),t.registerObject(pf,ns),t.registerObject(yf,ns),t.registerObject(vs,A),t.registerObject(qu,A),t.registerObject(L,A),t.registerObject(Lu,L),t.registerObject(fh,Lu),t.registerObject(wr,L),t.registerObject(Rr,wr),t.registerObject(fl,wr),t.registerObject(Si,wr),t.registerObject(tl,wr),t.registerObject(Na,wr),t.registerObject(mu,L),t.registerObject(Ra,L),t.registerObject(pp,A),t.registerObject(cp,C),t.registerObject(wf,cp),t.registerObject(Ef,cp),t.registerObject(Tf,_),t.registerObject(Cf,wf),t.registerObject(jf,cp),t.registerObject($a,_),t.registerObject(Bp,$a),t.registerObject(ds,$a),t.registerObject(Kl,Et),t.registerObject(Wl,_),t.registerObject(ql,Wl),t.registerObject(Cs,_),t.registerObject(Ss,Cs),t.registerObject(js,Cs),t.registerObject(bu,_),t.registerObject(wu,bu),t.registerObject(xu,bu),t.registerObject(Pu,bu),t.registerObject(X,_),t.registerObject(Y,X),t.registerObject(Q,X),t.registerObject(Cl,_),t.registerObject(wl,_),t.registerObject(xl,wl),t.registerObject(Pl,_),t.registerObject(Ol,Pl),t.registerObject(Za,Et),t.registerObject(Il,_),t.registerObject(Mf,Il),t.registerObject(zf,Il),t.registerObject(Rs,Et),t.registerObject(ls,ns),t.registerObject(is,_),t.registerObject(bs,is),t.registerObject(Jh,is),t.registerObject(ba,Et),t.registerObject(Wc,Et),t.registerObject(ta,A),t.registerObject(la,_),t.registerObject(da,la),t.registerObject(ma,la),t.registerObject($p,la),t.registerObject(Ea,la),t.registerObject(Oa,la),t.registerObject(Ns,la),t.registerObject(Qe,ve),t.registerObject(Fs,Et),t.registerObject(Hs,Et),t.registerObject(oa,_,!0),t.registerObject(aa,oa),t.registerObject(sa,oa),t.registerObject(si,Et),t.registerObject(Fi,Et),t.registerObject(vr,Et),t.registerObject(Ys,si),t.registerObject(Ui,si),t.registerObject(rc,si),t.registerObject(Mi,si),t.registerObject(dc,Et),t.registerObject(Ir,A),t.registerObject(Dr,A),t.registerObject(Vr,_),t.registerObject(Ur,Vr),t.registerObject(Wr,Vr),t.registerObject(qr,Vr),t.registerObject(Gr,Vr),t.registerObject(Hr,Vr),t.registerObject(Kr,Hr),t.registerObject(Vn,sn),t.registerObject(ui,_),t.registerObject(wi,_),t.registerObject(xi,wi),t.registerObject(Ei,ui),t.registerObject(vi,ui),t.registerObject(hi,A),t.registerObject(sc,_),t.registerObject(cc,sc),t.registerObject(we,A),t.registerObject($c,A),t.registerObject(hr,Et),t.registerObject(oh,Et),t.registerObject(ir,A),t.registerObject(sn,_),t.registerObject(hn,sn),t.registerObject(In,sn),t.registerObject(Qn,In),t.registerObject($n,_),t.registerObject(Tn,hn),t.registerObject(Cn,hn),t.registerObject(Dn,sn),t.registerObject(wn,A),t.registerObject(Gn,wn),t.registerObject(Bn,_),t.registerObject(de,_),t.registerObject(ye,_),t.registerObject(me,ye),t.registerObject(ve,ye,!0),t.registerObject(Fe,ve),t.registerObject(Le,ve),t.registerObject(Ne,ve),t.registerObject(Ve,ve),t.registerObject(Ue,ve),t.registerObject(Ge,ve),t.registerObject(We,ve),t.registerObject(qe,ve),t.registerObject(Ke,ve),t.registerObject(Xe,ve),t.registerObject(Je,ve),t.registerObject(He,ve),t.registerObject(Ze,ve),t.registerObject(Ye,ve),t.registerObject(Yi,A),t.registerObject(_f,A),t.registerObject(yp,_),t.registerObject(gp,_),t.registerObject(Hi,_),t.registerObject(Nh,_),t.registerObject(Vh,yp),t.registerObject(Fh,yp),t.registerObject(zh,yp),t.registerObject(kh,yp),t.registerObject(Wh,yp),t.registerObject(Gh,yp),t.registerObject(Kh,Vh),t.registerObject(Oh,gp),t.registerObject(Ch,gp),t.registerObject(Sh,gp),t.registerObject(Rh,gp),t.registerObject(Ah,gp),t.registerObject(so,Et),t.registerObject(to,_),t.registerObject(Dc,Et),t.registerObject(bc,_),t.registerObject(Mc,bc),t.registerObject(vf,bc),t.registerObject(Pc,Et),t.registerObject(jc,Et),t.registerObject(Cc,_),t.registerObject(Ic,_),t.registerObject(ip,hn),t.registerObject(jp,sn),t.registerObject(Pp,sn),t.registerObject(Zp,In),t.registerObject(Kp,In),t.registerObject(Wp,In),t.registerObject(bh,hn),t.registerObject(mh,A)},TypeRegistration}();!function(t){t.objectRegister={},t.getObjectInfo=function getObjectInfo(e){return e in t.objectRegister?t.objectRegister[e]:(k.logError("Unknown object type: "+e),null)}}(Zh||(Zh={}));var Df,Ff,Lf=function(){function Factory(){}return Factory.prototype.registerObject=function(t,e,n){Zh.objectRegister[t.name]={createInstance:function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return new(t.bind.apply(t,[void 0].concat(e)))},createReference:function(e){return new l(t,e)},createAssetReference:function(){return new Yt(t)},createComponentReference:function(){return new Lt(t)},createObjectArray:function(e){return new xt(t,e)},createReferenceArray:function(e){return new Ot(t,e)},createAssetReferenceArray:function(e){return new Zt(t,e)}},n&&(Zh.objectRegister[t.name].isAbstract=n),e&&h.registerRawTypeInfo(e.name,t.name)},Factory.prototype.createObject=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=Zh.getObjectInfo(t);return r&&!r.isAbstract?r.createInstance.apply(r,e):null},Factory.prototype.createReference=function(t,e){var n=Zh.getObjectInfo(t);return n?n.createReference(e):null},Factory.prototype.createAssetReference=function(t){var e=Zh.getObjectInfo(t);return e?e.createAssetReference():null},Factory.prototype.createAssetReferenceArray=function(t,e){var n=Zh.getObjectInfo(t);return n?n.createAssetReferenceArray(e):null},Factory.prototype.createComponentReference=function(t){var e=Zh.getObjectInfo(t);return e?e.createComponentReference():null},Factory.prototype.createObjectArray=function(t,e){var n=Zh.getObjectInfo(t);return n?n.createObjectArray(e):null},Factory.prototype.createReferenceArray=function(t,e){var n=Zh.getObjectInfo(t);return n?n.createReferenceArray(e):null},Factory.prototype.isAbstract=function(t){if(t in Zh.objectRegister){var e=Zh.objectRegister[t].isAbstract;return void 0!==e&&e}return!1},Factory}(),Nf=function(){function FactoryInternal(){}return FactoryInternal.create=function(t){var e=new Lf;g.instance=e,kf.registerDefaultTypes(),t&&t.forEach(function(t){var n=t[0],r=t[1];return e.registerObject(n,r)}),h.buildTypeTree()},FactoryInternal}(),Vf=function(){function Serializer(){}return Serializer.prototype.copyVertexBuffer=function(t){var e=ue.properties.VertexBuffer.writeProperty(t);return ue.properties.VertexBuffer.readProperty(JSON.parse(JSON.stringify(e)))},Serializer.prototype.serializeObject=function(t){return su.serializeObject(t)},Serializer.prototype.deserializeObject=function(t,e){su.deserializeObject(t,e)},Serializer}();!function(t){(Df||(Df={})).create=function create(){m.instance=new Vf}}(),(Ff||(Ff={})).requests={};var Uf,Wf=function(){function WebUtils(){}return WebUtils.request=function(t,e,n,r,i,o,a){var s=t+"_"+e,c=new XMLHttpRequest;if(c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE){var t=null;s in Ff.requests&&(t=Ff.requests[s],delete Ff.requests[s]),t&&(200===c.status||0===c.status?t&&("blob"===o?t.onSuccess(c.response):t.onSuccess(c.responseText)):t.onError(c.statusText))}},c.upload.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;WebUtils.uploadProgressChanged.post(e)}},c.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;WebUtils.downloadProgressChanged.post(e)}},o&&(c.responseType=o),Ff.requests[s]={request:c,onSuccess:n,onError:r},c.open(t,e,!0),a)for(var u=0,l=Object.keys(a);u<l.length;u++){var p=l[u];c.setRequestHeader(p,a[p])}return c.send(i),s},WebUtils.abortRequest=function(t){var e=Ff.requests[t],n=e?e.request:null;n&&(delete Ff.requests[t],n.abort())},WebUtils.downloadProgressChanged=new S.AsyncEvent,WebUtils.uploadProgressChanged=new S.AsyncEvent,WebUtils}(),qf=function(){function DOMUtils(){}return DOMUtils.getWheelDelta=function(t,e){return 1===e?32*t:2===e?32*t*10:t},DOMUtils}();!function(t){t.translateEntityRef=function translateEntityRef(t,e,n){return!!(t.id&&t.id in e)&&(t.id=e[t.id],!0)},t.translateComponentRef=function translateComponentRef(t,e){return!!(t.entityId&&t.entityId in e)&&(t.entityId=e[t.entityId],!0)},t.recordTranslatedReference=function recordTranslatedReference(t,e,n,r,i){t&&(e in t||(t[e]={}),n in t[e]||(t[e][n]=[]),t[e][n][r]=i)},t.invParentMatrix=new nt,t.localScale=new V}(Uf||(Uf={}));var Gf,Hf=function(){function EntityUtils(){}return EntityUtils.prototype.preserveWorldPosition=function(t,e){var n=t.transform;if(n){(s=e.transform?e.transform.worldMatrix:null)||(s=nt.identity);var r=Uf.invParentMatrix,i=n.worldMatrix;r.copy(s).invert(),n.eventsEnabled=!1,n.position.setFromMatrix(i).transform(r);var o=n.worldScale;r.getScale(n.scale),n.scale.x*=o.x,n.scale.y*=o.y,n.scale.z*=o.z,r.multiply(i).getRotation(n.rotation),n.eventsEnabled=!0}else{var a=t.getComponent(vr);if(a){var s,c=e.getComponent(vr);if(s=c?c.worldMatrix:null)s.translateFromCoords(-c.pivot.x*c.actualWidth,-c.pivot.y*c.actualHeight,0);else{var u=e.getComponent(dc);u&&(s=nt.fromPool().copy(nt.identity).translateFromCoords(u.offset.x,u.offset.y,0))}if(s){r=Uf.invParentMatrix;var l=Uf.localScale;i=a.worldMatrix;a.horizontalAlignment=ur.Left,a.verticalAlignment=lr.Top,a.margin.set(0,0,0,0),r.copy(s).invert(),a.offset.setFromMatrix(i).transform(r);o=a.absoluteScale;r.getScale(l),l.x*=o.x,l.y*=o.y,a.scale.set(l.x,l.y),r.multiply(i).getRotation(a.rotation)}}}},EntityUtils.prototype.updateLayoutMatrixIfNecessary=function(t){var e=this;t.traverse(function(t){var n=t.getComponent(vr);return!!n&&(e.updateLayoutWorldMatrix(n),!0)},!0)},EntityUtils.prototype.dirtifyWorldMatrixIfNecessary=function(t){var e=t.transform;e&&e.dirtifyWorldMatrix()},EntityUtils.prototype.updateLayoutWorldMatrix=function(t){var e=t.entity.getAncestorOfType(dc);e&&ic.updateLayoutWorldMatrix(t,e.getResolution(dt.instance.screenSize),e.offset)},EntityUtils.prototype.translateReferences=function(t,e,n){t.traverse(function(t){return t.iterateComponents(function(r){for(var i=0,o=Object.keys(r);i<o.length;i++){var a=o[i],s=su.getSerializablePropertyTypeName(r,a);if("EntityReference"===s){var c=r[a];Uf.translateEntityRef(c,e)&&Uf.recordTranslatedReference(n,t.id,r.constructor.name,a,c)}else if("ComponentReference"===s){var u=r[a];Uf.translateComponentRef(u,e)&&Uf.recordTranslatedReference(n,t.id,r.constructor.name,a,u)}else if("ReferenceArray"===s)for(var l=r[a],p=0,h=l.data;p<h.length;p++){var f=h[p].instance;if(f)for(var d=0,y=Object.keys(f);d<y.length;d++){var m=y[d],v=su.getSerializablePropertyTypeName(f,m);if("EntityReference"===v){c=f[m];Uf.translateEntityRef(c,e)&&Uf.recordTranslatedReference(n,t.id,r.constructor.name,a,l)}else if("ComponentReference"===v){u=f[m];Uf.translateComponentRef(u,e)&&Uf.recordTranslatedReference(n,t.id,r.constructor.name,a,l)}}}else if("_geometry"===a&&"Reference"===s){var g=r[a];if(g.instance&&g.instance.isA(ol)){c=g.instance[ol.skeletonPropertyKey];Uf.translateEntityRef(c,e)&&Uf.recordTranslatedReference(n,t.id,r.constructor.name,a,r[a])}}}}),!0},!0)},EntityUtils.prototype.sortComponents=function(t){return t.sort(function(t,e){var n=Reflect.getMetadata("sortOrder",t.constructor),r=void 0===n?-1:n,i=Reflect.getMetadata("sortOrder",e.constructor);return(void 0===i?-1:i)-r})},EntityUtils}();!function(t){(Gf||(Gf={})).create=function create(){iu.instance=new Hf}}();var Kf,Xf,Qf,Yf=function(){return(Yf=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};!function(t){t.canvasResized=!1,t.playRequestId=null,t.engineActive=!1,t.loadingInProgress=!1,t.keysDown=new Map,t.onDownloadProgressChanged=function onDownloadProgressChanged(e){t.engineConfig.onDownloadProgress&&t.engineConfig.onDownloadProgress(e,!1)},t.createFileInterface=function createFileInterface(){var e=!1,r=Boolean(t.engineConfig.startupUrl)?n(103).FileInMemory:(e=!0,n(104).FileStandaloneWeb);return console.assert(r),e?n.e(0).then(n.t.bind(null,106,3)).then(function(t){return t}).then(function(t){var e=t.default,n=Object.entries(e).reduce(function(t,e){var n,r=e[0],i=e[1];return Yf({},t,((n={})["Assets/DefaultAssets/"+r]=JSON.stringify(i),n))},{});vt.instance=new r(n)}):(vt.instance=new r,Promise.resolve())},t.downloadPlayableProject=function downloadPlayableProject(e){return new Promise(function(n,r){console.assert(!t.playRequestId),t.playRequestId=Wf.request("GET",e,function(e){t.engineConfig.onDownloadProgress&&t.engineConfig.onDownloadProgress(100,!0),Wf.downloadProgressChanged.detach(t.onDownloadProgressChanged),ko.importGameFromBlob(e,function(){return n()},r)},function(){return Wf.downloadProgressChanged.detach(t.onDownloadProgressChanged)},void 0,"blob"),Wf.downloadProgressChanged.attach(t.onDownloadProgressChanged)})}}(Kf||(Kf={})),function(t){function onTouchEnd(t){t.preventDefault();for(var e=0;e<t.changedTouches.length;++e){var n=Kf.targetCanvas.getBoundingClientRect(),r=t.changedTouches[e];$s.onTouchUp(r.clientX-n.left,r.clientY-n.top,0);break}}t.onWindowResized=function onWindowResized(){Kf.targetCanvas&&(Yl.processCanvasDimensions(Kf.targetCanvas),Kf.canvasResized=!0)},t.onMouseDown=function onMouseDown(t){var e=Kf.targetCanvas.getBoundingClientRect();$s.onTouchDown(t.clientX-e.left,t.clientY-e.top,t.button),t.preventDefault()},t.onMouseWheel=function onMouseWheel(t){var e=qf.getWheelDelta(t.deltaY,t.deltaMode);$s.onMouseWheel(e),t.preventDefault()},t.onMouseMove=function onMouseMove(t){var e=Kf.targetCanvas.getBoundingClientRect();$s.onTouchMove(t.clientX-e.left,t.clientY-e.top,t.button),t.preventDefault()},t.onMouseUp=function onMouseUp(t){var e=Kf.targetCanvas.getBoundingClientRect();$s.onTouchUp(t.clientX-e.left,t.clientY-e.top,t.button),t.preventDefault()},t.onTouchStart=function onTouchStart(t){t.preventDefault();for(var e=0;e<t.changedTouches.length;++e){var n=Kf.targetCanvas.getBoundingClientRect(),r=t.changedTouches[e];$s.onTouchDown(r.clientX-n.left,r.clientY-n.top,0);break}},t.onTouchEnd=onTouchEnd,t.onTouchCancel=function onTouchCancel(t){t.preventDefault(),onTouchEnd(t)},t.onTouchMove=function onTouchMove(t){t.preventDefault();for(var e=0;e<t.changedTouches.length;++e){var n=Kf.targetCanvas.getBoundingClientRect(),r=t.changedTouches[e];$s.onTouchMove(r.clientX-n.left,r.clientY-n.top,0);break}},t.onKeyDown=function onKeyDown(t){var e=$s.keyChangedInfo;Kf.keysDown.has(t.keyCode)||(e.pressed=!0,e.keyCode=t.keyCode,Kf.keysDown.set(t.keyCode,!0),Js.keyChanged.post(e))},t.onKeyUp=function onKeyUp(t){var e=$s.keyChangedInfo;e.pressed=!1,e.keyCode=t.keyCode,Kf.keysDown.delete(t.keyCode),Js.keyChanged.post(e)}}(Xf||(Xf={})),function(t){function unload(){ti.unload(ht.context),pu.destroy(),R.instance.clearCache(),yn.clear()}function render(t,e,n,r){Kf.canvasResized&&(t.forEach(function(t){return t.invalidateFrustum()}),Kf.canvasResized=!1);for(var i=0,o=pu.list();i<o.length;i++){var a=o[i];Yl.render(a.environment,t,e,n,r)}}t.targetCanvas=function(){return Kf.targetCanvas},t.initializeWithCanvas=function initializeWithCanvas(t){var e={alpha:Io.instance.canvasAlpha},n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);return n?(ht.create(n,1),wo.initialize(),"isMobile"in window&&window.isMobile.any?(window.addEventListener("touchstart",Xf.onTouchStart),window.addEventListener("touchend",Xf.onTouchEnd),window.addEventListener("touchcancel",Xf.onTouchCancel),window.addEventListener("touchmove",Xf.onTouchMove)):(window.addEventListener("mousemove",Xf.onMouseMove),window.addEventListener("mouseup",Xf.onMouseUp),window.addEventListener("mousedown",Xf.onMouseDown),window.addEventListener("wheel",Xf.onMouseWheel,{passive:!1})),window.addEventListener("resize",Xf.onWindowResized),window.addEventListener("keyup",Xf.onKeyUp),window.addEventListener("keydown",Xf.onKeyDown),Promise.resolve()):Promise.reject(Ro.WebGLContextCreationFailed)},t.unload=unload,t.reload=function reload(){return unload(),Io.load().then(function(){return Jr.load()}).then(function(){return ht.context?Promise.resolve():t.initializeWithCanvas(Kf.targetCanvas)})},t.flushPools=function flushPools(){$.pool.flush(),V.pool.flush(),tt.pool.flush(),nt.pool.flush(),ot.pool.flush(),se.pool.flush(),it.pool.flush(),tn.pool.flush()},t.render=render,t.updateFrame=function updateFrame(){if(Kf.engineActive){if(Kf.loadingInProgress=Ko.updateLoading(),!Jr.isLoaded())return Kf.loadingInProgress=!0,void requestAnimationFrame(function(){return updateFrame()});pu.updateTransition(),G.updateDeltaTime(),t.flushPools();var e=pu.list();if(0===e.length)return ht.context.clear(ht.context.COLOR_BUFFER_BIT|ht.context.DEPTH_BUFFER_BIT),void requestAnimationFrame(function(){return updateFrame()});if(!e.every(function(t){return t.isLoaded()}))return Kf.loadingInProgress=!0,void requestAnimationFrame(function(){return updateFrame()});Kf.loadingInProgress=!1,Uc.update();var n=xa.ofType(Fl);n.sort(function(t,e){return t.priority-e.priority}),render(n),requestAnimationFrame(function(){return updateFrame()})}}}(Qf||(Qf={}));var Zf=function(){function Engine(){}return Engine.create=function(t){var e,n,r,i,o;k.log("SpiderEngine creation - Platform: web, Config: standalone, Env: production"),Kf.engineConfig=t,So.create(),Nf.create(t.customTypes),Df.create(),Gf.create(),t.container&&(Kf.targetCanvas=t.container,Yl.create(Kf.targetCanvas),$s.create((e=Kf.targetCanvas.getBoundingClientRect(),n=e.left,r=e.top,i=e.width,o=e.height,new $(t.initialTouchPosition?t.initialTouchPosition.x-n:i/2,t.initialTouchPosition?t.initialTouchPosition.y-r:o/2))));return Kf.createFileInterface().then(function(){return t.startupUrl?Kf.downloadPlayableProject(t.startupUrl):Promise.resolve()}).then(function(){return Kf.targetCanvas?Promise.resolve().then(function(){return Promise.resolve()}).then(function(){return Io.load()}).then(function(){return Qf.initializeWithCanvas(Kf.targetCanvas)}):Promise.resolve()}).then(function(){return go.preload()}).then(function(){return Jr.load()}).then(function(){if(Kf.targetCanvas){Kf.engineActive=!0,Qf.updateFrame();var e=t.startupScene||Io.instance.startupScene;if(e)return Tu.load(e)}return Promise.resolve(null)}).then(function(e){e&&t.onSceneLoaded&&t.onSceneLoaded(e.templatePath)}).catch(function(t){return Kf.engineActive=!1,Promise.reject(t)})},Engine.destroy=function(){Kf.engineActive&&(k.log("SpiderEngine destruction"),Kf.engineActive=!1,Wf.downloadProgressChanged.detach(Kf.onDownloadProgressChanged),Kf.playRequestId&&(Wf.abortRequest(Kf.playRequestId),Kf.playRequestId=null),Kf.engineConfig.container&&(wo.destroy(),"isMobile"in window&&window.isMobile.any?(window.removeEventListener("touchstart",Xf.onTouchStart),window.removeEventListener("touchend",Xf.onTouchEnd),window.removeEventListener("touchcancel",Xf.onTouchCancel),window.removeEventListener("touchmove",Xf.onTouchMove)):(window.removeEventListener("mousemove",Xf.onMouseMove),window.removeEventListener("mouseup",Xf.onMouseUp),window.removeEventListener("mousedown",Xf.onMouseDown),window.removeEventListener("wheel",Xf.onMouseWheel)),window.removeEventListener("resize",Xf.onWindowResized),window.removeEventListener("keyup",Xf.onKeyUp),window.removeEventListener("keydown",Xf.onKeyDown),Qf.unload()))},Engine.isLoadingInProgress=function(){return Kf.loadingInProgress},Engine}();n.d(e,"Engine",function(){return Zf}),n.d(e,"Interfaces",function(){return gt}),n.d(e,"Entities",function(){return Dt}),n.d(e,"Component",function(){return Et}),n.d(e,"SerializableObject",function(){return _}),n.d(e,"Model",function(){return pp}),n.d(e,"Input",function(){return Js}),n.d(e,"InputInternal",function(){return $s}),n.d(e,"Scenes",function(){return Tu}),n.d(e,"Update",function(){return Gc}),n.d(e,"Transform",function(){return zt}),n.d(e,"Assets",function(){return Zo}),n.d(e,"Time",function(){return J}),n.d(e,"Range",function(){return Vt}),n.d(e,"defaultAssets",function(){return Qr}),n.d(e,"DefaultAssetsInternal",function(){return Jr}),n.d(e,"CameraClear",function(){return Bl}),n.d(e,"Camera",function(){return Fl}),n.d(e,"Visual",function(){return ul}),n.d(e,"LightType",function(){return Wl}),n.d(e,"DirectionalLight",function(){return ql}),n.d(e,"PointLight",function(){return Gl}),n.d(e,"Light",function(){return Kl}),n.d(e,"ParticleEmitDirection",function(){return cs}),n.d(e,"ParticleValueOverLife",function(){return Cs}),n.d(e,"ParticleNumberOverLife",function(){return Ss}),n.d(e,"ParticleColorOverLife",function(){return js}),n.d(e,"Particles",function(){return Rs}),n.d(e,"Material",function(){return qu}),n.d(e,"Shader",function(){return Lu}),n.d(e,"PhongShaderInternal",function(){return vp}),n.d(e,"PhongShader",function(){return fh}),n.d(e,"BoxVolume",function(){return ds}),n.d(e,"SphereVolume",function(){return Bp}),n.d(e,"BoxGeometry",function(){return nf}),n.d(e,"SphereGeometry",function(){return sf}),n.d(e,"ConeGeometry",function(){return yf}),n.d(e,"PlaneGeometry",function(){return pf}),n.d(e,"Billboard",function(){return zp}),n.d(e,"CenteredQuad",function(){return tp}),n.d(e,"DynamicGeometry",function(){return uh}),n.d(e,"QuadGeometry",function(){return Lp}),n.d(e,"SkinnedMesh",function(){return ol}),n.d(e,"SpriteGeometry",function(){return rh}),n.d(e,"StaticMesh",function(){return Hu}),n.d(e,"Color",function(){return H}),n.d(e,"VertexBuffer",function(){return _t}),n.d(e,"VisualGroup",function(){return vs}),n.d(e,"RenderTarget",function(){return fl}),n.d(e,"InclusionVisualFilter",function(){return Mf}),n.d(e,"ExclusionVisualFilter",function(){return zf}),n.d(e,"Animation",function(){return Yi}),n.d(e,"AnimationComponent",function(){return so}),n.d(e,"Layout",function(){return vr}),n.d(e,"UIOverflow",function(){return ei}),n.d(e,"UIElement",function(){return si}),n.d(e,"SpriteRenderMode",function(){return jr}),n.d(e,"Sprite",function(){return Ir}),n.d(e,"SpriteSheet",function(){return Dr}),n.d(e,"FontMetrics",function(){return hi}),n.d(e,"Image",function(){return rc}),n.d(e,"Screen",function(){return dc}),n.d(e,"UIFill",function(){return Vr}),n.d(e,"MaterialFill",function(){return Ur}),n.d(e,"SpriteFill",function(){return Wr}),n.d(e,"TextureFill",function(){return qr}),n.d(e,"ColorFill",function(){return Gr}),n.d(e,"SpriteSheetFill",function(){return Hr}),n.d(e,"SpriteSheetMaterialFill",function(){return Kr}),n.d(e,"TouchInteractions",function(){return Fi}),n.d(e,"BehaviorComponent",function(){return hr}),n.d(e,"Behavior",function(){return ir}),n.d(e,"BehaviorAPI",function(){return Kc}),n.d(e,"BehaviorAPIFactory",function(){return en}),n.d(e,"CodeBlock",function(){return wn}),n.d(e,"Data",function(){return oh}),n.d(e,"Vector3",function(){return V}),n.d(e,"Vector2",function(){return $}),n.d(e,"Quaternion",function(){return it}),n.d(e,"Matrix44",function(){return nt}),n.d(e,"Vector4",function(){return tt}),n.d(e,"MathEx",function(){return W}),n.d(e,"RayPlaneCollisionResult",function(){return Re}),n.d(e,"RayAABBCollisionResult",function(){return Te}),n.d(e,"RaySphereCollisionResult",function(){return Ee}),n.d(e,"Ray",function(){return Ae}),n.d(e,"PlaneClassification",function(){return re}),n.d(e,"Plane",function(){return se}),n.d(e,"Random",function(){return Nt}),n.d(e,"BoxCollisionShape",function(){return ma}),n.d(e,"MeshCollisionShape",function(){return Ea}),n.d(e,"ParticlesCollisionShape",function(){return $p}),n.d(e,"PlaneCollisionShape",function(){return Ns}),n.d(e,"SphereCollisionShape",function(){return da}),n.d(e,"VisualCollisionShape",function(){return Oa}),n.d(e,"Collider",function(){return ba}),n.d(e,"PhysicsBroadPhaseType",function(){return Os}),n.d(e,"PhysicsContext",function(){return Fs}),n.d(e,"RigidBodyType",function(){return Ms}),n.d(e,"RigidBody",function(){return Hs})}]));
      