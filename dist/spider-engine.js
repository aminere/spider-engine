
      if (typeof exports === 'undefined') { var exports = {}; }
      var spider = exports;!function(t,e){for(var r in e)t[r]=e[r]}(exports,function(t){function webpackJsonpCallback(e){for(var n,i,o=e[0],s=e[1],c=0,u=[];c<o.length;c++)i=o[c],r[i]&&u.push(r[i][0]),r[i]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n]);for(a&&a(e);u.length;)u.shift()()}var e={},r={1:0};function __webpack_require__(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,__webpack_require__),n.l=!0,n.exports}__webpack_require__.e=function requireEnsure(t){var e=[],n=r[t];if(0!==n)if(n)e.push(n[2]);else{var i=new Promise(function(e,i){n=r[t]=[e,i]});e.push(n[2]=i);var o,a=document.createElement("script");a.charset="utf-8",a.timeout=120,__webpack_require__.nc&&a.setAttribute("nonce",__webpack_require__.nc),a.src=function jsonpScriptSrc(t){return __webpack_require__.p+""+({0:"default-assets"}[t]||t)+".js"}(t),o=function(e){a.onerror=a.onload=null,clearTimeout(s);var n=r[t];if(0!==n){if(n){var i=e&&("load"===e.type?"missing":e.type),o=e&&e.target&&e.target.src,c=new Error("Loading chunk "+t+" failed.\n("+i+": "+o+")");c.type=i,c.request=o,n[1](c)}r[t]=void 0}};var s=setTimeout(function(){o({type:"timeout",target:a})},12e4);a.onerror=a.onload=o,document.head.appendChild(a)}return Promise.all(e)},__webpack_require__.m=t,__webpack_require__.c=e,__webpack_require__.d=function(t,e,r){__webpack_require__.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,e){if(1&e&&(t=__webpack_require__(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(__webpack_require__.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)__webpack_require__.d(r,n,function(e){return t[e]}.bind(null,n));return r},__webpack_require__.n=function(t){var e=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(e,"a",e),e},__webpack_require__.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},__webpack_require__.p="/dist/",__webpack_require__.oe=function(t){throw console.error(t),t};var n=window.webpackJsonp=window.webpackJsonp||[],i=n.push.bind(n);n.push=webpackJsonpCallback,n=n.slice();for(var o=0;o<n.length;o++)webpackJsonpCallback(n[o]);var a=i;return __webpack_require__(__webpack_require__.s=104)}([function(t,e,r){"use strict";function __export(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}Object.defineProperty(e,"__esModule",{value:!0}),__export(r(15)),__export(r(19)),__export(r(30)),__export(r(31)),__export(r(60));var n=r(20),i=r(20);e.EventQueue=i.default,e.queue=function queue(){return n.default.global()},e.flushOnce=function flushOnce(){n.default.global().flushOnce()},e.flush=function flush(t){void 0===t&&(t=10),n.default.global().flush(t)}},function(t,e,r){"use strict";var n=r(5),i=r(38),o=r(18),a=r(78),s=r(13);function identity(t){return t}function stringToArrayLike(t,e){for(var r=0;r<t.length;++r)e[r]=255&t.charCodeAt(r);return e}e.newBlob=function(t,r){e.checkSupport("blob");try{return new Blob([t],{type:r})}catch(e){try{var n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return n.append(t),n.getBlob(r)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var c={stringifyByChunk:function(t,e,r){var n=[],i=0,o=t.length;if(o<=r)return String.fromCharCode.apply(null,t);for(;i<o;)"array"===e||"nodebuffer"===e?n.push(String.fromCharCode.apply(null,t.slice(i,Math.min(i+r,o)))):n.push(String.fromCharCode.apply(null,t.subarray(i,Math.min(i+r,o)))),i+=r;return n.join("")},stringifyByChar:function(t){for(var e="",r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},applyCanBeUsed:{uint8array:function(){try{return n.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return n.nodebuffer&&1===String.fromCharCode.apply(null,o.allocBuffer(1)).length}catch(t){return!1}}()}};function arrayLikeToString(t){var r=65536,n=e.getTypeOf(t),i=!0;if("uint8array"===n?i=c.applyCanBeUsed.uint8array:"nodebuffer"===n&&(i=c.applyCanBeUsed.nodebuffer),i)for(;r>1;)try{return c.stringifyByChunk(t,n,r)}catch(t){r=Math.floor(r/2)}return c.stringifyByChar(t)}function arrayLikeToArrayLike(t,e){for(var r=0;r<t.length;r++)e[r]=t[r];return e}e.applyFromCharCode=arrayLikeToString;var u={};u.string={string:identity,array:function(t){return stringToArrayLike(t,new Array(t.length))},arraybuffer:function(t){return u.string.uint8array(t).buffer},uint8array:function(t){return stringToArrayLike(t,new Uint8Array(t.length))},nodebuffer:function(t){return stringToArrayLike(t,o.allocBuffer(t.length))}},u.array={string:arrayLikeToString,array:identity,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return o.newBufferFrom(t)}},u.arraybuffer={string:function(t){return arrayLikeToString(new Uint8Array(t))},array:function(t){return arrayLikeToArrayLike(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:identity,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return o.newBufferFrom(new Uint8Array(t))}},u.uint8array={string:arrayLikeToString,array:function(t){return arrayLikeToArrayLike(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:identity,nodebuffer:function(t){return o.newBufferFrom(t)}},u.nodebuffer={string:arrayLikeToString,array:function(t){return arrayLikeToArrayLike(t,new Array(t.length))},arraybuffer:function(t){return u.nodebuffer.uint8array(t).buffer},uint8array:function(t){return arrayLikeToArrayLike(t,new Uint8Array(t.length))},nodebuffer:identity},e.transformTo=function(t,r){if(r||(r=""),!t)return r;e.checkSupport(t);var n=e.getTypeOf(r);return u[n][t](r)},e.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":n.nodebuffer&&o.isBuffer(t)?"nodebuffer":n.uint8array&&t instanceof Uint8Array?"uint8array":n.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},e.checkSupport=function(t){if(!n[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},e.MAX_VALUE_16BITS=65535,e.MAX_VALUE_32BITS=-1,e.pretty=function(t){var e,r,n="";for(r=0;r<(t||"").length;r++)n+="\\x"+((e=t.charCodeAt(r))<16?"0":"")+e.toString(16).toUpperCase();return n},e.delay=function(t,e,r){a(function(){t.apply(r||null,e||[])})},e.inherits=function(t,e){var r=function(){};r.prototype=e.prototype,t.prototype=new r},e.extend=function(){var t,e,r={};for(t=0;t<arguments.length;t++)for(e in arguments[t])arguments[t].hasOwnProperty(e)&&void 0===r[e]&&(r[e]=arguments[t][e]);return r},e.prepareContent=function(t,r,o,a,c){return s.Promise.resolve(r).then(function(t){return n.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new s.Promise(function(e,r){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.onerror=function(t){r(t.target.error)},n.readAsArrayBuffer(t)}):t}).then(function(r){var u=e.getTypeOf(r);return u?("arraybuffer"===u?r=e.transformTo("uint8array",r):"string"===u&&(c?r=i.decode(r):o&&!0!==a&&(r=function string2binary(t){return stringToArrayLike(t,n.uint8array?new Uint8Array(t.length):new Array(t.length))}(r))),r):s.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},function(t,r,n){var i;t.exports=function e(t,r,n){function s(a,c){if(!r[a]){if(!t[a]){var u="function"==typeof i&&i;if(!c&&u)return i(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var l=r[a]={exports:{}};t[a][0].call(l.exports,function(e){var r=t[a][1][e];return s(r||e)},l,l.exports,e,t,r,n)}return r[a].exports}for(var o="function"==typeof i&&i,a=0;a<n.length;a++)s(n[a]);return s}({1:[function(t,e,r){e.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,e,r){e.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,e,r){var n=t("../math/Vec3");function AABB(t){t=t||{},this.lowerBound=new n,t.lowerBound&&this.lowerBound.copy(t.lowerBound),this.upperBound=new n,t.upperBound&&this.upperBound.copy(t.upperBound)}t("../utils/Utils"),e.exports=AABB;var i=new n;AABB.prototype.setFromPoints=function(t,e,r,n){var o=this.lowerBound,a=this.upperBound,s=r;o.copy(t[0]),s&&s.vmult(o,o),a.copy(o);for(var c=1;c<t.length;c++){var u=t[c];s&&(s.vmult(u,i),u=i),u.x>a.x&&(a.x=u.x),u.x<o.x&&(o.x=u.x),u.y>a.y&&(a.y=u.y),u.y<o.y&&(o.y=u.y),u.z>a.z&&(a.z=u.z),u.z<o.z&&(o.z=u.z)}return e&&(e.vadd(o,o),e.vadd(a,a)),n&&(o.x-=n,o.y-=n,o.z-=n,a.x+=n,a.y+=n,a.z+=n),this},AABB.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this},AABB.prototype.clone=function(){return(new AABB).copy(this)},AABB.prototype.extend=function(t){var e=t.lowerBound.x;this.lowerBound.x>e&&(this.lowerBound.x=e);var r=t.upperBound.x;this.upperBound.x<r&&(this.upperBound.x=r);var e=t.lowerBound.y;this.lowerBound.y>e&&(this.lowerBound.y=e);var r=t.upperBound.y;this.upperBound.y<r&&(this.upperBound.y=r);var e=t.lowerBound.z;this.lowerBound.z>e&&(this.lowerBound.z=e);var r=t.upperBound.z;this.upperBound.z<r&&(this.upperBound.z=r)},AABB.prototype.overlaps=function(t){var e=this.lowerBound,r=this.upperBound,n=t.lowerBound,i=t.upperBound;return(n.x<=r.x&&r.x<=i.x||e.x<=i.x&&i.x<=r.x)&&(n.y<=r.y&&r.y<=i.y||e.y<=i.y&&i.y<=r.y)&&(n.z<=r.z&&r.z<=i.z||e.z<=i.z&&i.z<=r.z)},AABB.prototype.contains=function(t){var e=this.lowerBound,r=this.upperBound,n=t.lowerBound,i=t.upperBound;return e.x<=n.x&&r.x>=i.x&&e.y<=n.y&&r.y>=i.y&&e.z<=n.z&&r.z>=i.z},AABB.prototype.getCorners=function(t,e,r,n,i,o,a,s){var c=this.lowerBound,u=this.upperBound;t.copy(c),e.set(u.x,c.y,c.z),r.set(u.x,u.y,c.z),n.set(c.x,u.y,u.z),i.set(u.x,c.y,c.z),o.set(c.x,u.y,c.z),a.set(c.x,c.y,u.z),s.copy(u)};var o=[new n,new n,new n,new n,new n,new n,new n,new n];AABB.prototype.toLocalFrame=function(t,e){var r=o,n=r[0],i=r[1],a=r[2],s=r[3],c=r[4],u=r[5],l=r[6],p=r[7];this.getCorners(n,i,a,s,c,u,l,p);for(var f=0;8!==f;f++){var h=r[f];t.pointToLocal(h,h)}return e.setFromPoints(r)},AABB.prototype.toWorldFrame=function(t,e){var r=o,n=r[0],i=r[1],a=r[2],s=r[3],c=r[4],u=r[5],l=r[6],p=r[7];this.getCorners(n,i,a,s,c,u,l,p);for(var f=0;8!==f;f++){var h=r[f];t.pointToWorld(h,h)}return e.setFromPoints(r)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,e,r){function ArrayCollisionMatrix(){this.matrix=[]}e.exports=ArrayCollisionMatrix,ArrayCollisionMatrix.prototype.get=function(t,e){if(t=t.index,(e=e.index)>t){var r=e;e=t,t=r}return this.matrix[(t*(t+1)>>1)+e-1]},ArrayCollisionMatrix.prototype.set=function(t,e,r){if(t=t.index,(e=e.index)>t){var n=e;e=t,t=n}this.matrix[(t*(t+1)>>1)+e-1]=r?1:0},ArrayCollisionMatrix.prototype.reset=function(){for(var t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0},ArrayCollisionMatrix.prototype.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1}},{}],5:[function(t,e,r){var n=t("../objects/Body"),i=t("../math/Vec3"),o=t("../math/Quaternion");function Broadphase(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}t("../shapes/Shape"),t("../shapes/Plane"),e.exports=Broadphase,Broadphase.prototype.collisionPairs=function(t,e,r){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var a=n.STATIC|n.KINEMATIC;Broadphase.prototype.needBroadphaseCollision=function(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&a)&&t.sleepState!==n.SLEEPING||0==(e.type&a)&&e.sleepState!==n.SLEEPING)},Broadphase.prototype.intersectionTest=function(t,e,r,n){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,r,n):this.doBoundingSphereBroadphase(t,e,r,n)};var s=new i;new i,new o,new i,Broadphase.prototype.doBoundingSphereBroadphase=function(t,e,r,n){var i=s;e.position.vsub(t.position,i);var o=Math.pow(t.boundingRadius+e.boundingRadius,2),a=i.norm2();a<o&&(r.push(t),n.push(e))},Broadphase.prototype.doBoundingBoxBroadphase=function(t,e,r,n){t.aabbNeedsUpdate&&t.computeAABB(),e.aabbNeedsUpdate&&e.computeAABB(),t.aabb.overlaps(e.aabb)&&(r.push(t),n.push(e))};var c={keys:[]},u=[],l=[];Broadphase.prototype.makePairsUnique=function(t,e){for(var r=c,n=u,i=l,o=t.length,a=0;a!==o;a++)n[a]=t[a],i[a]=e[a];t.length=0,e.length=0;for(var a=0;a!==o;a++){var s=n[a].id,p=i[a].id,f=s<p?s+","+p:p+","+s;r[f]=a,r.keys.push(f)}for(var a=0;a!==r.keys.length;a++){var f=r.keys.pop(),h=r[f];t.push(n[h]),e.push(i[h]),delete r[f]}},Broadphase.prototype.setWorld=function(t){};var p=new i;Broadphase.boundingSphereCheck=function(t,e){var r=p;return t.position.vsub(e.position,r),Math.pow(t.shape.boundingSphereRadius+e.shape.boundingSphereRadius,2)>r.norm2()},Broadphase.prototype.aabbQuery=function(t,e,r){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,e,r){e.exports=GridBroadphase;var n=t("./Broadphase"),i=t("../math/Vec3"),o=t("../shapes/Shape");function GridBroadphase(t,e,r,o,a){n.apply(this),this.nx=r||10,this.ny=o||10,this.nz=a||10,this.aabbMin=t||new i(100,100,100),this.aabbMax=e||new i(-100,-100,-100);var s=this.nx*this.ny*this.nz;if(s<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=s,this.binLengths.length=s;for(var c=0;c<s;c++)this.bins[c]=[],this.binLengths[c]=0}GridBroadphase.prototype=new n,GridBroadphase.prototype.constructor=GridBroadphase;var a=new i;new i,GridBroadphase.prototype.collisionPairs=function(t,e,r){for(var n=t.numObjects(),i=t.bodies,s=this.aabbMax,c=this.aabbMin,u=this.nx,l=this.ny,p=this.nz,f=l*p,h=p,d=1,y=s.x,m=s.y,v=s.z,g=c.x,_=c.y,b=c.z,w=u/(y-g),P=l/(m-_),x=p/(v-b),O=(y-g)/u,C=(m-_)/l,S=(v-b)/p,R=.5*Math.sqrt(O*O+C*C+S*S),j=o.types,T=j.SPHERE,E=j.PLANE,B=(j.BOX,j.COMPOUND,j.CONVEXPOLYHEDRON,this.bins),A=this.binLengths,I=this.bins.length,M=0;M!==I;M++)A[M]=0;var k=Math.ceil,c=Math.min,s=Math.max;function addBoxToBins(t,e,r,n,i,o,a){var s=(t-g)*w|0,c=(e-_)*P|0,y=(r-b)*x|0,m=k((n-g)*w),v=k((i-_)*P),O=k((o-b)*x);s<0?s=0:s>=u&&(s=u-1),c<0?c=0:c>=l&&(c=l-1),y<0?y=0:y>=p&&(y=p-1),m<0?m=0:m>=u&&(m=u-1),v<0?v=0:v>=l&&(v=l-1),O<0?O=0:O>=p&&(O=p-1),c*=h,y*=d,m*=f,v*=h,O*=d;for(var C=s*=f;C<=m;C+=f)for(var S=c;S<=v;S+=h)for(var R=y;R<=O;R+=d){var j=C+S+R;B[j][A[j]++]=a}}for(var M=0;M!==n;M++){var z=i[M],F=z.shape;switch(F.type){case T:var D=z.position.x,N=z.position.y,L=z.position.z,V=F.radius;addBoxToBins(D-V,N-V,L-V,D+V,N+V,L+V,z);break;case E:F.worldNormalNeedsUpdate&&F.computeWorldNormal(z.quaternion);var U=F.worldNormal,W=g+.5*O-z.position.x,q=_+.5*C-z.position.y,G=b+.5*S-z.position.z,H=a;H.set(W,q,G);for(var X=0,K=0;X!==u;X++,K+=f,H.y=q,H.x+=O)for(var Q=0,Y=0;Q!==l;Q++,Y+=h,H.z=G,H.y+=C)for(var Z=0,J=0;Z!==p;Z++,J+=d,H.z+=S)if(H.dot(U)<R){var $=K+Y+J;B[$][A[$]++]=z}break;default:z.aabbNeedsUpdate&&z.computeAABB(),addBoxToBins(z.aabb.lowerBound.x,z.aabb.lowerBound.y,z.aabb.lowerBound.z,z.aabb.upperBound.x,z.aabb.upperBound.y,z.aabb.upperBound.z,z)}}for(var M=0;M!==I;M++){var tt=A[M];if(tt>1)for(var et=B[M],X=0;X!==tt;X++)for(var z=et[X],Q=0;Q!==X;Q++){var rt=et[Q];this.needBroadphaseCollision(z,rt)&&this.intersectionTest(z,rt,e,r)}}this.makePairsUnique(e,r)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,e,r){e.exports=NaiveBroadphase;var n=t("./Broadphase"),i=t("./AABB");function NaiveBroadphase(){n.apply(this)}NaiveBroadphase.prototype=new n,NaiveBroadphase.prototype.constructor=NaiveBroadphase,NaiveBroadphase.prototype.collisionPairs=function(t,e,r){var n,i,o,a,s=t.bodies,c=s.length;for(n=0;n!==c;n++)for(i=0;i!==n;i++)o=s[n],a=s[i],this.needBroadphaseCollision(o,a)&&this.intersectionTest(o,a,e,r)},new i,NaiveBroadphase.prototype.aabbQuery=function(t,e,r){r=r||[];for(var n=0;n<t.bodies.length;n++){var i=t.bodies[n];i.aabbNeedsUpdate&&i.computeAABB(),i.aabb.overlaps(e)&&r.push(i)}return r}},{"./AABB":3,"./Broadphase":5}],8:[function(t,e,r){function ObjectCollisionMatrix(){this.matrix={}}e.exports=ObjectCollisionMatrix,ObjectCollisionMatrix.prototype.get=function(t,e){if(t=t.id,(e=e.id)>t){var r=e;e=t,t=r}return t+"-"+e in this.matrix},ObjectCollisionMatrix.prototype.set=function(t,e,r){if(t=t.id,(e=e.id)>t){var n=e;e=t,t=n}r?this.matrix[t+"-"+e]=!0:delete this.matrix[t+"-"+e]},ObjectCollisionMatrix.prototype.reset=function(){this.matrix={}},ObjectCollisionMatrix.prototype.setNumObjects=function(t){}},{}],9:[function(t,e,r){e.exports=Ray;var n=t("../math/Vec3"),i=t("../math/Quaternion"),o=t("../math/Transform"),a=(t("../shapes/ConvexPolyhedron"),t("../shapes/Box"),t("../collision/RaycastResult")),s=t("../shapes/Shape"),c=t("../collision/AABB");function Ray(t,e){this.from=t?t.clone():new n,this.to=e?e.clone():new n,this._direction=new n,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray.ANY,this.result=new a,this.hasHit=!1,this.callback=function(t){}}Ray.prototype.constructor=Ray,Ray.CLOSEST=1,Ray.ANY=2,Ray.ALL=4;var u=new c,l=[];Ray.prototype.intersectWorld=function(t,e){return this.mode=e.mode||Ray.ANY,this.result=e.result||new a,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(u),l.length=0,t.broadphase.aabbQuery(t,u,l),this.intersectBodies(l),this.hasHit};var p=new n,f=new n;function pointInTriangle(t,e,r,n){n.vsub(e,A),r.vsub(e,p),t.vsub(e,f);var i,o,a=A.dot(A),s=A.dot(p),c=A.dot(f),u=p.dot(p),l=p.dot(f);return(i=u*c-s*l)>=0&&(o=a*l-s*c)>=0&&i+o<a*u-s*s}Ray.pointInTriangle=pointInTriangle;var h=new n,d=new i;Ray.prototype.intersectBody=function(t,e){e&&(this.result=e,this._updateDirection());var r=this.checkCollisionResponse;if((!r||t.collisionResponse)&&0!=(this.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&this.collisionFilterMask))for(var n=h,i=d,o=0,a=t.shapes.length;o<a;o++){var s=t.shapes[o];if((!r||s.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[o],i),t.quaternion.vmult(t.shapeOffsets[o],n),n.vadd(t.position,n),this.intersectShape(s,i,n,t),this.result._shouldStop))break}},Ray.prototype.intersectBodies=function(t,e){e&&(this.result=e,this._updateDirection());for(var r=0,n=t.length;!this.result._shouldStop&&r<n;r++)this.intersectBody(t[r])},Ray.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},Ray.prototype.intersectShape=function(t,e,r,n){var i=this.from,o=function distanceFromIntersection(t,e,r){r.vsub(t,A);var n=A.dot(e);return e.mult(n,I),I.vadd(t,I),r.distanceTo(I)}(i,this._direction,r);if(!(o>t.boundingSphereRadius)){var a=this[t.type];a&&a.call(this,t,e,r,n)}},new n,new n;var y=new n,m=new n,v=new n,g=new n;new n,new a,Ray.prototype.intersectBox=function(t,e,r,n){return this.intersectConvex(t.convexPolyhedronRepresentation,e,r,n)},Ray.prototype[s.types.BOX]=Ray.prototype.intersectBox,Ray.prototype.intersectPlane=function(t,e,r,i){var o=this.from,a=this.to,s=this._direction,c=new n(0,0,1);e.vmult(c,c);var u=new n;o.vsub(r,u);var l=u.dot(c);a.vsub(r,u);var p=u.dot(c);if(!(l*p>0||o.distanceTo(a)<l)){var f=c.dot(s);if(!(Math.abs(f)<this.precision)){var h=new n,d=new n,y=new n;o.vsub(r,h);var m=-c.dot(h)/f;s.scale(m,d),o.vadd(d,y),this.reportIntersection(c,y,t,i,-1)}}},Ray.prototype[s.types.PLANE]=Ray.prototype.intersectPlane,Ray.prototype.getAABB=function(t){var e=this.to,r=this.from;t.lowerBound.x=Math.min(e.x,r.x),t.lowerBound.y=Math.min(e.y,r.y),t.lowerBound.z=Math.min(e.z,r.z),t.upperBound.x=Math.max(e.x,r.x),t.upperBound.y=Math.max(e.y,r.y),t.upperBound.z=Math.max(e.z,r.z)};var _={faceList:[0]};Ray.prototype.intersectHeightfield=function(t,e,r,i){t.data,t.elementSize;var a=new n,s=new Ray(this.from,this.to);o.pointToLocalFrame(r,e,s.from,s.from),o.pointToLocalFrame(r,e,s.to,s.to);var c=[],u=null,l=null,p=null,f=null,h=t.getIndexOfPosition(s.from.x,s.from.y,c,!1);if(h&&(u=c[0],l=c[1],p=c[0],f=c[1]),(h=t.getIndexOfPosition(s.to.x,s.to.y,c,!1))&&((null===u||c[0]<u)&&(u=c[0]),(null===p||c[0]>p)&&(p=c[0]),(null===l||c[1]<l)&&(l=c[1]),(null===f||c[1]>f)&&(f=c[1])),null!==u){var d=[];t.getRectMinMax(u,l,p,f,d);for(var y=u;y<=p;y++)for(var m=l;m<=f;m++){if(this.result._shouldStop)return;if(t.getConvexTrianglePillar(y,m,!1),o.pointToWorldFrame(r,e,t.pillarOffset,a),this.intersectConvex(t.pillarConvex,e,a,i,_),this.result._shouldStop)return;t.getConvexTrianglePillar(y,m,!0),o.pointToWorldFrame(r,e,t.pillarOffset,a),this.intersectConvex(t.pillarConvex,e,a,i,_)}}},Ray.prototype[s.types.HEIGHTFIELD]=Ray.prototype.intersectHeightfield;var b=new n,w=new n;Ray.prototype.intersectSphere=function(t,e,r,n){var i=this.from,o=this.to,a=t.radius,s=Math.pow(o.x-i.x,2)+Math.pow(o.y-i.y,2)+Math.pow(o.z-i.z,2),c=2*((o.x-i.x)*(i.x-r.x)+(o.y-i.y)*(i.y-r.y)+(o.z-i.z)*(i.z-r.z)),u=Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)+Math.pow(i.z-r.z,2)-Math.pow(a,2),l=Math.pow(c,2)-4*s*u,p=b,f=w;if(!(l<0))if(0===l)i.lerp(o,l,p),p.vsub(r,f),f.normalize(),this.reportIntersection(f,p,t,n,-1);else{var h=(-c-Math.sqrt(l))/(2*s),d=(-c+Math.sqrt(l))/(2*s);if(h>=0&&h<=1&&(i.lerp(o,h,p),p.vsub(r,f),f.normalize(),this.reportIntersection(f,p,t,n,-1)),this.result._shouldStop)return;d>=0&&d<=1&&(i.lerp(o,d,p),p.vsub(r,f),f.normalize(),this.reportIntersection(f,p,t,n,-1))}},Ray.prototype[s.types.SPHERE]=Ray.prototype.intersectSphere;var P=new n,x=(new n,new n,new n);Ray.prototype.intersectConvex=function intersectConvex(t,e,r,n,i){for(var o=P,a=x,s=i&&i.faceList||null,c=t.faces,u=t.vertices,l=t.faceNormals,p=this._direction,f=this.from,h=this.to,d=f.distanceTo(h),_=s?s.length:c.length,b=this.result,w=0;!b._shouldStop&&w<_;w++){var O=s?s[w]:w,C=c[O],S=l[O],R=e,j=r;a.copy(u[C[0]]),R.vmult(a,a),a.vadd(j,a),a.vsub(f,a),R.vmult(S,o);var T=p.dot(o);if(!(Math.abs(T)<this.precision)){var E=o.dot(a)/T;if(!(E<0)){p.mult(E,y),y.vadd(f,y),m.copy(u[C[0]]),R.vmult(m,m),j.vadd(m,m);for(var B=1;!b._shouldStop&&B<C.length-1;B++){v.copy(u[C[B]]),g.copy(u[C[B+1]]),R.vmult(v,v),R.vmult(g,g),j.vadd(v,v),j.vadd(g,g);var A=y.distanceTo(f);!pointInTriangle(y,m,v,g)&&!pointInTriangle(y,v,m,g)||A>d||this.reportIntersection(o,y,t,n,O)}}}}},Ray.prototype[s.types.CONVEXPOLYHEDRON]=Ray.prototype.intersectConvex;var O=new n,C=new n,S=new n,R=new n,j=new n,T=new n,E=(new c,[]),B=new o;Ray.prototype.intersectTrimesh=function intersectTrimesh(t,e,r,n,i){var a=O,s=E,c=B,u=x,l=C,p=S,f=R,h=T,d=j,_=(i&&i.faceList,t.indices),b=(t.vertices,t.faceNormals,this.from),w=this.to,P=this._direction;c.position.copy(r),c.quaternion.copy(e),o.vectorToLocalFrame(r,e,P,l),o.pointToLocalFrame(r,e,b,p),o.pointToLocalFrame(r,e,w,f);var A=p.distanceSquared(f);t.tree.rayQuery(this,c,s);for(var I=0,M=s.length;!this.result._shouldStop&&I!==M;I++){var k=s[I];t.getNormal(k,a),t.getVertex(_[3*k],m),m.vsub(p,u);var z=l.dot(a),F=a.dot(u)/z;if(!(F<0)){l.scale(F,y),y.vadd(p,y),t.getVertex(_[3*k+1],v),t.getVertex(_[3*k+2],g);var D=y.distanceSquared(p);!pointInTriangle(y,v,m,g)&&!pointInTriangle(y,m,v,g)||D>A||(o.vectorToWorldFrame(e,a,d),o.pointToWorldFrame(r,e,y,h),this.reportIntersection(d,h,t,n,k))}}s.length=0},Ray.prototype[s.types.TRIMESH]=Ray.prototype.intersectTrimesh,Ray.prototype.reportIntersection=function(t,e,r,n,i){var o=this.from,a=this.to,s=o.distanceTo(e),c=this.result;if(!(this.skipBackfaces&&t.dot(this._direction)>0))switch(c.hitFaceIndex=void 0!==i?i:-1,this.mode){case Ray.ALL:this.hasHit=!0,c.set(o,a,t,e,r,n,s),c.hasHit=!0,this.callback(c);break;case Ray.CLOSEST:(s<c.distance||!c.hasHit)&&(this.hasHit=!0,c.hasHit=!0,c.set(o,a,t,e,r,n,s));break;case Ray.ANY:this.hasHit=!0,c.hasHit=!0,c.set(o,a,t,e,r,n,s),c._shouldStop=!0}};var A=new n,I=new n},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,e,r){var n=t("../math/Vec3");function RaycastResult(){this.rayFromWorld=new n,this.rayToWorld=new n,this.hitNormalWorld=new n,this.hitPointWorld=new n,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}e.exports=RaycastResult,RaycastResult.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},RaycastResult.prototype.abort=function(){this._shouldStop=!0},RaycastResult.prototype.set=function(t,e,r,n,i,o,a){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(r),this.hitPointWorld.copy(n),this.shape=i,this.body=o,this.distance=a}},{"../math/Vec3":30}],11:[function(t,e,r){t("../shapes/Shape");var n=t("../collision/Broadphase");function SAPBroadphase(t){n.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var e=this.axisList;this._addBodyHandler=function(t){e.push(t.body)},this._removeBodyHandler=function(t){var r=e.indexOf(t.body);-1!==r&&e.splice(r,1)},t&&this.setWorld(t)}e.exports=SAPBroadphase,SAPBroadphase.prototype=new n,SAPBroadphase.prototype.setWorld=function(t){this.axisList.length=0;for(var e=0;e<t.bodies.length;e++)this.axisList.push(t.bodies[e]);t.removeEventListener("addBody",this._addBodyHandler),t.removeEventListener("removeBody",this._removeBodyHandler),t.addEventListener("addBody",this._addBodyHandler),t.addEventListener("removeBody",this._removeBodyHandler),this.world=t,this.dirty=!0},SAPBroadphase.insertionSortX=function(t){for(var e=1,r=t.length;e<r;e++){for(var n=t[e],i=e-1;i>=0&&!(t[i].aabb.lowerBound.x<=n.aabb.lowerBound.x);i--)t[i+1]=t[i];t[i+1]=n}return t},SAPBroadphase.insertionSortY=function(t){for(var e=1,r=t.length;e<r;e++){for(var n=t[e],i=e-1;i>=0&&!(t[i].aabb.lowerBound.y<=n.aabb.lowerBound.y);i--)t[i+1]=t[i];t[i+1]=n}return t},SAPBroadphase.insertionSortZ=function(t){for(var e=1,r=t.length;e<r;e++){for(var n=t[e],i=e-1;i>=0&&!(t[i].aabb.lowerBound.z<=n.aabb.lowerBound.z);i--)t[i+1]=t[i];t[i+1]=n}return t},SAPBroadphase.prototype.collisionPairs=function(t,e,r){var n,i,o=this.axisList,a=o.length,s=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),n=0;n!==a;n++){var c=o[n];for(i=n+1;i<a;i++){var u=o[i];if(this.needBroadphaseCollision(c,u)){if(!SAPBroadphase.checkBounds(c,u,s))break;this.intersectionTest(c,u,e,r)}}}},SAPBroadphase.prototype.sortList=function(){for(var t=this.axisList,e=this.axisIndex,r=t.length,n=0;n!==r;n++){var i=t[n];i.aabbNeedsUpdate&&i.computeAABB()}0===e?SAPBroadphase.insertionSortX(t):1===e?SAPBroadphase.insertionSortY(t):2===e&&SAPBroadphase.insertionSortZ(t)},SAPBroadphase.checkBounds=function(t,e,r){var n,i;0===r?(n=t.position.x,i=e.position.x):1===r?(n=t.position.y,i=e.position.y):2===r&&(n=t.position.z,i=e.position.z);var o=t.boundingRadius,a=e.boundingRadius,s=n+o,c=i-a;return c<s},SAPBroadphase.prototype.autoDetectAxis=function(){for(var t=0,e=0,r=0,n=0,i=0,o=0,a=this.axisList,s=a.length,c=1/s,u=0;u!==s;u++){var l=a[u],p=l.position.x;t+=p,e+=p*p;var f=l.position.y;r+=f,n+=f*f;var h=l.position.z;i+=h,o+=h*h}var d=e-t*t*c,y=n-r*r*c,m=o-i*i*c;this.axisIndex=d>y?d>m?0:2:y>m?1:2},SAPBroadphase.prototype.aabbQuery=function(t,e,r){r=r||[],this.dirty&&(this.sortList(),this.dirty=!1);var n=this.axisIndex,i="x";1===n&&(i="y"),2===n&&(i="z");for(var o=this.axisList,a=(e.lowerBound[i],e.upperBound[i],0);a<o.length;a++){var s=o[a];s.aabbNeedsUpdate&&s.computeAABB(),s.aabb.overlaps(e)&&r.push(s)}return r}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,e,r){e.exports=ConeTwistConstraint,t("./Constraint");var n=t("./PointToPointConstraint"),i=t("../equations/ConeEquation"),o=t("../equations/RotationalEquation"),a=(t("../equations/ContactEquation"),t("../math/Vec3"));function ConeTwistConstraint(t,e,r){var s=void 0!==(r=r||{}).maxForce?r.maxForce:1e6,c=r.pivotA?r.pivotA.clone():new a,u=r.pivotB?r.pivotB.clone():new a;this.axisA=r.axisA?r.axisA.clone():new a,this.axisB=r.axisB?r.axisB.clone():new a,n.call(this,t,c,e,u,s),this.collideConnected=!!r.collideConnected,this.angle=void 0!==r.angle?r.angle:0;var l=this.coneEquation=new i(t,e,r),p=this.twistEquation=new o(t,e,r);this.twistAngle=void 0!==r.twistAngle?r.twistAngle:0,l.maxForce=0,l.minForce=-s,p.maxForce=0,p.minForce=-s,this.equations.push(l,p)}ConeTwistConstraint.prototype=new n,ConeTwistConstraint.constructor=ConeTwistConstraint,new a,new a,ConeTwistConstraint.prototype.update=function(){var t=this.bodyA,e=this.bodyB,r=this.coneEquation,i=this.twistEquation;n.prototype.update.call(this),t.vectorToWorldFrame(this.axisA,r.axisA),e.vectorToWorldFrame(this.axisB,r.axisB),this.axisA.tangents(i.axisA,i.axisA),t.vectorToWorldFrame(i.axisA,i.axisA),this.axisB.tangents(i.axisB,i.axisB),e.vectorToWorldFrame(i.axisB,i.axisB),r.angle=this.angle,i.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,e,r){e.exports=Constraint;var n=t("../utils/Utils");function Constraint(t,e,r){r=n.defaults(r,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=Constraint.idCounter++,this.collideConnected=r.collideConnected,r.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}Constraint.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},Constraint.prototype.enable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!0},Constraint.prototype.disable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!1},Constraint.idCounter=0},{"../utils/Utils":53}],14:[function(t,e,r){e.exports=DistanceConstraint;var n=t("./Constraint"),i=t("../equations/ContactEquation");function DistanceConstraint(t,e,r,o){n.call(this,t,e),void 0===r&&(r=t.position.distanceTo(e.position)),void 0===o&&(o=1e6),this.distance=r;var a=this.distanceEquation=new i(t,e);this.equations.push(a),a.minForce=-o,a.maxForce=o}DistanceConstraint.prototype=new n,DistanceConstraint.prototype.update=function(){var t=this.bodyA,e=this.bodyB,r=this.distanceEquation,n=.5*this.distance,i=r.ni;e.position.vsub(t.position,i),i.normalize(),i.mult(n,r.ri),i.mult(-n,r.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,e,r){e.exports=HingeConstraint,t("./Constraint");var n=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation"),o=t("../equations/RotationalMotorEquation"),a=(t("../equations/ContactEquation"),t("../math/Vec3"));function HingeConstraint(t,e,r){var s=void 0!==(r=r||{}).maxForce?r.maxForce:1e6,c=r.pivotA?r.pivotA.clone():new a,u=r.pivotB?r.pivotB.clone():new a;n.call(this,t,c,e,u,s);var l=this.axisA=r.axisA?r.axisA.clone():new a(1,0,0);l.normalize();var p=this.axisB=r.axisB?r.axisB.clone():new a(1,0,0);p.normalize();var f=this.rotationalEquation1=new i(t,e,r),h=this.rotationalEquation2=new i(t,e,r),d=this.motorEquation=new o(t,e,s);d.enabled=!1,this.equations.push(f,h,d)}HingeConstraint.prototype=new n,HingeConstraint.constructor=HingeConstraint,HingeConstraint.prototype.enableMotor=function(){this.motorEquation.enabled=!0},HingeConstraint.prototype.disableMotor=function(){this.motorEquation.enabled=!1},HingeConstraint.prototype.setMotorSpeed=function(t){this.motorEquation.targetVelocity=t},HingeConstraint.prototype.setMotorMaxForce=function(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t};var s=new a,c=new a;HingeConstraint.prototype.update=function(){var t=this.bodyA,e=this.bodyB,r=this.motorEquation,i=this.rotationalEquation1,o=this.rotationalEquation2,a=s,u=c,l=this.axisA,p=this.axisB;n.prototype.update.call(this),t.quaternion.vmult(l,a),e.quaternion.vmult(p,u),a.tangents(i.axisA,o.axisA),i.axisB.copy(u),o.axisB.copy(u),this.motorEquation.enabled&&(t.quaternion.vmult(this.axisA,r.axisA),e.quaternion.vmult(this.axisB,r.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,e,r){e.exports=LockConstraint,t("./Constraint");var n=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation"),o=(t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation"),t("../math/Vec3"));function LockConstraint(t,e,r){var a=void 0!==(r=r||{}).maxForce?r.maxForce:1e6,s=new o,c=new o,u=new o;t.position.vadd(e.position,u),u.scale(.5,u),e.pointToLocalFrame(u,c),t.pointToLocalFrame(u,s),n.call(this,t,s,e,c,a);var l=this.rotationalEquation1=new i(t,e,r),p=this.rotationalEquation2=new i(t,e,r),f=this.rotationalEquation3=new i(t,e,r);this.equations.push(l,p,f)}LockConstraint.prototype=new n,LockConstraint.constructor=LockConstraint,new o,new o,LockConstraint.prototype.update=function(){var t=this.bodyA,e=this.bodyB,r=(this.motorEquation,this.rotationalEquation1),i=this.rotationalEquation2,a=this.rotationalEquation3;n.prototype.update.call(this),t.vectorToWorldFrame(o.UNIT_X,r.axisA),e.vectorToWorldFrame(o.UNIT_Y,r.axisB),t.vectorToWorldFrame(o.UNIT_Y,i.axisA),e.vectorToWorldFrame(o.UNIT_Z,i.axisB),t.vectorToWorldFrame(o.UNIT_Z,a.axisA),e.vectorToWorldFrame(o.UNIT_X,a.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,e,r){e.exports=PointToPointConstraint;var n=t("./Constraint"),i=t("../equations/ContactEquation"),o=t("../math/Vec3");function PointToPointConstraint(t,e,r,a,s){n.call(this,t,r),s=void 0!==s?s:1e6,this.pivotA=e?e.clone():new o,this.pivotB=a?a.clone():new o;var c=this.equationX=new i(t,r),u=this.equationY=new i(t,r),l=this.equationZ=new i(t,r);this.equations.push(c,u,l),c.minForce=u.minForce=l.minForce=-s,c.maxForce=u.maxForce=l.maxForce=s,c.ni.set(1,0,0),u.ni.set(0,1,0),l.ni.set(0,0,1)}PointToPointConstraint.prototype=new n,PointToPointConstraint.prototype.update=function(){var t=this.bodyA,e=this.bodyB,r=this.equationX,n=this.equationY,i=this.equationZ;t.quaternion.vmult(this.pivotA,r.ri),e.quaternion.vmult(this.pivotB,r.rj),n.ri.copy(r.ri),n.rj.copy(r.rj),i.ri.copy(r.ri),i.rj.copy(r.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,e,r){e.exports=ConeEquation;var n=t("../math/Vec3"),i=(t("../math/Mat3"),t("./Equation"));function ConeEquation(t,e,r){var o=void 0!==(r=r||{}).maxForce?r.maxForce:1e6;i.call(this,t,e,-o,o),this.axisA=r.axisA?r.axisA.clone():new n(1,0,0),this.axisB=r.axisB?r.axisB.clone():new n(0,1,0),this.angle=void 0!==r.angle?r.angle:0}ConeEquation.prototype=new i,ConeEquation.prototype.constructor=ConeEquation;var o=new n,a=new n;ConeEquation.prototype.computeB=function(t){var e=this.a,r=this.b,n=this.axisA,i=this.axisB,s=o,c=a,u=this.jacobianElementA,l=this.jacobianElementB;n.cross(i,s),i.cross(n,c),u.rotational.copy(c),l.rotational.copy(s);var p=Math.cos(this.angle)-n.dot(i),f=this.computeGW(),h=this.computeGiMf(),d=-p*e-f*r-t*h;return d}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,e,r){e.exports=ContactEquation;var n=t("./Equation"),i=t("../math/Vec3");function ContactEquation(t,e,r){r=void 0!==r?r:1e6,n.call(this,t,e,0,r),this.restitution=0,this.ri=new i,this.rj=new i,this.ni=new i}t("../math/Mat3"),ContactEquation.prototype=new n,ContactEquation.prototype.constructor=ContactEquation;var o=new i,a=new i,s=new i;ContactEquation.prototype.computeB=function(t){var e=this.a,r=this.b,n=this.bi,i=this.bj,c=this.ri,u=this.rj,l=o,p=a,f=n.velocity,h=n.angularVelocity,d=(n.force,n.torque,i.velocity),y=i.angularVelocity,m=(i.force,i.torque,s),v=this.jacobianElementA,g=this.jacobianElementB,_=this.ni;c.cross(_,l),u.cross(_,p),_.negate(v.spatial),l.negate(v.rotational),g.spatial.copy(_),g.rotational.copy(p),m.copy(i.position),m.vadd(u,m),m.vsub(n.position,m),m.vsub(c,m);var b=_.dot(m),w=this.restitution+1,P=w*d.dot(_)-w*f.dot(_)+y.dot(p)-h.dot(l),x=this.computeGiMf(),O=-b*e-P*r-t*x;return O};var c=new i,u=new i,l=new i,p=new i,f=new i;ContactEquation.prototype.getImpactVelocityAlongNormal=function(){var t=c,e=u,r=l,n=p,i=f;return this.bi.position.vadd(this.ri,r),this.bj.position.vadd(this.rj,n),this.bi.getVelocityAtWorldPoint(r,t),this.bj.getVelocityAtWorldPoint(n,e),t.vsub(e,i),this.ni.dot(i)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,e,r){e.exports=Equation;var n=t("../math/JacobianElement"),i=t("../math/Vec3");function Equation(t,e,r,i){this.id=Equation.id++,this.minForce=void 0===r?-1e6:r,this.maxForce=void 0===i?1e6:i,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new n,this.jacobianElementB=new n,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}Equation.prototype.constructor=Equation,Equation.id=0,Equation.prototype.setSpookParams=function(t,e,r){var n=e,i=t,o=r;this.a=4/(o*(1+4*n)),this.b=4*n/(1+4*n),this.eps=4/(o*o*i*(1+4*n))},Equation.prototype.computeB=function(t,e,r){var n=this.computeGW(),i=this.computeGq(),o=this.computeGiMf();return-i*t-n*e-o*r},Equation.prototype.computeGq=function(){var t=this.jacobianElementA,e=this.jacobianElementB,r=this.bi,n=this.bj,i=r.position,o=n.position;return t.spatial.dot(i)+e.spatial.dot(o)};var o=new i;Equation.prototype.computeGW=function(){var t=this.jacobianElementA,e=this.jacobianElementB,r=this.bi,n=this.bj,i=r.velocity,a=n.velocity,s=r.angularVelocity||o,c=n.angularVelocity||o;return t.multiplyVectors(i,s)+e.multiplyVectors(a,c)},Equation.prototype.computeGWlambda=function(){var t=this.jacobianElementA,e=this.jacobianElementB,r=this.bi,n=this.bj,i=r.vlambda,a=n.vlambda,s=r.wlambda||o,c=n.wlambda||o;return t.multiplyVectors(i,s)+e.multiplyVectors(a,c)};var a=new i,s=new i,c=new i,u=new i;Equation.prototype.computeGiMf=function(){var t=this.jacobianElementA,e=this.jacobianElementB,r=this.bi,n=this.bj,i=r.force,o=r.torque,l=n.force,p=n.torque,f=r.invMassSolve,h=n.invMassSolve;return r.invInertiaWorldSolve?r.invInertiaWorldSolve.vmult(o,c):c.set(0,0,0),n.invInertiaWorldSolve?n.invInertiaWorldSolve.vmult(p,u):u.set(0,0,0),i.mult(f,a),l.mult(h,s),t.multiplyVectors(a,c)+e.multiplyVectors(s,u)};var l=new i;Equation.prototype.computeGiMGt=function(){var t=this.jacobianElementA,e=this.jacobianElementB,r=this.bi,n=this.bj,i=r.invMassSolve,o=n.invMassSolve,a=r.invInertiaWorldSolve,s=n.invInertiaWorldSolve,c=i+o;return a&&(a.vmult(t.rotational,l),c+=l.dot(t.rotational)),s&&(s.vmult(e.rotational,l),c+=l.dot(e.rotational)),c};var p=new i;new i,new i,new i,new i,new i,Equation.prototype.addToWlambda=function(t){var e=this.jacobianElementA,r=this.jacobianElementB,n=this.bi,i=this.bj,o=p;e.spatial.mult(n.invMassSolve*t,o),n.vlambda.vadd(o,n.vlambda),r.spatial.mult(i.invMassSolve*t,o),i.vlambda.vadd(o,i.vlambda),n.invInertiaWorldSolve&&(n.invInertiaWorldSolve.vmult(e.rotational,o),o.mult(t,o),n.wlambda.vadd(o,n.wlambda)),i.invInertiaWorldSolve&&(i.invInertiaWorldSolve.vmult(r.rotational,o),o.mult(t,o),i.wlambda.vadd(o,i.wlambda))},Equation.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,e,r){e.exports=FrictionEquation;var n=t("./Equation"),i=t("../math/Vec3");function FrictionEquation(t,e,r){n.call(this,t,e,-r,r),this.ri=new i,this.rj=new i,this.t=new i}t("../math/Mat3"),FrictionEquation.prototype=new n,FrictionEquation.prototype.constructor=FrictionEquation;var o=new i,a=new i;FrictionEquation.prototype.computeB=function(t){this.a;var e=this.b,r=(this.bi,this.bj,this.ri),n=this.rj,i=o,s=a,c=this.t;r.cross(c,i),n.cross(c,s);var u=this.jacobianElementA,l=this.jacobianElementB;c.negate(u.spatial),i.negate(u.rotational),l.spatial.copy(c),l.rotational.copy(s);var p=this.computeGW(),f=this.computeGiMf(),h=-p*e-t*f;return h}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,e,r){e.exports=RotationalEquation;var n=t("../math/Vec3"),i=(t("../math/Mat3"),t("./Equation"));function RotationalEquation(t,e,r){var o=void 0!==(r=r||{}).maxForce?r.maxForce:1e6;i.call(this,t,e,-o,o),this.axisA=r.axisA?r.axisA.clone():new n(1,0,0),this.axisB=r.axisB?r.axisB.clone():new n(0,1,0),this.maxAngle=Math.PI/2}RotationalEquation.prototype=new i,RotationalEquation.prototype.constructor=RotationalEquation;var o=new n,a=new n;RotationalEquation.prototype.computeB=function(t){var e=this.a,r=this.b,n=this.axisA,i=this.axisB,s=o,c=a,u=this.jacobianElementA,l=this.jacobianElementB;n.cross(i,s),i.cross(n,c),u.rotational.copy(c),l.rotational.copy(s);var p=Math.cos(this.maxAngle)-n.dot(i),f=this.computeGW(),h=this.computeGiMf(),d=-p*e-f*r-t*h;return d}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,e,r){e.exports=RotationalMotorEquation;var n=t("../math/Vec3"),i=(t("../math/Mat3"),t("./Equation"));function RotationalMotorEquation(t,e,r){r=void 0!==r?r:1e6,i.call(this,t,e,-r,r),this.axisA=new n,this.axisB=new n,this.targetVelocity=0}RotationalMotorEquation.prototype=new i,RotationalMotorEquation.prototype.constructor=RotationalMotorEquation,RotationalMotorEquation.prototype.computeB=function(t){this.a;var e=this.b,r=(this.bi,this.bj,this.axisA),n=this.axisB,i=this.jacobianElementA,o=this.jacobianElementB;i.rotational.copy(r),n.negate(o.rotational);var a=this.computeGW()-this.targetVelocity,s=this.computeGiMf(),c=-a*e-t*s;return c}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,e,r){var n=t("../utils/Utils");function ContactMaterial(t,e,r){r=n.defaults(r,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=ContactMaterial.idCounter++,this.materials=[t,e],this.friction=r.friction,this.restitution=r.restitution,this.contactEquationStiffness=r.contactEquationStiffness,this.contactEquationRelaxation=r.contactEquationRelaxation,this.frictionEquationStiffness=r.frictionEquationStiffness,this.frictionEquationRelaxation=r.frictionEquationRelaxation}e.exports=ContactMaterial,ContactMaterial.idCounter=0},{"../utils/Utils":53}],25:[function(t,e,r){function Material(t){var e="";"string"==typeof(t=t||{})?(e=t,t={}):"object"==typeof t&&(e=""),this.name=e,this.id=Material.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}e.exports=Material,Material.idCounter=0},{}],26:[function(t,e,r){e.exports=JacobianElement;var n=t("./Vec3");function JacobianElement(){this.spatial=new n,this.rotational=new n}JacobianElement.prototype.multiplyElement=function(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)},JacobianElement.prototype.multiplyVectors=function(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,e,r){e.exports=Mat3;var n=t("./Vec3");function Mat3(t){this.elements=t||[0,0,0,0,0,0,0,0,0]}Mat3.prototype.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},Mat3.prototype.setZero=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0},Mat3.prototype.setTrace=function(t){var e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z},Mat3.prototype.getTrace=function(t){var t=t||new n,e=this.elements;t.x=e[0],t.y=e[4],t.z=e[8]},Mat3.prototype.vmult=function(t,e){e=e||new n;var r=this.elements,i=t.x,o=t.y,a=t.z;return e.x=r[0]*i+r[1]*o+r[2]*a,e.y=r[3]*i+r[4]*o+r[5]*a,e.z=r[6]*i+r[7]*o+r[8]*a,e},Mat3.prototype.smult=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]*=t},Mat3.prototype.mmult=function(t,e){for(var r=e||new Mat3,n=0;n<3;n++)for(var i=0;i<3;i++){for(var o=0,a=0;a<3;a++)o+=t.elements[n+3*a]*this.elements[a+3*i];r.elements[n+3*i]=o}return r},Mat3.prototype.scale=function(t,e){e=e||new Mat3;for(var r=this.elements,n=e.elements,i=0;3!==i;i++)n[3*i+0]=t.x*r[3*i+0],n[3*i+1]=t.y*r[3*i+1],n[3*i+2]=t.z*r[3*i+2];return e},Mat3.prototype.solve=function(t,e){e=e||new n;for(var r,i=[],o=0;o<12;o++)i.push(0);for(o=0;o<3;o++)for(r=0;r<3;r++)i[o+4*r]=this.elements[o+3*r];i[3]=t.x,i[7]=t.y,i[11]=t.z;var a,s,c=3,u=c;do{if(0===i[(o=u-c)+4*o])for(r=o+1;r<u;r++)if(0!==i[o+4*r]){a=4;do{i[(s=4-a)+4*o]+=i[s+4*r]}while(--a);break}if(0!==i[o+4*o])for(r=o+1;r<u;r++){var l=i[o+4*r]/i[o+4*o];a=4;do{i[(s=4-a)+4*r]=s<=o?0:i[s+4*r]-i[s+4*o]*l}while(--a)}}while(--c);if(e.z=i[11]/i[10],e.y=(i[7]-i[6]*e.z)/i[5],e.x=(i[3]-i[2]*e.z-i[1]*e.y)/i[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw"Could not solve equation! Got x=["+e.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]";return e},Mat3.prototype.e=function(t,e,r){if(void 0===r)return this.elements[e+3*t];this.elements[e+3*t]=r},Mat3.prototype.copy=function(t){for(var e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this},Mat3.prototype.toString=function(){for(var t="",e=0;e<9;e++)t+=this.elements[e]+",";return t},Mat3.prototype.reverse=function(t){t=t||new Mat3;for(var e,r=[],n=0;n<18;n++)r.push(0);for(n=0;n<3;n++)for(e=0;e<3;e++)r[n+6*e]=this.elements[n+3*e];r[3]=1,r[9]=0,r[15]=0,r[4]=0,r[10]=1,r[16]=0,r[5]=0,r[11]=0,r[17]=1;var i,o,a=3,s=a;do{if(0===r[(n=s-a)+6*n])for(e=n+1;e<s;e++)if(0!==r[n+6*e]){i=6;do{r[(o=6-i)+6*n]+=r[o+6*e]}while(--i);break}if(0!==r[n+6*n])for(e=n+1;e<s;e++){var c=r[n+6*e]/r[n+6*n];i=6;do{r[(o=6-i)+6*e]=o<=n?0:r[o+6*e]-r[o+6*n]*c}while(--i)}}while(--a);n=2;do{e=n-1;do{var c=r[n+6*e]/r[n+6*n];i=6;do{r[(o=6-i)+6*e]=r[o+6*e]-r[o+6*n]*c}while(--i)}while(e--)}while(--n);n=2;do{var c=1/r[n+6*n];i=6;do{r[(o=6-i)+6*n]=r[o+6*n]*c}while(--i)}while(n--);n=2;do{e=2;do{if(o=r[3+e+6*n],isNaN(o)||o===1/0)throw"Could not reverse! A=["+this.toString()+"]";t.e(n,e,o)}while(e--)}while(n--);return t},Mat3.prototype.setRotationFromQuaternion=function(t){var e=t.x,r=t.y,n=t.z,i=t.w,o=e+e,a=r+r,s=n+n,c=e*o,u=e*a,l=e*s,p=r*a,f=r*s,h=n*s,d=i*o,y=i*a,m=i*s,v=this.elements;return v[0]=1-(p+h),v[1]=u-m,v[2]=l+y,v[3]=u+m,v[4]=1-(c+h),v[5]=f-d,v[6]=l-y,v[7]=f+d,v[8]=1-(c+p),this},Mat3.prototype.transpose=function(t){for(var e=(t=t||new Mat3).elements,r=this.elements,n=0;3!==n;n++)for(var i=0;3!==i;i++)e[3*n+i]=r[3*i+n];return t}},{"./Vec3":30}],28:[function(t,e,r){e.exports=Quaternion;var n=t("./Vec3");function Quaternion(t,e,r,n){this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==r?r:0,this.w=void 0!==n?n:1}Quaternion.prototype.set=function(t,e,r,n){this.x=t,this.y=e,this.z=r,this.w=n},Quaternion.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},Quaternion.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},Quaternion.prototype.setFromAxisAngle=function(t,e){var r=Math.sin(.5*e);this.x=t.x*r,this.y=t.y*r,this.z=t.z*r,this.w=Math.cos(.5*e)},Quaternion.prototype.toAxisAngle=function(t){t=t||new n,this.normalize();var e=2*Math.acos(this.w),r=Math.sqrt(1-this.w*this.w);return r<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/r,t.y=this.y/r,t.z=this.z/r),[t,e]};var i=new n,o=new n;Quaternion.prototype.setFromVectors=function(t,e){if(t.isAntiparallelTo(e)){var r=i,n=o;t.tangents(r,n),this.setFromAxisAngle(r,Math.PI)}else{var a=t.cross(e);this.x=a.x,this.y=a.y,this.z=a.z,this.w=Math.sqrt(Math.pow(t.norm(),2)*Math.pow(e.norm(),2))+t.dot(e),this.normalize()}};var a=new n,s=new n,c=new n;Quaternion.prototype.mult=function(t,e){e=e||new Quaternion;var r=this.w,n=a,i=s,o=c;return n.set(this.x,this.y,this.z),i.set(t.x,t.y,t.z),e.w=r*t.w-n.dot(i),n.cross(i,o),e.x=r*i.x+t.w*n.x+o.x,e.y=r*i.y+t.w*n.y+o.y,e.z=r*i.z+t.w*n.z+o.z,e},Quaternion.prototype.inverse=function(t){var e=this.x,r=this.y,n=this.z,i=this.w;t=t||new Quaternion,this.conjugate(t);var o=1/(e*e+r*r+n*n+i*i);return t.x*=o,t.y*=o,t.z*=o,t.w*=o,t},Quaternion.prototype.conjugate=function(t){return(t=t||new Quaternion).x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t},Quaternion.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t)},Quaternion.prototype.normalizeFast=function(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t)},Quaternion.prototype.vmult=function(t,e){e=e||new n;var r=t.x,i=t.y,o=t.z,a=this.x,s=this.y,c=this.z,u=this.w,l=u*r+s*o-c*i,p=u*i+c*r-a*o,f=u*o+a*i-s*r,h=-a*r-s*i-c*o;return e.x=l*u+h*-a+p*-c-f*-s,e.y=p*u+h*-s+f*-a-l*-c,e.z=f*u+h*-c+l*-s-p*-a,e},Quaternion.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},Quaternion.prototype.toEuler=function(t,e){var r,n,i;e=e||"YZX";var o=this.x,a=this.y,s=this.z,c=this.w;switch(e){case"YZX":var u=o*a+s*c;if(u>.499&&(r=2*Math.atan2(o,c),n=Math.PI/2,i=0),u<-.499&&(r=-2*Math.atan2(o,c),n=-Math.PI/2,i=0),isNaN(r)){var l=o*o,p=a*a,f=s*s;r=Math.atan2(2*a*c-2*o*s,1-2*p-2*f),n=Math.asin(2*u),i=Math.atan2(2*o*c-2*a*s,1-2*l-2*f)}break;default:throw new Error("Euler order "+e+" not supported yet.")}t.y=r,t.z=n,t.x=i},Quaternion.prototype.setFromEuler=function(t,e,r,n){n=n||"XYZ";var i=Math.cos(t/2),o=Math.cos(e/2),a=Math.cos(r/2),s=Math.sin(t/2),c=Math.sin(e/2),u=Math.sin(r/2);return"XYZ"===n?(this.x=s*o*a+i*c*u,this.y=i*c*a-s*o*u,this.z=i*o*u+s*c*a,this.w=i*o*a-s*c*u):"YXZ"===n?(this.x=s*o*a+i*c*u,this.y=i*c*a-s*o*u,this.z=i*o*u-s*c*a,this.w=i*o*a+s*c*u):"ZXY"===n?(this.x=s*o*a-i*c*u,this.y=i*c*a+s*o*u,this.z=i*o*u+s*c*a,this.w=i*o*a-s*c*u):"ZYX"===n?(this.x=s*o*a-i*c*u,this.y=i*c*a+s*o*u,this.z=i*o*u-s*c*a,this.w=i*o*a+s*c*u):"YZX"===n?(this.x=s*o*a+i*c*u,this.y=i*c*a+s*o*u,this.z=i*o*u-s*c*a,this.w=i*o*a-s*c*u):"XZY"===n&&(this.x=s*o*a-i*c*u,this.y=i*c*a-s*o*u,this.z=i*o*u+s*c*a,this.w=i*o*a+s*c*u),this},Quaternion.prototype.clone=function(){return new Quaternion(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,e,r){var n=t("./Vec3"),i=t("./Quaternion");function Transform(t){t=t||{},this.position=new n,t.position&&this.position.copy(t.position),this.quaternion=new i,t.quaternion&&this.quaternion.copy(t.quaternion)}e.exports=Transform;var o=new i;Transform.pointToLocalFrame=function(t,e,r,i){var i=i||new n;return r.vsub(t,i),e.conjugate(o),o.vmult(i,i),i},Transform.prototype.pointToLocal=function(t,e){return Transform.pointToLocalFrame(this.position,this.quaternion,t,e)},Transform.pointToWorldFrame=function(t,e,r,i){var i=i||new n;return e.vmult(r,i),i.vadd(t,i),i},Transform.prototype.pointToWorld=function(t,e){return Transform.pointToWorldFrame(this.position,this.quaternion,t,e)},Transform.prototype.vectorToWorldFrame=function(t,e){var e=e||new n;return this.quaternion.vmult(t,e),e},Transform.vectorToWorldFrame=function(t,e,r){return t.vmult(e,r),r},Transform.vectorToLocalFrame=function(t,e,r,i){var i=i||new n;return e.w*=-1,e.vmult(r,i),e.w*=-1,i}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,e,r){e.exports=Vec3;var n=t("./Mat3");function Vec3(t,e,r){this.x=t||0,this.y=e||0,this.z=r||0}Vec3.ZERO=new Vec3(0,0,0),Vec3.UNIT_X=new Vec3(1,0,0),Vec3.UNIT_Y=new Vec3(0,1,0),Vec3.UNIT_Z=new Vec3(0,0,1),Vec3.prototype.cross=function(t,e){var r=t.x,n=t.y,i=t.z,o=this.x,a=this.y,s=this.z;return(e=e||new Vec3).x=a*i-s*n,e.y=s*r-o*i,e.z=o*n-a*r,e},Vec3.prototype.set=function(t,e,r){return this.x=t,this.y=e,this.z=r,this},Vec3.prototype.setZero=function(){this.x=this.y=this.z=0},Vec3.prototype.vadd=function(t,e){if(!e)return new Vec3(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z},Vec3.prototype.vsub=function(t,e){if(!e)return new Vec3(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z},Vec3.prototype.crossmat=function(){return new n([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},Vec3.prototype.normalize=function(){var t=this.x,e=this.y,r=this.z,n=Math.sqrt(t*t+e*e+r*r);if(n>0){var i=1/n;this.x*=i,this.y*=i,this.z*=i}else this.x=0,this.y=0,this.z=0;return n},Vec3.prototype.unit=function(t){t=t||new Vec3;var e=this.x,r=this.y,n=this.z,i=Math.sqrt(e*e+r*r+n*n);return i>0?(i=1/i,t.x=e*i,t.y=r*i,t.z=n*i):(t.x=1,t.y=0,t.z=0),t},Vec3.prototype.norm=function(){var t=this.x,e=this.y,r=this.z;return Math.sqrt(t*t+e*e+r*r)},Vec3.prototype.length=Vec3.prototype.norm,Vec3.prototype.norm2=function(){return this.dot(this)},Vec3.prototype.lengthSquared=Vec3.prototype.norm2,Vec3.prototype.distanceTo=function(t){var e=this.x,r=this.y,n=this.z,i=t.x,o=t.y,a=t.z;return Math.sqrt((i-e)*(i-e)+(o-r)*(o-r)+(a-n)*(a-n))},Vec3.prototype.distanceSquared=function(t){var e=this.x,r=this.y,n=this.z,i=t.x,o=t.y,a=t.z;return(i-e)*(i-e)+(o-r)*(o-r)+(a-n)*(a-n)},Vec3.prototype.mult=function(t,e){e=e||new Vec3;var r=this.x,n=this.y,i=this.z;return e.x=t*r,e.y=t*n,e.z=t*i,e},Vec3.prototype.scale=Vec3.prototype.mult,Vec3.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},Vec3.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},Vec3.prototype.negate=function(t){return(t=t||new Vec3).x=-this.x,t.y=-this.y,t.z=-this.z,t};var i=new Vec3,o=new Vec3;Vec3.prototype.tangents=function(t,e){var r=this.norm();if(r>0){var n=i,a=1/r;n.set(this.x*a,this.y*a,this.z*a);var s=o;Math.abs(n.x)<.9?(s.set(1,0,0),n.cross(s,t)):(s.set(0,1,0),n.cross(s,t)),n.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)},Vec3.prototype.toString=function(){return this.x+","+this.y+","+this.z},Vec3.prototype.toArray=function(){return[this.x,this.y,this.z]},Vec3.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},Vec3.prototype.lerp=function(t,e,r){var n=this.x,i=this.y,o=this.z;r.x=n+(t.x-n)*e,r.y=i+(t.y-i)*e,r.z=o+(t.z-o)*e},Vec3.prototype.almostEquals=function(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)},Vec3.prototype.almostZero=function(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)};var a=new Vec3;Vec3.prototype.isAntiparallelTo=function(t,e){return this.negate(a),a.almostEquals(t,e)},Vec3.prototype.clone=function(){return new Vec3(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,e,r){e.exports=Body;var n=t("../utils/EventTarget"),i=(t("../shapes/Shape"),t("../math/Vec3")),o=t("../math/Mat3"),a=t("../math/Quaternion"),s=(t("../material/Material"),t("../collision/AABB")),c=t("../shapes/Box");function Body(t){t=t||{},n.apply(this),this.id=Body.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new i,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:1,this.collisionResponse=!0,this.position=new i,t.position&&this.position.copy(t.position),this.previousPosition=new i,this.initPosition=new i,this.velocity=new i,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new i,this.force=new i;var e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=e>0?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?Body.STATIC:Body.DYNAMIC,typeof t.type==typeof Body.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new i,this.quaternion=new a,t.quaternion&&this.quaternion.copy(t.quaternion),this.initQuaternion=new a,this.angularVelocity=new i,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new i,this.interpolatedPosition=new i,this.interpolatedQuaternion=new a,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new i,this.invInertia=new i,this.invInertiaWorld=new o,this.invMassSolve=0,this.invInertiaSolve=new i,this.invInertiaWorldSolve=new o,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.aabb=new s,this.aabbNeedsUpdate=!0,this.wlambda=new i,t.shape&&this.addShape(t.shape),this.updateMassProperties()}Body.prototype=new n,Body.prototype.constructor=Body,Body.DYNAMIC=1,Body.STATIC=2,Body.KINEMATIC=4,Body.AWAKE=0,Body.SLEEPY=1,Body.SLEEPING=2,Body.idCounter=0,Body.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=0,t===Body.SLEEPING&&this.dispatchEvent({type:"wakeup"})},Body.prototype.sleep=function(){this.sleepState=Body.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},Body.sleepyEvent={type:"sleepy"},Body.sleepEvent={type:"sleep"},Body.prototype.sleepTick=function(t){if(this.allowSleep){var e=this.sleepState,r=this.velocity.norm2()+this.angularVelocity.norm2(),n=Math.pow(this.sleepSpeedLimit,2);e===Body.AWAKE&&r<n?(this.sleepState=Body.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(Body.sleepyEvent)):e===Body.SLEEPY&&r>n?this.wakeUp():e===Body.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Body.sleepEvent))}},Body.prototype.updateSolveMassProperties=function(){this.sleepState===Body.SLEEPING||this.type===Body.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},Body.prototype.pointToLocalFrame=function(t,e){var e=e||new i;return t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e},Body.prototype.vectorToLocalFrame=function(t,e){var e=e||new i;return this.quaternion.conjugate().vmult(t,e),e},Body.prototype.pointToWorldFrame=function(t,e){var e=e||new i;return this.quaternion.vmult(t,e),e.vadd(this.position,e),e},Body.prototype.vectorToWorldFrame=function(t,e){var e=e||new i;return this.quaternion.vmult(t,e),e};var u=new i,l=new a;Body.prototype.addShape=function(t,e,r){var n=new i,o=new a;return e&&n.copy(e),r&&o.copy(r),this.shapes.push(t),this.shapeOffsets.push(n),this.shapeOrientations.push(o),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},Body.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,r=t.length,n=0,i=0;i!==r;i++){var o=t[i];o.updateBoundingSphereRadius();var a=e[i].norm(),s=o.boundingSphereRadius;a+s>n&&(n=a+s)}this.boundingRadius=n};var p=new s;Body.prototype.computeAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,r=this.shapeOrientations,n=t.length,i=u,o=l,a=this.quaternion,s=this.aabb,c=p,f=0;f!==n;f++){var h=t[f];r[f].mult(a,o),o.vmult(e[f],i),i.vadd(this.position,i),h.calculateWorldAABB(i,o,c.lowerBound,c.upperBound),0===f?s.copy(c):s.extend(c)}this.aabbNeedsUpdate=!1};var f=new o,h=new o;new o,Body.prototype.updateInertiaWorld=function(t){var e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){var r=f,n=h;r.setRotationFromQuaternion(this.quaternion),r.transpose(n),r.scale(e,r),r.mmult(n,this.invInertiaWorld)}};var d=new i,y=new i;Body.prototype.applyForce=function(t,e){if(this.type===Body.DYNAMIC){var r=d;e.vsub(this.position,r);var n=y;r.cross(t,n),this.force.vadd(t,this.force),this.torque.vadd(n,this.torque)}};var m=new i,v=new i;Body.prototype.applyLocalForce=function(t,e){if(this.type===Body.DYNAMIC){var r=m,n=v;this.vectorToWorldFrame(t,r),this.pointToWorldFrame(e,n),this.applyForce(r,n)}};var g=new i,_=new i,b=new i;Body.prototype.applyImpulse=function(t,e){if(this.type===Body.DYNAMIC){var r=g;e.vsub(this.position,r);var n=_;n.copy(t),n.mult(this.invMass,n),this.velocity.vadd(n,this.velocity);var i=b;r.cross(t,i),this.invInertiaWorld.vmult(i,i),this.angularVelocity.vadd(i,this.angularVelocity)}};var w=new i,P=new i;Body.prototype.applyLocalImpulse=function(t,e){if(this.type===Body.DYNAMIC){var r=w,n=P;this.vectorToWorldFrame(t,r),this.pointToWorldFrame(e,n),this.applyImpulse(r,n)}};var x=new i;Body.prototype.updateMassProperties=function(){var t=x;this.invMass=this.mass>0?1/this.mass:0;var e=this.inertia,r=this.fixedRotation;this.computeAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),c.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!r?1/e.x:0,e.y>0&&!r?1/e.y:0,e.z>0&&!r?1/e.z:0),this.updateInertiaWorld(!0)},Body.prototype.getVelocityAtWorldPoint=function(t,e){var r=new i;return t.vsub(this.position,r),this.angularVelocity.cross(r,e),this.velocity.vadd(e,e),e}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,e,r){t("./Body");var n=t("../math/Vec3"),i=t("../math/Quaternion"),o=(t("../collision/RaycastResult"),t("../collision/Ray")),a=t("../objects/WheelInfo");function RaycastVehicle(t){this.chassisBody=t.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==t.indexRightAxis?t.indexRightAxis:1,this.indexForwardAxis=void 0!==t.indexForwardAxis?t.indexForwardAxis:0,this.indexUpAxis=void 0!==t.indexUpAxis?t.indexUpAxis:2}e.exports=RaycastVehicle,new n,new n,new n;var s=new n,c=new n,u=new n;new o,RaycastVehicle.prototype.addWheel=function(t){var e=new a(t=t||{}),r=this.wheelInfos.length;return this.wheelInfos.push(e),r},RaycastVehicle.prototype.setSteeringValue=function(t,e){var r=this.wheelInfos[e];r.steering=t},new n,RaycastVehicle.prototype.applyEngineForce=function(t,e){this.wheelInfos[e].engineForce=t},RaycastVehicle.prototype.setBrake=function(t,e){this.wheelInfos[e].brake=t},RaycastVehicle.prototype.addToWorld=function(t){this.constraints,t.add(this.chassisBody);var e=this;this.preStepCallback=function(){e.updateVehicle(t.dt)},t.addEventListener("preStep",this.preStepCallback),this.world=t},RaycastVehicle.prototype.getVehicleAxisWorld=function(t,e){e.set(0===t?1:0,1===t?1:0,2===t?1:0),this.chassisBody.vectorToWorldFrame(e,e)},RaycastVehicle.prototype.updateVehicle=function(t){for(var e=this.wheelInfos,r=e.length,i=this.chassisBody,o=0;o<r;o++)this.updateWheelTransform(o);this.currentVehicleSpeedKmHour=3.6*i.velocity.norm();var a=new n;this.getVehicleAxisWorld(this.indexForwardAxis,a),a.dot(i.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1);for(var o=0;o<r;o++)this.castRay(e[o]);this.updateSuspension(t);for(var s=new n,c=new n,o=0;o<r;o++){var u=e[o],l=u.suspensionForce;l>u.maxSuspensionForce&&(l=u.maxSuspensionForce),u.raycastResult.hitNormalWorld.scale(l*t,s),u.raycastResult.hitPointWorld.vsub(i.position,c),i.applyImpulse(s,u.raycastResult.hitPointWorld)}this.updateFriction(t);var p=new n,f=new n,h=new n;for(o=0;o<r;o++){var u=e[o];i.getVelocityAtWorldPoint(u.chassisConnectionPointWorld,h);var d=1;switch(this.indexUpAxis){case 1:d=-1}if(u.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,f);var y=f.dot(u.raycastResult.hitNormalWorld);u.raycastResult.hitNormalWorld.scale(y,p),f.vsub(p,f);var m=f.dot(h);u.deltaRotation=d*m*t/u.radius}!u.sliding&&u.isInContact||0===u.engineForce||!u.useCustomSlidingRotationalSpeed||(u.deltaRotation=(u.engineForce>0?1:-1)*u.customSlidingRotationalSpeed*t),Math.abs(u.brake)>Math.abs(u.engineForce)&&(u.deltaRotation=0),u.rotation+=u.deltaRotation,u.deltaRotation*=.99}},RaycastVehicle.prototype.updateSuspension=function(t){for(var e=this.chassisBody,r=e.mass,n=this.wheelInfos,i=n.length,o=0;o<i;o++){var a=n[o];if(a.isInContact){var s,c=a.suspensionRestLength,u=a.suspensionLength,l=c-u;s=a.suspensionStiffness*l*a.clippedInvContactDotSuspension;var p,f=a.suspensionRelativeVelocity;p=f<0?a.dampingCompression:a.dampingRelaxation,s-=p*f,a.suspensionForce=s*r,a.suspensionForce<0&&(a.suspensionForce=0)}else a.suspensionForce=0}},RaycastVehicle.prototype.removeFromWorld=function(t){this.constraints,t.remove(this.chassisBody),t.removeEventListener("preStep",this.preStepCallback),this.world=null};var l=new n,p=new n;RaycastVehicle.prototype.castRay=function(t){var e=l,r=p;this.updateWheelTransformWorld(t);var i=this.chassisBody,o=-1,a=t.suspensionRestLength+t.radius;t.directionWorld.scale(a,e);var s=t.chassisConnectionPointWorld;s.vadd(e,r);var c=t.raycastResult;c.reset();var u=i.collisionResponse;i.collisionResponse=!1,this.world.rayTest(s,r,c),i.collisionResponse=u;var f=c.body;if(t.raycastResult.groundObject=0,f){o=c.distance,t.raycastResult.hitNormalWorld=c.hitNormalWorld,t.isInContact=!0;var h=c.distance;t.suspensionLength=h-t.radius;var d=t.suspensionRestLength-t.maxSuspensionTravel,y=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<d&&(t.suspensionLength=d),t.suspensionLength>y&&(t.suspensionLength=y,t.raycastResult.reset());var m=t.raycastResult.hitNormalWorld.dot(t.directionWorld),v=new n;i.getVelocityAtWorldPoint(t.raycastResult.hitPointWorld,v);var g=t.raycastResult.hitNormalWorld.dot(v);if(m>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{var _=-1/m;t.suspensionRelativeVelocity=g*_,t.clippedInvContactDotSuspension=_}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return o},RaycastVehicle.prototype.updateWheelTransformWorld=function(t){t.isInContact=!1;var e=this.chassisBody;e.pointToWorldFrame(t.chassisConnectionPointLocal,t.chassisConnectionPointWorld),e.vectorToWorldFrame(t.directionLocal,t.directionWorld),e.vectorToWorldFrame(t.axleLocal,t.axleWorld)},RaycastVehicle.prototype.updateWheelTransform=function(t){var e=s,r=c,n=u,o=this.wheelInfos[t];this.updateWheelTransformWorld(o),o.directionLocal.scale(-1,e),r.copy(o.axleLocal),e.cross(r,n),n.normalize(),r.normalize();var a=o.steering,l=new i;l.setFromAxisAngle(e,a);var p=new i;p.setFromAxisAngle(r,o.rotation);var f=o.worldTransform.quaternion;this.chassisBody.quaternion.mult(l,f),f.mult(p,f),f.normalize();var h=o.worldTransform.position;h.copy(o.directionWorld),h.scale(o.suspensionLength,h),h.vadd(o.chassisConnectionPointWorld,h)};var f=[new n(1,0,0),new n(0,1,0),new n(0,0,1)];RaycastVehicle.prototype.getWheelTransformWorld=function(t){return this.wheelInfos[t].worldTransform};var h=new n,d=[],y=[];RaycastVehicle.prototype.updateFriction=function(t){for(var e=h,r=this.wheelInfos,i=r.length,o=this.chassisBody,a=y,s=d,c=0;c<i;c++){var u=r[c],l=u.raycastResult.body;u.sideImpulse=0,u.forwardImpulse=0,a[c]||(a[c]=new n),s[c]||(s[c]=new n)}for(var c=0;c<i;c++){var u=r[c],l=u.raycastResult.body;if(l){var p=s[c],m=this.getWheelTransformWorld(c);m.vectorToWorldFrame(f[this.indexRightAxis],p);var v=u.raycastResult.hitNormalWorld,g=p.dot(v);v.scale(g,e),p.vsub(e,p),p.normalize(),v.cross(p,a[c]),a[c].normalize(),u.sideImpulse=resolveSingleBilateral(o,u.raycastResult.hitPointWorld,l,u.raycastResult.hitPointWorld,p),u.sideImpulse*=1}}this.sliding=!1;for(var c=0;c<i;c++){var u=r[c],l=u.raycastResult.body,_=0;if(u.slipInfo=1,l){var b=u.brake?u.brake:0;_=calcRollingFriction(o,l,u.raycastResult.hitPointWorld,a[c],b),_+=u.engineForce*t;var w=b/_;u.slipInfo*=w}if(u.forwardImpulse=0,u.skidInfo=1,l){u.skidInfo=1;var P=u.suspensionForce*t*u.frictionSlip,x=P,O=P*x;u.forwardImpulse=_;var C=.5*u.forwardImpulse,S=1*u.sideImpulse,R=C*C+S*S;if(u.sliding=!1,R>O){this.sliding=!0,u.sliding=!0;var w=P/Math.sqrt(R);u.skidInfo*=w}}}if(this.sliding)for(var c=0;c<i;c++){var u=r[c];0!==u.sideImpulse&&u.skidInfo<1&&(u.forwardImpulse*=u.skidInfo,u.sideImpulse*=u.skidInfo)}for(var c=0;c<i;c++){var u=r[c],j=new n;if(j.copy(u.raycastResult.hitPointWorld),0!==u.forwardImpulse){var T=new n;a[c].scale(u.forwardImpulse,T),o.applyImpulse(T,j)}if(0!==u.sideImpulse){var l=u.raycastResult.body,E=new n;E.copy(u.raycastResult.hitPointWorld);var B=new n;s[c].scale(u.sideImpulse,B),o.pointToLocalFrame(j,j),j["xyz"[this.indexUpAxis]]*=u.rollInfluence,o.pointToWorldFrame(j,j),o.applyImpulse(B,j),B.scale(-1,B),l.applyImpulse(B,E)}}};var m=new n,v=new n,g=new n;function calcRollingFriction(t,e,r,n,i){var o=0,a=r,s=m,c=v,u=g;t.getVelocityAtWorldPoint(a,s),e.getVelocityAtWorldPoint(a,c),s.vsub(c,u);var l=n.dot(u),p=computeImpulseDenominator(t,r,n),f=computeImpulseDenominator(e,r,n),h=1/(p+f);return i<(o=-l*h)&&(o=i),o<-i&&(o=-i),o}var _=new n,b=new n,w=new n,P=new n;function computeImpulseDenominator(t,e,r){var n=_,i=b,o=w,a=P;return e.vsub(t.position,n),n.cross(r,i),t.invInertiaWorld.vmult(i,a),a.cross(n,o),t.invMass+r.dot(o)}var x=new n,O=new n,C=new n;function resolveSingleBilateral(t,e,r,n,i,o){var a=i.norm2();if(a>1.1)return 0;var s=x,c=O,u=C;t.getVelocityAtWorldPoint(e,s),r.getVelocityAtWorldPoint(n,c),s.vsub(c,u);var l=i.dot(u),p=1/(t.invMass+r.invMass),o=-.2*l*p;return o}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,e,r){var n=t("./Body"),i=t("../shapes/Sphere"),o=t("../shapes/Box"),a=t("../math/Vec3"),s=t("../constraints/HingeConstraint");function RigidVehicle(t){if(this.wheelBodies=[],this.coordinateSystem=void 0===t.coordinateSystem?new a(1,2,3):t.coordinateSystem.clone(),this.chassisBody=t.chassisBody,!this.chassisBody){var e=new o(new a(5,2,.5));this.chassisBody=new n(1,e)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}e.exports=RigidVehicle,RigidVehicle.prototype.addWheel=function(t){var e=(t=t||{}).body;e||(e=new n(1,new i(1.2))),this.wheelBodies.push(e),this.wheelForces.push(0),new a;var r=void 0!==t.position?t.position.clone():new a,o=new a;this.chassisBody.pointToWorldFrame(r,o),e.position.set(o.x,o.y,o.z);var c=void 0!==t.axis?t.axis.clone():new a(0,1,0);this.wheelAxes.push(c);var u=new s(this.chassisBody,e,{pivotA:r,axisA:c,pivotB:a.ZERO,axisB:c,collideConnected:!1});return this.constraints.push(u),this.wheelBodies.length-1},RigidVehicle.prototype.setSteeringValue=function(t,e){var r=this.wheelAxes[e],n=Math.cos(t),i=Math.sin(t),o=r.x,a=r.y;this.constraints[e].axisA.set(n*o-i*a,i*o+n*a,0)},RigidVehicle.prototype.setMotorSpeed=function(t,e){var r=this.constraints[e];r.enableMotor(),r.motorTargetVelocity=t},RigidVehicle.prototype.disableMotor=function(t){var e=this.constraints[t];e.disableMotor()};var c=new a;RigidVehicle.prototype.setWheelForce=function(t,e){this.wheelForces[e]=t},RigidVehicle.prototype.applyWheelForce=function(t,e){var r=this.wheelAxes[e],n=this.wheelBodies[e],i=n.torque;r.scale(t,c),n.vectorToWorldFrame(c,c),i.vadd(c,i)},RigidVehicle.prototype.addToWorld=function(t){for(var e=this.constraints,r=this.wheelBodies.concat([this.chassisBody]),n=0;n<r.length;n++)t.add(r[n]);for(var n=0;n<e.length;n++)t.addConstraint(e[n]);t.addEventListener("preStep",this._update.bind(this))},RigidVehicle.prototype._update=function(){for(var t=this.wheelForces,e=0;e<t.length;e++)this.applyWheelForce(t[e],e)},RigidVehicle.prototype.removeFromWorld=function(t){for(var e=this.constraints,r=this.wheelBodies.concat([this.chassisBody]),n=0;n<r.length;n++)t.remove(r[n]);for(var n=0;n<e.length;n++)t.removeConstraint(e[n])};var u=new a;RigidVehicle.prototype.getWheelSpeed=function(t){var e=this.wheelAxes[t],r=this.wheelBodies[t],n=r.angularVelocity;return this.chassisBody.vectorToWorldFrame(e,u),n.dot(u)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,e,r){e.exports=SPHSystem,t("../shapes/Shape");var n=t("../math/Vec3");function SPHSystem(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material"),SPHSystem.prototype.add=function(t){this.particles.push(t),this.neighbors.length<this.particles.length&&this.neighbors.push([])},SPHSystem.prototype.remove=function(t){var e=this.particles.indexOf(t);-1!==e&&(this.particles.splice(e,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var i=new n;SPHSystem.prototype.getNeighbors=function(t,e){for(var r=this.particles.length,n=t.id,o=this.smoothingRadius*this.smoothingRadius,a=i,s=0;s!==r;s++){var c=this.particles[s];c.position.vsub(t.position,a),n!==c.id&&a.norm2()<o&&e.push(c)}};var o=new n,a=new n,s=new n,c=new n,u=new n,l=new n;SPHSystem.prototype.update=function(){for(var t=this.particles.length,e=o,r=this.speedOfSound,n=this.eps,i=0;i!==t;i++){var p=this.particles[i],f=this.neighbors[i];f.length=0,this.getNeighbors(p,f),f.push(this.particles[i]);for(var h=f.length,d=0,y=0;y!==h;y++){p.position.vsub(f[y].position,e);var m=e.norm(),v=this.w(m);d+=f[y].mass*v}this.densities[i]=d,this.pressures[i]=r*r*(this.densities[i]-this.density)}for(var g=a,_=s,b=c,w=u,P=l,i=0;i!==t;i++){var x,O,C=this.particles[i];g.set(0,0,0),_.set(0,0,0);for(var f=this.neighbors[i],h=f.length,y=0;y!==h;y++){var S=f[y];C.position.vsub(S.position,w);var R=w.norm();x=-S.mass*(this.pressures[i]/(this.densities[i]*this.densities[i]+n)+this.pressures[y]/(this.densities[y]*this.densities[y]+n)),this.gradw(w,b),b.mult(x,b),g.vadd(b,g),S.velocity.vsub(C.velocity,P),P.mult(1/(1e-4+this.densities[i]*this.densities[y])*this.viscosity*S.mass,P),O=this.nablaw(R),P.mult(O,P),_.vadd(P,_)}_.mult(C.mass,_),g.mult(C.mass,g),C.force.vadd(_,C.force),C.force.vadd(g,C.force)}},SPHSystem.prototype.w=function(t){var e=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(e,9))*Math.pow(e*e-t*t,3)},SPHSystem.prototype.gradw=function(t,e){var r=t.norm(),n=this.smoothingRadius;t.mult(945/(32*Math.PI*Math.pow(n,9))*Math.pow(n*n-r*r,2),e)},SPHSystem.prototype.nablaw=function(t){var e=this.smoothingRadius,r=945/(32*Math.PI*Math.pow(e,9))*(e*e-t*t)*(7*t*t-3*e*e);return r}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,e,r){var n=t("../math/Vec3");function Spring(t,e,r){r=r||{},this.restLength="number"==typeof r.restLength?r.restLength:1,this.stiffness=r.stiffness||100,this.damping=r.damping||1,this.bodyA=t,this.bodyB=e,this.localAnchorA=new n,this.localAnchorB=new n,r.localAnchorA&&this.localAnchorA.copy(r.localAnchorA),r.localAnchorB&&this.localAnchorB.copy(r.localAnchorB),r.worldAnchorA&&this.setWorldAnchorA(r.worldAnchorA),r.worldAnchorB&&this.setWorldAnchorB(r.worldAnchorB)}e.exports=Spring,Spring.prototype.setWorldAnchorA=function(t){this.bodyA.pointToLocalFrame(t,this.localAnchorA)},Spring.prototype.setWorldAnchorB=function(t){this.bodyB.pointToLocalFrame(t,this.localAnchorB)},Spring.prototype.getWorldAnchorA=function(t){this.bodyA.pointToWorldFrame(this.localAnchorA,t)},Spring.prototype.getWorldAnchorB=function(t){this.bodyB.pointToWorldFrame(this.localAnchorB,t)};var i=new n,o=new n,a=new n,s=new n,c=new n,u=new n,l=new n,p=new n,f=new n,h=new n,d=new n;Spring.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,r=this.restLength,n=this.bodyA,y=this.bodyB,m=i,v=o,g=a,_=s,b=d,w=c,P=u,x=l,O=p,C=f,S=h;this.getWorldAnchorA(w),this.getWorldAnchorB(P),w.vsub(n.position,x),P.vsub(y.position,O),P.vsub(w,m);var R=m.norm();v.copy(m),v.normalize(),y.velocity.vsub(n.velocity,g),y.angularVelocity.cross(O,b),g.vadd(b,g),n.angularVelocity.cross(x,b),g.vsub(b,g),v.mult(-t*(R-r)-e*g.dot(v),_),n.force.vsub(_,n.force),y.force.vadd(_,y.force),x.cross(_,C),O.cross(_,S),n.torque.vsub(C,n.torque),y.torque.vadd(S,y.torque)}},{"../math/Vec3":30}],36:[function(t,e,r){var n=t("../math/Vec3"),i=t("../math/Transform"),o=t("../collision/RaycastResult"),a=t("../utils/Utils");function WheelInfo(t){t=a.defaults(t,{chassisConnectionPointLocal:new n,chassisConnectionPointWorld:new n,directionLocal:new n,directionWorld:new n,axleLocal:new n,axleWorld:new n,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointWorld.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionWorld.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleWorld.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new o,this.worldTransform=new i,this.isInContact=!1}e.exports=WheelInfo;var s=new n,c=new n,s=new n;WheelInfo.prototype.updateWheel=function(t){var e=this.raycastResult;if(this.isInContact){var r=e.hitNormalWorld.dot(e.directionWorld);e.hitPointWorld.vsub(t.position,c),t.getVelocityAtWorldPoint(c,s);var n=e.hitNormalWorld.dot(s);if(r>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var i=-1/r;this.suspensionRelativeVelocity=n*i,this.clippedInvContactDotSuspension=i}}else e.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,e,r){e.exports=Box;var n=t("./Shape"),i=t("../math/Vec3"),o=t("./ConvexPolyhedron");function Box(t){n.call(this),this.type=n.types.BOX,this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}Box.prototype=new n,Box.prototype.constructor=Box,Box.prototype.updateConvexPolyhedronRepresentation=function(){var t=this.halfExtents.x,e=this.halfExtents.y,r=this.halfExtents.z,n=i,a=[new n(-t,-e,-r),new n(t,-e,-r),new n(t,e,-r),new n(-t,e,-r),new n(-t,-e,r),new n(t,-e,r),new n(t,e,r),new n(-t,e,r)],s=(new n(0,0,1),new n(0,1,0),new n(1,0,0),new o(a,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=s,s.material=this.material},Box.prototype.calculateLocalInertia=function(t,e){return e=e||new i,Box.calculateInertia(this.halfExtents,t,e),e},Box.calculateInertia=function(t,e,r){var n=t;r.x=1/12*e*(2*n.y*2*n.y+2*n.z*2*n.z),r.y=1/12*e*(2*n.x*2*n.x+2*n.z*2*n.z),r.z=1/12*e*(2*n.y*2*n.y+2*n.x*2*n.x)},Box.prototype.getSideNormals=function(t,e){var r=t,n=this.halfExtents;if(r[0].set(n.x,0,0),r[1].set(0,n.y,0),r[2].set(0,0,n.z),r[3].set(-n.x,0,0),r[4].set(0,-n.y,0),r[5].set(0,0,-n.z),void 0!==e)for(var i=0;i!==r.length;i++)e.vmult(r[i],r[i]);return r},Box.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},Box.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var a=new i;new i,Box.prototype.forEachWorldCorner=function(t,e,r){for(var n=this.halfExtents,i=[[n.x,n.y,n.z],[-n.x,n.y,n.z],[-n.x,-n.y,n.z],[-n.x,-n.y,-n.z],[n.x,-n.y,-n.z],[n.x,n.y,-n.z],[-n.x,n.y,-n.z],[n.x,-n.y,n.z]],o=0;o<i.length;o++)a.set(i[o][0],i[o][1],i[o][2]),e.vmult(a,a),t.vadd(a,a),r(a.x,a.y,a.z)};var s=[new i,new i,new i,new i,new i,new i,new i,new i];Box.prototype.calculateWorldAABB=function(t,e,r,n){var i=this.halfExtents;s[0].set(i.x,i.y,i.z),s[1].set(-i.x,i.y,i.z),s[2].set(-i.x,-i.y,i.z),s[3].set(-i.x,-i.y,-i.z),s[4].set(i.x,-i.y,-i.z),s[5].set(i.x,i.y,-i.z),s[6].set(-i.x,i.y,-i.z),s[7].set(i.x,-i.y,i.z);var o=s[0];e.vmult(o,o),t.vadd(o,o),n.copy(o),r.copy(o);for(var a=1;a<8;a++){var o=s[a];e.vmult(o,o),t.vadd(o,o);var c=o.x,u=o.y,l=o.z;c>n.x&&(n.x=c),u>n.y&&(n.y=u),l>n.z&&(n.z=l),c<r.x&&(r.x=c),u<r.y&&(r.y=u),l<r.z&&(r.z=l)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,e,r){e.exports=ConvexPolyhedron;var n=t("./Shape"),i=t("../math/Vec3"),o=(t("../math/Quaternion"),t("../math/Transform"));function ConvexPolyhedron(t,e,r){n.call(this),this.type=n.types.CONVEXPOLYHEDRON,this.vertices=t||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=e||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=r?r.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}ConvexPolyhedron.prototype=new n,ConvexPolyhedron.prototype.constructor=ConvexPolyhedron;var a=new i;ConvexPolyhedron.prototype.computeEdges=function(){var t=this.faces,e=this.vertices,r=(e.length,this.uniqueEdges);r.length=0;for(var n=a,i=0;i!==t.length;i++)for(var o=t[i],s=o.length,c=0;c!==s;c++){var u=(c+1)%s;e[o[c]].vsub(e[o[u]],n),n.normalize();for(var l=!1,p=0;p!==r.length;p++)if(r[p].almostEquals(n)||r[p].almostEquals(n)){l=!0;break}l||r.push(n.clone())}},ConvexPolyhedron.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var t=0;t<this.faces.length;t++){for(var e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error("Vertex "+this.faces[t][e]+" not found!");var r=this.faceNormals[t]||new i;this.getFaceNormal(t,r),r.negate(r),this.faceNormals[t]=r;var n=this.vertices[this.faces[t][0]];if(r.dot(n)<0){console.error(".faceNormals["+t+"] = Vec3("+r.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.");for(var e=0;e<this.faces[t].length;e++)console.warn(".vertices["+this.faces[t][e]+"] = Vec3("+this.vertices[this.faces[t][e]].toString()+")")}}};var s=new i,c=new i;ConvexPolyhedron.computeNormal=function(t,e,r,n){e.vsub(t,c),r.vsub(e,s),s.cross(c,n),n.isZero()||n.normalize()},ConvexPolyhedron.prototype.getFaceNormal=function(t,e){var r=this.faces[t],n=this.vertices[r[0]],i=this.vertices[r[1]],o=this.vertices[r[2]];return ConvexPolyhedron.computeNormal(n,i,o,e)};var u=new i;ConvexPolyhedron.prototype.clipAgainstHull=function(t,e,r,n,o,a,s,c,l){for(var p=u,f=-1,h=-Number.MAX_VALUE,d=0;d<r.faces.length;d++){p.copy(r.faceNormals[d]),o.vmult(p,p);var y=p.dot(a);y>h&&(h=y,f=d)}for(var m=[],v=r.faces[f],g=v.length,_=0;_<g;_++){var b=r.vertices[v[_]],w=new i;w.copy(b),o.vmult(w,w),n.vadd(w,w),m.push(w)}f>=0&&this.clipFaceAgainstHull(a,t,e,m,s,c,l)};var l=new i,p=new i,f=new i,h=new i,d=new i,y=new i;ConvexPolyhedron.prototype.findSeparatingAxis=function(t,e,r,n,i,o,a,s){var c=l,u=p,m=f,v=h,g=d,_=y,b=Number.MAX_VALUE;if(this.uniqueAxes)for(var w=0;w!==this.uniqueAxes.length;w++){r.vmult(this.uniqueAxes[w],c);var P=this.testSepAxis(c,t,e,r,n,i);if(!1===P)return!1;P<b&&(b=P,o.copy(c))}else for(var x=a?a.length:this.faces.length,w=0;w<x;w++){var O=a?a[w]:w;c.copy(this.faceNormals[O]),r.vmult(c,c);var P=this.testSepAxis(c,t,e,r,n,i);if(!1===P)return!1;P<b&&(b=P,o.copy(c))}if(t.uniqueAxes)for(var w=0;w!==t.uniqueAxes.length;w++){i.vmult(t.uniqueAxes[w],u);var P=this.testSepAxis(u,t,e,r,n,i);if(!1===P)return!1;P<b&&(b=P,o.copy(u))}else for(var C=s?s.length:t.faces.length,w=0;w<C;w++){var O=s?s[w]:w;u.copy(t.faceNormals[O]),i.vmult(u,u);var P=this.testSepAxis(u,t,e,r,n,i);if(!1===P)return!1;P<b&&(b=P,o.copy(u))}for(var S=0;S!==this.uniqueEdges.length;S++){r.vmult(this.uniqueEdges[S],v);for(var R=0;R!==t.uniqueEdges.length;R++)if(i.vmult(t.uniqueEdges[R],g),v.cross(g,_),!_.almostZero()){_.normalize();var j=this.testSepAxis(_,t,e,r,n,i);if(!1===j)return!1;j<b&&(b=j,o.copy(_))}}return n.vsub(e,m),m.dot(o)>0&&o.negate(o),!0};var m=[],v=[];ConvexPolyhedron.prototype.testSepAxis=function(t,e,r,n,i,o){ConvexPolyhedron.project(this,t,r,n,m),ConvexPolyhedron.project(e,t,i,o,v);var a=m[0],s=m[1],c=v[0],u=v[1];if(a<u||c<s)return!1;var l=a-u,p=c-s,f=l<p?l:p;return f};var g=new i,_=new i;ConvexPolyhedron.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(g,_);var r=_.x-g.x,n=_.y-g.y,i=_.z-g.z;e.x=1/12*t*(2*n*2*n+2*i*2*i),e.y=1/12*t*(2*r*2*r+2*i*2*i),e.z=1/12*t*(2*n*2*n+2*r*2*r)},ConvexPolyhedron.prototype.getPlaneConstantOfFace=function(t){var e=this.faces[t],r=this.faceNormals[t],n=this.vertices[e[0]],i=-r.dot(n);return i};var b=new i,w=new i,P=new i,x=new i,O=new i,C=new i,S=new i,R=new i;ConvexPolyhedron.prototype.clipFaceAgainstHull=function(t,e,r,n,i,o,a){for(var s=b,c=w,u=P,l=x,p=O,f=C,h=S,d=R,y=n,m=[],v=-1,g=Number.MAX_VALUE,_=0;_<this.faces.length;_++){s.copy(this.faceNormals[_]),r.vmult(s,s);var j=s.dot(t);j<g&&(g=j,v=_)}if(!(v<0)){var T=this.faces[v];T.connectedFaces=[];for(var E=0;E<this.faces.length;E++)for(var B=0;B<this.faces[E].length;B++)-1!==T.indexOf(this.faces[E][B])&&E!==v&&-1===T.connectedFaces.indexOf(E)&&T.connectedFaces.push(E);y.length;for(var A=T.length,I=0;I<A;I++){var M=this.vertices[T[I]],k=this.vertices[T[(I+1)%A]];M.vsub(k,c),u.copy(c),r.vmult(u,u),e.vadd(u,u),l.copy(this.faceNormals[v]),r.vmult(l,l),e.vadd(l,l),u.cross(l,p),p.negate(p),f.copy(M),r.vmult(f,f),e.vadd(f,f),f.dot(p);var z=T.connectedFaces[I];h.copy(this.faceNormals[z]);var F=this.getPlaneConstantOfFace(z);d.copy(h),r.vmult(d,d);var D=F-d.dot(e);for(this.clipFaceAgainstPlane(y,m,d,D);y.length;)y.shift();for(;m.length;)y.push(m.shift())}h.copy(this.faceNormals[v]);var F=this.getPlaneConstantOfFace(v);d.copy(h),r.vmult(d,d);for(var D=F-d.dot(e),E=0;E<y.length;E++){var N=d.dot(y[E])+D;if(N<=i&&(console.log("clamped: depth="+N+" to minDist="+i),N=i),N<=o){var L=y[E];if(N<=0){var V={point:L,normal:d,depth:N};a.push(V)}}}}},ConvexPolyhedron.prototype.clipFaceAgainstPlane=function(t,e,r,n){var o,a,s=t.length;if(s<2)return e;var c=t[t.length-1],u=t[0];o=r.dot(c)+n;for(var l=0;l<s;l++){if(u=t[l],a=r.dot(u)+n,o<0)if(a<0){var p=new i;p.copy(u),e.push(p)}else{var p=new i;c.lerp(u,o/(o-a),p),e.push(p)}else if(a<0){var p=new i;c.lerp(u,o/(o-a),p),e.push(p),e.push(u)}c=u,o=a}return e},ConvexPolyhedron.prototype.computeWorldVertices=function(t,e){for(var r=this.vertices.length;this.worldVertices.length<r;)this.worldVertices.push(new i);for(var n=this.vertices,o=this.worldVertices,a=0;a!==r;a++)e.vmult(n[a],o[a]),t.vadd(o[a],o[a]);this.worldVerticesNeedsUpdate=!1},new i,ConvexPolyhedron.prototype.computeLocalAABB=function(t,e){var r=this.vertices.length,n=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var i=0;i<r;i++){var o=n[i];o.x<t.x?t.x=o.x:o.x>e.x&&(e.x=o.x),o.y<t.y?t.y=o.y:o.y>e.y&&(e.y=o.y),o.z<t.z?t.z=o.z:o.z>e.z&&(e.z=o.z)}},ConvexPolyhedron.prototype.computeWorldFaceNormals=function(t){for(var e=this.faceNormals.length;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new i);for(var r=this.faceNormals,n=this.worldFaceNormals,o=0;o!==e;o++)t.vmult(r[o],n[o]);this.worldFaceNormalsNeedsUpdate=!1},ConvexPolyhedron.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,r=0,n=e.length;r!==n;r++){var i=e[r].norm2();i>t&&(t=i)}this.boundingSphereRadius=Math.sqrt(t)};var j=new i;ConvexPolyhedron.prototype.calculateWorldAABB=function(t,e,r,n){for(var i,o,a,s,c,u,l=this.vertices.length,p=this.vertices,f=0;f<l;f++){j.copy(p[f]),e.vmult(j,j),t.vadd(j,j);var h=j;h.x<i||void 0===i?i=h.x:(h.x>s||void 0===s)&&(s=h.x),h.y<o||void 0===o?o=h.y:(h.y>c||void 0===c)&&(c=h.y),h.z<a||void 0===a?a=h.z:(h.z>u||void 0===u)&&(u=h.z)}r.set(i,o,a),n.set(s,c,u)},ConvexPolyhedron.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},ConvexPolyhedron.prototype.getAveragePointLocal=function(t){t=t||new i;for(var e=this.vertices.length,r=this.vertices,n=0;n<e;n++)t.vadd(r[n],t);return t.mult(1/e,t),t},ConvexPolyhedron.prototype.transformAllPoints=function(t,e){var r=this.vertices.length,n=this.vertices;if(e){for(var i=0;i<r;i++){var o=n[i];e.vmult(o,o)}for(var i=0;i<this.faceNormals.length;i++){var o=this.faceNormals[i];e.vmult(o,o)}}if(t)for(var i=0;i<r;i++){var o=n[i];o.vadd(t,o)}};var T=new i,E=new i,B=new i;ConvexPolyhedron.prototype.pointIsInside=function(t){var e=this.vertices.length,r=this.vertices,n=this.faces,i=this.faceNormals,o=this.faces.length,a=T;this.getAveragePointLocal(a);for(var s=0;s<o;s++){this.faces[s].length;var e=i[s],c=r[n[s][0]],u=E;t.vsub(c,u);var l=e.dot(u),p=B;a.vsub(c,p);var f=e.dot(p);if(l<0&&f>0||l>0&&f<0)return!1}return-1},new i;var A=new i,I=new i;ConvexPolyhedron.project=function(t,e,r,n,i){var a=t.vertices.length,s=A,c=0,u=0,l=I,p=t.vertices;l.setZero(),o.vectorToLocalFrame(r,n,e,s),o.pointToLocalFrame(r,n,l,l);var f=l.dot(s);u=c=p[0].dot(s);for(var h=1;h<a;h++){var d=p[h].dot(s);d>c&&(c=d),d<u&&(u=d)}if((u-=f)>(c-=f)){var y=u;u=c,c=y}i[0]=c,i[1]=u}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,e,r){e.exports=Cylinder;var n=t("./Shape"),i=t("../math/Vec3"),o=(t("../math/Quaternion"),t("./ConvexPolyhedron"));function Cylinder(t,e,r,a){var s=a,c=[],u=[],l=[],p=[],f=[],h=Math.cos,d=Math.sin;c.push(new i(e*h(0),e*d(0),.5*-r)),p.push(0),c.push(new i(t*h(0),t*d(0),.5*r)),f.push(1);for(var y=0;y<s;y++){var m=2*Math.PI/s*(y+1),v=2*Math.PI/s*(y+.5);y<s-1?(c.push(new i(e*h(m),e*d(m),.5*-r)),p.push(2*y+2),c.push(new i(t*h(m),t*d(m),.5*r)),f.push(2*y+3),l.push([2*y+2,2*y+3,2*y+1,2*y])):l.push([0,1,2*y+1,2*y]),(s%2==1||y<s/2)&&u.push(new i(h(v),d(v),0))}l.push(f),u.push(new i(0,0,1));for(var g=[],y=0;y<p.length;y++)g.push(p[p.length-y-1]);l.push(g),this.type=n.types.CONVEXPOLYHEDRON,o.call(this,c,l,u)}Cylinder.prototype=new o},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,e,r){var n=t("./Shape"),i=t("./ConvexPolyhedron"),o=t("../math/Vec3"),a=t("../utils/Utils");function Heightfield(t,e){e=a.defaults(e,{maxValue:null,minValue:null,elementSize:1}),this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementSize=e.elementSize,null===e.minValue&&this.updateMinValue(),null===e.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,n.call(this),this.pillarConvex=new i,this.pillarOffset=new o,this.type=n.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}e.exports=Heightfield,Heightfield.prototype=new n,Heightfield.prototype.update=function(){this._cachedPillars={}},Heightfield.prototype.updateMinValue=function(){for(var t=this.data,e=t[0][0],r=0;r!==t.length;r++)for(var n=0;n!==t[r].length;n++){var i=t[r][n];i<e&&(e=i)}this.minValue=e},Heightfield.prototype.updateMaxValue=function(){for(var t=this.data,e=t[0][0],r=0;r!==t.length;r++)for(var n=0;n!==t[r].length;n++){var i=t[r][n];i>e&&(e=i)}this.maxValue=e},Heightfield.prototype.setHeightValueAtIndex=function(t,e,r){var n=this.data;n[t][e]=r,this.clearCachedConvexTrianglePillar(t,e,!1),t>0&&(this.clearCachedConvexTrianglePillar(t-1,e,!0),this.clearCachedConvexTrianglePillar(t-1,e,!1)),e>0&&(this.clearCachedConvexTrianglePillar(t,e-1,!0),this.clearCachedConvexTrianglePillar(t,e-1,!1)),e>0&&t>0&&this.clearCachedConvexTrianglePillar(t-1,e-1,!0)},Heightfield.prototype.getRectMinMax=function(t,e,r,n,i){i=i||[];for(var o=this.data,a=this.minValue,s=t;s<=r;s++)for(var c=e;c<=n;c++){var u=o[s][c];u>a&&(a=u)}i[0]=this.minValue,i[1]=a},Heightfield.prototype.getIndexOfPosition=function(t,e,r,n){var i=this.elementSize,o=this.data,a=Math.floor(t/i),s=Math.floor(e/i);return r[0]=a,r[1]=s,n&&(a<0&&(a=0),s<0&&(s=0),a>=o.length-1&&(a=o.length-1),s>=o[0].length-1&&(s=o[0].length-1)),!(a<0||s<0||a>=o.length-1||s>=o[0].length-1)},Heightfield.prototype.getHeightAt=function(t,e,r){var n=[];this.getIndexOfPosition(t,e,n,r);var i=[];return this.getRectMinMax(n[0],n[1]+1,n[0],n[1]+1,i),(i[0]+i[1])/2},Heightfield.prototype.getCacheConvexTrianglePillarKey=function(t,e,r){return t+"_"+e+"_"+(r?1:0)},Heightfield.prototype.getCachedConvexTrianglePillar=function(t,e,r){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,r)]},Heightfield.prototype.setCachedConvexTrianglePillar=function(t,e,r,n,i){this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,r)]={convex:n,offset:i}},Heightfield.prototype.clearCachedConvexTrianglePillar=function(t,e,r){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,r)]},Heightfield.prototype.getConvexTrianglePillar=function(t,e,r){var n=this.pillarConvex,a=this.pillarOffset;if(this.cacheEnabled){var s=this.getCachedConvexTrianglePillar(t,e,r);if(s)return this.pillarConvex=s.convex,void(this.pillarOffset=s.offset);n=new i,a=new o,this.pillarConvex=n,this.pillarOffset=a}var s=this.data,c=this.elementSize,u=n.faces;n.vertices.length=6;for(var l=0;l<6;l++)n.vertices[l]||(n.vertices[l]=new o);u.length=5;for(var l=0;l<5;l++)u[l]||(u[l]=[]);var p=n.vertices,f=(Math.min(s[t][e],s[t+1][e],s[t][e+1],s[t+1][e+1])-this.minValue)/2+this.minValue;r?(a.set((t+.75)*c,(e+.75)*c,f),p[0].set(.25*c,.25*c,s[t+1][e+1]-f),p[1].set(-.75*c,.25*c,s[t][e+1]-f),p[2].set(.25*c,-.75*c,s[t+1][e]-f),p[3].set(.25*c,.25*c,-f-1),p[4].set(-.75*c,.25*c,-f-1),p[5].set(.25*c,-.75*c,-f-1),u[0][0]=0,u[0][1]=1,u[0][2]=2,u[1][0]=5,u[1][1]=4,u[1][2]=3,u[2][0]=2,u[2][1]=5,u[2][2]=3,u[2][3]=0,u[3][0]=3,u[3][1]=4,u[3][2]=1,u[3][3]=0,u[4][0]=1,u[4][1]=4,u[4][2]=5,u[4][3]=2):(a.set((t+.25)*c,(e+.25)*c,f),p[0].set(-.25*c,-.25*c,s[t][e]-f),p[1].set(.75*c,-.25*c,s[t+1][e]-f),p[2].set(-.25*c,.75*c,s[t][e+1]-f),p[3].set(-.25*c,-.25*c,-f-1),p[4].set(.75*c,-.25*c,-f-1),p[5].set(-.25*c,.75*c,-f-1),u[0][0]=0,u[0][1]=1,u[0][2]=2,u[1][0]=5,u[1][1]=4,u[1][2]=3,u[2][0]=0,u[2][1]=2,u[2][2]=5,u[2][3]=3,u[3][0]=1,u[3][1]=0,u[3][2]=3,u[3][3]=4,u[4][0]=4,u[4][1]=5,u[4][2]=2,u[4][3]=1),n.computeNormals(),n.computeEdges(),n.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(t,e,r,n,a)},Heightfield.prototype.calculateLocalInertia=function(t,e){return(e=e||new o).set(0,0,0),e},Heightfield.prototype.volume=function(){return Number.MAX_VALUE},Heightfield.prototype.calculateWorldAABB=function(t,e,r,n){r.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),n.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},Heightfield.prototype.updateBoundingSphereRadius=function(){var t=this.data,e=this.elementSize;this.boundingSphereRadius=new o(t.length*e,t[0].length*e,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,e,r){e.exports=Particle;var n=t("./Shape"),i=t("../math/Vec3");function Particle(){n.call(this),this.type=n.types.PARTICLE}Particle.prototype=new n,Particle.prototype.constructor=Particle,Particle.prototype.calculateLocalInertia=function(t,e){return(e=e||new i).set(0,0,0),e},Particle.prototype.volume=function(){return 0},Particle.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},Particle.prototype.calculateWorldAABB=function(t,e,r,n){r.copy(t),n.copy(t)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,e,r){e.exports=Plane;var n=t("./Shape"),i=t("../math/Vec3");function Plane(){n.call(this),this.type=n.types.PLANE,this.worldNormal=new i,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}Plane.prototype=new n,Plane.prototype.constructor=Plane,Plane.prototype.computeWorldNormal=function(t){var e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1},Plane.prototype.calculateLocalInertia=function(t,e){return e=e||new i},Plane.prototype.volume=function(){return Number.MAX_VALUE};var o=new i;Plane.prototype.calculateWorldAABB=function(t,e,r,n){o.set(0,0,1),e.vmult(o,o);var i=Number.MAX_VALUE;r.set(-i,-i,-i),n.set(i,i,i),1===o.x&&(n.x=t.x),1===o.y&&(n.y=t.y),1===o.z&&(n.z=t.z),-1===o.x&&(r.x=t.x),-1===o.y&&(r.y=t.y),-1===o.z&&(r.z=t.z)},Plane.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,e,r){e.exports=n;var n=t("./Shape");function n(){this.id=n.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material"),n.prototype.constructor=n,n.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},n.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},n.prototype.calculateLocalInertia=function(t,e){throw"calculateLocalInertia() not implemented for shape type "+this.type},n.idCounter=0,n.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,e,r){e.exports=Sphere;var n=t("./Shape"),i=t("../math/Vec3");function Sphere(t){if(n.call(this),this.radius=void 0!==t?Number(t):1,this.type=n.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}Sphere.prototype=new n,Sphere.prototype.constructor=Sphere,Sphere.prototype.calculateLocalInertia=function(t,e){e=e||new i;var r=2*t*this.radius*this.radius/5;return e.x=r,e.y=r,e.z=r,e},Sphere.prototype.volume=function(){return 4*Math.PI*this.radius/3},Sphere.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},Sphere.prototype.calculateWorldAABB=function(t,e,r,n){for(var i=this.radius,o=["x","y","z"],a=0;a<o.length;a++){var s=o[a];r[s]=t[s]-i,n[s]=t[s]+i}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,e,r){e.exports=Trimesh;var n=t("./Shape"),i=t("../math/Vec3"),o=(t("../math/Quaternion"),t("../math/Transform")),a=t("../collision/AABB"),s=t("../utils/Octree");function Trimesh(t,e){n.call(this),this.type=n.types.TRIMESH,this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new a,this.edges=null,this.scale=new i(1,1,1),this.tree=new s,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}Trimesh.prototype=new n,Trimesh.prototype.constructor=Trimesh;var c=new i;Trimesh.prototype.updateTree=function(){var t=this.tree;t.reset(),t.aabb.copy(this.aabb);var e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;for(var r=new a,n=new i,o=new i,s=new i,c=[n,o,s],u=0;u<this.indices.length/3;u++){var l=3*u;this._getUnscaledVertex(this.indices[l],n),this._getUnscaledVertex(this.indices[l+1],o),this._getUnscaledVertex(this.indices[l+2],s),r.setFromPoints(c),t.insert(r,u)}t.removeEmptyNodes()};var u=new a;Trimesh.prototype.getTrianglesInAABB=function(t,e){u.copy(t);var r=this.scale,n=r.x,i=r.y,o=r.z,a=u.lowerBound,s=u.upperBound;return a.x/=n,a.y/=i,a.z/=o,s.x/=n,s.y/=i,s.z/=o,this.tree.aabbQuery(u,e)},Trimesh.prototype.setScale=function(t){var e=this.scale.x===this.scale.y===this.scale.z,r=t.x===t.y===t.z;e&&r||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()},Trimesh.prototype.updateNormals=function(){for(var t=c,e=this.normals,r=0;r<this.indices.length/3;r++){var n=3*r,i=this.indices[n],o=this.indices[n+1],a=this.indices[n+2];this.getVertex(i,d),this.getVertex(o,y),this.getVertex(a,m),Trimesh.computeNormal(y,d,m,t),e[n]=t.x,e[n+1]=t.y,e[n+2]=t.z}},Trimesh.prototype.updateEdges=function(){for(var t={},e=function(e,r){var n=i<o?i+"_"+o:o+"_"+i;t[n]=!0},r=0;r<this.indices.length/3;r++){var n=3*r,i=this.indices[n],o=this.indices[n+1];this.indices[n+2];e(),e(),e()}var a=Object.keys(t);this.edges=new Int16Array(2*a.length);for(var r=0;r<a.length;r++){var s=a[r].split("_");this.edges[2*r]=parseInt(s[0],10),this.edges[2*r+1]=parseInt(s[1],10)}},Trimesh.prototype.getEdgeVertex=function(t,e,r){var n=this.edges[2*t+(e?1:0)];this.getVertex(n,r)};var l=new i,p=new i;Trimesh.prototype.getEdgeVector=function(t,e){var r=l,n=p;this.getEdgeVertex(t,0,r),this.getEdgeVertex(t,1,n),n.vsub(r,e)};var f=new i,h=new i;Trimesh.computeNormal=function(t,e,r,n){e.vsub(t,h),r.vsub(e,f),f.cross(h,n),n.isZero()||n.normalize()};var d=new i,y=new i,m=new i;Trimesh.prototype.getVertex=function(t,e){var r=this.scale;return this._getUnscaledVertex(t,e),e.x*=r.x,e.y*=r.y,e.z*=r.z,e},Trimesh.prototype._getUnscaledVertex=function(t,e){var r=3*t,n=this.vertices;return e.set(n[r],n[r+1],n[r+2])},Trimesh.prototype.getWorldVertex=function(t,e,r,n){return this.getVertex(t,n),o.pointToWorldFrame(e,r,n,n),n},Trimesh.prototype.getTriangleVertices=function(t,e,r,n){var i=3*t;this.getVertex(this.indices[i],e),this.getVertex(this.indices[i+1],r),this.getVertex(this.indices[i+2],n)},Trimesh.prototype.getNormal=function(t,e){var r=3*t;return e.set(this.normals[r],this.normals[r+1],this.normals[r+2])};var v=new a;Trimesh.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(v);var r=v.upperBound.x-v.lowerBound.x,n=v.upperBound.y-v.lowerBound.y,i=v.upperBound.z-v.lowerBound.z;return e.set(1/12*t*(2*n*2*n+2*i*2*i),1/12*t*(2*r*2*r+2*i*2*i),1/12*t*(2*n*2*n+2*r*2*r))};var g=new i;Trimesh.prototype.computeLocalAABB=function(t){var e=t.lowerBound,r=t.upperBound,n=this.vertices.length,i=(this.vertices,g);this.getVertex(0,i),e.copy(i),r.copy(i);for(var o=0;o!==n;o++)this.getVertex(o,i),i.x<e.x?e.x=i.x:i.x>r.x&&(r.x=i.x),i.y<e.y?e.y=i.y:i.y>r.y&&(r.y=i.y),i.z<e.z?e.z=i.z:i.z>r.z&&(r.z=i.z)},Trimesh.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},Trimesh.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,r=new i,n=0,o=e.length/3;n!==o;n++){this.getVertex(n,r);var a=r.norm2();a>t&&(t=a)}this.boundingSphereRadius=Math.sqrt(t)},new i;var _=new o,b=new a;Trimesh.prototype.calculateWorldAABB=function(t,e,r,n){var i=_,o=b;i.position=t,i.quaternion=e,this.aabb.toWorldFrame(i,o),r.copy(o.lowerBound),n.copy(o.upperBound)},Trimesh.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},Trimesh.createTorus=function(t,e,r,n,i){t=t||1,e=e||.5,r=r||8,n=n||6,i=i||2*Math.PI;for(var o=[],a=[],s=0;s<=r;s++)for(var c=0;c<=n;c++){var u=c/n*i,l=s/r*Math.PI*2,p=(t+e*Math.cos(l))*Math.cos(u),f=(t+e*Math.cos(l))*Math.sin(u),h=e*Math.sin(l);o.push(p,f,h)}for(var s=1;s<=r;s++)for(var c=1;c<=n;c++){var d=(n+1)*s+c-1,y=(n+1)*(s-1)+c-1,m=(n+1)*(s-1)+c,v=(n+1)*s+c;a.push(d,y,v),a.push(y,m,v)}return new Trimesh(o,a)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,e,r){e.exports=GSSolver,t("../math/Vec3"),t("../math/Quaternion");var n=t("./Solver");function GSSolver(){n.call(this),this.iterations=10,this.tolerance=1e-7}GSSolver.prototype=new n;var i=[],o=[],a=[];GSSolver.prototype.solve=function(t,e){var r,n,s,c,u,l,p=0,f=this.iterations,h=this.tolerance*this.tolerance,d=this.equations,y=d.length,m=e.bodies,v=m.length,g=t;if(0!==y)for(var _=0;_!==v;_++)m[_].updateSolveMassProperties();var b=o,w=a,P=i;b.length=y,w.length=y,P.length=y;for(var _=0;_!==y;_++){var x=d[_];P[_]=0,w[_]=x.computeB(g),b[_]=1/x.computeC()}if(0!==y){for(var _=0;_!==v;_++){var O=m[_],C=O.vlambda,S=O.wlambda;C.set(0,0,0),S&&S.set(0,0,0)}for(p=0;p!==f;p++){c=0;for(var R=0;R!==y;R++){var x=d[R];r=w[R],n=b[R],l=P[R],u=x.computeGWlambda(),s=n*(r-u-x.eps*l),l+s<x.minForce?s=x.minForce-l:l+s>x.maxForce&&(s=x.maxForce-l),P[R]+=s,c+=s>0?s:-s,x.addToWlambda(s)}if(c*c<h)break}for(var _=0;_!==v;_++){var O=m[_],j=O.velocity,T=O.angularVelocity;j.vadd(O.vlambda,j),T&&T.vadd(O.wlambda,T)}}return p}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,e,r){function Solver(){this.equations=[]}e.exports=Solver,Solver.prototype.solve=function(t,e){return 0},Solver.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},Solver.prototype.removeEquation=function(t){var e=this.equations,r=e.indexOf(t);-1!==r&&e.splice(r,1)},Solver.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,e,r){e.exports=SplitSolver,t("../math/Vec3"),t("../math/Quaternion");var n=t("./Solver"),i=t("../objects/Body");function SplitSolver(t){for(n.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=t,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}SplitSolver.prototype=new n;var o=[],a=[],s={bodies:[]},c=i.STATIC;function getUnvisitedNode(t){for(var e=t.length,r=0;r!==e;r++){var n=t[r];if(!(n.visited||n.body.type&c))return n}return!1}var u=[];function bfs(t,e,r,n){for(u.push(t),t.visited=!0,e(t,r,n);u.length;)for(var i,o=u.pop();i=getUnvisitedNode(o.children);)i.visited=!0,e(i,r,n),u.push(i)}function visitFunc(t,e,r){e.push(t.body);for(var n=t.eqs.length,i=0;i!==n;i++){var o=t.eqs[i];-1===r.indexOf(o)&&r.push(o)}}function sortById(t,e){return e.id-t.id}SplitSolver.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},SplitSolver.prototype.solve=function(t,e){for(var r=o,n=this.nodePool,i=e.bodies,c=this.equations,u=c.length,l=i.length,p=this.subsolver;n.length<l;)n.push(this.createNode());r.length=l;for(var f=0;f<l;f++)r[f]=n[f];for(var f=0;f!==l;f++){var h=r[f];h.body=i[f],h.children.length=0,h.eqs.length=0,h.visited=!1}for(var d=0;d!==u;d++){var y=c[d],f=i.indexOf(y.bi),m=i.indexOf(y.bj),v=r[f],g=r[m];v.children.push(g),v.eqs.push(y),g.children.push(v),g.eqs.push(y)}var _,b=0,w=a;p.tolerance=this.tolerance,p.iterations=this.iterations;for(var P=s;_=getUnvisitedNode(r);){w.length=0,P.bodies.length=0,bfs(_,visitFunc,P.bodies,w);var x=w.length;w=w.sort(sortById);for(var f=0;f!==x;f++)p.addEquation(w[f]);p.solve(t,P),p.removeAllEquations(),b++}return b}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,e,r){var n=function(){};e.exports=n,n.prototype={constructor:n,addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var r=this._listeners;return void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(e)&&r[t].push(e),this},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return this;var r=this._listeners;if(void 0===r[t])return this;var n=r[t].indexOf(e);return-1!==n&&r[t].splice(n,1),this},dispatchEvent:function(t){if(void 0===this._listeners)return this;var e=this._listeners,r=e[t.type];if(void 0!==r){t.target=this;for(var n=0,i=r.length;n<i;n++)r[n].call(this,t)}return this}}},{}],50:[function(t,e,r){var n=t("../collision/AABB"),i=t("../math/Vec3");function OctreeNode(t){t=t||{},this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new n,this.data=[],this.children=[]}function Octree(t,e){(e=e||{}).root=null,e.aabb=t,OctreeNode.call(this,e),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}e.exports=Octree,Octree.prototype=new OctreeNode,OctreeNode.prototype.reset=function(t,e){this.children.length=this.data.length=0},OctreeNode.prototype.insert=function(t,e,r){var n=this.data;if(r=r||0,!this.aabb.contains(t))return!1;var i=this.children;if(r<(this.maxDepth||this.root.maxDepth)){var o=!1;i.length||(this.subdivide(),o=!0);for(var a=0;8!==a;a++)if(i[a].insert(t,e,r+1))return!0;o&&(i.length=0)}return n.push(e),!0};var o=new i;OctreeNode.prototype.subdivide=function(){var t=this.aabb,e=t.lowerBound,r=t.upperBound,a=this.children;a.push(new OctreeNode({aabb:new n({lowerBound:new i(0,0,0)})}),new OctreeNode({aabb:new n({lowerBound:new i(1,0,0)})}),new OctreeNode({aabb:new n({lowerBound:new i(1,1,0)})}),new OctreeNode({aabb:new n({lowerBound:new i(1,1,1)})}),new OctreeNode({aabb:new n({lowerBound:new i(0,1,1)})}),new OctreeNode({aabb:new n({lowerBound:new i(0,0,1)})}),new OctreeNode({aabb:new n({lowerBound:new i(1,0,1)})}),new OctreeNode({aabb:new n({lowerBound:new i(0,1,0)})})),r.vsub(e,o),o.scale(.5,o);for(var s=this.root||this,c=0;8!==c;c++){var u=a[c];u.root=s;var l=u.aabb.lowerBound;l.x*=o.x,l.y*=o.y,l.z*=o.z,l.vadd(e,l),l.vadd(o,u.aabb.upperBound)}},OctreeNode.prototype.aabbQuery=function(t,e){this.data,this.children;for(var r=[this];r.length;){var n=r.pop();n.aabb.overlaps(t)&&Array.prototype.push.apply(e,n.data),Array.prototype.push.apply(r,n.children)}return e};var a=new n;OctreeNode.prototype.rayQuery=function(t,e,r){return t.getAABB(a),a.toLocalFrame(e,a),this.aabbQuery(a,r),r},OctreeNode.prototype.removeEmptyNodes=function(){for(var t=[this];t.length;){for(var e=t.pop(),r=e.children.length-1;r>=0;r--)e.children[r].data.length||e.children.splice(r,1);Array.prototype.push.apply(t,e.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,e,r){function Pool(){this.objects=[],this.type=Object}e.exports=Pool,Pool.prototype.release=function(){for(var t=arguments.length,e=0;e!==t;e++)this.objects.push(arguments[e])},Pool.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},Pool.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,e,r){function TupleDictionary(){this.data={keys:[]}}e.exports=TupleDictionary,TupleDictionary.prototype.get=function(t,e){if(t>e){var r=e;e=t,t=r}return this.data[t+"-"+e]},TupleDictionary.prototype.set=function(t,e,r){if(t>e){var n=e;e=t,t=n}var i=t+"-"+e;this.get(t,e)||this.data.keys.push(i),this.data[i]=r},TupleDictionary.prototype.reset=function(){for(var t=this.data,e=t.keys;e.length>0;){var r=e.pop();delete t[r]}}},{}],53:[function(t,e,r){function Utils(){}e.exports=Utils,Utils.defaults=function(t,e){for(var r in t=t||{},e)r in t||(t[r]=e[r]);return t}},{}],54:[function(t,e,r){e.exports=Vec3Pool;var n=t("../math/Vec3"),i=t("./Pool");function Vec3Pool(){i.call(this),this.type=n}Vec3Pool.prototype=new i,Vec3Pool.prototype.constructObject=function(){return new n}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,e,r){e.exports=Narrowphase;var n=t("../collision/AABB"),i=t("../shapes/Shape"),o=t("../collision/Ray"),a=t("../math/Vec3"),s=t("../math/Transform"),c=(t("../shapes/ConvexPolyhedron"),t("../math/Quaternion")),u=(t("../solver/Solver"),t("../utils/Vec3Pool")),l=t("../equations/ContactEquation"),p=t("../equations/FrictionEquation");function Narrowphase(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new u,this.world=t,this.currentContactMaterial=null,this.enableFrictionReduction=!1}Narrowphase.prototype.createContactEquation=function(t,e,r,n,i,o){var a;this.contactPointPool.length?((a=this.contactPointPool.pop()).bi=t,a.bj=e):a=new l(t,e),a.enabled=t.collisionResponse&&e.collisionResponse&&r.collisionResponse&&n.collisionResponse;var s=this.currentContactMaterial;a.restitution=s.restitution,a.setSpookParams(s.contactEquationStiffness,s.contactEquationRelaxation,this.world.dt);var c=r.material||t.material,u=n.material||e.material;return c&&u&&c.restitution>=0&&u.restitution>=0&&(a.restitution=c.restitution*u.restitution),a.si=i||r,a.sj=o||n,a},Narrowphase.prototype.createFrictionEquationsFromContact=function(t,e){var r=t.bi,n=t.bj,i=t.si,o=t.sj,a=this.world,s=this.currentContactMaterial,c=s.friction,u=i.material||r.material,l=o.material||n.material;if(u&&l&&u.friction>=0&&l.friction>=0&&(c=u.friction*l.friction),c>0){var f=c*a.gravity.length(),h=r.invMass+n.invMass;h>0&&(h=1/h);var d=this.frictionEquationPool,y=d.length?d.pop():new p(r,n,f*h),m=d.length?d.pop():new p(r,n,f*h);return y.bi=m.bi=r,y.bj=m.bj=n,y.minForce=m.minForce=-f*h,y.maxForce=m.maxForce=f*h,y.ri.copy(t.ri),y.rj.copy(t.rj),m.ri.copy(t.ri),m.rj.copy(t.rj),t.ni.tangents(y.t,m.t),y.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),m.setSpookParams(s.frictionEquationStiffness,s.frictionEquationRelaxation,a.dt),y.enabled=m.enabled=t.enabled,e.push(y,m),!0}return!1};var f=new a,h=new a,d=new a;Narrowphase.prototype.createFrictionFromAverage=function(t){var e=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(e,this.frictionResult)&&1!==t){var r=this.frictionResult[this.frictionResult.length-2],n=this.frictionResult[this.frictionResult.length-1];f.setZero(),h.setZero(),d.setZero();for(var i=e.bi,o=(e.bj,0);o!==t;o++)(e=this.result[this.result.length-1-o]).bodyA!==i?(f.vadd(e.ni,f),h.vadd(e.ri,h),d.vadd(e.rj,d)):(f.vsub(e.ni,f),h.vadd(e.rj,h),d.vadd(e.ri,d));var a=1/t;h.scale(a,r.ri),d.scale(a,r.rj),n.ri.copy(r.ri),n.rj.copy(r.rj),f.normalize(),f.tangents(r.t,n.t)}};var y=new a,m=new a,v=new c,g=new c;Narrowphase.prototype.getContacts=function(t,e,r,n,i,o,a){this.contactPointPool=i,this.frictionEquationPool=a,this.result=n,this.frictionResult=o;for(var s=v,c=g,u=y,l=m,p=0,f=t.length;p!==f;p++){var h=t[p],d=e[p],_=null;h.material&&d.material&&(_=r.getContactMaterial(h.material,d.material)||null);for(var b=0;b<h.shapes.length;b++){h.quaternion.mult(h.shapeOrientations[b],s),h.quaternion.vmult(h.shapeOffsets[b],u),u.vadd(h.position,u);for(var w=h.shapes[b],P=0;P<d.shapes.length;P++){d.quaternion.mult(d.shapeOrientations[P],c),d.quaternion.vmult(d.shapeOffsets[P],l),l.vadd(d.position,l);var x=d.shapes[P];if(!(u.distanceTo(l)>w.boundingSphereRadius+x.boundingSphereRadius)){var O=null;w.material&&x.material&&(O=r.getContactMaterial(w.material,x.material)||null),this.currentContactMaterial=O||_||r.defaultContactMaterial;var C=this[w.type|x.type];C&&(w.type<x.type?C.call(this,w,x,u,l,s,c,h,d,w,x):C.call(this,x,w,l,u,c,s,d,h,w,x))}}}}},Narrowphase.prototype[i.types.BOX|i.types.BOX]=Narrowphase.prototype.boxBox=function(t,e,r,n,i,o,a,s){t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,r,n,i,o,a,s,t,e)},Narrowphase.prototype[i.types.BOX|i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.boxConvex=function(t,e,r,n,i,o,a,s){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,r,n,i,o,a,s,t,e)},Narrowphase.prototype[i.types.BOX|i.types.PARTICLE]=Narrowphase.prototype.boxParticle=function(t,e,r,n,i,o,a,s){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,r,n,i,o,a,s,t,e)},Narrowphase.prototype[i.types.SPHERE]=Narrowphase.prototype.sphereSphere=function(t,e,r,n,i,o,a,s){var c=this.createContactEquation(a,s,t,e);n.vsub(r,c.ni),c.ni.normalize(),c.ri.copy(c.ni),c.rj.copy(c.ni),c.ri.mult(t.radius,c.ri),c.rj.mult(-e.radius,c.rj),c.ri.vadd(r,c.ri),c.ri.vsub(a.position,c.ri),c.rj.vadd(n,c.rj),c.rj.vsub(s.position,c.rj),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)};var _=new a,b=new a,w=new a;Narrowphase.prototype[i.types.PLANE|i.types.TRIMESH]=Narrowphase.prototype.planeTrimesh=function(t,e,r,n,i,o,c,u){var l=new a,p=_;p.set(0,0,1),i.vmult(p,p);for(var f=0;f<e.vertices.length/3;f++){e.getVertex(f,l);var h=new a;h.copy(l),s.pointToWorldFrame(n,o,h,l);var d=b;l.vsub(r,d);var y=p.dot(d);if(y<=0){var m=this.createContactEquation(c,u,t,e);m.ni.copy(p);var v=w;p.scale(d.dot(p),v),l.vsub(v,v),m.ri.copy(v),m.ri.vsub(c.position,m.ri),m.rj.copy(l),m.rj.vsub(u.position,m.rj),this.result.push(m),this.createFrictionEquationsFromContact(m,this.frictionResult)}}};var P=new a,x=new a,O=(new a,new a),C=new a,S=new a,R=new a,j=new a,T=new a,E=new a,B=new a,A=new a,I=new a,M=new a,k=new n,z=[];Narrowphase.prototype[i.types.SPHERE|i.types.TRIMESH]=Narrowphase.prototype.sphereTrimesh=function(t,e,r,n,i,a,c,u){var l=S,p=R,f=j,h=T,d=E,y=B,m=k,v=C,g=x,_=z;s.pointToLocalFrame(n,a,r,d);var b=t.radius;m.lowerBound.set(d.x-b,d.y-b,d.z-b),m.upperBound.set(d.x+b,d.y+b,d.z+b),e.getTrianglesInAABB(m,_);for(var w=O,F=t.radius*t.radius,D=0;D<_.length;D++)for(var N=0;N<3;N++)if(e.getVertex(e.indices[3*_[D]+N],w),w.vsub(d,g),g.norm2()<=F){v.copy(w),s.pointToWorldFrame(n,a,v,w),w.vsub(r,g);var L=this.createContactEquation(c,u,t,e);L.ni.copy(g),L.ni.normalize(),L.ri.copy(L.ni),L.ri.scale(t.radius,L.ri),L.ri.vadd(r,L.ri),L.ri.vsub(c.position,L.ri),L.rj.copy(w),L.rj.vsub(u.position,L.rj),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult)}for(var D=0;D<_.length;D++)for(var N=0;N<3;N++){e.getVertex(e.indices[3*_[D]+N],l),e.getVertex(e.indices[3*_[D]+(N+1)%3],p),p.vsub(l,f),d.vsub(p,y);var V=y.dot(f);d.vsub(l,y);var U=y.dot(f);if(U>0&&V<0){d.vsub(l,y),h.copy(f),h.normalize(),U=y.dot(h),h.scale(U,y),y.vadd(l,y);var W=y.distanceTo(d);if(W<t.radius){var L=this.createContactEquation(c,u,t,e);y.vsub(d,L.ni),L.ni.normalize(),L.ni.scale(t.radius,L.ri),s.pointToWorldFrame(n,a,y,y),y.vsub(u.position,L.rj),s.vectorToWorldFrame(a,L.ni,L.ni),s.vectorToWorldFrame(a,L.ri,L.ri),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult)}}}for(var q=A,G=I,H=M,X=P,D=0,K=_.length;D!==K;D++){e.getTriangleVertices(_[D],q,G,H),e.getNormal(_[D],X),d.vsub(q,y);var W=y.dot(X);if(X.scale(W,y),d.vsub(y,y),W=y.distanceTo(d),o.pointInTriangle(y,q,G,H)&&W<t.radius){var L=this.createContactEquation(c,u,t,e);y.vsub(d,L.ni),L.ni.normalize(),L.ni.scale(t.radius,L.ri),s.pointToWorldFrame(n,a,y,y),y.vsub(u.position,L.rj),s.vectorToWorldFrame(a,L.ni,L.ni),s.vectorToWorldFrame(a,L.ri,L.ri),this.result.push(L),this.createFrictionEquationsFromContact(L,this.frictionResult)}}_.length=0};var F=new a,D=new a;Narrowphase.prototype[i.types.SPHERE|i.types.PLANE]=Narrowphase.prototype.spherePlane=function(t,e,r,n,i,o,a,s){var c=this.createContactEquation(a,s,t,e);if(c.ni.set(0,0,1),o.vmult(c.ni,c.ni),c.ni.negate(c.ni),c.ni.normalize(),c.ni.mult(t.radius,c.ri),r.vsub(n,F),c.ni.mult(c.ni.dot(F),D),F.vsub(D,c.rj),-F.dot(c.ni)<=t.radius){var u=c.ri,l=c.rj;u.vadd(r,u),u.vsub(a.position,u),l.vadd(n,l),l.vsub(s.position,l),this.result.push(c),this.createFrictionEquationsFromContact(c,this.frictionResult)}};var N=new a,L=new a,V=new a;function pointInPolygon(t,e,r){for(var n=null,i=t.length,o=0;o!==i;o++){var a=t[o],s=N;t[(o+1)%i].vsub(a,s);var c=L;s.cross(e,c);var u=V;r.vsub(a,u);var l=c.dot(u);if(!(null===n||l>0&&!0===n||l<=0&&!1===n))return!1;null===n&&(n=l>0)}return!0}var U=new a,W=new a,q=new a,G=new a,H=[new a,new a,new a,new a,new a,new a],X=new a,K=new a,Q=new a,Y=new a;Narrowphase.prototype[i.types.SPHERE|i.types.BOX]=Narrowphase.prototype.sphereBox=function(t,e,r,n,i,o,a,s){var c=this.v3pool,u=H;r.vsub(n,U),e.getSideNormals(u,o);for(var l=t.radius,p=!1,f=K,h=Q,d=Y,y=null,m=0,v=0,g=0,_=null,b=0,w=u.length;b!==w&&!1===p;b++){var P=W;P.copy(u[b]);var x=P.norm();P.normalize();var O=U.dot(P);if(O<x+l&&O>0){var C=q,S=G;C.copy(u[(b+1)%3]),S.copy(u[(b+2)%3]);var R=C.norm(),j=S.norm();C.normalize(),S.normalize();var T=U.dot(C),E=U.dot(S);if(T<R&&T>-R&&E<j&&E>-j){var B=Math.abs(O-x-l);(null===_||B<_)&&(_=B,v=T,g=E,y=x,f.copy(P),h.copy(C),d.copy(S),m++)}}}if(m){p=!0;var A=this.createContactEquation(a,s,t,e);f.mult(-l,A.ri),A.ni.copy(f),A.ni.negate(A.ni),f.mult(y,f),h.mult(v,h),f.vadd(h,f),d.mult(g,d),f.vadd(d,A.rj),A.ri.vadd(r,A.ri),A.ri.vsub(a.position,A.ri),A.rj.vadd(n,A.rj),A.rj.vsub(s.position,A.rj),this.result.push(A),this.createFrictionEquationsFromContact(A,this.frictionResult)}for(var I=c.get(),M=X,k=0;2!==k&&!p;k++)for(var z=0;2!==z&&!p;z++)for(var F=0;2!==F&&!p;F++)if(I.set(0,0,0),k?I.vadd(u[0],I):I.vsub(u[0],I),z?I.vadd(u[1],I):I.vsub(u[1],I),F?I.vadd(u[2],I):I.vsub(u[2],I),n.vadd(I,M),M.vsub(r,M),M.norm2()<l*l){p=!0;var A=this.createContactEquation(a,s,t,e);A.ri.copy(M),A.ri.normalize(),A.ni.copy(A.ri),A.ri.mult(l,A.ri),A.rj.copy(I),A.ri.vadd(r,A.ri),A.ri.vsub(a.position,A.ri),A.rj.vadd(n,A.rj),A.rj.vsub(s.position,A.rj),this.result.push(A),this.createFrictionEquationsFromContact(A,this.frictionResult)}c.release(I),I=null;for(var D=c.get(),N=c.get(),A=c.get(),L=c.get(),B=c.get(),V=u.length,k=0;k!==V&&!p;k++)for(var z=0;z!==V&&!p;z++)if(k%3!=z%3){u[z].cross(u[k],D),D.normalize(),u[k].vadd(u[z],N),A.copy(r),A.vsub(N,A),A.vsub(n,A);var Z=A.dot(D);D.mult(Z,L);for(var F=0;F===k%3||F===z%3;)F++;B.copy(r),B.vsub(L,B),B.vsub(N,B),B.vsub(n,B);var J=Math.abs(Z),$=B.norm();if(J<u[F].norm()&&$<l){p=!0;var tt=this.createContactEquation(a,s,t,e);N.vadd(L,tt.rj),tt.rj.copy(tt.rj),B.negate(tt.ni),tt.ni.normalize(),tt.ri.copy(tt.rj),tt.ri.vadd(n,tt.ri),tt.ri.vsub(r,tt.ri),tt.ri.normalize(),tt.ri.mult(l,tt.ri),tt.ri.vadd(r,tt.ri),tt.ri.vsub(a.position,tt.ri),tt.rj.vadd(n,tt.rj),tt.rj.vsub(s.position,tt.rj),this.result.push(tt),this.createFrictionEquationsFromContact(tt,this.frictionResult)}}c.release(D,N,A,L,B)};var Z=new a,J=new a,$=new a,tt=new a,et=new a,rt=new a,nt=new a,it=new a,ot=new a,at=new a;Narrowphase.prototype[i.types.SPHERE|i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.sphereConvex=function(t,e,r,n,i,o,a,s){var c=this.v3pool;r.vsub(n,Z);for(var u=e.faceNormals,l=e.faces,p=e.vertices,f=t.radius,h=0;h!==p.length;h++){var d=p[h],y=et;o.vmult(d,y),n.vadd(y,y);var m=tt;if(y.vsub(r,m),m.norm2()<f*f){g=!0;var v=this.createContactEquation(a,s,t,e);return v.ri.copy(m),v.ri.normalize(),v.ni.copy(v.ri),v.ri.mult(f,v.ri),y.vsub(n,v.rj),v.ri.vadd(r,v.ri),v.ri.vsub(a.position,v.ri),v.rj.vadd(n,v.rj),v.rj.vsub(s.position,v.rj),this.result.push(v),void this.createFrictionEquationsFromContact(v,this.frictionResult)}}for(var g=!1,h=0,_=l.length;h!==_&&!1===g;h++){var b=u[h],w=l[h],P=rt;o.vmult(b,P);var x=nt;o.vmult(p[w[0]],x),x.vadd(n,x);var O=it;P.mult(-f,O),r.vadd(O,O);var C=ot;O.vsub(x,C);var S=C.dot(P),R=at;if(r.vsub(x,R),S<0&&R.dot(P)>0){for(var j=[],T=0,E=w.length;T!==E;T++){var B=c.get();o.vmult(p[w[T]],B),n.vadd(B,B),j.push(B)}if(pointInPolygon(j,P,r)){g=!0;var v=this.createContactEquation(a,s,t,e);P.mult(-f,v.ri),P.negate(v.ni);var A=c.get();P.mult(-S,A);var I=c.get();P.mult(-f,I),r.vsub(n,v.rj),v.rj.vadd(I,v.rj),v.rj.vadd(A,v.rj),v.rj.vadd(n,v.rj),v.rj.vsub(s.position,v.rj),v.ri.vadd(r,v.ri),v.ri.vsub(a.position,v.ri),c.release(A),c.release(I),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult);for(var T=0,M=j.length;T!==M;T++)c.release(j[T]);return}for(var T=0;T!==w.length;T++){var k=c.get(),z=c.get();o.vmult(p[w[(T+1)%w.length]],k),o.vmult(p[w[(T+2)%w.length]],z),n.vadd(k,k),n.vadd(z,z);var F=J;z.vsub(k,F);var D=$;F.unit(D);var N=c.get(),L=c.get();r.vsub(k,L);var V=L.dot(D);D.mult(V,N),N.vadd(k,N);var U=c.get();if(N.vsub(r,U),V>0&&V*V<F.norm2()&&U.norm2()<f*f){var v=this.createContactEquation(a,s,t,e);N.vsub(n,v.rj),N.vsub(r,v.ni),v.ni.normalize(),v.ni.mult(f,v.ri),v.rj.vadd(n,v.rj),v.rj.vsub(s.position,v.rj),v.ri.vadd(r,v.ri),v.ri.vsub(a.position,v.ri),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult);for(var T=0,M=j.length;T!==M;T++)c.release(j[T]);return c.release(k),c.release(z),c.release(N),c.release(U),void c.release(L)}c.release(k),c.release(z),c.release(N),c.release(U),c.release(L)}for(var T=0,M=j.length;T!==M;T++)c.release(j[T])}}},new a,new a,Narrowphase.prototype[i.types.PLANE|i.types.BOX]=Narrowphase.prototype.planeBox=function(t,e,r,n,i,o,a,s){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.planeConvex(t,e.convexPolyhedronRepresentation,r,n,i,o,a,s)};var st=new a,ct=new a,ut=new a,lt=new a;Narrowphase.prototype[i.types.PLANE|i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.planeConvex=function(t,e,r,n,i,o,a,s){var c=st,u=ct;u.set(0,0,1),i.vmult(u,u);for(var l=0,p=ut,f=0;f!==e.vertices.length;f++){c.copy(e.vertices[f]),o.vmult(c,c),n.vadd(c,c),c.vsub(r,p);var h=u.dot(p);if(h<=0){var d=this.createContactEquation(a,s,t,e),y=lt;u.mult(u.dot(p),y),c.vsub(y,y),y.vsub(r,d.ri),d.ni.copy(u),c.vsub(n,d.rj),d.ri.vadd(r,d.ri),d.ri.vsub(a.position,d.ri),d.rj.vadd(n,d.rj),d.rj.vsub(s.position,d.rj),this.result.push(d),l++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(d,this.frictionResult)}}this.enableFrictionReduction&&l&&this.createFrictionFromAverage(l)};var pt=new a,ft=new a;Narrowphase.prototype[i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.convexConvex=function(t,e,r,n,i,o,a,s,c,u,l,p){var f=pt;if(!(r.distanceTo(n)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,r,i,n,o,f,l,p)){var h=[],d=ft;t.clipAgainstHull(r,i,e,n,o,f,-100,100,h);for(var y=0,m=0;m!==h.length;m++){var v=this.createContactEquation(a,s,t,e,c,u),g=v.ri,_=v.rj;f.negate(v.ni),h[m].normal.negate(d),d.mult(h[m].depth,d),h[m].point.vadd(d,g),_.copy(h[m].point),g.vsub(r,g),_.vsub(n,_),g.vadd(r,g),g.vsub(a.position,g),_.vadd(n,_),_.vsub(s.position,_),this.result.push(v),y++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(v,this.frictionResult)}this.enableFrictionReduction&&y&&this.createFrictionFromAverage(y)}};var ht=new a,dt=new a,yt=new a;Narrowphase.prototype[i.types.PLANE|i.types.PARTICLE]=Narrowphase.prototype.planeParticle=function(t,e,r,n,i,o,a,s){var c=ht;c.set(0,0,1),a.quaternion.vmult(c,c);var u=dt;n.vsub(a.position,u);var l=c.dot(u);if(l<=0){var p=this.createContactEquation(s,a,e,t);p.ni.copy(c),p.ni.negate(p.ni),p.ri.set(0,0,0);var f=yt;c.mult(c.dot(n),f),n.vsub(f,f),p.rj.copy(f),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}};var mt=new a;Narrowphase.prototype[i.types.PARTICLE|i.types.SPHERE]=Narrowphase.prototype.sphereParticle=function(t,e,r,n,i,o,a,s){var c=mt;c.set(0,0,1),n.vsub(r,c);var u=c.norm2();if(u<=t.radius*t.radius){var l=this.createContactEquation(s,a,e,t);c.normalize(),l.rj.copy(c),l.rj.mult(t.radius,l.rj),l.ni.copy(c),l.ni.negate(l.ni),l.ri.set(0,0,0),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)}};var vt=new c,gt=new a,_t=(new a,new a),bt=new a,wt=new a;Narrowphase.prototype[i.types.PARTICLE|i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.convexParticle=function(t,e,r,n,i,o,a,s){var c=-1,u=_t,l=wt,p=null,f=gt;if(f.copy(n),f.vsub(r,f),i.conjugate(vt),vt.vmult(f,f),t.pointIsInside(f)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(r,i),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(i);for(var h=0,d=t.faces.length;h!==d;h++){var y=[t.worldVertices[t.faces[h][0]]],m=t.worldFaceNormals[h];n.vsub(y[0],bt);var v=-m.dot(bt);(null===p||Math.abs(v)<Math.abs(p))&&(p=v,c=h,u.copy(m))}if(-1!==c){var g=this.createContactEquation(s,a,e,t);u.mult(p,l),l.vadd(n,l),l.vsub(r,l),g.rj.copy(l),u.negate(g.ni),g.ri.set(0,0,0);var _=g.ri,b=g.rj;_.vadd(n,_),_.vsub(s.position,_),b.vadd(r,b),b.vsub(a.position,b),this.result.push(g),this.createFrictionEquationsFromContact(g,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},Narrowphase.prototype[i.types.BOX|i.types.HEIGHTFIELD]=Narrowphase.prototype.boxHeightfield=function(t,e,r,n,i,o,a,s){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,r,n,i,o,a,s)};var Pt=new a,xt=new a,Ot=[0];Narrowphase.prototype[i.types.CONVEXPOLYHEDRON|i.types.HEIGHTFIELD]=Narrowphase.prototype.convexHeightfield=function(t,e,r,n,i,o,a,c){var u=e.data,l=e.elementSize,p=t.boundingSphereRadius,f=xt,h=Ot,d=Pt;s.pointToLocalFrame(n,o,r,d);var y=Math.floor((d.x-p)/l)-1,m=Math.ceil((d.x+p)/l)+1,v=Math.floor((d.y-p)/l)-1,g=Math.ceil((d.y+p)/l)+1;if(!(m<0||g<0||y>u.length||v>u[0].length)){y<0&&(y=0),m<0&&(m=0),v<0&&(v=0),g<0&&(g=0),y>=u.length&&(y=u.length-1),m>=u.length&&(m=u.length-1),g>=u[0].length&&(g=u[0].length-1),v>=u[0].length&&(v=u[0].length-1);var _=[];e.getRectMinMax(y,v,m,g,_);var b=_[0],w=_[1];if(!(d.z-p>w||d.z+p<b))for(var P=y;P<m;P++)for(var x=v;x<g;x++)e.getConvexTrianglePillar(P,x,!1),s.pointToWorldFrame(n,o,e.pillarOffset,f),r.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,r,f,i,o,a,c,null,null,h,null),e.getConvexTrianglePillar(P,x,!0),s.pointToWorldFrame(n,o,e.pillarOffset,f),r.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,r,f,i,o,a,c,null,null,h,null)}};var Ct=new a,St=new a;Narrowphase.prototype[i.types.SPHERE|i.types.HEIGHTFIELD]=Narrowphase.prototype.sphereHeightfield=function(t,e,r,n,i,o,a,c){var u=e.data,l=t.radius,p=e.elementSize,f=St,h=Ct;s.pointToLocalFrame(n,o,r,h);var d=Math.floor((h.x-l)/p)-1,y=Math.ceil((h.x+l)/p)+1,m=Math.floor((h.y-l)/p)-1,v=Math.ceil((h.y+l)/p)+1;if(!(y<0||v<0||d>u.length||v>u[0].length)){d<0&&(d=0),y<0&&(y=0),m<0&&(m=0),v<0&&(v=0),d>=u.length&&(d=u.length-1),y>=u.length&&(y=u.length-1),v>=u[0].length&&(v=u[0].length-1),m>=u[0].length&&(m=u[0].length-1);var g=[];e.getRectMinMax(d,m,y,v,g);var _=g[0],b=g[1];if(!(h.z-l>b||h.z+l<_))for(var w=this.result,P=d;P<y;P++)for(var x=m;x<v;x++){var O=w.length;e.getConvexTrianglePillar(P,x,!1),s.pointToWorldFrame(n,o,e.pillarOffset,f),r.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,r,f,i,o,a,c),e.getConvexTrianglePillar(P,x,!0),s.pointToWorldFrame(n,o,e.pillarOffset,f),r.distanceTo(f)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,r,f,i,o,a,c);var C=w.length-O;if(C>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,e,r){e.exports=World;var n=t("../shapes/Shape"),i=t("../math/Vec3"),o=t("../math/Quaternion"),a=t("../solver/GSSolver"),s=(t("../utils/Vec3Pool"),t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("./Narrowphase")),c=t("../utils/EventTarget"),u=t("../collision/ArrayCollisionMatrix"),l=t("../material/Material"),p=t("../material/ContactMaterial"),f=t("../objects/Body"),h=t("../utils/TupleDictionary"),d=t("../collision/RaycastResult"),y=t("../collision/AABB"),m=t("../collision/Ray"),v=t("../collision/NaiveBroadphase");function World(){c.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new i,this.broadphase=new v,this.bodies=[],this.solver=new a,this.constraints=[],this.narrowphase=new s(this),this.collisionMatrix=new u,this.collisionMatrixPrevious=new u,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new h,this.defaultMaterial=new l("default"),this.defaultContactMaterial=new p(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}World.prototype=new c,new y;var g=new m;if(World.prototype.getContactMaterial=function(t,e){return this.contactMaterialTable.get(t.id,e.id)},World.prototype.numObjects=function(){return this.bodies.length},World.prototype.collisionMatrixTick=function(){var t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset()},World.prototype.add=World.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof f&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.dispatchEvent(this.addBodyEvent))},World.prototype.addConstraint=function(t){this.constraints.push(t)},World.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)},World.prototype.rayTest=function(t,e,r){r instanceof d?this.raycastClosest(t,e,{skipBackfaces:!0},r):this.raycastAll(t,e,{skipBackfaces:!0},r)},World.prototype.raycastAll=function(t,e,r,n){return r.mode=m.ALL,r.from=t,r.to=e,r.callback=n,g.intersectWorld(this,r)},World.prototype.raycastAny=function(t,e,r,n){return r.mode=m.ANY,r.from=t,r.to=e,r.result=n,g.intersectWorld(this,r)},World.prototype.raycastClosest=function(t,e,r,n){return r.mode=m.CLOSEST,r.from=t,r.to=e,r.result=n,g.intersectWorld(this,r)},World.prototype.remove=function(t){t.world=null;var e=this.bodies.length-1,r=this.bodies,n=r.indexOf(t);if(-1!==n){r.splice(n,1);for(var i=0;i!==r.length;i++)r[i].index=i;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,this.dispatchEvent(this.removeBodyEvent)}},World.prototype.removeBody=World.prototype.remove,World.prototype.addMaterial=function(t){this.materials.push(t)},World.prototype.addContactMaterial=function(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)},"undefined"==typeof performance&&(performance={}),!performance.now){var _=Date.now();performance.timing&&performance.timing.navigationStart&&(_=performance.timing.navigationStart),performance.now=function(){return Date.now()-_}}var b=new i;World.prototype.step=function(t,e,r){if(r=r||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{var n=Math.floor((this.time+e)/t)-Math.floor(this.time/t);n=Math.min(n,r);for(var i=performance.now(),o=0;o!==n&&(this.internalStep(t),!(performance.now()-i>1e3*t));o++);this.time+=e;for(var a=this.time%t,s=a/t,c=b,u=this.bodies,l=0;l!==u.length;l++){var p=u[l];p.type!==f.STATIC&&p.sleepState!==f.SLEEPING?(p.position.vsub(p.previousPosition,c),c.scale(s,c),p.position.vadd(c,p.interpolatedPosition)):(p.interpolatedPosition.copy(p.position),p.interpolatedQuaternion.copy(p.quaternion))}}};var w={type:"postStep"},P={type:"preStep"},x={type:"collide",body:null,contact:null},O=[],C=[],S=[],R=[],j=(new i,new i,new i,new i,new i,new i,new i,new i,new i,new o,new o),T=new o,E=new i;World.prototype.internalStep=function(t){this.dt=t;var e,r=this.contacts,i=S,o=R,a=this.numObjects(),s=this.bodies,c=this.solver,u=this.gravity,l=this.doProfiling,p=this.profile,h=f.DYNAMIC,d=this.constraints,y=C,m=(u.norm(),u.x),v=u.y,g=u.z,_=0;for(l&&(e=performance.now()),_=0;_!==a;_++){var b=s[_];if(b.type&h){var B=b.force,A=b.mass;B.x+=A*m,B.y+=A*v,B.z+=A*g}}for(var _=0,I=this.subsystems.length;_!==I;_++)this.subsystems[_].update();l&&(e=performance.now()),i.length=0,o.length=0,this.broadphase.collisionPairs(this,i,o),l&&(p.broadphase=performance.now()-e);var M=d.length;for(_=0;_!==M;_++){var k=d[_];if(!k.collideConnected)for(var z=i.length-1;z>=0;z-=1)(k.bodyA===i[z]&&k.bodyB===o[z]||k.bodyB===i[z]&&k.bodyA===o[z])&&(i.splice(z,1),o.splice(z,1))}this.collisionMatrixTick(),l&&(e=performance.now());var F=O,D=r.length;for(_=0;_!==D;_++)F.push(r[_]);r.length=0;var N=this.frictionEquations.length;for(_=0;_!==N;_++)y.push(this.frictionEquations[_]);this.frictionEquations.length=0,this.narrowphase.getContacts(i,o,this,r,F,this.frictionEquations,y),l&&(p.narrowphase=performance.now()-e),l&&(e=performance.now());for(var _=0;_<this.frictionEquations.length;_++)c.addEquation(this.frictionEquations[_]);for(var L=r.length,V=0;V!==L;V++){var k=r[V],b=k.bi,U=k.bj;if(k.si,k.sj,(b.material&&U.material&&this.getContactMaterial(b.material,U.material)||this.defaultContactMaterial).friction,b.material&&U.material&&(b.material.friction>=0&&U.material.friction>=0&&(b.material.friction,U.material.friction),b.material.restitution>=0&&U.material.restitution>=0&&(k.restitution=b.material.restitution*U.material.restitution)),c.addEquation(k),b.allowSleep&&b.type===f.DYNAMIC&&b.sleepState===f.SLEEPING&&U.sleepState===f.AWAKE&&U.type!==f.STATIC){var W=U.velocity.norm2()+U.angularVelocity.norm2(),q=Math.pow(U.sleepSpeedLimit,2);W>=2*q&&(b._wakeUpAfterNarrowphase=!0)}if(U.allowSleep&&U.type===f.DYNAMIC&&U.sleepState===f.SLEEPING&&b.sleepState===f.AWAKE&&b.type!==f.STATIC){var G=b.velocity.norm2()+b.angularVelocity.norm2(),H=Math.pow(b.sleepSpeedLimit,2);G>=2*H&&(U._wakeUpAfterNarrowphase=!0)}this.collisionMatrix.set(b,U,!0),this.collisionMatrixPrevious.get(b,U)||(x.body=U,x.contact=k,b.dispatchEvent(x),x.body=b,U.dispatchEvent(x))}for(l&&(p.makeContactConstraints=performance.now()-e,e=performance.now()),_=0;_!==a;_++){var b=s[_];b._wakeUpAfterNarrowphase&&(b.wakeUp(),b._wakeUpAfterNarrowphase=!1)}var M=d.length;for(_=0;_!==M;_++){var k=d[_];k.update();for(var z=0,X=k.equations.length;z!==X;z++){var K=k.equations[z];c.addEquation(K)}}c.solve(t,this),l&&(p.solve=performance.now()-e),c.removeAllEquations();var Q=Math.pow;for(_=0;_!==a;_++){var b=s[_];if(b.type&h){var Y=Q(1-b.linearDamping,t),Z=b.velocity;Z.mult(Y,Z);var J=b.angularVelocity;if(J){var $=Q(1-b.angularDamping,t);J.mult($,J)}}}for(this.dispatchEvent(P),_=0;_!==a;_++){var b=s[_];b.preStep&&b.preStep.call(b)}l&&(e=performance.now());var tt=j,et=T,rt=this.stepnumber,nt=f.DYNAMIC|f.KINEMATIC,it=rt%(this.quatNormalizeSkip+1)==0,ot=this.quatNormalizeFast,at=.5*t;for(n.types.PLANE,n.types.CONVEXPOLYHEDRON,_=0;_!==a;_++){var st=s[_],ct=st.force,ut=st.torque;if(st.type&nt&&st.sleepState!==f.SLEEPING){var lt=st.velocity,pt=st.angularVelocity,ft=st.position,ht=st.quaternion,dt=st.invMass,yt=st.invInertiaWorld;lt.x+=ct.x*dt*t,lt.y+=ct.y*dt*t,lt.z+=ct.z*dt*t,st.angularVelocity&&(yt.vmult(ut,E),E.mult(t,E),E.vadd(pt,pt)),ft.x+=lt.x*t,ft.y+=lt.y*t,ft.z+=lt.z*t,st.angularVelocity&&(tt.set(pt.x,pt.y,pt.z,0),tt.mult(ht,et),ht.x+=at*et.x,ht.y+=at*et.y,ht.z+=at*et.z,ht.w+=at*et.w,it&&(ot?ht.normalizeFast():ht.normalize())),st.aabb&&(st.aabbNeedsUpdate=!0),st.updateInertiaWorld&&st.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,l&&(p.integrate=performance.now()-e),this.time+=t,this.stepnumber+=1,this.dispatchEvent(w),_=0;_!==a;_++){var b=s[_],mt=b.postStep;mt&&mt.call(b)}if(this.allowSleep)for(_=0;_!==a;_++)s[_].sleepTick(this.time)},World.prototype.clearForces=function(){for(var t=this.bodies,e=t.length,r=0;r!==e;r++){var n=t[r];n.force,n.torque,n.force.set(0,0,0),n.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)},function(t,e,r){"use strict";function GenericWorker(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}GenericWorker.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,e){return this._listeners[t].push(e),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,e){if(this._listeners[t])for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].call(this,e)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.end()}),t.on("error",function(t){e.error(t)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var t=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,e){return this.extraStreamInfo[t]=e,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},t.exports=GenericWorker},function(t,e){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,e,r){"use strict";(function(t){if(e.base64=!0,e.array=!0,e.string=!0,e.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,e.nodebuffer=void 0!==t,e.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)e.blob=!1;else{var n=new ArrayBuffer(0);try{e.blob=0===new Blob([n],{type:"application/zip"}).size}catch(t){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(n),e.blob=0===i.getBlob("application/zip").size}catch(t){e.blob=!1}}}try{e.nodestream=!!r(32).Readable}catch(t){e.nodestream=!1}}).call(this,r(8).Buffer)},function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function _has(t,e){return Object.prototype.hasOwnProperty.call(t,e)}e.assign=function(t){for(var e=Array.prototype.slice.call(arguments,1);e.length;){var r=e.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var n in r)_has(r,n)&&(t[n]=r[n])}}return t},e.shrinkBuf=function(t,e){return t.length===e?t:t.subarray?t.subarray(0,e):(t.length=e,t)};var i={arraySet:function(t,e,r,n,i){if(e.subarray&&t.subarray)t.set(e.subarray(r,r+n),i);else for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){var e,r,n,i,o,a;for(n=0,e=0,r=t.length;e<r;e++)n+=t[e].length;for(a=new Uint8Array(n),i=0,e=0,r=t.length;e<r;e++)o=t[e],a.set(o,i),i+=o.length;return a}},o={arraySet:function(t,e,r,n,i){for(var o=0;o<n;o++)t[i+o]=e[r+o]},flattenChunks:function(t){return[].concat.apply([],t)}};e.setTyped=function(t){t?(e.Buf8=Uint8Array,e.Buf16=Uint16Array,e.Buf32=Int32Array,e.assign(e,i)):(e.Buf8=Array,e.Buf16=Array,e.Buf32=Array,e.assign(e,o))},e.setTyped(n)},function(t,e,r){"use strict";var n=r(16),i=Object.keys||function(t){var e=[];for(var r in t)e.push(r);return e};t.exports=Duplex;var o=r(12);o.inherits=r(10);var a=r(33),s=r(24);o.inherits(Duplex,a);for(var c=i(s.prototype),u=0;u<c.length;u++){var l=c[u];Duplex.prototype[l]||(Duplex.prototype[l]=s.prototype[l])}function Duplex(t){if(!(this instanceof Duplex))return new Duplex(t);a.call(this,t),s.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||n.nextTick(onEndNT,this)}function onEndNT(t){t.end()}Object.defineProperty(Duplex.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),Duplex.prototype._destroy=function(t,e){this.push(null),this.end(),n.nextTick(e,t)}},function(t,e,r){"use strict";(function(t){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=r(62),i=r(63),o=r(64);function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(t,e){if(kMaxLength()<e)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=Buffer.prototype:(null===t&&(t=new Buffer(e)),t.length=e),t}function Buffer(t,e,r){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,t)}return from(this,t,e,r)}function from(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function fromArrayBuffer(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n);Buffer.TYPED_ARRAY_SUPPORT?(t=e).__proto__=Buffer.prototype:t=fromArrayLike(t,e);return t}(t,e,r,n):"string"==typeof e?function fromString(t,e,r){"string"==typeof r&&""!==r||(r="utf8");if(!Buffer.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|byteLength(e,r),i=(t=createBuffer(t,n)).write(e,r);i!==n&&(t=t.slice(0,i));return t}(t,e,r):function fromObject(t,e){if(Buffer.isBuffer(e)){var r=0|checked(e.length);return 0===(t=createBuffer(t,r)).length?t:(e.copy(t,0,0,r),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||function isnan(t){return t!=t}(e.length)?createBuffer(t,0):fromArrayLike(t,e);if("Buffer"===e.type&&o(e.data))return fromArrayLike(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function assertSize(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(t,e){if(assertSize(e),t=createBuffer(t,e<0?0:0|checked(e)),!Buffer.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function fromArrayLike(t,e){var r=e.length<0?0:0|checked(e.length);t=createBuffer(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function checked(t){if(t>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function byteLength(t,e){if(Buffer.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(t).length;default:if(n)return utf8ToBytes(t).length;e=(""+e).toLowerCase(),n=!0}}function swap(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function bidirectionalIndexOf(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=Buffer.from(e,n)),Buffer.isBuffer(e))return 0===e.length?-1:arrayIndexOf(t,e,r,n,i);if("number"==typeof e)return e&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):arrayIndexOf(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,e,r,n,i){var o,a=1,s=t.length,c=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;a=2,s/=2,c/=2,r/=2}function read(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(i){var u=-1;for(o=r;o<s;o++)if(read(t,o)===read(e,-1===u?0:o-u)){if(-1===u&&(u=o),o-u+1===c)return u*a}else-1!==u&&(o-=o-u),u=-1}else for(r+c>s&&(r=s-c),o=r;o>=0;o--){for(var l=!0,p=0;p<c;p++)if(read(t,o+p)!==read(e,p)){l=!1;break}if(l)return o}return-1}function hexWrite(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var o=e.length;if(o%2!=0)throw new TypeError("Invalid hex string");n>o/2&&(n=o/2);for(var a=0;a<n;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[r+a]=s}return a}function utf8Write(t,e,r,n){return blitBuffer(utf8ToBytes(e,t.length-r),t,r,n)}function asciiWrite(t,e,r,n){return blitBuffer(function asciiToBytes(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function latin1Write(t,e,r,n){return asciiWrite(t,e,r,n)}function base64Write(t,e,r,n){return blitBuffer(base64ToBytes(e),t,r,n)}function ucs2Write(t,e,r,n){return blitBuffer(function utf16leToBytes(t,e){for(var r,n,i,o=[],a=0;a<t.length&&!((e-=2)<0);++a)r=t.charCodeAt(a),n=r>>8,i=r%256,o.push(i),o.push(n);return o}(e,t.length-r),t,r,n)}function base64Slice(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function utf8Slice(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var o,s,c,u,l=t[i],p=null,f=l>239?4:l>223?3:l>191?2:1;if(i+f<=r)switch(f){case 1:l<128&&(p=l);break;case 2:128==(192&(o=t[i+1]))&&(u=(31&l)<<6|63&o)>127&&(p=u);break;case 3:o=t[i+1],s=t[i+2],128==(192&o)&&128==(192&s)&&(u=(15&l)<<12|(63&o)<<6|63&s)>2047&&(u<55296||u>57343)&&(p=u);break;case 4:o=t[i+1],s=t[i+2],c=t[i+3],128==(192&o)&&128==(192&s)&&128==(192&c)&&(u=(15&l)<<18|(63&o)<<12|(63&s)<<6|63&c)>65535&&u<1114112&&(p=u)}null===p?(p=65533,f=1):p>65535&&(p-=65536,n.push(p>>>10&1023|55296),p=56320|1023&p),n.push(p),i+=f}return function decodeCodePointsArray(t){var e=t.length;if(e<=a)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=a));return r}(n)}e.Buffer=Buffer,e.SlowBuffer=function SlowBuffer(t){+t!=t&&(t=0);return Buffer.alloc(+t)},e.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function typedArraySupport(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.from=function(t,e,r){return from(null,t,e,r)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(t,e,r){return function alloc(t,e,r,n){return assertSize(e),e<=0?createBuffer(t,e):void 0!==r?"string"==typeof n?createBuffer(t,e).fill(r,n):createBuffer(t,e).fill(r):createBuffer(t,e)}(null,t,e,r)},Buffer.allocUnsafe=function(t){return allocUnsafe(null,t)},Buffer.allocUnsafeSlow=function(t){return allocUnsafe(null,t)},Buffer.isBuffer=function isBuffer(t){return!(null==t||!t._isBuffer)},Buffer.compare=function compare(t,e){if(!Buffer.isBuffer(t)||!Buffer.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,o=Math.min(r,n);i<o;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},Buffer.isEncoding=function isEncoding(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(t,e){if(!o(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=Buffer.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var a=t[r];if(!Buffer.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,i),i+=a.length}return n},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)swap(this,e,e+1);return this},Buffer.prototype.swap32=function swap32(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)swap(this,e,e+3),swap(this,e+1,e+2);return this},Buffer.prototype.swap64=function swap64(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)swap(this,e,e+7),swap(this,e+1,e+6),swap(this,e+2,e+5),swap(this,e+3,e+4);return this},Buffer.prototype.toString=function toString(){var t=0|this.length;return 0===t?"":0===arguments.length?utf8Slice(this,0,t):function slowToString(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return hexSlice(this,e,r);case"utf8":case"utf-8":return utf8Slice(this,e,r);case"ascii":return asciiSlice(this,e,r);case"latin1":case"binary":return latin1Slice(this,e,r);case"base64":return base64Slice(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}.apply(this,arguments)},Buffer.prototype.equals=function equals(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t)},Buffer.prototype.inspect=function inspect(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function compare(t,e,r,n,i){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var o=(i>>>=0)-(n>>>=0),a=(r>>>=0)-(e>>>=0),s=Math.min(o,a),c=this.slice(n,i),u=t.slice(e,r),l=0;l<s;++l)if(c[l]!==u[l]){o=c[l],a=u[l];break}return o<a?-1:a<o?1:0},Buffer.prototype.includes=function includes(t,e,r){return-1!==this.indexOf(t,e,r)},Buffer.prototype.indexOf=function indexOf(t,e,r){return bidirectionalIndexOf(this,t,e,r,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(t,e,r){return bidirectionalIndexOf(this,t,e,r,!1)},Buffer.prototype.write=function write(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var o=!1;;)switch(n){case"hex":return hexWrite(this,t,e,r);case"utf8":case"utf-8":return utf8Write(this,t,e,r);case"ascii":return asciiWrite(this,t,e,r);case"latin1":case"binary":return latin1Write(this,t,e,r);case"base64":return base64Write(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,e,r);default:if(o)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),o=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var a=4096;function asciiSlice(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function latin1Slice(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function hexSlice(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",o=e;o<r;++o)i+=toHex(t[o]);return i}function utf16leSlice(t,e,r){for(var n=t.slice(e,r),i="",o=0;o<n.length;o+=2)i+=String.fromCharCode(n[o]+256*n[o+1]);return i}function checkOffset(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,e,r,n,i,o){if(!Buffer.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<o)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function objectWriteUInt16(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-r,2);i<o;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function objectWriteUInt32(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-r,4);i<o;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function checkIEEE754(t,e,r,n,i,o){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(t,e,r,n,o){return o||checkIEEE754(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function writeDouble(t,e,r,n,o){return o||checkIEEE754(t,0,r,8),i.write(t,e,r,n,52,8),r+8}Buffer.prototype.slice=function slice(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),Buffer.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=Buffer.prototype;else{var i=e-t;r=new Buffer(i,void 0);for(var o=0;o<i;++o)r[o]=this[o+t]}return r},Buffer.prototype.readUIntLE=function readUIntLE(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n},Buffer.prototype.readUIntBE=function readUIntBE(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},Buffer.prototype.readUInt8=function readUInt8(t,e){return e||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function readUInt16LE(t,e){return e||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(t,e){return e||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(t,e){return e||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(t,e){return e||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function readIntLE(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var n=this[t],i=1,o=0;++o<e&&(i*=256);)n+=this[t+o]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},Buffer.prototype.readIntBE=function readIntBE(t,e,r){t|=0,e|=0,r||checkOffset(t,e,this.length);for(var n=e,i=1,o=this[t+--n];n>0&&(i*=256);)o+=this[t+--n]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*e)),o},Buffer.prototype.readInt8=function readInt8(t,e){return e||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function readInt16LE(t,e){e||checkOffset(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function readInt16BE(t,e){e||checkOffset(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function readInt32LE(t,e){return e||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(t,e){return e||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function readFloatLE(t,e){return e||checkOffset(t,4,this.length),i.read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(t,e){return e||checkOffset(t,4,this.length),i.read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(t,e){return e||checkOffset(t,8,this.length),i.read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(t,e){return e||checkOffset(t,8,this.length),i.read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(t,e,r,n){(t=+t,e|=0,r|=0,n)||checkInt(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,o=0;for(this[e]=255&t;++o<r&&(i*=256);)this[e+o]=t/i&255;return e+r},Buffer.prototype.writeUIntBE=function writeUIntBE(t,e,r,n){(t=+t,e|=0,r|=0,n)||checkInt(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+r},Buffer.prototype.writeUInt8=function writeUInt8(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeIntLE=function writeIntLE(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);checkInt(this,t,e,r,i-1,-i)}var o=0,a=1,s=0;for(this[e]=255&t;++o<r&&(a*=256);)t<0&&0===s&&0!==this[e+o-1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},Buffer.prototype.writeIntBE=function writeIntBE(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);checkInt(this,t,e,r,i-1,-i)}var o=r-1,a=1,s=0;for(this[e+o]=255&t;--o>=0&&(a*=256);)t<0&&0===s&&0!==this[e+o+1]&&(s=1),this[e+o]=(t/a>>0)-s&255;return e+r},Buffer.prototype.writeInt8=function writeInt8(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},Buffer.prototype.writeInt16LE=function writeInt16LE(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):objectWriteUInt16(this,t,e,!0),e+2},Buffer.prototype.writeInt16BE=function writeInt16BE(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):objectWriteUInt16(this,t,e,!1),e+2},Buffer.prototype.writeInt32LE=function writeInt32LE(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):objectWriteUInt32(this,t,e,!0),e+4},Buffer.prototype.writeInt32BE=function writeInt32BE(t,e,r){return t=+t,e|=0,r||checkInt(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):objectWriteUInt32(this,t,e,!1),e+4},Buffer.prototype.writeFloatLE=function writeFloatLE(t,e,r){return writeFloat(this,t,e,!0,r)},Buffer.prototype.writeFloatBE=function writeFloatBE(t,e,r){return writeFloat(this,t,e,!1,r)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(t,e,r){return writeDouble(this,t,e,!0,r)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(t,e,r){return writeDouble(this,t,e,!1,r)},Buffer.prototype.copy=function copy(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,o=n-r;if(this===t&&r<e&&e<n)for(i=o-1;i>=0;--i)t[i+e]=this[i+r];else if(o<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+o),e);return o},Buffer.prototype.fill=function fill(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!Buffer.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var o;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(o=e;o<r;++o)this[o]=t;else{var a=Buffer.isBuffer(t)?t:utf8ToBytes(new Buffer(t,n).toString()),s=a.length;for(o=0;o<r-e;++o)this[o+e]=a[o%s]}return this};var s=/[^+\/0-9A-Za-z-_]/g;function toHex(t){return t<16?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t,e){var r;e=e||1/0;for(var n=t.length,i=null,o=[],a=0;a<n;++a){if((r=t.charCodeAt(a))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&o.push(239,191,189);continue}if(a+1===n){(e-=3)>-1&&o.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&o.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&o.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;o.push(r)}else if(r<2048){if((e-=2)<0)break;o.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;o.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;o.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return o}function base64ToBytes(t){return n.toByteArray(function base64clean(t){if((t=function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(s,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function blitBuffer(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}}).call(this,r(4))},function(t,e,r){"use strict";for(var n=r(1),i=r(5),o=r(18),a=r(3),s=new Array(256),c=0;c<256;c++)s[c]=c>=252?6:c>=248?5:c>=240?4:c>=224?3:c>=192?2:1;s[254]=s[254]=1;function Utf8DecodeWorker(){a.call(this,"utf-8 decode"),this.leftOver=null}function Utf8EncodeWorker(){a.call(this,"utf-8 encode")}e.utf8encode=function utf8encode(t){return i.nodebuffer?o.newBufferFrom(t,"utf-8"):function(t){var e,r,n,o,a,s=t.length,c=0;for(o=0;o<s;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),c+=r<128?1:r<2048?2:r<65536?3:4;for(e=i.uint8array?new Uint8Array(c):new Array(c),a=0,o=0;a<c;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(n=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(n-56320),o++),r<128?e[a++]=r:r<2048?(e[a++]=192|r>>>6,e[a++]=128|63&r):r<65536?(e[a++]=224|r>>>12,e[a++]=128|r>>>6&63,e[a++]=128|63&r):(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63,e[a++]=128|r>>>6&63,e[a++]=128|63&r);return e}(t)},e.utf8decode=function utf8decode(t){return i.nodebuffer?n.transformTo("nodebuffer",t).toString("utf-8"):function(t){var e,r,i,o,a=t.length,c=new Array(2*a);for(r=0,e=0;e<a;)if((i=t[e++])<128)c[r++]=i;else if((o=s[i])>4)c[r++]=65533,e+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&e<a;)i=i<<6|63&t[e++],o--;o>1?c[r++]=65533:i<65536?c[r++]=i:(i-=65536,c[r++]=55296|i>>10&1023,c[r++]=56320|1023&i)}return c.length!==r&&(c.subarray?c=c.subarray(0,r):c.length=r),n.applyFromCharCode(c)}(t=n.transformTo(i.uint8array?"uint8array":"array",t))},n.inherits(Utf8DecodeWorker,a),Utf8DecodeWorker.prototype.processChunk=function(t){var r=n.transformTo(i.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var o=r;(r=new Uint8Array(o.length+this.leftOver.length)).set(this.leftOver,0),r.set(o,this.leftOver.length)}else r=this.leftOver.concat(r);this.leftOver=null}var a=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;r>=0&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+s[t[r]]>e?r:e}(r),c=r;a!==r.length&&(i.uint8array?(c=r.subarray(0,a),this.leftOver=r.subarray(a,r.length)):(c=r.slice(0,a),this.leftOver=r.slice(a,r.length))),this.push({data:e.utf8decode(c),meta:t.meta})},Utf8DecodeWorker.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:e.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},e.Utf8DecodeWorker=Utf8DecodeWorker,n.inherits(Utf8EncodeWorker,a),Utf8EncodeWorker.prototype.processChunk=function(t){this.push({data:e.utf8encode(t.data),meta:t.meta})},e.Utf8EncodeWorker=Utf8EncodeWorker},function(t,e){"function"==typeof Object.create?t.exports=function inherits(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function inherits(t,e){t.super_=e;var r=function(){};r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t}},function(t,e){var r,n,i=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(r===setTimeout)return setTimeout(t,0);if((r===defaultSetTimout||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){r=defaultSetTimout}try{n="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){n=defaultClearTimeout}}();var o,a=[],s=!1,c=-1;function cleanUpNextTick(){s&&o&&(s=!1,o.length?a=o.concat(a):c=-1,a.length&&drainQueue())}function drainQueue(){if(!s){var t=runTimeout(cleanUpNextTick);s=!0;for(var e=a.length;e;){for(o=a,a=[];++c<e;)o&&o[c].run();c=-1,e=a.length}o=null,s=!1,function runClearTimeout(t){if(n===clearTimeout)return clearTimeout(t);if((n===defaultClearTimeout||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(t);try{return n(t)}catch(e){try{return n.call(null,t)}catch(e){return n.call(this,t)}}}(t)}}function Item(t,e){this.fun=t,this.array=e}function noop(){}i.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];a.push(new Item(t,e)),1!==a.length||s||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=noop,i.addListener=noop,i.once=noop,i.off=noop,i.removeListener=noop,i.removeAllListeners=noop,i.emit=noop,i.prependListener=noop,i.prependOnceListener=noop,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,e,r){(function(t){function objectToString(t){return Object.prototype.toString.call(t)}e.isArray=function isArray(t){return Array.isArray?Array.isArray(t):"[object Array]"===objectToString(t)},e.isBoolean=function isBoolean(t){return"boolean"==typeof t},e.isNull=function isNull(t){return null===t},e.isNullOrUndefined=function isNullOrUndefined(t){return null==t},e.isNumber=function isNumber(t){return"number"==typeof t},e.isString=function isString(t){return"string"==typeof t},e.isSymbol=function isSymbol(t){return"symbol"==typeof t},e.isUndefined=function isUndefined(t){return void 0===t},e.isRegExp=function isRegExp(t){return"[object RegExp]"===objectToString(t)},e.isObject=function isObject(t){return"object"==typeof t&&null!==t},e.isDate=function isDate(t){return"[object Date]"===objectToString(t)},e.isError=function isError(t){return"[object Error]"===objectToString(t)||t instanceof Error},e.isFunction=function isFunction(t){return"function"==typeof t},e.isPrimitive=function isPrimitive(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},e.isBuffer=t.isBuffer}).call(this,r(8).Buffer)},function(t,e,r){"use strict";var n=null;n="undefined"!=typeof Promise?Promise:r(79),t.exports={Promise:n}},function(t,e,r){"use strict";(function(t){r.d(e,"a",function(){return n});var n=function(){function NativeU8Array(e){if(e){var r=t.from(e,"base64");this.array=new Uint8Array(r)}}return Object.defineProperty(NativeU8Array.prototype,"length",{set:function(t){this.array&&t===this.array.length||(this.array=new Uint8Array(t))},enumerable:!0,configurable:!0}),NativeU8Array.prototype.serialize=function(){if(this.array)return t.from(this.array.buffer).toString("base64")},NativeU8Array}()}).call(this,r(8).Buffer)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function BaseEvent(){}return BaseEvent.prototype.attach=function(t,e){this._attach(t,e,!1)},BaseEvent.prototype.once=function(t,e){this._attach(t,e,!0)},BaseEvent.prototype._attach=function(t,e,r){var n,i,o;if("function"==typeof t)i=t;else if(e||"function"!=typeof t.post){if("object"!=typeof t)throw new Error("Expect a function or object as first argument");if("function"!=typeof e)throw new Error("Expect a function as second argument");n=t,i=e}else o=t;this._listeners?this._listeners=this._listeners.slice():this._listeners=[],this._listeners.push({deleted:!1,boundTo:n,handler:i,event:o,once:r})},BaseEvent.prototype.detach=function(){for(var t,e,r,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];this._listeners&&0!==this._listeners.length&&(n.length>=1&&("function"==typeof n[0]?e=n[0]:1===n.length&&"function"==typeof n[0].post?r=n[0]:t=n[0]),n.length>=2&&(e=n[1]),this._listeners=this._listeners.filter(function(n){return void 0!==e&&n.handler!==e||void 0!==r&&n.event!==r||void 0!==t&&n.boundTo!==t||(n.deleted=!0,!1)}),0===this._listeners.length&&delete this._listeners)},BaseEvent.prototype.post=function(t){throw new Error("abstract")},BaseEvent.prototype.listenerCount=function(){return this._listeners?this._listeners.length:0},BaseEvent.prototype._call=function(t,e){t.deleted||(t.once&&(t.deleted=!0,this._listeners=this._listeners.filter(function(e){return e!==t}),0===this._listeners.length&&delete this._listeners),t.event?t.event.post.apply(t.event,e):t.handler.apply("object"==typeof t.boundTo?t.boundTo:this,e))},BaseEvent}();e.BaseEvent=n},function(t,e,r){"use strict";(function(e){!e.version||0===e.version.indexOf("v0.")||0===e.version.indexOf("v1.")&&0!==e.version.indexOf("v1.8.")?t.exports={nextTick:function nextTick(t,r,n,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var o,a,s=arguments.length;switch(s){case 0:case 1:return e.nextTick(t);case 2:return e.nextTick(function afterTickOne(){t.call(null,r)});case 3:return e.nextTick(function afterTickTwo(){t.call(null,r,n)});case 4:return e.nextTick(function afterTickThree(){t.call(null,r,n,i)});default:for(o=new Array(s-1),a=0;a<o.length;)o[a++]=arguments[a];return e.nextTick(function afterTick(){t.apply(null,o)})}}}:t.exports=e}).call(this,r(11))},function(t,e,r){var n=r(8),i=n.Buffer;function copyProps(t,e){for(var r in t)e[r]=t[r]}function SafeBuffer(t,e,r){return i(t,e,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(copyProps(n,e),e.Buffer=SafeBuffer),copyProps(i,SafeBuffer),SafeBuffer.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,r)},SafeBuffer.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=i(t);return void 0!==e?"string"==typeof r?n.fill(e,r):n.fill(e):n.fill(0),n},SafeBuffer.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},SafeBuffer.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},function(t,e,r){"use strict";(function(e){t.exports={isNode:void 0!==e,newBufferFrom:function(t,r){if(e.from&&e.from!==Uint8Array.from)return e.from(t,r);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new e(t,r)},allocBuffer:function(t){if(e.alloc)return e.alloc(t);var r=new e(t);return r.fill(0),r},isBuffer:function(t){return e.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}}).call(this,r(8).Buffer)},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(t){function SyncEvent(){var e=null!==t&&t.apply(this,arguments)||this;return e._recursion=0,e}return i(SyncEvent,t),SyncEvent.prototype.post=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this._listeners&&0!==this._listeners.length){if(this._recursion++,SyncEvent.MAX_RECURSION_DEPTH>0&&this._recursion>SyncEvent.MAX_RECURSION_DEPTH)throw new Error("event fired recursively");for(var r=this._listeners,n=0;n<r.length;++n){var i=r[n];this._call(i,t)}this._recursion--}},SyncEvent.MAX_RECURSION_DEPTH=10,SyncEvent}(r(15).BaseEvent);e.SyncEvent=o;var a=function(t){function VoidSyncEvent(){return null!==t&&t.apply(this,arguments)||this}return i(VoidSyncEvent,t),VoidSyncEvent.prototype.post=function(){t.prototype.post.call(this,void 0)},VoidSyncEvent}(o);e.VoidSyncEvent=a;var s=function(t){function ErrorSyncEvent(){return null!==t&&t.apply(this,arguments)||this}return i(ErrorSyncEvent,t),ErrorSyncEvent.prototype.post=function(e){if(0===this.listenerCount())throw new Error("error event posted while no listeners attached. Error: "+e.message);t.prototype.post.call(this,e)},ErrorSyncEvent}(o);e.ErrorSyncEvent=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(19),i=function(){function EventQueue(){this.evtFilled=new n.SyncEvent,this.evtDrained=new n.SyncEvent,this._queue=[],this._flushing=!1}return EventQueue.global=function(){return EventQueue._instance||EventQueue.resetGlobal(),EventQueue._instance},EventQueue.resetGlobal=function(){EventQueue._instance=new EventQueue},EventQueue.prototype.empty=function(){return 0===this._queue.length},EventQueue.prototype.add=function(t){this._queue.push(t),1!==this._queue.length||this._flushing||this.evtFilled.post(this)},EventQueue.prototype.flushOnce=function(){var t=0===this._queue.length,e=this._flushing;this._flushing=!0;try{var r=this._queue;this._queue=[];for(var n=0;n<r.length;++n)r[n]()}finally{this._flushing=e,t||e||0!==this._queue.length||this.evtDrained.post(this)}},EventQueue.prototype.flush=function(t){void 0===t&&(t=10);var e=0===this._queue.length,r=this._flushing;this._flushing=!0;try{for(var n=0;this._queue.length>0;){if("number"==typeof t&&n>=t)throw this._queue=[],new Error("unable to flush the queue due to recursively added event. Clearing queue now");this.flushOnce(),++n}}finally{this._flushing=r,e||r||0!==this._queue.length||this.evtDrained.post(this)}},EventQueue}();e.default=i},function(t,e,r){(function(t){var n=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function Timeout(t,e){this._id=t,this._clearFn=e}e.setTimeout=function(){return new Timeout(i.call(setTimeout,n,arguments),clearTimeout)},e.setInterval=function(){return new Timeout(i.call(setInterval,n,arguments),clearInterval)},e.clearTimeout=e.clearInterval=function(t){t&&t.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(n,this._id)},e.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},e.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},e._unrefActive=e.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function onTimeout(){t._onTimeout&&t._onTimeout()},e))},r(59),e.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,e.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,r(4))},function(t,e,r){"use strict";var n,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function ReflectApply(t,e,r){return Function.prototype.apply.call(t,e,r)};n=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function ReflectOwnKeys(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function ReflectOwnKeys(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function NumberIsNaN(t){return t!=t};function EventEmitter(){EventEmitter.init.call(this)}t.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var s=10;function $getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function _addListener(t,e,r,n){var i,o,a;if("function"!=typeof r)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r);if(void 0===(o=t._events)?(o=t._events=Object.create(null),t._eventsCount=0):(void 0!==o.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),o=t._events),a=o[e]),void 0===a)a=o[e]=r,++t._eventsCount;else if("function"==typeof a?a=o[e]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=$getMaxListeners(t))>0&&a.length>i&&!a.warned){a.warned=!0;var s=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");s.name="MaxListenersExceededWarning",s.emitter=t,s.type=e,s.count=a.length,function ProcessEmitWarning(t){console&&console.warn&&console.warn(t)}(s)}return t}function _onceWrap(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=function onceWrapper(){for(var t=[],e=0;e<arguments.length;e++)t.push(arguments[e]);this.fired||(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,o(this.listener,this.target,t))}.bind(n);return i.listener=r,n.wrapFn=i,i}function _listeners(t,e,r){var n=t._events;if(void 0===n)return[];var i=n[e];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function unwrapListeners(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(i):arrayClone(i,i.length)}function listenerCount(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function arrayClone(t,e){for(var r=new Array(e),n=0;n<e;++n)r[n]=t[n];return r}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");s=t}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function setMaxListeners(t){if("number"!=typeof t||t<0||a(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function emit(t){for(var e=[],r=1;r<arguments.length;r++)e.push(arguments[r]);var n="error"===t,i=this._events;if(void 0!==i)n=n&&void 0===i.error;else if(!n)return!1;if(n){var a;if(e.length>0&&(a=e[0]),a instanceof Error)throw a;var s=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw s.context=a,s}var c=i[t];if(void 0===c)return!1;if("function"==typeof c)o(c,this,e);else{var u=c.length,l=arrayClone(c,u);for(r=0;r<u;++r)o(l[r],this,e)}return!0},EventEmitter.prototype.addListener=function addListener(t,e){return _addListener(this,t,e,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(t,e){return _addListener(this,t,e,!0)},EventEmitter.prototype.once=function once(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.on(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(t,e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);return this.prependListener(t,_onceWrap(this,t,e)),this},EventEmitter.prototype.removeListener=function removeListener(t,e){var r,n,i,o,a;if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e);if(void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,o=r.length-1;o>=0;o--)if(r[o]===e||r[o].listener===e){a=r[o].listener,i=o;break}if(i<0)return this;0===i?r.shift():function spliceOne(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,i),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,a||e)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var e,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var i,o=Object.keys(r);for(n=0;n<o.length;++n)"removeListener"!==(i=o[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},EventEmitter.prototype.listeners=function listeners(t){return _listeners(this,t,!0)},EventEmitter.prototype.rawListeners=function rawListeners(t){return _listeners(this,t,!1)},EventEmitter.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):listenerCount.call(t,e)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?n(this._events):[]}},function(t,e,r){(e=t.exports=r(33)).Stream=e,e.Readable=e,e.Writable=r(24),e.Duplex=r(7),e.Transform=r(37),e.PassThrough=r(73)},function(t,e,r){"use strict";(function(e,n,i){var o=r(16);function CorkedRequest(t){var e=this;this.next=null,this.entry=null,this.finish=function(){!function onCorkedFinish(t,e,r){var n=t.entry;t.entry=null;for(;n;){var i=n.callback;e.pendingcb--,i(r),n=n.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}(e,t)}}t.exports=Writable;var a,s=!e.browser&&["v0.10","v0.9."].indexOf(e.version.slice(0,5))>-1?n:o.nextTick;Writable.WritableState=WritableState;var c=r(12);c.inherits=r(10);var u={deprecate:r(72)},l=r(34),p=r(17).Buffer,f=i.Uint8Array||function(){};var h,d=r(35);function nop(){}function WritableState(t,e){a=a||r(7),t=t||{};var n=e instanceof a;this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,c=t.writableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(c||0===c)?c:u,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var l=!1===t.decodeStrings;this.decodeStrings=!l,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function onwrite(t,e){var r=t._writableState,n=r.sync,i=r.writecb;if(function onwriteStateUpdate(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(r),e)!function onwriteError(t,e,r,n,i){--e.pendingcb,r?(o.nextTick(i,n),o.nextTick(finishMaybe,t,e),t._writableState.errorEmitted=!0,t.emit("error",n)):(i(n),t._writableState.errorEmitted=!0,t.emit("error",n),finishMaybe(t,e))}(t,r,n,e,i);else{var a=needFinish(r);a||r.corked||r.bufferProcessing||!r.bufferedRequest||clearBuffer(t,r),n?s(afterWrite,t,r,a,i):afterWrite(t,r,a,i)}}(e,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(t){if(a=a||r(7),!(h.call(Writable,this)||this instanceof a))return new Writable(t);this._writableState=new WritableState(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),l.call(this)}function doWrite(t,e,r,n,i,o,a){e.writelen=n,e.writecb=a,e.writing=!0,e.sync=!0,r?t._writev(i,e.onwrite):t._write(i,o,e.onwrite),e.sync=!1}function afterWrite(t,e,r,n){r||function onwriteDrain(t,e){0===e.length&&e.needDrain&&(e.needDrain=!1,t.emit("drain"))}(t,e),e.pendingcb--,n(),finishMaybe(t,e)}function clearBuffer(t,e){e.bufferProcessing=!0;var r=e.bufferedRequest;if(t._writev&&r&&r.next){var n=e.bufferedRequestCount,i=new Array(n),o=e.corkedRequestsFree;o.entry=r;for(var a=0,s=!0;r;)i[a]=r,r.isBuf||(s=!1),r=r.next,a+=1;i.allBuffers=s,doWrite(t,e,!0,e.length,i,"",o.finish),e.pendingcb++,e.lastBufferedRequest=null,o.next?(e.corkedRequestsFree=o.next,o.next=null):e.corkedRequestsFree=new CorkedRequest(e),e.bufferedRequestCount=0}else{for(;r;){var c=r.chunk,u=r.encoding,l=r.callback;if(doWrite(t,e,!1,e.objectMode?1:c.length,c,u,l),r=r.next,e.bufferedRequestCount--,e.writing)break}null===r&&(e.lastBufferedRequest=null)}e.bufferedRequest=r,e.bufferProcessing=!1}function needFinish(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function callFinal(t,e){t._final(function(r){e.pendingcb--,r&&t.emit("error",r),e.prefinished=!0,t.emit("prefinish"),finishMaybe(t,e)})}function finishMaybe(t,e){var r=needFinish(e);return r&&(!function prefinish(t,e){e.prefinished||e.finalCalled||("function"==typeof t._final?(e.pendingcb++,e.finalCalled=!0,o.nextTick(callFinal,t,e)):(e.prefinished=!0,t.emit("prefinish")))}(t,e),0===e.pendingcb&&(e.finished=!0,t.emit("finish"))),r}c.inherits(Writable,l),WritableState.prototype.getBuffer=function getBuffer(){for(var t=this.bufferedRequest,e=[];t;)e.push(t),t=t.next;return e},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:u.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(h=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(t){return!!h.call(this,t)||this===Writable&&(t&&t._writableState instanceof WritableState)}})):h=function(t){return t instanceof this},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(t,e,r){var n=this._writableState,i=!1,a=!n.objectMode&&function _isUint8Array(t){return p.isBuffer(t)||t instanceof f}(t);return a&&!p.isBuffer(t)&&(t=function _uint8ArrayToBuffer(t){return p.from(t)}(t)),"function"==typeof e&&(r=e,e=null),a?e="buffer":e||(e=n.defaultEncoding),"function"!=typeof r&&(r=nop),n.ended?function writeAfterEnd(t,e){var r=new Error("write after end");t.emit("error",r),o.nextTick(e,r)}(this,r):(a||function validChunk(t,e,r,n){var i=!0,a=!1;return null===r?a=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||e.objectMode||(a=new TypeError("Invalid non-string/buffer chunk")),a&&(t.emit("error",a),o.nextTick(n,a),i=!1),i}(this,n,t,r))&&(n.pendingcb++,i=function writeOrBuffer(t,e,r,n,i,o){if(!r){var a=function decodeChunk(t,e,r){t.objectMode||!1===t.decodeStrings||"string"!=typeof e||(e=p.from(e,r));return e}(e,n,i);n!==a&&(r=!0,i="buffer",n=a)}var s=e.objectMode?1:n.length;e.length+=s;var c=e.length<e.highWaterMark;c||(e.needDrain=!0);if(e.writing||e.corked){var u=e.lastBufferedRequest;e.lastBufferedRequest={chunk:n,encoding:i,isBuf:r,callback:o,next:null},u?u.next=e.lastBufferedRequest:e.bufferedRequest=e.lastBufferedRequest,e.bufferedRequestCount+=1}else doWrite(t,e,!1,s,n,i,o);return c}(this,n,a,t,e,r)),i},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||clearBuffer(this,t))},Writable.prototype.setDefaultEncoding=function setDefaultEncoding(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(Writable.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Writable.prototype._write=function(t,e,r){r(new Error("_write() is not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(t,e,r){var n=this._writableState;"function"==typeof t?(r=t,t=null,e=null):"function"==typeof e&&(r=e,e=null),null!=t&&this.write(t,e),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function endWritable(t,e,r){e.ending=!0,finishMaybe(t,e),r&&(e.finished?o.nextTick(r):t.once("finish",r));e.ended=!0,t.writable=!1}(this,n,r)},Object.defineProperty(Writable.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),Writable.prototype.destroy=d.destroy,Writable.prototype._undestroy=d.undestroy,Writable.prototype._destroy=function(t,e){this.end(),e(t)}}).call(this,r(11),r(21).setImmediate,r(4))},function(t,e,r){"use strict";var n=r(13),i=r(41),o=r(42),a=r(43);o=r(42);function CompressedObject(t,e,r,n,i){this.compressedSize=t,this.uncompressedSize=e,this.crc32=r,this.compression=n,this.compressedContent=i}CompressedObject.prototype={getContentWorker:function(){var t=new i(n.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new o("data_length")),e=this;return t.on("end",function(){if(this.streamInfo.data_length!==e.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),t},getCompressedWorker:function(){return new i(n.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},CompressedObject.createWorkerFrom=function(t,e,r){return t.pipe(new a).pipe(new o("uncompressedSize")).pipe(e.compressWorker(r)).pipe(new o("compressedSize")).withStreamInfo("compression",e)},t.exports=CompressedObject},function(t,e,r){"use strict";var n=r(1);var i=function makeTable(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();t.exports=function crc32wrapper(t,e){return void 0!==t&&t.length?"string"!==n.getTypeOf(t)?function crc32(t,e,r,n){var o=i,a=n+r;t^=-1;for(var s=n;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}(0|e,t,t.length,0):function crc32str(t,e,r,n){var o=i,a=n+r;t^=-1;for(var s=n;s<a;s++)t=t>>>8^o[255&(t^e.charCodeAt(s))];return-1^t}(0|e,t,t.length,0):0}},function(t,e,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,e){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);t.exports=function whatwgRNG(){return r(n),n}}else{var i=new Array(16);t.exports=function mathRNG(){for(var t,e=0;e<16;e++)0==(3&e)&&(t=4294967296*Math.random()),i[e]=t>>>((3&e)<<3)&255;return i}}},function(t,e){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);t.exports=function bytesToUuid(t,e){var n=e||0,i=r;return[i[t[n++]],i[t[n++]],i[t[n++]],i[t[n++]],"-",i[t[n++]],i[t[n++]],"-",i[t[n++]],i[t[n++]],"-",i[t[n++]],i[t[n++]],"-",i[t[n++]],i[t[n++]],i[t[n++]],i[t[n++]],i[t[n++]],i[t[n++]]].join("")}},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});Object.defineProperty(e,"__esModule",{value:!0});var o=r(15),a=r(20),s=function(t){function QueuedEvent(e){var r=t.call(this)||this;r._queued=!1,r.options=e;var n=e||{};return"boolean"==typeof n.condensed?r._condensed=n.condensed:r._condensed=!1,"object"==typeof n.queue&&null!==n.queue&&(r._queue=n.queue),r}return i(QueuedEvent,t),QueuedEvent.prototype.post=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(this._listeners&&0!==this._listeners.length){var n=this._queue?this._queue:a.default.global();if(this._condensed){if(this._queuedData=e,this._queuedListeners=this._listeners,this._queued)return;this._queued=!0,n.add(function(){t._queued=!1;for(var e=t._queuedData,r=t._queuedListeners,n=0;n<r.length;++n){var i=r[n];t._call(i,e)}})}else{var i=this._listeners;n.add(function(){for(var r=0;r<i.length;++r){var n=i[r];t._call(n,e)}})}}},QueuedEvent}(o.BaseEvent);e.QueuedEvent=s;var c=function(t){function VoidQueuedEvent(){return null!==t&&t.apply(this,arguments)||this}return i(VoidQueuedEvent,t),VoidQueuedEvent.prototype.post=function(){t.prototype.post.call(this,void 0)},VoidQueuedEvent}(s);e.VoidQueuedEvent=c;var u=function(t){function ErrorQueuedEvent(){return null!==t&&t.apply(this,arguments)||this}return i(ErrorQueuedEvent,t),ErrorQueuedEvent.prototype.post=function(e){if(!this._listeners||0===this._listeners.length)throw new Error("error event posted while no listeners attached. Error: "+e.message);t.prototype.post.call(this,e)},ErrorQueuedEvent}(s);e.ErrorQueuedEvent=u},function(t,e,r){"use strict";(function(t){var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});Object.defineProperty(e,"__esModule",{value:!0});var o=function(e){function AsyncEvent(t){var r=e.call(this)||this;r._queued=!1,r.options=t;var n=t||{};return"boolean"==typeof n.condensed?r._condensed=n.condensed:r._condensed=!1,r}return i(AsyncEvent,e),AsyncEvent.defaultScheduler=function(e){"undefined"!=typeof window?setTimeout(e,0):t(e)},AsyncEvent.setScheduler=function(t){AsyncEvent._scheduler=t},AsyncEvent.prototype.post=function(){for(var t=this,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(this._listeners&&0!==this._listeners.length)if(this._condensed){if(this._queuedData=e,this._queuedListeners=this._listeners,this._queued)return;this._queued=!0,AsyncEvent._scheduler(function(){t._queued=!1;for(var e=t._queuedData,r=t._queuedListeners,n=0;n<r.length;++n){var i=r[n];t._call(i,e)}})}else{var n=this._listeners;AsyncEvent._scheduler(function(){for(var r=0;r<n.length;++r){var i=n[r];t._call(i,e)}})}},AsyncEvent.prototype._call=function(t,r){t.event&&t.event instanceof AsyncEvent?t.event._postDirect(r):e.prototype._call.call(this,t,r)},AsyncEvent.prototype._postDirect=function(t){if(this._listeners&&0!==this._listeners.length)for(var e=this._listeners,r=0;r<e.length;++r){var n=e[r];this._call(n,t)}},AsyncEvent._scheduler=AsyncEvent.defaultScheduler,AsyncEvent}(r(15).BaseEvent);e.AsyncEvent=o;var a=function(t){function VoidAsyncEvent(){return null!==t&&t.apply(this,arguments)||this}return i(VoidAsyncEvent,t),VoidAsyncEvent.prototype.post=function(){t.prototype.post.call(this,void 0)},VoidAsyncEvent}(o);e.VoidAsyncEvent=a;var s=function(t){function ErrorAsyncEvent(){return null!==t&&t.apply(this,arguments)||this}return i(ErrorAsyncEvent,t),ErrorAsyncEvent.prototype.post=function(e){if(0===this.listenerCount())throw new Error("error event posted while no listeners attached. Error: "+e.message);t.prototype.post.call(this,e)},ErrorAsyncEvent}(o);e.ErrorAsyncEvent=s}).call(this,r(21).setImmediate)},function(t,e,r){t.exports=r(67)},function(t,e,r){"use strict";(function(e,n){var i=r(16);t.exports=Readable;var o,a=r(68);Readable.ReadableState=ReadableState;r(22).EventEmitter;var s=function(t,e){return t.listeners(e).length},c=r(34),u=r(17).Buffer,l=e.Uint8Array||function(){};var p=r(12);p.inherits=r(10);var f=r(69),h=void 0;h=f&&f.debuglog?f.debuglog("stream"):function(){};var d,y=r(70),m=r(35);p.inherits(Readable,c);var v=["error","close","destroy","pause","resume"];function ReadableState(t,e){t=t||{};var n=e instanceof(o=o||r(7));this.objectMode=!!t.objectMode,n&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,a=t.readableHighWaterMark,s=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:n&&(a||0===a)?a:s,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new y,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(d||(d=r(36).StringDecoder),this.decoder=new d(t.encoding),this.encoding=t.encoding)}function Readable(t){if(o=o||r(7),!(this instanceof Readable))return new Readable(t);this._readableState=new ReadableState(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),c.call(this)}function readableAddChunk(t,e,r,n,i){var o,a=t._readableState;null===e?(a.reading=!1,function onEofChunk(t,e){if(e.ended)return;if(e.decoder){var r=e.decoder.end();r&&r.length&&(e.buffer.push(r),e.length+=e.objectMode?1:r.length)}e.ended=!0,emitReadable(t)}(t,a)):(i||(o=function chunkInvalid(t,e){var r;(function _isUint8Array(t){return u.isBuffer(t)||t instanceof l})(e)||"string"==typeof e||void 0===e||t.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));return r}(a,e)),o?t.emit("error",o):a.objectMode||e&&e.length>0?("string"==typeof e||a.objectMode||Object.getPrototypeOf(e)===u.prototype||(e=function _uint8ArrayToBuffer(t){return u.from(t)}(e)),n?a.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):addChunk(t,a,e,!0):a.ended?t.emit("error",new Error("stream.push() after EOF")):(a.reading=!1,a.decoder&&!r?(e=a.decoder.write(e),a.objectMode||0!==e.length?addChunk(t,a,e,!1):maybeReadMore(t,a)):addChunk(t,a,e,!1))):n||(a.reading=!1));return function needMoreData(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(a)}function addChunk(t,e,r,n){e.flowing&&0===e.length&&!e.sync?(t.emit("data",r),t.read(0)):(e.length+=e.objectMode?1:r.length,n?e.buffer.unshift(r):e.buffer.push(r),e.needReadable&&emitReadable(t)),maybeReadMore(t,e)}Object.defineProperty(Readable.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),Readable.prototype.destroy=m.destroy,Readable.prototype._undestroy=m.undestroy,Readable.prototype._destroy=function(t,e){this.push(null),e(t)},Readable.prototype.push=function(t,e){var r,n=this._readableState;return n.objectMode?r=!0:"string"==typeof t&&((e=e||n.defaultEncoding)!==n.encoding&&(t=u.from(t,e),e=""),r=!0),readableAddChunk(this,t,e,!1,r)},Readable.prototype.unshift=function(t){return readableAddChunk(this,t,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(t){return d||(d=r(36).StringDecoder),this._readableState.decoder=new d(t),this._readableState.encoding=t,this};var g=8388608;function howMuchToRead(t,e){return t<=0||0===e.length&&e.ended?0:e.objectMode?1:t!=t?e.flowing&&e.length?e.buffer.head.data.length:e.length:(t>e.highWaterMark&&(e.highWaterMark=function computeNewHighWaterMark(t){return t>=g?t=g:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=e.length?t:e.ended?e.length:(e.needReadable=!0,0))}function emitReadable(t){var e=t._readableState;e.needReadable=!1,e.emittedReadable||(h("emitReadable",e.flowing),e.emittedReadable=!0,e.sync?i.nextTick(emitReadable_,t):emitReadable_(t))}function emitReadable_(t){h("emit readable"),t.emit("readable"),flow(t)}function maybeReadMore(t,e){e.readingMore||(e.readingMore=!0,i.nextTick(maybeReadMore_,t,e))}function maybeReadMore_(t,e){for(var r=e.length;!e.reading&&!e.flowing&&!e.ended&&e.length<e.highWaterMark&&(h("maybeReadMore read 0"),t.read(0),r!==e.length);)r=e.length;e.readingMore=!1}function nReadingNextTick(t){h("readable nexttick read 0"),t.read(0)}function resume_(t,e){e.reading||(h("resume read 0"),t.read(0)),e.resumeScheduled=!1,e.awaitDrain=0,t.emit("resume"),flow(t),e.flowing&&!e.reading&&t.read(0)}function flow(t){var e=t._readableState;for(h("flow",e.flowing);e.flowing&&null!==t.read(););}function fromList(t,e){return 0===e.length?null:(e.objectMode?r=e.buffer.shift():!t||t>=e.length?(r=e.decoder?e.buffer.join(""):1===e.buffer.length?e.buffer.head.data:e.buffer.concat(e.length),e.buffer.clear()):r=function fromListPartial(t,e,r){var n;t<e.head.data.length?(n=e.head.data.slice(0,t),e.head.data=e.head.data.slice(t)):n=t===e.head.data.length?e.shift():r?function copyFromBufferString(t,e){var r=e.head,n=1,i=r.data;t-=i.length;for(;r=r.next;){var o=r.data,a=t>o.length?o.length:t;if(a===o.length?i+=o:i+=o.slice(0,t),0===(t-=a)){a===o.length?(++n,r.next?e.head=r.next:e.head=e.tail=null):(e.head=r,r.data=o.slice(a));break}++n}return e.length-=n,i}(t,e):function copyFromBuffer(t,e){var r=u.allocUnsafe(t),n=e.head,i=1;n.data.copy(r),t-=n.data.length;for(;n=n.next;){var o=n.data,a=t>o.length?o.length:t;if(o.copy(r,r.length-t,0,a),0===(t-=a)){a===o.length?(++i,n.next?e.head=n.next:e.head=e.tail=null):(e.head=n,n.data=o.slice(a));break}++i}return e.length-=i,r}(t,e);return n}(t,e.buffer,e.decoder),r);var r}function endReadable(t){var e=t._readableState;if(e.length>0)throw new Error('"endReadable()" called on non-empty stream');e.endEmitted||(e.ended=!0,i.nextTick(endReadableNT,e,t))}function endReadableNT(t,e){t.endEmitted||0!==t.length||(t.endEmitted=!0,e.readable=!1,e.emit("end"))}function indexOf(t,e){for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}Readable.prototype.read=function(t){h("read",t),t=parseInt(t,10);var e=this._readableState,r=t;if(0!==t&&(e.emittedReadable=!1),0===t&&e.needReadable&&(e.length>=e.highWaterMark||e.ended))return h("read: emitReadable",e.length,e.ended),0===e.length&&e.ended?endReadable(this):emitReadable(this),null;if(0===(t=howMuchToRead(t,e))&&e.ended)return 0===e.length&&endReadable(this),null;var n,i=e.needReadable;return h("need readable",i),(0===e.length||e.length-t<e.highWaterMark)&&h("length less than watermark",i=!0),e.ended||e.reading?h("reading or ended",i=!1):i&&(h("do read"),e.reading=!0,e.sync=!0,0===e.length&&(e.needReadable=!0),this._read(e.highWaterMark),e.sync=!1,e.reading||(t=howMuchToRead(r,e))),null===(n=t>0?fromList(t,e):null)?(e.needReadable=!0,t=0):e.length-=t,0===e.length&&(e.ended||(e.needReadable=!0),r!==t&&e.ended&&endReadable(this)),null!==n&&this.emit("data",n),n},Readable.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},Readable.prototype.pipe=function(t,e){var r=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=t;break;case 1:o.pipes=[o.pipes,t];break;default:o.pipes.push(t)}o.pipesCount+=1,h("pipe count=%d opts=%j",o.pipesCount,e);var c=(!e||!1!==e.end)&&t!==n.stdout&&t!==n.stderr?onend:unpipe;function onunpipe(e,n){h("onunpipe"),e===r&&n&&!1===n.hasUnpiped&&(n.hasUnpiped=!0,function cleanup(){h("cleanup"),t.removeListener("close",onclose),t.removeListener("finish",onfinish),t.removeListener("drain",u),t.removeListener("error",onerror),t.removeListener("unpipe",onunpipe),r.removeListener("end",onend),r.removeListener("end",unpipe),r.removeListener("data",ondata),l=!0,!o.awaitDrain||t._writableState&&!t._writableState.needDrain||u()}())}function onend(){h("onend"),t.end()}o.endEmitted?i.nextTick(c):r.once("end",c),t.on("unpipe",onunpipe);var u=function pipeOnDrain(t){return function(){var e=t._readableState;h("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&s(t,"data")&&(e.flowing=!0,flow(t))}}(r);t.on("drain",u);var l=!1;var p=!1;function ondata(e){h("ondata"),p=!1,!1!==t.write(e)||p||((1===o.pipesCount&&o.pipes===t||o.pipesCount>1&&-1!==indexOf(o.pipes,t))&&!l&&(h("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,p=!0),r.pause())}function onerror(e){h("onerror",e),unpipe(),t.removeListener("error",onerror),0===s(t,"error")&&t.emit("error",e)}function onclose(){t.removeListener("finish",onfinish),unpipe()}function onfinish(){h("onfinish"),t.removeListener("close",onclose),unpipe()}function unpipe(){h("unpipe"),r.unpipe(t)}return r.on("data",ondata),function prependListener(t,e,r){if("function"==typeof t.prependListener)return t.prependListener(e,r);t._events&&t._events[e]?a(t._events[e])?t._events[e].unshift(r):t._events[e]=[r,t._events[e]]:t.on(e,r)}(t,"error",onerror),t.once("close",onclose),t.once("finish",onfinish),t.emit("pipe",r),o.flowing||(h("pipe resume"),r.resume()),t},Readable.prototype.unpipe=function(t){var e=this._readableState,r={hasUnpiped:!1};if(0===e.pipesCount)return this;if(1===e.pipesCount)return t&&t!==e.pipes?this:(t||(t=e.pipes),e.pipes=null,e.pipesCount=0,e.flowing=!1,t&&t.emit("unpipe",this,r),this);if(!t){var n=e.pipes,i=e.pipesCount;e.pipes=null,e.pipesCount=0,e.flowing=!1;for(var o=0;o<i;o++)n[o].emit("unpipe",this,r);return this}var a=indexOf(e.pipes,t);return-1===a?this:(e.pipes.splice(a,1),e.pipesCount-=1,1===e.pipesCount&&(e.pipes=e.pipes[0]),t.emit("unpipe",this,r),this)},Readable.prototype.on=function(t,e){var r=c.prototype.on.call(this,t,e);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&emitReadable(this):i.nextTick(nReadingNextTick,this))}return r},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var t=this._readableState;return t.flowing||(h("resume"),t.flowing=!0,function resume(t,e){e.resumeScheduled||(e.resumeScheduled=!0,i.nextTick(resume_,t,e))}(this,t)),this},Readable.prototype.pause=function(){return h("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(h("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(t){var e=this,r=this._readableState,n=!1;for(var i in t.on("end",function(){if(h("wrapped end"),r.decoder&&!r.ended){var t=r.decoder.end();t&&t.length&&e.push(t)}e.push(null)}),t.on("data",function(i){(h("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i)||(r.objectMode||i&&i.length)&&(e.push(i)||(n=!0,t.pause()))}),t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(e){return function(){return t[e].apply(t,arguments)}}(i));for(var o=0;o<v.length;o++)t.on(v[o],this.emit.bind(this,v[o]));return this._read=function(e){h("wrapped _read",e),n&&(n=!1,t.resume())},this},Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Readable._fromList=fromList}).call(this,r(4),r(11))},function(t,e,r){t.exports=r(22).EventEmitter},function(t,e,r){"use strict";var n=r(16);function emitErrorNT(t,e){t.emit("error",e)}t.exports={destroy:function destroy(t,e){var r=this,i=this._readableState&&this._readableState.destroyed,o=this._writableState&&this._writableState.destroyed;return i||o?(e?e(t):!t||this._writableState&&this._writableState.errorEmitted||n.nextTick(emitErrorNT,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,function(t){!e&&t?(n.nextTick(emitErrorNT,r,t),r._writableState&&(r._writableState.errorEmitted=!0)):e&&e(t)}),this)},undestroy:function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,e,r){"use strict";var n=r(17).Buffer,i=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function StringDecoder(t){var e;switch(this.encoding=function normalizeEncoding(t){var e=function _normalizeEncoding(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(n.isEncoding===i||!i(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,e=4;break;case"utf8":this.fillLast=utf8FillLast,e=4;break;case"base64":this.text=base64Text,this.end=base64End,e=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(e)}function utf8CheckByte(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function utf8FillLast(t){var e=this.lastTotal-this.lastNeed,r=function utf8CheckExtraBytes(t,e,r){if(128!=(192&e[0]))return t.lastNeed=0,"�";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�"}}(this,t);return void 0!==r?r:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function utf16Text(t,e){if((t.length-e)%2==0){var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function utf16End(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function base64Text(t,e){var r=(t.length-e)%3;return 0===r?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function base64End(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function simpleWrite(t){return t.toString(this.encoding)}function simpleEnd(t){return t&&t.length?this.write(t):""}e.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(t){if(0===t.length)return"";var e,r;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},StringDecoder.prototype.end=function utf8End(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�":e},StringDecoder.prototype.text=function utf8Text(t,e){var r=function utf8CheckIncomplete(t,e,r){var n=e.length-1;if(n<r)return 0;var i=utf8CheckByte(e[n]);if(i>=0)return i>0&&(t.lastNeed=i-1),i;if(--n<r||-2===i)return 0;if((i=utf8CheckByte(e[n]))>=0)return i>0&&(t.lastNeed=i-2),i;if(--n<r||-2===i)return 0;if((i=utf8CheckByte(e[n]))>=0)return i>0&&(2===i?i=0:t.lastNeed=i-3),i;return 0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)},StringDecoder.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,e,r){"use strict";t.exports=Transform;var n=r(7),i=r(12);function afterTransform(t,e){var r=this._transformState;r.transforming=!1;var n=r.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=e&&this.push(e),n(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function Transform(t){if(!(this instanceof Transform))return new Transform(t);n.call(this,t),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",prefinish)}function prefinish(){var t=this;"function"==typeof this._flush?this._flush(function(e,r){done(t,e,r)}):done(this,null,null)}function done(t,e,r){if(e)return t.emit("error",e);if(null!=r&&t.push(r),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}i.inherits=r(10),i.inherits(Transform,n),Transform.prototype.push=function(t,e){return this._transformState.needTransform=!1,n.prototype.push.call(this,t,e)},Transform.prototype._transform=function(t,e,r){throw new Error("_transform() is not implemented")},Transform.prototype._write=function(t,e,r){var n=this._transformState;if(n.writecb=r,n.writechunk=t,n.writeencoding=e,!n.transforming){var i=this._readableState;(n.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},Transform.prototype._read=function(t){var e=this._transformState;null!==e.writechunk&&e.writecb&&!e.transforming?(e.transforming=!0,this._transform(e.writechunk,e.writeencoding,e.afterTransform)):e.needTransform=!0},Transform.prototype._destroy=function(t,e){var r=this;n.prototype._destroy.call(this,t,function(t){e(t),r.emit("close")})}},function(t,e,r){"use strict";var n=r(1),i=r(5),o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e.encode=function(t){for(var e,r,i,a,s,c,u,l=[],p=0,f=t.length,h=f,d="string"!==n.getTypeOf(t);p<t.length;)h=f-p,d?(e=t[p++],r=p<f?t[p++]:0,i=p<f?t[p++]:0):(e=t.charCodeAt(p++),r=p<f?t.charCodeAt(p++):0,i=p<f?t.charCodeAt(p++):0),a=e>>2,s=(3&e)<<4|r>>4,c=h>1?(15&r)<<2|i>>6:64,u=h>2?63&i:64,l.push(o.charAt(a)+o.charAt(s)+o.charAt(c)+o.charAt(u));return l.join("")},e.decode=function(t){var e,r,n,a,s,c,u=0,l=0;if("data:"===t.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var p,f=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===o.charAt(64)&&f--,t.charAt(t.length-2)===o.charAt(64)&&f--,f%1!=0)throw new Error("Invalid base64 input, bad content length.");for(p=i.uint8array?new Uint8Array(0|f):new Array(0|f);u<t.length;)e=o.indexOf(t.charAt(u++))<<2|(a=o.indexOf(t.charAt(u++)))>>4,r=(15&a)<<4|(s=o.indexOf(t.charAt(u++)))>>2,n=(3&s)<<6|(c=o.indexOf(t.charAt(u++))),p[l++]=e,64!==s&&(p[l++]=r),64!==c&&(p[l++]=n);return p}},function(t,e,r){"use strict";(function(e){var n=r(1),i=r(81),o=r(3),a=r(38),s=r(5),c=r(13),u=null;if(s.nodestream)try{u=r(82)}catch(t){}function accumulate(t,r){return new c.Promise(function(i,o){var s=[],c=t._internalType,u=t._outputType,l=t._mimeType;t.on("data",function(t,e){s.push(t),r&&r(e)}).on("error",function(t){s=[],o(t)}).on("end",function(){try{var t=function transformZipOutput(t,e,r){switch(t){case"blob":return n.newBlob(n.transformTo("arraybuffer",e),r);case"base64":return a.encode(e);default:return n.transformTo(t,e)}}(u,function concat(t,r){var n,i=0,o=null,a=0;for(n=0;n<r.length;n++)a+=r[n].length;switch(t){case"string":return r.join("");case"array":return Array.prototype.concat.apply([],r);case"uint8array":for(o=new Uint8Array(a),n=0;n<r.length;n++)o.set(r[n],i),i+=r[n].length;return o;case"nodebuffer":return e.concat(r);default:throw new Error("concat : unsupported type '"+t+"'")}}(c,s),l);i(t)}catch(t){o(t)}s=[]}).resume()})}function StreamHelper(t,e,r){var a=e;switch(e){case"blob":case"arraybuffer":a="uint8array";break;case"base64":a="string"}try{this._internalType=a,this._outputType=e,this._mimeType=r,n.checkSupport(a),this._worker=t.pipe(new i(a)),t.lock()}catch(t){this._worker=new o("error"),this._worker.error(t)}}StreamHelper.prototype={accumulate:function(t){return accumulate(this,t)},on:function(t,e){var r=this;return"data"===t?this._worker.on(t,function(t){e.call(r,t.data,t.meta)}):this._worker.on(t,function(){n.delay(e,arguments,r)}),this},resume:function(){return n.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(n.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new u(this,{objectMode:"nodebuffer"!==this._outputType},t)}},t.exports=StreamHelper}).call(this,r(8).Buffer)},function(t,e,r){"use strict";e.base64=!1,e.binary=!1,e.dir=!1,e.createFolders=!0,e.date=null,e.compression=null,e.compressionOptions=null,e.comment=null,e.unixPermissions=null,e.dosPermissions=null},function(t,e,r){"use strict";var n=r(1),i=r(3);function DataWorker(t){i.call(this,"DataWorker");var e=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then(function(t){e.dataIsReady=!0,e.data=t,e.max=t&&t.length||0,e.type=n.getTypeOf(t),e.isPaused||e._tickAndRepeat()},function(t){e.error(t)})}n.inherits(DataWorker,i),DataWorker.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},DataWorker.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,n.delay(this._tickAndRepeat,[],this)),!0)},DataWorker.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(n.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},DataWorker.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,e=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,e);break;case"uint8array":t=this.data.subarray(this.index,e);break;case"array":case"nodebuffer":t=this.data.slice(this.index,e)}return this.index=e,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=DataWorker},function(t,e,r){"use strict";var n=r(1),i=r(3);function DataLengthProbe(t){i.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}n.inherits(DataLengthProbe,i),DataLengthProbe.prototype.processChunk=function(t){if(t){var e=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=e+t.data.length}i.prototype.processChunk.call(this,t)},t.exports=DataLengthProbe},function(t,e,r){"use strict";var n=r(3),i=r(26);function Crc32Probe(){n.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r(1).inherits(Crc32Probe,n),Crc32Probe.prototype.processChunk=function(t){this.streamInfo.crc32=i(t.data,this.streamInfo.crc32||0),this.push(t)},t.exports=Crc32Probe},function(t,e,r){"use strict";var n=r(3);e.STORE={magic:"\0\0",compressWorker:function(t){return new n("STORE compression")},uncompressWorker:function(){return new n("STORE decompression")}},e.DEFLATE=r(85)},function(t,e,r){"use strict";t.exports=function adler32(t,e,r,n){for(var i=65535&t|0,o=t>>>16&65535|0,a=0;0!==r;){r-=a=r>2e3?2e3:r;do{o=o+(i=i+e[n++]|0)|0}while(--a);i%=65521,o%=65521}return i|o<<16|0}},function(t,e,r){"use strict";var n=function makeTable(){for(var t,e=[],r=0;r<256;r++){t=r;for(var n=0;n<8;n++)t=1&t?3988292384^t>>>1:t>>>1;e[r]=t}return e}();t.exports=function crc32(t,e,r,i){var o=n,a=i+r;t^=-1;for(var s=i;s<a;s++)t=t>>>8^o[255&(t^e[s])];return-1^t}},function(t,e,r){"use strict";var n=r(6),i=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){o=!1}for(var a=new n.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function buf2binstring(t,e){if(e<65534&&(t.subarray&&o||!t.subarray&&i))return String.fromCharCode.apply(null,n.shrinkBuf(t,e));for(var r="",a=0;a<e;a++)r+=String.fromCharCode(t[a]);return r}a[254]=a[254]=1,e.string2buf=function(t){var e,r,i,o,a,s=t.length,c=0;for(o=0;o<s;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),c+=r<128?1:r<2048?2:r<65536?3:4;for(e=new n.Buf8(c),a=0,o=0;a<c;o++)55296==(64512&(r=t.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=t.charCodeAt(o+1)))&&(r=65536+(r-55296<<10)+(i-56320),o++),r<128?e[a++]=r:r<2048?(e[a++]=192|r>>>6,e[a++]=128|63&r):r<65536?(e[a++]=224|r>>>12,e[a++]=128|r>>>6&63,e[a++]=128|63&r):(e[a++]=240|r>>>18,e[a++]=128|r>>>12&63,e[a++]=128|r>>>6&63,e[a++]=128|63&r);return e},e.buf2binstring=function(t){return buf2binstring(t,t.length)},e.binstring2buf=function(t){for(var e=new n.Buf8(t.length),r=0,i=e.length;r<i;r++)e[r]=t.charCodeAt(r);return e},e.buf2string=function(t,e){var r,n,i,o,s=e||t.length,c=new Array(2*s);for(n=0,r=0;r<s;)if((i=t[r++])<128)c[n++]=i;else if((o=a[i])>4)c[n++]=65533,r+=o-1;else{for(i&=2===o?31:3===o?15:7;o>1&&r<s;)i=i<<6|63&t[r++],o--;o>1?c[n++]=65533:i<65536?c[n++]=i:(i-=65536,c[n++]=55296|i>>10&1023,c[n++]=56320|1023&i)}return buf2binstring(c,n)},e.utf8border=function(t,e){var r;for((e=e||t.length)>t.length&&(e=t.length),r=e-1;r>=0&&128==(192&t[r]);)r--;return r<0?e:0===r?e:r+a[t[r]]>e?r:e}},function(t,e,r){"use strict";t.exports=function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,e,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,e,r){"use strict";e.LOCAL_FILE_HEADER="PK",e.CENTRAL_FILE_HEADER="PK",e.CENTRAL_DIRECTORY_END="PK",e.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",e.ZIP64_CENTRAL_DIRECTORY_END="PK",e.DATA_DESCRIPTOR="PK\b"},function(t,e,r){"use strict";var n=r(1),i=r(5),o=r(52),a=r(99),s=r(100),c=r(54);t.exports=function(t){var e=n.getTypeOf(t);return n.checkSupport(e),"string"!==e||i.uint8array?"nodebuffer"===e?new s(t):i.uint8array?new c(n.transformTo("uint8array",t)):new o(n.transformTo("array",t)):new a(t)}},function(t,e,r){"use strict";var n=r(53);function ArrayReader(t){n.call(this,t);for(var e=0;e<this.data.length;e++)t[e]=255&t[e]}r(1).inherits(ArrayReader,n),ArrayReader.prototype.byteAt=function(t){return this.data[this.zero+t]},ArrayReader.prototype.lastIndexOfSignature=function(t){for(var e=t.charCodeAt(0),r=t.charCodeAt(1),n=t.charCodeAt(2),i=t.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===e&&this.data[o+1]===r&&this.data[o+2]===n&&this.data[o+3]===i)return o-this.zero;return-1},ArrayReader.prototype.readAndCheckSignature=function(t){var e=t.charCodeAt(0),r=t.charCodeAt(1),n=t.charCodeAt(2),i=t.charCodeAt(3),o=this.readData(4);return e===o[0]&&r===o[1]&&n===o[2]&&i===o[3]},ArrayReader.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},t.exports=ArrayReader},function(t,e,r){"use strict";var n=r(1);function DataReader(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}DataReader.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var e,r=0;for(this.checkOffset(t),e=this.index+t-1;e>=this.index;e--)r=(r<<8)+this.byteAt(e);return this.index+=t,r},readString:function(t){return n.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},t.exports=DataReader},function(t,e,r){"use strict";var n=r(52);function Uint8ArrayReader(t){n.call(this,t)}r(1).inherits(Uint8ArrayReader,n),Uint8ArrayReader.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var e=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},t.exports=Uint8ArrayReader},function(t,e,r){(function(t,e){
/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var r;!function(r){!function(n){var i="object"==typeof e?e:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),o=makeExporter(r);function makeExporter(t,e){return function(r,n){"function"!=typeof t[r]&&Object.defineProperty(t,r,{configurable:!0,writable:!0,value:n}),e&&e(r,n)}}void 0===i.Reflect?i.Reflect=r:o=makeExporter(i.Reflect,o),function(e){var r=Object.prototype.hasOwnProperty,n="function"==typeof Symbol,i=n&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=n&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",a="function"==typeof Object.create,s={__proto__:[]}instanceof Array,c=!a&&!s,u={create:a?function(){return MakeDictionary(Object.create(null))}:s?function(){return MakeDictionary({__proto__:null})}:function(){return MakeDictionary({})},has:c?function(t,e){return r.call(t,e)}:function(t,e){return e in t},get:c?function(t,e){return r.call(t,e)?t[e]:void 0}:function(t,e){return t[e]}},l=Object.getPrototypeOf(Function),p="object"==typeof t&&t.env&&"true"===t.env.REFLECT_METADATA_USE_MAP_POLYFILL,f=p||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function CreateMapPolyfill(){var t={},e=[],r=function(){function MapIterator(t,e,r){this._index=0,this._keys=t,this._values=e,this._selector=r}return MapIterator.prototype["@@iterator"]=function(){return this},MapIterator.prototype[o]=function(){return this},MapIterator.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var r=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},MapIterator.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},MapIterator.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},MapIterator}();return function(){function Map(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(Map.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Map.prototype.has=function(t){return this._find(t,!1)>=0},Map.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},Map.prototype.set=function(t,e){var r=this._find(t,!0);return this._values[r]=e,this},Map.prototype.delete=function(e){var r=this._find(e,!1);if(r>=0){for(var n=this._keys.length,i=r+1;i<n;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},Map.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},Map.prototype.keys=function(){return new r(this._keys,this._values,getKey)},Map.prototype.values=function(){return new r(this._keys,this._values,getValue)},Map.prototype.entries=function(){return new r(this._keys,this._values,getEntry)},Map.prototype["@@iterator"]=function(){return this.entries()},Map.prototype[o]=function(){return this.entries()},Map.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},Map}();function getKey(t,e){return t}function getValue(t,e){return e}function getEntry(t,e){return[t,e]}}():Map,h=p||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function CreateSetPolyfill(){return function(){function Set(){this._map=new f}return Object.defineProperty(Set.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Set.prototype.has=function(t){return this._map.has(t)},Set.prototype.add=function(t){return this._map.set(t,t),this},Set.prototype.delete=function(t){return this._map.delete(t)},Set.prototype.clear=function(){this._map.clear()},Set.prototype.keys=function(){return this._map.keys()},Set.prototype.values=function(){return this._map.values()},Set.prototype.entries=function(){return this._map.entries()},Set.prototype["@@iterator"]=function(){return this.keys()},Set.prototype[o]=function(){return this.keys()},Set}()}():Set,d=new(p||"function"!=typeof WeakMap?function CreateWeakMapPolyfill(){var t=16,e=u.create(),n=CreateUniqueKey();return function(){function WeakMap(){this._key=CreateUniqueKey()}return WeakMap.prototype.has=function(t){var e=GetOrCreateWeakMapTable(t,!1);return void 0!==e&&u.has(e,this._key)},WeakMap.prototype.get=function(t){var e=GetOrCreateWeakMapTable(t,!1);return void 0!==e?u.get(e,this._key):void 0},WeakMap.prototype.set=function(t,e){var r=GetOrCreateWeakMapTable(t,!0);return r[this._key]=e,this},WeakMap.prototype.delete=function(t){var e=GetOrCreateWeakMapTable(t,!1);return void 0!==e&&delete e[this._key]},WeakMap.prototype.clear=function(){this._key=CreateUniqueKey()},WeakMap}();function CreateUniqueKey(){var t;do{t="@@WeakMap@@"+CreateUUID()}while(u.has(e,t));return e[t]=!0,t}function GetOrCreateWeakMapTable(t,e){if(!r.call(t,n)){if(!e)return;Object.defineProperty(t,n,{value:u.create()})}return t[n]}function FillRandomBytes(t,e){for(var r=0;r<e;++r)t[r]=255*Math.random()|0;return t}function CreateUUID(){var e=function GenRandomBytes(t){if("function"==typeof Uint8Array)return"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):FillRandomBytes(new Uint8Array(t),t);return FillRandomBytes(new Array(t),t)}(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var r="",n=0;n<t;++n){var i=e[n];4!==n&&6!==n&&8!==n||(r+="-"),i<16&&(r+="0"),r+=i.toString(16).toLowerCase()}return r}}():WeakMap);function GetOrCreateMetadataMap(t,e,r){var n=d.get(t);if(IsUndefined(n)){if(!r)return;n=new f,d.set(t,n)}var i=n.get(e);if(IsUndefined(i)){if(!r)return;i=new f,n.set(e,i)}return i}function OrdinaryHasOwnMetadata(t,e,r){var n=GetOrCreateMetadataMap(e,r,!1);return!IsUndefined(n)&&function ToBoolean(t){return!!t}(n.has(t))}function OrdinaryGetOwnMetadata(t,e,r){var n=GetOrCreateMetadataMap(e,r,!1);if(!IsUndefined(n))return n.get(t)}function OrdinaryDefineOwnMetadata(t,e,r,n){var i=GetOrCreateMetadataMap(r,n,!0);i.set(t,e)}function OrdinaryOwnMetadataKeys(t,e){var r=[],n=GetOrCreateMetadataMap(t,e,!1);if(IsUndefined(n))return r;for(var i=n.keys(),a=function GetIterator(t){var e=GetMethod(t,o);if(!IsCallable(e))throw new TypeError;var r=e.call(t);if(!IsObject(r))throw new TypeError;return r}(i),s=0;;){var c=IteratorStep(a);if(!c)return r.length=s,r;var u=c.value;try{r[s]=u}catch(t){try{IteratorClose(a)}finally{throw t}}s++}}function Type(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function IsUndefined(t){return void 0===t}function IsNull(t){return null===t}function IsObject(t){return"object"==typeof t?null!==t:"function"==typeof t}function ToPrimitive(t,e){switch(Type(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var r=3===e?"string":5===e?"number":"default",n=GetMethod(t,i);if(void 0!==n){var o=n.call(t,r);if(IsObject(o))throw new TypeError;return o}return function OrdinaryToPrimitive(t,e){if("string"===e){var r=t.toString;if(IsCallable(r)){var n=r.call(t);if(!IsObject(n))return n}var i=t.valueOf;if(IsCallable(i)){var n=i.call(t);if(!IsObject(n))return n}}else{var i=t.valueOf;if(IsCallable(i)){var n=i.call(t);if(!IsObject(n))return n}var o=t.toString;if(IsCallable(o)){var n=o.call(t);if(!IsObject(n))return n}}throw new TypeError}(t,"default"===r?"number":r)}function ToPropertyKey(t){var e=ToPrimitive(t,3);return function IsSymbol(t){return"symbol"==typeof t}(e)?e:function ToString(t){return""+t}(e)}function IsArray(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function IsCallable(t){return"function"==typeof t}function IsConstructor(t){return"function"==typeof t}function GetMethod(t,e){var r=t[e];if(null!=r){if(!IsCallable(r))throw new TypeError;return r}}function IteratorStep(t){var e=t.next();return!e.done&&e}function IteratorClose(t){var e=t.return;e&&e.call(t)}function OrdinaryGetPrototypeOf(t){var e=Object.getPrototypeOf(t);if("function"!=typeof t||t===l)return e;if(e!==l)return e;var r=t.prototype,n=r&&Object.getPrototypeOf(r);if(null==n||n===Object.prototype)return e;var i=n.constructor;return"function"!=typeof i?e:i===t?e:i}function MakeDictionary(t){return t.__=void 0,delete t.__,t}e("decorate",function decorate(t,e,r,n){if(IsUndefined(r)){if(!IsArray(t))throw new TypeError;if(!IsConstructor(e))throw new TypeError;return function DecorateConstructor(t,e){for(var r=t.length-1;r>=0;--r){var n=t[r],i=n(e);if(!IsUndefined(i)&&!IsNull(i)){if(!IsConstructor(i))throw new TypeError;e=i}}return e}(t,e)}if(!IsArray(t))throw new TypeError;if(!IsObject(e))throw new TypeError;if(!IsObject(n)&&!IsUndefined(n)&&!IsNull(n))throw new TypeError;return IsNull(n)&&(n=void 0),r=ToPropertyKey(r),function DecorateProperty(t,e,r,n){for(var i=t.length-1;i>=0;--i){var o=t[i],a=o(e,r,n);if(!IsUndefined(a)&&!IsNull(a)){if(!IsObject(a))throw new TypeError;n=a}}return n}(t,e,r,n)}),e("metadata",function metadata(t,e){return function decorator(r,n){if(!IsObject(r))throw new TypeError;if(!IsUndefined(n)&&!function IsPropertyKey(t){switch(Type(t)){case 3:case 4:return!0;default:return!1}}(n))throw new TypeError;OrdinaryDefineOwnMetadata(t,e,r,n)}}),e("defineMetadata",function defineMetadata(t,e,r,n){if(!IsObject(r))throw new TypeError;IsUndefined(n)||(n=ToPropertyKey(n));return OrdinaryDefineOwnMetadata(t,e,r,n)}),e("hasMetadata",function hasMetadata(t,e,r){if(!IsObject(e))throw new TypeError;IsUndefined(r)||(r=ToPropertyKey(r));return function OrdinaryHasMetadata(t,e,r){var n=OrdinaryHasOwnMetadata(t,e,r);if(n)return!0;var i=OrdinaryGetPrototypeOf(e);if(!IsNull(i))return OrdinaryHasMetadata(t,i,r);return!1}(t,e,r)}),e("hasOwnMetadata",function hasOwnMetadata(t,e,r){if(!IsObject(e))throw new TypeError;IsUndefined(r)||(r=ToPropertyKey(r));return OrdinaryHasOwnMetadata(t,e,r)}),e("getMetadata",function getMetadata(t,e,r){if(!IsObject(e))throw new TypeError;IsUndefined(r)||(r=ToPropertyKey(r));return function OrdinaryGetMetadata(t,e,r){var n=OrdinaryHasOwnMetadata(t,e,r);if(n)return OrdinaryGetOwnMetadata(t,e,r);var i=OrdinaryGetPrototypeOf(e);if(!IsNull(i))return OrdinaryGetMetadata(t,i,r);return}(t,e,r)}),e("getOwnMetadata",function getOwnMetadata(t,e,r){if(!IsObject(e))throw new TypeError;IsUndefined(r)||(r=ToPropertyKey(r));return OrdinaryGetOwnMetadata(t,e,r)}),e("getMetadataKeys",function getMetadataKeys(t,e){if(!IsObject(t))throw new TypeError;IsUndefined(e)||(e=ToPropertyKey(e));return function OrdinaryMetadataKeys(t,e){var r=OrdinaryOwnMetadataKeys(t,e);var n=OrdinaryGetPrototypeOf(t);if(null===n)return r;var i=OrdinaryMetadataKeys(n,e);if(i.length<=0)return r;if(r.length<=0)return i;var o=new h;var a=[];for(var s=0,c=r;s<c.length;s++){var u=c[s],l=o.has(u);l||(o.add(u),a.push(u))}for(var p=0,f=i;p<f.length;p++){var u=f[p],l=o.has(u);l||(o.add(u),a.push(u))}return a}(t,e)}),e("getOwnMetadataKeys",function getOwnMetadataKeys(t,e){if(!IsObject(t))throw new TypeError;IsUndefined(e)||(e=ToPropertyKey(e));return OrdinaryOwnMetadataKeys(t,e)}),e("deleteMetadata",function deleteMetadata(t,e,r){if(!IsObject(e))throw new TypeError;IsUndefined(r)||(r=ToPropertyKey(r));var n=GetOrCreateMetadataMap(e,r,!1);if(IsUndefined(n))return!1;if(!n.delete(t))return!1;if(n.size>0)return!0;var i=d.get(e);return i.delete(r),i.size>0||(d.delete(e),!0)})}(o)}()}(r||(r={}))}).call(this,r(11),r(4))},function(t,e,r){var n=r(57),i=r(58),o=i;o.v1=n,o.v4=i,t.exports=o},function(t,e,r){var n,i,o=r(28),a=r(29),s=0,c=0;t.exports=function v1(t,e,r){var u=e&&r||0,l=e||[],p=(t=t||{}).node||n,f=void 0!==t.clockseq?t.clockseq:i;if(null==p||null==f){var h=o();null==p&&(p=n=[1|h[0],h[1],h[2],h[3],h[4],h[5]]),null==f&&(f=i=16383&(h[6]<<8|h[7]))}var d=void 0!==t.msecs?t.msecs:(new Date).getTime(),y=void 0!==t.nsecs?t.nsecs:c+1,m=d-s+(y-c)/1e4;if(m<0&&void 0===t.clockseq&&(f=f+1&16383),(m<0||d>s)&&void 0===t.nsecs&&(y=0),y>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=d,c=y,i=f;var v=(1e4*(268435455&(d+=122192928e5))+y)%4294967296;l[u++]=v>>>24&255,l[u++]=v>>>16&255,l[u++]=v>>>8&255,l[u++]=255&v;var g=d/4294967296*1e4&268435455;l[u++]=g>>>8&255,l[u++]=255&g,l[u++]=g>>>24&15|16,l[u++]=g>>>16&255,l[u++]=f>>>8|128,l[u++]=255&f;for(var _=0;_<6;++_)l[u+_]=p[_];return e||a(l)}},function(t,e,r){var n=r(28),i=r(29);t.exports=function v4(t,e,r){var o=e&&r||0;"string"==typeof t&&(e="binary"===t?new Array(16):null,t=null);var a=(t=t||{}).random||(t.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,e)for(var s=0;s<16;++s)e[o+s]=a[s];return e||i(a)}},function(t,e,r){(function(t,e){!function(t,r){"use strict";if(!t.setImmediate){var n,i=1,o={},a=!1,s=t.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(t);c=c&&c.setTimeout?c:t,"[object process]"==={}.toString.call(t.process)?function installNextTickImplementation(){n=function(t){e.nextTick(function(){runIfPresent(t)})}}():!function canUsePostMessage(){if(t.postMessage&&!t.importScripts){var e=!0,r=t.onmessage;return t.onmessage=function(){e=!1},t.postMessage("","*"),t.onmessage=r,e}}()?t.MessageChannel?function installMessageChannelImplementation(){var t=new MessageChannel;t.port1.onmessage=function(t){runIfPresent(t.data)},n=function(e){t.port2.postMessage(e)}}():s&&"onreadystatechange"in s.createElement("script")?function installReadyStateChangeImplementation(){var t=s.documentElement;n=function(e){var r=s.createElement("script");r.onreadystatechange=function(){runIfPresent(e),r.onreadystatechange=null,t.removeChild(r),r=null},t.appendChild(r)}}():function installSetTimeoutImplementation(){n=function(t){setTimeout(runIfPresent,0,t)}}():function installPostMessageImplementation(){var e="setImmediate$"+Math.random()+"$",r=function(r){r.source===t&&"string"==typeof r.data&&0===r.data.indexOf(e)&&runIfPresent(+r.data.slice(e.length))};t.addEventListener?t.addEventListener("message",r,!1):t.attachEvent("onmessage",r),n=function(r){t.postMessage(e+r,"*")}}(),c.setImmediate=function setImmediate(t){"function"!=typeof t&&(t=new Function(""+t));for(var e=new Array(arguments.length-1),r=0;r<e.length;r++)e[r]=arguments[r+1];var a={callback:t,args:e};return o[i]=a,n(i),i++},c.clearImmediate=clearImmediate}function clearImmediate(t){delete o[t]}function runIfPresent(t){if(a)setTimeout(runIfPresent,0,t);else{var e=o[t];if(e){a=!0;try{!function run(t){var e=t.callback,n=t.args;switch(n.length){case 0:e();break;case 1:e(n[0]);break;case 2:e(n[0],n[1]);break;case 3:e(n[0],n[1],n[2]);break;default:e.apply(r,n)}}(e)}finally{clearImmediate(t),a=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,r(4),r(11))},function(t,e,r){"use strict";var n,i=this&&this.__extends||(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)});Object.defineProperty(e,"__esModule",{value:!0});var o,a=r(61),s=r(19),c=r(31),u=r(30);!function(t){t[t.Sync=0]="Sync",t[t.Async=1]="Async",t[t.Queued=2]="Queued"}(o=e.EventType||(e.EventType={}));var l=function(){function AnyEvent(t){this._events=[],t&&t.monitorAttach&&(this.evtFirstAttached=new p,this.evtLastDetached=new p)}return AnyEvent.prototype.attach=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=o.Sync;t.length>0&&"number"==typeof t[0]&&(r=t.shift());var n,i,a,s=this;"function"==typeof t[0]||t[0]&&"object"==typeof t[0]&&"function"==typeof t[0].post?("function"==typeof t[0]?n=t[0]:a=t[0],i=t[1]):(s=t[0],n=t[1],i=t[2]),this._attach(r,s,n,a,i,!1)},AnyEvent.prototype.once=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=o.Sync;t.length>0&&"number"==typeof t[0]&&(r=t.shift());var n,i,a,s=this;"function"==typeof t[0]||t[0]&&"object"==typeof t[0]&&"function"==typeof t[0].post?("function"==typeof t[0]?n=t[0]:a=t[0],i=t[1]):(s=t[0],n=t[1],i=t[2]),this._attach(r,s,n,a,i,!0)},AnyEvent.prototype._attach=function(t,e,r,n,i,l){var p,f=this.evtFirstAttached?this.listenerCount():0;switch(t){case o.Sync:for(var h=0,d=this._events;h<d.length;h++){(_=d[h])instanceof s.SyncEvent&&(p=_)}p||(p=new s.SyncEvent,this._events.push(p));break;case o.Async:for(var y=0,m=this._events;y<m.length;y++){(_=m[y])instanceof c.AsyncEvent&&a.shallowEquals(_.options,i)&&(p=_)}p||(p=new c.AsyncEvent(i),this._events.push(p));break;case o.Queued:for(var v=0,g=this._events;v<g.length;v++){var _;(_=g[v])instanceof u.QueuedEvent&&a.shallowEquals(_.options,i)&&(p=_)}p||(p=new u.QueuedEvent(i),this._events.push(p));break;default:throw new Error("unknown EventType")}l?n?p.once(n):p.once(e,r):n?p.attach(n):p.attach(e,r),this.evtFirstAttached&&0===f&&this.evtFirstAttached.post()},AnyEvent.prototype.attachSync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift(o.Sync),this.attach.apply(this,t)},AnyEvent.prototype.onceSync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift(o.Sync),this.once.apply(this,t)},AnyEvent.prototype.attachAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift(o.Async),this.attach.apply(this,t)},AnyEvent.prototype.onceAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift(o.Async),this.once.apply(this,t)},AnyEvent.prototype.attachQueued=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift(o.Queued),this.attach.apply(this,t)},AnyEvent.prototype.onceQueued=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];t.unshift(o.Queued),this.once.apply(this,t)},AnyEvent.prototype.detach=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=this.evtLastDetached?this.listenerCount():0,n=0;n<this._events.length;++n)this._events[n].detach.apply(this._events[n],t);this.evtLastDetached&&r>0&&0===this.listenerCount()&&this.evtLastDetached.post()},AnyEvent.prototype.post=function(t){for(var e=[],r=0;r<this._events.length;++r)e.push(this._events[r]);for(r=0;r<e.length;++r)e[r].post(t)},AnyEvent.prototype.listenerCount=function(){for(var t=0,e=0;e<this._events.length;++e)t+=this._events[e].listenerCount();return t},AnyEvent}();e.AnyEvent=l;var p=function(t){function VoidAnyEvent(){return null!==t&&t.apply(this,arguments)||this}return i(VoidAnyEvent,t),VoidAnyEvent.prototype.post=function(){t.prototype.post.call(this,void 0)},VoidAnyEvent}(l);e.VoidAnyEvent=p;var f=function(t){function ErrorAnyEvent(){return null!==t&&t.apply(this,arguments)||this}return i(ErrorAnyEvent,t),ErrorAnyEvent.prototype.post=function(e){if(0===this.listenerCount())throw new Error("error event posted while no listeners attached. Error: "+e.message);t.prototype.post.call(this,e)},ErrorAnyEvent}(l);e.ErrorAnyEvent=f},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.shallowEquals=function shallowEquals(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;switch(typeof t){case"boolean":case"number":case"string":case"function":case"symbol":case"undefined":return!1;case"object":if(null===t||null===e)return!1;if(Array.isArray(t)||Array.isArray(e)){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(var r=0;r<t.length;++r)if(t[r]!==e[r])return!1;return!0}var n=[],i=[];for(var o in t)t.hasOwnProperty(o)&&n.push(o);for(var a in e)e.hasOwnProperty(a)&&i.push(a);if(n.sort(),i.sort(),n.join(",")!==i.join(","))return!1;for(r=0;r<n.length;++r)if(t[n[r]]!==e[n[r]])return!1;return!0;default:return!1}}},function(t,e,r){"use strict";e.byteLength=function byteLength(t){var e=getLens(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function toByteArray(t){for(var e,r=getLens(t),n=r[0],a=r[1],s=new o(function _byteLength(t,e,r){return 3*(e+r)/4-r}(0,n,a)),c=0,u=a>0?n-4:n,l=0;l<u;l+=4)e=i[t.charCodeAt(l)]<<18|i[t.charCodeAt(l+1)]<<12|i[t.charCodeAt(l+2)]<<6|i[t.charCodeAt(l+3)],s[c++]=e>>16&255,s[c++]=e>>8&255,s[c++]=255&e;2===a&&(e=i[t.charCodeAt(l)]<<2|i[t.charCodeAt(l+1)]>>4,s[c++]=255&e);1===a&&(e=i[t.charCodeAt(l)]<<10|i[t.charCodeAt(l+1)]<<4|i[t.charCodeAt(l+2)]>>2,s[c++]=e>>8&255,s[c++]=255&e);return s},e.fromByteArray=function fromByteArray(t){for(var e,r=t.length,i=r%3,o=[],a=0,s=r-i;a<s;a+=16383)o.push(encodeChunk(t,a,a+16383>s?s:a+16383));1===i?(e=t[r-1],o.push(n[e>>2]+n[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],o.push(n[e>>10]+n[e>>4&63]+n[e<<2&63]+"="));return o.join("")};for(var n=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=a.length;s<c;++s)n[s]=a[s],i[a.charCodeAt(s)]=s;function getLens(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function encodeChunk(t,e,r){for(var i,o,a=[],s=e;s<r;s+=3)i=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),a.push(n[(o=i)>>18&63]+n[o>>12&63]+n[o>>6&63]+n[63&o]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,r,n,i){var o,a,s=8*i-n-1,c=(1<<s)-1,u=c>>1,l=-7,p=r?i-1:0,f=r?-1:1,h=t[e+p];for(p+=f,o=h&(1<<-l)-1,h>>=-l,l+=s;l>0;o=256*o+t[e+p],p+=f,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=n;l>0;a=256*a+t[e+p],p+=f,l-=8);if(0===o)o=1-u;else{if(o===c)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,n),o-=u}return(h?-1:1)*a*Math.pow(2,o-n)},e.write=function(t,e,r,n,i,o){var a,s,c,u=8*o-i-1,l=(1<<u)-1,p=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=n?0:o-1,d=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),(e+=a+p>=1?f/c:f*Math.pow(2,1-p))*c>=2&&(a++,c/=2),a+p>=l?(s=0,a=l):a+p>=1?(s=(e*c-1)*Math.pow(2,i),a+=p):(s=e*Math.pow(2,p-1)*Math.pow(2,i),a=0));i>=8;t[r+h]=255&s,h+=d,s/=256,i-=8);for(a=a<<i|s,u+=i;u>0;t[r+h]=255&a,h+=d,a/=256,u-=8);t[r+h-d]|=128*y}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e,r){"use strict";function JSZip(){if(!(this instanceof JSZip))return new JSZip;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new JSZip;for(var e in this)"function"!=typeof this[e]&&(t[e]=this[e]);return t}}JSZip.prototype=r(66),JSZip.prototype.loadAsync=r(97),JSZip.support=r(5),JSZip.defaults=r(40),JSZip.version="3.2.0",JSZip.loadAsync=function(t,e){return(new JSZip).loadAsync(t,e)},JSZip.external=r(13),t.exports=JSZip},function(t,e,r){"use strict";var n=r(9),i=r(1),o=r(3),a=r(39),s=r(40),c=r(25),u=r(83),l=r(84),p=r(18),f=r(96),h=function(t,e,r){var n,a=i.getTypeOf(e),l=i.extend(r||{},s);l.date=l.date||new Date,null!==l.compression&&(l.compression=l.compression.toUpperCase()),"string"==typeof l.unixPermissions&&(l.unixPermissions=parseInt(l.unixPermissions,8)),l.unixPermissions&&16384&l.unixPermissions&&(l.dir=!0),l.dosPermissions&&16&l.dosPermissions&&(l.dir=!0),l.dir&&(t=y(t)),l.createFolders&&(n=d(t))&&m.call(this,n,!0);var h="string"===a&&!1===l.binary&&!1===l.base64;r&&void 0!==r.binary||(l.binary=!h),(e instanceof c&&0===e.uncompressedSize||l.dir||!e||0===e.length)&&(l.base64=!1,l.binary=!0,e="",l.compression="STORE",a="string");var v=null;v=e instanceof c||e instanceof o?e:p.isNode&&p.isStream(e)?new f(t,e):i.prepareContent(t,e,l.binary,l.optimizedBinaryString,l.base64);var g=new u(t,v,l);this.files[t]=g},d=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var e=t.lastIndexOf("/");return e>0?t.substring(0,e):""},y=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},m=function(t,e){return e=void 0!==e?e:s.createFolders,t=y(t),this.files[t]||h.call(this,t,null,{dir:!0,createFolders:e}),this.files[t]};function isRegExp(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var e,r,n;for(e in this.files)this.files.hasOwnProperty(e)&&(n=this.files[e],(r=e.slice(this.root.length,e.length))&&e.slice(0,this.root.length)===this.root&&t(r,n))},filter:function(t){var e=[];return this.forEach(function(r,n){t(r,n)&&e.push(n)}),e},file:function(t,e,r){if(1===arguments.length){if(isRegExp(t)){var n=t;return this.filter(function(t,e){return!e.dir&&n.test(t)})}var i=this.files[this.root+t];return i&&!i.dir?i:null}return t=this.root+t,h.call(this,t,e,r),this},folder:function(t){if(!t)return this;if(isRegExp(t))return this.filter(function(e,r){return r.dir&&t.test(e)});var e=this.root+t,r=m.call(this,e),n=this.clone();return n.root=r.name,n},remove:function(t){t=this.root+t;var e=this.files[t];if(e||("/"!==t.slice(-1)&&(t+="/"),e=this.files[t]),e&&!e.dir)delete this.files[t];else for(var r=this.filter(function(e,r){return r.name.slice(0,t.length)===t}),n=0;n<r.length;n++)delete this.files[r[n].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var e,r={};try{if((r=i.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:n.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");i.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var s=r.comment||this.comment||"";e=l.generateWorker(this,r,s)}catch(t){(e=new o("error")).error(t)}return new a(e,r.type||"string",r.mimeType)},generateAsync:function(t,e){return this.generateInternalStream(t).accumulate(e)},generateNodeStream:function(t,e){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(e)}};t.exports=v},function(t,e,r){t.exports=Stream;var n=r(22).EventEmitter;function Stream(){n.call(this)}r(10)(Stream,n),Stream.Readable=r(23),Stream.Writable=r(74),Stream.Duplex=r(75),Stream.Transform=r(76),Stream.PassThrough=r(77),Stream.Stream=Stream,Stream.prototype.pipe=function(t,e){var r=this;function ondata(e){t.writable&&!1===t.write(e)&&r.pause&&r.pause()}function ondrain(){r.readable&&r.resume&&r.resume()}r.on("data",ondata),t.on("drain",ondrain),t._isStdio||e&&!1===e.end||(r.on("end",onend),r.on("close",onclose));var i=!1;function onend(){i||(i=!0,t.end())}function onclose(){i||(i=!0,"function"==typeof t.destroy&&t.destroy())}function onerror(t){if(cleanup(),0===n.listenerCount(this,"error"))throw t}function cleanup(){r.removeListener("data",ondata),t.removeListener("drain",ondrain),r.removeListener("end",onend),r.removeListener("close",onclose),r.removeListener("error",onerror),t.removeListener("error",onerror),r.removeListener("end",cleanup),r.removeListener("close",cleanup),t.removeListener("close",cleanup)}return r.on("error",onerror),t.on("error",onerror),r.on("end",cleanup),r.on("close",cleanup),t.on("close",cleanup),t.emit("pipe",r),t}},function(t,e){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,e){},function(t,e,r){"use strict";var n=r(17).Buffer,i=r(71);t.exports=function(){function BufferList(){!function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,BufferList),this.head=null,this.tail=null,this.length=0}return BufferList.prototype.push=function push(t){var e={data:t,next:null};this.length>0?this.tail.next=e:this.head=e,this.tail=e,++this.length},BufferList.prototype.unshift=function unshift(t){var e={data:t,next:this.head};0===this.length&&(this.tail=e),this.head=e,++this.length},BufferList.prototype.shift=function shift(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},BufferList.prototype.clear=function clear(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function join(t){if(0===this.length)return"";for(var e=this.head,r=""+e.data;e=e.next;)r+=t+e.data;return r},BufferList.prototype.concat=function concat(t){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var e,r,i,o=n.allocUnsafe(t>>>0),a=this.head,s=0;a;)e=a.data,r=o,i=s,e.copy(r,i),s+=a.data.length,a=a.next;return o},BufferList}(),i&&i.inspect&&i.inspect.custom&&(t.exports.prototype[i.inspect.custom]=function(){var t=i.inspect({length:this.length});return this.constructor.name+" "+t})},function(t,e){},function(t,e,r){(function(e){function config(t){try{if(!e.localStorage)return!1}catch(t){return!1}var r=e.localStorage[t];return null!=r&&"true"===String(r).toLowerCase()}t.exports=function deprecate(t,e){if(config("noDeprecation"))return t;var r=!1;return function deprecated(){if(!r){if(config("throwDeprecation"))throw new Error(e);config("traceDeprecation")?console.trace(e):console.warn(e),r=!0}return t.apply(this,arguments)}}}).call(this,r(4))},function(t,e,r){"use strict";t.exports=PassThrough;var n=r(37),i=r(12);function PassThrough(t){if(!(this instanceof PassThrough))return new PassThrough(t);n.call(this,t)}i.inherits=r(10),i.inherits(PassThrough,n),PassThrough.prototype._transform=function(t,e,r){r(null,t)}},function(t,e,r){t.exports=r(24)},function(t,e,r){t.exports=r(7)},function(t,e,r){t.exports=r(23).Transform},function(t,e,r){t.exports=r(23).PassThrough},function(t,e,r){"use strict";(function(e){t.exports="function"==typeof e?e:function setImmediate(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}}).call(this,r(21).setImmediate)},function(t,e,r){"use strict";var n=r(80);function INTERNAL(){}var i={},o=["REJECTED"],a=["FULFILLED"],s=["PENDING"];function Promise(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=s,this.queue=[],this.outcome=void 0,t!==INTERNAL&&safelyResolveThenable(this,t)}function QueueItem(t,e,r){this.promise=t,"function"==typeof e&&(this.onFulfilled=e,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function unwrap(t,e,r){n(function(){var n;try{n=e(r)}catch(e){return i.reject(t,e)}n===t?i.reject(t,new TypeError("Cannot resolve promise with itself")):i.resolve(t,n)})}function getThen(t){var e=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof e)return function appyThen(){e.apply(t,arguments)}}function safelyResolveThenable(t,e){var r=!1;function onError(e){r||(r=!0,i.reject(t,e))}function onSuccess(e){r||(r=!0,i.resolve(t,e))}var n=tryCatch(function tryToUnwrap(){e(onSuccess,onError)});"error"===n.status&&onError(n.value)}function tryCatch(t,e){var r={};try{r.value=t(e),r.status="success"}catch(t){r.status="error",r.value=t}return r}t.exports=Promise,Promise.prototype.finally=function(t){if("function"!=typeof t)return this;var e=this.constructor;return this.then(function resolve(r){return e.resolve(t()).then(function yes(){return r})},function reject(r){return e.resolve(t()).then(function no(){throw r})})},Promise.prototype.catch=function(t){return this.then(null,t)},Promise.prototype.then=function(t,e){if("function"!=typeof t&&this.state===a||"function"!=typeof e&&this.state===o)return this;var r=new this.constructor(INTERNAL);this.state!==s?unwrap(r,this.state===a?t:e,this.outcome):this.queue.push(new QueueItem(r,t,e));return r},QueueItem.prototype.callFulfilled=function(t){i.resolve(this.promise,t)},QueueItem.prototype.otherCallFulfilled=function(t){unwrap(this.promise,this.onFulfilled,t)},QueueItem.prototype.callRejected=function(t){i.reject(this.promise,t)},QueueItem.prototype.otherCallRejected=function(t){unwrap(this.promise,this.onRejected,t)},i.resolve=function(t,e){var r=tryCatch(getThen,e);if("error"===r.status)return i.reject(t,r.value);var n=r.value;if(n)safelyResolveThenable(t,n);else{t.state=a,t.outcome=e;for(var o=-1,s=t.queue.length;++o<s;)t.queue[o].callFulfilled(e)}return t},i.reject=function(t,e){t.state=o,t.outcome=e;for(var r=-1,n=t.queue.length;++r<n;)t.queue[r].callRejected(e);return t},Promise.resolve=function resolve(t){if(t instanceof this)return t;return i.resolve(new this(INTERNAL),t)},Promise.reject=function reject(t){var e=new this(INTERNAL);return i.reject(e,t)},Promise.all=function all(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,n=!1;if(!r)return this.resolve([]);var o=new Array(r),a=0,s=-1,c=new this(INTERNAL);for(;++s<r;)allResolver(t[s],s);return c;function allResolver(t,s){e.resolve(t).then(function resolveFromAll(t){o[s]=t,++a!==r||n||(n=!0,i.resolve(c,o))},function(t){n||(n=!0,i.reject(c,t))})}},Promise.race=function race(t){var e=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,n=!1;if(!r)return this.resolve([]);var o=-1,a=new this(INTERNAL);for(;++o<r;)s=t[o],e.resolve(s).then(function(t){n||(n=!0,i.resolve(a,t))},function(t){n||(n=!0,i.reject(a,t))});var s;return a}},function(t,e,r){"use strict";(function(e){var r,n,i=e.MutationObserver||e.WebKitMutationObserver;if(i){var o=0,a=new i(nextTick),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),r=function(){s.data=o=++o%2}}else if(e.setImmediate||void 0===e.MessageChannel)r="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){nextTick(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(nextTick,0)};else{var c=new e.MessageChannel;c.port1.onmessage=nextTick,r=function(){c.port2.postMessage(0)}}var u=[];function nextTick(){var t,e;n=!0;for(var r=u.length;r;){for(e=u,u=[],t=-1;++t<r;)e[t]();r=u.length}n=!1}t.exports=function immediate(t){1!==u.push(t)||n||r()}}).call(this,r(4))},function(t,e,r){"use strict";var n=r(3),i=r(1);function ConvertWorker(t){n.call(this,"ConvertWorker to "+t),this.destType=t}i.inherits(ConvertWorker,n),ConvertWorker.prototype.processChunk=function(t){this.push({data:i.transformTo(this.destType,t.data),meta:t.meta})},t.exports=ConvertWorker},function(t,e,r){"use strict";var n=r(32).Readable;function NodejsStreamOutputAdapter(t,e,r){n.call(this,e),this._helper=t;var i=this;t.on("data",function(t,e){i.push(t)||i._helper.pause(),r&&r(e)}).on("error",function(t){i.emit("error",t)}).on("end",function(){i.push(null)})}r(1).inherits(NodejsStreamOutputAdapter,n),NodejsStreamOutputAdapter.prototype._read=function(){this._helper.resume()},t.exports=NodejsStreamOutputAdapter},function(t,e,r){"use strict";var n=r(39),i=r(41),o=r(9),a=r(25),s=r(3),c=function(t,e,r){this.name=t,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=e,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}};c.prototype={internalStream:function(t){var e=null,r="string";try{if(!t)throw new Error("No output type specified.");var i="string"===(r=t.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),e=this._decompressWorker();var a=!this._dataBinary;a&&!i&&(e=e.pipe(new o.Utf8EncodeWorker)),!a&&i&&(e=e.pipe(new o.Utf8DecodeWorker))}catch(t){(e=new s("error")).error(t)}return new n(e,r,"")},async:function(t,e){return this.internalStream(t).accumulate(e)},nodeStream:function(t,e){return this.internalStream(t||"nodebuffer").toNodejsStream(e)},_compressWorker:function(t,e){if(this._data instanceof a&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new o.Utf8EncodeWorker)),a.createWorkerFrom(r,t,e)},_decompressWorker:function(){return this._data instanceof a?this._data.getContentWorker():this._data instanceof s?this._data:new i(this._data)}};for(var u=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],l=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<u.length;p++)c.prototype[u[p]]=l;t.exports=c},function(t,e,r){"use strict";var n=r(44),i=r(95);e.generateWorker=function(t,e,r){var o=new i(e.streamFiles,r,e.platform,e.encodeFileName),a=0;try{t.forEach(function(t,r){a++;var i=function(t,e){var r=t||e,i=n[r];if(!i)throw new Error(r+" is not a valid compression method !");return i}(r.options.compression,e.compression),s=r.options.compressionOptions||e.compressionOptions||{},c=r.dir,u=r.date;r._compressWorker(i,s).withStreamInfo("file",{name:t,dir:c,date:u,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(o)}),o.entriesCount=a}catch(t){o.error(t)}return o}},function(t,e,r){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=r(86),o=r(1),a=r(3),s=n?"uint8array":"array";function FlateWorker(t,e){a.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=e,this.meta={}}e.magic="\b\0",o.inherits(FlateWorker,a),FlateWorker.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(o.transformTo(s,t.data),!1)},FlateWorker.prototype.flush=function(){a.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},FlateWorker.prototype.cleanUp=function(){a.prototype.cleanUp.call(this),this._pako=null},FlateWorker.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(e){t.push({data:e,meta:t.meta})}},e.compressWorker=function(t){return new FlateWorker("Deflate",t)},e.uncompressWorker=function(){return new FlateWorker("Inflate",{})}},function(t,e,r){"use strict";var n={};(0,r(6).assign)(n,r(87),r(90),r(49)),t.exports=n},function(t,e,r){"use strict";var n=r(88),i=r(6),o=r(47),a=r(27),s=r(48),c=Object.prototype.toString,u=0,l=-1,p=0,f=8;function Deflate(t){if(!(this instanceof Deflate))return new Deflate(t);this.options=i.assign({level:l,method:f,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},t||{});var e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var r=n.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(r!==u)throw new Error(a[r]);if(e.header&&n.deflateSetHeader(this.strm,e.header),e.dictionary){var h;if(h="string"==typeof e.dictionary?o.string2buf(e.dictionary):"[object ArrayBuffer]"===c.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,(r=n.deflateSetDictionary(this.strm,h))!==u)throw new Error(a[r]);this._dict_set=!0}}function deflate(t,e){var r=new Deflate(e);if(r.push(t,!0),r.err)throw r.msg||a[r.err];return r.result}Deflate.prototype.push=function(t,e){var r,a,s=this.strm,l=this.options.chunkSize;if(this.ended)return!1;a=e===~~e?e:!0===e?4:0,"string"==typeof t?s.input=o.string2buf(t):"[object ArrayBuffer]"===c.call(t)?s.input=new Uint8Array(t):s.input=t,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new i.Buf8(l),s.next_out=0,s.avail_out=l),1!==(r=n.deflate(s,a))&&r!==u)return this.onEnd(r),this.ended=!0,!1;0!==s.avail_out&&(0!==s.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(i.shrinkBuf(s.output,s.next_out))):this.onData(i.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&1!==r);return 4===a?(r=n.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===u):2!==a||(this.onEnd(u),s.avail_out=0,!0)},Deflate.prototype.onData=function(t){this.chunks.push(t)},Deflate.prototype.onEnd=function(t){t===u&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Deflate=Deflate,e.deflate=deflate,e.deflateRaw=function deflateRaw(t,e){return(e=e||{}).raw=!0,deflate(t,e)},e.gzip=function gzip(t,e){return(e=e||{}).gzip=!0,deflate(t,e)}},function(t,e,r){"use strict";var n,i=r(6),o=r(89),a=r(45),s=r(46),c=r(27),u=0,l=1,p=3,f=4,h=5,d=0,y=1,m=-2,v=-3,g=-5,_=-1,b=1,w=2,P=3,x=4,O=0,C=2,S=8,R=9,j=15,T=8,E=286,B=30,A=19,I=2*E+1,M=15,k=3,z=258,F=z+k+1,D=32,N=42,L=69,V=73,U=91,W=103,q=113,G=666,H=1,X=2,K=3,Q=4,Y=3;function err(t,e){return t.msg=c[e],e}function rank(t){return(t<<1)-(t>4?9:0)}function zero(t){for(var e=t.length;--e>=0;)t[e]=0}function flush_pending(t){var e=t.state,r=e.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(i.arraySet(t.output,e.pending_buf,e.pending_out,r,t.next_out),t.next_out+=r,e.pending_out+=r,t.total_out+=r,t.avail_out-=r,e.pending-=r,0===e.pending&&(e.pending_out=0))}function flush_block_only(t,e){o._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,flush_pending(t.strm)}function put_byte(t,e){t.pending_buf[t.pending++]=e}function putShortMSB(t,e){t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e}function longest_match(t,e){var r,n,i=t.max_chain_length,o=t.strstart,a=t.prev_length,s=t.nice_match,c=t.strstart>t.w_size-F?t.strstart-(t.w_size-F):0,u=t.window,l=t.w_mask,p=t.prev,f=t.strstart+z,h=u[o+a-1],d=u[o+a];t.prev_length>=t.good_match&&(i>>=2),s>t.lookahead&&(s=t.lookahead);do{if(u[(r=e)+a]===d&&u[r+a-1]===h&&u[r]===u[o]&&u[++r]===u[o+1]){o+=2,r++;do{}while(u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&u[++o]===u[++r]&&o<f);if(n=z-(f-o),o=f-z,n>a){if(t.match_start=e,a=n,n>=s)break;h=u[o+a-1],d=u[o+a]}}}while((e=p[e&l])>c&&0!=--i);return a<=t.lookahead?a:t.lookahead}function fill_window(t){var e,r,n,o,c,u,l,p,f,h,d=t.w_size;do{if(o=t.window_size-t.lookahead-t.strstart,t.strstart>=d+(d-F)){i.arraySet(t.window,t.window,d,d,0),t.match_start-=d,t.strstart-=d,t.block_start-=d,e=r=t.hash_size;do{n=t.head[--e],t.head[e]=n>=d?n-d:0}while(--r);e=r=d;do{n=t.prev[--e],t.prev[e]=n>=d?n-d:0}while(--r);o+=d}if(0===t.strm.avail_in)break;if(u=t.strm,l=t.window,p=t.strstart+t.lookahead,f=o,h=void 0,(h=u.avail_in)>f&&(h=f),r=0===h?0:(u.avail_in-=h,i.arraySet(l,u.input,u.next_in,h,p),1===u.state.wrap?u.adler=a(u.adler,l,h,p):2===u.state.wrap&&(u.adler=s(u.adler,l,h,p)),u.next_in+=h,u.total_in+=h,h),t.lookahead+=r,t.lookahead+t.insert>=k)for(c=t.strstart-t.insert,t.ins_h=t.window[c],t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[c+k-1])&t.hash_mask,t.prev[c&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=c,c++,t.insert--,!(t.lookahead+t.insert<k)););}while(t.lookahead<F&&0!==t.strm.avail_in)}function deflate_fast(t,e){for(var r,n;;){if(t.lookahead<F){if(fill_window(t),t.lookahead<F&&e===u)return H;if(0===t.lookahead)break}if(r=0,t.lookahead>=k&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+k-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-F&&(t.match_length=longest_match(t,r)),t.match_length>=k)if(n=o._tr_tally(t,t.strstart-t.match_start,t.match_length-k),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=k){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+k-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else n=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(n&&(flush_block_only(t,!1),0===t.strm.avail_out))return H}return t.insert=t.strstart<k-1?t.strstart:k-1,e===f?(flush_block_only(t,!0),0===t.strm.avail_out?K:Q):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?H:X}function deflate_slow(t,e){for(var r,n,i;;){if(t.lookahead<F){if(fill_window(t),t.lookahead<F&&e===u)return H;if(0===t.lookahead)break}if(r=0,t.lookahead>=k&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+k-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=k-1,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-F&&(t.match_length=longest_match(t,r),t.match_length<=5&&(t.strategy===b||t.match_length===k&&t.strstart-t.match_start>4096)&&(t.match_length=k-1)),t.prev_length>=k&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-k,n=o._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-k),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+k-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=k-1,t.strstart++,n&&(flush_block_only(t,!1),0===t.strm.avail_out))return H}else if(t.match_available){if((n=o._tr_tally(t,0,t.window[t.strstart-1]))&&flush_block_only(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return H}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(n=o._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<k-1?t.strstart:k-1,e===f?(flush_block_only(t,!0),0===t.strm.avail_out?K:Q):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?H:X}function Config(t,e,r,n,i){this.good_length=t,this.max_lazy=e,this.nice_length=r,this.max_chain=n,this.func=i}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=S,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*I),this.dyn_dtree=new i.Buf16(2*(2*B+1)),this.bl_tree=new i.Buf16(2*(2*A+1)),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(M+1),this.heap=new i.Buf16(2*E+1),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*E+1),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(t){var e;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=C,(e=t.state).pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=e.wrap?N:q,t.adler=2===e.wrap?0:1,e.last_flush=u,o._tr_init(e),d):err(t,m)}function deflateReset(t){var e=deflateResetKeep(t);return e===d&&function lm_init(t){t.window_size=2*t.w_size,zero(t.head),t.max_lazy_match=n[t.level].max_lazy,t.good_match=n[t.level].good_length,t.nice_match=n[t.level].nice_length,t.max_chain_length=n[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=k-1,t.match_available=0,t.ins_h=0}(t.state),e}function deflateInit2(t,e,r,n,o,a){if(!t)return m;var s=1;if(e===_&&(e=6),n<0?(s=0,n=-n):n>15&&(s=2,n-=16),o<1||o>R||r!==S||n<8||n>15||e<0||e>9||a<0||a>x)return err(t,m);8===n&&(n=9);var c=new DeflateState;return t.state=c,c.strm=t,c.wrap=s,c.gzhead=null,c.w_bits=n,c.w_size=1<<c.w_bits,c.w_mask=c.w_size-1,c.hash_bits=o+7,c.hash_size=1<<c.hash_bits,c.hash_mask=c.hash_size-1,c.hash_shift=~~((c.hash_bits+k-1)/k),c.window=new i.Buf8(2*c.w_size),c.head=new i.Buf16(c.hash_size),c.prev=new i.Buf16(c.w_size),c.lit_bufsize=1<<o+6,c.pending_buf_size=4*c.lit_bufsize,c.pending_buf=new i.Buf8(c.pending_buf_size),c.d_buf=1*c.lit_bufsize,c.l_buf=3*c.lit_bufsize,c.level=e,c.strategy=a,c.method=r,deflateReset(t)}n=[new Config(0,0,0,0,function deflate_stored(t,e){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(fill_window(t),0===t.lookahead&&e===u)return H;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var n=t.block_start+r;if((0===t.strstart||t.strstart>=n)&&(t.lookahead=t.strstart-n,t.strstart=n,flush_block_only(t,!1),0===t.strm.avail_out))return H;if(t.strstart-t.block_start>=t.w_size-F&&(flush_block_only(t,!1),0===t.strm.avail_out))return H}return t.insert=0,e===f?(flush_block_only(t,!0),0===t.strm.avail_out?K:Q):(t.strstart>t.block_start&&(flush_block_only(t,!1),t.strm.avail_out),H)}),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],e.deflateInit=function deflateInit(t,e){return deflateInit2(t,e,S,j,T,O)},e.deflateInit2=deflateInit2,e.deflateReset=deflateReset,e.deflateResetKeep=deflateResetKeep,e.deflateSetHeader=function deflateSetHeader(t,e){return t&&t.state?2!==t.state.wrap?m:(t.state.gzhead=e,d):m},e.deflate=function deflate(t,e){var r,i,a,c;if(!t||!t.state||e>h||e<0)return t?err(t,m):m;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||i.status===G&&e!==f)return err(t,0===t.avail_out?g:m);if(i.strm=t,r=i.last_flush,i.last_flush=e,i.status===N)if(2===i.wrap)t.adler=0,put_byte(i,31),put_byte(i,139),put_byte(i,8),i.gzhead?(put_byte(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),put_byte(i,255&i.gzhead.time),put_byte(i,i.gzhead.time>>8&255),put_byte(i,i.gzhead.time>>16&255),put_byte(i,i.gzhead.time>>24&255),put_byte(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),put_byte(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(put_byte(i,255&i.gzhead.extra.length),put_byte(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=s(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=L):(put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,9===i.level?2:i.strategy>=w||i.level<2?4:0),put_byte(i,Y),i.status=q);else{var v=S+(i.w_bits-8<<4)<<8;v|=(i.strategy>=w||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(v|=D),v+=31-v%31,i.status=q,putShortMSB(i,v),0!==i.strstart&&(putShortMSB(i,t.adler>>>16),putShortMSB(i,65535&t.adler)),t.adler=1}if(i.status===L)if(i.gzhead.extra){for(a=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),flush_pending(t),a=i.pending,i.pending!==i.pending_buf_size));)put_byte(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=V)}else i.status=V;if(i.status===V)if(i.gzhead.name){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),flush_pending(t),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,put_byte(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.gzindex=0,i.status=U)}else i.status=U;if(i.status===U)if(i.gzhead.comment){a=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),flush_pending(t),a=i.pending,i.pending===i.pending_buf_size)){c=1;break}c=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,put_byte(i,c)}while(0!==c);i.gzhead.hcrc&&i.pending>a&&(t.adler=s(t.adler,i.pending_buf,i.pending-a,a)),0===c&&(i.status=W)}else i.status=W;if(i.status===W&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&flush_pending(t),i.pending+2<=i.pending_buf_size&&(put_byte(i,255&t.adler),put_byte(i,t.adler>>8&255),t.adler=0,i.status=q)):i.status=q),0!==i.pending){if(flush_pending(t),0===t.avail_out)return i.last_flush=-1,d}else if(0===t.avail_in&&rank(e)<=rank(r)&&e!==f)return err(t,g);if(i.status===G&&0!==t.avail_in)return err(t,g);if(0!==t.avail_in||0!==i.lookahead||e!==u&&i.status!==G){var _=i.strategy===w?function deflate_huff(t,e){for(var r;;){if(0===t.lookahead&&(fill_window(t),0===t.lookahead)){if(e===u)return H;break}if(t.match_length=0,r=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(flush_block_only(t,!1),0===t.strm.avail_out))return H}return t.insert=0,e===f?(flush_block_only(t,!0),0===t.strm.avail_out?K:Q):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?H:X}(i,e):i.strategy===P?function deflate_rle(t,e){for(var r,n,i,a,s=t.window;;){if(t.lookahead<=z){if(fill_window(t),t.lookahead<=z&&e===u)return H;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=k&&t.strstart>0&&(n=s[i=t.strstart-1])===s[++i]&&n===s[++i]&&n===s[++i]){a=t.strstart+z;do{}while(n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&n===s[++i]&&i<a);t.match_length=z-(a-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=k?(r=o._tr_tally(t,1,t.match_length-k),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=o._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(flush_block_only(t,!1),0===t.strm.avail_out))return H}return t.insert=0,e===f?(flush_block_only(t,!0),0===t.strm.avail_out?K:Q):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?H:X}(i,e):n[i.level].func(i,e);if(_!==K&&_!==Q||(i.status=G),_===H||_===K)return 0===t.avail_out&&(i.last_flush=-1),d;if(_===X&&(e===l?o._tr_align(i):e!==h&&(o._tr_stored_block(i,0,0,!1),e===p&&(zero(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),flush_pending(t),0===t.avail_out))return i.last_flush=-1,d}return e!==f?d:i.wrap<=0?y:(2===i.wrap?(put_byte(i,255&t.adler),put_byte(i,t.adler>>8&255),put_byte(i,t.adler>>16&255),put_byte(i,t.adler>>24&255),put_byte(i,255&t.total_in),put_byte(i,t.total_in>>8&255),put_byte(i,t.total_in>>16&255),put_byte(i,t.total_in>>24&255)):(putShortMSB(i,t.adler>>>16),putShortMSB(i,65535&t.adler)),flush_pending(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?d:y)},e.deflateEnd=function deflateEnd(t){var e;return t&&t.state?(e=t.state.status)!==N&&e!==L&&e!==V&&e!==U&&e!==W&&e!==q&&e!==G?err(t,m):(t.state=null,e===q?err(t,v):d):m},e.deflateSetDictionary=function deflateSetDictionary(t,e){var r,n,o,s,c,u,l,p,f=e.length;if(!t||!t.state)return m;if(2===(s=(r=t.state).wrap)||1===s&&r.status!==N||r.lookahead)return m;for(1===s&&(t.adler=a(t.adler,e,f,0)),r.wrap=0,f>=r.w_size&&(0===s&&(zero(r.head),r.strstart=0,r.block_start=0,r.insert=0),p=new i.Buf8(r.w_size),i.arraySet(p,e,f-r.w_size,r.w_size,0),e=p,f=r.w_size),c=t.avail_in,u=t.next_in,l=t.input,t.avail_in=f,t.next_in=0,t.input=e,fill_window(r);r.lookahead>=k;){n=r.strstart,o=r.lookahead-(k-1);do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[n+k-1])&r.hash_mask,r.prev[n&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=n,n++}while(--o);r.strstart=n,r.lookahead=k-1,fill_window(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=k-1,r.match_available=0,t.next_in=u,t.input=l,t.avail_in=c,r.wrap=s,d},e.deflateInfo="pako deflate (from Nodeca project)"},function(t,e,r){"use strict";var n=r(6),i=4,o=0,a=1,s=2;function zero(t){for(var e=t.length;--e>=0;)t[e]=0}var c=0,u=1,l=2,p=29,f=256,h=f+1+p,d=30,y=19,m=2*h+1,v=15,g=16,_=7,b=256,w=16,P=17,x=18,O=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],C=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],j=new Array(2*(h+2));zero(j);var T=new Array(2*d);zero(T);var E=new Array(512);zero(E);var B=new Array(256);zero(B);var A=new Array(p);zero(A);var I,M,k,z=new Array(d);function StaticTreeDesc(t,e,r,n,i){this.static_tree=t,this.extra_bits=e,this.extra_base=r,this.elems=n,this.max_length=i,this.has_stree=t&&t.length}function TreeDesc(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}function d_code(t){return t<256?E[t]:E[256+(t>>>7)]}function put_short(t,e){t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255}function send_bits(t,e,r){t.bi_valid>g-r?(t.bi_buf|=e<<t.bi_valid&65535,put_short(t,t.bi_buf),t.bi_buf=e>>g-t.bi_valid,t.bi_valid+=r-g):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=r)}function send_code(t,e,r){send_bits(t,r[2*e],r[2*e+1])}function bi_reverse(t,e){var r=0;do{r|=1&t,t>>>=1,r<<=1}while(--e>0);return r>>>1}function gen_codes(t,e,r){var n,i,o=new Array(v+1),a=0;for(n=1;n<=v;n++)o[n]=a=a+r[n-1]<<1;for(i=0;i<=e;i++){var s=t[2*i+1];0!==s&&(t[2*i]=bi_reverse(o[s]++,s))}}function init_block(t){var e;for(e=0;e<h;e++)t.dyn_ltree[2*e]=0;for(e=0;e<d;e++)t.dyn_dtree[2*e]=0;for(e=0;e<y;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*b]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function bi_windup(t){t.bi_valid>8?put_short(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function smaller(t,e,r,n){var i=2*e,o=2*r;return t[i]<t[o]||t[i]===t[o]&&n[e]<=n[r]}function pqdownheap(t,e,r){for(var n=t.heap[r],i=r<<1;i<=t.heap_len&&(i<t.heap_len&&smaller(e,t.heap[i+1],t.heap[i],t.depth)&&i++,!smaller(e,n,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=n}function compress_block(t,e,r){var n,i,o,a,s=0;if(0!==t.last_lit)do{n=t.pending_buf[t.d_buf+2*s]<<8|t.pending_buf[t.d_buf+2*s+1],i=t.pending_buf[t.l_buf+s],s++,0===n?send_code(t,i,e):(send_code(t,(o=B[i])+f+1,e),0!==(a=O[o])&&send_bits(t,i-=A[o],a),send_code(t,o=d_code(--n),r),0!==(a=C[o])&&send_bits(t,n-=z[o],a))}while(s<t.last_lit);send_code(t,b,e)}function build_tree(t,e){var r,n,i,o=e.dyn_tree,a=e.stat_desc.static_tree,s=e.stat_desc.has_stree,c=e.stat_desc.elems,u=-1;for(t.heap_len=0,t.heap_max=m,r=0;r<c;r++)0!==o[2*r]?(t.heap[++t.heap_len]=u=r,t.depth[r]=0):o[2*r+1]=0;for(;t.heap_len<2;)o[2*(i=t.heap[++t.heap_len]=u<2?++u:0)]=1,t.depth[i]=0,t.opt_len--,s&&(t.static_len-=a[2*i+1]);for(e.max_code=u,r=t.heap_len>>1;r>=1;r--)pqdownheap(t,o,r);i=c;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],pqdownheap(t,o,1),n=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=n,o[2*i]=o[2*r]+o[2*n],t.depth[i]=(t.depth[r]>=t.depth[n]?t.depth[r]:t.depth[n])+1,o[2*r+1]=o[2*n+1]=i,t.heap[1]=i++,pqdownheap(t,o,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function gen_bitlen(t,e){var r,n,i,o,a,s,c=e.dyn_tree,u=e.max_code,l=e.stat_desc.static_tree,p=e.stat_desc.has_stree,f=e.stat_desc.extra_bits,h=e.stat_desc.extra_base,d=e.stat_desc.max_length,y=0;for(o=0;o<=v;o++)t.bl_count[o]=0;for(c[2*t.heap[t.heap_max]+1]=0,r=t.heap_max+1;r<m;r++)(o=c[2*c[2*(n=t.heap[r])+1]+1]+1)>d&&(o=d,y++),c[2*n+1]=o,n>u||(t.bl_count[o]++,a=0,n>=h&&(a=f[n-h]),s=c[2*n],t.opt_len+=s*(o+a),p&&(t.static_len+=s*(l[2*n+1]+a)));if(0!==y){do{for(o=d-1;0===t.bl_count[o];)o--;t.bl_count[o]--,t.bl_count[o+1]+=2,t.bl_count[d]--,y-=2}while(y>0);for(o=d;0!==o;o--)for(n=t.bl_count[o];0!==n;)(i=t.heap[--r])>u||(c[2*i+1]!==o&&(t.opt_len+=(o-c[2*i+1])*c[2*i],c[2*i+1]=o),n--)}}(t,e),gen_codes(o,u,t.bl_count)}function scan_tree(t,e,r){var n,i,o=-1,a=e[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),e[2*(r+1)+1]=65535,n=0;n<=r;n++)i=a,a=e[2*(n+1)+1],++s<c&&i===a||(s<u?t.bl_tree[2*i]+=s:0!==i?(i!==o&&t.bl_tree[2*i]++,t.bl_tree[2*w]++):s<=10?t.bl_tree[2*P]++:t.bl_tree[2*x]++,s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4))}function send_tree(t,e,r){var n,i,o=-1,a=e[1],s=0,c=7,u=4;for(0===a&&(c=138,u=3),n=0;n<=r;n++)if(i=a,a=e[2*(n+1)+1],!(++s<c&&i===a)){if(s<u)do{send_code(t,i,t.bl_tree)}while(0!=--s);else 0!==i?(i!==o&&(send_code(t,i,t.bl_tree),s--),send_code(t,w,t.bl_tree),send_bits(t,s-3,2)):s<=10?(send_code(t,P,t.bl_tree),send_bits(t,s-3,3)):(send_code(t,x,t.bl_tree),send_bits(t,s-11,7));s=0,o=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4)}}zero(z);var F=!1;function _tr_stored_block(t,e,r,i){send_bits(t,(c<<1)+(i?1:0),3),function copy_block(t,e,r,i){bi_windup(t),i&&(put_short(t,r),put_short(t,~r)),n.arraySet(t.pending_buf,t.window,e,r,t.pending),t.pending+=r}(t,e,r,!0)}e._tr_init=function _tr_init(t){F||(function tr_static_init(){var t,e,r,n,i,o=new Array(v+1);for(r=0,n=0;n<p-1;n++)for(A[n]=r,t=0;t<1<<O[n];t++)B[r++]=n;for(B[r-1]=n,i=0,n=0;n<16;n++)for(z[n]=i,t=0;t<1<<C[n];t++)E[i++]=n;for(i>>=7;n<d;n++)for(z[n]=i<<7,t=0;t<1<<C[n]-7;t++)E[256+i++]=n;for(e=0;e<=v;e++)o[e]=0;for(t=0;t<=143;)j[2*t+1]=8,t++,o[8]++;for(;t<=255;)j[2*t+1]=9,t++,o[9]++;for(;t<=279;)j[2*t+1]=7,t++,o[7]++;for(;t<=287;)j[2*t+1]=8,t++,o[8]++;for(gen_codes(j,h+1,o),t=0;t<d;t++)T[2*t+1]=5,T[2*t]=bi_reverse(t,5);I=new StaticTreeDesc(j,O,f+1,h,v),M=new StaticTreeDesc(T,C,0,d,v),k=new StaticTreeDesc(new Array(0),S,0,y,_)}(),F=!0),t.l_desc=new TreeDesc(t.dyn_ltree,I),t.d_desc=new TreeDesc(t.dyn_dtree,M),t.bl_desc=new TreeDesc(t.bl_tree,k),t.bi_buf=0,t.bi_valid=0,init_block(t)},e._tr_stored_block=_tr_stored_block,e._tr_flush_block=function _tr_flush_block(t,e,r,n){var c,p,h=0;t.level>0?(t.strm.data_type===s&&(t.strm.data_type=function detect_data_type(t){var e,r=4093624447;for(e=0;e<=31;e++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*e])return o;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return a;for(e=32;e<f;e++)if(0!==t.dyn_ltree[2*e])return a;return o}(t)),build_tree(t,t.l_desc),build_tree(t,t.d_desc),h=function build_bl_tree(t){var e;for(scan_tree(t,t.dyn_ltree,t.l_desc.max_code),scan_tree(t,t.dyn_dtree,t.d_desc.max_code),build_tree(t,t.bl_desc),e=y-1;e>=3&&0===t.bl_tree[2*R[e]+1];e--);return t.opt_len+=3*(e+1)+5+5+4,e}(t),c=t.opt_len+3+7>>>3,(p=t.static_len+3+7>>>3)<=c&&(c=p)):c=p=r+5,r+4<=c&&-1!==e?_tr_stored_block(t,e,r,n):t.strategy===i||p===c?(send_bits(t,(u<<1)+(n?1:0),3),compress_block(t,j,T)):(send_bits(t,(l<<1)+(n?1:0),3),function send_all_trees(t,e,r,n){var i;for(send_bits(t,e-257,5),send_bits(t,r-1,5),send_bits(t,n-4,4),i=0;i<n;i++)send_bits(t,t.bl_tree[2*R[i]+1],3);send_tree(t,t.dyn_ltree,e-1),send_tree(t,t.dyn_dtree,r-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,h+1),compress_block(t,t.dyn_ltree,t.dyn_dtree)),init_block(t),n&&bi_windup(t)},e._tr_tally=function _tr_tally(t,e,r){return t.pending_buf[t.d_buf+2*t.last_lit]=e>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&e,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===e?t.dyn_ltree[2*r]++:(t.matches++,e--,t.dyn_ltree[2*(B[r]+f+1)]++,t.dyn_dtree[2*d_code(e)]++),t.last_lit===t.lit_bufsize-1},e._tr_align=function _tr_align(t){send_bits(t,u<<1,3),send_code(t,b,j),function bi_flush(t){16===t.bi_valid?(put_short(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},function(t,e,r){"use strict";var n=r(91),i=r(6),o=r(47),a=r(49),s=r(27),c=r(48),u=r(94),l=Object.prototype.toString;function Inflate(t){if(!(this instanceof Inflate))return new Inflate(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0==(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var r=n.inflateInit2(this.strm,e.windowBits);if(r!==a.Z_OK)throw new Error(s[r]);if(this.header=new u,n.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"==typeof e.dictionary?e.dictionary=o.string2buf(e.dictionary):"[object ArrayBuffer]"===l.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(r=n.inflateSetDictionary(this.strm,e.dictionary))!==a.Z_OK))throw new Error(s[r])}function inflate(t,e){var r=new Inflate(e);if(r.push(t,!0),r.err)throw r.msg||s[r.err];return r.result}Inflate.prototype.push=function(t,e){var r,s,c,u,p,f=this.strm,h=this.options.chunkSize,d=this.options.dictionary,y=!1;if(this.ended)return!1;s=e===~~e?e:!0===e?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof t?f.input=o.binstring2buf(t):"[object ArrayBuffer]"===l.call(t)?f.input=new Uint8Array(t):f.input=t,f.next_in=0,f.avail_in=f.input.length;do{if(0===f.avail_out&&(f.output=new i.Buf8(h),f.next_out=0,f.avail_out=h),(r=n.inflate(f,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&d&&(r=n.inflateSetDictionary(this.strm,d)),r===a.Z_BUF_ERROR&&!0===y&&(r=a.Z_OK,y=!1),r!==a.Z_STREAM_END&&r!==a.Z_OK)return this.onEnd(r),this.ended=!0,!1;f.next_out&&(0!==f.avail_out&&r!==a.Z_STREAM_END&&(0!==f.avail_in||s!==a.Z_FINISH&&s!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(c=o.utf8border(f.output,f.next_out),u=f.next_out-c,p=o.buf2string(f.output,c),f.next_out=u,f.avail_out=h-u,u&&i.arraySet(f.output,f.output,c,u,0),this.onData(p)):this.onData(i.shrinkBuf(f.output,f.next_out)))),0===f.avail_in&&0===f.avail_out&&(y=!0)}while((f.avail_in>0||0===f.avail_out)&&r!==a.Z_STREAM_END);return r===a.Z_STREAM_END&&(s=a.Z_FINISH),s===a.Z_FINISH?(r=n.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===a.Z_OK):s!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),f.avail_out=0,!0)},Inflate.prototype.onData=function(t){this.chunks.push(t)},Inflate.prototype.onEnd=function(t){t===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},e.Inflate=Inflate,e.inflate=inflate,e.inflateRaw=function inflateRaw(t,e){return(e=e||{}).raw=!0,inflate(t,e)},e.ungzip=inflate},function(t,e,r){"use strict";var n=r(6),i=r(45),o=r(46),a=r(92),s=r(93),c=0,u=1,l=2,p=4,f=5,h=6,d=0,y=1,m=2,v=-2,g=-3,_=-4,b=-5,w=8,P=1,x=2,O=3,C=4,S=5,R=6,j=7,T=8,E=9,B=10,A=11,I=12,M=13,k=14,z=15,F=16,D=17,N=18,L=19,V=20,U=21,W=22,q=23,G=24,H=25,X=26,K=27,Q=28,Y=29,Z=30,J=31,$=32,tt=852,et=592,rt=15;function zswap32(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(t){var e;return t&&t.state?(e=t.state,t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=P,e.last=0,e.havedict=0,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new n.Buf32(tt),e.distcode=e.distdyn=new n.Buf32(et),e.sane=1,e.back=-1,d):v}function inflateReset(t){var e;return t&&t.state?((e=t.state).wsize=0,e.whave=0,e.wnext=0,inflateResetKeep(t)):v}function inflateReset2(t,e){var r,n;return t&&t.state?(n=t.state,e<0?(r=0,e=-e):(r=1+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?v:(null!==n.window&&n.wbits!==e&&(n.window=null),n.wrap=r,n.wbits=e,inflateReset(t))):v}function inflateInit2(t,e){var r,n;return t?(n=new InflateState,t.state=n,n.window=null,(r=inflateReset2(t,e))!==d&&(t.state=null),r):v}var nt,it,ot=!0;function fixedtables(t){if(ot){var e;for(nt=new n.Buf32(512),it=new n.Buf32(32),e=0;e<144;)t.lens[e++]=8;for(;e<256;)t.lens[e++]=9;for(;e<280;)t.lens[e++]=7;for(;e<288;)t.lens[e++]=8;for(s(u,t.lens,0,288,nt,0,t.work,{bits:9}),e=0;e<32;)t.lens[e++]=5;s(l,t.lens,0,32,it,0,t.work,{bits:5}),ot=!1}t.lencode=nt,t.lenbits=9,t.distcode=it,t.distbits=5}function updatewindow(t,e,r,i){var o,a=t.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),i>=a.wsize?(n.arraySet(a.window,e,r-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>i&&(o=i),n.arraySet(a.window,e,r-i,o,a.wnext),(i-=o)?(n.arraySet(a.window,e,r-i,i,0),a.wnext=i,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}e.inflateReset=inflateReset,e.inflateReset2=inflateReset2,e.inflateResetKeep=inflateResetKeep,e.inflateInit=function inflateInit(t){return inflateInit2(t,rt)},e.inflateInit2=inflateInit2,e.inflate=function inflate(t,e){var r,tt,et,rt,nt,it,ot,at,st,ct,ut,lt,pt,ft,ht,dt,yt,mt,vt,gt,_t,bt,wt,Pt,xt=0,Ot=new n.Buf8(4),Ct=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return v;(r=t.state).mode===I&&(r.mode=M),nt=t.next_out,et=t.output,ot=t.avail_out,rt=t.next_in,tt=t.input,it=t.avail_in,at=r.hold,st=r.bits,ct=it,ut=ot,bt=d;t:for(;;)switch(r.mode){case P:if(0===r.wrap){r.mode=M;break}for(;st<16;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}if(2&r.wrap&&35615===at){r.check=0,Ot[0]=255&at,Ot[1]=at>>>8&255,r.check=o(r.check,Ot,2,0),at=0,st=0,r.mode=x;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&at)<<8)+(at>>8))%31){t.msg="incorrect header check",r.mode=Z;break}if((15&at)!==w){t.msg="unknown compression method",r.mode=Z;break}if(st-=4,_t=8+(15&(at>>>=4)),0===r.wbits)r.wbits=_t;else if(_t>r.wbits){t.msg="invalid window size",r.mode=Z;break}r.dmax=1<<_t,t.adler=r.check=1,r.mode=512&at?B:I,at=0,st=0;break;case x:for(;st<16;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}if(r.flags=at,(255&r.flags)!==w){t.msg="unknown compression method",r.mode=Z;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=Z;break}r.head&&(r.head.text=at>>8&1),512&r.flags&&(Ot[0]=255&at,Ot[1]=at>>>8&255,r.check=o(r.check,Ot,2,0)),at=0,st=0,r.mode=O;case O:for(;st<32;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}r.head&&(r.head.time=at),512&r.flags&&(Ot[0]=255&at,Ot[1]=at>>>8&255,Ot[2]=at>>>16&255,Ot[3]=at>>>24&255,r.check=o(r.check,Ot,4,0)),at=0,st=0,r.mode=C;case C:for(;st<16;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}r.head&&(r.head.xflags=255&at,r.head.os=at>>8),512&r.flags&&(Ot[0]=255&at,Ot[1]=at>>>8&255,r.check=o(r.check,Ot,2,0)),at=0,st=0,r.mode=S;case S:if(1024&r.flags){for(;st<16;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}r.length=at,r.head&&(r.head.extra_len=at),512&r.flags&&(Ot[0]=255&at,Ot[1]=at>>>8&255,r.check=o(r.check,Ot,2,0)),at=0,st=0}else r.head&&(r.head.extra=null);r.mode=R;case R:if(1024&r.flags&&((lt=r.length)>it&&(lt=it),lt&&(r.head&&(_t=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),n.arraySet(r.head.extra,tt,rt,lt,_t)),512&r.flags&&(r.check=o(r.check,tt,lt,rt)),it-=lt,rt+=lt,r.length-=lt),r.length))break t;r.length=0,r.mode=j;case j:if(2048&r.flags){if(0===it)break t;lt=0;do{_t=tt[rt+lt++],r.head&&_t&&r.length<65536&&(r.head.name+=String.fromCharCode(_t))}while(_t&&lt<it);if(512&r.flags&&(r.check=o(r.check,tt,lt,rt)),it-=lt,rt+=lt,_t)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=T;case T:if(4096&r.flags){if(0===it)break t;lt=0;do{_t=tt[rt+lt++],r.head&&_t&&r.length<65536&&(r.head.comment+=String.fromCharCode(_t))}while(_t&&lt<it);if(512&r.flags&&(r.check=o(r.check,tt,lt,rt)),it-=lt,rt+=lt,_t)break t}else r.head&&(r.head.comment=null);r.mode=E;case E:if(512&r.flags){for(;st<16;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}if(at!==(65535&r.check)){t.msg="header crc mismatch",r.mode=Z;break}at=0,st=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=I;break;case B:for(;st<32;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}t.adler=r.check=zswap32(at),at=0,st=0,r.mode=A;case A:if(0===r.havedict)return t.next_out=nt,t.avail_out=ot,t.next_in=rt,t.avail_in=it,r.hold=at,r.bits=st,m;t.adler=r.check=1,r.mode=I;case I:if(e===f||e===h)break t;case M:if(r.last){at>>>=7&st,st-=7&st,r.mode=K;break}for(;st<3;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}switch(r.last=1&at,st-=1,3&(at>>>=1)){case 0:r.mode=k;break;case 1:if(fixedtables(r),r.mode=V,e===h){at>>>=2,st-=2;break t}break;case 2:r.mode=D;break;case 3:t.msg="invalid block type",r.mode=Z}at>>>=2,st-=2;break;case k:for(at>>>=7&st,st-=7&st;st<32;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}if((65535&at)!=(at>>>16^65535)){t.msg="invalid stored block lengths",r.mode=Z;break}if(r.length=65535&at,at=0,st=0,r.mode=z,e===h)break t;case z:r.mode=F;case F:if(lt=r.length){if(lt>it&&(lt=it),lt>ot&&(lt=ot),0===lt)break t;n.arraySet(et,tt,rt,lt,nt),it-=lt,rt+=lt,ot-=lt,nt+=lt,r.length-=lt;break}r.mode=I;break;case D:for(;st<14;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}if(r.nlen=257+(31&at),at>>>=5,st-=5,r.ndist=1+(31&at),at>>>=5,st-=5,r.ncode=4+(15&at),at>>>=4,st-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=Z;break}r.have=0,r.mode=N;case N:for(;r.have<r.ncode;){for(;st<3;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}r.lens[Ct[r.have++]]=7&at,at>>>=3,st-=3}for(;r.have<19;)r.lens[Ct[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,wt={bits:r.lenbits},bt=s(c,r.lens,0,19,r.lencode,0,r.work,wt),r.lenbits=wt.bits,bt){t.msg="invalid code lengths set",r.mode=Z;break}r.have=0,r.mode=L;case L:for(;r.have<r.nlen+r.ndist;){for(;dt=(xt=r.lencode[at&(1<<r.lenbits)-1])>>>16&255,yt=65535&xt,!((ht=xt>>>24)<=st);){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}if(yt<16)at>>>=ht,st-=ht,r.lens[r.have++]=yt;else{if(16===yt){for(Pt=ht+2;st<Pt;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}if(at>>>=ht,st-=ht,0===r.have){t.msg="invalid bit length repeat",r.mode=Z;break}_t=r.lens[r.have-1],lt=3+(3&at),at>>>=2,st-=2}else if(17===yt){for(Pt=ht+3;st<Pt;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}st-=ht,_t=0,lt=3+(7&(at>>>=ht)),at>>>=3,st-=3}else{for(Pt=ht+7;st<Pt;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}st-=ht,_t=0,lt=11+(127&(at>>>=ht)),at>>>=7,st-=7}if(r.have+lt>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=Z;break}for(;lt--;)r.lens[r.have++]=_t}}if(r.mode===Z)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=Z;break}if(r.lenbits=9,wt={bits:r.lenbits},bt=s(u,r.lens,0,r.nlen,r.lencode,0,r.work,wt),r.lenbits=wt.bits,bt){t.msg="invalid literal/lengths set",r.mode=Z;break}if(r.distbits=6,r.distcode=r.distdyn,wt={bits:r.distbits},bt=s(l,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,wt),r.distbits=wt.bits,bt){t.msg="invalid distances set",r.mode=Z;break}if(r.mode=V,e===h)break t;case V:r.mode=U;case U:if(it>=6&&ot>=258){t.next_out=nt,t.avail_out=ot,t.next_in=rt,t.avail_in=it,r.hold=at,r.bits=st,a(t,ut),nt=t.next_out,et=t.output,ot=t.avail_out,rt=t.next_in,tt=t.input,it=t.avail_in,at=r.hold,st=r.bits,r.mode===I&&(r.back=-1);break}for(r.back=0;dt=(xt=r.lencode[at&(1<<r.lenbits)-1])>>>16&255,yt=65535&xt,!((ht=xt>>>24)<=st);){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}if(dt&&0==(240&dt)){for(mt=ht,vt=dt,gt=yt;dt=(xt=r.lencode[gt+((at&(1<<mt+vt)-1)>>mt)])>>>16&255,yt=65535&xt,!(mt+(ht=xt>>>24)<=st);){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}at>>>=mt,st-=mt,r.back+=mt}if(at>>>=ht,st-=ht,r.back+=ht,r.length=yt,0===dt){r.mode=X;break}if(32&dt){r.back=-1,r.mode=I;break}if(64&dt){t.msg="invalid literal/length code",r.mode=Z;break}r.extra=15&dt,r.mode=W;case W:if(r.extra){for(Pt=r.extra;st<Pt;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}r.length+=at&(1<<r.extra)-1,at>>>=r.extra,st-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=q;case q:for(;dt=(xt=r.distcode[at&(1<<r.distbits)-1])>>>16&255,yt=65535&xt,!((ht=xt>>>24)<=st);){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}if(0==(240&dt)){for(mt=ht,vt=dt,gt=yt;dt=(xt=r.distcode[gt+((at&(1<<mt+vt)-1)>>mt)])>>>16&255,yt=65535&xt,!(mt+(ht=xt>>>24)<=st);){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}at>>>=mt,st-=mt,r.back+=mt}if(at>>>=ht,st-=ht,r.back+=ht,64&dt){t.msg="invalid distance code",r.mode=Z;break}r.offset=yt,r.extra=15&dt,r.mode=G;case G:if(r.extra){for(Pt=r.extra;st<Pt;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}r.offset+=at&(1<<r.extra)-1,at>>>=r.extra,st-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=Z;break}r.mode=H;case H:if(0===ot)break t;if(lt=ut-ot,r.offset>lt){if((lt=r.offset-lt)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=Z;break}lt>r.wnext?(lt-=r.wnext,pt=r.wsize-lt):pt=r.wnext-lt,lt>r.length&&(lt=r.length),ft=r.window}else ft=et,pt=nt-r.offset,lt=r.length;lt>ot&&(lt=ot),ot-=lt,r.length-=lt;do{et[nt++]=ft[pt++]}while(--lt);0===r.length&&(r.mode=U);break;case X:if(0===ot)break t;et[nt++]=r.length,ot--,r.mode=U;break;case K:if(r.wrap){for(;st<32;){if(0===it)break t;it--,at|=tt[rt++]<<st,st+=8}if(ut-=ot,t.total_out+=ut,r.total+=ut,ut&&(t.adler=r.check=r.flags?o(r.check,et,ut,nt-ut):i(r.check,et,ut,nt-ut)),ut=ot,(r.flags?at:zswap32(at))!==r.check){t.msg="incorrect data check",r.mode=Z;break}at=0,st=0}r.mode=Q;case Q:if(r.wrap&&r.flags){for(;st<32;){if(0===it)break t;it--,at+=tt[rt++]<<st,st+=8}if(at!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=Z;break}at=0,st=0}r.mode=Y;case Y:bt=y;break t;case Z:bt=g;break t;case J:return _;case $:default:return v}return t.next_out=nt,t.avail_out=ot,t.next_in=rt,t.avail_in=it,r.hold=at,r.bits=st,(r.wsize||ut!==t.avail_out&&r.mode<Z&&(r.mode<K||e!==p))&&updatewindow(t,t.output,t.next_out,ut-t.avail_out)?(r.mode=J,_):(ct-=t.avail_in,ut-=t.avail_out,t.total_in+=ct,t.total_out+=ut,r.total+=ut,r.wrap&&ut&&(t.adler=r.check=r.flags?o(r.check,et,ut,t.next_out-ut):i(r.check,et,ut,t.next_out-ut)),t.data_type=r.bits+(r.last?64:0)+(r.mode===I?128:0)+(r.mode===V||r.mode===z?256:0),(0===ct&&0===ut||e===p)&&bt===d&&(bt=b),bt)},e.inflateEnd=function inflateEnd(t){if(!t||!t.state)return v;var e=t.state;return e.window&&(e.window=null),t.state=null,d},e.inflateGetHeader=function inflateGetHeader(t,e){var r;return t&&t.state?0==(2&(r=t.state).wrap)?v:(r.head=e,e.done=!1,d):v},e.inflateSetDictionary=function inflateSetDictionary(t,e){var r,n=e.length;return t&&t.state?0!==(r=t.state).wrap&&r.mode!==A?v:r.mode===A&&i(1,e,n,0)!==r.check?g:updatewindow(t,e,n,n)?(r.mode=J,_):(r.havedict=1,d):v},e.inflateInfo="pako inflate (from Nodeca project)"},function(t,e,r){"use strict";t.exports=function inflate_fast(t,e){var r,n,i,o,a,s,c,u,l,p,f,h,d,y,m,v,g,_,b,w,P,x,O,C,S;r=t.state,n=t.next_in,C=t.input,i=n+(t.avail_in-5),o=t.next_out,S=t.output,a=o-(e-t.avail_out),s=o+(t.avail_out-257),c=r.dmax,u=r.wsize,l=r.whave,p=r.wnext,f=r.window,h=r.hold,d=r.bits,y=r.lencode,m=r.distcode,v=(1<<r.lenbits)-1,g=(1<<r.distbits)-1;t:do{d<15&&(h+=C[n++]<<d,d+=8,h+=C[n++]<<d,d+=8),_=y[h&v];e:for(;;){if(h>>>=b=_>>>24,d-=b,0===(b=_>>>16&255))S[o++]=65535&_;else{if(!(16&b)){if(0==(64&b)){_=y[(65535&_)+(h&(1<<b)-1)];continue e}if(32&b){r.mode=12;break t}t.msg="invalid literal/length code",r.mode=30;break t}w=65535&_,(b&=15)&&(d<b&&(h+=C[n++]<<d,d+=8),w+=h&(1<<b)-1,h>>>=b,d-=b),d<15&&(h+=C[n++]<<d,d+=8,h+=C[n++]<<d,d+=8),_=m[h&g];r:for(;;){if(h>>>=b=_>>>24,d-=b,!(16&(b=_>>>16&255))){if(0==(64&b)){_=m[(65535&_)+(h&(1<<b)-1)];continue r}t.msg="invalid distance code",r.mode=30;break t}if(P=65535&_,d<(b&=15)&&(h+=C[n++]<<d,(d+=8)<b&&(h+=C[n++]<<d,d+=8)),(P+=h&(1<<b)-1)>c){t.msg="invalid distance too far back",r.mode=30;break t}if(h>>>=b,d-=b,P>(b=o-a)){if((b=P-b)>l&&r.sane){t.msg="invalid distance too far back",r.mode=30;break t}if(x=0,O=f,0===p){if(x+=u-b,b<w){w-=b;do{S[o++]=f[x++]}while(--b);x=o-P,O=S}}else if(p<b){if(x+=u+p-b,(b-=p)<w){w-=b;do{S[o++]=f[x++]}while(--b);if(x=0,p<w){w-=b=p;do{S[o++]=f[x++]}while(--b);x=o-P,O=S}}}else if(x+=p-b,b<w){w-=b;do{S[o++]=f[x++]}while(--b);x=o-P,O=S}for(;w>2;)S[o++]=O[x++],S[o++]=O[x++],S[o++]=O[x++],w-=3;w&&(S[o++]=O[x++],w>1&&(S[o++]=O[x++]))}else{x=o-P;do{S[o++]=S[x++],S[o++]=S[x++],S[o++]=S[x++],w-=3}while(w>2);w&&(S[o++]=S[x++],w>1&&(S[o++]=S[x++]))}break}}break}}while(n<i&&o<s);n-=w=d>>3,h&=(1<<(d-=w<<3))-1,t.next_in=n,t.next_out=o,t.avail_in=n<i?i-n+5:5-(n-i),t.avail_out=o<s?s-o+257:257-(o-s),r.hold=h,r.bits=d}},function(t,e,r){"use strict";var n=r(6),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],s=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function inflate_table(t,e,r,c,u,l,p,f){var h,d,y,m,v,g,_,b,w,P=f.bits,x=0,O=0,C=0,S=0,R=0,j=0,T=0,E=0,B=0,A=0,I=null,M=0,k=new n.Buf16(16),z=new n.Buf16(16),F=null,D=0;for(x=0;x<=15;x++)k[x]=0;for(O=0;O<c;O++)k[e[r+O]]++;for(R=P,S=15;S>=1&&0===k[S];S--);if(R>S&&(R=S),0===S)return u[l++]=20971520,u[l++]=20971520,f.bits=1,0;for(C=1;C<S&&0===k[C];C++);for(R<C&&(R=C),E=1,x=1;x<=15;x++)if(E<<=1,(E-=k[x])<0)return-1;if(E>0&&(0===t||1!==S))return-1;for(z[1]=0,x=1;x<15;x++)z[x+1]=z[x]+k[x];for(O=0;O<c;O++)0!==e[r+O]&&(p[z[e[r+O]]++]=O);if(0===t?(I=F=p,g=19):1===t?(I=i,M-=257,F=o,D-=257,g=256):(I=a,F=s,g=-1),A=0,O=0,x=C,v=l,j=R,T=0,y=-1,m=(B=1<<R)-1,1===t&&B>852||2===t&&B>592)return 1;for(;;){_=x-T,p[O]<g?(b=0,w=p[O]):p[O]>g?(b=F[D+p[O]],w=I[M+p[O]]):(b=96,w=0),h=1<<x-T,C=d=1<<j;do{u[v+(A>>T)+(d-=h)]=_<<24|b<<16|w|0}while(0!==d);for(h=1<<x-1;A&h;)h>>=1;if(0!==h?(A&=h-1,A+=h):A=0,O++,0==--k[x]){if(x===S)break;x=e[r+p[O]]}if(x>R&&(A&m)!==y){for(0===T&&(T=R),v+=C,E=1<<(j=x-T);j+T<S&&!((E-=k[j+T])<=0);)j++,E<<=1;if(B+=1<<j,1===t&&B>852||2===t&&B>592)return 1;u[y=A&m]=R<<24|j<<16|v-l|0}}return 0!==A&&(u[v+A]=x-T<<24|64<<16|0),f.bits=R,0}},function(t,e,r){"use strict";t.exports=function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(t,e,r){"use strict";var n=r(1),i=r(3),o=r(9),a=r(26),s=r(50),c=function(t,e){var r,n="";for(r=0;r<e;r++)n+=String.fromCharCode(255&t),t>>>=8;return n},u=function(t,e,r,i,u,l){var p,f,h=t.file,d=t.compression,y=l!==o.utf8encode,m=n.transformTo("string",l(h.name)),v=n.transformTo("string",o.utf8encode(h.name)),g=h.comment,_=n.transformTo("string",l(g)),b=n.transformTo("string",o.utf8encode(g)),w=v.length!==h.name.length,P=b.length!==g.length,x="",O="",C="",S=h.dir,R=h.date,j={crc32:0,compressedSize:0,uncompressedSize:0};e&&!r||(j.crc32=t.crc32,j.compressedSize=t.compressedSize,j.uncompressedSize=t.uncompressedSize);var T=0;e&&(T|=8),y||!w&&!P||(T|=2048);var E,B,A,I=0,M=0;S&&(I|=16),"UNIX"===u?(M=798,I|=(E=h.unixPermissions,B=S,A=E,E||(A=B?16893:33204),(65535&A)<<16)):(M=20,I|=63&(h.dosPermissions||0)),p=R.getUTCHours(),p<<=6,p|=R.getUTCMinutes(),p<<=5,p|=R.getUTCSeconds()/2,f=R.getUTCFullYear()-1980,f<<=4,f|=R.getUTCMonth()+1,f<<=5,f|=R.getUTCDate(),w&&(O=c(1,1)+c(a(m),4)+v,x+="up"+c(O.length,2)+O),P&&(C=c(1,1)+c(a(_),4)+b,x+="uc"+c(C.length,2)+C);var k="";return k+="\n\0",k+=c(T,2),k+=d.magic,k+=c(p,2),k+=c(f,2),k+=c(j.crc32,4),k+=c(j.compressedSize,4),k+=c(j.uncompressedSize,4),k+=c(m.length,2),k+=c(x.length,2),{fileRecord:s.LOCAL_FILE_HEADER+k+m+x,dirRecord:s.CENTRAL_FILE_HEADER+c(M,2)+k+c(_.length,2)+"\0\0\0\0"+c(I,4)+c(i,4)+m+x+_}},l=function(t){return s.DATA_DESCRIPTOR+c(t.crc32,4)+c(t.compressedSize,4)+c(t.uncompressedSize,4)};function ZipFileWorker(t,e,r,n){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=e,this.zipPlatform=r,this.encodeFileName=n,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}n.inherits(ZipFileWorker,i),ZipFileWorker.prototype.push=function(t){var e=t.meta.percent||0,r=this.entriesCount,n=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,i.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:r?(e+100*(r-n-1))/r:100}}))},ZipFileWorker.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var e=this.streamFiles&&!t.file.dir;if(e){var r=u(t,e,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},ZipFileWorker.prototype.closedSource=function(t){this.accumulate=!1;var e=this.streamFiles&&!t.file.dir,r=u(t,e,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),e)this.push({data:l(t),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},ZipFileWorker.prototype.flush=function(){for(var t=this.bytesWritten,e=0;e<this.dirRecords.length;e++)this.push({data:this.dirRecords[e],meta:{percent:100}});var r=this.bytesWritten-t,i=function(t,e,r,i,o){var a=n.transformTo("string",o(i));return s.CENTRAL_DIRECTORY_END+"\0\0\0\0"+c(t,2)+c(t,2)+c(e,4)+c(r,4)+c(a.length,2)+a}(this.dirRecords.length,r,t,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},ZipFileWorker.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},ZipFileWorker.prototype.registerPrevious=function(t){this._sources.push(t);var e=this;return t.on("data",function(t){e.processChunk(t)}),t.on("end",function(){e.closedSource(e.previous.streamInfo),e._sources.length?e.prepareNextSource():e.end()}),t.on("error",function(t){e.error(t)}),this},ZipFileWorker.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},ZipFileWorker.prototype.error=function(t){var e=this._sources;if(!i.prototype.error.call(this,t))return!1;for(var r=0;r<e.length;r++)try{e[r].error(t)}catch(t){}return!0},ZipFileWorker.prototype.lock=function(){i.prototype.lock.call(this);for(var t=this._sources,e=0;e<t.length;e++)t[e].lock()},t.exports=ZipFileWorker},function(t,e,r){"use strict";var n=r(1),i=r(3);function NodejsStreamInputAdapter(t,e){i.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(e)}n.inherits(NodejsStreamInputAdapter,i),NodejsStreamInputAdapter.prototype._bindStream=function(t){var e=this;this._stream=t,t.pause(),t.on("data",function(t){e.push({data:t,meta:{percent:0}})}).on("error",function(t){e.isPaused?this.generatedError=t:e.error(t)}).on("end",function(){e.isPaused?e._upstreamEnded=!0:e.end()})},NodejsStreamInputAdapter.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},NodejsStreamInputAdapter.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=NodejsStreamInputAdapter},function(t,e,r){"use strict";var n=r(1),i=r(13),o=r(9),a=(n=r(1),r(98)),s=r(43),c=r(18);function checkEntryCRC32(t){return new i.Promise(function(e,r){var n=t.decompressed.getContentWorker().pipe(new s);n.on("error",function(t){r(t)}).on("end",function(){n.streamInfo.crc32!==t.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):e()}).resume()})}t.exports=function(t,e){var r=this;return e=n.extend(e||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:o.utf8decode}),c.isNode&&c.isStream(t)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):n.prepareContent("the loaded zip file",t,!0,e.optimizedBinaryString,e.base64).then(function(t){var r=new a(e);return r.load(t),r}).then(function checkCRC32(t){var r=[i.Promise.resolve(t)],n=t.files;if(e.checkCRC32)for(var o=0;o<n.length;o++)r.push(checkEntryCRC32(n[o]));return i.Promise.all(r)}).then(function addFiles(t){for(var n=t.shift(),i=n.files,o=0;o<i.length;o++){var a=i[o];r.file(a.fileNameStr,a.decompressed,{binary:!0,optimizedBinaryString:!0,date:a.date,dir:a.dir,comment:a.fileCommentStr.length?a.fileCommentStr:null,unixPermissions:a.unixPermissions,dosPermissions:a.dosPermissions,createFolders:e.createFolders})}return n.zipComment.length&&(r.comment=n.zipComment),r})}},function(t,e,r){"use strict";var n=r(51),i=r(1),o=r(50),a=r(101),s=(r(9),r(5));function ZipEntries(t){this.files=[],this.loadOptions=t}ZipEntries.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var e=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(e)+", expected "+i.pretty(t)+")")}},isSignature:function(t,e){var r=this.reader.index;this.reader.setIndex(t);var n=this.reader.readString(4)===e;return this.reader.setIndex(r),n},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),e=s.uint8array?"uint8array":"array",r=i.transformTo(e,t);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,e,r,n=this.zip64EndOfCentralSize-44;0<n;)t=this.reader.readInt(2),e=this.reader.readInt(4),r=this.reader.readData(e),this.zip64ExtensibleData[t]={id:t,length:e,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,e;for(t=0;t<this.files.length;t++)e=this.files[t],this.reader.setIndex(e.localHeaderOffset),this.checkSignature(o.LOCAL_FILE_HEADER),e.readLocalPart(this.reader),e.handleUTF8(),e.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(o.CENTRAL_FILE_HEADER);)(t=new a({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(o.CENTRAL_DIRECTORY_END);if(t<0)throw!this.isSignature(0,o.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(t);var e=t;if(this.checkSignature(o.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,o.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(o.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var n=e-r;if(n>0)this.isSignature(e,o.CENTRAL_FILE_HEADER)||(this.reader.zero=n);else if(n<0)throw new Error("Corrupted zip: missing "+Math.abs(n)+" bytes.")},prepareReader:function(t){this.reader=n(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=ZipEntries},function(t,e,r){"use strict";var n=r(53);function StringReader(t){n.call(this,t)}r(1).inherits(StringReader,n),StringReader.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},StringReader.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},StringReader.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},StringReader.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},t.exports=StringReader},function(t,e,r){"use strict";var n=r(54);function NodeBufferReader(t){n.call(this,t)}r(1).inherits(NodeBufferReader,n),NodeBufferReader.prototype.readData=function(t){this.checkOffset(t);var e=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,e},t.exports=NodeBufferReader},function(t,e,r){"use strict";var n=r(51),i=r(1),o=r(25),a=r(26),s=r(9),c=r(44),u=r(5);function ZipEntry(t,e){this.options=t,this.loadOptions=e}ZipEntry.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var e,r;if(t.skip(22),this.fileNameLength=t.readInt(2),r=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(e=function(t){for(var e in c)if(c.hasOwnProperty(e)&&c[e].magic===t)return c[e];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new o(this.compressedSize,this.uncompressedSize,this.crc32,e,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var e=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(e),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===t&&(this.dosPermissions=63&this.externalFileAttributes),3===t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var e=n(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=e.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=e.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=e.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=e.readInt(4))}},readExtraFields:function(t){var e,r,n,i=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index<i;)e=t.readInt(2),r=t.readInt(2),n=t.readData(r),this.extraFields[e]={id:e,length:r,value:n}},handleUTF8:function(){var t=u.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=s.utf8decode(this.fileName),this.fileCommentStr=s.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();if(null!==e)this.fileNameStr=e;else{var r=i.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var n=this.findExtraFieldUnicodeComment();if(null!==n)this.fileCommentStr=n;else{var o=i.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(o)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:a(this.fileName)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var e=n(t.value);return 1!==e.readInt(1)?null:a(this.fileComment)!==e.readInt(4)?null:s.utf8decode(e.readData(t.length-5))}return null}},t.exports=ZipEntry},function(t,e,r){"use strict";var n;r.r(e),r.d(e,"FileInMemory",function(){return i}),function(t){t.files={}}(n||(n={}));var i=function(){function FileInMemory(){}return FileInMemory.prototype.read=function(t){return new Promise(function(e,r){var i=n.files[t];i?e(i):r("Can't open '"+t+"'")})},FileInMemory.prototype.write=function(t,e){return new Promise(function(r,i){n.files[t]=e,r()})},FileInMemory.prototype.delete=function(t){return console.assert(!1,"Not Implemented"),Promise.reject()},FileInMemory.prototype.renameFile=function(t,e){return console.assert(!1,"Not Implemented"),Promise.reject()},FileInMemory.prototype.renameFolder=function(t,e){return console.assert(!1,"Not Implemented"),Promise.reject()},FileInMemory.prototype.clearAllFiles=function(){return console.assert(!1,"Not Implemented"),Promise.reject()},FileInMemory.prototype.temporaryGetFiles=function(){return n.files},FileInMemory}()},function(t,e,r){"use strict";var n;r.r(e),r.d(e,"FileStandaloneWeb",function(){return i}),n||(n={});var i=function(){function FileStandaloneWeb(t){console.assert(!n.defaultAssets),console.assert(t),n.defaultAssets=t}return FileStandaloneWeb.prototype.read=function(t){var e=n.defaultAssets[t];return e?Promise.resolve(e):new Promise(function(e,r){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status||0===n.status?e(n.responseText):r("Can't open '"+t+"', status: "+n.status))},n.open("GET",t,!0),n.send(null)})},FileStandaloneWeb.prototype.write=function(t,e){return Promise.reject()},FileStandaloneWeb.prototype.delete=function(t){return Promise.reject()},FileStandaloneWeb.prototype.renameFile=function(t,e){return Promise.reject()},FileStandaloneWeb.prototype.renameFolder=function(t,e){return Promise.reject()},FileStandaloneWeb.prototype.clearAllFiles=function(){return Promise.reject()},FileStandaloneWeb}()},function(t,e,r){"use strict";r.r(e);var n,i,o=(n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)},function(t,e){function __(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(__.prototype=e.prototype,new __)}),a=function(t){function Reference(e,r){var n=t.call(this)||this;return n.baseTypeName=function(){return e.name},n.getInstance=function(){return n.instance},n.instance=r||void 0,n}return o(Reference,t),Reference}(function(){return function ReferenceBase(){}}());!function(t){t[t.None=0]="None",t[t.Linear=1]="Linear",t[t.Additive=2]="Additive"}(i||(i={}));var s,c=function(){function BlendingModesMetadata(){}return BlendingModesMetadata.literals={None:0,Linear:1,Additive:2},BlendingModesMetadata}();!function(t){t[t.Linear=0]="Linear",t[t.Nearest=1]="Nearest"}(s||(s={}));var u,l=function(){function TextureFilteringMetadata(){}return TextureFilteringMetadata.literals={Linear:0,Nearest:1},TextureFilteringMetadata}();!function(t){t[t.Back=0]="Back",t[t.Front=1]="Front",t[t.None=2]="None"}(u||(u={}));var p,f=function(){function CullModesMetadata(){}return CullModesMetadata.literals={Back:0,Front:1,None:2},CullModesMetadata}();!function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent"}(p||(p={}));var h,d=function(){function RenderPassMetadata(){}return RenderPassMetadata.literals={Opaque:0,Transparent:1},RenderPassMetadata}();!function(t){t[t._8=0]="_8",t[t._16=1]="_16",t[t._32=2]="_32",t[t._64=3]="_64",t[t._256=4]="_256",t[t._512=5]="_512",t[t._1024=6]="_1024",t[t._2048=7]="_2048",t[t._4096=8]="_4096"}(h||(h={}));var y,m,v=function(){function TextureSizePow2Metadata(){}return TextureSizePow2Metadata.literals={_8:8,_16:16,_32:32,_64:64,_256:256,_512:512,_1024:1024,_2048:2048,_4096:4096},TextureSizePow2Metadata}();r(55);function Attributes_hidden(){return Reflect.metadata("hidden",!0)}function unserializable(){return Reflect.metadata("unserializable",!0)}function editable(t){return Reflect.metadata("editable",t)}function creatable(t){return Reflect.metadata("creatable",t)}function referencable(t){return Reflect.metadata("referencable",t)}function mandatory(){return Reflect.metadata("mandatory",!0)}function hasDedicatedEditor(t){return Reflect.metadata("hasDedicatedEditor",t)}function displayName(t){return Reflect.metadata("displayName",t)}function sortOrder(t){return Reflect.metadata("sortOrder",t)}function helpUrl(t){return Reflect.metadata("helpUrl",t)}function Attributes_enumLiterals(t,e){return Reflect.metadata("enumLiterals",{literals:t,getDisplayName:e})}!function(t){t.rootTypeName="SerializableObject",t.rawTypeInfos=[],t.findTypeNode=function findTypeNode(t,e){if(t.typeName===e)return t;for(var r=0,n=t.derivedTypes;r<n.length;r++){var i=findTypeNode(n[r],e);if(i)return i}},t.getTypesUnderNode=function getTypesUnderNode(t,e){for(var r=0,n=t.derivedTypes;r<n.length;r++){var i=n[r];e.push(i.typeName),getTypesUnderNode(i,e)}}}(y||(y={})),function(t){t.buildTypeTree=function buildTypeTree(){y.typeTree={typeName:y.rootTypeName,derivedTypes:[]};for(var t=function(t){for(var e=t,r=0;e!==y.rootTypeName;){++r;var n=y.rawTypeInfos.filter(function(t){return t.derivedTypes.some(function(t){return t===e})}),i=n.length?n[0]:void 0;if(!i)return console.assert(!1,"Cannot find parent type for '"+e+"', please register it using Factory.registerObject()"),-1;e=i.typeName}return r},e=0,r=y.rawTypeInfos;e<r.length;e++){var n=r[e];n.depth=t(n.typeName)}y.rawTypeInfos.sort(function(t,e){return t.depth-e.depth});for(var i=0,o=y.rawTypeInfos;i<o.length;i++){var a=o[i],s=y.findTypeNode(y.typeTree,a.typeName);if(s)for(var c=0,u=a.derivedTypes;c<u.length;c++){var l=u[c];s.derivedTypes.push({parent:s,typeName:l,derivedTypes:[]})}}},t.registerRawTypeInfo=function registerRawTypeInfo(t,e){var r=y.rawTypeInfos.filter(function(e){return e.typeName===t}),n=r.length?r[0]:void 0;n?n.derivedTypes.push(e):y.rawTypeInfos.push({typeName:t,derivedTypes:[e],depth:-1})}}(m||(m={}));var g,_=function(){function RTTI(){}return RTTI.isObjectOfType=function(t,e){for(var r=y.findTypeNode(y.typeTree,t);r;){if(r.typeName===e)return!0;r=r.parent}return!1},RTTI.getAncestorTypes=function(t,e){for(var r=[],n=y.findTypeNode(y.typeTree,t);n&&n.parent&&n.parent.typeName!==e;)r.push(n.parent.typeName),n=y.findTypeNode(y.typeTree,n.parent.typeName);return r},RTTI.getDerivedObjectTypes=function(t){var e=[],r=y.findTypeNode(y.typeTree,t);return r&&y.getTypesUnderNode(r,e),e},RTTI}();g||(g={});var b,w=function(){function ISerializerInternal(){}return Object.defineProperty(ISerializerInternal,"instance",{get:function(){return g.instance},set:function(t){g.instance=t},enumerable:!0,configurable:!0}),ISerializerInternal}();b||(b={});var P,x=function(){function IFactoryInternal(){}return Object.defineProperty(IFactoryInternal,"instance",{get:function(){return b.instance},set:function(t){b.instance=t},enumerable:!0,configurable:!0}),IFactoryInternal}(),O=function(){function SerializableObject(){}return SerializableObject.prototype.isA=function(t){return _.isObjectOfType(this.constructor.name,t.name)},SerializableObject.prototype.copy=function(){var t=x.instance.createObject(this.constructor.name);return t.deserialize(this.serialize()),t},SerializableObject.prototype.destroy=function(){},SerializableObject.prototype.setProperty=function(t,e){this[t]=e},SerializableObject.prototype.serialize=function(){return w.instance.serializeObject(this)},SerializableObject.prototype.deserialize=function(t){return w.instance.deserializeObject(this,t),Promise.resolve(this)},SerializableObject.prototype.upgrade=function(t,e){return t},SerializableObject.prototype.setState=function(t){var e=this;Object.entries(t).forEach(function(t){var r,n=t[0],i=t[1];Object.assign(e,((r={})[n]=i,r))})},SerializableObject}(),C=r(56),S=function(){function EngineUtils(){}return EngineUtils.isObjectLoaded=function(t){for(var e=0,r=Object.values(t);e<r.length;e++){var n=r[e];if(null!==n)if("AssetReference"===(n.constructor?n.constructor.name:null)){var i=n;if(!EngineUtils.isAssetRefLoaded(i))return!1}}return!0},EngineUtils.isAssetRefLoaded=function(t){return!!t.isResolved&&!(t.asset&&!t.asset.isLoaded())},EngineUtils.makeUniqueId=function(){return C()},EngineUtils}(),R=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),j=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},T=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},E=function(t){function UniqueObject(){var e=t.call(this)||this;return e.id=S.makeUniqueId(),e.name=e.constructor.name,e}return R(UniqueObject,t),UniqueObject.prototype.copy=function(){var t=x.instance.createObject(this.constructor.name);return t.templatePath=this.templatePath,t.deserialize(this.serialize()),t.id=S.makeUniqueId(),t},j([Attributes_hidden(),T("design:type",String)],UniqueObject.prototype,"id",void 0),j([Attributes_hidden(),T("design:type",String)],UniqueObject.prototype,"name",void 0),j([unserializable(),T("design:type",String)],UniqueObject.prototype,"templatePath",void 0),UniqueObject}(O),B=r(0);P||(P={});var A,I=function(){function IObjectManagerInternal(){}return Object.defineProperty(IObjectManagerInternal,"instance",{get:function(){return P.instance},set:function(t){P.instance=t},enumerable:!0,configurable:!0}),IObjectManagerInternal}(),M=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),k=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},z=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},F=function(t){function Asset(){var e=null!==t&&t.apply(this,arguments)||this;return e.isPersistent=!1,e.deleted=new B.AsyncEvent,e}return M(Asset,t),Asset.prototype.isLoaded=function(){return!0},Asset.prototype.save=function(){return this.isPersistent?I.instance.saveObject(this):Promise.resolve()},Asset.prototype.destroy=function(){this.deleted.post(this.id),t.prototype.destroy.call(this)},k([unserializable(),z("design:type",Object)],Asset.prototype,"isPersistent",void 0),k([unserializable(),z("design:type",Object)],Asset.prototype,"deleted",void 0),Asset}(E);!function(t){t.externalLogger=function(){}}(A||(A={}));var D,N,L,V=function(){function Debug(){}return Debug.log=function(t){console.log(t),A.externalLogger(t)},Debug.logError=function(t){console.error(t),A.externalLogger(t)},Debug.logWarning=function(t){console.warn(t),A.externalLogger(t)},Debug.logVector3=function(t){console.log(t.x+", "+t.y+", "+t.z)},Debug.logVector2=function(t){console.log(t.x+", "+t.y)},Debug}(),U=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),W=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},q=function(t){function GraphicAsset(){return null!==t&&t.apply(this,arguments)||this}return U(GraphicAsset,t),GraphicAsset.prototype.destroy=function(){this.graphicUnload(),t.prototype.destroy.call(this)},GraphicAsset.prototype.graphicLoad=function(){return!0},GraphicAsset.prototype.graphicUnload=function(){},GraphicAsset=W([creatable(!1),referencable(!1)],GraphicAsset)}(F),G=function(){function ObjectPool(t,e){this._size=0,this._initialCapacity=e,this._capacity=e,this._objects=[],this._objects.length=e;for(var r=0;r<e;++r)this._objects[r]=new t;this._creator=function(){return new t}}return Object.defineProperty(ObjectPool.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),ObjectPool.prototype.flush=function(){this._size=0},ObjectPool.prototype.peek=function(t){return this._objects[t]},ObjectPool.prototype.get=function(){return this._size===this._capacity&&this.grow(),this._objects[this._size++]},ObjectPool.prototype.shrink=function(){this._capacity=this._initialCapacity,this._objects.length=this._capacity,this._size=Math.min(this._size,this._capacity)},ObjectPool.prototype.grow=function(){V.log(this._objects[0].constructor.name+" pool capacity reached, doubling the pool. Consider allocating a bigger pool.");var t=2*this._capacity;this._objects.length=t;for(var e=this._capacity;e<t;++e)this._objects[e]=this._creator();this._capacity=t},ObjectPool}(),H=function(){function Vector3(t,e,r){this._x=t||0,this._y=e||0,this._z=r||0}return Object.defineProperty(Vector3.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(Vector3.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(Vector3.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t},enumerable:!0,configurable:!0}),Object.defineProperty(Vector3.prototype,"length",{get:function(){return Math.sqrt(this.lengthSq)},enumerable:!0,configurable:!0}),Object.defineProperty(Vector3.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!0,configurable:!0}),Vector3.distance=function(t,e){return Math.sqrt(Vector3.distanceSq(t,e))},Vector3.distanceSq=function(t,e){var r=t.x-e.x,n=t.y-e.y,i=t.z-e.z;return r*r+n*n+i*i},Vector3.fromPool=function(){return Vector3.pool.get()},Vector3.fromArray=function(t,e){var r=e||0;return new Vector3(t[r],t[r+1],t[r+2])},Vector3.prototype.flip=function(){var t=this.x,e=this.y,r=this.z;return this._x=-t,this._y=-e,this.z=-r,this},Vector3.prototype.cross=function(t){return this.crossVectors(this,t)},Vector3.prototype.crossVectors=function(t,e){var r=t.x,n=t.y,i=t.z,o=e.x,a=e.y,s=e.z;return this._x=n*s-i*a,this._y=i*o-r*s,this.z=r*a-n*o,this},Vector3.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},Vector3.prototype.substract=function(t){return this.substractVectors(this,t)},Vector3.prototype.substractVectors=function(t,e){return this._x=t.x-e.x,this._y=t.y-e.y,this.z=t.z-e.z,this},Vector3.prototype.add=function(t){return this.addVectors(this,t)},Vector3.prototype.addVectors=function(t,e){return this._x=t.x+e.x,this._y=t.y+e.y,this.z=t.z+e.z,this},Vector3.prototype.multiply=function(t){return this._x*=t,this._y*=t,this.z*=t,this},Vector3.prototype.multiplyVector=function(t){return this._x*=t.x,this._y*=t.y,this.z*=t.z,this},Vector3.prototype.divide=function(t){return this._x/=t,this._y/=t,this.z/=t,this},Vector3.prototype.divideVector=function(t){return this._x/=t.x,this._y/=t.y,this.z/=t.z,this},Vector3.prototype.min=function(){var t=this.x,e=this.y,r=this.z;return Math.min(t,Math.min(e,r))},Vector3.prototype.max=function(){var t=this.x,e=this.y,r=this.z;return Math.max(t,Math.max(e,r))},Vector3.prototype.normalize=function(){var t=this.length;return t<Number.EPSILON?this:this.multiply(1/t)},Vector3.prototype.lerp=function(t,e){return this.lerpVectors(this,t,e)},Vector3.prototype.lerpVectors=function(t,e,r){return this._x=t.x+(e.x-t.x)*r,this._y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this},Vector3.prototype.slerp=function(t,e){return this.slerpVectors(this,t,e)},Vector3.prototype.slerpVectors=function(t,e,r){var n=t.dot(e);n=Math.max(Math.min(n,1),-1);var i=Math.acos(n)*r,o=Vector3.dummy.copy(t).multiply(-n).add(e),a=o.length;return a>0&&o.multiply(1/a).multiply(Math.sin(i)),this.copy(t).multiply(Math.cos(i)).add(o)},Vector3.prototype.distFromSq=function(t){var e=this.x-t.x,r=this.y-t.y,n=this.z-t.z;return e*e+r*r+n*n},Vector3.prototype.distFrom=function(t){return Math.sqrt(this.distFromSq(t))},Vector3.prototype.set=function(t,e,r){return this._x=t,this._y=e,this.z=r,this},Vector3.prototype.setFromArray=function(t,e){var r=e||0;return console.assert(t.length>r+2),this._x=t[r],this._y=t[r+1],this.z=t[r+2],this},Vector3.prototype.setFromMatrix=function(t){return this._x=t.data[12],this._y=t.data[13],this.z=t.data[14],this},Vector3.prototype.setFromMatrixColumn=function(t,e){return this.setFromArray(t.data,4*e)},Vector3.prototype.rotate=function(t){var e=this.x,r=this.y,n=this.z,i=t.x,o=t.y,a=t.z,s=t.w,c=s*e+o*n-a*r,u=s*r+a*e-i*n,l=s*n+i*r-o*e,p=-i*e-o*r-a*n;return this._x=c*s+p*-i+u*-a-l*-o,this._y=u*s+p*-o+l*-i-c*-a,this.z=l*s+p*-a+c*-o-u*-i,this},Vector3.prototype.transform=function(t){var e=this.x,r=this.y,n=this.z,i=t.data;this._x=i[0]*e+i[4]*r+i[8]*n+i[12],this._y=i[1]*e+i[5]*r+i[9]*n+i[13],this._z=i[2]*e+i[6]*r+i[10]*n+i[14];var o=i[3]*e+i[7]*r+i[11]*n+i[15];return this.multiply(1/o)},Vector3.prototype.transformDirection=function(t){var e=this.x,r=this.y,n=this.z,i=t.data;return this._x=i[0]*e+i[4]*r+i[8]*n,this._y=i[1]*e+i[5]*r+i[9]*n,this._z=i[2]*e+i[6]*r+i[10]*n,this.normalize()},Vector3.prototype.copy=function(t){return this._x=t.x,this._y=t.y,this.z=t.z,this},Vector3.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},Vector3.prototype.asArray=function(){return this._array?(this._array[0]=this.x,this._array[1]=this.y,this._array[2]=this.z,this._array):(this._array=[this.x,this.y,this.z],this._array)},Vector3.prototype.toArray=function(t,e){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},Vector3.prototype.projectOnLine=function(t,e){var r=Vector3.dummy,n=Vector3.dummy2;return r.substractVectors(e,t).normalize(),n.substractVectors(this,t),r.dot(n)},Vector3.prototype.projectOnVector=function(t){var e=t.length;if(e<Number.EPSILON)return this;var r=Vector3.dummy.copy(t).multiply(1/e),n=this.dot(r);return this.copy(r).multiply(n)},Vector3.prototype.plus=function(t){return Vector3.dummy.copy(this).add(t)},Vector3.prototype.minus=function(t){return Vector3.dummy.copy(this).substract(t)},Vector3.prototype.reflect=function(t){Vector3.dummy.copy(t).multiply(2*this.dot(t)),this.substract(Vector3.dummy)},Vector3.zero=new Vector3,Vector3.one=new Vector3(1,1,1),Vector3.right=new Vector3(1,0,0),Vector3.up=new Vector3(0,1,0),Vector3.forward=new Vector3(0,0,1),Vector3.dummy=new Vector3,Vector3.dummy2=new Vector3,Vector3.pool=new G(Vector3,128),Vector3}();L=D||(D={}),(N=L.getClosestPointOnLine||(L.getClosestPointOnLine={})).vc=new H,N.vd=new H;var X,K=function(){function MathEx(){}return MathEx.toRadians=function(t){return t*MathEx.degreesToRadians},MathEx.toDegrees=function(t){return t*MathEx.radiansToDegrees},MathEx.clamp=function(t,e,r){return t<e?e:t>r?r:t},MathEx.isZero=function(t){return t>-MathEx.EPSILON&&t<MathEx.EPSILON},MathEx.isEqual=function(t,e){return MathEx.isZero(Math.abs(t-e))},MathEx.lerp=function(t,e,r){return t+(e-t)*r},MathEx.ceilPowerOfTwo=function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},MathEx.sphericalToCartesian=function(t,e,r,n){return n.x=t*Math.cos(e)*Math.sin(r),n.y=t*Math.sin(e)*Math.sin(r),n.z=t*Math.cos(r),n},MathEx.getClosestPointOnLine=function(t,e,r,n){var i=D.getClosestPointOnLine,o=i.vc,a=i.vd;o.substractVectors(t,e),a.substractVectors(r,e);var s=a.length;a.multiply(1/s);var c=a.dot(o);return c<0?e:c>s?r:n.copy(a).multiply(c).add(e)},MathEx.getNextPow2=function(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},MathEx.isPowerOf2=function(t){return 0==(t&t-1)},MathEx.euclideanModulo=function(t,e){return(t%e+e)%e},MathEx.PI2=2*Math.PI,MathEx.EPSILON=1e-6,MathEx.degreesToRadians=.017453288,MathEx.radiansToDegrees=57.29579143,MathEx}();!function(t){(X||(X={})).hue2rgb=function hue2rgb(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(e-t)*r:r<.5?e:r<2/3?t+6*(e-t)*(2/3-r):t}}();var Q,Y,Z=function(){function Color(t,e,r,n){this.set(t||0,e||0,r||0,n)}return Color.lerp=function(t,e,r,n){return n||(n=Color.dummy),n.r=K.lerp(t.r,e.r,r),n.g=K.lerp(t.g,e.g,r),n.b=K.lerp(t.b,e.b,r),n.a=K.lerp(t.a,e.a,r),n},Color.prototype.set=function(t,e,r,n){return this.r=t,this.g=e,this.b=r,this.a=void 0!==n?n:1,this},Color.prototype.setFromArray=function(t){return this.r=t.length>0?t[0]:0,this.g=t.length>1?t[1]:0,this.b=t.length>2?t[2]:0,this.a=t.length>3?t[3]:1,this},Color.prototype.setFromChromeColor=function(t,e,r,n){return this.r=t/255,this.g=e/255,this.b=r/255,this.a=n,this},Color.prototype.toChromeColor=function(){return{r:Math.round(255*this.r),g:Math.round(255*this.g),b:Math.round(255*this.b),a:this.a}},Color.prototype.asArray=function(){return this._array?(this._array[0]=this.r,this._array[1]=this.g,this._array[2]=this.b,this._array[3]=this.a,this._array):(this._array=[this.r,this.g,this.b,this.a],this._array)},Color.prototype.copy=function(t){return this.set(t.r,t.g,t.b,t.a)},Color.prototype.equals=function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},Color.prototype.setAlpha=function(t){return this.a=t,this},Color.prototype.multiplyColor=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this.a*=t.a,this},Color.prototype.multiply=function(t){return this.r=Math.min(this.r*t,1),this.g=Math.min(this.g*t,1),this.b=Math.min(this.b*t,1),this.a=Math.min(this.a*t,1),this},Color.prototype.add=function(t){return this.r=Math.min(this.r+t.r,1),this.g=Math.min(this.g+t.g,1),this.b=Math.min(this.b+t.b,1),this.a=Math.min(this.a+t.a,1),this},Color.prototype.setHSL=function(t,e,r){if(t=K.euclideanModulo(t,1),e=K.clamp(e,0,1),r=K.clamp(r,0,1),0===e)this.r=this.g=this.b=r;else{var n=r<=.5?r*(1+e):r+e-r*e,i=2*r-n;this.r=X.hue2rgb(i,n,t+1/3),this.g=X.hue2rgb(i,n,t),this.b=X.hue2rgb(i,n,t-1/3)}return this},Color.black=new Color,Color.white=new Color(1,1,1),Color.red=new Color(1,0,0),Color.green=new Color(0,1,0),Color.blue=new Color(0,0,1),Color.yellow=new Color(1,1,0),Color.pink=new Color(1,0,1),Color.orange=new Color(1,.5,0),Color.grey=new Color(.7,.7,.7),Color.dummy=new Color,Color}(),J=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),$=function(t){function Fog(){var e=null!==t&&t.apply(this,arguments)||this;return e.color=new Z(.7,.7,.7,1),e}return J(Fog,t),Fog}(O),tt=function(t){function ExponentialFog(){var e=null!==t&&t.apply(this,arguments)||this;return e.density=.005,e}return J(ExponentialFog,t),ExponentialFog}($),et=function(t){function LinearFog(){var e=null!==t&&t.apply(this,arguments)||this;return e.near=700,e.far=1e3,e}return J(LinearFog,t),LinearFog}($);!function(t){t.deltaTimeCap=.1,t.previousTime=performance.now(),t.time=0,t.deltaTime=0,t.smoothDeltaTime=0,t.frameTimer=0,t.frameCount=0,t.fps=0,t.currentFrame=0}(Q||(Q={})),function(t){t.updateDeltaTime=function updateDeltaTime(){var t=performance.now(),e=Math.min((t-Q.previousTime)/1e3,Q.deltaTimeCap);Q.smoothDeltaTime=K.lerp(Q.deltaTime,e,.5),Q.deltaTime=e,Q.time+=e,Q.previousTime=t,Q.frameTimer+=Q.deltaTime,Q.frameCount++,Q.frameTimer>=1&&(Q.fps=Q.frameCount/Q.frameTimer,Q.frameCount=0,Q.frameTimer=0)},t.resetCurrentFrame=function resetCurrentFrame(){Q.currentFrame=0},t.incrementCurrentFrame=function incrementCurrentFrame(){++Q.currentFrame}}(Y||(Y={}));var rt,nt=function(){function Time(){}return Object.defineProperty(Time,"time",{get:function(){return Q.time},enumerable:!0,configurable:!0}),Object.defineProperty(Time,"deltaTime",{get:function(){return Q.deltaTime},enumerable:!0,configurable:!0}),Object.defineProperty(Time,"smoothDeltaTime",{get:function(){return Q.smoothDeltaTime},enumerable:!0,configurable:!0}),Object.defineProperty(Time,"fps",{get:function(){return Q.fps},enumerable:!0,configurable:!0}),Object.defineProperty(Time,"currentFrame",{get:function(){return Q.currentFrame},enumerable:!0,configurable:!0}),Time}(),it=function(){function Vector2(t,e){this.x=t||0,this.y=e||0}return Object.defineProperty(Vector2.prototype,"length",{get:function(){return Math.sqrt(this.lengthSq)},enumerable:!0,configurable:!0}),Object.defineProperty(Vector2.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y},enumerable:!0,configurable:!0}),Vector2.fromArray=function(t){var e=new Vector2;t.length>0&&(e.x=t[0]),t.length>1&&(e.y=t[1])},Vector2.fromPool=function(){return Vector2.pool.get()},Vector2.prototype.set=function(t,e){return this.x=t,this.y=e,this},Vector2.prototype.add=function(t){return this.addVectors(this,t)},Vector2.prototype.addVectors=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},Vector2.prototype.substract=function(t){return this.substractVectors(this,t)},Vector2.prototype.substractVectors=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},Vector2.prototype.normalize=function(){var t=this.length;return t<Number.EPSILON?this:this.multiplyScalar(1/t)},Vector2.prototype.multiplyScalar=function(t){return this.x=this.x*t,this.y=this.y*t,this},Vector2.prototype.dot=function(t){return this.x*t.x+this.y*t.y},Vector2.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},Vector2.prototype.asArray=function(){return this._array?(this._array[0]=this.x,this._array[1]=this.y,this._array):(this._array=[this.x,this.y],this._array)},Vector2.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},Vector2.zero=new Vector2,Vector2.one=new Vector2(1,1),Vector2.right=new Vector2(1,0),Vector2.up=new Vector2(0,1),Vector2.pool=new G(Vector2,128),Vector2.dummy=new Vector2,Vector2}(),ot=function(){function Vector4(t,e,r,n){this.set(t||0,e||0,r||0,n||0)}return Object.defineProperty(Vector4.prototype,"manhattanLength",{get:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},enumerable:!0,configurable:!0}),Object.defineProperty(Vector4.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(Vector4.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(Vector4.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t},enumerable:!0,configurable:!0}),Object.defineProperty(Vector4.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t},enumerable:!0,configurable:!0}),Vector4.fromArray=function(t){var e=new Vector4;t.length>0&&(e.x=t[0]),t.length>1&&(e.y=t[1]),t.length>2&&(e.z=t[2]),t.length>3&&(e.w=t[3])},Vector4.fromPool=function(){return Vector4.pool.get()},Vector4.prototype.set=function(t,e,r,n){return this.x=t,this.y=e,this.z=r,this.w=n,this},Vector4.prototype.copy=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this.w=t.w,this},Vector4.prototype.multiplyScalar=function(t){return this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t,this},Vector4.prototype.toArray=function(){return this._array?(this._array[0]=this.x,this._array[1]=this.y,this._array[2]=this.z,this._array[3]=this.w,this._array):(this._array=[this.x,this.y,this.z,this.w],this._array)},Vector4.prototype.transform=function(t){var e=this.x,r=this.y,n=this.z,i=this.w,o=t.data;return this.x=o[0]*e+o[4]*r+o[8]*n+o[12]*i,this.y=o[1]*e+o[5]*r+o[9]*n+o[13]*i,this.z=o[2]*e+o[6]*r+o[10]*n+o[14]*i,this.w=o[3]*e+o[7]*r+o[11]*n+o[15]*i,this},Vector4.prototype.getVec3=function(t){return t.set(this.x,this.y,this.z)},Vector4.dummy=new Vector4,Vector4.pool=new G(Vector4,128),Vector4}();!function(t){t.dummy=new H,t.dummy2=new H,t.dummy3=new H}(rt||(rt={}));var at,st=function(){function Matrix44(t){this.data=t||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return Matrix44.fromArray=function(t){var e=new Matrix44;return e.data=t.slice(),e},Matrix44.fromPool=function(){return Matrix44.pool.get()},Matrix44.prototype.makeOrthoProjection=function(t,e,r,n,i,o){var a=this.data,s=1/(e-t),c=1/(r-n),u=1/(o-i),l=(e+t)*s,p=(r+n)*c,f=(o+i)*u;return a[0]=2*s,a[4]=0,a[8]=0,a[12]=-l,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-p,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},Matrix44.prototype.makePerspectiveProjection=function(t,e,r,n){var i=this.data,o=1/Math.tan(t/2),a=1/(r-n),s=(n+r)*a,c=r*n*2*a;return i[0]=o/e,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=o,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=s,i[11]=-1,i[12]=0,i[13]=0,i[14]=c,i[15]=0,this},Matrix44.prototype.setRotation=function(t){var e=this.data,r=t.x,n=t.y,i=t.z,o=t.w,a=r+r,s=n+n,c=i+i,u=r*a,l=r*s,p=r*c,f=n*s,h=n*c,d=i*c,y=o*a,m=o*s,v=o*c;return e[0]=1-(f+d),e[4]=l-v,e[8]=p+m,e[1]=l+v,e[5]=1-(u+d),e[9]=h-y,e[2]=p-m,e[6]=h+y,e[10]=1-(u+f),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},Matrix44.prototype.getRotation=function(t){return this.decompose(H.dummy,t,H.dummy),t},Matrix44.prototype.rotate=function(t){return this.multiply(Matrix44.dummy.setRotation(t))},Matrix44.prototype.makeLookAt=function(t,e){var r=rt.dummy,n=rt.dummy2,i=rt.dummy3;i.copy(t).normalize(),r.crossVectors(e,i),0===r.lengthSq&&(i.z+=1e-4,r.crossVectors(e,i)),r.normalize(),n.crossVectors(i,r);var o=this.data;return o[0]=r.x,o[4]=r.y,o[8]=r.z,o[12]=0,o[1]=n.x,o[5]=n.y,o[9]=n.z,o[13]=0,o[2]=i.x,o[6]=i.y,o[10]=i.z,o[14]=0,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},Matrix44.prototype.setIdentity=function(){var t=this.data;return t[0]=1,t[4]=0,t[8]=0,t[12]=0,t[1]=0,t[5]=1,t[9]=0,t[13]=0,t[2]=0,t[6]=0,t[10]=1,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,this},Matrix44.prototype.set=function(t,e,r,n,i,o,a,s,c,u,l,p,f,h,d,y){var m=this.data;return m[0]=t,m[4]=e,m[8]=r,m[12]=n,m[1]=i,m[5]=o,m[9]=a,m[13]=s,m[2]=c,m[6]=u,m[10]=l,m[14]=p,m[3]=f,m[7]=h,m[11]=d,m[15]=y,this},Matrix44.prototype.toEuler=function(t){var e=this.data,r=e[0],n=(e[4],e[8]),i=e[1],o=e[5],a=e[9],s=e[2],c=(e[6],e[10]);return t.x=Math.asin(-K.clamp(a,-1,1)),Math.abs(a)<.99999?(t.y=Math.atan2(n,c),t.z=Math.atan2(i,o)):(t.y=Math.atan2(-s,r),t.z=0),t},Matrix44.prototype.scale=function(t){return this.scaleFromCoords(t.x,t.y,t.z)},Matrix44.prototype.scaleFromCoords=function(t,e,r){var n=this.data;return n[0]*=t,n[4]*=e,n[8]*=r,n[1]*=t,n[5]*=e,n[9]*=r,n[2]*=t,n[6]*=e,n[10]*=r,n[3]*=t,n[7]*=e,n[11]*=r,this},Matrix44.prototype.setPosition=function(t){return this.setPositionFromCoords(t.x,t.y,t.z)},Matrix44.prototype.getPosition=function(t){var e=this.data;t.x=e[12],t.y=e[13],t.z=e[14]},Matrix44.prototype.setPositionFromCoords=function(t,e,r){var n=this.data;return n[12]=t,n[13]=e,n[14]=r,this},Matrix44.prototype.translate=function(t){return this.translateFromCoords(t.x,t.y,t.z)},Matrix44.prototype.translateFromCoords=function(t,e,r){var n=this.data;return n[12]+=t,n[13]+=e,n[14]+=r,this},Matrix44.prototype.compose=function(t,e,r){return this.setRotation(e),this.scale(r),this.setPosition(t),this},Matrix44.prototype.decompose=function(t,e,r){var n=rt.dummy,i=Matrix44.dummy,o=this.data,a=n.set(o[0],o[1],o[2]).length,s=n.set(o[4],o[5],o[6]).length,c=n.set(o[8],o[9],o[10]).length;this.determinant()<0&&(a=-a),t.x=o[12],t.y=o[13],t.z=o[14],this.copy.call(i,this);var u=1/(a||K.EPSILON),l=1/(s||K.EPSILON),p=1/(c||K.EPSILON);return i.data[0]*=u,i.data[1]*=u,i.data[2]*=u,i.data[4]*=l,i.data[5]*=l,i.data[6]*=l,i.data[8]*=p,i.data[9]*=p,i.data[10]*=p,e.setFromMatrix(i),r.x=a,r.y=s,r.z=c,this},Matrix44.prototype.determinant=function(){var t=this.data,e=t[0],r=t[4],n=t[8],i=t[12],o=t[1],a=t[5],s=t[9],c=t[13],u=t[2],l=t[6],p=t[10],f=t[14];return t[3]*(+i*s*l-n*c*l-i*a*p+r*c*p+n*a*f-r*s*f)+t[7]*(+e*s*f-e*c*p+i*o*p-n*o*f+n*c*u-i*s*u)+t[11]*(+e*c*l-e*a*f-i*o*l+r*o*f+i*a*u-r*c*u)+t[15]*(-n*a*u-e*s*l+e*a*p+n*o*l-r*o*p+r*s*u)},Matrix44.prototype.transpose=function(){var t,e=this.data;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},Matrix44.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},Matrix44.prototype.multiplyMatrices=function(t,e){var r=t.data,n=e.data,i=this.data,o=r[0],a=r[4],s=r[8],c=r[12],u=r[1],l=r[5],p=r[9],f=r[13],h=r[2],d=r[6],y=r[10],m=r[14],v=r[3],g=r[7],_=r[11],b=r[15],w=n[0],P=n[4],x=n[8],O=n[12],C=n[1],S=n[5],R=n[9],j=n[13],T=n[2],E=n[6],B=n[10],A=n[14],I=n[3],M=n[7],k=n[11],z=n[15];return i[0]=o*w+a*C+s*T+c*I,i[4]=o*P+a*S+s*E+c*M,i[8]=o*x+a*R+s*B+c*k,i[12]=o*O+a*j+s*A+c*z,i[1]=u*w+l*C+p*T+f*I,i[5]=u*P+l*S+p*E+f*M,i[9]=u*x+l*R+p*B+f*k,i[13]=u*O+l*j+p*A+f*z,i[2]=h*w+d*C+y*T+m*I,i[6]=h*P+d*S+y*E+m*M,i[10]=h*x+d*R+y*B+m*k,i[14]=h*O+d*j+y*A+m*z,i[3]=v*w+g*C+_*T+b*I,i[7]=v*P+g*S+_*E+b*M,i[11]=v*x+g*R+_*B+b*k,i[15]=v*O+g*j+_*A+b*z,this},Matrix44.prototype.invert=function(){return this.getInverse(this)},Matrix44.prototype.getInverse=function(t){var e=this.data,r=t.data,n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],c=r[5],u=r[6],l=r[7],p=r[8],f=r[9],h=r[10],d=r[11],y=r[12],m=r[13],v=r[14],g=r[15],_=f*v*l-m*h*l+m*u*d-c*v*d-f*u*g+c*h*g,b=y*h*l-p*v*l-y*u*d+s*v*d+p*u*g-s*h*g,w=p*m*l-y*f*l+y*c*d-s*m*d-p*c*g+s*f*g,P=y*f*u-p*m*u-y*c*h+s*m*h+p*c*v-s*f*v,x=n*_+i*b+o*w+a*P;if(0===x)return this.setIdentity();var O=1/x;return e[0]=_*O,e[1]=(m*h*a-f*v*a-m*o*d+i*v*d+f*o*g-i*h*g)*O,e[2]=(c*v*a-m*u*a+m*o*l-i*v*l-c*o*g+i*u*g)*O,e[3]=(f*u*a-c*h*a-f*o*l+i*h*l+c*o*d-i*u*d)*O,e[4]=b*O,e[5]=(p*v*a-y*h*a+y*o*d-n*v*d-p*o*g+n*h*g)*O,e[6]=(y*u*a-s*v*a-y*o*l+n*v*l+s*o*g-n*u*g)*O,e[7]=(s*h*a-p*u*a+p*o*l-n*h*l-s*o*d+n*u*d)*O,e[8]=w*O,e[9]=(y*f*a-p*m*a-y*i*d+n*m*d+p*i*g-n*f*g)*O,e[10]=(s*m*a-y*c*a+y*i*l-n*m*l-s*i*g+n*c*g)*O,e[11]=(p*c*a-s*f*a-p*i*l+n*f*l+s*i*d-n*c*d)*O,e[12]=P*O,e[13]=(p*m*o-y*f*o+y*i*h-n*m*h-p*i*v+n*f*v)*O,e[14]=(y*c*o-s*m*o-y*i*u+n*m*u+s*i*v-n*c*v)*O,e[15]=(s*f*o-p*c*o+p*i*u-n*f*u-s*i*h+n*c*h)*O,this},Matrix44.prototype.getScale=function(t){var e=this.data,r=t.set(e[0],e[1],e[2]).length,n=t.set(e[4],e[5],e[6]).length,i=t.set(e[8],e[9],e[10]).length;return t.set(r,n,i)},Matrix44.prototype.extractRotation=function(t){var e=this.data,r=t.data,n=rt.dummy,i=1/n.setFromMatrixColumn(t,0).length,o=1/n.setFromMatrixColumn(t,1).length,a=1/n.setFromMatrixColumn(t,2).length;return e[0]=r[0]*i,e[1]=r[1]*i,e[2]=r[2]*i,e[3]=0,e[4]=r[4]*o,e[5]=r[5]*o,e[6]=r[6]*o,e[7]=0,e[8]=r[8]*a,e[9]=r[9]*a,e[10]=r[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},Matrix44.prototype.copyPosition=function(t){var e=this.data,r=t.data;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this},Matrix44.prototype.copy=function(t){var e=this.data,r=t.data;return e[0]=r[0],e[4]=r[4],e[8]=r[8],e[12]=r[12],e[1]=r[1],e[5]=r[5],e[9]=r[9],e[13]=r[13],e[2]=r[2],e[6]=r[6],e[10]=r[10],e[14]=r[14],e[3]=r[3],e[7]=r[7],e[11]=r[11],e[15]=r[15],this},Matrix44.prototype.toArray=function(t,e){var r=this.data;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t},Matrix44.identity=new Matrix44,Matrix44.dummy=new Matrix44,Matrix44.pool=new G(Matrix44,64),Matrix44}();(at||(at={})).dummy=new st;var ct,ut=function(){function Quaternion(t,e,r,n){this._x=t||0,this._y=e||0,this._z=r||0,this._w=n||1}return Object.defineProperty(Quaternion.prototype,"length",{get:function(){return Math.sqrt(this.lengthSq)},enumerable:!0,configurable:!0}),Object.defineProperty(Quaternion.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},enumerable:!0,configurable:!0}),Object.defineProperty(Quaternion.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!0,configurable:!0}),Object.defineProperty(Quaternion.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!0,configurable:!0}),Object.defineProperty(Quaternion.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t},enumerable:!0,configurable:!0}),Object.defineProperty(Quaternion.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t},enumerable:!0,configurable:!0}),Quaternion.fromPool=function(){return Quaternion.pool.get()},Quaternion.fromEulerAngles=function(t,e,r,n){return void 0===n&&(n="YXZ"),(new Quaternion).setFromEulerAngles(t,e,r,n)},Quaternion.fromAxisAngle=function(t,e){return(new Quaternion).setFromAxisAngle(t,e)},Quaternion.prototype.set=function(t,e,r,n){this._x=t,this._y=e,this._z=r,this.w=n},Quaternion.prototype.setFromAxisAngle=function(t,e){var r=e/2,n=Math.sin(r);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(r),this.normalize()},Quaternion.prototype.setFromEulerAngles=function(t,e,r,n){void 0===n&&(n="YXZ");var i=Math.cos(t/2),o=Math.cos(e/2),a=Math.cos(r/2),s=Math.sin(t/2),c=Math.sin(e/2),u=Math.sin(r/2);return"YXZ"===n?(this._x=s*o*a+i*c*u,this._y=i*c*a-s*o*u,this._z=i*o*u-s*c*a,this._w=i*o*a+s*c*u):"ZYX"===n?(this._x=s*o*a-i*c*u,this._y=i*c*a+s*o*u,this._z=i*o*u-s*c*a,this._w=i*o*a+s*c*u):"XYZ"===n?(this._x=s*o*a+i*c*u,this._y=i*c*a-s*o*u,this._z=i*o*u+s*c*a,this._w=i*o*a-s*c*u):"ZXY"===n?(this._x=s*o*a-i*c*u,this._y=i*c*a+s*o*u,this._z=i*o*u+s*c*a,this._w=i*o*a-s*c*u):"YZX"===n?(this._x=s*o*a+i*c*u,this._y=i*c*a+s*o*u,this._z=i*o*u-s*c*a,this._w=i*o*a-s*c*u):"XZY"===n&&(this._x=s*o*a-i*c*u,this._y=i*c*a-s*o*u,this._z=i*o*u+s*c*a,this._w=i*o*a+s*c*u),this.normalize()},Quaternion.prototype.setFromEulerVector=function(t){return this.setFromEulerAngles(t.x,t.y,t.z)},Quaternion.prototype.setFromUnitVectors=function(t,e){var r=H.dummy,n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?r.set(-t.y,t.x,0):r.set(0,-t.z,t.y)):r.crossVectors(t,e),this._x=r.x,this._y=r.y,this._z=r.z,this._w=n,this.normalize()},Quaternion.prototype.setFromMatrix=function(t){var e,r=t.data,n=r[0],i=r[4],o=r[8],a=r[1],s=r[5],c=r[9],u=r[2],l=r[6],p=r[10],f=n+s+p;return f>0?(e=.5/Math.sqrt(f+1),this._w=.25/e,this._x=(l-c)*e,this._y=(o-u)*e,this.z=(a-i)*e):n>s&&n>p?(e=2*Math.sqrt(1+n-s-p),this._w=(l-c)/e,this._x=.25*e,this._y=(i+a)/e,this.z=(o+u)/e):s>p?(e=2*Math.sqrt(1+s-n-p),this._w=(o-u)/e,this._x=(i+a)/e,this._y=.25*e,this.z=(c+l)/e):(e=2*Math.sqrt(1+p-n-s),this._w=(a-i)/e,this._x=(o+u)/e,this._y=(c+l)/e,this.z=.25*e),this.normalize()},Quaternion.prototype.lookAt=function(t,e){var r=at.dummy;return r.makeLookAt(t,e).transpose(),this.setFromMatrix(r)},Quaternion.prototype.normalize=function(){var t=this.length;return t<Number.EPSILON?(this._x=0,this._y=0,this._z=0,this.w=1):(t=1/t,this._x*=t,this._y*=t,this._z*=t,this.w*=t),this},Quaternion.prototype.multiply=function(t){return this.multiplyQuaternions(this,t)},Quaternion.prototype.multiplyQuaternions=function(t,e){var r=e.x,n=e.y,i=e.z,o=e.w,a=t.x,s=t.y,c=t.z,u=t.w;return this._x=r*u+o*a+n*c-i*s,this._y=n*u+o*s+i*a-r*c,this._z=i*u+o*c+r*s-n*a,this.w=o*u-r*a-n*s-i*c,this},Quaternion.prototype.toEuler=function(t){return at.dummy.setRotation(this).toEuler(t)},Quaternion.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},Quaternion.prototype.copy=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this.w=t.w,this},Quaternion.prototype.invert=function(){return this.conjugate()},Quaternion.prototype.getInverse=function(t){return t.copy(this).invert()},Quaternion.prototype.conjugate=function(){return this._x*=-1,this._y*=-1,this.z*=-1,this},Quaternion.prototype.slerpQuaternions=function(t,e,r){return this.copy(t).slerp(e,r)},Quaternion.prototype.slerp=function(t,e){if(0===e)return this;if(1===e)return this.copy(t);var r=this.x,n=this.y,i=this.z,o=this.w,a=o*t.w+r*t.x+n*t.y+i*t.z;if(a<0?(this._w=-t.w,this._x=-t.x,this._y=-t.y,this._z=-t.z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=r,this._y=n,this.z=i,this;var s=Math.sqrt(1-a*a);if(Math.abs(s)<.001)return this._w=.5*(o+this.w),this._x=.5*(r+this.x),this._y=.5*(n+this.y),this.z=.5*(i+this.z),this;var c=Math.atan2(s,a),u=Math.sin((1-e)*c)/s,l=Math.sin(e*c)/s;return this._w=o*u+this.w*l,this._x=r*u+this.x*l,this._y=n*u+this.y*l,this.z=i*u+this.z*l,this},Quaternion.identity=new Quaternion,Quaternion.dummy=new Quaternion,Quaternion.pool=new G(Quaternion,64),Quaternion}(),lt=function(){function Matrix33(t){this.data=t||[1,0,0,0,1,0,0,0,1]}return Matrix33.fromPool=function(){return Matrix33.pool.get()},Matrix33.prototype.setIdentity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},Matrix33.prototype.set=function(t,e,r,n,i,o,a,s,c){var u=this.data;return u[0]=t,u[3]=e,u[6]=r,u[1]=n,u[4]=i,u[7]=o,u[2]=a,u[5]=s,u[8]=c,this},Matrix33.prototype.setFromMatrix4=function(t){var e=t.data;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},Matrix33.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},Matrix33.prototype.multiplyMatrices=function(t,e){var r=t.data,n=e.data,i=this.data,o=r[0],a=r[3],s=r[6],c=r[1],u=r[4],l=r[7],p=r[2],f=r[5],h=r[8],d=n[0],y=n[3],m=n[6],v=n[1],g=n[4],_=n[7],b=n[2],w=n[5],P=n[8];return i[0]=o*d+a*v+s*b,i[3]=o*y+a*g+s*w,i[6]=o*m+a*_+s*P,i[1]=c*d+u*v+l*b,i[4]=c*y+u*g+l*w,i[7]=c*m+u*_+l*P,i[2]=p*d+f*v+h*b,i[5]=p*y+f*g+h*w,i[8]=p*m+f*_+h*P,this},Matrix33.prototype.multiplyScalar=function(t){var e=this.data;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this},Matrix33.prototype.determinant=function(){var t=this.data,e=t[0],r=t[1],n=t[2],i=t[3],o=t[4],a=t[5],s=t[6],c=t[7],u=t[8];return e*o*u-e*a*c-r*i*u+r*a*s+n*i*c-n*o*s},Matrix33.prototype.getInverse=function(t){var e=t.data,r=this.data,n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],c=e[5],u=e[6],l=e[7],p=e[8],f=p*s-c*l,h=c*u-p*a,d=l*a-s*u,y=n*f+i*h+o*d;if(0===y)return this.setIdentity();var m=1/y;return r[0]=f*m,r[1]=(o*l-p*i)*m,r[2]=(c*i-o*s)*m,r[3]=h*m,r[4]=(p*n-o*u)*m,r[5]=(o*a-c*n)*m,r[6]=d*m,r[7]=(i*u-l*n)*m,r[8]=(s*n-i*a)*m,this},Matrix33.prototype.transpose=function(){var t,e=this.data;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},Matrix33.prototype.getNormalMatrix=function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},Matrix33.prototype.scale=function(t,e){var r=this.data;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=e,r[4]*=e,r[7]*=e,this},Matrix33.prototype.rotate=function(t){var e=Math.cos(t),r=Math.sin(t),n=this.data,i=n[0],o=n[3],a=n[6],s=n[1],c=n[4],u=n[7];return n[0]=e*i+r*s,n[3]=e*o+r*c,n[6]=e*a+r*u,n[1]=-r*i+e*s,n[4]=-r*o+e*c,n[7]=-r*a+e*u,this},Matrix33.prototype.translate=function(t,e){var r=this.data;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=e*r[2],r[4]+=e*r[5],r[7]+=e*r[8],this},Matrix33.identity=new Matrix33,Matrix33.pool=new G(Matrix33,8),Matrix33}(),pt=function(){function AABB(t,e){this.min=t||new H,this.max=e||new H}return AABB.fromVertexArray=function(t,e,r){var n=new AABB;if("TRIANGLES"===e){n.min.copy(H.one).multiply(999999),n.max.copy(H.one).multiply(-999999);for(var i=0;i<t.length;i+=3)n.min.x>t[i]&&(n.min.x=t[i]),n.max.x<t[i]&&(n.max.x=t[i]),n.min.y>t[i+1]&&(n.min.y=t[i+1]),n.max.y<t[i+1]&&(n.max.y=t[i+1]),n.min.z>t[i+2]&&(n.min.z=t[i+2]),n.max.z<t[i+2]&&(n.max.z=t[i+2])}return n},AABB.prototype.set=function(t,e){return this.min.copy(t),this.max.copy(e),this},AABB.prototype.contains=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},AABB}(),ft=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},ht=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Auto=0]="Auto",t[t.Relative=1]="Relative",t[t.Absolute=2]="Absolute"}(ct||(ct={}));var dt,yt=function(){function UISizeTypeMetadata(){}return UISizeTypeMetadata.literals={Auto:0,Relative:1,Absolute:2},UISizeTypeMetadata}(),mt=function(){function UISize(t,e){this.type=ct.Auto,this.value=256,void 0!==t&&(this.type=t),void 0!==e&&(this.value=e)}return ft([Attributes_enumLiterals(yt.literals),ht("design:type",Object)],UISize.prototype,"type",void 0),UISize}();dt||(dt={});var vt,gt=function(){function WebGL(){}return Object.defineProperty(WebGL,"context",{get:function(){return dt.context},enumerable:!0,configurable:!0}),WebGL.create=function(t){t.enable(t.DEPTH_TEST),t.clearDepth(1),t.depthFunc(t.LEQUAL),t.frontFace(t.CCW),WebGL.primitiveTypes={POINTS:t.POINTS,LINE_STRIP:t.LINE_STRIP,LINE_LOOP:t.LINE_LOOP,LINES:t.LINES,TRIANGLE_STRIP:t.TRIANGLE_STRIP,TRIANGLE_FAN:t.TRIANGLE_FAN,TRIANGLES:t.TRIANGLES};for(var e=0,r=Object.keys(this.extensions);e<r.length;e++){var n=r[e];this.extensions[n]=null!==t.getExtension(n)}console.assert(this.extensions.OES_texture_float,"OES_texture_float extension is required for skinning."),console.assert(this.extensions.OES_standard_derivatives,"OES_standard_derivatives not supported, required for enhanced wireframe visualization."),WebGL.caps.maxVertexUniforms=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),dt.context=t},WebGL.do=function(t){var e=t(),r=dt.context.getError();return r&&V.log("WebGL error '"+r+"'"),e},WebGL.extensions={OES_texture_float:!1,OES_standard_derivatives:!1},WebGL.caps={maxVertexUniforms:0},WebGL}();vt||(vt={});var _t,bt=function(){function IRendererInternal(){}return Object.defineProperty(IRendererInternal,"instance",{get:function(){return vt.instance},set:function(t){vt.instance=t},enumerable:!0,configurable:!0}),IRendererInternal}();_t||(_t={});var wt,Pt=function(){function IFileInternal(){}return Object.defineProperty(IFileInternal,"instance",{get:function(){return _t.instance},set:function(t){_t.instance=t},enumerable:!0,configurable:!0}),IFileInternal}(),xt=function(){function Interfaces(){}return Object.defineProperty(Interfaces,"renderer",{get:function(){return bt.instance},enumerable:!0,configurable:!0}),Object.defineProperty(Interfaces,"factory",{get:function(){return x.instance},enumerable:!0,configurable:!0}),Object.defineProperty(Interfaces,"file",{get:function(){return Pt.instance},enumerable:!0,configurable:!0}),Object.defineProperty(Interfaces,"serializer",{get:function(){return w.instance},enumerable:!0,configurable:!0}),Object.defineProperty(Interfaces,"objectManager",{get:function(){return I.instance},enumerable:!0,configurable:!0}),Interfaces}(),Ot=function(){function VertexBuffer(){this._data={},this._vertexCount=0,this._metaData={},this._isLoaded=!1,this._isDynamic=!1,this._id=S.makeUniqueId()}return Object.defineProperty(VertexBuffer.prototype,"vertexCount",{get:function(){return this._vertexCount},set:function(t){this._vertexCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"primitiveType",{get:function(){return this._primitiveType},set:function(t){this._primitiveType=t},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"isDynamic",{get:function(){return this._isDynamic},set:function(t){this._isDynamic=t},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"indices",{get:function(){return this._indices},set:function(t){this._indices=t,t?this._indicesMetaData={glBuffer:null,isDirty:!0}:delete this._indicesMetaData},enumerable:!0,configurable:!0}),VertexBuffer.prototype.copy=function(){return xt.serializer.copyVertexBuffer(this)},VertexBuffer.prototype.setData=function(t,e){this._data[t]=e,this._metaData[t]={glBuffer:null,isDirty:!0},"position"===t&&(this._vertexCount=e.length/3)},VertexBuffer.prototype.getData=function(t){return this._data[t]},VertexBuffer.prototype.dirtifyData=function(t){t in this._metaData?(this._metaData[t].isDirty=!0,"position"===t&&xt.renderer.showWireFrame&&this.loadBarycentricCoords(gt.context)):V.log("Attribute '"+t+"' not found on Vertex Buffer'")},VertexBuffer.prototype.updateBufferDatas=function(t){for(var e=0,r=Object.keys(this._metaData);e<r.length;e++){var n=r[e];this.updateBufferDataIfNecessary(t,n)}},VertexBuffer.prototype.begin=function(t,e){this.bindBuffers(t),this.bindAttributes(t,e.getAttributes())},VertexBuffer.prototype.bindBuffers=function(t){if(this._isLoaded){var e=xt.renderer.showWireFrame;e!==this.hasBarycentricCoords()&&(e?this.loadBarycentricCoords(t):(t.deleteBuffer(this._metaData.barycentricCoord.glBuffer),delete this._data.barycentricCoord,delete this._metaData.barycentricCoord))}else this.load(t),xt.renderer.showWireFrame&&this.loadBarycentricCoords(t),this._isLoaded=!0;this._indicesMetaData&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indicesMetaData.glBuffer)},VertexBuffer.prototype.end=function(t,e){this.unbindAttributes(t,e.getAttributes())},VertexBuffer.prototype.draw=function(t){if(0!==this._vertexCount){var e=gt.primitiveTypes[this._primitiveType];this._indices?t.drawElements(e,this._indices.length,t.UNSIGNED_SHORT,0):t.drawArrays(e,0,this._vertexCount)}},VertexBuffer.prototype.load=function(t){for(var e=0,r=Object.keys(this._data);e<r.length;e++){var n=r[e];(i=t.createBuffer())&&(t.bindBuffer(t.ARRAY_BUFFER,i),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this._data[n]),this._isDynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW),this._metaData[n].glBuffer=i,this._metaData[n].isDirty=!1)}var i;if(this._indices&&(i=t.createBuffer())){var o=this._indicesMetaData;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this._indices),t.STATIC_DRAW),o.glBuffer=i,o.isDirty=!1}},VertexBuffer.prototype.unload=function(t){if(this._isLoaded){for(var e=0,r=Object.keys(this._data);e<r.length;e++){var n=r[e];this._metaData[n].glBuffer&&(t.deleteBuffer(this._metaData[n].glBuffer),this._metaData[n].glBuffer=null)}if(this._indices){var i=this._indicesMetaData;i.glBuffer&&(t.deleteBuffer(i.glBuffer),i.glBuffer=null)}this._isLoaded=!1}},VertexBuffer.prototype.bindAttributes=function(t,e){for(var r=0,n=Object.keys(this._metaData);r<n.length;r++){var i=n[r];if(i in e){var o=e[i].location;this._metaData[i].glBuffer&&o>=0&&(this.updateBufferDataIfNecessary(t,i)||t.bindBuffer(t.ARRAY_BUFFER,this._metaData[i].glBuffer),t.enableVertexAttribArray(o),t.vertexAttribPointer(o,e[i].componentCount,t.FLOAT,!1,0,0))}}},VertexBuffer.prototype.unbindAttributes=function(t,e){for(var r=0,n=Object.keys(this._metaData);r<n.length;r++){var i=n[r];if(i in e){var o=e[i].location;o>=0&&t.disableVertexAttribArray(o)}}},VertexBuffer.prototype.hasAttribute=function(t){return t in this._metaData},VertexBuffer.prototype.updateBufferDataIfNecessary=function(t,e){return!!this._metaData[e].isDirty&&(t.bindBuffer(t.ARRAY_BUFFER,this._metaData[e].glBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this._data[e]),this._isDynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW),this._metaData[e].isDirty=!1,!0)},VertexBuffer.prototype.loadBarycentricCoords=function(t){if("position"in this._data&&"TRIANGLES"===this.primitiveType){var e=this.hasBarycentricCoords(),r=e?this._data.barycentricCoord:[];if(r.length=this._data.position.length,this._indices);else for(var n=r.length/9,i=0;i<n;++i){var o=9*i;r[o+0]=1,r[o+1]=0,r[o+2]=0,r[o+3]=0,r[o+4]=1,r[o+5]=0,r[o+6]=0,r[o+7]=0,r[o+8]=1}if(e)this.dirtifyData("barycentricCoord");else{this.setData("barycentricCoord",r);var a=t.createBuffer();a&&(t.bindBuffer(t.ARRAY_BUFFER,a),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this._data.barycentricCoord),this._isDynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW),this._metaData.barycentricCoord.glBuffer=a,this._metaData.barycentricCoord.isDirty=!1)}}},VertexBuffer.prototype.hasBarycentricCoords=function(){return"barycentricCoord"in this._data},VertexBuffer}(),Ct=function(){function Rect(t,e,r,n){this.left=t||0,this.top=e||0,this.right=r||0,this.bottom=n||0}return Rect.prototype.set=function(t,e,r,n){this.left=t,this.top=e,this.right=r,this.bottom=n},Rect}(),St=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Rt=function(t){function ArrayProperty(e,r){var n=t.call(this)||this;return n.grow=function(t){return n.data.push(t||new e)},n.typeName=function(){return e.name},n.getData=function(){return n.data},n.data=r||[],n}return St(ArrayProperty,t),ArrayProperty.prototype.clear=function(){this.data.length=0},ArrayProperty}(function(){return function IArrayProperty(){}}()),jt=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Tt=function(t){function ReferenceArray(e,r){var n=t.call(this)||this;return n.grow=function(t){return n.data.push(new a(e,t))},n.typeName=function(){return e.name},n.getData=function(){return n.data},n.data=r||[],n._clone=function(){for(var t=new ReferenceArray(e),r=0,i=n.data;r<i.length;r++){var o=i[r];o.instance&&t.grow(o.instance.copy())}return t},n}return jt(ReferenceArray,t),ReferenceArray.prototype.get=function(t){return this.data[t].instance},ReferenceArray.prototype.copy=function(){return this._clone()},ReferenceArray.prototype.clear=function(){this.data.length=0},ReferenceArray}(function(){return function ReferenceArrayBase(){}}()),Et=function(){return function FileProperty(t,e,r){this.format=t,this.fileName=r,this.data=e}}(),Bt=function(){return function ThumbnailProperty(t){this.data=t}}(),At=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),It=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Mt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},kt=function(t){function Component(){var e=null!==t&&t.apply(this,arguments)||this;return e._id=S.makeUniqueId(),e._active=!0,e}return At(Component,t),Object.defineProperty(Component.prototype,"parent",{get:function(){return this._entity.parent},enumerable:!0,configurable:!0}),Object.defineProperty(Component.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),Object.defineProperty(Component.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),Object.defineProperty(Component.prototype,"active",{get:function(){return this._active},set:function(t){this._active=t},enumerable:!0,configurable:!0}),Component.prototype.setEntity=function(t){this._entity=t},Component.prototype.isLoaded=function(){return S.isObjectLoaded(this)},Component.prototype.reset=function(){var t=this.constructor.name,e=x.instance.createObject(t);Vc.setComponentFromInstance(this.entity,e)},It([Attributes_hidden(),unserializable(),Mt("design:type",Component)],Component.prototype,"controller",void 0),It([Attributes_hidden(),unserializable(),Mt("design:type",Xc)],Component.prototype,"_entity",void 0),It([unserializable(),Mt("design:type",Object)],Component.prototype,"_id",void 0),It([Attributes_hidden(),Mt("design:type",Object)],Component.prototype,"_active",void 0),Component}(O),zt=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ft=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Dt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.positionKey="_position",t.rotationKey="_rotation",t.scaleKey="_scale",t.xKey="_x",t.yKey="_y",t.zKey="_z",t.wKey="_w"}(wt||(wt={}));var Nt,Lt=function(t){function Transform(e){var r=t.call(this)||this;return r.changed=new B.VoidSyncEvent,r._position=new H,r._rotation=new ut,r._scale=new H(1,1,1),r._worldMatrix=new st,r._invWorldMatrix=new st,r._worldMatrixDirty=!0,r._invWorldMatrixDirty=!0,r._localMatrix=new st,r._localMatrixDirty=!0,r._disableDirtification=!1,e&&r.setState(e),r.attachToPosition(),r.attachToRotation(),r.attachToScale(),r}return zt(Transform,t),Object.defineProperty(Transform.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"position",{get:function(){return this._position},set:function(t){this._position.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"localMatrix",{get:function(){return this._localMatrixDirty&&(this._localMatrix.compose(this._position,this._rotation,this._scale),this._localMatrixDirty=!1),this._localMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldMatrix",{get:function(){if(this._worldMatrixDirty){this._worldMatrix.copy(this.localMatrix);var t=this.entity.parent?this.entity.parent.transform:void 0;t&&this._worldMatrix.multiplyMatrices(t.worldMatrix,this._worldMatrix),this._worldMatrixDirty=!1}return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"invWorldMatrix",{get:function(){return this._invWorldMatrixDirty&&(this._invWorldMatrix.getInverse(this.worldMatrix),this._invWorldMatrixDirty=!1),this._invWorldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldRight",{get:function(){return this.worldMatrix.decompose(H.dummy,ut.dummy,H.dummy),H.fromPool().copy(H.right).rotate(ut.dummy).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldForward",{get:function(){return this.worldMatrix.decompose(H.dummy,ut.dummy,H.dummy),H.fromPool().copy(H.forward).rotate(ut.dummy).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldUp",{get:function(){return this.worldMatrix.decompose(H.dummy,ut.dummy,H.dummy),H.fromPool().copy(H.up).rotate(ut.dummy).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"right",{get:function(){return H.fromPool().copy(H.right).rotate(this.rotation).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"forward",{get:function(){return H.fromPool().copy(H.forward).rotate(this.rotation).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"up",{get:function(){return H.fromPool().copy(H.up).rotate(this.rotation).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldPosition",{get:function(){return H.fromPool().setFromMatrix(this.worldMatrix)},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldRotation",{get:function(){return this.worldMatrix.getRotation(ut.fromPool())},enumerable:!0,configurable:!0}),Object.defineProperty(Transform.prototype,"worldScale",{get:function(){return this.worldMatrix.getScale(H.fromPool())},enumerable:!0,configurable:!0}),Transform.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r),e===wt.positionKey?(this.attachToPosition(),this.dirtifyWorldMatrix()):e===wt.rotationKey?(this.attachToRotation(),this.dirtifyWorldMatrix()):e===wt.scaleKey&&(this.attachToScale(),this.dirtifyWorldMatrix())},Transform.prototype.translate=function(t){this.position.add(t)},Transform.prototype.upgrade=function(t,e){var r;return 1===e&&(Object.assign(t.properties,((r={})[wt.positionKey]=t.properties.position,r[wt.rotationKey]=t.properties.rotation,r[wt.scaleKey]=t.properties.scale,r)),delete t.properties.position,delete t.properties.rotation,delete t.properties.scale),t},Transform.prototype.worldToLocal=function(t,e){return e.copy(t).transform(this.invWorldMatrix)},Transform.prototype.localToWorld=function(t,e){return e.copy(t).transform(this.worldMatrix)},Transform.prototype.worldToLocalDirection=function(t,e){return ot.fromPool().set(t.x,t.y,t.z,0).transform(this.invWorldMatrix).getVec3(e)},Transform.prototype.worldToLocalRotation=function(t,e){return e.copy(t).multiply(ut.dummy.setFromMatrix(this.invWorldMatrix))},Transform.prototype.dirtifyWorldMatrix=function(){this._disableDirtification||(this._localMatrixDirty=!0,this._worldMatrixDirty=!0,this._invWorldMatrixDirty=!0,this.entity&&this.entity.traverse(function(t){var e=t.transform;return!!e&&(e._worldMatrixDirty=!0,e._invWorldMatrixDirty=!0,e.changed.post(),!0)}),this.changed.post())},Transform.prototype.setLocalMatrix=function(t){this._localMatrix.copy(t),this._localMatrix.decompose(this._position,this._rotation,this._scale),this._localMatrixDirty=!1,this._worldMatrixDirty=!0},Transform.prototype.reset=function(){this._disableDirtification=!0,this._position.copy(H.zero),this._rotation.copy(ut.identity),this._scale.copy(H.one),this._disableDirtification=!1,this.dirtifyWorldMatrix()},Transform.prototype.attachToPosition=function(){var t=this;Object.defineProperty(this._position,"x",{set:function(e){t._position[wt.xKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._position[wt.xKey]}}),Object.defineProperty(this._position,"y",{set:function(e){t._position[wt.yKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._position[wt.yKey]}}),Object.defineProperty(this._position,"z",{set:function(e){t._position[wt.zKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._position[wt.zKey]}})},Transform.prototype.attachToScale=function(){var t=this;Object.defineProperty(this._scale,"x",{set:function(e){t._scale[wt.xKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._scale[wt.xKey]}}),Object.defineProperty(this._scale,"y",{set:function(e){t._scale[wt.yKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._scale[wt.yKey]}}),Object.defineProperty(this._scale,"z",{set:function(e){t._scale[wt.zKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._scale[wt.zKey]}})},Transform.prototype.attachToRotation=function(){var t=this;Object.defineProperty(this._rotation,"x",{set:function(e){t._rotation[wt.xKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._rotation[wt.xKey]}}),Object.defineProperty(this._rotation,"y",{set:function(e){t._rotation[wt.yKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._rotation[wt.yKey]}}),Object.defineProperty(this._rotation,"z",{set:function(e){t._rotation[wt.zKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._rotation[wt.zKey]}}),Object.defineProperty(this._rotation,"w",{set:function(e){t._rotation[wt.wKey]=e,t.dirtifyWorldMatrix()},get:function(){return t._rotation[wt.wKey]}})},Ft([unserializable(),Dt("design:type",Object)],Transform.prototype,"changed",void 0),Ft([unserializable(),Dt("design:type",Object)],Transform.prototype,"_worldMatrix",void 0),Ft([unserializable(),Dt("design:type",Object)],Transform.prototype,"_invWorldMatrix",void 0),Ft([unserializable(),Dt("design:type",Object)],Transform.prototype,"_worldMatrixDirty",void 0),Ft([unserializable(),Dt("design:type",Object)],Transform.prototype,"_invWorldMatrixDirty",void 0),Ft([unserializable(),Dt("design:type",Object)],Transform.prototype,"_localMatrix",void 0),Ft([unserializable(),Dt("design:type",Object)],Transform.prototype,"_localMatrixDirty",void 0),Ft([unserializable(),Dt("design:type",Object)],Transform.prototype,"_disableDirtification",void 0),Transform=Ft([mandatory(),sortOrder(0),Dt("design:paramtypes",[Object])],Transform)}(kt);(Nt||(Nt={})).defaultPRS={position:H.zero,rotation:ut.identity,scale:H.one};var Vt,Ut=function(){function Entities(){}return Entities.create=function(t){var e,r=t?t.prefab:null;r?(e=r.root.copy()).name=r.name:e=new Xc;var n=t?t.prs:null;n&&e.setComponent(Lt,{position:n.position||Nt.defaultPRS.position,rotation:n.rotation||Nt.defaultPRS.rotation,scale:n.scale||Nt.defaultPRS.scale});var i=t?t.children:null;if(i)for(var o=0,a=i;o<a.length;o++){var s=a[o];e.addChild(Entities.create(s))}var c=Hc.list();return 0===c.length&&(lu.create(),console.assert(1===c.length)),c[c.length-1].root.addChild(e),Vc.collectEntityOperations&&Vc.entitiesJustCreated.push(e),e},Entities.find=function(t){for(var e=0,r=Hc.list();e<r.length;e++){var n=r[e];if(t===n.root.name)return n.root;var i=n.root.findChild(t);if(i)return i}return null},Entities.get=function(t){for(var e=0,r=Hc.list();e<r.length;e++){var n=r[e];if(t===n.root.id)return n.root;var i=n.root.findChildById(t);if(i)return i}return null},Entities}(),Wt=function(){function EntityReference(t){this._entity=null,this._resolved=!1,this._id=t,this._resolved=!1}return Object.defineProperty(EntityReference.prototype,"id",{get:function(){return this._id},set:function(t){t!==this._id&&(this._id=t,this._resolved=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(EntityReference.prototype,"entity",{get:function(){return this._id?(this._resolved||(this._entity=Ut.get(this._id),this._entity||V.log("A missing entity (id: '"+this._id+"') is still referenced by the scene."),this._resolved=!0),this._entity):null},set:function(t){t?(this._id=t.id,this._entity=t):(delete this._id,delete this._entity),this._resolved=!0},enumerable:!0,configurable:!0}),EntityReference}(),qt=function(){function ComponentReference(t,e){this._entity=null,this._resolved=!1,this._componentTypeName=t.name,this._entityId=e,this._resolved=!1}return Object.defineProperty(ComponentReference.prototype,"entityId",{get:function(){return this._entityId},set:function(t){t!==this._entityId&&(this._entityId=t,this._resolved=!1)},enumerable:!0,configurable:!0}),Object.defineProperty(ComponentReference.prototype,"componentTypeName",{get:function(){return this._componentTypeName},enumerable:!0,configurable:!0}),Object.defineProperty(ComponentReference.prototype,"component",{get:function(){return this._entityId?(this._resolved||(this._entity=Ut.get(this._entityId),this._entity||V.logWarning("A missing entity (id: '"+this._entityId+"') is still referenced by the scene"),this._resolved=!0),this._entity?Vc.getComponentByName(this._entity,this._componentTypeName):null):null},set:function(t){t?(this._componentTypeName=t.constructor.name,this._entity=t.entity,this._entityId=t.entity.id):(delete this._entity,delete this._entityId),this._resolved=!0},enumerable:!0,configurable:!0}),ComponentReference}(),Gt=function(){function Random(){}return Random.range=function(t,e){return K.lerp(t,e,Math.random())},Random.rangeInt=function(t,e){return Math.round(Random.range(t,e))},Random}(),Ht=function(){function Range(t,e){this.min=t||0,this.max=e||0}return Range.prototype.random=function(){return Gt.range(this.min,this.max)},Range}(),Xt=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Kt=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Absolute=0]="Absolute",t[t.Relative=1]="Relative"}(Vt||(Vt={}));var Qt,Yt=function(){function SizeTypeMetadata(){}return SizeTypeMetadata.literals={Absolute:0,Relative:1},SizeTypeMetadata}(),Zt=function(){function Size(t,e){this.type=void 0!==t?t:Vt.Relative,this.value=e||(this.type===Vt.Relative?1:1024)}return Size.prototype.equals=function(t){return this.value===t.value&&this.type===t.type},Xt([Attributes_enumLiterals(Yt.literals),Kt("design:type",Number)],Size.prototype,"type",void 0),Size}(),Jt=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},$t=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},te=void 0;(function(t){t[t.Loading=0]="Loading",t[t.Resolved=1]="Resolved"})(Qt||(Qt={}));var ee,re=function(){function AssetReference(t,e){this.assetChanged=new B.SyncEvent,this._asset=null,this._state=Qt.Resolved,this.typeName=function(){return t.name},this.onAssetDeleted=this.onAssetDeleted.bind(this),e&&(this._asset=e,this._id=e.id,this._state=Qt.Resolved)}return Object.defineProperty(AssetReference.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t,this._state=Qt.Loading},enumerable:!0,configurable:!0}),Object.defineProperty(AssetReference.prototype,"asset",{get:function(){return this._asset},set:function(t){var e=this._asset;this._asset=t,this._state=Qt.Resolved,this._id=t?t.templatePath:void 0,t!==e&&this.assetChanged.post({oldAsset:e,newAsset:t})},enumerable:!0,configurable:!0}),Object.defineProperty(AssetReference.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t},enumerable:!0,configurable:!0}),Object.defineProperty(AssetReference.prototype,"isResolved",{get:function(){return this._state===Qt.Resolved},enumerable:!0,configurable:!0}),AssetReference.prototype.clear=function(){this.asset=null},AssetReference.prototype.setAssetFast=function(t){this._asset=t},AssetReference.prototype.detach=function(){this._asset=null},AssetReference.prototype.onAssetDeleted=function(t){this.detach(),te&&te.assetReferenceCleared.post(t)},Jt([unserializable(),$t("design:type",Object)],AssetReference.prototype,"assetChanged",void 0),Jt([unserializable(),$t("design:type",Object)],AssetReference.prototype,"_asset",void 0),Jt([unserializable(),$t("design:type",Object)],AssetReference.prototype,"_state",void 0),AssetReference}(),ne=function(){function AssetReferenceArray(t,e){var r=this;this.grow=function(e){return r.data.push(new re(t,e))},this.typeName=function(){return t.name},this.data=e||[]}return AssetReferenceArray.prototype.detach=function(){for(var t=0,e=this.data;t<e.length;t++){e[t].detach()}},AssetReferenceArray}(),ie=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),oe=function(){function NativeArray(t,e){this._typeName=t,this.data=e||[]}return Object.defineProperty(NativeArray.prototype,"typeName",{get:function(){return this._typeName},enumerable:!0,configurable:!0}),NativeArray}(),ae=function(t){function NumberNativeArray(e){return t.call(this,"number",e)||this}return ie(NumberNativeArray,t),NumberNativeArray}(oe),se=function(t){function StringNativeArray(e){return t.call(this,"string",e)||this}return ie(StringNativeArray,t),StringNativeArray}(oe),ce=function(t){function BooleanNativeArray(e){return t.call(this,"boolean",e)||this}return ie(BooleanNativeArray,t),BooleanNativeArray}(oe);(ee||(ee={})).factory={number:function(t){return new ae(t)},string:function(t){return new se(t)},boolean:function(t){return new ce(t)}};var ue,le=function(){function NativeArrayFactory(){}return NativeArrayFactory.create=function(t,e){return ee.factory[t](e)},NativeArrayFactory}(),pe=r(14);!function(t){t[t.Front=0]="Front",t[t.Back=1]="Back",t[t.Planar=2]="Planar"}(ue||(ue={}));var fe,he=function(){function Plane(t,e){this.normal=(new H).copy(H.up),this.distFromOrigin=0,this.normal=t||(new H).copy(H.up),this.distFromOrigin=e||0}return Plane.fromPool=function(){return Plane.pool.get()},Plane.prototype.set=function(t,e){return this.normal.copy(t),this.distFromOrigin=e,this},Plane.prototype.setFromPoint=function(t,e){return this.normal.copy(t),this.distFromOrigin=e.dot(t),this},Plane.prototype.setFromPoints=function(t,e,r){var n=H.dummy;return n.substractVectors(t,e),this.normal.copy(r).substract(t).cross(n).normalize(),this.setFromPoint(this.normal,t)},Plane.prototype.copy=function(t){this.normal.copy(t.normal),this.distFromOrigin=t.distFromOrigin},Plane.prototype.classifyPoint=function(t){var e=this.normal.dot(t)-this.distFromOrigin;return e>1e-6?ue.Front:e<-1e-6?ue.Back:ue.Planar},Plane.prototype.getSignedDistance=function(t){return t.dot(this.normal)-this.distFromOrigin},Plane.pool=new G(Plane,64),Plane}(),de=function(){function NativeSerializer(t){this.type=t,this.readProperty=function(e){return"object"==typeof e?new(t.bind.apply(t,[void 0].concat(Object.keys(e).map(function(t){return e[t]})))):e}}return NativeSerializer.prototype.writeProperty=function(t){return t},NativeSerializer}(),ye=function(){function PropertyFactory(){}return PropertyFactory.properties={Vector3:new de(H),Vector2:new de(it),Vector4:new de(ot),Quaternion:new de(ut),Color:new de(Z),Matrix44:new de(st),Matrix33:new de(lt),Rect:new de(Ct),FileProperty:new de(Et),ThumbnailProperty:new de(Bt),String:new de(String),Number:new de(Number),Boolean:new de(Boolean),Range:new de(Ht),NativeArray:{type:oe,readProperty:function(t){return le.create(t.typeName,t.data)},writeProperty:function(t){return{typeName:t.typeName,data:t.data}}},NativeU8Array:{type:pe.a,readProperty:function(t){return new pe.a(t)},writeProperty:function(t){return t.serialize()}},Object:{type:Object,readProperty:function(t){return JSON.parse(JSON.stringify(t))},writeProperty:function(t){return t}},AABB:{type:pt,readProperty:function(t){var e=t.min,r=t.max;return new pt(new H(e.x,e.y,e.z),new H(r.x,r.y,r.z))},writeProperty:function(t){return{min:{x:t.min.x,y:t.min.y,z:t.min.z},max:{x:t.max.x,y:t.max.y,z:t.max.z}}}},Plane:{type:he,readProperty:function(t){var e=t.normal,r=t.distFromOrigin;return new he(new H(e.x,e.y,e.z),r)},writeProperty:function(t){var e=t.normal;return{normal:{x:e.x,y:e.y,z:e.z},distFromOrigin:t.distFromOrigin}}},UISize:{type:mt,readProperty:function(t){var e=new mt;return"object"==typeof t.type?e.type=t.type.value:e.type=t.type,e.value=t.value,e},writeProperty:function(t){return{type:t.type,value:t.value}}},Size:{type:Zt,readProperty:function(t){var e=new Zt;return"object"==typeof t.type?e.type=t.type.value:e.type=t.type,e.value=t.value,e},writeProperty:function(t){return{type:t.type,value:t.value}}},VertexBuffer:{type:Ot,readProperty:function(t){for(var e=new Ot,r=0,n=Object.keys(t.attributes);r<n.length;r++){var i=n[r];e.setData(i,t.attributes[i])}return e.primitiveType=t.primitiveType,e.isDynamic=t.isDynamic,e.name=t.name,e.indices=t.indices,e},writeProperty:function(t){return{attributes:t.data,vertexCount:t.vertexCount,primitiveType:t.primitiveType,isDynamic:t.isDynamic,name:t.name,indices:t.indices}}},ArrayProperty:{type:Rt,readProperty:function(t){var e=[];e.length=t.data.length;for(var r=0;r<t.data.length;++r)Lc.deserializeProperty(e,r,t.typeName,t.data[r]);return _.isObjectOfType(t.typeName,"SerializableObject")?xt.factory.createObjectArray(t.typeName,e):t.typeName in PropertyFactory.properties?new Rt(PropertyFactory.properties[t.typeName].type,e):void V.logError("Unknown type: "+t.typeName)},writeProperty:function(t){var e=_.isObjectOfType(t.typeName(),"SerializableObject");return{typeName:t.typeName(),data:t.getData().map(function(r){var n=Lc.serializeProperty(r,t.typeName());return e&&delete n.typeName,n})}}},Reference:{type:a,readProperty:function(t){if(t.data){var e=xt.factory.createObject(t.data.typeName);return null!==e&&e.deserialize(t.data),xt.factory.createReference(t.baseTypeName,e)}return xt.factory.createReference(t.baseTypeName)},writeProperty:function(t){var e=t.getInstance();return{baseTypeName:t.baseTypeName(),data:e?e.serialize():void 0}}},ReferenceArray:{type:Tt,readProperty:function(t){var e=t.data.map(function(t){return PropertyFactory.properties.Reference.readProperty(t)});return xt.factory.createReferenceArray(t.typeName,e)},writeProperty:function(t){return{typeName:t.typeName(),data:t.getData().map(function(t){return PropertyFactory.properties.Reference.writeProperty(t)})}}},AssetReferenceArray:{type:ne,readProperty:function(t){var e=[];e.length=t.data.length;for(var r=0;r<t.data.length;++r)Lc.deserializeProperty(e,r,"AssetReference",t.data[r]);return xt.factory.createAssetReferenceArray(t.typeName,e)},writeProperty:function(t){return{typeName:t.typeName(),data:t.data.map(function(t){return Lc.serializeProperty(t)})}}},EntityReference:{type:Wt,readProperty:function(t){return new Wt(t)},writeProperty:function(t){return t.id}},ComponentReference:{type:qt,readProperty:function(t){var e=t.componentTypeName,r=xt.factory.createComponentReference(e);return r.entityId=t.entityId,r},writeProperty:function(t){return{entityId:t.entityId,componentTypeName:t.componentTypeName}}}},PropertyFactory}(),me=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),ve=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},ge=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Input=0]="Input",t[t.Output=1]="Output",t[t.InputOutput=2]="InputOutput"}(fe||(fe={}));var _e,be=function(t){function PinReference(e,r){var n=t.call(this)||this;return n.operatorId=e||S.makeUniqueId(),n.pinId=r||S.makeUniqueId(),n}return me(PinReference,t),PinReference.prototype.equals=function(t){return this.operatorId===t.operatorId&&this.pinId===t.pinId},PinReference}(O),we=function(t){function BasePin(e,r,n){var i=t.call(this)||this;return i.id=n||e||S.makeUniqueId(),i.name=e||"NewPin",i.type=r||fe.Input,i}return me(BasePin,t),Object.defineProperty(BasePin.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),BasePin.prototype.upgrade=function(t,e){return 1===e&&(t.properties.id=t.properties.name),t},ve([Attributes_hidden(),ge("design:type",String)],BasePin.prototype,"id",void 0),ve([Attributes_hidden(),ge("design:type",String)],BasePin.prototype,"name",void 0),ve([Attributes_hidden(),ge("design:type",Number)],BasePin.prototype,"type",void 0),BasePin}(O),Pe=function(t){function SignalPin(){return null!==t&&t.apply(this,arguments)||this}return me(SignalPin,t),SignalPin=ve([displayName("Signal")],SignalPin)}(we),xe=function(t){function DataPin(){return null!==t&&t.apply(this,arguments)||this}return me(DataPin,t),DataPin.prototype.setData=function(t){},DataPin.prototype.getData=function(){},DataPin}(we),Oe=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ce=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Se=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Re=function(t){function ObjectDeclaration(){var e=null!==t&&t.apply(this,arguments)||this;return e.pinChanged=new B.AsyncEvent,e._pins=new Tt(we),e}return Oe(ObjectDeclaration,t),Object.defineProperty(ObjectDeclaration.prototype,"pins",{get:function(){return this._pins},enumerable:!0,configurable:!0}),Ce([unserializable(),Se("design:type",Object)],ObjectDeclaration.prototype,"pinChanged",void 0),ObjectDeclaration=Ce([displayName("Object Declaration")],ObjectDeclaration)}(F),je=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Te=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Ee=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Be=function(t){function Prefab(){var e=t.call(this)||this;return e.root=new Xc,e}return je(Prefab,t),Object.defineProperty(Prefab.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Prefab.prototype.isLoaded=function(){return this.root.isLoaded()},Prefab.prototype.serialize=function(){return{typeName:this.constructor.name,version:this.version,id:this.id,name:this.name,root:Lc.serializeEntity(this.root)}},Prefab.prototype.deserialize=function(t){var e=t;if(1===e.version){var r=t;e.root=r.properties.root,e.id=r.properties.id,e.name=r.properties.name}return this.id=e.id,this.name=e.name,Lc.deserializeEntity(this.root,e.root,!0),Promise.resolve(this)},Prefab=Te([editable(!1),creatable(!1),Ee("design:paramtypes",[])],Prefab)}(F),Ae=function(){function Basis(){this.right=(new H).copy(H.right),this.up=(new H).copy(H.up),this.forward=(new H).copy(H.forward)}return Basis.fromMatrix=function(t){return(new Basis).setFromMatrix(t)},Basis.fromNormal=function(t){return(new Basis).setFromNormal(t)},Basis.fromForward=function(t){return(new Basis).setFromForward(t)},Basis.prototype.setFromMatrix=function(t){var e=t.data;return this.right.set(e[0],e[1],e[2]),this.up.set(e[4],e[5],e[6]),this.forward.set(e[8],e[9],e[10]),this},Basis.prototype.setFromNormal=function(t){this.up.copy(t);var e=this.up.dot(H.forward);return Math.abs(e)<1?this.right.crossVectors(this.up,H.forward).normalize():this.right.copy(H.right).multiply(Math.sign(e)),this.forward.crossVectors(this.right,this.up).normalize(),this},Basis.prototype.setFromForward=function(t){this.forward.copy(t);var e=t.dot(H.up);return Math.abs(e)<1?this.right.crossVectors(H.up,this.forward).normalize():this.right.copy(H.right).multiply(Math.sign(e)),this.up.crossVectors(this.forward,this.right).normalize(),this},Basis}(),Ie=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Me=function(){return function RayPlaneCollisionResult(){}}(),ke=function(){return function RayAABBCollisionResult(){this.intersection1=new H,this.intersection2=new H,this.normal1=new H,this.normal2=new H}}(),ze=function(t){function RaySphereCollisionResult(){return null!==t&&t.apply(this,arguments)||this}return Ie(RaySphereCollisionResult,t),RaySphereCollisionResult}(ke);!function(t){t.dummy=new H,t.dummy2=new H,t.rayAABBResult=new ke,t.raySphereResult=new ze,t.rayPlaneResult=new Me,t.basis=new Ae}(_e||(_e={}));var Fe,De=function(){function Ray(t,e,r){this._origin=t||new H,this._direction=e||(new H).copy(H.forward),this._length=r||999999}return Object.defineProperty(Ray.prototype,"origin",{get:function(){return this._origin},set:function(t){this._origin.copy(t),delete this._destination},enumerable:!0,configurable:!0}),Object.defineProperty(Ray.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction.copy(t),delete this._destination},enumerable:!0,configurable:!0}),Object.defineProperty(Ray.prototype,"destination",{get:function(){return this._destination||(this._destination=(new H).copy(this._direction).multiply(this._length).add(this._origin)),this._destination},enumerable:!0,configurable:!0}),Object.defineProperty(Ray.prototype,"length",{get:function(){return this._length},set:function(t){t!==this._length&&(this._length=t,delete this._destination)},enumerable:!0,configurable:!0}),Ray.fromPerspectiveView=function(t,e,r,n,i,o){return(new Ray).setFromPerspectiveView(t,e,r,n,i,o)},Ray.fromOrthographicView=function(t,e,r,n,i,o){return(new Ray).setFromOrthographicView(t,e,r,n,i,o)},Ray.prototype.set=function(t,e,r){this._origin.copy(t),this._direction.copy(e),void 0!==r&&(this._length=r)},Ray.prototype.copy=function(t){return this._origin.copy(t.origin),this._direction.copy(t.direction),this._length=t.length,delete this._destination,this},Ray.prototype.transform=function(t){this._origin.transform(t),this._direction.transformDirection(t),delete this._destination},Ray.prototype.setFromPerspectiveView=function(t,e,r,n,i,o){var a=i/o,s=1/Math.tan(t/2),c=(2*r/i-1)/(s/a),u=-(2*n/o-1)/s,l=e.data;return this.direction.x=c*l[0]+u*l[4]+-1*l[8],this.direction.y=c*l[1]+u*l[5]+-1*l[9],this.direction.z=c*l[2]+u*l[6]+-1*l[10],this.direction.normalize(),this.origin.setFromMatrix(e),this},Ray.prototype.setFromOrthographicView=function(t,e,r,n,i,o){var a=2*t*(1-n/(o-1))-t,s=i*t/o,c=r/(i-1)*(2*s)-s,u=_e.basis;return u.setFromMatrix(e),this.origin.setFromMatrix(e).add(u.right.multiply(c)).add(u.up.multiply(a)),this.direction.copy(u.forward).flip().normalize(),this},Ray.prototype.castOnSphere=function(t,e){var r=_e.dummy,n=_e.raySphereResult,i=r.substractVectors(this.origin,t),o=i.dot(this.direction),a=o*o-(i.dot(i)-e*e);if(a<0)return null;var s=-o-(a=Math.sqrt(a)),c=-o+a,u=s,l=c;if(s<0){if(c<0)return null;u=c,l=s}return n.intersection1.copy(this.direction).multiply(u).add(this.origin),n.normal1.copy(n.intersection1).substract(t).normalize(),n.intersection2.copy(this.direction).multiply(l).add(this.origin),n.normal2.copy(n.intersection2).substract(t).normalize(),n},Ray.prototype.castOnPlane=function(t){var e=_e.rayPlaneResult,r=t.normal.dot(this.origin)-t.distFromOrigin;if(K.isZero(r))e.intersection=H.dummy.copy(this.origin),e.classification=ue.Planar;else{var n=t.normal.dot(this.direction);if(K.isZero(n))e.intersection=null;else{var i=-r/n;e.intersection=i<0?null:H.dummy.copy(this.direction).multiply(i).add(this.origin)}e.classification=r>0?ue.Front:ue.Back}return e},Ray.prototype.castOnAABB=function(t){var e=_e.rayAABBResult,r=_e.dummy,n=_e.dummy2,i=H.dummy.substractVectors(t.min,this.origin).divideVector(this.direction),o=H.dummy2.substractVectors(t.max,this.origin).divideVector(this.direction),a=r.set(Math.min(i.x,o.x),Math.min(i.y,o.y),Math.min(i.z,o.z)),s=n.set(Math.max(i.x,o.x),Math.max(i.y,o.y),Math.max(i.z,o.z)),c=a.max(),u=s.min();if(u>=c){var l=c,p=u;if(c<0){if(u<0)return null;l=u,p=c}return e.intersection1.copy(this.direction).multiply(l).add(this.origin),e.intersection2.copy(this.direction).multiply(p).add(this.origin),e.normal1.copy(this.getAABBNormal(t,e.intersection1)),e.normal2.copy(this.getAABBNormal(t,e.intersection2)),e}return null},Ray.prototype.getAABBNormal=function(t,e){var r=e.x,n=e.y,i=e.z;return K.isEqual(r,t.min.x)?H.dummy.set(-1,0,0):K.isEqual(r,t.max.x)?H.dummy.set(1,0,0):K.isEqual(n,t.min.y)?H.dummy.set(0,-1,0):K.isEqual(n,t.max.y)?H.dummy.set(0,1,0):K.isEqual(i,t.min.z)?H.dummy.set(0,0,-1):K.isEqual(i,t.max.z)?H.dummy.set(0,0,1):H.dummy.set(0,1,0)},Ray.dummy=new Ray,Ray}(),Ne=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Le=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Ve=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.defaultComponentType="Transform",t.defaultAssetType="Material"}(Fe||(Fe={}));var Ue,We=function(t){function TDataPin(e,r){var n=t.call(this,e,r)||this;return Object.defineProperty(n,TDataPin.runtimeValueAccessor,{get:function(){return n.value},set:function(t){return n.value=t},configurable:!0}),n}return Ne(TDataPin,t),TDataPin.prototype.setData=function(t){this.value=t},TDataPin.prototype.getData=function(){return this.value},TDataPin.runtimeValueAccessor="_value",TDataPin}(xe),qe=function(t){function NumberPin(e,r,n){var i=t.call(this,e,r)||this;return i.value=n||0,i}return Ne(NumberPin,t),NumberPin=Le([displayName("Number"),Ve("design:paramtypes",[String,Number,Number])],NumberPin)}(We),Ge=function(t){function StringPin(e,r){var n=t.call(this,e,r)||this;return n.value="",n}return Ne(StringPin,t),StringPin=Le([displayName("String"),Ve("design:paramtypes",[String,Number])],StringPin)}(We),He=function(t){function BooleanPin(e,r){var n=t.call(this,e,r)||this;return n.value=!1,n}return Ne(BooleanPin,t),BooleanPin=Le([displayName("Boolean"),Ve("design:paramtypes",[String,Number])],BooleanPin)}(We),Xe=function(t){function Vector2Pin(e,r){var n=t.call(this,e,r)||this;return n.value=new it,n}return Ne(Vector2Pin,t),Vector2Pin.prototype.setData=function(t){this.value.copy(t)},Vector2Pin=Le([displayName("Vector2"),Ve("design:paramtypes",[String,Number])],Vector2Pin)}(We),Ke=function(t){function Vector3Pin(e,r){var n=t.call(this,e,r)||this;return n.value=new H,n}return Ne(Vector3Pin,t),Vector3Pin.prototype.setData=function(t){this.value.copy(t)},Vector3Pin=Le([displayName("Vector3"),Ve("design:paramtypes",[String,Number])],Vector3Pin)}(We),Qe=function(t){function Vector4Pin(e,r){var n=t.call(this,e,r)||this;return n.value=new ot,n}return Ne(Vector4Pin,t),Vector4Pin.prototype.setData=function(t){this.value.copy(t)},Vector4Pin=Le([displayName("Vector4"),Ve("design:paramtypes",[String,Number])],Vector4Pin)}(We),Ye=function(t){function ColorPin(e,r){var n=t.call(this,e,r)||this;return n.value=new Z,n}return Ne(ColorPin,t),ColorPin.prototype.setData=function(t){this.value.copy(t)},ColorPin=Le([displayName("Color"),Ve("design:paramtypes",[String,Number])],ColorPin)}(We),Ze=function(t){function RayPin(e,r){var n=t.call(this,e,r)||this;return n.value=new De,n}return Ne(RayPin,t),RayPin.prototype.setData=function(t){this.value.copy(t)},RayPin=Le([displayName("Ray"),Ve("design:paramtypes",[String,Number])],RayPin)}(We),Je=function(t){function PrefabPin(e,r){var n=t.call(this,e,r)||this;return n.value=new re(Be),Object.defineProperty(n,We.runtimeValueAccessor,{get:function(){return n.value.asset},set:function(t){return n.value.asset=t}}),n}return Ne(PrefabPin,t),PrefabPin=Le([displayName("Prefab"),Ve("design:paramtypes",[String,Number])],PrefabPin)}(We),$e=function(t){function EntityReferencePin(e,r){var n=t.call(this,e,r)||this;return n.value=new Wt,Object.defineProperty(n,We.runtimeValueAccessor,{get:function(){return n.value.entity},set:function(t){return n.value.entity=t}}),n}return Ne(EntityReferencePin,t),EntityReferencePin=Le([displayName("Entity"),Ve("design:paramtypes",[String,Number])],EntityReferencePin)}(We),tr=function(t){function ComponentReferencePin(e,r,n){var i=t.call(this,e,r)||this;return i._componentType=n||Fe.defaultComponentType,Object.defineProperty(i,We.runtimeValueAccessor,{get:function(){return i.value.component},set:function(t){return i.value.component=t}}),i}return Ne(ComponentReferencePin,t),Object.defineProperty(ComponentReferencePin.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(ComponentReferencePin.prototype,"componentType",{get:function(){return this._componentType},set:function(t){this.value=xt.factory.createComponentReference(t),this._componentType=t},enumerable:!0,configurable:!0}),ComponentReferencePin.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r),"_componentType"!==e||this.value||(this.componentType=r)},ComponentReferencePin.prototype.upgrade=function(e,r){if(1===r)e=t.prototype.upgrade.call(this,e,r);else if(2===r){var n=e.properties._componentType;"UIImage"===n?Object.assign(e.properties,{_componentType:"Image"}):"UIText"===n&&Object.assign(e.properties,{_componentType:"Text"})}return e},ComponentReferencePin=Le([displayName("Component"),Ve("design:paramtypes",[String,Number,String])],ComponentReferencePin)}(We),er=function(t){function CollisionInfoPin(e,r){return t.call(this,e,r)||this}return Ne(CollisionInfoPin,t),CollisionInfoPin=Le([displayName("CollisionInfo"),Ve("design:paramtypes",[String,Number])],CollisionInfoPin)}(We),rr=function(t){function ObjectReferencePin(e,r,n){var i=t.call(this,r,n)||this;return i.value=new Fc(e),Object.defineProperty(i,We.runtimeValueAccessor,{get:function(){return i.value.asset},set:function(t){return i.value.asset=t}}),i}return Ne(ObjectReferencePin,t),Object.defineProperty(ObjectReferencePin.prototype,"declarationId",{get:function(){return this._declarationId},set:function(t){this.value=new Fc(t),this._declarationId=t},enumerable:!0,configurable:!0}),ObjectReferencePin.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r),"_declarationId"===e&&this.value.declarationId!==r&&(this.value=new Fc(r))},Le([Attributes_hidden(),Ve("design:type",String)],ObjectReferencePin.prototype,"_declarationId",void 0),ObjectReferencePin}(We),nr=function(t){function ArrayPin(e,r,n){var i=t.call(this,e,r)||this;return i._isDirty=!0,Object.defineProperty(i,We.runtimeValueAccessor,{get:function(){return i._isDirty&&(i._runtimeData=i.value.data.map(function(t){return t[We.runtimeValueAccessor]}),i._isDirty=!1),i._runtimeData},set:function(t){i.value.data=t.map(function(t){var e=new We;return e.value=t,e}),i._isDirty=!0}}),i}return Ne(ArrayPin,t),Object.defineProperty(ArrayPin.prototype,"dataType",{get:function(){return this._dataType},set:function(t){t&&(this.value=xt.factory.createObjectArray(t)),this._dataType=t,delete this._declarationId},enumerable:!0,configurable:!0}),Object.defineProperty(ArrayPin.prototype,"declarationId",{get:function(){return this._declarationId},set:function(t){var e=this;t&&(this.value&&"ObjectReferencePin"===this.value.typeName()||(this.value=xt.factory.createObjectArray("ObjectReferencePin")),this.value.grow=function(r){r?r.declarationId=t:r=new rr(t),e.value.data.push(r)}),this._declarationId=t,delete this._dataType},enumerable:!0,configurable:!0}),ArrayPin.prototype.setData=function(e){t.prototype.setData.call(this,e),this._isDirty=!0},ArrayPin.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r),"_dataType"!==e||this.value?"_declarationId"===e&&(this.declarationId=r):this.dataType=r},Le([unserializable(),Ve("design:type",Object)],ArrayPin.prototype,"_isDirty",void 0),Le([unserializable(),Ve("design:type",Array)],ArrayPin.prototype,"_runtimeData",void 0),ArrayPin=Le([displayName("Array"),Ve("design:paramtypes",[String,Number,String])],ArrayPin)}(We),ir=function(t){function AssetPin(e,r,n){var i=t.call(this,e,r)||this;return i._assetType=n||Fe.defaultAssetType,Object.defineProperty(i,We.runtimeValueAccessor,{get:function(){return i.value.asset},set:function(t){return i.value.asset=t}}),i}return Ne(AssetPin,t),Object.defineProperty(AssetPin.prototype,"assetType",{get:function(){return this._assetType},set:function(t){this.value=xt.factory.createAssetReference(t),this._assetType=t},enumerable:!0,configurable:!0}),AssetPin.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r),"_assetType"!==e||this.value||(this.assetType=r)},AssetPin=Le([displayName("Asset"),Ve("design:paramtypes",[String,Number,String])],AssetPin)}(We);!function(t){t.dummy=new H,t.dummy2=new H,t.dummy3=new H,t.dummy4=new H,t.dummy5=new H}(Ue||(Ue={}));var or,ar=function(){function Triangle(t,e,r){this.a=new H,this.b=new H,this.c=new H,this.set(t||H.zero,e||H.zero,r||H.zero)}return Triangle.fromPool=function(){return Triangle.pool.get()},Triangle.prototype.set=function(t,e,r){return this.a.copy(t),this.b.copy(e),this.c.copy(r),this},Triangle.prototype.contains=function(t,e){var r=this.getBarycentricCoords(t),n=e||.005;return r.y>=0-n&&r.z>=0-n&&r.y+r.z<=1+n},Triangle.prototype.getClosestPoint=function(t){var e=Ue.dummy,r=Ue.dummy2,n=Ue.dummy3,i=Ue.dummy4,o=Ue.dummy5,a=e,s=r,c=n,u=i;K.getClosestPointOnLine(t,this.a,this.b,a),K.getClosestPointOnLine(t,this.b,this.c,s),K.getClosestPointOnLine(t,this.c,this.a,c);var l=u.substractVectors(t,a).length,p=u.substractVectors(t,s).length,f=l;return p<f?(f=p,o.copy(s)):o.copy(a),u.substractVectors(t,c).length<f&&o.copy(c),o},Triangle.prototype.getBarycentricCoords=function(t){var e=Ue.dummy,r=Ue.dummy2,n=Ue.dummy3,i=Ue.dummy4,o=e,a=r,s=n;o.substractVectors(this.b,this.a),a.substractVectors(this.c,this.a),s.substractVectors(t,this.a);var c=o.dot(o),u=o.dot(a),l=a.dot(a),p=s.dot(o),f=s.dot(a),h=c*l-u*u;if(0!==h){var d=(l*p-u*f)/h,y=(c*f-u*p)/h,m=1-d-y;return i.set(m,d,y)}return i.set(0,Number.MAX_VALUE,Number.MAX_VALUE)},Triangle.pool=new G(Triangle,64),Triangle}(),sr=function(){function BehaviorAPIFactory(){}return BehaviorAPIFactory.createObject=function(t){for(var e,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var i=BehaviorAPIFactory.variableObjectFactory[t];return i?i.apply(void 0,r):(e=xt.factory).createObject.apply(e,[t].concat(r))},BehaviorAPIFactory.variableObjectFactory={Vector2:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new(it.bind.apply(it,[void 0].concat(t)))},Vector3:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new(H.bind.apply(H,[void 0].concat(t)))},Vector4:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new(ot.bind.apply(ot,[void 0].concat(t)))},Color:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new(Z.bind.apply(Z,[void 0].concat(t)))},Matrix44:function(){return new st},Quaternion:function(){return new ut},Map:function(){return new Map},Plane:function(){return new he},Triangle:function(){return new ar},Ray:function(){return new De},Basis:function(){return new Ae},VertexBuffer:function(){return new Ot}},BehaviorAPIFactory}();!function(t){t[t.Continue=0]="Continue",t[t.Finish=1]="Finish"}(or||(or={}));var cr,ur=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),lr=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},pr=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},fr=function(t){function BehaviorNode(){var e=t.call(this)||this;return e.position=new it,e._pins=new Tt(we),e.id=S.makeUniqueId(),e}return ur(BehaviorNode,t),Object.defineProperty(BehaviorNode.prototype,"pins",{get:function(){return this._pins},enumerable:!0,configurable:!0}),Object.defineProperty(BehaviorNode.prototype,"ownerBehavior",{get:function(){return this._ownerBehavior},set:function(t){this._ownerBehavior=t},enumerable:!0,configurable:!0}),BehaviorNode.prototype.onBehaviorStarted=function(){},BehaviorNode.prototype.findPin=function(t){var e=this._pins.data.find(function(e){return e.instance.id===t});return e?e.instance:void 0},BehaviorNode.prototype.findPinByName=function(t){var e=this._pins.data.find(function(e){return e.instance.name===t});return e?e.instance:void 0},BehaviorNode.prototype.filterPins=function(t){return this._pins.data.filter(function(e){return t(e.instance)}).map(function(t){return t.instance})},BehaviorNode.prototype.sendSignal=function(t){var e=this.findPinByName(t);e&&this._ownerBehavior.sendSignal(this.id,e.id)},BehaviorNode.prototype.isLoaded=function(){return!0},BehaviorNode.prototype.createPin=function(t,e,r){for(var n,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];this[t]=(n=xt.factory).createObject.apply(n,[r.name,t,e].concat(i)),this.registerPin(this[t])},BehaviorNode.prototype.createComponentReferencePin=function(t,e,r){var n=new tr(t,e,r.name);n.componentType=r.name,this[t]=n,this.registerPin(this[t])},BehaviorNode.prototype.createAssetPin=function(t,e,r){var n=new ir(t,e,r.name);n.assetType=r.name,this[t]=n,this.registerPin(this[t])},BehaviorNode.prototype.createArrayPin=function(t,e,r){var n=new nr(t,e,r.name);n.dataType=r.name,this[t]=n,this.registerPin(this[t])},BehaviorNode.prototype.registerPin=function(t){this._pins.grow(t)},lr([unserializable(),pr("design:type",Number)],BehaviorNode.prototype,"widthInEditor",void 0),lr([unserializable(),pr("design:type",Object)],BehaviorNode.prototype,"_ownerBehavior",void 0),lr([unserializable(),pr("design:type",Object)],BehaviorNode.prototype,"_pins",void 0),BehaviorNode}(O),hr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),dr=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},yr=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.startPinId="_start",t.finishPinId="_finish"}(cr||(cr={}));var mr,vr=function(t){function Operator(){var e=t.call(this)||this;return e.createPin(cr.startPinId,fe.Input,Pe),e.createPin(cr.finishPinId,fe.Output,Pe),e}return hr(Operator,t),Operator.prototype.onStart=function(){return or.Finish},Operator.prototype.onUpdate=function(){return or.Finish},Operator.prototype.onFinish=function(){},Operator.prototype.onSignalReceived=function(t){},dr([unserializable(),yr("design:type",Pe)],Operator.prototype,"_start",void 0),dr([unserializable(),yr("design:type",Pe)],Operator.prototype,"_finish",void 0),Operator}(fr),gr=function(){function EngineEvents(){}return EngineEvents.assetLoaded=new B.AsyncEvent,EngineEvents.objectSaved=new B.AsyncEvent,EngineEvents}();(mr||(mr={})).errors=new Map;var _r,br=function(){function BehaviorErrors(){}return BehaviorErrors.checkCodeBlock=function(t){},BehaviorErrors.forEach=function(t){mr.errors.forEach(t)},BehaviorErrors.clear=function(t){t?mr.errors.delete(t):mr.errors.clear()},BehaviorErrors}();!function(t){t.generateRuntimeCode=function(t){return console.assert(!1,"Not implemented in this run-time"),""}}(_r||(_r={}));var wr,Pr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),xr=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Or=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.codeProperty="_code",t.trimId=function(t){return t.split("-").join("")}}(wr||(wr={}));var Cr,Sr=function(t){function CodeBlock(){var e=null!==t&&t.apply(this,arguments)||this;return e.pinChanged=new B.VoidSyncEvent,e._pins=new Tt(we),e._code="\nfunction onStart() {        \n    return ExecutionStatus.Continue;\n}\n\nfunction onUpdate() {\n    return ExecutionStatus.Finish;\n}\n",e._isLoaded=!1,e._isLoading=!1,e._hasCompileErrors=!1,e}return Pr(CodeBlock,t),Object.defineProperty(CodeBlock.prototype,"version",{get:function(){return 6},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"pins",{get:function(){return this._pins},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"code",{get:function(){return this._code},set:function(t){this._code=t,this.clearErrors(),this._standaloneScript&&this._standaloneScript.parentNode&&this._standaloneScript.parentNode.removeChild(this._standaloneScript);try{console.assert(this.templatePath);var e=this.templatePath.replace(" ","_").replace("."+this.constructor.name,".js"),r=t;0;var n=window.location,i=n.protocol,o=n.hostname,a=n.port,s=r+"\r\n//# sourceURL="+i+"//"+o+(a&&a.length>0?":"+a:"")+"/"+e;return this._standaloneScript=document.createElement("script"),this._standaloneScript.appendChild(document.createTextNode(s)),document.head.appendChild(this._standaloneScript),this._isLoading=!1,void(this._isLoaded=!0)}catch(t){this.logRuntimeError(t.message)}finally{br.checkCodeBlock(this)}},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"program",{get:function(){return this._program},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"hasCompileErrors",{get:function(){return this._hasCompileErrors},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"runtimeError",{get:function(){return this._runtimeError},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"functions",{get:function(){return this._functions},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!0,configurable:!0}),CodeBlock.prototype.logRuntimeError=function(t){V.logError("Error: '"+t+"' in '"+this.templatePath+"'"),this._runtimeError=[t,Date.now()]},CodeBlock.prototype.logCompileError=function(t){V.logError("Error: '"+t+"' in '"+this.templatePath+"'"),this._hasCompileErrors=!0},CodeBlock.prototype.clearRuntimeErrors=function(){delete this._runtimeError},CodeBlock.prototype.isLoaded=function(){return this._isLoaded},CodeBlock.prototype.destroy=function(){this._standaloneScript&&this._standaloneScript.parentNode&&this._standaloneScript.parentNode.removeChild(this._standaloneScript),t.prototype.destroy.call(this)},CodeBlock.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r),e===wr.codeProperty&&(this.code=r)},CodeBlock.prototype.upgrade=function(t,e){return 1===e?(t.properties._code=t.properties._code.replace(/getComponent\(("|')UIImage("|')\)/g,'getComponent("Image")'),t.properties._code=t.properties._code.replace(/getComponent\(("|')UIText("|')\)/g,'getComponent("Text")')):2===e?t.properties._code=t.properties._code.replace(/Engine.createFromPrefab/g,"Engine.createEntity"):3===e?t.properties._code=t.properties._code.replace(/Engine.root(\(\))?.findChild/g,"Engine.findEntity").replace(/transform.(_value.)?(position|rotation|scale|forward|right|up)/g,function(t,e,r){var n="transform.";return e&&(n=""+n+e),n=n+"world"+(r[0].toUpperCase()+r.substring(1))}).replace(/transform.(_value.)?local(Position|Rotation|Scale|Forward|Right|Up)/g,function(t,e,r){var n="transform.";return e&&(n=""+n+e),n=(""+n+r).toLowerCase()}):4===e?t.properties._code=t.properties._code.replace(/Engine.deltaTime/g,"Time.deltaTime").replace(/Engine.isOpenSource/g,"Project.isOpenSource").replace(/Engine.projectName/g,"Project.name").replace(/Engine.importToEditor/g,"Project.importToEditor").replace(/Engine.readSave/g,"SavedData.get").replace(/Engine.writeSave\([a-zA-Z]+\)/g,"SavedData.flush()").replace(/Engine.createEntity\(([a-zA-Z._]+)(, ([a-zA-Z 0-9\(\),]+))?\)/g,function(t,e,r,n){return n?"Entities.create("+e+", { position: "+n+" })":"Entities.create("+e+")"}).replace(/Engine.destroyEntity\(([a-zA-Z0-9._]+)\)/g,function(t,e,r){return e+".destroy()"}).replace(/Engine.findEntity\((['"a-zA-Z0-9._]+)\)/g,function(t,e,r){return"Entities.find("+e+")"}).replace(/Engine.getScreenSize\(\)/g,"Renderer.screenSize").replace(/Engine.loadScene\((['"a-zA-Z0-9_\/.]+)\)/g,function(t,e,r){return"Scenes.load("+e+")"}).replace(/Engine.loadAssetById\(([a-zA-Z0-9_.]+)\)/g,function(t,e,r){return"Assets.loadById("+e+")"}).replace(/Engine.loadAsset\((['"a-zA-Z0-9._]+)\)/g,function(t,e,r){return"Assets.load("+e+")"}):5===e&&(t.properties._code=t.properties._code.replace(/.owner./g,".entity.").replace(/.findEntities/g,".filterChildren").replace(/getComponent\(["']([a-zA-Z]+)["']\)/g,function(t,e){return'getComponentByName("'+e+'")'}).replace(/setComponent\(["']([a-zA-Z]+)["']\)/g,function(t,e){return'setComponentByName("'+e+'")'}).replace(/getOrSetComponent\(["']([a-zA-Z]+)["']\)/g,function(t,e){return'getOrSetComponentByName("'+e+'")'})),t},CodeBlock.prototype.clearErrors=function(){this._hasCompileErrors=!1,this.clearRuntimeErrors(),br.clear(this)},xr([unserializable(),Or("design:type",Object)],CodeBlock.prototype,"pinChanged",void 0),xr([unserializable(),Or("design:type",Object)],CodeBlock.prototype,"sourceInfo",void 0),xr([unserializable(),Or("design:type",Object)],CodeBlock.prototype,"_program",void 0),xr([unserializable(),Or("design:type",Object)],CodeBlock.prototype,"_functions",void 0),xr([unserializable(),Or("design:type",Object)],CodeBlock.prototype,"_isLoaded",void 0),xr([unserializable(),Or("design:type",Object)],CodeBlock.prototype,"_isLoading",void 0),xr([unserializable(),Or("design:type",HTMLScriptElement)],CodeBlock.prototype,"_standaloneScript",void 0),xr([unserializable(),Or("design:type",String)],CodeBlock.prototype,"_scriptUrl",void 0),xr([unserializable(),Or("design:type",Object)],CodeBlock.prototype,"_hasCompileErrors",void 0),xr([unserializable(),Or("design:type",Array)],CodeBlock.prototype,"_runtimeError",void 0),CodeBlock=xr([displayName("Code Block"),hasDedicatedEditor(!0)],CodeBlock)}(F),Rr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),jr=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Tr=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Er=function(t){function CodeBlockInstance(){var e=t.call(this)||this;return e._onStartExecutionPending=!1,e._initStateExecutionPending=!1,e._stateInitialized=!1,e._codeBlock=new re(Sr),e.sendSignal=e.sendSignal.bind(e),e.onCodeBlockPinsChanged=e.onCodeBlockPinsChanged.bind(e),e.onCodeBlockChanged=e.onCodeBlockChanged.bind(e),e._codeBlock.assetChanged.attach(e.onCodeBlockChanged),e}return Rr(CodeBlockInstance,t),Object.defineProperty(CodeBlockInstance.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlockInstance.prototype,"codeBlock",{get:function(){return this._codeBlock.asset},set:function(t){this._codeBlock.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlockInstance.prototype,"customPins",{get:function(){return this._customPins},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlockInstance.prototype,"stateVariables",{get:function(){return this._stateVariables},enumerable:!0,configurable:!0}),CodeBlockInstance.prototype.isLoaded=function(){return S.isAssetRefLoaded(this._codeBlock)},CodeBlockInstance.prototype.destroy=function(){if(this._stateInitialized){this.executeFunction("onDestroy");for(var e=0,r=Object.keys(this._stateVariables);e<r.length;e++){var n=r[e],i=this._stateVariables[n].value;i&&i.constructor&&"VertexBuffer"===i.constructor.name&&i.unload(gt.context)}}this._codeBlock.asset&&this._codeBlock.asset.pinChanged.detach(this.onCodeBlockPinsChanged),this._codeBlock.detach(),t.prototype.destroy.call(this)},CodeBlockInstance.prototype.onStart=function(){var t=this.codeBlock;if(this.initializeStateIfNecessary(),t.runtimeError)return this._onStartExecutionPending=!0,or.Continue;if(t.runtimeError||t.isLoading)return this._onStartExecutionPending=!0,or.Continue;var e=this.executeFunction("onStart");return void 0!==e?e:t.runtimeError?(this._onStartExecutionPending=!0,or.Continue):or.Finish},CodeBlockInstance.prototype.onUpdate=function(){var t=this.codeBlock;if(t.runtimeError||t.isLoading)return or.Continue;if(this._initStateExecutionPending){if(this.initializeStateIfNecessary(),t.runtimeError)return or.Continue;this._initStateExecutionPending=!1}if(this._onStartExecutionPending){var e=this.executeFunction("onStart");return void 0!==e?(this._onStartExecutionPending=!1,e):t.runtimeError?or.Continue:or.Finish}var r=this.executeFunction("onUpdate");return void 0!==r?r:t.runtimeError?or.Continue:or.Finish},CodeBlockInstance.prototype.onFinish=function(){this.executeFunction("onFinish")},CodeBlockInstance.prototype.onSignalReceived=function(t){this.codeBlock.runtimeError||this.executeFunction("onSignalReceived",t)},CodeBlockInstance.prototype.onCodeBlockPinsChanged=function(){var t=this.codeBlock;this._customPins=t.pins.copy(),this._stateInitialized=!1},CodeBlockInstance.prototype.findPin=function(e){var r=t.prototype.findPin.call(this,e);if(!r){var n=this._customPins?this._customPins.data.find(function(t){return t.instance.id===e}):void 0;r=n?n.instance:void 0}return r},CodeBlockInstance.prototype.filterPins=function(e){return t.prototype.filterPins.call(this,e).concat(this._customPins.data.filter(function(t){return e(t.instance)}).map(function(t){return t.instance}))},CodeBlockInstance.prototype.findPinByName=function(e){var r=t.prototype.findPin.call(this,e);if(!r){var n=this._customPins.data.find(function(t){return t.instance.name===e});r=n?n.instance:void 0}return r},CodeBlockInstance.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_codeBlock:t.properties.codeBlock}),delete t.properties.codeBlock),t},CodeBlockInstance.prototype.executeFunction=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=this.codeBlock;try{var i=t+"_"+wr.trimId(n.id);return i in window?(this.initializeStateIfNecessary(),window[i].apply(window,[this._stateVariables,Tc.api,sr.createObject,this.sendSignal].concat(e))):void 0}catch(t){n.logRuntimeError("Runtime Error: '"+t.stack+"'")}},CodeBlockInstance.prototype.onCodeBlockChanged=function(t){var e=t.oldAsset;e&&e.pinChanged.detach(this.onCodeBlockPinsChanged);var r=t.newAsset;r&&(this._customPins=r.pins.copy(),this._stateInitialized=!1,r.pinChanged.attach(this.onCodeBlockPinsChanged))},CodeBlockInstance.prototype.initializeStateIfNecessary=function(){if(!this._stateInitialized){var t=this.codeBlock;try{this._stateVariables=Bc.initializeCodeBlockInstanceState(t,this.ownerBehavior.ownerComponent.entity,this._customPins,this.sendSignal),this._stateInitialized=!0}catch(e){this._initStateExecutionPending=!0,t.logRuntimeError("Runtime Error: '"+e.stack+"'")}}},jr([unserializable(),Tr("design:type",Tt)],CodeBlockInstance.prototype,"_customPins",void 0),jr([unserializable(),Tr("design:type",Object)],CodeBlockInstance.prototype,"_stateVariables",void 0),jr([unserializable(),Tr("design:type",Object)],CodeBlockInstance.prototype,"_onStartExecutionPending",void 0),jr([unserializable(),Tr("design:type",Object)],CodeBlockInstance.prototype,"_initStateExecutionPending",void 0),jr([unserializable(),Tr("design:type",Object)],CodeBlockInstance.prototype,"_stateInitialized",void 0),CodeBlockInstance}(vr),Br=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ar=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Ir=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Mr=function(t){function BehaviorOperator(){var e=t.call(this)||this;return e._uniqueBehaviorInstance=null,e._behavior=new re(ln),e.onBehaviorPinsChanged=e.onBehaviorPinsChanged.bind(e),e.onBehaviorInlineVariableChanged=e.onBehaviorInlineVariableChanged.bind(e),e.onBehaviorChanged=e.onBehaviorChanged.bind(e),e._behavior.assetChanged.attach(e.onBehaviorChanged),e}return Br(BehaviorOperator,t),Object.defineProperty(BehaviorOperator.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(BehaviorOperator.prototype,"behavior",{get:function(){return this._behavior.asset},set:function(t){this._behavior.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(BehaviorOperator.prototype,"customPins",{get:function(){return this._customPins},enumerable:!0,configurable:!0}),BehaviorOperator.prototype.destroy=function(){var e=this.behavior;e&&e.inlineVariableChanged.detach(this.onBehaviorInlineVariableChanged),this._behavior.detach(),this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.destroy(),this._uniqueBehaviorInstance=null),t.prototype.destroy.call(this)},BehaviorOperator.prototype.isLoaded=function(){return S.isAssetRefLoaded(this._behavior)},BehaviorOperator.prototype.onStart=function(){return this._uniqueBehaviorInstance?this._uniqueBehaviorInstance.sendSignal(this._uniqueBehaviorInstance.id,cr.startPinId):(this._uniqueBehaviorInstance=this.behavior.copy(!0),this._uniqueBehaviorInstance.ownerComponent=this.ownerBehavior.ownerComponent,this._uniqueBehaviorInstance.customPins=this._customPins,this._uniqueBehaviorInstance.start()),this.checkIfBehaviorFinished()},BehaviorOperator.prototype.onUpdate=function(){return this._uniqueBehaviorInstance.update(),this.checkIfBehaviorFinished()},BehaviorOperator.prototype.onSignalReceived=function(t){if(this._uniqueBehaviorInstance){var e=this._uniqueBehaviorInstance.activeOperators.length>0;this._uniqueBehaviorInstance.sendSignal(this._uniqueBehaviorInstance.id,t),this._uniqueBehaviorInstance.activeOperators.length>0&&!e&&this.ownerBehavior.activateOperator(this)}},BehaviorOperator.prototype.onCollision=function(t){this._uniqueBehaviorInstance&&this._uniqueBehaviorInstance.onCollision(t)},BehaviorOperator.prototype.onUIEvent=function(t){return!!this._uniqueBehaviorInstance&&this._uniqueBehaviorInstance.onUIEvent(t)},BehaviorOperator.prototype.onBehaviorPinsChanged=function(){this.behavior&&(this._customPins=this.behavior.customPins.copy())},BehaviorOperator.prototype.findPin=function(e){var r=t.prototype.findPin.call(this,e);if(!r){var n=this._customPins?this._customPins.data.find(function(t){return t.instance.id===e}):void 0;r=n?n.instance:void 0}return r},BehaviorOperator.prototype.filterPins=function(e){return t.prototype.filterPins.call(this,e).concat(this._customPins.data.filter(function(t){return e(t.instance)}).map(function(t){return t.instance}))},BehaviorOperator.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_behavior:t.properties.behavior}),delete t.properties.behavior),t},BehaviorOperator.prototype.checkIfBehaviorFinished=function(){var t=this._uniqueBehaviorInstance;return 0===t.activeOperators.length?(t.fetchInputData(t.id),or.Finish):or.Continue},BehaviorOperator.prototype.onBehaviorInlineVariableChanged=function(t){if(this._uniqueBehaviorInstance){var e=this.behavior.inlineVariables.data.find(function(e){return e.id===t});e&&this._uniqueBehaviorInstance.updateInlineVariable(t,e)}},BehaviorOperator.prototype.onBehaviorChanged=function(t){this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.destroy(),this._uniqueBehaviorInstance=null);var e=t.newAsset;e&&(this._customPins=e.customPins.copy())},Ar([unserializable(),Ir("design:type",Object)],BehaviorOperator.prototype,"_uniqueBehaviorInstance",void 0),Ar([unserializable(),Ir("design:type",Tt)],BehaviorOperator.prototype,"_customPins",void 0),BehaviorOperator}(vr),kr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),zr=function(t){function InlineVariable(){var e=t.call(this)||this;return e.data=new a(we),e.position=new it,e.id=S.makeUniqueId(),e}return kr(InlineVariable,t),InlineVariable}(O),Fr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Dr=function(t){function Converter(){return null!==t&&t.apply(this,arguments)||this}return Fr(Converter,t),Converter.prototype.convert=function(){},Converter}(fr),Nr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Lr=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Vr=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ur=function(t){function Collision(){var e=t.call(this)||this;return e.createPin("_collision",fe.Output,Pe),e.createPin("_collisionInfo",fe.Output,er),e}return Nr(Collision,t),Collision.prototype.onCollision=function(t){this._collisionInfo.setData(t),this.sendSignal(this._collision.name)},Lr([unserializable(),Vr("design:type",Pe)],Collision.prototype,"_collision",void 0),Lr([unserializable(),Vr("design:type",er)],Collision.prototype,"_collisionInfo",void 0),Collision}(fr),Wr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),qr=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Gr=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Hr=function(t){function UIEvents(){var e=t.call(this)||this;return e.createPin("_stopPropagation",fe.Input,He),e.createPin("_click",fe.Output,Pe),e.createPin("_touchDown",fe.Output,Pe),e.createPin("_touchMove",fe.Output,Pe),e.createPin("_touchUp",fe.Output,Pe),e.createPin("_longPress",fe.Output,Pe),e.createPin("_target",fe.Output,$e),e.createPin("_touchPos",fe.Output,Xe),e}return Wr(UIEvents,t),Object.defineProperty(UIEvents.prototype,"stopPropagation",{get:function(){return this._stopPropagation.getData()},enumerable:!0,configurable:!0}),qr([unserializable(),Gr("design:type",Pe)],UIEvents.prototype,"_touchDown",void 0),qr([unserializable(),Gr("design:type",Pe)],UIEvents.prototype,"_click",void 0),qr([unserializable(),Gr("design:type",Pe)],UIEvents.prototype,"_touchMove",void 0),qr([unserializable(),Gr("design:type",Pe)],UIEvents.prototype,"_touchUp",void 0),qr([unserializable(),Gr("design:type",Pe)],UIEvents.prototype,"_touchEnter",void 0),qr([unserializable(),Gr("design:type",Pe)],UIEvents.prototype,"_touchLeave",void 0),qr([unserializable(),Gr("design:type",Pe)],UIEvents.prototype,"_longPress",void 0),qr([unserializable(),Gr("design:type",$e)],UIEvents.prototype,"_target",void 0),qr([unserializable(),Gr("design:type",Xe)],UIEvents.prototype,"_touchPos",void 0),qr([unserializable(),Gr("design:type",He)],UIEvents.prototype,"_stopPropagation",void 0),UIEvents=qr([displayName("UI Events"),Gr("design:paramtypes",[])],UIEvents)}(fr),Xr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Kr=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Qr=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Yr=function(t){function CodeBlockConverter(){var e=t.call(this)||this;return e._code="\nfunction convert() {                \n}\n",e}return Xr(CodeBlockConverter,t),CodeBlockConverter=Kr([displayName("Converter"),Qr("design:paramtypes",[])],CodeBlockConverter)}(Sr),Zr=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Jr=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},$r=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},tn=function(t){function CodeBlockConverterInstance(){var e=t.call(this)||this;return e._stateInitialized=!1,e._codeBlock=new re(Yr),e.sendSignal=e.sendSignal.bind(e),e.onCodeBlockPinsChanged=e.onCodeBlockPinsChanged.bind(e),e.onCodeBlockChanged=e.onCodeBlockChanged.bind(e),e._codeBlock.assetChanged.attach(e.onCodeBlockChanged),e}return Zr(CodeBlockConverterInstance,t),Object.defineProperty(CodeBlockConverterInstance.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlockConverterInstance.prototype,"codeBlock",{get:function(){return this._codeBlock.asset},set:function(t){this._codeBlock.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(CodeBlockConverterInstance.prototype,"customPins",{get:function(){return this._customPins},enumerable:!0,configurable:!0}),CodeBlockConverterInstance.prototype.destroy=function(){if(this._stateInitialized){this.executeFunction("onDestroy");for(var e=0,r=Object.keys(this._stateVariables);e<r.length;e++){var n=r[e],i=this._stateVariables[n].value;i&&i.constructor&&"VertexBuffer"===i.constructor.name&&i.unload(gt.context)}}this._codeBlock.asset&&this._codeBlock.asset.pinChanged.detach(this.onCodeBlockPinsChanged),this._codeBlock.detach(),t.prototype.destroy.call(this)},CodeBlockConverterInstance.prototype.isLoaded=function(){return S.isAssetRefLoaded(this._codeBlock)},CodeBlockConverterInstance.prototype.convert=function(){this.codeBlock.runtimeError||this.executeFunction("convert")},CodeBlockConverterInstance.prototype.onSignalReceived=function(t){this.codeBlock.runtimeError||this.executeFunction("onSignalReceived",t)},CodeBlockConverterInstance.prototype.onCodeBlockPinsChanged=function(){this.codeBlock&&(this._customPins=this.codeBlock.pins.copy())},CodeBlockConverterInstance.prototype.findPin=function(e){var r=t.prototype.findPin.call(this,e);if(!r){var n=this._customPins?this._customPins.data.find(function(t){return t.instance.id===e}):void 0;r=n?n.instance:void 0}return r},CodeBlockConverterInstance.prototype.filterPins=function(e){return t.prototype.filterPins.call(this,e).concat(this._customPins.data.filter(function(t){return e(t.instance)}).map(function(t){return t.instance}))},CodeBlockConverterInstance.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_codeBlock:t.properties.codeBlock}),delete t.properties.codeBlock),t},CodeBlockConverterInstance.prototype.executeFunction=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=this.codeBlock;try{var i=t+"_"+wr.trimId(n.id);return i in window?(this.initializeStateIfNecessary(),window[i].apply(window,[this._stateVariables,Tc.api,sr.createObject,this.sendSignal].concat(e))):void 0}catch(t){n.logRuntimeError("Runtime Error: '"+t.stack+"'")}},CodeBlockConverterInstance.prototype.onCodeBlockChanged=function(t){var e=t.oldAsset;e&&e.pinChanged.detach(this.onCodeBlockPinsChanged);var r=t.newAsset;r&&(this._customPins=r.pins.copy(),this._stateInitialized=!1,r.pinChanged.attach(this.onCodeBlockPinsChanged))},CodeBlockConverterInstance.prototype.initializeStateIfNecessary=function(){this._stateInitialized||(this._stateVariables=Bc.initializeCodeBlockInstanceState(this.codeBlock,this.ownerBehavior.ownerComponent.entity,this._customPins,this.sendSignal),this._stateInitialized=!0)},Jr([unserializable(),$r("design:type",Tt)],CodeBlockConverterInstance.prototype,"_customPins",void 0),Jr([unserializable(),$r("design:type",Object)],CodeBlockConverterInstance.prototype,"_stateVariables",void 0),Jr([unserializable(),$r("design:type",Object)],CodeBlockConverterInstance.prototype,"_stateInitialized",void 0),CodeBlockConverterInstance}(Dr),en=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),rn=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},nn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Signal=0]="Signal",t[t.Data=1]="Data"}(Cr||(Cr={}));var on=function(t){function Connection(e,r,n){var i=t.call(this)||this;return i.src=e||new be,i.dest=r||new be,i.type=n||Cr.Signal,i.id=S.makeUniqueId(),i}return en(Connection,t),rn([unserializable(),nn("design:type",String)],Connection.prototype,"id",void 0),Connection}(O),an=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),sn=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},cn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},un=void 0;var ln=function(t){function Behavior(){var e=t.call(this)||this;return e.inputsPosition=new it,e.outputsPosition=new it(150,150),e.pinChanged=new B.VoidAsyncEvent,e.inlineVariableChanged=new B.AsyncEvent,e._operators=new Tt(fr),e._customPins=new Tt(we),e._connections=new Rt(on),e._inlineVariables=new Rt(zr),e._pins=new Tt(we),e._activeOperators=[],e._finishedOperators=[],e._pins.grow(new Pe(cr.startPinId,fe.Input)),e}var e;return an(Behavior,t),e=Behavior,Object.defineProperty(Behavior.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"operators",{get:function(){return this._operators.data},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"connections",{get:function(){return this._connections.data},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"pins",{get:function(){return this._pins},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"customPins",{get:function(){return this._customPins},set:function(t){this._customPins=t},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"inlineVariables",{get:function(){return this._inlineVariables},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"activeOperators",{get:function(){return this._activeOperators},enumerable:!0,configurable:!0}),Object.defineProperty(Behavior.prototype,"ownerComponent",{get:function(){return this._ownerComponent},set:function(t){this._ownerComponent=t},enumerable:!0,configurable:!0}),Behavior.isConnectionValid=function(t,e,r){if(e.operatorId!==r.operatorId){var n=t.findPin(e.operatorId,e.pinId),i=t.findPin(r.operatorId,r.pinId);if(n&&i){var o=t.id;if(e.operatorId===o||r.operatorId===o){if(n.type===i.type)return Bc.pinsHaveSameType(n,i)}else if(n.type!==i.type)return Bc.pinsHaveSameType(n,i)}}return!1},Behavior.prototype.sendSignal=function(t,e){if(t in this._signalConnectionMap&&e in this._signalConnectionMap[t])for(var r=0,n=this._signalConnectionMap[t][e];r<n.length;r++){var i=n[r],o=this.findOperator(i.operatorId);o&&this.activateInputPin(o,i.pinId)}},Behavior.prototype.fetchInputData=function(t){var e=this._dataConnectionMap[t];if(e)for(var r=0,n=Object.keys(e);r<n.length;r++){var i=n[r],o=e[i],a=void 0,s=void 0;if(o.operatorId===this.id)a=this.findBehaviorPin(o.pinId);else{var c=this.findOperator(o.operatorId);c?(a=c.findPin(o.pinId),c.isA(Dr)&&(s=c)):a=this.findVariablePin(o.operatorId)}if(a)if(a.isA(xe)){var u=o.operatorId===this.id?fe.Input:fe.Output;if(a.type!==u)V.log("Trying to get data from an input pin "+a.name);else{s&&(this.fetchInputData(s.id),s.convert(),this.checkCodeBlockError(s));var l=a.getData(),p=this.findPin(t,i);if(p)if(p.isA(xe)){var f=t===this.id?fe.Output:fe.Input;p.type!==f?V.log("Trying to set data on an output pin "+p.name):p.setData(l)}else V.log("Trying to set data on a signal pin "+p.name)}}else V.log("Trying to get data from a signal pin "+a.name)}},Behavior.prototype.activateOperator=function(t){this._activeOperators.indexOf(t)>=0||this._activeOperators.push(t)},Behavior.prototype.setProperty=function(e,r){if(t.prototype.setProperty.call(this,e,r),"_operators"===e)for(var n=0,i=this._operators.data;n<i.length;n++){var o=i[n];o.instance&&(o.instance.ownerBehavior=this)}},Behavior.prototype.isLoaded=function(){for(var t=0,e=this._operators.data;t<e.length;t++){if(!e[t].instance.isLoaded())return!1}for(var r=0,n=this._inlineVariables.data;r<n.length;r++){var i=n[r];if(!Bc.isPinLoaded(i.data.instance))return!1}return!0},Behavior.prototype.start=function(){this.buildConnectionMaps();for(var t=0,e=this._operators.data;t<e.length;t++){e[t].instance.onBehaviorStarted()}if(this.id in this._signalConnectionMap&&cr.startPinId in this._signalConnectionMap[this.id])for(var r=0,n=this._signalConnectionMap[this.id][cr.startPinId];r<n.length;r++){var i=n[r],o=this.findOperator(i.operatorId);o&&this.activateInputPin(o,i.pinId)}},Behavior.prototype.update=function(){this._finishedOperators.length=0;for(var t=0,e=this._activeOperators;t<e.length;t++){var r=e[t];this.fetchInputData(r.id);var n=r.onUpdate();this.checkCodeBlockError(r),n===or.Finish&&this._finishedOperators.push(r)}if(this._finishedOperators.length>0)for(var i=0,o=this._finishedOperators;i<o.length;i++){r=o[i];var a=this._activeOperators.indexOf(r);console.assert(a>=0),this._activeOperators.splice(a,1),this.finishOperator(r)}},Behavior.prototype.addConnection=function(t){this._connections.grow(t)},Behavior.prototype.removeConnection=function(t){var e=this._connections.data.indexOf(t);return e>=0&&this._connections.data.splice(e,1),this.clearOrphanVariables()},Behavior.prototype.removeVariable=function(t){for(var e=0;e<this._connections.data.length;){var r=this._connections.data[e];r.src.operatorId===t.id||r.dest.operatorId===t.id?this._connections.data.splice(e,1):++e}for(e=0;e<this._inlineVariables.data.length;++e){if(this._inlineVariables.data[e].id===t.id){this._inlineVariables.data.splice(e,1);break}}},Behavior.prototype.removeNode=function(t){for(var e=[],r=0;r<this._connections.data.length;){var n=this._connections.data[r];n.src.operatorId===t.id||n.dest.operatorId===t.id?(e.push(n),this._connections.data.splice(r,1)):++r}for(r=0;r<this._operators.data.length;++r){var i=this._operators.data[r];if(i.instance&&i.instance===t){this._operators.data.splice(r,1);break}}return{removedConnections:e,removedVariables:this.clearOrphanVariables()}},Behavior.prototype.clearOrphanVariables=function(){for(var t=[],e=0;e<this._inlineVariables.data.length;){for(var r=0,n=this._inlineVariables.data[e],i=0,o=this._connections.data;i<o.length;i++){var a=o[i];a.src.operatorId!==n.id&&a.dest.operatorId!==n.id||++r}0===r?(this._inlineVariables.data.splice(e,1),t.push(n)):++e}return t},Behavior.prototype.addNode=function(t){this._operators.grow(t),t.ownerBehavior=this},Behavior.prototype.addVariable=function(t){this._inlineVariables.grow(t)},Behavior.prototype.findOperator=function(t){for(var e=0,r=this._operators.data;e<r.length;e++){var n=r[e];if(n.instance&&n.instance.id===t)return n.instance}},Behavior.prototype.findVariable=function(t){return this._inlineVariables.data.find(function(e){return e.id===t})},Behavior.prototype.findPin=function(t,e){if(t===this.id)return this.findBehaviorPin(e);var r=this.findOperator(t);return r?r.findPin(e):this.findVariablePin(t)},Behavior.prototype.copy=function(e){var r=this.id,n=t.prototype.copy.call(this);if(!0!==e)for(var i=n.id,o=0,a=n._connections.data;o<a.length;o++){var s=a[o];s.src.operatorId===r?s.src.operatorId=i:s.dest.operatorId===r&&(s.dest.operatorId=i)}else n.id=r;return n},Behavior.prototype.deserialize=function(e){return t.prototype.deserialize.call(this,e)},Behavior.prototype.updateInlineVariable=function(t,e){var r=this._inlineVariables.data.find(function(e){return e.id===t});if(r){var n=r.data.instance,i=e.data.instance;n.setData(i.getData())}},Behavior.prototype.destroy=function(){for(var e=0,r=this._operators.data;e<r.length;e++){r[e].instance.destroy()}t.prototype.destroy.call(this)},Behavior.prototype.onCollision=function(t){for(var e=0,r=this._operators.data;e<r.length;e++){var n=r[e].instance;n.isA(Ur)?n.onCollision(t):n.isA(Mr)&&n.onCollision(t)}},Behavior.prototype.onUIEvent=function(t){for(var e=!1,r=0,n=this._operators.data;r<n.length;r++){var i=n[r].instance;if(i.isA(Hr)){if(t(i)){e=!0;break}}else if(i.isA(Mr)){if(i.onUIEvent(t)){e=!0;break}}}return e},Behavior.prototype.upgrade=function(t,e){if(1===e)for(var r=0,n=t.properties._operators.data;r<n.length;r++){var i=n[r];"ScreenToWorldRay"===i.data.typeName&&(i.data.typeName="ScreenToRay")}return t},Behavior.prototype.startOperator=function(t){var e=t.onStart();this.checkCodeBlockError(t),e===or.Continue?this.activateOperator(t):this.finishOperator(t)},Behavior.prototype.finishOperator=function(t){t.onFinish(),this.sendSignal(t.id,cr.finishPinId)},Behavior.prototype.checkCodeBlockError=function(t){},Behavior.prototype.activateInputPin=function(t,e){if(this.fetchInputData(t.id),e===cr.startPinId)this.startOperator(t);else{var r=t.findPin(e);r&&(t.onSignalReceived(r.name),this.checkCodeBlockError(t))}},Behavior.prototype.buildConnectionMaps=function(){var t,r,n,i,o,a;this._signalConnectionMap={},this._dataConnectionMap={};for(var s=0,c=this._connections.data;s<c.length;s++){var u=c[s];if(e.isConnectionValid(this,u.src,u.dest))if(u.type===Cr.Signal){var l=u.src.operatorId,p=u.src.pinId,f={operatorId:u.dest.operatorId,pinId:u.dest.pinId};l in this._signalConnectionMap?p in this._signalConnectionMap[l]?this._signalConnectionMap[l][p].push(f):Object.assign(this._signalConnectionMap[l],((t={})[p]=[f],t)):Object.assign(this._signalConnectionMap,((r={})[l]=((n={})[p]=[f],n),r))}else{var h=u.dest.operatorId,d=u.dest.pinId,y={operatorId:u.src.operatorId,pinId:u.src.pinId};h in this._dataConnectionMap?d in this._dataConnectionMap[h]?this._dataConnectionMap[h][d]=y:Object.assign(this._dataConnectionMap[h],((i={})[d]=y,i)):Object.assign(this._dataConnectionMap,((o={})[h]=((a={})[d]=y,a),o))}}},Behavior.prototype.findBehaviorPin=function(t){var e=this._pins.data.find(function(e){return!!e.instance&&e.instance.id===t});return e||(e=this._customPins.data.find(function(e){return!!e.instance&&e.instance.id===t})),e?e.instance:void 0},Behavior.prototype.findVariablePin=function(t){var e=this.findVariable(t);return e?e.data.instance:void 0},Behavior.prototype.recordSignalFired=function(t,e,r,n){var i={timeStamp:Date.now(),entityId:this._ownerComponent.entity.id,behaviorPath:this.templatePath,srcOperatorId:t,srcPinId:e,destOperatorId:r,destPinId:n};localStorage.setItem("secondary_editor_signal_fired",JSON.stringify(i)),un.signalFired.post(i)},sn([unserializable(),cn("design:type",Object)],Behavior.prototype,"pinChanged",void 0),sn([unserializable(),cn("design:type",Object)],Behavior.prototype,"inlineVariableChanged",void 0),sn([unserializable(),cn("design:type",Object)],Behavior.prototype,"_pins",void 0),sn([unserializable(),cn("design:type",Object)],Behavior.prototype,"_signalConnectionMap",void 0),sn([unserializable(),cn("design:type",Object)],Behavior.prototype,"_dataConnectionMap",void 0),sn([unserializable(),cn("design:type",Object)],Behavior.prototype,"_ownerComponent",void 0),sn([unserializable(),cn("design:type",Array)],Behavior.prototype,"_activeOperators",void 0),sn([unserializable(),cn("design:type",Array)],Behavior.prototype,"_finishedOperators",void 0),Behavior=e=sn([hasDedicatedEditor(!0),cn("design:paramtypes",[])],Behavior)}(F),pn=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),fn=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},hn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},dn=void 0;var yn,mn=function(t){function BehaviorComponent(){var e=t.call(this)||this;return e.autoStart=!0,e._customPins=new Tt(we),e._uniqueBehaviorInstance=null,e._behavior=new re(ln),e.onBehaviorPinChanged=e.onBehaviorPinChanged.bind(e),e.onBehaviorInlineVariableChanged=e.onBehaviorInlineVariableChanged.bind(e),e.onBehaviorChanged=e.onBehaviorChanged.bind(e),e._behavior.assetChanged.attach(e.onBehaviorChanged),e}return pn(BehaviorComponent,t),Object.defineProperty(BehaviorComponent.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(BehaviorComponent.prototype,"behavior",{get:function(){return this._behavior.asset},set:function(t){this._behavior.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(BehaviorComponent.prototype,"customPins",{get:function(){return this._customPins},enumerable:!0,configurable:!0}),Object.defineProperty(BehaviorComponent.prototype,"activeOperators",{get:function(){return this.behavior?this.behavior.activeOperators:[]},enumerable:!0,configurable:!0}),BehaviorComponent.prototype.isLoaded=function(){if(!t.prototype.isLoaded.call(this))return!1;if(this._customPins)for(var e=0,r=this._customPins.data;e<r.length;e++){var n=r[e];if(!Bc.isPinLoaded(n.instance))return!1}return S.isAssetRefLoaded(this._behavior)},BehaviorComponent.prototype.destroy=function(){var e=this.behavior;e&&(e.pinChanged.detach(this.onBehaviorPinChanged),e.inlineVariableChanged.detach(this.onBehaviorInlineVariableChanged)),this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.destroy(),this._uniqueBehaviorInstance=null),this._behavior.detach(),t.prototype.destroy.call(this)},BehaviorComponent.prototype.start=function(){var t=this.behavior;t&&(this._uniqueBehaviorInstance?this._uniqueBehaviorInstance.sendSignal(this._uniqueBehaviorInstance.id,cr.startPinId):(this._uniqueBehaviorInstance=t.copy(!0),this._uniqueBehaviorInstance.ownerComponent=this,this._customPins?this._uniqueBehaviorInstance.customPins=this._customPins:V.logWarning("BehaviorComponent.start: undefined customPins"),this._uniqueBehaviorInstance.start()))},BehaviorComponent.prototype.update=function(){this.behavior&&(this._uniqueBehaviorInstance?this._uniqueBehaviorInstance.update():this.autoStart&&this.start())},BehaviorComponent.prototype.onCollision=function(t){this._uniqueBehaviorInstance&&this._uniqueBehaviorInstance.onCollision(t)},BehaviorComponent.prototype.onUIEvent=function(t){return!!this._uniqueBehaviorInstance&&this._uniqueBehaviorInstance.onUIEvent(t)},BehaviorComponent.prototype.sendSignal=function(t){this._uniqueBehaviorInstance||this.start();var e=this._uniqueBehaviorInstance,r=e.customPins.data.find(function(e){return e.instance.name===t});r?e.sendSignal(e.id,r.instance.id):V.logWarning("Could not fire signal '"+t+"' (pin not found)")},BehaviorComponent.prototype.getPins=function(){return this._customPins},BehaviorComponent.prototype.setPins=function(t){this._customPins=t},BehaviorComponent.prototype.findPinByName=function(t){for(var e=0,r=this._customPins.data;e<r.length;e++){var n=r[e].instance;if(n.name===t)return n}},BehaviorComponent.prototype.upgrade=function(t,e){if(1===e)Object.assign(t.properties,{_behavior:t.properties.behavior}),delete t.properties.behavior;else if(2===e){var r=t.properties._customPins,n=t.properties._behavior;delete t.properties._customPins,delete t.properties._behavior,t.properties._customPins=r.data,t.properties._behavior=n}return t},BehaviorComponent.prototype.onBehaviorChanged=function(t){this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.destroy(),this._uniqueBehaviorInstance=null);var e=t.newAsset;e&&this.buildCustomPins(e)},BehaviorComponent.prototype.buildCustomPins=function(t){for(var e=new Tt(we),r=[],n=function(t){var n=t.instance;if(n){var o=void 0;if(i._customPins){var a=i._customPins.data.find(function(t){return t.instance.id===n.id}),s=a?a.instance:void 0;s&&s.type===n.type&&Bc.pinsHaveSameType(s,n)&&((o=s).name=n.name)}o?e.grow(o):(e.grow(n.copy()),r.push(n.id))}},i=this,o=0,a=t.customPins.data;o<a.length;o++){n(a[o])}return this._customPins=e,Bc.updatePinAccessors(this),r},BehaviorComponent.prototype.onBehaviorPinChanged=function(){var t=this.behavior,e=this.buildCustomPins(t);this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.customPins=this._customPins),dn&&dn.behaviorComponentPinsChanged.post({ownerId:t.id,pinIds:e})},BehaviorComponent.prototype.onBehaviorInlineVariableChanged=function(t){if(this._uniqueBehaviorInstance){var e=this.behavior.inlineVariables.data.find(function(e){return e.id===t});e&&this._uniqueBehaviorInstance.updateInlineVariable(t,e)}},fn([Attributes_hidden(),hn("design:type",Object)],BehaviorComponent.prototype,"_customPins",void 0),fn([unserializable(),hn("design:type",Object)],BehaviorComponent.prototype,"_uniqueBehaviorInstance",void 0),BehaviorComponent=fn([helpUrl("https://docs.spiderengine.io/behavior.html"),hn("design:paramtypes",[])],BehaviorComponent)}(kt);!function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right",t[t.Stretch=3]="Stretch"}(yn||(yn={}));var vn,gn=function(){function HorizontalAlignmentMetadata(){}return HorizontalAlignmentMetadata.literals={Left:0,Center:1,Right:2,Stretch:3},HorizontalAlignmentMetadata}();!function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Bottom=2]="Bottom",t[t.Stretch=3]="Stretch"}(vn||(vn={}));var _n,bn=function(){function VerticalAlignmentMetadata(){}return VerticalAlignmentMetadata.literals={Top:0,Center:1,Bottom:2,Stretch:3},VerticalAlignmentMetadata}();!function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(_n||(_n={}));var wn,Pn=function(){function TextAlignmentMetadata(){}return TextAlignmentMetadata.literals={Left:0,Center:1,Right:2},TextAlignmentMetadata}(),xn=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),On=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Cn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Sn=function(t){function Layout(){var e=null!==t&&t.apply(this,arguments)||this;return e._horizontalAlignment=yn.Left,e._verticalAlignment=vn.Top,e._pivot=new it,e._offset=new H,e._width=new mt,e._height=new mt,e._margin=new Ct,e._rotation=new ut,e._scale=new it(1,1),e._tint=new Z(1,1,1,1),e._inheritTint=!0,e._worldMatrix=new st,e._actualWidth=0,e._actualHeight=0,e._finalTint=new Z(1,1,1,1),e}return xn(Layout,t),Object.defineProperty(Layout.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"offset",{get:function(){return this._offset},set:function(t){this._offset.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"pivot",{get:function(){return this._pivot},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"horizontalAlignment",{get:function(){return this._horizontalAlignment},set:function(t){this._horizontalAlignment=t},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"verticalAlignment",{get:function(){return this._verticalAlignment},set:function(t){this._verticalAlignment=t},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"margin",{get:function(){return this._margin},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"inheritTint",{get:function(){return this._inheritTint},set:function(t){this._inheritTint=t},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"actualWidth",{get:function(){return this._actualWidth},set:function(t){this._actualWidth=t},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"actualHeight",{get:function(){return this._actualHeight},set:function(t){this._actualHeight=t},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"worldMatrix",{get:function(){return this._worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"finalTint",{get:function(){return this._finalTint},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"right",{get:function(){return this._worldMatrix.decompose(H.dummy,ut.dummy,H.dummy),H.fromPool().copy(H.right).rotate(ut.dummy).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"forward",{get:function(){return this._worldMatrix.decompose(H.dummy,ut.dummy,H.dummy),H.fromPool().copy(H.forward).rotate(ut.dummy).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"up",{get:function(){return this._worldMatrix.decompose(H.dummy,ut.dummy,H.dummy),H.fromPool().copy(H.up).rotate(ut.dummy).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"localRight",{get:function(){return H.fromPool().copy(H.right).rotate(this.rotation).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"localForward",{get:function(){return H.fromPool().copy(H.forward).rotate(this.rotation).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"localUp",{get:function(){return H.fromPool().copy(H.up).rotate(this.rotation).normalize()},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"absoluteScale",{get:function(){return this.worldMatrix.getScale(H.fromPool())},enumerable:!0,configurable:!0}),Object.defineProperty(Layout.prototype,"absolutePos",{get:function(){return H.fromPool().setFromMatrix(this.worldMatrix)},enumerable:!0,configurable:!0}),Layout.prototype.upgrade=function(t,e){return 1===e?(t.properties.offset=t.properties.position,delete t.properties.position):2===e&&(Object.assign(t.properties,{_horizontalAlignment:t.properties.horizontalAlignment,_verticalAlignment:t.properties.verticalAlignment,_pivot:t.properties.pivot,_offset:t.properties.offset,_width:t.properties.width,_height:t.properties.height,_margin:t.properties.margin,_rotation:t.properties.rotation,_scale:t.properties.scale}),delete t.properties.horizontalAlignment,delete t.properties.verticalAlignment,delete t.properties.pivot,delete t.properties.offset,delete t.properties.width,delete t.properties.height,delete t.properties.margin,delete t.properties.rotation,delete t.properties.scale),t},Layout.horizontalAlignmentPropertyKey="_horizontalAlignment",Layout.verticalAlignmentPropertyKey="_verticalAlignment",Layout.rotationKey="_rotation",Layout.offsetKey="_offset",Layout.scaleKey="_scale",On([Attributes_enumLiterals(gn.literals),Cn("design:type",Object)],Layout.prototype,"_horizontalAlignment",void 0),On([Attributes_enumLiterals(bn.literals),Cn("design:type",Object)],Layout.prototype,"_verticalAlignment",void 0),On([unserializable(),Cn("design:type",Object)],Layout.prototype,"_worldMatrix",void 0),On([unserializable(),Cn("design:type",Object)],Layout.prototype,"_actualWidth",void 0),On([unserializable(),Cn("design:type",Object)],Layout.prototype,"_actualHeight",void 0),On([unserializable(),Cn("design:type",Object)],Layout.prototype,"_finalTint",void 0),Layout=On([mandatory(),sortOrder(0),helpUrl("https://docs.spiderengine.io/2d/layout.html")],Layout)}(kt),Rn=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),jn=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Tn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},En=function(t){function Texture(){var e=null!==t&&t.apply(this,arguments)||this;return e._textureId=null,e}return Rn(Texture,t),Object.defineProperty(Texture.prototype,"textureId",{get:function(){return this._textureId},enumerable:!0,configurable:!0}),Texture.prototype.getWidth=function(){return 0},Texture.prototype.getHeight=function(){return 0},Texture.prototype.begin=function(t){return!1},Texture.prototype.graphicUnload=function(){this._textureId&&(gt.context.deleteTexture(this._textureId),this._textureId=null)},jn([unserializable(),Tn("design:type",Object)],Texture.prototype,"_textureId",void 0),Texture}(q),Bn=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),An=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},In=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Mn=void 0;(function(t){t[t.JPEG=0]="JPEG",t[t.PNG=1]="PNG"})(wn||(wn={}));var kn,zn=function(){function TexturePublishFormatMetadata(){}return TexturePublishFormatMetadata.literals={JPEG:0,PNG:1},TexturePublishFormatMetadata}();(kn||(kn={})).textureDataPropertyKey="_textureData";var Fn,Dn=function(t){function Texture2D(e){var r=t.call(this)||this;return r._filtering=s.Linear,r._repeat=!0,r._mipMaps=!0,r._publishFormat=wn.JPEG,r._textureDataLoaded=!1,e&&r.setState(e),r}return Bn(Texture2D,t),Object.defineProperty(Texture2D.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(Texture2D.prototype,"image",{get:function(){return this._image},enumerable:!0,configurable:!0}),Object.defineProperty(Texture2D.prototype,"publishFormat",{get:function(){return this._publishFormat},set:function(t){this._publishFormat=t},enumerable:!0,configurable:!0}),Object.defineProperty(Texture2D.prototype,"textureData",{get:function(){return this._textureData},set:function(t){var e=this;this._textureId&&this.graphicUnload(),this._textureDataLoaded=!1,this._textureData=t,delete this._canvas,delete this._pixels,this.loadTextureData(function(){Mn&&Mn.textureDataLoaded.post(e)})},enumerable:!0,configurable:!0}),Texture2D.prototype.getWidth=function(){return this._textureDataLoaded?this._image.width:0},Texture2D.prototype.getHeight=function(){return this._textureDataLoaded?this._image.height:0},Texture2D.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r),e===kn.textureDataPropertyKey?this.textureData=r:this._textureId&&this.setupTexture()},Texture2D.prototype.isLoaded=function(){return this._textureDataLoaded},Texture2D.prototype.begin=function(t){if(!this._textureId){if(!this._textureDataLoaded)return!1;if(!this.graphicLoad())return!1}var e=gt.context;return e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),!0},Texture2D.prototype.loadTextureData=function(t){var e=this;this._textureDataLoaded?t():(this._image=new Image,this._image.onload=function(){e._textureDataLoaded=!0,t()},this._image.src=this._textureData)},Texture2D.prototype.graphicLoad=function(){return!!this._textureId||!!this.setupTexture()},Texture2D.prototype.getPixel=function(t,e,r){if(!this._canvas){this._canvas=document.createElement("canvas"),this._canvas.width=this._image.width,this._canvas.height=this._image.height;var n=this._canvas.getContext("2d");n&&(n.drawImage(this._image,0,0),this._pixels=n.getImageData(0,0,this._canvas.width,this._canvas.height).data)}var i=e*this._canvas.width*4+4*t;r.r=this._pixels[i+0],r.g=this._pixels[i+1],r.b=this._pixels[i+2],r.a=this._pixels[i+3]},Texture2D.prototype.upgrade=function(t,e){return 2===e&&(Object.assign(t.properties,{_mipMaps:t.properties._generateMipMaps}),delete t.properties._generateMipMaps),t},Texture2D.prototype.setupTexture=function(){if(console.assert(this.isLoaded()),!this.isLoaded())return V.logWarning("Trying to render with a texture that is not loaded yet '"+this.templatePath+"'"),!1;var t=gt.context;this._textureId||(this._textureId=t.createTexture()),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._textureId),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this._image),this._filtering===s.Nearest?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);var e=!1;if(K.isPowerOf2(this._image.width)&&K.isPowerOf2(this._image.height)&&(e=!0),e){var r=this._repeat?t.REPEAT:t.CLAMP_TO_EDGE;t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,r),this._mipMaps?(this._filtering===s.Nearest?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_LINEAR):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.generateMipmap(t.TEXTURE_2D)):this._filtering===s.Nearest?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)}else t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._filtering===s.Nearest?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR);return!0},An([Attributes_enumLiterals(l.literals),In("design:type",Object)],Texture2D.prototype,"_filtering",void 0),An([Attributes_enumLiterals(zn.literals),In("design:type",Object)],Texture2D.prototype,"_publishFormat",void 0),An([Attributes_hidden(),In("design:type",String)],Texture2D.prototype,"_textureData",void 0),An([unserializable(),In("design:type",Object)],Texture2D.prototype,"_textureDataLoaded",void 0),An([unserializable(),In("design:type",HTMLImageElement)],Texture2D.prototype,"_image",void 0),An([unserializable(),In("design:type",HTMLCanvasElement)],Texture2D.prototype,"_canvas",void 0),An([unserializable(),In("design:type",Uint8ClampedArray)],Texture2D.prototype,"_pixels",void 0),Texture2D=An([displayName("Texture 2D"),referencable(!0),In("design:paramtypes",[Object])],Texture2D)}(En),Nn=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ln=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Vn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Stretch=0]="Stretch",t[t.Tile=1]="Tile"}(Fn||(Fn={}));var Un,Wn=function(){function SpriteRenderModeMetadata(){}return SpriteRenderModeMetadata.literals={Stretch:0,Tile:1},SpriteRenderModeMetadata}(),qn=function(t){function Sprite(){var e=null!==t&&t.apply(this,arguments)||this;return e.texture=new re(Dn),e.borderSize=new it,e.renderMode=Fn.Stretch,e.borderMode=Fn.Stretch,e}return Nn(Sprite,t),Sprite.prototype.destroy=function(){this.texture.detach(),t.prototype.destroy.call(this)},Sprite.prototype.isLoaded=function(){return S.isAssetRefLoaded(this.texture)},Sprite.prototype.tesselateInPixelsUnits=function(t,e,r,n,i){var o=this.texture.asset;o&&this.tesselateInternal(t,n,i,o.getWidth(),o.getHeight(),this.borderSize.x,this.borderSize.y,e,r)},Sprite.prototype.tesselateInWorldUnits=function(t){var e=this.texture.asset;e&&this.tesselateInternal(t,1,1,1,1,this.borderSize.x/e.getWidth(),this.borderSize.y/e.getHeight(),0,0)},Sprite.prototype.tesselateInternal=function(t,e,r,n,i,o,a,s,c){var u=8,l=0,p=0;if(this.renderMode===Fn.Tile){var f=(e-2*o)/(P=n-2*o),h=Math.floor(f);p=h,f-h>0&&++p;var d=(r-2*a)/(x=i-2*a),y=Math.floor(d);l=y,d-y>0&&++l,p=Math.max(p,1),u+=(l=Math.max(l,1))*p}else u++;var m=6*u,v=t.data.position;v.length=3*m;var g=t.data.uv;g.length=2*m,t.vertexCount=m;var _=this.makeQuadPos(v,0,0,0,o,a,s,c);if(_=this.makeQuadPos(v,_,o,0,e-2*o,a,s,c),_=this.makeQuadPos(v,_,e-o,0,o,a,s,c),_=this.makeQuadPos(v,_,0,a,o,r-2*a,s,c),this.renderMode===Fn.Tile)for(var b=o,w=a,P=n-2*o,x=i-2*a,O=0;O<l;++O){w+(j=x)>r-a&&(j=Math.max(r-a-w,0));for(var C=0;C<p;++C){b+(B=P)>e-o&&(B=Math.max(e-o-b,0)),_=this.makeQuadPos(v,_,b,w,B,j,s,c),b+=P}b=o,w+=x}else _=this.makeQuadPos(v,_,o,a,e-2*o,r-2*a,s,c);_=this.makeQuadPos(v,_,e-o,a,o,r-2*a,s,c),_=this.makeQuadPos(v,_,0,r-a,o,a,s,c),_=this.makeQuadPos(v,_,o,r-a,e-2*o,a,s,c),_=this.makeQuadPos(v,_,e-o,r-a,o,a,s,c),console.assert(_===3*t.vertexCount);var S=o/n,R=a/i;if(_=this.makeQuadUv(g,0,0,1,S,1-R),_=this.makeQuadUv(g,_,S,1,1-S,1-R),_=this.makeQuadUv(g,_,1-S,1,1,1-R),_=this.makeQuadUv(g,_,0,1-R,S,R),this.renderMode===Fn.Tile)for(b=o,w=a,P=n-2*o,x=i-2*a,O=0;O<l;++O){var j,T=1-S,E=R;w+(j=x)>r-a&&(E+=(x-(j=r-a-w))/i);for(C=0;C<p;++C){var B;b+(B=P)>e-o&&(T-=(P-(B=e-o-b))/n),_=this.makeQuadUv(g,_,S,1-R,T,E),b+=P}b=o,w+=x}else _=this.makeQuadUv(g,_,S,1-R,1-S,R);_=this.makeQuadUv(g,_,1-S,1-R,1,R),_=this.makeQuadUv(g,_,0,R,S,0),_=this.makeQuadUv(g,_,S,R,1-S,0),_=this.makeQuadUv(g,_,1-S,R,1,0),console.assert(_===2*t.vertexCount),t.dirtifyData("position"),t.dirtifyData("uv")},Sprite.prototype.makeQuadPos=function(t,e,r,n,i,o,a,s){var c=r+a,u=r+i+a,l=n+s,p=n+o+s;return t[e+0]=c,t[e+1]=l,t[e+2]=0,t[e+3]=u,t[e+4]=l,t[e+5]=0,t[e+6]=c,t[e+7]=p,t[e+8]=0,t[e+9]=c,t[e+10]=p,t[e+11]=0,t[e+12]=u,t[e+13]=l,t[e+14]=0,t[e+15]=u,t[e+16]=p,t[e+17]=0,e+18},Sprite.prototype.makeQuadUv=function(t,e,r,n,i,o){return t[e+0]=r,t[e+1]=n,t[e+2]=i,t[e+3]=n,t[e+4]=r,t[e+5]=o,t[e+6]=r,t[e+7]=o,t[e+8]=i,t[e+9]=n,t[e+10]=i,t[e+11]=o,e+12},Ln([Attributes_enumLiterals(Wn.literals),Vn("design:type",Object)],Sprite.prototype,"renderMode",void 0),Ln([Attributes_enumLiterals(Wn.literals),Vn("design:type",Object)],Sprite.prototype,"borderMode",void 0),Sprite}(F),Gn=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Hn=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a};!function(t){(Un||(Un={})).countTiles=function countTiles(t,e){var r=t.getWidth()/Math.max(e.x,1);return t.getHeight()/Math.max(e.y,1)*r}}();var Xn,Kn=function(t){function SpriteSheet(){var e=null!==t&&t.apply(this,arguments)||this;return e._texture=new re(Dn),e._tileSize=new it(32,32),e._tileCount=4,e}return Gn(SpriteSheet,t),Object.defineProperty(SpriteSheet.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheet.prototype,"texture",{get:function(){return this._texture.asset},set:function(t){this._texture.asset=t,t&&(this._tileCount=Un.countTiles(t,this._tileSize))},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheet.prototype,"tileSize",{get:function(){return this._tileSize},set:function(t){this._tileSize.copy(t),this.texture&&(this._tileCount=Un.countTiles(this.texture,this._tileSize))},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheet.prototype,"tileCount",{get:function(){return this._tileCount},enumerable:!0,configurable:!0}),SpriteSheet.prototype.isLoaded=function(){return S.isAssetRefLoaded(this._texture)},SpriteSheet.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_tileSize:t.properties.tileSize,_tileCount:t.properties.tileCount}),delete t.properties.tileSize,delete t.properties.tileCount),t},SpriteSheet=Hn([displayName("Sprite Sheet")],SpriteSheet)}(F),Qn=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Yn=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Zn=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Jn=function(t){function UIFill(){return null!==t&&t.apply(this,arguments)||this}return Qn(UIFill,t),UIFill.prototype.isLoaded=function(){return!0},UIFill}(O),$n=function(t){function MaterialFill(){var e=null!==t&&t.apply(this,arguments)||this;return e._material=new re(Cu),e}return Qn(MaterialFill,t),Object.defineProperty(MaterialFill.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(MaterialFill.prototype,"material",{get:function(){return this._material.asset},set:function(t){this._material.asset=t},enumerable:!0,configurable:!0}),MaterialFill.prototype.isLoaded=function(){return S.isAssetRefLoaded(this._material)},MaterialFill.prototype.destroy=function(){this._material.detach(),t.prototype.destroy.call(this)},MaterialFill.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_material:t.properties.material}),delete t.properties.material),t},MaterialFill=Yn([displayName("Material")],MaterialFill)}(Jn),ti=function(t){function SpriteFill(e){var r=t.call(this)||this;return r.sprite=new re(qn),r._color=new Z(1,1,1,1),r._isDirty=!0,r._width=0,r._height=0,r._offsetX=0,r._offsetY=0,r._renderMode=Fn.Stretch,r._borderMode=Fn.Stretch,e&&(r.sprite.asset=e),r}return Qn(SpriteFill,t),Object.defineProperty(SpriteFill.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteFill.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),SpriteFill.prototype.isLoaded=function(){return S.isAssetRefLoaded(this.sprite)},SpriteFill.prototype.destroy=function(){this._vertexBuffer&&this._vertexBuffer.unload(gt.context),this.sprite.detach(),t.prototype.destroy.call(this)},SpriteFill.prototype.tesselate=function(t){this._vertexBuffer||(this._vertexBuffer=new Ot,this._vertexBuffer.isDynamic=!0,this._vertexBuffer.primitiveType="TRIANGLES",this._vertexBuffer.setData("position",[]),this._vertexBuffer.setData("uv",[])),t.actualWidth!==this._width&&(this._width=t.actualWidth,this._isDirty=!0),t.actualHeight!==this._height&&(this._height=t.actualHeight,this._isDirty=!0);var e=-t.pivot.x*t.actualWidth,r=-t.pivot.y*t.actualHeight;e!==this._offsetX&&(this._offsetX=e,this._isDirty=!0),r!==this._offsetY&&(this._offsetY=r,this._isDirty=!0);var n=this.sprite.asset,i=n?n.texture.asset:null;return n&&i&&(n.renderMode!==this._renderMode&&(this._renderMode=n.renderMode,this._isDirty=!0),n.borderMode!==this._borderMode&&(this._borderMode=n.borderMode,this._isDirty=!0),n.texture.id!==this._textureId&&(this._textureId=n.texture.id,this._isDirty=!0),this._isDirty&&(n.tesselateInPixelsUnits(this._vertexBuffer,e,r,t.actualWidth,t.actualHeight),this._isDirty=!1)),this._vertexBuffer},SpriteFill.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_color:t.properties.tint}),delete t.properties.tint),t},Yn([unserializable(),Zn("design:type",Ot)],SpriteFill.prototype,"_vertexBuffer",void 0),Yn([unserializable(),Zn("design:type",Object)],SpriteFill.prototype,"_isDirty",void 0),Yn([unserializable(),Zn("design:type",Object)],SpriteFill.prototype,"_width",void 0),Yn([unserializable(),Zn("design:type",Object)],SpriteFill.prototype,"_height",void 0),Yn([unserializable(),Zn("design:type",Object)],SpriteFill.prototype,"_offsetX",void 0),Yn([unserializable(),Zn("design:type",Object)],SpriteFill.prototype,"_offsetY",void 0),Yn([unserializable(),Zn("design:type",Object)],SpriteFill.prototype,"_renderMode",void 0),Yn([unserializable(),Zn("design:type",Object)],SpriteFill.prototype,"_borderMode",void 0),Yn([unserializable(),Zn("design:type",Object)],SpriteFill.prototype,"_textureId",void 0),SpriteFill=Yn([displayName("Sprite"),Zn("design:paramtypes",[qn])],SpriteFill)}(Jn),ei=function(t){function TextureFill(e,r){var n=t.call(this)||this;return n._color=new Z(1,1,1,1),n._texture=new re(En),e&&(n.texture=e),r&&n._color.copy(r),n}return Qn(TextureFill,t),Object.defineProperty(TextureFill.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(TextureFill.prototype,"texture",{get:function(){return this._texture.asset},set:function(t){this._texture.setAssetFast(t)},enumerable:!0,configurable:!0}),Object.defineProperty(TextureFill.prototype,"textureRef",{get:function(){return this._texture},enumerable:!0,configurable:!0}),Object.defineProperty(TextureFill.prototype,"color",{get:function(){return this._color},set:function(t){this._color.copy(t)},enumerable:!0,configurable:!0}),TextureFill.prototype.isLoaded=function(){return S.isAssetRefLoaded(this._texture)},TextureFill.prototype.destroy=function(){this._texture.detach(),t.prototype.destroy.call(this)},TextureFill.prototype.upgrade=function(t,e){return 1===e?(Object.assign(t.properties,{_texture:t.properties.texture}),delete t.properties.texture):2===e&&(Object.assign(t.properties,{_color:t.properties.tint}),delete t.properties.tint),t},TextureFill=Yn([displayName("Texture"),Zn("design:paramtypes",[En,Z])],TextureFill)}(Jn),ri=function(t){function ColorFill(e){var r=t.call(this)||this;return r.color=new Z(1,1,1,1),e&&r.color.copy(e),r}return Qn(ColorFill,t),ColorFill=Yn([displayName("Color"),Zn("design:paramtypes",[Z])],ColorFill)}(Jn),ni=function(t){function SpriteSheetFill(e){var r=t.call(this)||this;return r._color=new Z(1,1,1,1),r._spriteSheet=new re(Kn),r._currentTile=0,r._isDirty=!0,r._offsetX=0,r._offsetY=0,r._currentTesselatedTile=0,e&&(r._spriteSheet.asset=e),r}return Qn(SpriteSheetFill,t),Object.defineProperty(SpriteSheetFill.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"texture",{get:function(){return this._spriteSheet.asset?this._spriteSheet.asset.texture:null},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"tileSize",{get:function(){return this._spriteSheet.asset?this._spriteSheet.asset.tileSize:it.zero},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"currentTile",{get:function(){return this._currentTile},set:function(t){this._currentTile=t},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"spriteSheet",{get:function(){return this._spriteSheet.asset},set:function(t){this._spriteSheet.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"color",{get:function(){return this._color},enumerable:!0,configurable:!0}),SpriteSheetFill.prototype.isLoaded=function(){return S.isAssetRefLoaded(this._spriteSheet)},SpriteSheetFill.prototype.destroy=function(){this._vertexBuffer&&this._vertexBuffer.unload(gt.context),this._spriteSheet.detach(),t.prototype.destroy.call(this)},SpriteSheetFill.prototype.tesselate=function(t){this._vertexBuffer||(this._vertexBuffer=new Ot,this._vertexBuffer.isDynamic=!0,this._vertexBuffer.setData("position",[0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,1,1,0]),this._vertexBuffer.setData("uv",[0,1,1,1,0,0,0,0,1,1,1,0]),this._vertexBuffer.primitiveType="TRIANGLES");var e=this.texture;if(e){var r=-t.pivot.x*t.actualWidth,n=-t.pivot.y*t.actualHeight;if(r!==this._offsetX&&(this._offsetX=r,this._isDirty=!0),n!==this._offsetY&&(this._offsetY=n,this._isDirty=!0),this._currentTesselatedTile!==this._currentTile&&(this._currentTesselatedTile=this._currentTile,this._isDirty=!0),this._isDirty){var i=this._vertexBuffer.data.position;i[0]=0+r,i[1]=0+n,i[2]=0,i[3]=t.actualWidth+r,i[4]=0+n,i[5]=0,i[6]=0+r,i[7]=t.actualHeight+n,i[8]=0,i[9]=0+r,i[10]=t.actualHeight+n,i[11]=0,i[12]=t.actualWidth+r,i[13]=0+n,i[14]=0,i[15]=t.actualWidth+r,i[16]=t.actualHeight+n,i[17]=0;var o=e.getWidth()/Math.max(this.tileSize.x,1),a=e.getHeight()/Math.max(this.tileSize.y,1),s=Math.floor(this.currentTile/o),c=Math.round(this.currentTile)%o,u=this._vertexBuffer.data.uv,l=1/o,p=1/a,f=1/e.getWidth()/2*(c>0?1:0),h=1/e.getHeight()/2*(s>0?1:0);u[0]=l*c+f,u[1]=1-(p*s+h),u[2]=l*c+l-f,u[3]=1-(p*s+h),u[4]=l*c+f,u[5]=1-(p*s+p-h),u[6]=l*c+f,u[7]=1-(p*s+p-h),u[8]=l*c+l-f,u[9]=1-(p*s+h),u[10]=l*c+l-f,u[11]=1-(p*s+p-h),this._vertexBuffer.dirtifyData("position"),this._vertexBuffer.dirtifyData("uv"),this._isDirty=!1}}return this._vertexBuffer},SpriteSheetFill.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_color:t.properties.tint}),delete t.properties.tint),t},Yn([unserializable(),Zn("design:type",Ot)],SpriteSheetFill.prototype,"_vertexBuffer",void 0),Yn([unserializable(),Zn("design:type",Object)],SpriteSheetFill.prototype,"_isDirty",void 0),Yn([unserializable(),Zn("design:type",Object)],SpriteSheetFill.prototype,"_offsetX",void 0),Yn([unserializable(),Zn("design:type",Object)],SpriteSheetFill.prototype,"_offsetY",void 0),Yn([unserializable(),Zn("design:type",Object)],SpriteSheetFill.prototype,"_currentTesselatedTile",void 0),SpriteSheetFill=Yn([displayName("SpriteSheet"),Zn("design:paramtypes",[Kn])],SpriteSheetFill)}(Jn),ii=function(t){function SpriteSheetMaterialFill(){var e=null!==t&&t.apply(this,arguments)||this;return e._material=new re(Cu),e}return Qn(SpriteSheetMaterialFill,t),Object.defineProperty(SpriteSheetMaterialFill.prototype,"material",{get:function(){return this._material.asset},set:function(t){this._material.asset=t},enumerable:!0,configurable:!0}),SpriteSheetMaterialFill.prototype.isLoaded=function(){return!!t.prototype.isLoaded.call(this)&&S.isAssetRefLoaded(this._material)},SpriteSheetMaterialFill.prototype.destroy=function(){this._material.detach(),t.prototype.destroy.call(this)},SpriteSheetMaterialFill=Yn([displayName("SpriteSheet Material")],SpriteSheetMaterialFill)}(ni),oi=function(){function GraphicUtils(){}return GraphicUtils.drawVertexBuffer=function(t,e,r){e.begin(t,r),e.draw(t),e.end(t,r)},GraphicUtils}();!function(t){t.quad=new Ot,t.quad.setData("position",[0,0,0,1,0,0,1,1,0,0,0,0,1,1,0,0,1,0]),t.quad.setData("uv",[0,0,1,0,1,1,0,0,1,1,0,1]),t.quad.setData("normal",[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]),t.quad.primitiveType="TRIANGLES",t.centeredQuad=new Ot,t.centeredQuad.setData("position",[-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0]),t.centeredQuad.setData("uv",t.quad.data.uv),t.centeredQuad.setData("normal",t.quad.data.normal),t.centeredQuad.primitiveType="TRIANGLES",t.uiQuad=new Ot,t.uiQuad.setData("position",[0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,1,1,0]),t.uiQuad.setData("uv",[0,1,1,1,0,0,0,0,1,1,1,0]),t.uiQuad.primitiveType="TRIANGLES"}(Xn||(Xn={}));var ai,si,ci,ui,li,pi=function(){function GeometryProvider(){}return Object.defineProperty(GeometryProvider,"quad",{get:function(){return Xn.quad},enumerable:!0,configurable:!0}),Object.defineProperty(GeometryProvider,"centeredQuad",{get:function(){return Xn.centeredQuad},enumerable:!0,configurable:!0}),Object.defineProperty(GeometryProvider,"uiQuad",{get:function(){return Xn.uiQuad},enumerable:!0,configurable:!0}),Object.defineProperty(GeometryProvider,"skyBox",{get:function(){if(!Xn.skyBox){var t=new Ot;t.setData("position",[-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1]),t.primitiveType="TRIANGLES",Xn.skyBox=t}return Xn.skyBox},enumerable:!0,configurable:!0}),GeometryProvider.unload=function(t){Xn.centeredQuad.unload(t),Xn.quad.unload(t),Xn.uiQuad.unload(t),Xn.skyBox&&Xn.skyBox.unload(t)},GeometryProvider}();(si=ai||(ai={})).materials||(si.materials={}),si.shaders||(si.shaders={}),si.primitives||(si.primitives={}),(ci||(ci={})).definitions=[{path:"Assets/DefaultAssets/Materials/Particles.Material",set:function(t){return ai.materials.particles=t},get:function(){return ai.materials.particles}},{path:"Assets/DefaultAssets/Materials/UI.Material",set:function(t){return ai.materials.ui=t},get:function(){return ai.materials.ui}},{path:"Assets/DefaultAssets/Materials/Sky.Material",set:function(t){return ai.materials.sky=t},get:function(){return ai.materials.sky}},{path:"Assets/DefaultAssets/Materials/CubeMap.Material",set:function(t){return ai.materials.cubeMap=t},get:function(){return ai.materials.cubeMap}},{path:"Assets/DefaultAssets/Shaders/RenderDepth.Shader",set:function(t){return ai.shaders.renderDepth=t},get:function(){return ai.shaders.renderDepth}},{path:"Assets/DefaultAssets/Shaders/SkinnedRenderDepth.Shader",set:function(t){return ai.shaders.skinnedRenderDepth=t},get:function(){return ai.shaders.skinnedRenderDepth}},{path:"Assets/DefaultAssets/Shaders/FullScreen.Shader",set:function(t){return ai.shaders.fullScreen=t},get:function(){return ai.shaders.fullScreen}},{path:"Assets/DefaultAssets/Shaders/PostFX/BloomStep1.Shader",set:function(t){return ai.shaders.bloom=t},get:function(){return ai.shaders.bloom}},{path:"Assets/DefaultAssets/Shaders/PostFX/Blur.Shader",set:function(t){return ai.shaders.blur=t},get:function(){return ai.shaders.blur}},{path:"Assets/DefaultAssets/Shaders/PostFX/Compose.Shader",set:function(t){return ai.shaders.compose=t},get:function(){return ai.shaders.compose}},{path:"Assets/DefaultAssets/Shaders/Phong.PhongShader",set:function(t){return ai.shaders.phong=t},get:function(){return ai.shaders.phong}},{path:"Assets/DefaultAssets/Shaders/Diffuse.Shader",set:function(t){return ai.shaders.diffuse=t},get:function(){return ai.shaders.diffuse}},{path:"Assets/DefaultAssets/Geometry/Meshes/Cube.StaticMeshAsset",set:function(t){return ai.primitives.box=t},get:function(){return ai.primitives.box}},{path:"Assets/DefaultAssets/Geometry/Meshes/Sphere.StaticMeshAsset",set:function(t){return ai.primitives.sphere=t},get:function(){return ai.primitives.sphere}},{path:"Assets/DefaultAssets/Geometry/Meshes/Plane.StaticMeshAsset",set:function(t){return ai.primitives.plane=t},get:function(){return ai.primitives.plane}},{path:"Assets/DefaultAssets/Geometry/Meshes/Cone.StaticMeshAsset",set:function(t){return ai.primitives.cone=t},get:function(){return ai.primitives.cone}},{path:"Assets/DefaultAssets/Textures/WhiteSquare.Texture2D",set:function(t){return ai.whiteTexture=t},get:function(){return ai.whiteTexture}},{path:"Assets/DefaultAssets/Transition/Transition.Scene",set:function(t){return ai.transitionScene=t},get:function(){return ai.transitionScene}}],function(t){t.load=function load(){return Promise.all(ci.definitions.map(function(t){return I.instance.loadObject(t.path).then(function(e){return t.set(e[0])})})).then(function(){return jo.load()})},t.isLoaded=function isLoaded(){for(var t=0,e=ci.definitions;t<e.length;t++)if(!e[t].get().isLoaded())return!1;return jo.isLoaded()}}(ui||(ui={})),function(t){t.tint=new Z,t.getUIElementVertexBuffer=function getUIElementVertexBuffer(t){var e=pi.uiQuad,r=e.data.position,n=t.actualWidth,i=t.actualHeight,o=-t.pivot.x*n,a=-t.pivot.y*i;return r[0]=0+o,r[1]=0+a,r[2]=0,r[3]=n+o,r[4]=0+a,r[5]=0,r[6]=0+o,r[7]=i+a,r[8]=0,r[9]=0+o,r[10]=i+a,r[11]=0,r[12]=n+o,r[13]=0+a,r[14]=0,r[15]=n+o,r[16]=i+a,r[17]=0,e.dirtifyData("position"),e}}(li||(li={}));var fi,hi=function(){function UIFillUtils(){}return UIFillUtils.getVertexBuffer=function(t,e){if(e){if(e.isA(ti))return e.tesselate(t);if(e.isA(ni))return e.tesselate(t)}return li.getUIElementVertexBuffer(t)},UIFillUtils.renderFill=function(t,e,r,n,i,o){if(t.isA($n))(u=(a=t).material)&&u.shader&&(u.queueParameter("projectionMatrix",e.getParameter("projectionMatrix")),u.queueParameter("modelViewMatrix",r),u.queueParameter("tint",o),u.begin()&&oi.drawVertexBuffer(i,n,u.shader));else if(t.isA(ri)){var a=t,s=ai.whiteTexture;e.queueReferenceParameter(UIFillUtils.uiShaderTextureParam,s),e.queueParameter(UIFillUtils.uiShaderColorParam,li.tint.copy(a.color).multiplyColor(o)),e.begin()&&oi.drawVertexBuffer(i,n,e.shader)}else if(t.isA(ei)){(a=t).texture&&(e.queueReferenceParameter(UIFillUtils.uiShaderTextureParam,a.texture),e.queueParameter(UIFillUtils.uiShaderColorParam,li.tint.copy(a.color).multiplyColor(o)),e.begin()&&oi.drawVertexBuffer(i,n,e.shader))}else if(t.isA(ti)){var c=(a=t).sprite.asset?a.sprite.asset.texture.asset:null;c&&(e.queueReferenceParameter(UIFillUtils.uiShaderTextureParam,c),e.queueParameter(UIFillUtils.uiShaderColorParam,li.tint.copy(a.color).multiplyColor(o)),e.begin()&&oi.drawVertexBuffer(i,n,e.shader))}else if(t.isA(ii)){var u;(u=(a=t).material)&&u.shader&&(u.queueParameter("projectionMatrix",e.getParameter("projectionMatrix")),u.queueParameter("modelViewMatrix",r),u.queueParameter("tint",o),u.begin()&&oi.drawVertexBuffer(i,n,u.shader))}else if(t.isA(ni)){(a=t).texture&&(e.queueReferenceParameter(UIFillUtils.uiShaderTextureParam,a.texture),e.queueParameter(UIFillUtils.uiShaderColorParam,li.tint.copy(a.color).multiplyColor(o)),e.begin()&&oi.drawVertexBuffer(i,n,e.shader))}},UIFillUtils.getFillSize=function(t,e){if(t.isA(ei))return(l=t.texture)?e?l.getWidth():l.getHeight():0;if(t.isA(ti)){var r=t;return(l=r.sprite.asset?r.sprite.asset.texture.asset:null)?e?l.getWidth():l.getHeight():0}if(t.isA(ni)){var n=t;return e?n.tileSize.x:n.tileSize.y}if(t.isA($n)){var i=t.material,o=i?i.shader:void 0;if(o)for(var a=o.getParams(),s=i.shaderParams,c=0,u=Object.keys(a);c<u.length;c++){var l,p=u[c];if("sampler2D"===a[p].type&&p in s)return(l=s[p].asset)?e?l.getWidth():l.getHeight():0}}return 256},UIFillUtils.uiShaderTextureParam="diffuse",UIFillUtils.uiShaderColorParam="ambient",UIFillUtils}(),di=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),yi=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},mi=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Clip=0]="Clip",t[t.Scroll=1]="Scroll"}(fi||(fi={}));var vi,gi=function(){function UIOverflowMetadata(){}return UIOverflowMetadata.literals={Clip:0,Scroll:1},UIOverflowMetadata}(),_i=function(t){function UIElement(){var e=null!==t&&t.apply(this,arguments)||this;return e._touchInside=!1,e._touchPressed=!1,e}return di(UIElement,t),Object.defineProperty(UIElement.prototype,"isTouchInside",{get:function(){return this._touchInside},enumerable:!0,configurable:!0}),Object.defineProperty(UIElement.prototype,"isTouchPressed",{get:function(){return this._touchPressed},enumerable:!0,configurable:!0}),UIElement.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.clearComponent(Lt),e.getOrSetComponent(Sn)},UIElement.prototype.getVertexBuffer=function(){return hi.getVertexBuffer(this.entity.getComponent(Sn))},UIElement.prototype.setTouchInside=function(t){this._touchInside=t},UIElement.prototype.setTouchPressed=function(t){this._touchPressed=t},yi([unserializable(),mi("design:type",Object)],UIElement.prototype,"_touchInside",void 0),yi([unserializable(),mi("design:type",Object)],UIElement.prototype,"_touchPressed",void 0),UIElement}(kt),bi=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),wi=function(t){function Font(){return null!==t&&t.apply(this,arguments)||this}return bi(Font,t),Font.prototype.getTexture=function(){return console.assert(!1,"Calling Abstract Method"),0},Font.prototype.setText=function(t){},Font.prototype.setAlignment=function(t){},Font.prototype.getWidth=function(){return 0},Font.prototype.getHeight=function(){return 0},Font.prototype.isLoaded=function(){return!0},Font.prototype.prepareForRendering=function(t,e){},Font}(O),Pi=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),xi=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Oi=function(t){function FontMetrics(){var e=null!==t&&t.apply(this,arguments)||this;return e.widths={},e.cellWidth=32,e.cellHeight=32,e.textureWidth=512,e.textureHeight=256,e.startCharacter=32,e}return Pi(FontMetrics,t),FontMetrics=xi([displayName("Font Metrics"),creatable(!1)],FontMetrics)}(F),Ci=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Si=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Ri=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){(vi||(vi={})).wordWrap=function wordWrap(t,e,r){for(var n=[],i=e.split(" "),o="",a=0;a<i.length;a++){for(var s=o+i[a]+" ",c=0,u=0;u<s.length;++u){var l=s.charCodeAt(u);c+=t.widths[l]}c>r&&a>0?(n.push(o),o=i[a]+" "):o=s}return n.push(o),n}}();var ji,Ti=function(t){function BitmapFont(){var e=null!==t&&t.apply(this,arguments)||this;return e.texture=new re(Dn),e.metrics=new re(Oi),e.lineHeight=16,e.spacing=0,e._isDirty=!0,e._maxWidth=0,e._width=0,e._height=0,e._pivotX=0,e._pivotY=0,e}return Ci(BitmapFont,t),Object.defineProperty(BitmapFont.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),BitmapFont.prototype.getTexture=function(){return this.texture.asset},BitmapFont.prototype.getWidth=function(){return this._width},BitmapFont.prototype.getHeight=function(){return this._height},BitmapFont.prototype.setText=function(t){t!==this._text&&(this._text=t,this._isDirty=!0)},BitmapFont.prototype.setAlignment=function(t){t!==this._alignment&&(this._alignment=t,this._isDirty=!0)},BitmapFont.prototype.isLoaded=function(){return S.isAssetRefLoaded(this.texture)&&S.isAssetRefLoaded(this.metrics)},BitmapFont.prototype.destroy=function(){this.texture.detach(),this._vertexBuffer&&this._vertexBuffer.unload(gt.context),t.prototype.destroy.call(this)},BitmapFont.prototype.upgrade=function(t,e){return 1===e&&(t.properties.metrics.typeName="FontMetrics"),t},BitmapFont.prototype.tesselate=function(t,e){this._vertexBuffer||(this._vertexBuffer=new Ot,this._vertexBuffer.isDynamic=!0,this._vertexBuffer.primitiveType="TRIANGLES",this._vertexBuffer.setData("position",[]),this._vertexBuffer.setData("uv",[]));var r=this.getTexture(),n=this.metrics.asset;t!==this._pivotX&&(this._pivotX=t,this._isDirty=!0),e!==this._pivotY&&(this._pivotY=e,this._isDirty=!0);var i=this._text.split("\\n");if(this._isDirty&&r&&n&&i.length>0){if(this._maxWidth>0){for(var o=[],a=0,s=i;a<s.length;a++){var c=s[a];o=o.concat(vi.wordWrap(n,c,this._maxWidth))}this._width=this._maxWidth,this._height=this.lineHeight*o.length,this.drawText(o,this.lineHeight)}else this._height=this.lineHeight*i.length,this._width=0,this._width=this.drawText(i,this.lineHeight);this._vertexBuffer.dirtifyData("position"),this._vertexBuffer.dirtifyData("uv"),this._isDirty=!1}return this._vertexBuffer},BitmapFont.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r),"metrics"===e?this._isDirty||(this._isDirty=!0):"lineHeight"===e?this._isDirty||(this._isDirty=!0):"spacing"===e&&(this._isDirty||(this._isDirty=!0))},BitmapFont.prototype.prepareForRendering=function(t,e){this._maxWidth!==e&&(this._maxWidth=e,this._isDirty=!0)},BitmapFont.prototype.drawText=function(t,e){var r=this.getTexture(),n=this.metrics.asset,i=r.getWidth()/Math.max(n.cellWidth,1),o=r.getHeight()/Math.max(n.cellHeight,1),a=n.startCharacter,s=6*t.reduce(function(t,e){return t+e.length},0);this._vertexBuffer.vertexCount=s;var c=this._vertexBuffer.data.position,u=this._vertexBuffer.data.uv;c.length=3*s,u.length=2*s;for(var l=1/i,p=1/o,f=0,h=[],d=0;d<t.length;++d){for(var y=t[d],m=0,v=0;v<y.length;++v){var g=y.charCodeAt(v);m+=x=n.widths[g],v>0&&v<this._text.length&&(m+=this.spacing)}h[d]=m,m>f&&(f=m)}var _=-this._pivotX*(this._width||f),b=-this._pivotY*(e*t.length),w=0;for(d=0;d<t.length;++d){y=t[d];var P=0;this._alignment===_n.Center?P=((this._width||f)-h[d])/2:this._alignment===_n.Right&&(P=(this._width||f)-h[d]);for(v=0;v<y.length;++v){g=y.charCodeAt(v);var x=n.widths[g],O=g-a,C=Math.floor(O/i),S=Math.round(O)%i,R=18*w,j=P,T=d*e;c[R+0]=_+j,c[R+1]=b+T,c[R+2]=0,c[R+3]=_+j+x,c[R+4]=b+T,c[R+5]=0,c[R+6]=_+j,c[R+7]=b+T+e,c[R+8]=0,c[R+9]=_+j,c[R+10]=b+T+e,c[R+11]=0,c[R+12]=_+j+x,c[R+13]=b+T,c[R+14]=0,c[R+15]=_+j+x,c[R+16]=b+T+e,c[R+17]=0;var E=x/r.getWidth(),B=e/r.getHeight();u[(R=12*w)+0]=l*S,u[R+1]=1-p*C,u[R+2]=l*S+E,u[R+3]=1-p*C,u[R+4]=l*S,u[R+5]=1-(p*C+B),u[R+6]=l*S,u[R+7]=1-(p*C+B),u[R+8]=l*S+E,u[R+9]=1-p*C,u[R+10]=l*S+E,u[R+11]=1-(p*C+B),P+=x+this.spacing,++w}}return f},Si([unserializable(),Ri("design:type",Ot)],BitmapFont.prototype,"_vertexBuffer",void 0),Si([unserializable(),Ri("design:type",String)],BitmapFont.prototype,"_text",void 0),Si([unserializable(),Ri("design:type",Object)],BitmapFont.prototype,"_isDirty",void 0),Si([unserializable(),Ri("design:type",Object)],BitmapFont.prototype,"_maxWidth",void 0),Si([unserializable(),Ri("design:type",Object)],BitmapFont.prototype,"_width",void 0),Si([unserializable(),Ri("design:type",Object)],BitmapFont.prototype,"_height",void 0),Si([unserializable(),Ri("design:type",Object)],BitmapFont.prototype,"_pivotX",void 0),Si([unserializable(),Ri("design:type",Object)],BitmapFont.prototype,"_pivotY",void 0),Si([unserializable(),Ri("design:type",Number)],BitmapFont.prototype,"_alignment",void 0),BitmapFont}(wi),Ei=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Bi=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Ai=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ii=function(t){function FontShadow(){var e=null!==t&&t.apply(this,arguments)||this;return e.propertyChanged=new B.AsyncEvent,e}return Ei(FontShadow,t),FontShadow.prototype.applyToContext=function(t){},Bi([unserializable(),Ai("design:type",Object)],FontShadow.prototype,"propertyChanged",void 0),FontShadow}(O),Mi=function(t){function DefaultFontShadow(){var e=null!==t&&t.apply(this,arguments)||this;return e._offset=new it(1,1),e._blur=1,e._color=new Z,e}return Ei(DefaultFontShadow,t),Object.defineProperty(DefaultFontShadow.prototype,"offset",{set:function(t){this._offset.copy(t),this.propertyChanged.post("offset")},enumerable:!0,configurable:!0}),Object.defineProperty(DefaultFontShadow.prototype,"blur",{set:function(t){this._blur=t,this.propertyChanged.post("blur")},enumerable:!0,configurable:!0}),Object.defineProperty(DefaultFontShadow.prototype,"color",{set:function(t){this._color.copy(t),this.propertyChanged.post("color")},enumerable:!0,configurable:!0}),DefaultFontShadow.prototype.applyToContext=function(t){t.shadowOffsetX=this._offset.x,t.shadowOffsetY=this._offset.y;var e=this._color.toChromeColor(),r=e.r,n=e.g,i=e.b,o=e.a;t.shadowColor="rgba("+r+", "+n+", "+i+", "+o+")",t.shadowBlur=this._blur},DefaultFontShadow=Bi([displayName("Default")],DefaultFontShadow)}(Ii),ki=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),zi=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a};!function(t){(ji||(ji={})).wordWrap=function wordWrap(t,e,r){for(var n=[],i=e.split(" "),o="",a=0;a<i.length;a++){var s=o+i[a]+" ";t.measureText(s).width>r&&a>0?(n.push(o),o=i[a]+" "):o=s}return n.push(o),n}}();var Fi,Di=function(t){function FontTexture(){var e=null!==t&&t.apply(this,arguments)||this;return e._isDirty=!0,e._maxWidth=0,e._scaleFactor=1,e}return ki(FontTexture,t),Object.defineProperty(FontTexture.prototype,"scaleFactor",{set:function(t){t!==this._scaleFactor&&(this._isDirty=!0,this._scaleFactor=t)},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"maxWidth",{set:function(t){t!==this._maxWidth&&(this._isDirty=!0,this._maxWidth=t)},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"family",{set:function(t){t!==this._fontFamily&&(this._isDirty=!0,this._fontFamily=t)},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"text",{set:function(t){if(t!==this._text){if(this._text=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"size",{set:function(t){if(t!==this._fontSize){if(this._fontSize=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"bold",{set:function(t){if(t!==this._bold){if(this._bold=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"italic",{set:function(t){if(t!==this._italic){if(this._italic=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"alignment",{set:function(t){if(this._alignment!==t){if(this._alignment=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!0,configurable:!0}),Object.defineProperty(FontTexture.prototype,"shadow",{set:function(t){if(this._shadow!==t){if(this._shadow=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!0,configurable:!0}),FontTexture.prototype.dirtify=function(){this._isDirty=!0},FontTexture.prototype.getWidth=function(){return this._canvas?this._canvas.width/this._scaleFactor:0},FontTexture.prototype.getHeight=function(){return this._canvas?this._canvas.height/this._scaleFactor:0},FontTexture.prototype.begin=function(t){var e=gt.context,r=!0;if(this._textureId){if(this._isDirty){var n;(n=this._canvas.getContext("2d"))&&(r=this.updateTexture(n))}}else this._canvas||(this._canvas=document.createElement("canvas")),(n=this._canvas.getContext("2d"))&&(this._textureId=e.createTexture(),r=this.updateTexture(n));return!!r&&(e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),!0)},FontTexture.prototype.destroy=function(){delete this._canvas,t.prototype.destroy.call(this)},FontTexture.prototype.tryUpdateTextureInEditor=function(){return!1},FontTexture.prototype.updateTexture=function(t){var e=gt.context,r=this._italic?"italic ":"";r+=this._bold?"bold ":"",r+=this._fontSize*this._scaleFactor+"px "+this._fontFamily,t.font=r;var n=this._text.split("\\n");if(0===n.length)return!1;if(this._maxWidth>0){for(var i=this._maxWidth*this._scaleFactor,o=[],a=0,s=n;a<s.length;a++){var c=s[a];o=o.concat(ji.wordWrap(t,c,i))}if(0===o.length)return!1;var u=this.getTextHeight(r,o[0]);this._canvas.width=i,this._canvas.height=u*o.length,this.drawText(t,r,o,u)}else{for(var l=t.measureText(n[0]).width,p=1;p<n.length;++p)l=Math.max(l,t.measureText(n[p]).width);if(0===l)return!1;i=l;var f=(u=this.getTextHeight(r,n[0]))*n.length;this._canvas.width=i,this._canvas.height=f,this.drawText(t,r,n,u)}return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_2D,this._textureId),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,1),e.pixelStorei(e.UNPACK_ALIGNMENT,4),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._canvas),this._isDirty=!1,!0},FontTexture.prototype.getTextHeight=function(t,e){var r=document.createElement("span");r.setAttribute("style","font: "+t+";"),r.textContent=e,document.body.appendChild(r);var n=r.offsetHeight;return document.body.removeChild(r),n},FontTexture.prototype.drawText=function(t,e,r,n){t.font=e,t.textBaseline="top",t.fillStyle="white",this._shadow?this._shadow.applyToContext(t):delete t.shadowColor,t.clearRect(0,0,this._canvas.width,this._canvas.height);for(var i=0;i<r.length;++i){var o=0;this._alignment===_n.Center?o=(this._canvas.width-t.measureText(r[i]).width)/2:this._alignment===_n.Right&&(o=this._canvas.width-t.measureText(r[i]).width),t.fillText(r[i],o,i*n)}},FontTexture=zi([displayName("Font Texture")],FontTexture)}(En),Ni=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Li=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Vi=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ui=function(t){function FontFamily(){var e=t.call(this)||this;return e.family="Arial",e.size=14,e.bold=!1,e.italic=!1,e._shadow=new a(Ii),e.texture=new Di,e.texture.size=e.size,e.texture.family=e.family,e.onShadowPropertyChanged=e.onShadowPropertyChanged.bind(e),e.shadow=new Mi,e}return Ni(FontFamily,t),Object.defineProperty(FontFamily.prototype,"shadow",{set:function(t){var e=this._shadow.instance;this._shadow.instance=t,e&&e.propertyChanged.detach(this.onShadowPropertyChanged),t&&t.propertyChanged.attach(this.onShadowPropertyChanged),this.texture.shadow=t},enumerable:!0,configurable:!0}),FontFamily.prototype.setText=function(t){this.texture.text=t},FontFamily.prototype.setAlignment=function(t){this.texture.alignment=t},FontFamily.prototype.getTexture=function(){return this.texture},FontFamily.prototype.getWidth=function(){return this.texture.getWidth()},FontFamily.prototype.getHeight=function(){return this.texture.getHeight()},FontFamily.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r),"family"===e?this.texture.family=r:"size"===e?this.texture.size=r:"bold"===e?this.texture.bold=r:"italic"===e?this.texture.italic=r:"_shadow"===e&&(this.shadow=r.instance)},FontFamily.prototype.prepareForRendering=function(t,e){this.texture.scaleFactor=t,this.texture.maxWidth=e},FontFamily.prototype.destroy=function(){this.texture.destroy(),this._shadow.instance&&this._shadow.instance.propertyChanged.detach(this.onShadowPropertyChanged),t.prototype.destroy.call(this)},FontFamily.prototype.onShadowPropertyChanged=function(t){this.texture.dirtify()},Li([unserializable(),Vi("design:type",Di)],FontFamily.prototype,"texture",void 0),FontFamily}(wi),Wi=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),qi=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Gi=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Hi=function(t){function Text(){var e=t.call(this)||this;return e._font=new a(wi,new Ui),e.text="Empty Text",e._color=new Z(1,1,1,1),e._alignment=_n.Left,e}return Wi(Text,t),Object.defineProperty(Text.prototype,"version",{get:function(){return 7},enumerable:!0,configurable:!0}),Object.defineProperty(Text.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t||"",this.font&&this.font.setText(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Text.prototype,"alignment",{set:function(t){this._alignment=t,this.font&&this.font.setAlignment(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Text.prototype,"color",{get:function(){return this._color},set:function(t){this._color.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Text.prototype,"font",{get:function(){return this._font.instance},enumerable:!0,configurable:!0}),Text.prototype.setProperty=function(e,r){if(t.prototype.setProperty.call(this,e,r),"_text"===e)this.text=r;else if("_alignment"===e)this.alignment=r;else if("_font"===e){var n=r.instance;n&&(n.setText(this._text),n.setAlignment(this._alignment))}},Text.prototype.destroy=function(){this.font&&this.font.destroy(),t.prototype.destroy.call(this)},Text.prototype.isLoaded=function(){return!!t.prototype.isLoaded.call(this)&&(!this.font||this.font.isLoaded())},Text.prototype.getVertexBuffer=function(){if(this.font&&this.font.isA(Ti)){var e=this.entity.getComponent(Sn);return this.font.tesselate(e.pivot.x,e.pivot.y)}return t.prototype.getVertexBuffer.call(this)},Text.prototype.upgrade=function(t,e){if(1===e)delete t.properties.font,delete t.properties.yOffset;else if(2===e)Object.assign(t.properties,{_text:t.properties.text}),delete t.properties.text;else if(3===e)Object.assign(t.properties,{font:{baseTypeName:"Font",data:{typeName:"FontFamily",properties:{family:t.properties.fontFamily}}}}),delete t.properties.fontFamily;else if(4===e)Object.assign(t.properties,{_font:t.properties.font,_bold:t.properties.bold,_italic:t.properties.italic,_tint:t.properties.tint}),Object.assign(t.properties._font.data.properties,{size:t.properties.size}),delete t.properties.font,delete t.properties.size,delete t.properties.bold,delete t.properties.italic,delete t.properties.tint;else if(5===e)Object.assign(t.properties,{_color:t.properties._tint}),delete t.properties._tint;else if(6===e){var r=t.properties._font.data;r&&"FontFamily"===r.typeName&&Object.assign(r.properties,{bold:t.properties._bold,italic:t.properties._italic}),delete t.properties._bold,delete t.properties._italic}return t},qi([Attributes_enumLiterals(Pn.literals),Gi("design:type",Number)],Text.prototype,"_alignment",void 0),Text=qi([helpUrl("https://docs.spiderengine.io/2d/text.html"),Gi("design:paramtypes",[])],Text)}(_i),Xi=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ki=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Qi=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Yi=function(t){function TouchInteractions(e){var r=t.call(this)||this;return e&&r.setState(e),r}var e;return Xi(TouchInteractions,t),TouchInteractions=Ki([(e="UIElement",Reflect.metadata("requires",e)),Qi("design:paramtypes",[Object])],TouchInteractions)}(kt),Zi=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ji=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},$i=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},to=function(t){function CheckBox(){var e=null!==t&&t.apply(this,arguments)||this;return e.highlightColor=(new Z).copy(Z.white),e.pressedColor=(new Z).copy(Z.white),e.disabledColor=(new Z).copy(Z.grey),e._enabled=!0,e._isChecked=!1,e._checked=new a(Jn),e._unchecked=new a(Jn),e}return Zi(CheckBox,t),Object.defineProperty(CheckBox.prototype,"checked",{get:function(){return this._checked.instance},enumerable:!0,configurable:!0}),Object.defineProperty(CheckBox.prototype,"unchecked",{get:function(){return this._unchecked.instance},enumerable:!0,configurable:!0}),Object.defineProperty(CheckBox.prototype,"isChecked",{get:function(){return this._isChecked},set:function(t){this._isChecked=t},enumerable:!0,configurable:!0}),Object.defineProperty(CheckBox.prototype,"enabled",{get:function(){return this._touchInteractions.active},set:function(t){this._enabled=this._touchInteractions.active=t},enumerable:!0,configurable:!0}),Object.defineProperty(CheckBox.prototype,"currentFill",{get:function(){return this._isChecked?this.checked:this.unchecked},enumerable:!0,configurable:!0}),Object.defineProperty(CheckBox.prototype,"currentColor",{get:function(){return this.enabled?this.isTouchPressed?this.pressedColor:this.isTouchInside?this.highlightColor:Z.white:this.disabledColor},enumerable:!0,configurable:!0}),CheckBox.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),this._touchInteractions=new Yi({active:this._enabled,controller:this}),Vc.setComponentFromInstance(e,this._touchInteractions)},CheckBox.prototype.destroy=function(){this.entity.clearComponent(Yi),t.prototype.destroy.call(this)},CheckBox.prototype.isLoaded=function(){return!(this.checked&&!this.checked.isLoaded())&&!(this.unchecked&&!this.unchecked.isLoaded())},CheckBox.prototype.getVertexBuffer=function(){return hi.getVertexBuffer(this.entity.getComponent(Sn),this.currentFill)},CheckBox.prototype.setTouchPressed=function(e){var r=this.isTouchPressed;t.prototype.setTouchPressed.call(this,e),!e&&r&&this.enabled&&(this.isChecked=!this.isChecked)},Ji([unserializable(),$i("design:type",Yi)],CheckBox.prototype,"_touchInteractions",void 0),CheckBox}(_i),eo=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),ro=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},no=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},io=function(t){function AnimationTrackDefinition(){var e=t.call(this)||this;return e._id=S.makeUniqueId(),e}return eo(AnimationTrackDefinition,t),Object.defineProperty(AnimationTrackDefinition.prototype,"version",{get:function(){return 5},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationTrackDefinition.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0}),AnimationTrackDefinition.prototype.upgrade=function(t,e){return 1===e?t.properties.propertyPath&&t.properties.propertyPath.data.indexOf("Visual/material")>=0&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace("Visual/material","Visual/_material")):2===e?t.properties.propertyPath&&t.properties.propertyPath.data.indexOf("UIImage/fill")>=0&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace("UIImage/fill","UIImage/_fill")):3===e?(t.properties.propertyPath&&t.properties.propertyPath.data.indexOf("UIImage/")>=0&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace("UIImage/","Image/")),t.properties.propertyPath&&t.properties.propertyPath.data.indexOf("UIText/")>=0&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace("UIText/","Text/"))):4===e&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace(/Transform\/local(Position|Rotation|Scale)/,function(t,e){return"Transform/"+e.toLowerCase()})),t},ro([Attributes_hidden(),no("design:type",a)],AnimationTrackDefinition.prototype,"track",void 0),AnimationTrackDefinition}(O),oo=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),ao=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},so=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},co=function(t){function Animation(){var e=null!==t&&t.apply(this,arguments)||this;return e.tracks=new Rt(io),e._duration=0,e._imported=!1,e}return oo(Animation,t),Object.defineProperty(Animation.prototype,"duration",{get:function(){return this._duration},set:function(t){this._duration=t},enumerable:!0,configurable:!0}),Object.defineProperty(Animation.prototype,"imported",{get:function(){return this._imported},set:function(t){this._imported=t},enumerable:!0,configurable:!0}),Animation.prototype.isLoaded=function(){for(var t=0,e=this.tracks.data;t<e.length;t++){if(!e[t].track.instance.isLoaded())return!1}return!0},Animation.getPropertyAtPath=function(t,e){var r=function(t,e,n){var i=e[n];return i in t?n===e.length-1?t[i]:(console.assert("object"==typeof t),r(t[i],e,n+1)):void 0},n=e.split("/");if(n.length>1){var i=n[0],o=Vc.getComponentByName(t,i);if(o)return r(o,n,1)}},ao([Attributes_hidden(),so("design:type",Object)],Animation.prototype,"tracks",void 0),ao([Attributes_hidden(),so("design:type",Object)],Animation.prototype,"_imported",void 0),Animation=ao([editable(!1)],Animation)}(F),uo=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),lo=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},po=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},fo=function(t){function AnimationInstance(){var e=null!==t&&t.apply(this,arguments)||this;return e.loopCount=0,e.speed=1,e.autoPlay=!0,e._isPlaying=!1,e._localTime=0,e._hasPlayedOnce=!1,e._stopRequested=!1,e._playCount=0,e._animation=new re(co),e}return uo(AnimationInstance,t),Object.defineProperty(AnimationInstance.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"animation",{get:function(){return this._animation.asset},set:function(t){this._animation.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"isPlaying",{get:function(){return this._isPlaying},set:function(t){this._isPlaying=t,t?this._hasPlayedOnce=!0:this._stopRequested=!1},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"localTime",{get:function(){return this._localTime},set:function(t){this._localTime=t},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"stopRequested",{get:function(){return this._stopRequested},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"playCount",{get:function(){return this._playCount},set:function(t){this._playCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"hasPlayedOnce",{get:function(){return this._hasPlayedOnce},enumerable:!0,configurable:!0}),AnimationInstance.prototype.requestStop=function(){this._stopRequested=!0},AnimationInstance.prototype.upgrade=function(t,e){return 1===e?(!0===t.properties.loop?Object.assign(t.properties,{loopCount:0}):Object.assign(t.properties,{loopCount:1}),delete t.properties.loop):2===e&&(Object.assign(t.properties,{_animation:t.properties.animation}),delete t.properties.animation),t},AnimationInstance.prototype.isLoaded=function(){return S.isAssetRefLoaded(this._animation)},AnimationInstance.prototype.destroy=function(){this._animation.detach(),t.prototype.destroy.call(this)},lo([unserializable(),po("design:type",Object)],AnimationInstance.prototype,"targets",void 0),lo([unserializable(),po("design:type",Object)],AnimationInstance.prototype,"_isPlaying",void 0),lo([unserializable(),po("design:type",Object)],AnimationInstance.prototype,"_localTime",void 0),lo([unserializable(),po("design:type",Object)],AnimationInstance.prototype,"_hasPlayedOnce",void 0),lo([unserializable(),po("design:type",Object)],AnimationInstance.prototype,"_stopRequested",void 0),lo([unserializable(),po("design:type",Object)],AnimationInstance.prototype,"_playCount",void 0),AnimationInstance}(O);!function(t){t.animateProperty=function animateProperty(e,r,n,i,o){if(n===r.length-1){if(e){var a=i.getSample(o,e[r[n]]);void 0!==a&&(e[r[n]]=a)}}else if(e){var s=r[n];if("Visual"===e.constructor.name&&"_material"===s){var c=e;!c.animatedMaterial&&c.material&&(c.animatedMaterial=c.material.copy()),t.animateProperty(c.animatedMaterial,r,n+2,i,o)}else t.animateProperty(e[s],r,n+1,i,o)}}}(Fi||(Fi={}));var ho,yo=function(){function AnimationUtils(){}return AnimationUtils.applyTrack=function(t,e,r,n){var i=t.tokenCache[e];if(i||(i=e.split("/"),t.tokenCache[e]=i),i.length>1){var o=i[0],a=Vc.getComponentByName(r,o);a&&Fi.animateProperty(a,i,1,t,n)}},AnimationUtils.applyAnimation=function(t,e,r,n){for(var i=0,o=t.tracks.data;i<o.length;i++){var a=o[i];if(a.track.instance){var s=e;a.targetName&&!(s=n?n[a.targetName]:e.name===a.targetName?e:e.findChild(a.targetName))||AnimationUtils.applyTrack(a.track.instance,a.propertyPath,s,r)}}},AnimationUtils.playAnimation=function(t,e,r,n){void 0===r||r?e.localTime=0:e.isPlaying||(e.localTime=0),e.isPlaying=!0,e.playCount=0,void 0!==n&&(e.loopCount=n),e.targets={};for(var i=0,o=e.animation.tracks.data;i<o.length;i++){var a=o[i];if(a.targetName){var s=t.name===a.targetName?t:t.findChild(a.targetName);s&&(e.targets[a.targetName]=s)}}},AnimationUtils}(),mo=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),vo=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},go=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.animationsKey="_animations"}(ho||(ho={}));var _o,bo=function(t){function AnimationComponent(){var e=null!==t&&t.apply(this,arguments)||this;return e.animationFinished=new B.AsyncEvent,e._animations=new Rt(fo),e}return mo(AnimationComponent,t),Object.defineProperty(AnimationComponent.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(AnimationComponent.prototype,"animations",{get:function(){return this._animations.data},enumerable:!0,configurable:!0}),AnimationComponent.prototype.isLoaded=function(){if(!t.prototype.isLoaded.call(this))return!1;for(var e=0,r=this.animations;e<r.length;e++){if(!r[e].isLoaded())return!1}return!0},AnimationComponent.prototype.destroy=function(){for(var e=0,r=this.animations;e<r.length;e++){r[e].destroy()}t.prototype.destroy.call(this)},AnimationComponent.prototype.playAnimationByIndex=function(t,e){if(t<this.animations.length){var r=this.animations[t];yo.playAnimation(this.entity,r,e)}},AnimationComponent.prototype.playAnimation=function(t,e,r){var n=this.animations[t];if(!n)for(var i=0,o=this.animations;i<o.length;i++){var a=o[i],s=a.animation;if(s&&s.name===t){n=a;break}}n&&yo.playAnimation(this.entity,n,e,r)},AnimationComponent.prototype.stopAllAnimations=function(t){for(var e=0,r=this.animations;e<r.length;e++){var n=r[e];!0===t?n.requestStop():(n.animation&&this.animationFinished.post(n.animation.name),n.isPlaying=!1)}},AnimationComponent.prototype.stopAnimation=function(t,e){var r=this.animations[t];if(!r)for(var n=0,i=this.animations;n<i.length;n++){var o=i[n],a=o.animation;if(a&&a.name===t){r=o;break}}r&&(!0===e?r.requestStop():(r.animation&&this.animationFinished.post(r.animation.name),r.isPlaying=!1))},AnimationComponent.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_animations:t.properties.animations}),delete t.properties.animations),t},AnimationComponent.prototype.addAnimation=function(t){var e=new fo;e.animation=t,this._animations.grow(e)},vo([unserializable(),go("design:type",Object)],AnimationComponent.prototype,"animationFinished",void 0),AnimationComponent=vo([displayName("AnimationComponent"),helpUrl("https://docs.spiderengine.io/animation.html")],AnimationComponent)}(kt),wo=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Po=function(t){function HudControl(e){var r=t.call(this)||this;return r.name=e,r}return wo(HudControl,t),HudControl}(O),xo=function(t){function HudNumber(e,r,n,i,o){var a=t.call(this,e)||this;return a.initialValue=r,a.min=n,a.max=i,a.onChanged=o,a}return wo(HudNumber,t),HudNumber}(Po),Oo=function(t){function HudBoolean(e,r,n){var i=t.call(this,e)||this;return i.initialValue=r,i.onChanged=n,i}return wo(HudBoolean,t),HudBoolean}(Po),Co=function(t){function HudCommand(e,r){var n=t.call(this,e)||this;return n.onTriggered=r,n}return wo(HudCommand,t),HudCommand}(Po);!function(t){var e,r,n;t.hud=null,t.constrolsInitializedOnce=!1,t.hudAssets=[{path:"Assets/DefaultAssets/Hud/Prefabs/EngineHud.Prefab",set:function(e){return t.hudPrefab=e},get:function(){return t.hudPrefab}},{path:"Assets/DefaultAssets/Hud/Prefabs/Property.Prefab",set:function(e){return t.hudProperty=e},get:function(){return t.hudProperty}}],t.factory={HudCommand:{path:"Assets/DefaultAssets/Hud/Controls/Command/Command.Prefab",set:function(t){return e=t},get:function(){return e}},HudNumber:{path:"Assets/DefaultAssets/Hud/Controls/Slider/Slider.Prefab",set:function(t){return r=t},get:function(){return r}},HudBoolean:{path:"Assets/DefaultAssets/Hud/Controls/CheckBox/CheckBox.Prefab",set:function(t){return n=t},get:function(){return n}}},t.getHudAsset=function getHudAsset(e){return e in t.factory?t.factory[e].get():(console.assert(!1,"getHudAsset('"+e+"') returned null."),null)}}(_o||(_o={}));var So,Ro,jo=function(){function EngineHud(){}return EngineHud.load=function(){Promise.all(Object.keys(_o.factory).map(function(t){return new Promise(function(e,r){I.instance.loadObject(_o.factory[t].path).then(function(r){_o.factory[t].set(r[0]),e()}).catch(r)})})).then(function(){return Promise.all(_o.hudAssets.map(function(t){return new Promise(function(e,r){I.instance.loadObject(t.path).then(function(r){t.set(r[0]),e()}).catch(r)})}))})},EngineHud.isLoaded=function(){for(var t=0,e=Object.keys(_o.hudAssets);t<e.length;t++){var r=e[t];if(!_o.hudAssets[r].get().isLoaded())return!1}return!0},EngineHud.create=function(){return console.assert(!_o.hud),_o.hudPrefab?(_o.hud=Ut.create({prefab:_o.hudPrefab}),_o.hud):null},EngineHud.setControls=function(t){if(_o.hud||(_o.hud=EngineHud.create(),_o.hud)){var e=_o.hud.getComponent(mn),r=e.list;r.removeAllChildren();for(var n=4,i=function(e){var i=t[e],o=Ut.create({prefab:_o.getHudAsset(i.constructor.name)}),a=null;if(i.isA(xo)){var s=i;(a=Ut.create({prefab:_o.hudProperty})).findChild("Name").getComponent(Hi).text=s.name,Object.assign(Vc.setComponentByName(o,"Proxy"),{onChanged:function(t){var e=i.onChanged;e&&e(t)}});var c=o.getComponent(mn);c.initialValue=s.initialValue,c.min=s.min,c.max=s.max,Object.assign(c,{initialValue:s.initialValue}),a.findChild("Value").addChild(o)}else if(i.isA(Oo)){var u=i;(a=Ut.create({prefab:_o.hudProperty})).findChild("Name").getComponent(Hi).text=u.name,Object.assign(Vc.setComponentByName(o,"Proxy"),{onChanged:function(t){var e=i.onChanged;e&&e(t)}}),o.getComponent(to).isChecked=u.initialValue,a.findChild("Value").addChild(o)}else i.isA(Co)&&((a=o).findChild("Text").getComponent(Hi).text=i.name,Object.assign(Vc.setComponentByName(a,"Proxy"),{onClicked:function(){i.onTriggered()}}));a&&(a.getComponent(Sn).offset.y=n,r.addChild(a),n+=34)},o=0;o<t.length;++o)i(o);var a=r.getComponent(Sn);a.height.value=n;var s=e.close;if(s.getComponent(Sn).offset.y=a.offset.y+n,!_o.constrolsInitializedOnce){r.active=!0;var c=r.getComponent(bo);c.playAnimation(0),c.animationFinished.once(function(){return s.active=!0}),_o.constrolsInitializedOnce=!0}}},EngineHud.onSceneDestroyed=function(){_o.hud=null,_o.constrolsInitializedOnce=!1},EngineHud}();So||(So={}),function(t){t.setProjectId=function setProjectId(t){So.projectId=t}}(Ro||(Ro={}));var To,Eo,Bo=function(){function Project(){}return Object.defineProperty(Project,"projectId",{get:function(){if(So.projectId)return So.projectId;var t=sessionStorage.getItem("project_info");return t?JSON.parse(t).info.projectId:"default_project_id"},enumerable:!0,configurable:!0}),Object.defineProperty(Project,"projectName",{get:function(){var t=sessionStorage.getItem("project_info");return t?JSON.parse(t).info.name:null},enumerable:!0,configurable:!0}),Object.defineProperty(Project,"isOpenSource",{get:function(){var t=sessionStorage.getItem("project_info");return!!t&&JSON.parse(t).info.isOpenSource},enumerable:!0,configurable:!0}),Project.importToEditor=function(){var t=sessionStorage.getItem("project_info");if(t){var e=JSON.parse(t).importUrl;window.open(e)}else console.assert(!1,"Can't import project because import information is missing.")},Project}();To||(To={}),function(t){(Eo||(Eo={})).preload=function preload(){return new Promise(function(t,e){var r=Bo.projectId,n=localStorage.getItem("saved_data_"+r);To.savedData=n?JSON.parse(n):{},t()})}}();var Ao,Io,Mo=function(){function SavedData(){}return SavedData.get=function(){return To.savedData},SavedData.flush=function(){localStorage.setItem("saved_data_"+Bo.projectId,JSON.stringify(To.savedData,null,2))},SavedData}();!function(t){t.gamepadEventsSupported="ongamepadconnected"in window,t.gamepadMap={},t.onGamepadConnected=function onGamepadConnected(e){var r=e;t.gamepadMap[r.gamepad.index]=r.gamepad},t.onGamepadDisconnected=function onGamepadDisconnected(e){var r=e;delete t.gamepadMap[r.gamepad.index]}}(Ao||(Ao={})),function(t){function scanGamepads(){if(!Ao.gamepadEventsSupported){for(var t=navigator,e=navigator.getGamepads?navigator.getGamepads():t.webkitGetGamepads?t.webkitGetGamepads():[],r={},n=0;n<e.length;n++){if(e[n])r[a=e[n].index]=!0,Ao.gamepadMap[a]=e[n]}for(var i=0,o=Object.keys(Ao.gamepadMap);i<o.length;i++){var a;(a=o[i])in r||(Ao.gamepadMap[a]=null)}}}t.scanGamepads=scanGamepads,t.initialize=function initialize(){Ao.gamepadEventsSupported?(window.addEventListener("gamepadconnected",Ao.onGamepadConnected),window.addEventListener("gamepaddisconnected",Ao.onGamepadDisconnected)):setTimeout(scanGamepads,500)},t.destroy=function destroy(){Ao.gamepadEventsSupported&&(window.removeEventListener("gamepadconnected",Ao.onGamepadConnected),window.removeEventListener("gamepaddisconnected",Ao.onGamepadDisconnected))}}(Io||(Io={}));var ko,zo=function(){function Gamepads(){}return Gamepads.get=function(t){var e=Ao.gamepadMap[t];return e||null},Gamepads.forEach=function(t){for(var e=Object.values(Ao.gamepadMap),r=0;r<e.length;++r){var n=e[r];n&&t(n,r)}},Gamepads}();(ko||(ko={})).batchListeners={};var Fo,Do,No=function(){function AsyncUtils(){}return AsyncUtils.processBatch=function(t,e,r){var n=S.makeUniqueId(),i=0,o=!1,a=function(){++i>=t.length&&n in ko.batchListeners&&(ko.batchListeners[n](o),delete ko.batchListeners[n])};if(t.length>0){ko.batchListeners[n]=r;for(var s=0,c=t;s<c.length;s++){e(c[s],a,function(){o=!0,a()})}}else r(!1);return n},AsyncUtils.detachBatchListener=function(t){delete ko.batchListeners[t]},AsyncUtils}();!function(t){t.objectCache={},t.objectLoadingInProgress={},t.loadObjectFromData=function loadObjectFromData(e,r){var n=JSON.parse(r),i=x.instance.createObject(n.typeName);return t.objectCache[e]=i,i.isA(F)&&(i.isPersistent=!0),i.templatePath=e,i.deserialize(n)}}(Fo||(Fo={})),function(t){function loadObject(t,e,r,n){var i=Fo.objectCache[t];if(i){if(!n)return void e(i,!0);delete Fo.objectCache[t]}var o={loaded:e,error:r},a=Fo.objectLoadingInProgress[t];a?a.push(o):(Fo.objectLoadingInProgress[t]=[o],Pt.instance.read(t).then(function(e){Fo.loadObjectFromData(t,e).then(function(e){for(var r=0,n=Fo.objectLoadingInProgress[t];r<n.length;r++){n[r].loaded(e,!1)}delete Fo.objectLoadingInProgress[t]})}).catch(function(e){for(var r=0,n=Fo.objectLoadingInProgress[t];r<n.length;r++){n[r].error(e)}delete Fo.objectLoadingInProgress[t]}))}t.loadObject=loadObject,t.loadObjectById=function loadObjectById(t,e,r){var n=sa.getPath(t);n?loadObject(n,e,r,!1):r()},t.loadObjectIgnoreCache=function loadObjectIgnoreCache(t){return new Promise(function(e,r){loadObject(t,function(t){return e([t,!1])},r,!0)})},t.objectCache=function(){return Fo.objectCache}}(Do||(Do={}));var Lo,Vo=function(){function ObjectManager(){}return ObjectManager.prototype.loadObject=function(t){return new Promise(function(e,r){Do.loadObject(t,function(t,r){return e([t,r])},r,!1)})},ObjectManager.prototype.loadObjectById=function(t){return new Promise(function(e,r){Do.loadObjectById(t,function(t,r){return e([t,r])},r)})},ObjectManager.prototype.getObject=function(t){var e=sa.getPath(t);return e&&e in Fo.objectCache?Fo.objectCache[e]:null},ObjectManager.prototype.saveObject=function(t){var e=t.id,r=sa.getPath(e);return r?this.saveObjectAtPath(t,r):(V.log("Could not save object with id '"+e+"' (could not resolve its path)"),Promise.reject())},ObjectManager.prototype.saveObjectAtPath=function(t,e,r){return new Promise(function(n,i){var o=JSON.stringify(t.serialize(),null,2);Pt.instance.write(e,o).then(function(){r||Ko.recordAssetChange(qo.update,[t.id]),gr.objectSaved.post(t),n()}).catch(i)})},ObjectManager.prototype.renameObject=function(t,e){var r=this;Ko.parseFilePath(e,function(n,i){if(t in Fo.objectCache){var o=Fo.objectCache[t];delete Fo.objectCache[t],o.templatePath=e,Fo.objectCache[e]=o,o.name=n,r.saveObjectAtPath(o,e)}else Ko.parseFilePath(t,function(t,i){t!==n&&r.loadObject(e).then(function(t){var i=t[0];i.name=n,r.saveObjectAtPath(i,e)})})})},ObjectManager.prototype.deleteObject=function(t){t.destroy(),t.templatePath&&delete Fo.objectCache[t.templatePath]},ObjectManager.prototype.deleteObjectById=function(t){var e=sa.getPath(t);e&&this.deleteObjectByPath(e)},ObjectManager.prototype.deleteObjectByPath=function(t){var e=Fo.objectCache[t];e&&(this.deleteObject(e),delete Fo.objectCache[t])},ObjectManager.prototype.loadGraphicObjects=function(){for(var t=0,e=Object.values(Fo.objectCache);t<e.length;t++){var r=e[t];r.isA(q)&&r.graphicLoad()}},ObjectManager.prototype.unloadGraphicObjects=function(){for(var t=0,e=Object.values(Fo.objectCache);t<e.length;t++){var r=e[t];r.isA(q)&&r.graphicUnload()}},ObjectManager.prototype.addToCache=function(t){var e=t.templatePath;console.assert(e),console.assert(!(e in Fo.objectCache)),Fo.objectCache[e]=t},ObjectManager.prototype.clearCache=function(){for(var t=0,e=Object.values(Fo.objectCache);t<e.length;t++){e[t].destroy()}Fo.objectCache={}},ObjectManager.prototype.forEach=function(t){for(var e=0,r=Object.values(Fo.objectCache);e<r.length;e++){t(r[e])}},ObjectManager}();!function(t){(Do||(Do={})).create=function create(){I.instance=new Vo}}(),function(t){t[t.IndexedDbCreationFailed=0]="IndexedDbCreationFailed",t[t.EngineSettingsLoadFailed=1]="EngineSettingsLoadFailed",t[t.AssetIdsLoadFailed=2]="AssetIdsLoadFailed",t[t.WebGLContextCreationFailed=3]="WebGLContextCreationFailed"}(Lo||(Lo={}));var Uo,Wo=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}();!function(t){t.path="spider-engine.json"}(Uo||(Uo={}));var qo,Go=function(t){function EngineSettings(){var e=null!==t&&t.apply(this,arguments)||this;return e.canvasAlpha=!0,e.startupScene=void 0,e}return Wo(EngineSettings,t),Object.defineProperty(EngineSettings.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),EngineSettings.load=function(){var t=this;return new Promise(function(e,r){Do.loadObjectIgnoreCache(Uo.path).then(function(r){t._instance=r[0],e()}).catch(function(){t._instance=new EngineSettings,console.warn("spider-engine.json not found. Falling back to factory settings."),e()})})},Object.defineProperty(EngineSettings,"instance",{get:function(){return this._instance},enumerable:!0,configurable:!0}),EngineSettings.prototype.upgrade=function(t,e){return 1===e?delete t.properties.startupScenePath:2===e&&(console.assert(!1),Object.assign(t.properties,{startupScene:sa.getPath(t.properties.startupSceneId)}),console.assert(t.properties.startupScene),delete t.properties.startupSceneId),t},EngineSettings.prototype.save=function(){I.instance.saveObjectAtPath(this,Uo.path)},EngineSettings}(E),Ho=r(65);!function(t){t[t.update=0]="update",t[t.delete=1]="delete",t[t.create=2]="create"}(qo||(qo={}));var Xo,Ko=function(){function IOUtils(){}return IOUtils.recordAssetChange=function(t,e){var r=JSON.stringify(Date.now());localStorage.setItem("last_asset_write_time",r),localStorage.setItem("asset_changed",JSON.stringify({timeStamp:r,action:t,ids:e,metadata:IOUtils.assetChangeMetaData})),IOUtils.assetChangeMetaData&&(IOUtils.assetChangeMetaData=void 0)},IOUtils.parseFileName=function(t,e){var r=t.split(".");if(r.length>1){var n=r.pop();e(r.reduce(function(t,e){return t+"."+e}),n)}else e(t,"")},IOUtils.parseFilePath=function(t,e){var r=t.split(/[\/\\]+/);if(r.length>1){var n=r.slice(-1)[0];IOUtils.parseFileName(n,e)}else IOUtils.parseFileName(t,e)},IOUtils.parseFolderPath=function(t,e){var r=t.split(/[\/\\]+/);r.length>1?(r.pop(),e(r.reduce(function(t,e){return t+"/"+e}))):e(t)},IOUtils.parseFolderName=function(t,e){e(t.split(/[\/\\]+/).pop()||"")},IOUtils.importGameFromBlob=function(t,e,r){var n=function(t,n){t?e(n||!1):r()};(new Ho).loadAsync(t).then(function(t){var e={},r=Object.keys(t.files);No.processBatch(r,function(r,n,i){var o=t.file(r);o?o.async("string").then(function(t){["Assets/EngineSettings.json"].some(function(t){return t===r})?r=Uo.path:["idDatabase"].some(function(t){return t===r})&&(r=aa.path),e[r]=t,n()},i):n()},function(t){var r=Object.keys(e);No.processBatch(r,function(t,r,n){var i=e[t];Pt.instance.write(t,i).then(function(){return r()}).catch(function(){return n()})},function(t){n(!0,t)})})},function(){return n(!1)}).catch(function(){return n(!1)})},IOUtils.isDefaultAsset=function(t){var e=t.split("/");return e.length>1&&("Assets"===e[0]&&"DefaultAssets"===e[1])},IOUtils.assetChangeMetaData=void 0,IOUtils}(),Qo=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Yo=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Zo=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Jo=function(t){function Folder(){var e=null!==t&&t.apply(this,arguments)||this;return e.ids=new Rt(String),e.folders=new Rt(Folder),e.assetVersion=1,e}return Qo(Folder,t),Folder.prototype.isAncestor=function(t){return this.parent===t||!!this.parent&&this.parent.isAncestor(t)},Folder.prototype.findFolder=function(t){return this.folders.data.find(function(e){return e.name===t})},Folder.prototype.assignParentNodes=function(){for(var t=0,e=this.folders.data;t<e.length;t++){var r=e[t];r.parent=this,r.assignParentNodes()}},Yo([Attributes_hidden(),Zo("design:type",Object)],Folder.prototype,"ids",void 0),Yo([Attributes_hidden(),Zo("design:type",Object)],Folder.prototype,"folders",void 0),Yo([unserializable(),Zo("design:type",Folder)],Folder.prototype,"parent",void 0),Yo([Attributes_hidden(),Zo("design:type",Object)],Folder.prototype,"assetVersion",void 0),Folder}(E);!function(t){function getFolderPath(t){for(var e=t.parent,r=t.name;e;)r=e.name+"/"+r,e=e.parent;return r}t.getFolderPath=getFolderPath,t.isDefault=function isDefault(t){var e=getFolderPath(t);return Ko.isDefaultAsset(e)}}(Xo||(Xo={}));var $o,ta=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),ea=function(t){function Folders(){var e=t.call(this)||this;return e.assets=new Jo,e.externals=new Jo,e}return ta(Folders,t),Folders}(E);!function(t){function save(){return I.instance.saveObjectAtPath(t.folders,t.foldersPath)}t.foldersPath="Assets/folders.json",t.externalsPath="External Assets",t.load=function load(){return new Promise(function(e){Do.loadObjectIgnoreCache(t.foldersPath).then(function(r){t.folders=r[0],t.folders.assets.assignParentNodes(),t.folders.externals.assignParentNodes(),e([t.folders,!1])}).catch(function(){t.folders=new ea,t.folders.assets.name="Assets",t.folders.externals.name=t.externalsPath,save().then(function(){return e([t.folders,!0])})})})},t.save=save}($o||($o={}));var ra,na=function(){return(na=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};!function(t){t.idDatabase={},t.defaultAssetIds={},t.externalsIdDatabase={}}(ra||(ra={}));var ia,oa,aa=function(){function AssetIdDatabaseInternal(){}return Object.defineProperty(AssetIdDatabaseInternal,"fileName",{get:function(){return"ids.json"},enumerable:!0,configurable:!0}),Object.defineProperty(AssetIdDatabaseInternal,"path",{get:function(){return"Assets/"+AssetIdDatabaseInternal.fileName},enumerable:!0,configurable:!0}),Object.defineProperty(AssetIdDatabaseInternal,"defaultAssetIds",{set:function(t){ra.defaultAssetIds=t,ra.idDatabase=na({},ra.defaultAssetIds)},enumerable:!0,configurable:!0}),Object.defineProperty(AssetIdDatabaseInternal,"idDatabase",{get:function(){return ra.idDatabase},enumerable:!0,configurable:!0}),AssetIdDatabaseInternal.load=function(){return new Promise(function(t,e){Pt.instance.read(AssetIdDatabaseInternal.path).then(function(e){ra.idDatabase=na({},ra.defaultAssetIds,JSON.parse(e)),t()}).catch(function(){return e(Lo.AssetIdsLoadFailed)})})},AssetIdDatabaseInternal.reload=function(){return ra.idDatabase=na({},ra.defaultAssetIds),AssetIdDatabaseInternal.load()},AssetIdDatabaseInternal.getPath=function(t){var e=ra.idDatabase[t];return e||null},AssetIdDatabaseInternal.setPath=function(t,e){ra.idDatabase[t]=e,AssetIdDatabaseInternal.save().then(function(){Ko.recordAssetChange(qo.create,[t])})},AssetIdDatabaseInternal.setPaths=function(t,e){Object.assign(ra.idDatabase,t),(void 0===e||e)&&AssetIdDatabaseInternal.save().then(function(){Ko.recordAssetChange(qo.create,Object.keys(t))})},AssetIdDatabaseInternal.save=function(){return Pt.instance.write(AssetIdDatabaseInternal.path,JSON.stringify(ra.idDatabase,null,2))},AssetIdDatabaseInternal.deleteId=function(t){delete ra.idDatabase[t],AssetIdDatabaseInternal.save().then(function(){Ko.recordAssetChange(qo.delete,[t])}),AssetIdDatabaseInternal.events.assetsDeleted.post([t])},AssetIdDatabaseInternal.deleteIds=function(t,e){for(var r=0,n=t;r<n.length;r++){var i=n[r].valueOf();delete ra.idDatabase[i]}if(void 0===e||e){var o=t.map(function(t){return t.valueOf()});AssetIdDatabaseInternal.events.assetsDeleted.post(o),AssetIdDatabaseInternal.save().then(function(){Ko.recordAssetChange(qo.delete,o)})}},AssetIdDatabaseInternal.loadExternalIds=function(){ra.externalsIdDatabase={};var t=$o.folders.externals.folders.data;return new Promise(function(e){No.processBatch(t,function(t,e){AssetIdDatabaseInternal.addExternalIdDatabase(t.name,Xo.getFolderPath(t)).then(e)},function(){return e()})})},AssetIdDatabaseInternal.addExternalIdDatabase=function(t,e){return new Promise(function(r){Pt.instance.read(e+"/"+AssetIdDatabaseInternal.path).then(function(e){var n=JSON.parse(e);ra.externalsIdDatabase[t]=n,r()}).catch(r)})},AssetIdDatabaseInternal.deleteExternalIds=function(t){delete ra.externalsIdDatabase[t]},AssetIdDatabaseInternal.events={assetsDeleted:new B.AsyncEvent,assetMoved:new B.AsyncEvent},AssetIdDatabaseInternal}(),sa=function(){function AssetIdDatabase(){}return AssetIdDatabase.getPath=function(t){return aa.getPath(t)},AssetIdDatabase}();(ia||(ia={})).loadingMap=new Map,function(t){t.updateLoading=function updateLoading(){var t=ia.loadingMap;if(0!==t.size){var e=[];t.forEach(function(t,r){if(r.isLoaded()){for(var n=0,i=t;n<i.length;n++)i[n].post();e.push(r)}});for(var r=0,n=e;r<n.length;r++){var i=n[r];t.delete(i)}}}}(oa||(oa={}));var ca,ua=function(){function Assets(){}return Assets.load=function(t){return new Promise(function(e,r){I.instance.loadObject(t).then(function(t){var r=t[0];if(r.isLoaded())e(r);else{var n=ia.loadingMap,i=n.get(r);i?i.push(new B.VoidAsyncEvent):(i=[new B.VoidAsyncEvent],n.set(r,i)),i[i.length-1].once(function(){return e(r)})}}).catch(r)})},Assets.loadById=function(t){var e=sa.getPath(t);return e?Assets.load(e):Promise.reject("Could not resolve path for asset with id '"+t+"'")},Assets}();!function(t){t[t.Normal=0]="Normal",t[t.Particles=1]="Particles"}(ca||(ca={}));var la,pa=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),fa=function(t){function CollisionShape(){return null!==t&&t.apply(this,arguments)||this}return pa(CollisionShape,t),CollisionShape.prototype.getTestPriority=function(){return ca.Normal},CollisionShape.prototype.checkCollisions=function(t,e,r,n){},CollisionShape}(O),ha=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),da=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},ya=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ma=function(t){function StaticMeshAsset(){return null!==t&&t.apply(this,arguments)||this}return ha(StaticMeshAsset,t),Object.defineProperty(StaticMeshAsset.prototype,"vertexBuffer",{get:function(){return this._vertexBuffer},set:function(t){this._vertexBuffer&&this.graphicUnload(),this._vertexBuffer=t,delete this._boundingBox},enumerable:!0,configurable:!0}),Object.defineProperty(StaticMeshAsset.prototype,"boundingBox",{get:function(){if(!this._boundingBox&&this._vertexBuffer){var t=this._vertexBuffer,e=t.data,r=t.primitiveType,n=t.indices;this._boundingBox=pt.fromVertexArray(e.position,r,n)}return this._boundingBox},enumerable:!0,configurable:!0}),StaticMeshAsset.prototype.graphicUnload=function(){this._vertexBuffer.unload(gt.context)},da([unserializable(),ya("design:type",pt)],StaticMeshAsset.prototype,"_boundingBox",void 0),StaticMeshAsset=da([displayName("Static Mesh"),editable(!1),referencable(!0)],StaticMeshAsset)}(q),va=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),ga=function(t){function MeshCollisionShape(e){var r=t.call(this)||this;return r.tag="Mesh",r.mesh=new re(ma),e&&r.setState(e),r}return va(MeshCollisionShape,t),MeshCollisionShape.prototype.checkCollisions=function(t,e,r,n){},MeshCollisionShape}(fa);!function(t){!function(t){t.boxMin=new H,t.boxMax=new H}(t.boxIntersectsWithSphere||(t.boxIntersectsWithSphere={})),function(t){t._sphereWorldPos=new H}(t.boxIntersectsWithSphereShape||(t.boxIntersectsWithSphereShape={})),function(t){t.box1Min=new H,t.box1Max=new H,t.box2Min=new H,t.box2Max=new H}(t.boxIntersectsWithBox||(t.boxIntersectsWithBox={})),function(t){t._sphere1WorldPos=new H,t._sphere2WorldPos=new H}(t.sphereIntersectsWithSphereShape||(t.sphereIntersectsWithSphereShape={})),t.getLowestRoot=function getLowestRoot(t,e,r,n){var i=e*e-4*t*r;if(i<0)return null;var o=Math.sqrt(i),a=(-e-o)/(2*t),s=(-e+o)/(2*t);if(a>s){var c=s;s=a,a=c}return a>0&&a<n?a:s>0&&s<n?s:null},t.getBoxShapeMin=function getBoxShapeMin(t,e,r){return r.set(t.center.x-t.extent.x+e.x,t.center.y-t.extent.y+e.y,t.center.z-t.extent.z+e.z).asArray()},t.getBoxShapeMax=function getBoxShapeMax(t,e,r){return r.set(t.center.x+t.extent.x+e.x,t.center.y+t.extent.y+e.y,t.center.z+t.extent.z+e.z).asArray()}}(la||(la={}));var _a,ba=function(){function CollisionUtils(){}return Object.defineProperty(CollisionUtils,"boxMesh",{get:function(){return la.boxMesh||(la.boxMesh=ai.primitives.box.vertexBuffer),la.boxMesh},enumerable:!0,configurable:!0}),Object.defineProperty(CollisionUtils,"sphereMesh",{get:function(){return la.sphereMesh||(la.sphereMesh=ai.primitives.sphere.vertexBuffer),la.sphereMesh},enumerable:!0,configurable:!0}),CollisionUtils.boxIntersectsWithSphereShape=function(t,e,r,n){var i=la.boxIntersectsWithSphereShape._sphereWorldPos,o=H.dummy.copy(r.center).rotate(n.worldRotation);return i.addVectors(o,n.worldPosition),CollisionUtils.boxIntersectsWithSphere(t,e.worldPosition,i,r.radius)},CollisionUtils.boxIntersectsWithSphere=function(t,e,r,n){for(var i=0,o=0,a=la.boxIntersectsWithSphere,s=a.boxMin,c=a.boxMax,u=la.getBoxShapeMin(t,e,s),l=la.getBoxShapeMax(t,e,c),p=r.asArray(),f=0;f<3;++f)p[f]<u[f]?o+=(i=p[f]-u[f])*i:p[f]>l[f]&&(o+=(i=p[f]-l[f])*i);return o<=n*n},CollisionUtils.boxIntersectsWithBox=function(t,e,r,n){for(var i=la.boxIntersectsWithBox,o=i.box1Min,a=i.box1Max,s=i.box2Min,c=i.box2Max,u=la.getBoxShapeMin(t,e,o),l=la.getBoxShapeMax(t,e,a),p=la.getBoxShapeMin(r,n,s),f=la.getBoxShapeMax(r,n,c),h=0;h<3;++h)if(u[h]>f[h])return!1;for(h=0;h<3;++h)if(p[h]>l[h])return!1;return!0},CollisionUtils.sphereIntersectsWithSphereShape=function(t,e,r,n){var i=la.sphereIntersectsWithSphereShape,o=i._sphere1WorldPos,a=i._sphere2WorldPos,s=H.dummy.copy(t.center).rotate(e.worldRotation),c=H.dummy2.copy(r.center).rotate(n.worldRotation);return o.addVectors(s,e.worldPosition),a.addVectors(c,n.worldPosition),this.sphereIntersectsWithSphere(o,t.radius,a,r.radius)},CollisionUtils.sphereIntersectsWithSphere=function(t,e,r,n){var i=e+n;return H.distanceSq(t,r)<i*i},CollisionUtils.moveSphere=function(t,e,r,n,i,o,a,s,c){var u=CollisionUtils.boxMesh.getData("position"),l=CollisionUtils.sphereMesh.getData("position"),p=H.fromPool(),f=H.fromPool(),h=H.fromPool(),d=ar.fromPool(),y=he.fromPool(),m=H.fromPool(),v=H.fromPool(),g=H.fromPool(),_=H.fromPool(),b=he.fromPool(),w=3,P=function(t,e,r,n,i,o){var x=r.length;if(0===x)return!1;for(var O=!1,C=999999,S=H.fromPool().copy(r).multiply(1/x),R=0,j=n;R<j.length;R++){var T=j[R];if(!T.group||T.group.isAllowed(s,c))for(var E=0,B=T.shapes;E<B.length;E++){var A=B[E];if(A)if(A.isA(Oa)||A.isA(Pa)||A.isA(ga)){var I=null,M=null,k=void 0;if(A.isA(Oa))I=A,k=u;else if(A.isA(Pa))M=A,k=l;else{var z=A.mesh.asset;if(!z)continue;if("TRIANGLES"!==z.vertexBuffer.primitiveType)continue;if(z.vertexBuffer.indices)continue;k=z.vertexBuffer.getData("position")}for(var F=k.length/3/3,D=T.entity.transform.worldMatrix,N=0;N<F;++N){var L=9*N;if(I?(p.set(k[L]*I.extent.x+I.center.x,k[L+1]*I.extent.y+I.center.y,k[L+2]*I.extent.z+I.center.z).transform(D).multiply(1/e),f.set(k[L+3]*I.extent.x+I.center.x,k[L+4]*I.extent.y+I.center.y,k[L+5]*I.extent.z+I.center.z).transform(D).multiply(1/e),h.set(k[L+6]*I.extent.x+I.center.x,k[L+7]*I.extent.y+I.center.y,k[L+8]*I.extent.z+I.center.z).transform(D).multiply(1/e)):M?(p.set(k[L]*M.radius+M.center.x,k[L+1]*M.radius+M.center.y,k[L+2]*M.radius+M.center.z).transform(D).multiply(1/e),f.set(k[L+3]*M.radius+M.center.x,k[L+4]*M.radius+M.center.y,k[L+5]*M.radius+M.center.z).transform(D).multiply(1/e),h.set(k[L+6]*M.radius+M.center.x,k[L+7]*M.radius+M.center.y,k[L+8]*M.radius+M.center.z).transform(D).multiply(1/e)):(p.set(k[L],k[L+1],k[L+2]).transform(D).multiply(1/e),f.set(k[L+3],k[L+4],k[L+5]).transform(D).multiply(1/e),h.set(k[L+6],k[L+7],k[L+8]).transform(D).multiply(1/e)),y.setFromPoints(p,f,h),y.classifyPoint(t)===ue.Front)if(!(y.normal.dot(S)>=0)){var V=y.normal.dot(r),U=-1,W=-1,q=y.getSignedDistance(t),G=!1;if(0!==V){if((U=(1-q)/V)>(W=(-1-q)/V)){var X=W;W=U,U=X}if(U>1||W<0)continue;U=K.clamp(U,0,1),W=K.clamp(W,0,1)}else{if(!(Math.abs(q)<1))continue;U=0,W=1,G=!0}var Q=!1,Y=1;if(G||(m.copy(y.normal).flip().add(t),v.copy(r).multiply(U).add(m),d.set(p,f,h),d.contains(v)&&(Q=!0,Y=U)),!Q){var Z=r.lengthSq,J=void 0,$=void 0,tt=void 0,et=H.fromPool();J=Z,et.copy(t).substract(p),$=2*r.dot(et),tt=et.lengthSq-1;var rt=la.getLowestRoot(J,$,tt,Y);null!==rt&&(Y=rt,Q=!0,v.copy(p)),et.copy(t).substract(f),$=2*r.dot(et),tt=et.lengthSq-1,null!==(rt=la.getLowestRoot(J,$,tt,Y))&&(Y=rt,Q=!0,v.copy(f)),et.copy(t).substract(h),$=2*r.dot(et),tt=et.lengthSq-1,null!==(rt=la.getLowestRoot(J,$,tt,Y))&&(Y=rt,Q=!0,v.copy(h));var nt,it=H.fromPool().copy(f).substract(p),ot=H.fromPool().copy(p).substract(t),at=it.lengthSq,st=it.dot(r),ct=it.dot(ot);if(J=at*-Z+st*st,$=at*(2*r.dot(ot))-2*st*ct,tt=at*(1-ot.lengthSq)+ct*ct,null!==(rt=la.getLowestRoot(J,$,tt,Y)))(nt=(st*rt-ct)/at)>=0&&nt<=1&&(Y=rt,Q=!0,v.copy(it).multiply(nt).add(p));if(it.copy(h).substract(f),ot.copy(f).substract(t),at=it.lengthSq,st=it.dot(r),ct=it.dot(ot),J=at*-Z+st*st,$=at*(2*r.dot(ot))-2*st*ct,tt=at*(1-ot.lengthSq)+ct*ct,null!==(rt=la.getLowestRoot(J,$,tt,Y)))(nt=(st*rt-ct)/at)>=0&&nt<=1&&(Y=rt,Q=!0,v.copy(it).multiply(nt).add(f));if(it.copy(p).substract(h),ot.copy(h).substract(t),at=it.lengthSq,st=it.dot(r),ct=it.dot(ot),J=at*-Z+st*st,$=at*(2*r.dot(ot))-2*st*ct,tt=at*(1-ot.lengthSq)+ct*ct,null!==(rt=la.getLowestRoot(J,$,tt,Y)))(nt=(st*rt-ct)/at)>=0&&nt<=1&&(Y=rt,Q=!0,v.copy(it).multiply(nt).add(h))}if(!0===Q){var ut=Y*x;ut<C&&(g.copy(m),_.copy(v),C=ut,b.copy(y),O=!0)}}}}}}if(O){var lt=H.fromPool().addVectors(t,r),pt=H.fromPool().copy(t);if(C>=.1){var ft=H.fromPool().copy(S).multiply(C-.1);pt.addVectors(t,ft),ft.copy(S).multiply(.1),_.substract(ft)}var ht=H.fromPool().copy(_),dt=H.fromPool().copy(pt).substract(_).normalize();b.setFromPoint(dt,ht);var yt=b.getSignedDistance(lt),mt=H.fromPool().copy(dt).multiply(-yt).add(lt),vt=H.fromPool().copy(mt).substract(_);return o.copy(vt),i.copy(pt),a&&a.copy(dt),--w<0?!0:o.length<.001||(P(pt,e,vt,n,i,o),!0)}return!1},x=H.fromPool().copy(r).multiply(1/e),O=H.fromPool().copy(t).multiply(1/e),C=P(O,e,x,n,i,o);return C?(i.multiply(e),o.multiply(e)):(i.copy(t),o.copy(r)),C},CollisionUtils}(),wa=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Pa=function(t){function SphereCollisionShape(e){var r=t.call(this)||this;return r.tag="Sphere",r.center=new H,r.radius=1,e&&r.setState(e),r}return wa(SphereCollisionShape,t),SphereCollisionShape.prototype.checkCollisions=function(t,e,r,n){if(t.isA(Oa)){var i=t;ba.boxIntersectsWithSphereShape(i,r,this,e)&&n()}else if(t.isA(SphereCollisionShape)){var o=t;ba.sphereIntersectsWithSphereShape(this,e,o,r)&&n()}},SphereCollisionShape}(fa),xa=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Oa=function(t){function BoxCollisionShape(e){var r=t.call(this)||this;return r.tag="Box",r.center=new H,r.extent=new H(1,1,1),e&&r.setState(e),r}return xa(BoxCollisionShape,t),BoxCollisionShape.prototype.checkCollisions=function(t,e,r,n){if(t.isA(BoxCollisionShape)){var i=t;ba.boxIntersectsWithBox(this,e.worldPosition,i,r.worldPosition)&&n()}else if(t.isA(Pa)){var o=t;ba.boxIntersectsWithSphereShape(this,e,o,r)&&n()}},BoxCollisionShape}(fa),Ca=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Sa=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Ra=function(t){function CollisionGroup(){return null!==t&&t.apply(this,arguments)||this}return Ca(CollisionGroup,t),CollisionGroup.prototype.isAllowed=function(t,e){var r=this;return!(!!e&&e.some(function(t){return t===r}))&&(!t||t.some(function(t){return t===r}))},CollisionGroup=Sa([displayName("Collision Group")],CollisionGroup)}(F),ja=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ta=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Ea=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ba=function(t){function Collider(e){var r=t.call(this)||this;return r._group=new re(Ra),r._shapes=new Tt(fa),r._collision=new B.SyncEvent,e&&r.setState(e),0===r.shapes.length&&r._shapes.grow(new Oa),r}return ja(Collider,t),Object.defineProperty(Collider.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Collider.prototype,"group",{get:function(){return this._group.asset},enumerable:!0,configurable:!0}),Object.defineProperty(Collider.prototype,"shapes",{get:function(){return this._shapes.data.filter(function(t){return Boolean(t.instance)}).map(function(t){return t.instance})},set:function(t){var e=this;this._shapes.clear(),t.forEach(function(t){return e._shapes.grow(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(Collider.prototype,"onCollision",{set:function(t){this._collision.detach(),t&&this._collision.attach(t)},enumerable:!0,configurable:!0}),Object.defineProperty(Collider.prototype,"collision",{get:function(){return this._collision},enumerable:!0,configurable:!0}),Collider.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_shapes:t.properties.shapes}),delete t.properties.shapes),t},Collider.prototype.addShape=function(t){this._shapes.grow(t)},Collider.prototype.destroy=function(){t.prototype.destroy.call(this),this._collision.detach()},Ta([unserializable(),Ea("design:type",Object)],Collider.prototype,"_collision",void 0),Collider}(kt),Aa=function(){function Components(){}return Components.ofType=function(t){for(var e=[],r=0,n=Hc.list();r<n.length;r++){var i=n[r];e=e.concat(i.root.getComponents(t))}return e},Components}(),Ia=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ma=function(t){function VisualCollisionShape(e){var r=t.call(this)||this;return r.tag="Visual",r._visual=new qt(Uu),e&&r.setState(e),r}return Ia(VisualCollisionShape,t),Object.defineProperty(VisualCollisionShape.prototype,"visualEntity",{set:function(t){this._visual.component=t.getComponent(Uu)},enumerable:!0,configurable:!0}),Object.defineProperty(VisualCollisionShape.prototype,"visual",{get:function(){return this._visual.component},enumerable:!0,configurable:!0}),VisualCollisionShape.prototype.checkCollisions=function(t,e,r,n){},VisualCollisionShape}(fa),ka=function(){return function RaycastResult(){this.position=new H,this.normal=new H}}();!function(t){t.aabb=new pt,t.result=new ka,t.localRay=new De,t.invWorld=new st,t.rotatedCenter=new H,t.v1=new H,t.v2=new H,t.v3=new H,t.plane=new he,t.triangle=new ar}(_a||(_a={}));var za,Fa,Da,Na=function(){function Physics(){}return Physics.rayCast=function(t,e,r){for(var n=Aa.ofType(Ba),i=!1,o=999999,a=_a.aabb,s=_a.result,c=_a.localRay,u=_a.invWorld,l=_a.rotatedCenter,p=_a.v1,f=_a.v2,h=_a.v3,d=_a.plane,y=_a.triangle,m=0,v=n;m<v.length;m++){var g=v[m];if(!g.group||g.group.isAllowed(e,r)){var _=g.shapes[0],b=g.entity.transform;if(_)if(_.isA(Pa)){var w=_;u.copy(b.worldMatrix).translate(w.center).invert(),c.copy(t).transform(u);var P=c.castOnSphere(H.zero,w.radius);if(P){var x=P.intersection1.transform(b.worldMatrix);(M=H.distance(x,t.origin))<o&&(o=M,s.position.copy(x),s.normal.copy(P.normal1.rotate(b.worldRotation)),s.collider=g,s.shape=_,i=!0)}}else if(_.isA(Oa)){var O=_;l.copy(O.center).rotate(b.worldRotation),a.min.set(l.x-O.extent.x,l.y-O.extent.y,l.z-O.extent.z),a.max.set(l.x+O.extent.x,l.y+O.extent.y,l.z+O.extent.z),u.getInverse(b.worldMatrix),c.copy(t).transform(u);var C=c.castOnAABB(a);if(C){x=C.intersection1.transform(b.worldMatrix);(M=H.distance(x,t.origin))<o&&(o=M,s.position.copy(x),s.normal.copy(C.normal1.rotate(b.worldRotation)),s.collider=g,s.shape=_,i=!0)}}else if(_.isA(Ma)||_.isA(ga)){var S=null;if(_.isA(Ma)){var R=_.visual,j=R?R.geometry:void 0;S=j?j.getVertexBuffer():null}else{var T=_.mesh.asset;S=T?T.vertexBuffer:null}if(S){if("TRIANGLES"!==S.primitiveType||S.indices)continue;for(var E=S.getData("position"),B=E.length/3/3,A=0;A<B;++A){var I=9*A;p.set(E[I],E[I+1],E[I+2]).transform(b.worldMatrix),f.set(E[I+3],E[I+4],E[I+5]).transform(b.worldMatrix),h.set(E[I+6],E[I+7],E[I+8]).transform(b.worldMatrix),d.setFromPoints(p,f,h);var M,k=t.castOnPlane(d);if(k.intersection)if(k.classification===ue.Front)if(y.set(p,f,h),y.contains(k.intersection))(M=H.distance(k.intersection,t.origin))<o&&(o=M,s.position.copy(k.intersection),s.normal.copy(d.normal),s.collider=g,s.shape=_,i=!0)}}}}}return i?s:null},Physics}(),La=function(){function Config(){}return Config.isWeb=function(){return!0},Config.isDesktop=function(){return!1},Config.isProduction=function(){return!0},Config.isDevelopment=function(){return!1},Config.isEditor=function(){return!1},Config.isStandalone=function(){return!0},Config}(),Va=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ua=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Wa=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},qa=function(t){function DrawableTexture(){var e=null!==t&&t.apply(this,arguments)||this;return e._width=1024,e._height=768,e._rgba=!1,e._filtering=s.Linear,e._data=new pe.a,e._structureDirty=!0,e._pixelsDirty=!0,e}return Va(DrawableTexture,t),Object.defineProperty(DrawableTexture.prototype,"rgba",{get:function(){return this._rgba},set:function(t){this._rgba=t,this._structureDirty=!0},enumerable:!0,configurable:!0}),Object.defineProperty(DrawableTexture.prototype,"width",{set:function(t){t!==this._width&&(this._width=t,this._structureDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(DrawableTexture.prototype,"height",{set:function(t){t!==this._height&&(this._height=t,this._structureDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(DrawableTexture.prototype,"data",{set:function(t){this._data.array=t,this._pixelsDirty=!0},enumerable:!0,configurable:!0}),DrawableTexture.prototype.getWidth=function(){return this._width},DrawableTexture.prototype.getHeight=function(){return this._height},DrawableTexture.prototype.begin=function(t){var e=gt.context;return this._textureId?(e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),this._structureDirty&&this.updateStructure(),this._pixelsDirty&&this.uploadTexturePixels()):(this._textureId=e.createTexture(),e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),this._filtering===s.Nearest?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR)),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.updateStructure(),this.uploadTexturePixels()),!0},DrawableTexture.prototype.setPixel=function(t,e,r){if(t<0||t>this._width)V.logWarning("DrawableTexture.putPixel: pixel is out of bounds (x = "+t+", width = "+this._width+")");else if(e<0||e>this._height)V.logWarning("DrawableTexture.putPixel: pixel is out of bounds (y = "+t+", height = "+this._height+")");else if(this._textureId){this._structureDirty&&this.updateStructure();var n=this._width*this._bytesPerPixel*e+t*this._bytesPerPixel;this._data.array[n+0]=255*r.r,this._data.array[n+1]=255*r.g,this._data.array[n+2]=255*r.b,this.rgba&&(this._data.array[n+3]=255*r.a),this._pixelsDirty=!0}else V.logWarning("DrawableTexture.putPixel: texture not loaded yet")},DrawableTexture.prototype.updateStructure=function(){this._bytesPerPixel=this._rgba?4:3,this._data.length=this._width*this._height*this._bytesPerPixel,this._structureDirty=!1},DrawableTexture.prototype.uploadTexturePixels=function(){var t=gt.context;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1);var e=this._rgba?t.RGBA:t.RGB;t.texImage2D(t.TEXTURE_2D,0,e,this._width,this._height,0,e,t.UNSIGNED_BYTE,this._data.array),this._pixelsDirty=!1},Ua([Attributes_hidden(),Wa("design:type",Object)],DrawableTexture.prototype,"_data",void 0),Ua([unserializable(),Wa("design:type",Object)],DrawableTexture.prototype,"_structureDirty",void 0),Ua([unserializable(),Wa("design:type",Object)],DrawableTexture.prototype,"_pixelsDirty",void 0),Ua([unserializable(),Wa("design:type",Number)],DrawableTexture.prototype,"_bytesPerPixel",void 0),DrawableTexture=Ua([creatable(!0),referencable(!0),displayName("Drawable Texture")],DrawableTexture)}(En);!function(t){t[t.Near=0]="Near",t[t.Far=1]="Far",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Bottom=4]="Bottom",t[t.Top=5]="Top",t[t.Count=6]="Count"}(za||(za={})),function(t){t[t.FarTopLeft=0]="FarTopLeft",t[t.FarTopRight=1]="FarTopRight",t[t.FarBottomLeft=2]="FarBottomLeft",t[t.FarBottomRight=3]="FarBottomRight",t[t.NearTopLeft=4]="NearTopLeft",t[t.NearTopRight=5]="NearTopRight",t[t.NearBottomLeft=6]="NearBottomLeft",t[t.NearBottomRight=7]="NearBottomRight",t[t.Count=8]="Count"}(Fa||(Fa={})),function(t){!function(t){t.fCenter=new H,t.nCenter=new H,t.temp1=new H,t.temp2=new H}(t.update||(t.update={}))}(Da||(Da={}));var Ga,Ha=function(){function Frustum(){this._planes=[],this._planes.length=za.Count;for(var t=0;t<za.Count;++t)this._planes[t]=new he;this._corners=[],this._corners.length=Fa.Count;for(t=0;t<Fa.Count;++t)this._corners[t]=new H}return Object.defineProperty(Frustum.prototype,"corners",{get:function(){return this._corners},enumerable:!0,configurable:!0}),Frustum.prototype.isPointInside=function(t){for(var e=0,r=this._planes;e<r.length;e++){if(r[e].classifyPoint(t)===ue.Front)return!1}return!0},Frustum.prototype.update=function(t,e,r,n,i,o,a){var s=Da.update,c=s.fCenter,u=s.nCenter,l=s.temp1,p=s.temp2;c.copy(a.worldForward).multiply(-o).add(a.worldPosition),this._corners[Fa.FarTopLeft].addVectors(l.copy(a.worldUp).multiply(n),p.copy(a.worldRight).multiply(-r)).add(c),this._corners[Fa.FarTopRight].addVectors(l.copy(a.worldUp).multiply(n),p.copy(a.worldRight).multiply(r)).add(c),this._corners[Fa.FarBottomLeft].addVectors(l.copy(a.worldUp).multiply(-n),p.copy(a.worldRight).multiply(-r)).add(c),this._corners[Fa.FarBottomRight].addVectors(l.copy(a.worldUp).multiply(-n),p.copy(a.worldRight).multiply(r)).add(c),u.copy(a.worldForward).multiply(-i).add(a.worldPosition),this._corners[Fa.NearTopLeft].addVectors(l.copy(a.worldUp).multiply(e),p.copy(a.worldRight).multiply(-t)).add(u),this._corners[Fa.NearTopRight].addVectors(l.copy(a.worldUp).multiply(e),p.copy(a.worldRight).multiply(t)).add(u),this._corners[Fa.NearBottomLeft].addVectors(l.copy(a.worldUp).multiply(-e),p.copy(a.worldRight).multiply(-t)).add(u),this._corners[Fa.NearBottomRight].addVectors(l.copy(a.worldUp).multiply(-e),p.copy(a.worldRight).multiply(t)).add(u),this._planes[za.Top].setFromPoints(this._corners[Fa.NearTopLeft],this._corners[Fa.FarTopLeft],this._corners[Fa.FarTopRight]),this._planes[za.Bottom].setFromPoints(this._corners[Fa.NearBottomRight],this._corners[Fa.FarBottomRight],this._corners[Fa.FarBottomLeft]),this._planes[za.Left].setFromPoints(this._corners[Fa.FarBottomLeft],this._corners[Fa.FarTopLeft],this._corners[Fa.NearTopLeft]),this._planes[za.Right].setFromPoints(this._corners[Fa.NearBottomRight],this._corners[Fa.NearTopRight],this._corners[Fa.FarTopRight]),this._planes[za.Near].setFromPoints(this._corners[Fa.NearBottomLeft],this._corners[Fa.NearTopLeft],this._corners[Fa.NearTopRight]),this._planes[za.Far].setFromPoints(this._corners[Fa.FarBottomRight],this._corners[Fa.FarTopRight],this._corners[Fa.FarTopLeft])},Frustum}(),Xa=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ka=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Qa=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ya=function(t){function Projector(){var e=null!==t&&t.apply(this,arguments)||this;return e.changed=new B.VoidSyncEvent,e.zNear=.2,e.zFar=1e3,e._frustum=new Ha,e}return Xa(Projector,t),Object.defineProperty(Projector.prototype,"frustum",{get:function(){return this._frustum},enumerable:!0,configurable:!0}),Projector.prototype.getProjectionMatrix=function(){return st.identity},Projector.prototype.updateFrustum=function(t,e){},Ka([unserializable(),Qa("design:type",Object)],Projector.prototype,"changed",void 0),Ka([unserializable(),Qa("design:type",Object)],Projector.prototype,"_frustum",void 0),Projector}(O),Za=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ja=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},$a=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};(Ga||(Ga={})).worker=null;var ts,es=function(t){function Raytracer(e){var r=t.call(this)||this;return r.reflections=!0,r.shadows=!0,r.shadowRadius=.6,r.shadowResolution=6,r.maxBounces=3,r._target=new re(qa),r._projector=new a(Ya),r._initialized=!1,r._savePending=!1,e&&r.setState(e),r}return Za(Raytracer,t),Object.defineProperty(Raytracer.prototype,"target",{set:function(t){this._target.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Raytracer.prototype,"projector",{set:function(t){this._projector.instance=t},enumerable:!0,configurable:!0}),Raytracer.prototype.update=function(){if(this._initialized){if(this._savePending){var t=this._target.asset;t&&t.save(),this._savePending=!1}}else Ga.worker?V.logWarning("Only one raytracing worker allowed, ignoring Raytracer component on Entity '"+this.entity.name):this.raytrace()},Raytracer.prototype.destroy=function(){t.prototype.destroy.call(this),this.terminate()},Raytracer.prototype.restart=function(){this.terminate(),this.raytrace()},Raytracer.prototype.raytrace=function(){var t=this,e=this._target.asset,r=this._projector.instance;if(e&&r){var n=new Worker("/dist/spider_raytracer_prod.js"),i={config:"standalone",scenePath:Hc.list()[0].templatePath,targetWidth:e.getWidth(),targetHeight:e.getHeight(),rgba:e.rgba,projector:r.serialize(),worldMatrix:this.entity.transform.worldMatrix,settings:{reflections:this.reflections,shadows:this.shadows,shadowRadius:this.shadowRadius,shadowResolution:this.shadowResolution,maxBounces:this.maxBounces}};Object.assign(i,{standaloneFiles:xt.file.temporaryGetFiles()}),n.postMessage(i),n.onmessage=function(r){r.data?e.data=new Uint8Array(r.data):(V.log("Raytracer finished."),Ga.worker=null,t._savePending=!0)},Ga.worker=n,this._initialized=!0}},Raytracer.prototype.terminate=function(){this._initialized&&Ga.worker&&(V.log("Terminating Raytracer.."),Ga.worker.terminate(),Ga.worker=null,this._initialized=!1)},Ja([unserializable(),$a("design:type",Object)],Raytracer.prototype,"_initialized",void 0),Ja([unserializable(),$a("design:type",Object)],Raytracer.prototype,"_savePending",void 0),Raytracer}(kt),rs=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),ns=function(t){function Volume(){return null!==t&&t.apply(this,arguments)||this}return rs(Volume,t),Volume.prototype.emitPoint=function(t){return t},Volume.prototype.getCenter=function(t){return t},Volume}(O),is=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}();!function(t){t[t.Changed=0]="Changed",t[t.Unchanged=1]="Unchanged"}(ts||(ts={}));var os,as=function(t){function Geometry(){return null!==t&&t.apply(this,arguments)||this}return is(Geometry,t),Geometry.prototype.getVertexBuffer=function(){return null},Geometry.prototype.getBoundingBox=function(){return null},Geometry.prototype.getWorldTransform=function(t){return t.worldMatrix},Geometry.prototype.graphicUpdate=function(t,e,r,n,i){return ts.Unchanged},Geometry}(O),ss=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),cs=function(t){function ParticleShape(){return null!==t&&t.apply(this,arguments)||this}return ss(ParticleShape,t),ParticleShape.prototype.tesselate=function(t,e,r){t[e+0]=-r,t[e+1]=-r,t[e+2]=0,t[e+3]=r,t[e+4]=-r,t[e+5]=0,t[e+6]=r,t[e+7]=r,t[e+8]=0,t[e+9]=-r,t[e+10]=-r,t[e+11]=0,t[e+12]=r,t[e+13]=r,t[e+14]=0,t[e+15]=-r,t[e+16]=r,t[e+17]=0},ParticleShape.prototype.getUvs=function(t,e){t[e+0]=0,t[e+1]=0,t[e+2]=1,t[e+3]=0,t[e+4]=1,t[e+5]=1,t[e+6]=0,t[e+7]=0,t[e+8]=1,t[e+9]=1,t[e+10]=0,t[e+11]=1},ParticleShape.prototype.makeLocalTransform=function(t,e){t.makeLookAt(e.worldForward,e.worldUp).transpose()},ParticleShape.prototype.makeParticleTransform=function(t,e){},ParticleShape.prototype.vertexCount=function(){return 6},ParticleShape.prototype.destroy=function(){},ParticleShape}(O),us=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),ls=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},ps=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.dataOffsets={position:0,velocity:3,color:6,life:10,remainingLife:11,size:12,active:13,MAX:14},t.getDataOffset=function getDataOffset(e,r,n){return r*t.dataOffsets.MAX+t.dataOffsets[e]+n},t.particlePos=new H,t.particleVelocity=new H,t.color=new Z,t.localTransform=new st}(os||(os={}));var fs,hs=function(t){function ParticlesGeometry(e,r){var n=t.call(this)||this;return n._worldTransform=new st,n._worldSpace=!1,n._particleCount=0,n._maxParticles=0,n._shape=r,r&&(r.onPropertyChanged=function(t){return n.onParticleShapePropertyChanged(t)}),e&&(n._maxParticles=e),n._maxParticles&&n.initVertexBuffer(n._maxParticles),n}return us(ParticlesGeometry,t),Object.defineProperty(ParticlesGeometry.prototype,"vb",{get:function(){return this._vb},enumerable:!0,configurable:!0}),Object.defineProperty(ParticlesGeometry.prototype,"worldSpace",{set:function(t){this._worldSpace=t},enumerable:!0,configurable:!0}),Object.defineProperty(ParticlesGeometry.prototype,"particleCount",{set:function(t){this._particleCount=t},enumerable:!0,configurable:!0}),Object.defineProperty(ParticlesGeometry.prototype,"shape",{set:function(t){var e=this;this._shape&&delete this._shape.onPropertyChanged,this._shape=t,t&&(t.onPropertyChanged=function(t){return e.onParticleShapePropertyChanged(t)}),this.initVertexBuffer(this._maxParticles)},enumerable:!0,configurable:!0}),ParticlesGeometry.prototype.destroy=function(){this._vb&&this._vb.unload(gt.context),t.prototype.destroy.call(this)},ParticlesGeometry.prototype.getVertexBuffer=function(){return this._vb},ParticlesGeometry.prototype.getWorldTransform=function(t){return this._worldTransform.copy(st.identity),this._worldSpace||(this._worldTransform.scale(t.worldScale),this._worldTransform.setPosition(t.worldPosition)),this._worldTransform},ParticlesGeometry.prototype.graphicUpdate=function(t,e,r,n,i){if(!this._shape)return this._vb.vertexCount=0,ts.Unchanged;var o=os.particlePos,a=os.particleVelocity,s=os.color,c=os.localTransform,u=this._vb.data.position,l=this._vb.data.color,p=0,f=0;this._shape.makeLocalTransform(c,t.entity.transform);for(var h=this._shape.vertexCount(),d=this._particleCount,y=H.fromPool(),m=0;m<this._maxParticles&&0!==d;++m){if(0!==this.getData("active",m)){this.getVector3("position",m,o),this.getVector3("velocity",m,a),this._shape.makeParticleTransform(c,a),c.setPosition(o);var v=this.getData("size",m);this._shape.tesselate(u,p,v);for(var g=0;g<h;++g){var _=3*g;y.setFromArray(u,p+_).transform(c).toArray(u,p+_)}p+=3*h,this.getColor(m,s);for(g=0;g<h;++g){l[(_=f+4*g)+0]=s.r,l[_+1]=s.g,l[_+2]=s.b,l[_+3]=s.a}f+=4*h,--d}}return this._vb.vertexCount=p/3,this._vb.dirtifyData("position"),this._vb.dirtifyData("color"),ts.Changed},ParticlesGeometry.prototype.initVertexBuffer=function(t){if(this._vb&&this._vb.unload(gt.context),this._vb=new Ot,this._maxParticles=t,this._interleavedData||(this._interleavedData=[]),this.resetData(t),this._shape){var e=this._shape.vertexCount();if(0!==e){var r=[];r.length=e*t,this._vb.setData("position",r);var n=[];n.length=4*this._vb.vertexCount,this._vb.setData("color",n);var i=[];i.length=2*this._vb.vertexCount;for(var o=0,a=0;a<t;++a)this._shape.getUvs(i,o),o+=2*e;this._vb.setData("uv",i),this._vb.isDynamic=!0,this._vb.primitiveType="TRIANGLES"}}},ParticlesGeometry.prototype.resetData=function(t){var e=t*os.dataOffsets.MAX;this._interleavedData.length=e;for(var r=0;r<e;++r)this._interleavedData[r]=0},ParticlesGeometry.prototype.getData=function(t,e,r){var n=os.getDataOffset(t,e,r||0);return this._interleavedData[n]},ParticlesGeometry.prototype.setData=function(t,e,r,n){var i=os.getDataOffset(t,e,n||0);this._interleavedData[i]=r},ParticlesGeometry.prototype.setVector3=function(t,e,r){this.setData(t,e,r.x,0),this.setData(t,e,r.y,1),this.setData(t,e,r.z,2)},ParticlesGeometry.prototype.getVector3=function(t,e,r){r.x=this.getData(t,e,0),r.y=this.getData(t,e,1),r.z=this.getData(t,e,2)},ParticlesGeometry.prototype.setColor=function(t,e){this.setData("color",t,e.r,0),this.setData("color",t,e.g,1),this.setData("color",t,e.b,2),this.setData("color",t,e.a,3)},ParticlesGeometry.prototype.getColor=function(t,e){e.r=this.getData("color",t,0),e.g=this.getData("color",t,1),e.b=this.getData("color",t,2),e.a=this.getData("color",t,3)},ParticlesGeometry.prototype.onParticleShapePropertyChanged=function(t){this.initVertexBuffer(this._maxParticles)},ls([unserializable(),ps("design:type",Ot)],ParticlesGeometry.prototype,"_vb",void 0),ls([unserializable(),ps("design:type",Array)],ParticlesGeometry.prototype,"_interleavedData",void 0),ls([unserializable(),ps("design:type",Object)],ParticlesGeometry.prototype,"_worldTransform",void 0),ls([unserializable(),ps("design:type",Object)],ParticlesGeometry.prototype,"_worldSpace",void 0),ls([unserializable(),ps("design:type",Object)],ParticlesGeometry.prototype,"_particleCount",void 0),ls([unserializable(),ps("design:type",Object)],ParticlesGeometry.prototype,"_maxParticles",void 0),ls([unserializable(),ps("design:type",cs)],ParticlesGeometry.prototype,"_shape",void 0),ParticlesGeometry=ls([creatable(!1),displayName("Particles"),ps("design:paramtypes",[Number,cs])],ParticlesGeometry)}(as),ds=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),ys=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},ms=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},vs=function(t){function BoxVolume(e){var r=t.call(this)||this;return r.center=new H,r.extent=new H(1,1,1),e&&r.setState(e),r}return ds(BoxVolume,t),BoxVolume.prototype.emitPoint=function(t){return t.x=this.center.x+K.lerp(-this.extent.x,this.extent.x,Math.random()),t.y=this.center.y+K.lerp(-this.extent.y,this.extent.y,Math.random()),t.z=this.center.z+K.lerp(-this.extent.z,this.extent.z,Math.random()),t},BoxVolume.prototype.getCenter=function(t){return t.copy(this.center)},BoxVolume=ys([displayName("Box"),ms("design:paramtypes",[Object])],BoxVolume)}(ns),gs=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),_s=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},bs=function(t){function VisualGroup(){return null!==t&&t.apply(this,arguments)||this}return gs(VisualGroup,t),VisualGroup=_s([displayName("Visual Group")],VisualGroup)}(F),ws=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ps=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},xs=function(t){function BillboardParticle(){return null!==t&&t.apply(this,arguments)||this}return ws(BillboardParticle,t),BillboardParticle=Ps([displayName("Billboard")],BillboardParticle)}(cs),Os=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Cs=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Ss=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Up=0]="Up",t[t.Forward=1]="Forward",t[t.Right=2]="Right",t[t.AwayFromCenter=3]="AwayFromCenter"}(fs||(fs={}));var Rs,js=function(){function ParticleEmitDirectionMetadata(){}return ParticleEmitDirectionMetadata.literals={Up:0,Forward:1,Right:2,AwayFromCenter:3},ParticleEmitDirectionMetadata}();!function(t){var e;t.shapeWorldPos=new H,t.particlePos=new H,t.particleVelocity=new H,t.particleColor=new Z,t.worldPos=new H,t.makeDirection=((e={})[fs.Up]=function(t,e,r,n){return n.copy(t.worldUp)},e[fs.Forward]=function(t,e,r,n){return n.copy(t.worldForward)},e[fs.Right]=function(t,e,r,n){return n.copy(t.worldRight)},e[fs.AwayFromCenter]=function(t,e,r,n){n.copy(e).substract(r);var i=n.length;return i>0?n.multiply(1/i):n.set(Gt.range(-1,1),Gt.range(-1,1),Gt.range(-1,1)).normalize()},e)}(Rs||(Rs={}));var Ts,Es=function(t){function ParticleValueOverLife(e,r){var n=t.call(this)||this;return n.life=0,n.life=e||0,void 0!==r&&(n.value=r),n}return Os(ParticleValueOverLife,t),ParticleValueOverLife.evaluate=function(t,e,r){var n=t.filter(function(t){return t.life>e});if(n.length===t.length)return r&&r.copy(n[0].value),n[0].value;var i=t.filter(function(t){return t.life<=e});console.assert(i.length>0);var o=i[i.length-1];if(i.length===t.length)return r&&r.copy(o.value),o.value;console.assert(n.length>0);var a=n[0],s=(e-o.life)/(a.life-o.life);return o.lerp(o.value,a.value,s,r)},ParticleValueOverLife.prototype.lerp=function(t,e,r,n){},ParticleValueOverLife}(O),Bs=function(t){function ParticleNumberOverLife(e,r){return t.call(this,e,r||0)||this}return Os(ParticleNumberOverLife,t),ParticleNumberOverLife.prototype.lerp=function(t,e,r){return K.lerp(t,e,r)},ParticleNumberOverLife}(Es),As=function(t){function ParticleColorOverLife(e,r){return t.call(this,e,r||new Z)||this}return Os(ParticleColorOverLife,t),ParticleColorOverLife.prototype.lerp=function(t,e,r,n){return Z.lerp(t,e,r,n)},ParticleColorOverLife}(Es),Is=function(t){function Particles(e){var r=t.call(this)||this;return r.duration=6,r.isLooping=!1,r.worldSpace=!1,r.maxParticles=128,r.particlesPerSecond=30,r.life=new Ht(1,2),r.gravity=9.8,r.direction=fs.Up,r.initialSpeed=new Ht(1,2),r.initialSize=new Ht(1,2),r.initialColor=new Z(1,1,1,1),r._volume=new a(ns),r._shape=new a(cs),r._speedOverLife=new Rt(Bs),r._sizeOverLife=new Rt(Bs),r._colorOverLife=new Rt(As),r._group=new re(bs),r._material=new re(Cu),r._particleCount=0,r._newParticlesCounter=0,r._isEmitting=!0,r._emitTime=-1,r._emitCenter=new H,e&&r.setState(e),r.onMaterialChanged=r.onMaterialChanged.bind(r),r.onGroupChanged=r.onGroupChanged.bind(r),r._material.assetChanged.attach(r.onMaterialChanged),r._group.assetChanged.attach(r.onGroupChanged),r._volume.instance||(r._volume.instance=new vs),r._material.asset||(r._material.asset=ai.materials.particles),r._shape.instance||(r._shape.instance=new xs),r}return Os(Particles,t),Object.defineProperty(Particles.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"visual",{get:function(){return this.entity.getComponent(Uu)},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"geometry",{get:function(){return this.visual.geometry},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"volume",{set:function(t){this._volume.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"shape",{set:function(t){this._shape.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"speedOverLife",{set:function(t){var e=this;this._speedOverLife.clear(),t.forEach(function(t){return e._speedOverLife.grow(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"sizeOverLife",{set:function(t){var e=this;this._sizeOverLife.clear(),t.forEach(function(t){return e._sizeOverLife.grow(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"colorOverLife",{set:function(t){var e=this;this._colorOverLife.clear(),t.forEach(function(t){return e._colorOverLife.grow(t)})},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"group",{set:function(t){this._group.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Particles.prototype,"material",{set:function(t){this._material.asset=t},enumerable:!0,configurable:!0}),Particles.prototype.setParticleLife=function(t,e){this.geometry.setData("remainingLife",t,e)},Particles.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.getOrSetComponent(Lt),e.setComponent(Uu,{geometry:new hs(this.maxParticles,this._shape.instance),material:this._material.asset,group:this._group.asset,castShadows:!1,controller:this}),this.initEmitter()},Particles.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r)},Particles.prototype.destroy=function(){t.prototype.destroy.call(this),this.entity.clearComponent(Uu),this._shape.instance&&this._shape.instance.destroy(),this._material.detach(),this._group.detach()},Particles.prototype.emitParticle=function(){this._volume.instance&&this._newParticlesCounter++},Particles.prototype.update=function(){var t=nt.deltaTime,e=this._volume.instance,r=0;this._isEmitting&&(this._emitTime<=0&&(this.isLooping?this._emitTime+=this.duration:this._isEmitting=!1),this._isEmitting&&e&&(this._newParticlesCounter+=t*this.particlesPerSecond)),r=Math.floor(this._newParticlesCounter),this._particleCount+r>this.maxParticles&&(r=this.maxParticles-this._particleCount);for(var n=0,i=r+this._particleCount,o=Rs.particlePos,a=Rs.particleVelocity,s=Rs.particleColor,c=0;c<this.maxParticles&&0!==i;++c){if(0===this.geometry.getData("active",c)){if(n<r){this.geometry.setData("active",c,1);var u=this.life.random();this.geometry.setData("life",c,u),this.geometry.setData("remainingLife",c,u),this.geometry.setData("size",c,this.initialSize.random()),e.emitPoint(o),e.getCenter(this._emitCenter),Rs.makeDirection[this.direction](this.entity.transform,o,this._emitCenter,a),a.multiply(this.initialSpeed.random()),this.worldSpace&&o.add(this.entity.transform.worldPosition),this.geometry.setVector3("position",c,o),this.geometry.setVector3("velocity",c,a),this.geometry.setColor(c,this.initialColor),++n,++this._particleCount,--i}}else{var l=this.geometry.getData("remainingLife",c)-t;if(l<0)this.geometry.setData("active",c,0),--this._particleCount;else{var p=1-l/(u=this.geometry.getData("life",c));if(this.geometry.getVector3("velocity",c,a),a.y+=-this.gravity*t,this.geometry.setData("velocity",c,a.y,1),this._speedOverLife.data.length>0){var f=Es.evaluate(this._speedOverLife.data,p);a.normalize().multiply(f)}if(this.geometry.getVector3("position",c,o),o.add(a.multiply(t)),this.geometry.setVector3("position",c,o),this._colorOverLife.data.length>0&&(Es.evaluate(this._colorOverLife.data,p,s),this.geometry.setColor(c,s)),this._sizeOverLife.data.length>0){var h=Es.evaluate(this._sizeOverLife.data,p);this.geometry.setData("size",c,h)}this.geometry.setData("remainingLife",c,l)}--i}}this._newParticlesCounter-=r,this._isEmitting&&(this._emitTime-=t),this.geometry.particleCount=this._particleCount},Particles.prototype.checkCollisions=function(t,e,r){var n=this,i=Rs.shapeWorldPos;if(t.isA(Oa)){var o=t;i.copy(o.center).add(e.worldPosition),this.checkCollisionsInternal(function(t,e){ba.boxIntersectsWithSphere(o,i,e,n.geometry.getData("size",t))&&r(t)})}else if(t.isA(Pa)){var a=t;i.copy(a.center).add(e.worldPosition),this.checkCollisionsInternal(function(t,e){ba.sphereIntersectsWithSphere(i,a.radius,e,n.geometry.getData("size",t))&&r(t)})}},Particles.prototype.upgrade=function(t,e){if(1===e){Object.assign(t.properties,{_volume:t.properties.volume,_shape:t.properties.shape,_speedOverLife:t.properties.speedOverLife,_sizeOverLife:t.properties.sizeOverLife,_colorOverLife:t.properties.colorOverLife,_group:t.properties.group,_material:t.properties.material}),delete t.properties.volume,delete t.properties.shape,delete t.properties.speedOverLife,delete t.properties.sizeOverLife,delete t.properties.colorOverLife,delete t.properties.group,delete t.properties.material,t.properties._volume.baseTypeName="Volume";var r=t.properties._volume.data.typeName;t.properties._volume.data.typeName=r+"Volume"}return t},Particles.prototype.checkCollisionsInternal=function(t){for(var e=this._particleCount,r=0;r<this.maxParticles&&0!==e;++r){if(0!==this.geometry.getData("active",r)){var n=Rs.worldPos;this.geometry.getVector3("position",r,n),this.worldSpace||n.add(this.entity.transform.worldPosition),t(r,n),--e}}},Particles.prototype.initEmitter=function(){this._newParticlesCounter=0,this._particleCount=0,this._emitTime=this.duration,this._isEmitting=!0,this.geometry.worldSpace=this.worldSpace},Particles.prototype.onMaterialChanged=function(t){this.entity&&(this.visual.material=t.newAsset)},Particles.prototype.onGroupChanged=function(t){this.entity&&(this.visual.group=t.newAsset)},Cs([Attributes_enumLiterals(js.literals),Ss("design:type",Object)],Particles.prototype,"direction",void 0),Cs([unserializable(),Ss("design:type",Object)],Particles.prototype,"_particleCount",void 0),Cs([unserializable(),Ss("design:type",Object)],Particles.prototype,"_newParticlesCounter",void 0),Cs([unserializable(),Ss("design:type",Object)],Particles.prototype,"_isEmitting",void 0),Cs([unserializable(),Ss("design:type",Object)],Particles.prototype,"_emitTime",void 0),Cs([unserializable(),Ss("design:type",Object)],Particles.prototype,"_emitCenter",void 0),Particles=Cs([helpUrl("https://docs.spiderengine.io/3d/particles.html"),Ss("design:paramtypes",[Object])],Particles)}(kt),Ms=function(){function AnimationSystem(){}return AnimationSystem.update=function(){Aa.ofType(bo).forEach(function(t){t.animations.forEach(function(e){var r=e.animation;if(r){if(!e.isPlaying){if(!e.autoPlay||e.hasPlayedOnce)return;yo.playAnimation(t.entity,e)}e.localTime+=nt.deltaTime*e.speed,yo.applyAnimation(r,t.entity,e.localTime,e.targets),e.localTime<r.duration||(e.loopCount>0?(++e.playCount,e.playCount===e.loopCount?(t.animationFinished.post(r.name),e.isPlaying=!1):e.localTime-=r.duration):e.stopRequested?(t.animationFinished.post(r.name),e.isPlaying=!1):e.localTime-=r.duration)}})})},AnimationSystem}(),ks=r(2),zs=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Fs=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Ds=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Naive=0]="Naive",t[t.Grid=1]="Grid",t[t.SAP=2]="SAP"}(Ts||(Ts={}));var Ns,Ls=function(){function PhysicsBroadPhaseTypeMetadata(){}return PhysicsBroadPhaseTypeMetadata.literals={Naive:0,Grid:1,SAP:2},PhysicsBroadPhaseTypeMetadata}(),Vs=function(){function PhysicsBroadPhaseFactory(){}return PhysicsBroadPhaseFactory.create=function(t){switch(t){case Ts.Grid:return new ks.GridBroadphase;case Ts.SAP:return new ks.SAPBroadphase;default:return new ks.NaiveBroadphase}},PhysicsBroadPhaseFactory}(),Us=function(t){function PhysicsContext(){var e=null!==t&&t.apply(this,arguments)||this;return e._gravity=new H(0,-9.8,0),e._broadPhase=Ts.Naive,e._solverIterations=10,e}return zs(PhysicsContext,t),Object.defineProperty(PhysicsContext.prototype,"broadPhase",{set:function(t){this._broadPhase=t,this._world&&(this._world.broadphase=Vs.create(this._broadPhase))},enumerable:!0,configurable:!0}),Object.defineProperty(PhysicsContext.prototype,"gravity",{set:function(t){this._gravity=t,this._world&&this._world.gravity.set(this._gravity.x,this._gravity.y,this._gravity.z)},enumerable:!0,configurable:!0}),Object.defineProperty(PhysicsContext.prototype,"solverIterations",{set:function(t){this._solverIterations=t,this._world&&(this._world.solver.iterations=this._solverIterations)},enumerable:!0,configurable:!0}),Object.defineProperty(PhysicsContext.prototype,"world",{get:function(){return this._world},set:function(t){this._world=t},enumerable:!0,configurable:!0}),PhysicsContext.prototype.update=function(){this._world||(this._world=new ks.World,this._world.gravity.set(this._gravity.x,this._gravity.y,this._gravity.z),this._world.broadphase=Vs.create(this._broadPhase),this._world.solver.iterations=this._solverIterations,this._world.defaultContactMaterial.contactEquationStiffness=1e9,this._world.defaultContactMaterial.contactEquationRelaxation=4,this.beginContact=this.beginContact.bind(this),this.endContact=this.endContact.bind(this),this._world.addEventListener("beginContact",this.beginContact),this._world.addEventListener("endContact",this.endContact)),this._world.step(1/60,nt.deltaTime,3)},PhysicsContext.prototype.destroy=function(){this._world&&(this._world.removeEventListener("beginContact",this.beginContact),this._world.removeEventListener("endContact",this.endContact))},PhysicsContext.prototype.beginContact=function(t){},PhysicsContext.prototype.endContact=function(t){},Fs([Attributes_enumLiterals(Ls.literals),Ds("design:type",Object)],PhysicsContext.prototype,"_broadPhase",void 0),Fs([unserializable(),Ds("design:type",ks.World)],PhysicsContext.prototype,"_world",void 0),PhysicsContext}(kt),Ws=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),qs=function(t){function PlaneCollisionShape(e){var r=t.call(this)||this;return r.plane=new he,e&&r.setState(e),r}return Ws(PlaneCollisionShape,t),PlaneCollisionShape.prototype.checkCollisions=function(t,e,r,n){},PlaneCollisionShape}(fa),Gs=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Hs=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Xs=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Ks=function(){function PhysicsShapeFactory(){}return PhysicsShapeFactory.create=function(t,e){if(t.isA(Oa)){var r=t,n=new ks.Vec3(r.extent.x*e.x,r.extent.y*e.y,r.extent.z*e.z);return{shape:new ks.Box(n),offset:r.center}}if(t.isA(Pa)){var i=t;return{shape:new ks.Sphere(i.radius*e.x),offset:i.center}}if(t.isA(qs)){var o=t.plane,a=new ks.Plane;return a.worldNormal.set(o.normal.x,o.normal.y,o.normal.z),a.boundingSphereRadius=999999*e.x,{shape:a,offset:(new H).copy(o.normal).multiply(o.distFromOrigin)}}return null},PhysicsShapeFactory}();!function(t){t[t.Static=0]="Static",t[t.Dynamic=1]="Dynamic",t[t.Kinematic=2]="Kinematic"}(Ns||(Ns={}));var Qs,Ys=function(){function RigidBodyTypeMetadata(){}return RigidBodyTypeMetadata.literals={Static:ks.Body.STATIC,Dynamic:ks.Body.DYNAMIC,Kinematic:ks.Body.KINEMATIC},RigidBodyTypeMetadata}();!function(t){t.applyTransformToRigidBody=function applyTransformToRigidBody(t,e,r){var n=t.position,i=n.x,o=n.y,a=n.z;e.set(i,o,a);var s=t.rotation,c=(i=s.x,o=s.y,a=s.z,s.w);r.set(i,o,a,c)},t.applyRigidBodyToTransform=function applyRigidBodyToTransform(t,e,r){var n=t.x,i=t.y,o=t.z;r.position.set(n,i,o),n=e.x,i=e.y,o=e.z;var a=e.w;r.rotation.set(n,i,o,a)}}(Qs||(Qs={}));var Zs,Js=function(t){function RigidBody(){var e=null!==t&&t.apply(this,arguments)||this;return e._mass=1,e._type=Ns.Dynamic,e}return Gs(RigidBody,t),Object.defineProperty(RigidBody.prototype,"mass",{get:function(){return this._mass},set:function(t){t<=0?(t=0,this._type=Ns.Static):this._type===Ns.Static&&(this._type=Ns.Dynamic),this._mass=t,this._rigidBody&&(this._rigidBody.mass=t,this._rigidBody.type=this._type)},enumerable:!0,configurable:!0}),Object.defineProperty(RigidBody.prototype,"body",{get:function(){return this._rigidBody},enumerable:!0,configurable:!0}),Object.defineProperty(RigidBody.prototype,"type",{set:function(t){this._type=t,t===Ns.Static?this._mass=0:this._mass<=0&&(this._mass=1),this._rigidBody&&(this._rigidBody.mass=this._mass,this._rigidBody.type=this._type)},enumerable:!0,configurable:!0}),RigidBody.prototype.update=function(t){if(this._rigidBody)this._type===Ns.Static?Qs.applyTransformToRigidBody(this.entity.transform,this._rigidBody.position,this._rigidBody.quaternion):Qs.applyRigidBodyToTransform(this._rigidBody.position,this._rigidBody.quaternion,this.entity.transform);else{this._rigidBody=new ks.Body,this._rigidBody.mass=this._mass,this._rigidBody.type=this._type,Qs.applyTransformToRigidBody(this.entity.transform,this._rigidBody.position,this._rigidBody.quaternion);var e=this.entity.getComponent(Ba);if(e)for(var r=0,n=e.shapes;r<n.length;r++){var i=n[r];if(i){var o=Ks.create(i,this.entity.transform.scale);if(o){var a=o.offset,s=a.x,c=a.y,u=a.z;this._rigidBody.addShape(o.shape,new ks.Vec3(s,c,u))}}}t.world.addBody(this._rigidBody),this._rigidBody.addEventListener("collide",this.onCollision)}},RigidBody.prototype.destroy=function(){if(this._rigidBody){this._rigidBody.removeEventListener("collide",this.onCollision);var t=this.entity.getAncestorOfType(Us);t&&t.world.remove(this._rigidBody)}},RigidBody.prototype.onCollision=function(t){},Hs([unserializable(),Xs("design:type",ks.Body)],RigidBody.prototype,"_rigidBody",void 0),RigidBody}(kt),$s=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),tc=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},ec=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},rc=function(t){function Button(e){var r=t.call(this)||this;return r._enabled=!0,r._pushed=!1,r._normal=new a(Jn),r._highlighted=new a(Jn),r._pressed=new a(Jn),r._disabled=new a(Jn),e&&r.setState(e),r}return $s(Button,t),Object.defineProperty(Button.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"normal",{get:function(){return this._normal.instance},set:function(t){this._normal.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"highlighted",{get:function(){return this._highlighted.instance},set:function(t){this._highlighted.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"pressed",{get:function(){return this._pressed.instance},set:function(t){this._pressed.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"disabled",{get:function(){return this._disabled.instance},set:function(t){this._disabled.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"pushed",{get:function(){return this._pushed},set:function(t){this._pushed=t},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"enabled",{get:function(){return this._touchInteractions.active},set:function(t){this._enabled=this._touchInteractions.active=t},enumerable:!0,configurable:!0}),Object.defineProperty(Button.prototype,"currentFill",{get:function(){return this.enabled?this.isTouchPressed||this._pushed?this.pressed||this.normal:this.isTouchInside&&this.highlighted||this.normal:this.disabled||this.normal},enumerable:!0,configurable:!0}),Button.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),this._touchInteractions=new Yi({active:this._enabled,controller:this}),Vc.setComponentFromInstance(e,this._touchInteractions)},Button.prototype.destroy=function(){this.entity.clearComponent(Yi),t.prototype.destroy.call(this)},Button.prototype.isLoaded=function(){return!(this.normal&&!this.normal.isLoaded())&&(!(this.highlighted&&!this.highlighted.isLoaded())&&(!(this.pressed&&!this.pressed.isLoaded())&&!(this.disabled&&!this.disabled.isLoaded())))},Button.prototype.getVertexBuffer=function(){return hi.getVertexBuffer(this.entity.getComponent(Sn),this.currentFill)},Button.prototype.upgrade=function(t,e){return 1===e?(Object.assign(t.properties,{_normal:t.properties.normal,_highlighted:t.properties.highlighted,_pressed:t.properties.pressed,_disabled:t.properties.disabled}),delete t.properties.normal,delete t.properties.highlighted,delete t.properties.pressed,delete t.properties.disabled):2===e&&(Object.assign(t.properties,{_enabled:t.properties.enabled}),delete t.properties.enabled),t},tc([unserializable(),ec("design:type",Yi)],Button.prototype,"_touchInteractions",void 0),Button=tc([displayName("Button"),helpUrl("https://docs.spiderengine.io/2d/button.html"),ec("design:paramtypes",[Object])],Button)}(_i);!function(t){t.swipeThreshold=20,t.keyEvent={pressed:!1,keyCode:0},t.touchEvent={pressed:!1,x:0,y:0,swipe:!1,swipeVelocity:new it,button:0},t.initialTouchPos=new it}(Zs||(Zs={}));var nc,ic=function(){function Input(){}return Object.defineProperty(Input,"touchX",{get:function(){return Zs.touchEvent.x},set:function(t){Zs.touchEvent.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(Input,"touchY",{get:function(){return Zs.touchEvent.y},set:function(t){Zs.touchEvent.y=t},enumerable:!0,configurable:!0}),Input.detachAll=function(){Input.touchPressed.detach(),Input.touchMoved.detach(),Input.touchReleased.detach(),Input.wheelMoved.detach(),Input.keyChanged.detach()},Input.touchPressed=new B.SyncEvent,Input.touchMoved=new B.SyncEvent,Input.touchReleased=new B.SyncEvent,Input.wheelMoved=new B.SyncEvent,Input.keyChanged=new B.SyncEvent,Input}(),oc=function(){function InputInternal(){}return InputInternal.create=function(t){Zs.touchEvent.x=t.x,Zs.touchEvent.y=t.y},Object.defineProperty(InputInternal,"keyChangedInfo",{get:function(){return Zs.keyEvent},enumerable:!0,configurable:!0}),InputInternal.onTouchDown=function(t,e,r){t<0||e<0||(Zs.touchEvent.pressed=!0,Zs.touchEvent.swipe=!1,Zs.touchEvent.x=t,Zs.touchEvent.y=e,Zs.touchEvent.button=r,Zs.initialTouchPos.set(t,e),ic.touchPressed.post(Zs.touchEvent))},InputInternal.onTouchMove=function(t,e,r){t<0||e<0||(Zs.touchEvent.swipe=!1,Zs.touchEvent.x=t,Zs.touchEvent.y=e,Zs.touchEvent.button=r,ic.touchMoved.post(Zs.touchEvent))},InputInternal.onTouchUp=function(t,e,r){if(!(t<0||e<0)){var n=t-Zs.initialTouchPos.x,i=e-Zs.initialTouchPos.y;Zs.touchEvent.pressed=!1,Zs.touchEvent.swipe=Math.max(Math.abs(n),Math.abs(i))>Zs.swipeThreshold,Zs.touchEvent.x=t,Zs.touchEvent.y=e,Zs.touchEvent.swipeVelocity.set(n,i),Zs.touchEvent.button=r,ic.touchReleased.post(Zs.touchEvent)}},InputInternal.onMouseWheel=function(t){ic.wheelMoved.post(t)},InputInternal}(),ac=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),sc=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},cc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},uc=function(t){function Image(e){var r=t.call(this)||this;return r._fill=new a(Jn),e&&r.setState(e),r}return ac(Image,t),Object.defineProperty(Image.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Image.prototype,"fill",{get:function(){return this._fill.instance},set:function(t){this._fill.instance=t},enumerable:!0,configurable:!0}),Image.prototype.isLoaded=function(){return!this._fill.instance||this._fill.instance.isLoaded()},Image.prototype.getVertexBuffer=function(){return hi.getVertexBuffer(this.entity.getComponent(Sn),this._fill.instance)},Image.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_fill:t.properties.fill}),delete t.properties.fill),t},Image=sc([helpUrl("https://docs.spiderengine.io/2d/image.html"),cc("design:paramtypes",[Object])],Image)}(_i),lc=function(){function LayoutUtils(){}return LayoutUtils.getLayoutActualSize=function(t,e,r,n,i,o){var a=0;if(r)a=e-i;else if(n.type===ct.Auto){var s=t.entity.getComponent(uc);if(s&&s.fill)return hi.getFillSize(s.fill,o);var c=t.entity.getComponent(rc);if(c&&c.currentFill)return hi.getFillSize(c.currentFill,o);var u=t.entity.getComponent(to);if(u&&u.currentFill)return hi.getFillSize(u.currentFill,o);var l=t.entity.getComponent(Hi),p=l?l.font:null;if(p)return o?p.getWidth():p.getHeight()}else n.type===ct.Relative?a=e*n.value-i:n.type===ct.Absolute&&(a=n.value);return a},LayoutUtils.updateLayoutWorldMatrix=function(t,e,r){var n=e,i=n.x,o=n.y,a=t.entity.parent?t.entity.parent.getComponent(Sn):void 0,s=t.offset.x,c=t.offset.y;a&&(i=a.actualWidth,o=a.actualHeight,s-=a.pivot.x*i,c-=a.pivot.y*o),t.actualWidth=LayoutUtils.getLayoutActualSize(t,i,t.horizontalAlignment===yn.Stretch,t.width,t.margin.left+t.margin.right,!0),t.actualHeight=LayoutUtils.getLayoutActualSize(t,o,t.verticalAlignment===vn.Stretch,t.height,t.margin.top+t.margin.bottom,!1);var u=t.entity.parent&&!t.entity.parent.hasComponent("Layout"),l=t.horizontalAlignment===yn.Stretch;l?s+=t.margin.left:t.horizontalAlignment===yn.Left?(s+=t.margin.left,u&&(s+=r.x)):t.horizontalAlignment===yn.Right?(s+=i-t.margin.right,u&&(s-=r.x)):t.horizontalAlignment===yn.Center&&(s+=i/2);var p=t.verticalAlignment===vn.Stretch;p?c+=t.margin.top:t.verticalAlignment===vn.Bottom?(c+=o-t.margin.bottom,u&&(c-=r.y)):t.verticalAlignment===vn.Top?(c+=t.margin.top,u&&(c+=r.y)):t.verticalAlignment===vn.Center&&(c+=o/2),t.worldMatrix.setRotation(t.rotation),t.worldMatrix.scaleFromCoords(t.scale.x,t.scale.y,1),t.worldMatrix.translateFromCoords(s+(l?t.pivot.x*t.actualWidth:0),c+(p?t.pivot.y*t.actualHeight:0),0),t.finalTint.copy(t.tint),a&&(t.worldMatrix.multiplyMatrices(a.worldMatrix,t.worldMatrix),t.inheritTint&&t.finalTint.multiplyColor(a.finalTint))},LayoutUtils}(),pc=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),fc=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},hc=function(t){function Resolution(){var e=null!==t&&t.apply(this,arguments)||this;return e.size=new it(800,600),e.adaptiveWidth=!1,e}return pc(Resolution,t),Resolution}(O),dc=function(t){function CustomResolution(){return null!==t&&t.apply(this,arguments)||this}return pc(CustomResolution,t),CustomResolution=fc([displayName("Custom")],CustomResolution)}(hc),yc=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),mc=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},vc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.longPressDuration=.5,t.touchMovedTreshold=3,t.tintColor=new Z,t.invModelView=new st,t._2dPickingAABB=new pt,t.localCoords=new H}(nc||(nc={}));var gc,_c,bc=function(t){function Screen(){var e=null!==t&&t.apply(this,arguments)||this;return e._resolution=new a(hc),e._cache=[],e._cacheIndex=0,e._offset=new it,e._translationX=0,e._translationY=0,e._scale=1,e._pressDuration=-1,e._initialTouchPos=new it,e._screenTransform=new st,e}return yc(Screen,t),Object.defineProperty(Screen.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"cache",{get:function(){return this._cache},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"cacheSize",{get:function(){return this._cacheIndex},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"offset",{get:function(){return this._offset},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"translationX",{get:function(){return this._translationX},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"translationY",{get:function(){return this._translationY},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"scale",{get:function(){return this._scale},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"screenTransform",{get:function(){return this._screenTransform},enumerable:!0,configurable:!0}),Object.defineProperty(Screen.prototype,"resolution",{get:function(){return this._resolution.instance},enumerable:!0,configurable:!0}),Screen.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.clearComponent(Sn),e.getOrSetComponent(Lt),this.onTouchPressed=this.onTouchPressed.bind(this),this.onTouchMoved=this.onTouchMoved.bind(this),this.onTouchReleased=this.onTouchReleased.bind(this),ic.touchPressed.attach(this.onTouchPressed),ic.touchMoved.attach(this.onTouchMoved),ic.touchReleased.attach(this.onTouchReleased)},Screen.prototype.destroy=function(){ic.touchPressed.detach(this.onTouchPressed),ic.touchMoved.detach(this.onTouchMoved),ic.touchReleased.detach(this.onTouchReleased),t.prototype.destroy.call(this)},Screen.prototype.getResolution=function(t){return this.resolution?this.resolution.size:t},Screen.prototype.updateTransforms=function(){var t=this,e=xt.renderer.screenSize;this._scale=1,this._translationX=0,this._translationY=0,this._screenTransform.copy(this.entity.transform.worldMatrix);var r=this.resolution;if(r){var n=r.size.x/r.size.y;if(r.adaptiveWidth){var i=e.y*n;this._translationX=(e.x-i)/2,this._scale=e.y/r.size.y}else{var o=e.x/n;this._translationY=(e.y-o)/2,this._scale=e.x/r.size.x}this._screenTransform.data[12]*=this._scale,this._screenTransform.data[13]*=this._scale}this._screenTransform.scaleFromCoords(this._scale,this._scale,1),this._screenTransform.translateFromCoords(this._translationX,this._translationY,0),this._offset.x=Math.max(-this._translationX,0),this._offset.y=Math.max(-this._translationY,0),this._offset.x=this._offset.x/this._scale,this._offset.y=this._offset.y/this._scale,this.entity.traverse(function(r){var n=r.getComponent(Sn);return n&&lc.updateLayoutWorldMatrix(n,t.getResolution(e),t.offset),!0})},Screen.prototype.update=function(){var t=this._pressDuration>=0,e=this._pressedElement;e&&t&&(this._pressDuration+=nt.deltaTime,this._pressDuration>nc.longPressDuration&&(this.onEvent(e.entity,function(t,r){return t._target.value.entity=e.entity,t.sendSignal(t._longPress.name),t._stopPropagation.getData()}),this._pressDuration=-1))},Screen.prototype.render=function(t){var e=this,r=nc.tintColor;this._cacheIndex=0,this.entity.traverse(function(t){return e.addToCache(t)});for(var n=st.fromPool(),i=gt.context,o=0;o<this._cacheIndex;++o){var a=this._cache[o].element,s=a.worldMatrix;s.data[12]=s.data[12],s.data[13]=s.data[13],s.data[14]=s.data[14],n.multiplyMatrices(this._screenTransform,s),t.queueParameter("modelViewMatrix",n);var c=a.entity.getComponent(uc);if(c)c.active&&c.fill&&hi.renderFill(c.fill,t,n,c.getVertexBuffer(),i,a.finalTint);else{var u=a.entity.getComponent(rc);if(u){var l=u.currentFill;u.active&&l&&hi.renderFill(l,t,n,u.getVertexBuffer(),i,a.finalTint)}else{var p=a.entity.getComponent(to);if(p){var f=p.currentFill;p.active&&f&&hi.renderFill(f,t,n,p.getVertexBuffer(),i,a.finalTint.multiplyColor(p.currentColor))}else{var h=a.entity.getComponent(Hi);if(h){var d=h.font;if(h.active&&d){var y=0;a.width.type!==ct.Auto&&(y=a.actualWidth),d.prepareForRendering(this.scale,y),t.queueReferenceParameter(hi.uiShaderTextureParam,d.getTexture()),t.queueParameter(hi.uiShaderColorParam,r.copy(h.color).multiplyColor(a.finalTint)),t.begin()&&oi.drawVertexBuffer(i,h.getVertexBuffer(),t.shader)}}else;}}}}},Screen.prototype.upgrade=function(t,e){return 1===e&&(t.properties.useResolution&&Object.assign(t.properties,{_resolution:{baseTypeName:"Resolution",data:{typeName:"CustomResolution",version:1,properties:{size:JSON.parse(JSON.stringify(t.properties.resolution)),adaptiveWidth:t.properties.matchHeight}}}}),delete t.properties.resolution,delete t.properties.useResolution,delete t.properties.matchHeight),t},Screen.prototype.addToCache=function(t){if(!t.active)return!1;if(this._cacheIndex>=this._cache.length){var e=Math.max(32,2*this._cache.length);this._cache.length=e;for(var r=this._cacheIndex;r<e;++r)this._cache[r]={drawOrder:999999,element:nc.dummyLayout}}var n=t.getComponent(Sn);if(n){var i=this._cache[this._cacheIndex];i.element=n,i.drawOrder=this._cacheIndex,this._cacheIndex++}return!0},Screen.prototype.onTouchPressed=function(t){var e=this;this._initialTouchPos.set(t.x,t.y),this.onTouchChanged(t);var r=this._pressedElement;r&&this.onEvent(r.entity,function(n,i){return n._target.value.entity=r.entity,n._touchPos.getData().set(t.x/e._scale-e._translationX,t.y/e._scale-e._translationY),n.sendSignal(n._touchDown.name),n._stopPropagation.getData()})},Screen.prototype.onTouchMoved=function(t){var e=this,r=this.onTouchChanged(t);if(this._pressDuration>=0){var n=t.x-this._initialTouchPos.x,i=t.y-this._initialTouchPos.y;Math.max(Math.abs(n),Math.abs(i))>nc.touchMovedTreshold&&(this._pressDuration=-1)}var o=this._pressedElement||r;o&&this.onEvent(o.entity,function(r,n){return r._target.value.entity=o.entity,r._touchPos.getData().set(t.x/e._scale-e._translationX,t.y/e._scale-e._translationY),r.sendSignal(r._touchMove.name),r._stopPropagation.getData()})},Screen.prototype.onTouchReleased=function(t){var e=this;this.onTouchChanged(t);var r=this._pressedElement;if(r){var n=r.entity;this.onEvent(n,function(r,i){return r._target.value.entity=n,r._touchPos.getData().set(t.x/e._scale-e._translationX,t.y/e._scale-e._translationY),r.sendSignal(r._touchUp.name),r._stopPropagation.getData()})}if(t.swipe&&delete this._pressedElement,r=this._pressedElement){if(r.isTouchInside){var i=r.entity;this.onEvent(i,function(r,n){return r._target.value.entity=i,r._touchPos.getData().set(t.x/e._scale-e._translationX,t.y/e._scale-e._translationY),r.sendSignal(r._click.name),r._stopPropagation.getData()})}delete this._pressedElement}},Screen.prototype.onTouchChanged=function(t){for(var e=nc._2dPickingAABB,r=nc.invModelView,n=nc.localCoords,i=!0,o=null,a=this._cacheIndex-1;a>=0;--a){var s=this._cache[a].element,c=s.entity,u=c.getComponent(Yi);if(u&&u.active){var l=c.getComponent(rc)||c.getComponent(uc)||c.getComponent(Hi)||c.getComponent(to);if(l){var p=s.actualWidth,f=s.actualHeight;e.min.set(-s.pivot.x*p,-s.pivot.y*f,-999999),e.max.set(p-s.pivot.x*p,f-s.pivot.y*f,999999),r.multiplyMatrices(this._screenTransform,s.worldMatrix).invert(),n.set(t.x,t.y,0).transform(r),e.contains(n)?(l.isTouchInside?i||l.setTouchInside(!1):i&&(l.setTouchInside(!0),o=l),i=!1):l.isTouchInside&&(l.setTouchInside(!1),o=null),!0===t.pressed?l.isTouchInside&&!l.isTouchPressed&&(l.setTouchPressed(!0),this._pressedElement=l,this._pressDuration=0):!1===t.pressed&&l.isTouchPressed&&l.setTouchPressed(!1)}}}return o},Screen.prototype.onEvent=function(t,e){for(Vc.collectEntityOperations=!0;t;){var r=t.getComponent(mn);if(r)if(r.onUIEvent(function(r){return e(r,t)}))break;if(t===this.entity)break;t=t.parent}Vc.collectEntityOperations=!1},mc([displayName("Scaling"),vc("design:type",Object)],Screen.prototype,"_resolution",void 0),mc([unserializable(),Attributes_hidden(),vc("design:type",Array)],Screen.prototype,"_cache",void 0),mc([unserializable(),Attributes_hidden(),vc("design:type",Object)],Screen.prototype,"_cacheIndex",void 0),mc([unserializable(),vc("design:type",Object)],Screen.prototype,"_offset",void 0),mc([unserializable(),vc("design:type",Object)],Screen.prototype,"_translationX",void 0),mc([unserializable(),vc("design:type",Object)],Screen.prototype,"_translationY",void 0),mc([unserializable(),vc("design:type",Object)],Screen.prototype,"_scale",void 0),mc([unserializable(),vc("design:type",_i)],Screen.prototype,"_pressedElement",void 0),mc([unserializable(),vc("design:type",Object)],Screen.prototype,"_pressDuration",void 0),mc([unserializable(),vc("design:type",Object)],Screen.prototype,"_initialTouchPos",void 0),mc([unserializable(),vc("design:type",Object)],Screen.prototype,"_screenTransform",void 0),Screen=mc([helpUrl("https://docs.spiderengine.io/2d/screen.html")],Screen)}(kt),wc=function(){return function CollisionInfo(){}}();!function(t){t.collisions=new G(wc,64),t.checkCollision=function checkCollision(e,r){for(var n=function(n){if(!n)return"continue";for(var i=function(i){if(!i)return"continue";n.getTestPriority()>i.getTestPriority()?n.checkCollisions(i,e.entity.transform,r.entity.transform,function(o){var a=t.collisions.get();a.self=e,a.collider=r,a.myShape=n,a.otherShape=i,a.particleIndex=o}):i.checkCollisions(n,r.entity.transform,e.entity.transform,function(o){var a=t.collisions.get();a.self=e,a.collider=r,a.myShape=n,a.otherShape=i,a.particleIndex=o})},o=0,a=r.shapes;o<a.length;o++)i(a[o])},i=0,o=e.shapes;i<o.length;i++)n(o[i])}}(gc||(gc={})),function(t){t.clearCollisions=function clearCollisions(){gc.collisions.flush()}}(_c||(_c={}));var Pc,xc,Oc=function(){function CollisionSystem(){}return CollisionSystem.update=function(){var t,e;gc.collisions.flush();for(var r={},n=Aa.ofType(Ba),i=0,o=n;i<o.length;i++)for(var a=o[i],s=0,c=n;s<c.length;s++){var u=c[s];if(a!==u){var l=r[a.id];if(!(l&&u.id in l)){gc.checkCollision(a,u),l?l[u.id]=!0:r[a.id]=((t={})[u.id]=!0,t);var p=r[u.id];p?p[a.id]=!0:r[u.id]=((e={})[a.id]=!0,e)}}}for(var f=0;f<gc.collisions.size;++f){var h=gc.collisions.peek(f);h.self.collision.post(h);var d=h.self.entity.getComponent(mn);d&&d.onCollision(h);var y={self:h.collider,collider:h.self,myShape:h.otherShape,otherShape:h.myShape,particleIndex:h.particleIndex};h.collider.collision.post(y);var m=h.collider.entity.getComponent(mn);m&&m.onCollision(y)}},CollisionSystem}();(Pc||(Pc={})).updateHook=new B.VoidSyncEvent,function(t){(xc||(xc={})).update=function update(){Io.scanGamepads(),Aa.ofType(Us).forEach(function(t){t.update(),t.entity.getComponents(Js).forEach(function(e){return e.update(t)})}),Vc.collectEntityOperations=!0,Aa.ofType(mn).forEach(function(t){return t.update()});try{Pc.updateHook.post()}catch(t){console.error("Runtime Error"),console.error(t.toString()),Pc.updateHook.detach()}Vc.collectEntityOperations=!1;for(var t=0,e=Vc.entitiesJustDestroyed;t<e.length;t++){var r=e[t];Vc.destroyEntity(r)}Vc.entitiesJustDestroyed.length=0;for(var n=0,i=Vc.entitiesJustCreated;n<i.length;n++){var o=(r=i[n]).getComponent(mn);o&&o.active&&o.update()}Vc.entitiesJustCreated.length=0,Ms.update(),Aa.ofType(Is).forEach(function(t){return t.update()}),Aa.ofType(bc).forEach(function(t){return t.update()}),Aa.ofType(es).forEach(function(t){return t.update()}),Oc.update(),Y.incrementCurrentFrame()}}();var Cc,Sc=function(){function Update(){}return Object.defineProperty(Update,"hook",{get:function(){return Pc.updateHook},enumerable:!0,configurable:!0}),Update}();(Cc||(Cc={})).transientState={};var Rc,jc,Tc=function(){function BehaviorAPI(){}return BehaviorAPI.api={Math:{PI:function(){return Math.PI},sin:function(t){return Math.sin(t)},cos:function(t){return Math.cos(t)},tan:function(t){return Math.tan(t)},sqrt:function(t){return Math.sqrt(t)},min:function(t,e){return Math.min(t,e)},max:function(t,e){return Math.max(t,e)},random:function(){return Math.random()},abs:function(t){return Math.abs(t)},sign:function(t){return Math.sign(t)},floor:function(t){return Math.floor(t)},ceil:function(t){return Math.ceil(t)},round:function(t){return Math.round(t)},acos:function(t){return Math.acos(t)},atan:function(t){return Math.atan(t)},atan2:function(t,e){return Math.atan2(t,e)},pow:function(t,e){return Math.pow(t,e)}},MathEx:{toRadians:function(t){return K.toRadians(t)},toDegrees:function(t){return K.toDegrees(t)},clamp:function(t,e,r){return K.clamp(t,e,r)},degreesToRadians:function(){return K.degreesToRadians},radiansToDegrees:function(){return K.radiansToDegrees},lerp:function(t,e,r){return K.lerp(t,e,r)}},console:{log:function(t){return V.log("string"==typeof t?t:JSON.stringify(t))},assert:function(t,e){return console.assert(t,e)},clear:function(){return console.clear()},logVector3:function(t){return V.logVector3(t)}},location:{reload:function(){return location.reload()}},window:{open:function(t){return window.open(t)}},JSON:{stringify:function(t){return JSON.stringify(t,null,2)},parse:function(t){return JSON.parse(t)}},Random:{range:function(t,e){return Gt.range(t,e)},rangeInt:function(t,e){return Gt.rangeInt(t,e)}},Scenes:{load:function(t,e){return lu.load(t,e)}},Assets:{load:function(t){return ua.load(t)},loadById:function(t){return ua.loadById(t)}},Renderer:{screenSize:function(){return xt.renderer.screenSize}},Entities:{create:function(t){return Ut.create(t)},find:function(t){return Ut.find(t)}},GamePads:{forEach:function(t){return zo.forEach(t)}},Time:{deltaTime:function(){return nt.deltaTime},smoothDeltaTime:function(){return nt.smoothDeltaTime},fps:function(){return nt.fps},currentFrame:function(){return nt.currentFrame},time:function(){return nt.time}},Project:{name:function(){return Bo.projectName},isOpenSource:function(){return Bo.isOpenSource},importToEditor:function(){return Bo.importToEditor()}},SavedData:{get:function(){return Mo.get()},flush:function(){return Mo.flush()}},Update:{hook:function(){return Sc.hook}},Game:{state:function(){return Cc.transientState}},ExecutionStatus:{Continue:function(){return or.Continue},Finish:function(){return or.Finish}},Vector3:{up:function(){return H.fromPool().copy(H.up)},right:function(){return H.fromPool().copy(H.right)},forward:function(){return H.fromPool().copy(H.forward)},zero:function(){return H.fromPool().copy(H.zero)},distance:function(t,e){return H.distance(t,e)},distanceSq:function(t,e){return H.distanceSq(t,e)},fromPool:function(){return H.fromPool()}},Plane:{fromPool:function(){return he.fromPool()}},Basis:{fromMatrix:function(t){return Ae.fromMatrix(t)}},Matrix44:{identity:function(){return st.fromPool().copy(st.identity)},fromPool:function(){return st.fromPool()}},Quaternion:{identity:function(){return ut.fromPool().copy(ut.identity)},fromPool:function(){return ut.fromPool()},fromEulerAngles:function(t,e,r,n){return ut.fromEulerAngles(t,e,r,n)},fromAxisAngle:function(t,e){return ut.fromAxisAngle(t,e)}},Color:{white:function(){return Z.dummy.copy(Z.white)},black:function(){return Z.dummy.copy(Z.black)}},Object:{keys:function(t){return Object.keys(t)},values:function(t){return Object.values(t)},entries:function(t){return Object.entries(t)},assign:function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return Object.assign(t,e)}},Promise:{all:function(t){return Promise.all(t)}},HorizontalAlignment:{left:function(){return 0},center:function(){return 1},right:function(){return 2},stretch:function(){return 3}},VerticalAlignment:{top:function(){return 0},center:function(){return 1},bottom:function(){return 2},stretch:function(){return 3}},Array:{isArray:function(t){return Array.isArray(t)},from:function(t){return Array.from(t)}},Physics:{rayCast:function(t,e,r){return Na.rayCast(t,e,r)}},Collision:{rayCastOnSphere:function(t,e,r){return t.castOnSphere(e,r)}},EngineHud:{setControls:function(t){return jo.setControls(t)}},Config:{isWeb:function(){return La.isWeb()},isDesktop:function(){return La.isDesktop()},isProduction:function(){return La.isProduction()},isDevelopment:function(){return La.isDevelopment()},isEditor:function(){return La.isEditor()},isStandalone:function(){return La.isStandalone()}}},BehaviorAPI}(),Ec=function(){return(Ec=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},Bc=function(){function BehaviorUtils(){}return BehaviorUtils.pinsHaveSameType=function(t,e){if(t.constructor.name===e.constructor.name){if(t.isA(tr)){var r=t.componentType,n=e.componentType;return r===n||"Component"===r||"Component"===n}return t.isA(ir)?t.assetType===e.assetType:t.isA(nr)?t.dataType===e.dataType&&t.declarationId===e.declarationId:!t.isA(rr)||t.declarationId===e.declarationId}return!1},BehaviorUtils.isPinLoaded=function(t){if(t.isA(Je)){var e=t.value;if(!S.isAssetRefLoaded(e))return!1}else if(t.isA(ir)){var r=t.value;if(!S.isAssetRefLoaded(r))return!1}else if(t.isA(nr))for(var n=0,i=t.value.data;n<i.length;n++){var o=i[n];if(!BehaviorUtils.isPinLoaded(o))return!1}else if(t.isA(rr)){r=t.value;if(!S.isAssetRefLoaded(r))return!1}return!0},BehaviorUtils.buildPins=function(t,e){for(var r=new Tt(we),n=function(e){var n=e.instance;if(n){var i=void 0;if(t.getPins()){var o=t.getPins().data.find(function(t){return t.instance.id===n.id}),a=o?o.instance:void 0;a&&a.type===n.type&&BehaviorUtils.pinsHaveSameType(a,n)&&((i=a).name=n.name)}i?r.grow(i):r.grow(n.copy())}},i=0,o=e.pins.data;i<o.length;i++){n(o[i])}t.setPins(r)},BehaviorUtils.updatePinAccessors=function(t){for(var e=function(e){var r=e.instance.name;Object.defineProperty(t,r,{get:function(){return t.findPinByName(r)[We.runtimeValueAccessor]},set:function(e){t.findPinByName(r)[We.runtimeValueAccessor]=e},configurable:!0})},r=0,n=t.getPins().data.filter(function(t){return t.instance.isA(xe)});r<n.length;r++){e(n[r])}},BehaviorUtils.initializeCodeBlockInstanceState=function(t,e,r,n){for(var i,o,a={this:(i={},i[We.runtimeValueAccessor]=e,i),transform:(o={},o[We.runtimeValueAccessor]=e.transform,o)},s=0,c=r.data.filter(function(t){return void 0!==t.instance&&t.instance.isA(xe)}).map(function(t){return t.instance});s<c.length;s++){var u=c[s];a[u.name]=u}var l="initState_"+wr.trimId(t.id);return l in window&&window[l](a,Tc.api,sr.createObject,n),a},BehaviorUtils.getVariables=function(t){return t.pins.data.map(function(t){return t.instance}).filter(function(t){return void 0!==t}).reduce(function(t,e){var r;return Ec({},t,((r={})[e.name]=e.constructor.name,r))},{this:"Entity",transform:"Transform"})},BehaviorUtils}(),Ac=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ic=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Mc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},kc=function(t){function ObjectDefinition(){var e=t.call(this)||this;return e._pins=new Tt(we),e._declaration=new re(Re),e.onDeclarationPinChanged=e.onDeclarationPinChanged.bind(e),e.onDeclarationChanged=e.onDeclarationChanged.bind(e),e._declaration.assetChanged.attach(e.onDeclarationChanged),e}return Ac(ObjectDefinition,t),Object.defineProperty(ObjectDefinition.prototype,"declaration",{get:function(){return this._declaration.asset},set:function(t){this._declaration.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(ObjectDefinition.prototype,"declarationId",{get:function(){return this._declaration.id},enumerable:!0,configurable:!0}),Object.defineProperty(ObjectDefinition.prototype,"pins",{get:function(){return this._pins},enumerable:!0,configurable:!0}),ObjectDefinition.prototype.isLoaded=function(){for(var t=0,e=this._pins.data;t<e.length;t++){var r=e[t];if(!Bc.isPinLoaded(r.instance))return!1}return!0},ObjectDefinition.prototype.destroy=function(){this.declaration&&this.declaration.pinChanged.detach(this.onDeclarationPinChanged),this._declaration.detach(),t.prototype.destroy.call(this)},ObjectDefinition.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r),"_pins"===e&&Bc.updatePinAccessors(this)},ObjectDefinition.prototype.getPins=function(){return this._pins},ObjectDefinition.prototype.setPins=function(t){this._pins=t},ObjectDefinition.prototype.findPinByName=function(t){return this._pins.data.map(function(t){return t.instance}).find(function(e){return e.name===t})},ObjectDefinition.prototype.onDeclarationPinChanged=function(t){this.declaration&&(Bc.buildPins(this,this.declaration),Bc.updatePinAccessors(this))},ObjectDefinition.prototype.onDeclarationChanged=function(t){var e=t.oldAsset;e&&e.pinChanged.detach(this.onDeclarationPinChanged);var r=t.newAsset;r&&(Bc.buildPins(this,r),r.pinChanged.attach(this.onDeclarationPinChanged))},ObjectDefinition=Ic([displayName("Object Definition"),creatable(!1),Mc("design:paramtypes",[])],ObjectDefinition)}(F),zc=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Fc=function(t){function ObjectReference(e){var r=t.call(this,kc)||this;return r._declarationId=e,r}return zc(ObjectReference,t),Object.defineProperty(ObjectReference.prototype,"declarationId",{get:function(){return this._declarationId},set:function(t){this._declarationId=t},enumerable:!0,configurable:!0}),ObjectReference}(re),Dc=function(){return(Dc=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};!function(t){t.serializeNonPersistentObjects=void 0,t.nonPersistentObjectCache=null,t.mockInstanceCache={}}(Rc||(Rc={})),function(t){t.serializeIdsAsPaths=!1}(jc||(jc={}));var Nc,Lc=function(){function SerializerUtils(){}return SerializerUtils.serializeEntity=function(t,e){SerializerUtils.serializeNonPersistentObjects(e);var r=t.children.map(function(t){return SerializerUtils.serializeEntity(t,e)}),n=[];t.iterateComponents(function(t){t.controller||n.push(t)});var i=SerializerUtils.serializeComponents(n);return SerializerUtils.serializeNonPersistentObjects(!1),{id:t.id,name:t.name,active:t.active,prefabId:t.prefabId,components:n.length>0?i:void 0,children:r.length>0?r:void 0}},SerializerUtils.deserializeEntity=function(t,e,r){if(t.name=e.name,t.id=e.id,t.initializeActive(e.active),t.prefabId=e.prefabId,e.components){if(Array.isArray(e.components)){for(var n={},i=0,o=e.components;i<o.length;i++){var a=o[i],s=a.typeName;delete a.typeName,n[s]=a}e.components=n}for(var c=0,u=Object.keys(e.components);c<u.length;c++){s=u[c];var l=e.components[s],p=x.instance.createObject(s);SerializerUtils.deserializeObject(p,l),Vc.setComponentFromInstance(t,p)}}if(e.children)for(var f=0,h=e.children;f<h.length;f++){var d=h[f],y=new Xc;t.addChild(y),SerializerUtils.deserializeEntity(y,d,r)}},SerializerUtils.serializeEntityWithPrefabRefs=function(t){if(t.prefabId)return{id:t.id,name:t.name,active:t.active,prefabId:t.prefabId};var e=t.children.map(function(t){return SerializerUtils.serializeEntityWithPrefabRefs(t)}),r=[];t.iterateComponents(function(t){t.controller||r.push(t)});var n=SerializerUtils.serializeComponents(r);return{id:t.id,name:t.name,active:t.active,components:r.length>0?n:void 0,children:e.length>0?e:void 0}},SerializerUtils.serializeObject=function(t){var e={typeName:t.constructor.name,version:SerializerUtils.getObjectVersion(t),properties:{}};return SerializerUtils.serializeProperties(t,e),e},SerializerUtils.deserializeObject=function(t,e){var r=e,n=e.version||1,i=SerializerUtils.getObjectVersion(t);if(n<i)for(var o=n;o<i;++o)(r=t.upgrade(e,o)).version=o+1;for(var a=0,s=Object.keys(r.properties);a<s.length;a++){var c=s[a];if(SerializerUtils.isPropertySerializable(t.constructor.name,c)){var u,l=r.properties[c];if(SerializerUtils.isDynamicProperty(t.constructor.name,c))(u=l.typeName)&&SerializerUtils.deserializeProperty(t,c,u,l.data);else(u=SerializerUtils.getPropertyTypeName(t[c]))&&SerializerUtils.deserializeProperty(t,c,u,l)}}},SerializerUtils.serializeNonPersistentObjects=function(t){Rc.serializeNonPersistentObjects=t},SerializerUtils.clearNonPersistentObjectCache=function(){Rc.nonPersistentObjectCache=null},SerializerUtils.serializeProperty=function(t,e){var r=e||SerializerUtils.getPropertyTypeName(t);if(["AssetReference","ObjectReference"].indexOf(r)>=0){var n=t,i=n.id;n.asset&&!n.asset.isPersistent&&(Rc.serializeNonPersistentObjects?(Rc.nonPersistentObjectCache||(Rc.nonPersistentObjectCache={}),Rc.nonPersistentObjectCache[n.asset.id]=n.asset):i=void 0);var o={typeName:n.typeName(),id:i};return"ObjectReference"===r&&Object.assign(o,{declarationId:t.declarationId}),o}if("Entity"===r)return SerializerUtils.serializeEntity(t);if(_.isObjectOfType(r,"SerializableObject"))return t.serialize();var a=ye.properties;return r in a?a[r].writeProperty(t):(V.logWarning("Cannot serialize property of type '"+r+"'"),"__serializeFailed__")},SerializerUtils.deserializeProperty=function(t,e,r,n,i){if(void 0===i&&(i=!1),["AssetReference","ObjectReference"].indexOf(r)>=0){var o=n,a=o.id,s=t[e];if("AssetReference"===r)s||(s=x.instance.createAssetReference(o.typeName),t[e]=s);else{var c=n;s?s.declarationId=c.declarationId:(s=new Fc(c.declarationId),t[e]=s)}if(s.id=a,a)if(Rc.nonPersistentObjectCache&&a in Rc.nonPersistentObjectCache)s.asset=Rc.nonPersistentObjectCache[a],SerializerUtils.setProperty(t,e,s,i);else{Do.loadObject(a,function(r,n){var o=r,a=t[e];a.asset=o,SerializerUtils.setProperty(t,e,a,i),!1===n&&gr.assetLoaded.post(o)},function(){var r=t[e];r.setAssetFast(null),r.state=Qt.Resolved,SerializerUtils.setProperty(t,e,r,i);var n=t.templatePath;n=n?"in '"+n+"'":"in '"+t.constructor.name+"'",V.logError("Missing asset still referenced '"+e+"', id: '"+a+"' "+(n||""))},!1)}else s.asset=null,SerializerUtils.setProperty(t,e,s,i)}else if("Entity"===r){var u=new Xc;SerializerUtils.deserializeEntity(u,n,!0),SerializerUtils.setProperty(t,e,u,i)}else if(_.isObjectOfType(r,"SerializableObject")){(u=x.instance.createObject(r))&&(u.deserialize(n),SerializerUtils.setProperty(t,e,u,i))}else{if("Number"===r)if(Reflect.getMetadata("enumLiterals",t,e))return void("object"==typeof n?SerializerUtils.setProperty(t,e,n.value,i):SerializerUtils.setProperty(t,e,n,i));var l=ye.properties,p=r in l?l[r].readProperty(n,t,e):n;void 0!==p&&SerializerUtils.setProperty(t,e,p,i)}},SerializerUtils.getPropertyTypeName=function(t){var e=typeof t;return"object"===e?t.constructor.name:e=e[0].toUpperCase()+e.substring(1)},SerializerUtils.copyProperty=function(t,e,r){var n=SerializerUtils.getSerializablePropertyTypeName(t,r);if(null===n)return!1;var i=SerializerUtils.serializeProperty(t[r],n);return SerializerUtils.deserializeProperty(e,r,n,i),!0},SerializerUtils.getSerializablePropertyTypeName=function(t,e){var r=t[e];return"function"==typeof r?null:Reflect.getMetadata("unserializable",t,e)?null:SerializerUtils.getPropertyTypeName(r)},SerializerUtils.setProperty=function(t,e,r,n){void 0===n&&(n=!1);var i=function(){Array.isArray(t)?t[e]=r:t.setProperty(e,r)};if(n)if("string"==typeof e&&e.startsWith("_")){var o=e.slice(1),a=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(t),o);a&&a.set?"Reference"===r.constructor.name?a.set.call(t,r.getInstance()):"AssetReference"===r.constructor.name?a.set.call(t,r.asset):a.set.call(t,r):i()}else i();else i()},SerializerUtils.isDynamicProperty=function(t,e){var r=Rc.mockInstanceCache[t];return r||(r=x.instance.createObject(t),Rc.mockInstanceCache[t]=r),!(e in r)},SerializerUtils.isPropertySerializable=function(t,e){var r=Rc.mockInstanceCache[t];return r||(r=x.instance.createObject(t),Rc.mockInstanceCache[t]=r),!Reflect.getMetadata("unserializable",r,e)},SerializerUtils.getObjectVersion=function(t){return t.version||1},SerializerUtils.serializeProperties=function(t,e){for(var r=0,n=Object.keys(t);r<n.length;r++){var i=n[r];if(!Reflect.getMetadata("unserializable",t,i)){var o=t[i];if("function"!=typeof o&&null!=o){var a=SerializerUtils.getPropertyTypeName(o),s=SerializerUtils.serializeProperty(o,a);"__serializeFailed__"!==s&&(SerializerUtils.isDynamicProperty(t.constructor.name,i)?e.properties[i]={typeName:a,data:s}:e.properties[i]=s)}}}},SerializerUtils.serializeComponent=function(t){var e={version:SerializerUtils.getObjectVersion(t),properties:{}};return SerializerUtils.serializeProperties(t,e),e},SerializerUtils.serializeComponents=function(t){return t.reduce(function(t,e){var r;return Dc({},t,((r={})[e.constructor.name]=SerializerUtils.serializeComponent(e),r))},{})},SerializerUtils}();Nc||(Nc={});var Vc,Uc=function(){function IEntityUtilsInternal(){}return Object.defineProperty(IEntityUtilsInternal,"instance",{get:function(){return Nc.instance},set:function(t){Nc.instance=t},enumerable:!0,configurable:!0}),IEntityUtilsInternal}(),Wc=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),qc=void 0;(function(t){function clearComponent(t,e){var r=t._components[e];return!!r&&(r.destroy(),delete t._components[e],!0)}function setComponentFromInstance(t,e){clearComponent(t,e.constructor.name),t._components[e.constructor.name]=e,e.setEntity(t)}t.entitiesJustDestroyed=[],t.entitiesJustCreated=[],t.collectEntityOperations=!1,t.destroyEntity=function destroyEntity(t){for(var e=0,r=Object.keys(t._components).map(function(e){return t._components[e]}).filter(function(t){return!t.controller});e<r.length;e++)r[e].destroy();for(var n=0,i=t.children.slice();n<i.length;n++)i[n].destroy();t._components={},t.children=[]},t.setComponentFromInstance=setComponentFromInstance,t.setComponentByName=function setComponentByName(t,e,r){var n=x.instance.createObject(e,r);return setComponentFromInstance(t,n),qc&&qc.componentAddedOrRemovedByRuntime.post(t),n},t.getComponentByName=function getComponentByName(t,e){return t._components[e]||null},t.clearComponentByName=function clearComponentByName(t,e){clearComponent(t,e)&&qc&&qc.componentAddedOrRemovedByRuntime.post(t)}})(Vc||(Vc={}));var Gc,Hc,Xc=function(t){function Entity(){var e=null!==t&&t.apply(this,arguments)||this;return e.children=[],e._components={},e._tags={},e._active=!0,e}return Wc(Entity,t),Object.defineProperty(Entity.prototype,"transform",{get:function(){return this.getComponent(Lt)},enumerable:!0,configurable:!0}),Object.defineProperty(Entity.prototype,"active",{get:function(){return this._active},set:function(t){this._active=t,qc&&qc.entityActivated.post(this)},enumerable:!0,configurable:!0}),Entity.prototype.isLoaded=function(){var t=!0;return this.traverse(function(e){for(var r=0,n=Object.values(e._components);r<n.length;r++){if(!n[r].isLoaded())return t=!1,!1}return!0},!0),t},Entity.prototype.setComponent=function(t,e){var r=new t(e);return Vc.setComponentFromInstance(this,r),this},Entity.prototype.setComponentByName=function(t,e){return Vc.setComponentByName(this,t,e),this},Entity.prototype.getComponent=function(t){return Vc.getComponentByName(this,t.name)},Entity.prototype.getComponentByName=function(t){return Vc.getComponentByName(this,t)},Entity.prototype.clearComponent=function(t){return Vc.clearComponentByName(this,t.name),this},Entity.prototype.updateComponent=function(t,e){return this.updateComponentByName(t.name,e)},Entity.prototype.updateComponentByName=function(t,e){var r=this.getComponentByName(t);return r&&r.setState(e),this},Entity.prototype.getOrSetComponent=function(t){return this.getOrSetComponentByName(t.name)},Entity.prototype.getOrSetComponentByName=function(t){return Vc.getComponentByName(this,t)||Vc.setComponentByName(this,t)},Entity.prototype.getComponents=function(t){var e=[];return this.getComponentsInChildren(t.name,e),e},Entity.prototype.addChild=function(t,e){void 0===e&&(e=!1);var r=t.parent;return r&&(e?Uc.instance.preserveWorldPosition(t,this):Uc.instance.dirtifyWorldMatrixIfNecessary(t),r.removeChild(t)),t.parent=this,this.children.push(t),e||Uc.instance.updateLayoutMatrixIfNecessary(t),qc&&qc.entityHierarchyChanged.post(),this},Entity.prototype.insertChild=function(t,e,r){void 0===r&&(r=!1);var n=t.parent;return n&&(r?Uc.instance.preserveWorldPosition(t,this):Uc.instance.dirtifyWorldMatrixIfNecessary(t),n.removeChild(t)),t.parent=this,this.children.splice(e,0,t),r||Uc.instance.updateLayoutMatrixIfNecessary(t),qc&&qc.entityHierarchyChanged.post(),this},Entity.prototype.removeChild=function(t){delete t.parent;var e=this.children.indexOf(t);return this.children.splice(e,1),qc&&qc.entityHierarchyChanged.post(),this},Entity.prototype.removeAllChildren=function(){for(var t=0,e=this.children.slice();t<e.length;t++){e[t].destroy()}return this},Entity.prototype.findChildById=function(t){if(this.id===t)return this;for(var e=0,r=this.children;e<r.length;e++){if((o=r[e]).id===t)return o}for(var n=0,i=this.children;n<i.length;n++){var o,a=(o=i[n]).findChildById(t);if(a)return a}},Entity.prototype.findChild=function(t){for(var e=0,r=this.children;e<r.length;e++){if((o=r[e]).name===t)return o}for(var n=0,i=this.children;n<i.length;n++){var o,a=(o=i[n]).findChild(t);if(a)return a}},Entity.prototype.filterChildren=function(t){var e=[];return this.traverse(function(r){return t(r)&&e.push(r),!0}),e},Entity.prototype.isAncestor=function(t){return this.parent===t||!!this.parent&&this.parent.isAncestor(t)},Entity.prototype.setTag=function(t){var e;return Object.assign(this._tags,((e={})[t]=!0,e)),this},Entity.prototype.hasTag=function(t){return t in this._tags},Entity.prototype.traverse=function(t,e){void 0===e&&(e=!1);var r=!0;e&&(r=t(this)),r&&this.traverseInternal(this,t)},Entity.prototype.traverseAncestors=function(t,e){void 0===e&&(e=!1);var r=!0;e&&(r=t(this)),r&&this.traverseAncestorsInternal(this,t)},Entity.prototype.iterateComponents=function(t){for(var e=0,r=Object.values(this._components);e<r.length;e++){t(r[e])}},Entity.prototype.getAncestor=function(t){var e=Vc.getComponentByName(this,t);return e&&e.active?e:this.parent?this.parent.getAncestor(t):null},Entity.prototype.getAncestorOfType=function(t){return this.getAncestor(t.name)},Entity.prototype.destroy=function(){this.parent&&this.parent.removeChild(this),Vc.collectEntityOperations?Vc.entitiesJustDestroyed.push(this):Vc.destroyEntity(this)},Entity.prototype.hasComponent=function(t){return t in this._components},Entity.prototype.hasComponentByType=function(t){return this.hasComponent(t.name)},Entity.prototype.serialize=function(){return console.assert(!1),{typeName:"InvalidEntityData",version:1,properties:{}}},Entity.prototype.deserialize=function(t){return console.assert(!1),Promise.reject()},Entity.prototype.copyWithIdMap=function(t){return this.copyInternal(t,void 0)},Entity.prototype.copy=function(t,e){return this.copyInternal(void 0,t)},Entity.prototype.initializeActive=function(t){this._active=t},Entity.prototype.copyInternal=function(t,e){var r=new Entity;r.prefabId=this.prefabId,Lc.deserializeEntity(r,Lc.serializeEntity(this,!0));var n=t||e||{};return r.traverse(function(e){if(t){var r=t[e.id];if(r)return e.id=r,!0}var i=S.makeUniqueId();return n[e.id]=i,e.id=i,!0},!0),Uc.instance.translateReferences(r,n),r},Entity.prototype.getComponentsInChildren=function(t,e){if(this.active){var r=Vc.getComponentByName(this,t);r&&r.active&&e.push(r);for(var n=0,i=this.children;n<i.length;n++){i[n].getComponentsInChildren(t,e)}}},Entity.prototype.traverseInternal=function(t,e){for(var r=0,n=t.children;r<n.length;r++){var i=n[r];e(i)&&this.traverseInternal(i,e)}},Entity.prototype.traverseAncestorsInternal=function(t,e){t.parent&&e(t.parent)&&this.traverseAncestorsInternal(t.parent,e)},Entity}(E),Kc=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Qc=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Yc=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Zc=function(t){function StaticCubemap(){var e=null!==t&&t.apply(this,arguments)||this;return e.front=new re(Dn),e.back=new re(Dn),e.top=new re(Dn),e.bottom=new re(Dn),e.left=new re(Dn),e.right=new re(Dn),e}return Kc(StaticCubemap,t),StaticCubemap.prototype.setProperty=function(e,r){var n=this;if(t.prototype.setProperty.call(this,e,r),this._textureId){var i=r.asset;if(i){this.initConfigIfNecessary();var o=this._config.find(function(t){return t.id===e});o&&i.loadTextureData(function(){var t=gt.context;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,n._textureId),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.texImage2D(o.side,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.image)})}}},StaticCubemap.prototype.isLoaded=function(){return this.initConfigIfNecessary(),this._config.every(function(t){return S.isAssetRefLoaded(t.texture)})},StaticCubemap.prototype.begin=function(t){if(!this._textureId&&!this.graphicLoad())return!1;var e=gt.context;return e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_CUBE_MAP,this._textureId),!0},StaticCubemap.prototype.graphicLoad=function(){if(this._textureId)return!0;var t=gt.context;this._textureId=t.createTexture(),this.initConfigIfNecessary();for(var e=0,r=this._config;e<r.length;e++){var n=r[e],i=n.texture.asset;i&&(t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,this._textureId),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.texImage2D(n.side,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.image))}return t.bindTexture(t.TEXTURE_CUBE_MAP,this._textureId),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),!0},StaticCubemap.prototype.graphicUnload=function(){this._textureId&&(gt.context.deleteTexture(this._textureId),this._textureId=null)},StaticCubemap.prototype.makeConfig=function(t){return[{id:"front",texture:this.front,side:t.TEXTURE_CUBE_MAP_POSITIVE_Z},{id:"back",texture:this.back,side:t.TEXTURE_CUBE_MAP_NEGATIVE_Z},{id:"top",texture:this.top,side:t.TEXTURE_CUBE_MAP_POSITIVE_Y},{id:"bottom",texture:this.bottom,side:t.TEXTURE_CUBE_MAP_NEGATIVE_Y},{id:"left",texture:this.left,side:t.TEXTURE_CUBE_MAP_NEGATIVE_X},{id:"right",texture:this.right,side:t.TEXTURE_CUBE_MAP_POSITIVE_X}]},StaticCubemap.prototype.initConfigIfNecessary=function(){this._config||(this._config=this.makeConfig(gt.context))},Qc([unserializable(),Yc("design:type",Object)],StaticCubemap.prototype,"_textureId",void 0),Qc([unserializable(),Yc("design:type",Array)],StaticCubemap.prototype,"_config",void 0),StaticCubemap=Qc([creatable(!0),referencable(!0),displayName("Static Cubemap")],StaticCubemap)}(q),Jc=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),$c=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},tu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},eu=function(t){function Environment(){return null!==t&&t.apply(this,arguments)||this}return Jc(Environment,t),Environment}(O),ru=function(t){function ColorEnvironment(e){var r=t.call(this)||this;return r.color=e||new Z,r.color.a=0,r}return Jc(ColorEnvironment,t),ColorEnvironment=$c([displayName("Color"),tu("design:paramtypes",[Z])],ColorEnvironment)}(eu),nu=function(t){function SkySimulation(){var e=null!==t&&t.apply(this,arguments)||this;return e.luminance=1,e.turbidity=2,e.rayleigh=1,e.mieCoefficient=.005,e.mieDirectionalG=.8,e.sunPosition=new H(0,1,1).normalize(),e}return Jc(SkySimulation,t),SkySimulation}(eu),iu=function(t){function SkyBoxEnvironment(){var e=null!==t&&t.apply(this,arguments)||this;return e._cubeMap=new re(Zc),e}return Jc(SkyBoxEnvironment,t),Object.defineProperty(SkyBoxEnvironment.prototype,"cubeMap",{get:function(){return this._cubeMap.asset},set:function(t){this._cubeMap.asset=t},enumerable:!0,configurable:!0}),SkyBoxEnvironment=$c([displayName("Skybox")],SkyBoxEnvironment)}(eu),ou=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),au=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},su=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},cu=function(t){function Scene(){var e=t.call(this)||this;return e._isLoadedCache=!1,e.root=new Xc,e.root.name="root",e._environment=new a(eu,new ru),e._fog=new a($),e}return ou(Scene,t),Object.defineProperty(Scene.prototype,"version",{get:function(){return 5},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"fog",{get:function(){return this._fog.instance},set:function(t){t!==this._fog.instance&&((this._fog.instance?this._fog.instance.constructor.name:void 0)!==(t?t.constructor.name:void 0)&&I.instance.forEach(function(t){t.isA(bu)&&t.invalidateProgram()}),this._fog.instance=t)},enumerable:!0,configurable:!0}),Object.defineProperty(Scene.prototype,"environment",{get:function(){return this._environment.instance},enumerable:!0,configurable:!0}),Scene.prototype.isLoaded=function(){if(this._isLoadedCache)return this._isLoadedCache;var t=this.root.isLoaded();return t&&(this._isLoadedCache=!0),t},Scene.prototype.serialize=function(){var t={typeName:this.constructor.name,version:this.version,id:this.id,name:this.name,root:Lc.serializeEntityWithPrefabRefs(this.root),environment:Lc.serializeProperty(this._environment),fog:Lc.serializeProperty(this._fog)};return this.prefabInstances&&Object.keys(this.prefabInstances).length>0&&(t.prefabInstances=this.prefabInstances),t},Scene.prototype.deserialize=function(t){var e=this,r=t;if(1===r.version){var n=t;r.root=n.properties.root,r.id=n.properties.id,r.name=n.properties.name}else 2===r.version||(3===r.version?Lc.deserializeProperty(this,"_environment","Reference",r.environment):(Lc.deserializeProperty(this,"_environment","Reference",r.environment),Lc.deserializeProperty(this,"_fog","Reference",r.fog)));this.id=r.id,this.name=r.name,this.prefabInstances=r.prefabInstances,Lc.deserializeEntity(this.root,r.root,!0);var i=[];return this.root.traverse(function(t){return!t.prefabId||(i.push({prefabId:t.prefabId,instanceInScene:t}),!1)}),new Promise(function(t){No.processBatch(i,function(t,r,n){e.setEntityFromPrefab(t.instanceInScene,t.prefabId).then(r).catch(n)},function(r){return t(e)})})},Scene.prototype.destroy=function(){this.root.destroy(),t.prototype.destroy.call(this)},Scene.prototype.setEntityFromPrefab=function(t,e){var r=this;return I.instance.loadObjectById(e).then(function(e){var n=e[0];return r.setEntityFromPrefabInstance(t,n),n})},Scene.prototype.setEntityFromPrefabInstance=function(t,e){var r=this;t.prefabId=e.id;var n,i=this.prefabInstances?this.prefabInstances[t.id]:void 0,o=i?i.prefabIdToInstanceId:void 0,a=!0;o||(a=!1,o={}),n=a?e.root.copyWithIdMap(o):e.root.copy(o,!0),console.assert(0===t.children.length);for(var s=0,c=n.children;s<c.length;s++){var u=c[s];u.parent=t,t.children.push(u)}if(n.iterateComponents(function(e){return Vc.setComponentFromInstance(t,e)}),a){var l=i;t.traverse(function(t){return l.overrides&&t.id in l.overrides&&r.overrideEntity(t,l.overrides[t.id]),!0},!0)}else this.prefabInstances||(this.prefabInstances={}),t.id=o[e.root.id],console.assert(void 0!==t.id),this.prefabInstances[t.id]={prefabIdToInstanceId:o}},Scene.prototype.overrideEntity=function(t,e){for(var r=0,n=Object.keys(e);r<n.length;r++)for(var i=n[r],o=0,a=Object.keys(e[i]);o<a.length;o++){var s=a[o],c=e[i][s],u=null;if(s in(u="Entity"===i?t:t.hasComponent(i)?Vc.getComponentByName(t,i):Vc.setComponentByName(t,i))){var l=Lc.getPropertyTypeName(u[s]);Lc.deserializeProperty(u,s,l,c)}}},au([Attributes_hidden(),su("design:type",Xc)],Scene.prototype,"root",void 0),au([Attributes_hidden(),su("design:type",Object)],Scene.prototype,"prefabInstances",void 0),au([unserializable(),su("design:type",Object)],Scene.prototype,"_isLoadedCache",void 0),Scene}(F);!function(t){function getTransitionAnimComponent(){return ai.transitionScene.root.findChild("FadeQuad").getComponent(bo)}function finalizeSceneLoad(){var e=0===t.scenes.length;if(t.sceneLoadInProgress){var r=t.sceneLoadInProgress,n=r.additive,i=r.scene,o=r.resolve;i?(n||(t.scenes.forEach(function(t){return t.destroy()}),Rl.clearDefaultPerspectiveCamera(),Y.resetCurrentFrame(),jo.onSceneDestroyed(),_c.clearCollisions(),t.scenes.length=0),I.instance.loadGraphicObjects(),t.scenes.push(i),e&&jo.create(),t.sceneLoadInProgress=null,Lc.clearNonPersistentObjectCache(),o(i)):console.assert(!1)}else console.assert(!1)}t.scenes=[],t.transitionInProgress=!1,t.sceneLoadInProgress=null,t.preloadedScenesInProgress=[],t.preloadedScenes=[],t.getTransitionAnimComponent=getTransitionAnimComponent,t.finalizeSceneLoad=finalizeSceneLoad,t.onTransitionAnimFinished=function onTransitionAnimFinished(e){var r=getTransitionAnimComponent();"FadeOut"===e?(t.scenes.pop(),finalizeSceneLoad(),r.animationFinished.once(onTransitionAnimFinished),r.playAnimation("FadeIn"),t.scenes.push(ai.transitionScene)):"FadeIn"===e&&(t.scenes.pop(),t.transitionInProgress=!1)}}(Gc||(Gc={})),function(t){t.list=function list(){return Gc.scenes},t.updateTransition=function updateTransition(){if(!Gc.transitionInProgress&&Gc.sceneLoadInProgress){var t=Gc.sceneLoadInProgress.scene;if(t&&t.isLoaded())if(V.log("Scene '"+t.templatePath+"' loaded."),Gc.scenes.length>0){var e=Gc.getTransitionAnimComponent();e.animationFinished.once(Gc.onTransitionAnimFinished),e.playAnimation("FadeOut"),Gc.transitionInProgress=!0,Gc.scenes.push(ai.transitionScene)}else Gc.finalizeSceneLoad()}},t.destroy=function destroy(){Gc.scenes.forEach(function(t){return I.instance.deleteObject(t)}),Gc.scenes=[]}}(Hc||(Hc={}));var uu,lu=function(){function Scenes(){}return Scenes.load=function(t,e){if(void 0===e&&(e=!1),Gc.sceneLoadInProgress)return console.warn("Only one scene load is supported at a time. Loading '"+Gc.sceneLoadInProgress.path+"', skipping '"+t+"'"),Promise.reject();if(Gc.preloadedScenes.some(function(e){return e===t})){var r=Gc.preloadedScenes.indexOf(t);console.assert(r>=0),Gc.preloadedScenes.splice(r,1);var n=I.instance.getObject(t);return console.assert(n),Gc.sceneLoadInProgress={scene:n,path:t,additive:e,resolve:function(){}},Gc.finalizeSceneLoad(),Promise.resolve(n)}return new Promise(function(r,n){Gc.sceneLoadInProgress={path:t,additive:e,resolve:r},Do.loadObjectIgnoreCache(t).then(function(t){Gc.sceneLoadInProgress.scene=t[0]}).catch(n)})},Scenes.loadById=function(t){var e=sa.getPath(t);return e?Scenes.load(e):Promise.reject()},Scenes.unload=function(t){var e=Gc.scenes.indexOf(t);e>=0?(t.destroy(),Gc.scenes.splice(e,1)):console.warn("Trying to unload an unregistered scene instance")},Scenes.unloadByPath=function(t){var e=Gc.scenes.find(function(e){return e.templatePath===t});e?Scenes.unload(e):console.warn("Trying to unload an unknown scene '"+t+"'")},Scenes.create=function(){var t=new cu;return Gc.scenes.push(t),t},Scenes.preLoad=function(t){return Gc.preloadedScenesInProgress.some(function(e){return e===t})?(console.warn("Scene '"+t+"' is already being pre-loaded. Skipping request."),Promise.reject()):Gc.preloadedScenes.some(function(e){return e===t})?(console.warn("Scene '"+t+"' is already pre-loaded. Skipping request."),Promise.reject()):(Gc.preloadedScenesInProgress.push(t),new Promise(function(e,r){Do.loadObjectIgnoreCache(t).then(function(){Gc.preloadedScenes.push(t);var r=Gc.preloadedScenesInProgress.indexOf(t);console.assert(r>=0),Gc.preloadedScenesInProgress.splice(r,1),e()}).catch(r)}))},Scenes.clear=function(){Hc.destroy()},Scenes}();!function(t){(uu||(uu={})).getSections=function getSections(t){var e=t.match(/precision[' ']+(highp|mediump|lowp)[' ']+(float|int)[' ']*;/g),r=e?e.join("\n"):"",n=t.lastIndexOf("}");if(n>=0){var i=t;if(e&&e.length>0){var o=e[e.length-1],a=t.indexOf(o);i=t.substring(a+o.length,n)}else i=t.substring(0,n);return{qualifiers:r,coreMeat:i}}return V.logError("Invalid fragment shader syntax - could not locate closing bracket of entry block"),null}}();var pu,fu=function(){function ShaderCodeInjector(){}return ShaderCodeInjector.doVertexShader=function(t,e,r,n,i){var o="",a="",s="",c=!1;if(xt.renderer.showWireFrame&&(a+="\n    attribute vec3 barycentricCoord;\n    varying vec3 vBarycentric;",s+="\n    vBarycentric = barycentricCoord;",c=!0),!0===e&&(o+="\n    #define USE_SKINNING",c=!0),!0===r){var u=Hc.list()[0].fog;u&&(o+="\n    #define USE_FOG",u.isA(tt)&&(o+="\n    #define USE_EXPONENTIAL_FOG"),c=!0)}if(!0===n&&(o+="\n    #define USE_SHADOW_MAP",c=!0),!0===i&&(o+="\n    #define USE_VERTEX_COLOR",c=!0),c){var l=uu.getSections(t);if(l)return"  \n                    "+o+"\n                    "+l.qualifiers+"\n                    "+a+"\n                    "+l.coreMeat+"\n                    "+s+"\n                }\n                "}return t},ShaderCodeInjector.doFragmentShader=function(t,e,r,n){var i="",o="",a="",s=!1;xt.renderer.showWireFrame&&(gt.extensions.OES_standard_derivatives&&(i+="\n    #extension GL_OES_standard_derivatives: enable\n    #define Supports_GL_OES_standard_derivatives"),o+="\n    varying vec3 vBarycentric;\n    #ifdef Supports_GL_OES_standard_derivatives\n    float edgeFactor() {\n        vec3 d = fwidth(vBarycentric);\n        vec3 a3 = smoothstep(vec3(0.0), d * 1.2, vBarycentric);\n        return min(min(a3.x, a3.y), a3.z);\n    }\n    #endif",a+="\n    #ifdef Supports_GL_OES_standard_derivatives\n        gl_FragColor = mix(vec4(.8, .8, .8, 1.0), gl_FragColor, edgeFactor());    \n    #else\n        if(any(lessThan(vBarycentric, vec3(0.01)))) {\n            gl_FragColor = vec4(vec3(.7), 1.0);\n        }\n    #endif",s=!0);if(!0===e){var c=Hc.list()[0].fog;c&&(i+="\n    #define USE_FOG",c.isA(tt)&&(i+="\n    #define USE_EXPONENTIAL_FOG"),s=!0)}if(!0===r&&(i+="\n    #define USE_SHADOW_MAP",s=!0),!0===n&&(i+="\n    #define USE_VERTEX_COLOR",s=!0),s){var u=uu.getSections(t);if(u)return"\n                    "+i+"\n                    "+u.qualifiers+"                    \n                    "+o+"\n                    "+u.coreMeat+"\n                    "+a+"\n                }\n                "}return t},ShaderCodeInjector}();!function(t){function flattenVectors(t){return t.reduce(function(t,e){return t.concat(e.asArray())},[])}function flattenMatrices(t){return t.reduce(function(t,e){return t.concat(e.data)},[])}t.engineManagedParams={screenSize:!0,projectionMatrix:!0,viewMatrix:!0,worldMatrix:!0,localMatrix:!0,normalMatrix:!0,modelViewMatrix:!0,boneTexture:!0,boneTextureSize:!0,boneMatrices:!0,bindMatrix:!0,bindMatrixInverse:!0,fogColor:!0,fogDensity:!0,fogNear:!0,fogFar:!0,time:!0,deltaTime:!0,frame:!0,lightMatrix:!0,shadowMap:!0,"directionalLight.direction":!0,"directionalLight.color":!0,"directionalLight.shadow":!0,"directionalLight.shadowBias":!0,"directionalLight.shadowRadius":!0,"directionalLight.shadowMapSize":!0},t.shaderParamFactory={vec2:{typeName:"Vector2",create:function(){return new it},apply:function(t,e,r){return!!e.uniformLocation&&("Vector2"===r.constructor.name?t.uniform2f(e.uniformLocation,r.x,r.y):t.uniform2fv(e.uniformLocation,flattenVectors(r.data)),!0)}},vec3:{typeName:"Vector3",create:function(){return new H},apply:function(t,e,r){return!!e.uniformLocation&&("Vector3"===r.constructor.name?t.uniform3f(e.uniformLocation,r.x,r.y,r.z):t.uniform3fv(e.uniformLocation,flattenVectors(r.data)),!0)}},vec4:{typeName:"Color",create:function(){return new Z},apply:function(t,e,r){return!!e.uniformLocation&&("Color"===r.constructor.name?t.uniform4f(e.uniformLocation,r.r,r.g,r.b,r.a):t.uniform4fv(e.uniformLocation,flattenVectors(r.data)),!0)}},mat4:{typeName:"Matrix44",create:function(){return new st},apply:function(t,e,r){return!!e.uniformLocation&&("Matrix44"===r.constructor.name?t.uniformMatrix4fv(e.uniformLocation,!1,r.data):t.uniformMatrix4fv(e.uniformLocation,!1,flattenMatrices(r.data)),!0)}},mat3:{typeName:"Matrix33",create:function(){return new lt},apply:function(t,e,r){return!!e.uniformLocation&&("Matrix33"===r.constructor.name?t.uniformMatrix3fv(e.uniformLocation,!1,r.data):t.uniformMatrix3fv(e.uniformLocation,!1,flattenMatrices(r.data)),!0)}},sampler2D:{typeName:"Texture",create:function(){return new re(En)},apply:function(t,e,r){if(!e.uniformLocation||void 0===e.textureStage)return!1;var n=r.asset;return n&&n.begin(e.textureStage)?(t.uniform1i(e.uniformLocation,e.textureStage),!0):!!ai.whiteTexture.begin(e.textureStage)&&(t.uniform1i(e.uniformLocation,e.textureStage),!0)}},sampler1D:{typeName:"Texture",create:function(){return new re(En)},apply:function(t,e,r){if(!e.uniformLocation||void 0===e.textureStage)return!1;var n=r.asset;return n&&n.begin(e.textureStage)?(t.uniform1i(e.uniformLocation,e.textureStage),!0):!!ai.whiteTexture.begin(e.textureStage)&&(t.uniform1i(e.uniformLocation,e.textureStage),!0)}},samplerCube:{typeName:"StaticCubemap",create:function(){return new re(Zc)},apply:function(t,e,r){if(!e.uniformLocation)return!1;var n=r.asset;return!(!n||!n.begin(0))&&(t.uniform1i(e.uniformLocation,0),!0)}},float:{typeName:"Number",create:function(){return 0},apply:function(t,e,r){return!!e.uniformLocation&&("number"==typeof r?t.uniform1f(e.uniformLocation,r):t.uniform1fv(e.uniformLocation,r.data),!0)}},int:{typeName:"Number",create:function(){return 0},apply:function(t,e,r){return!!e.uniformLocation&&("number"==typeof r?t.uniform1i(e.uniformLocation,r):t.uniform1iv(e.uniformLocation,r.data),!0)}},bool:{typeName:"Boolean",create:function(){return 0},apply:function(t,e,r){return!!e.uniformLocation&&("boolean"==typeof r?t.uniform1i(e.uniformLocation,r):t.uniform1iv(e.uniformLocation,r.data),!0)}}}}(pu||(pu={}));var hu,du=function(){function ShaderUtils(){}return ShaderUtils.applyShaderParam=function(t,e,r){return pu.shaderParamFactory[e.type].apply(t,e,r)},ShaderUtils.buildMaterialParams=function(t,e,r){if(!t)return console.assert(!1),e;for(var n=new O,i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];if(!(a in pu.engineManagedParams)){var s=t[a].type;if("mat4"!==s){var c=!1;if(a in e){var u=Lc.getPropertyTypeName(e[a]);if("AssetReference"===u)u=e[a].typeName();c=u===pu.shaderParamFactory[s].typeName}n[a]=c?e[a]:pu.shaderParamFactory[s].create()}}}return n},ShaderUtils.editorParamsToFocus="__EditorParamsToFocus__",ShaderUtils}(),yu=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),mu=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},vu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t.attributeTypeToComponentCount={float:1,vec2:2,vec3:3,vec4:4},t.ref=new re(q)}(hu||(hu={}));var gu,_u,bu=function(t){function Shader(e){var r=t.call(this)||this;return r.codeChanged=new B.AsyncEvent,r._instances={0:{attributes:null,params:null,program:null,vertexShader:null,fragmentShader:null}},r._shaderError=!1,r._executedOnce=!1,e&&r.setState(e),r}return yu(Shader,t),Object.defineProperty(Shader.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Shader.prototype,"vertexCode",{get:function(){return this._vertexCode},set:function(t){this.invalidateProgram(),this._vertexCode=t,this._fragmentCode&&(this._instances[0].params=this.extractUniforms(this._vertexCode,this._fragmentCode))},enumerable:!0,configurable:!0}),Object.defineProperty(Shader.prototype,"fragmentCode",{get:function(){return this._fragmentCode},set:function(t){this.invalidateProgram(),this._fragmentCode=t,this._vertexCode&&(this._instances[0].params=this.extractUniforms(this._vertexCode,this._fragmentCode))},enumerable:!0,configurable:!0}),Shader.prototype.beginWithParams=function(t){if(!this.begin())return!1;for(var e=0,r=Object.keys(t);e<r.length;e++){var n=r[e];if(!this.applyParameter(n,t[n]))return!1}return!0},Shader.prototype.begin=function(){if(this._executedOnce){if(this._shaderError)return!1}else this._executedOnce=!0;var t=gt.context;if(this._instances[0].program)t.useProgram(this._instances[0].program);else{var e=fu.doVertexShader(this._vertexCode),r=this.createShader(t.VERTEX_SHADER,e,"vertex");if(!r)return this._shaderError=!0,!1;var n=fu.doFragmentShader(this._fragmentCode),i=this.createShader(t.FRAGMENT_SHADER,n,"fragment");if(!i)return this._shaderError=!0,!1;if(!this.loadInstance(t,this._instances[0],r,i,e,n))return!1}return!0},Shader.prototype.beginWithVisual=function(t){if(this._executedOnce){if(this._shaderError)return null}else this._executedOnce=!0;var e=t.bucketId,r=this._instances[e];r||(r={program:null,vertexShader:null,fragmentShader:null,attributes:null,params:null},this._instances[e]=r);var n=gt.context;if(r.program)n.useProgram(r.program);else if(!this.setupInstance(r,n,t))return null;return r},Shader.prototype.applyParameter=function(t,e,r){var n=r||0,i=this._instances[n],o=(i?i.params:this._instances[0].params)[t];return!(void 0!==o&&!du.applyShaderParam(gt.context,o,e))},Shader.prototype.applyReferenceParameter=function(t,e,r){var n=r||0,i=this._instances[n],o=(i?i.params:this._instances[0].params)[t];if(void 0!==o){var a=hu.ref;if(a.setAssetFast(e),!du.applyShaderParam(gt.context,o,a))return!1}return!0},Shader.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r),"_fragmentCode"===e?this._vertexCode&&(this._instances[0].params=this.extractUniforms(this._vertexCode,this._fragmentCode)):"_vertexCode"===e&&this._fragmentCode&&(this._instances[0].params=this.extractUniforms(this._vertexCode,this._fragmentCode))},Shader.prototype.graphicUnload=function(){for(var t=0,e=Object.keys(this._instances);t<e.length;t++){var r=e[t],n=this._instances[r],i=n.program;if(i){var o=gt.context;o.deleteShader(n.vertexShader),o.deleteShader(n.fragmentShader),o.deleteProgram(i),n.vertexShader=null,n.fragmentShader=null,n.program=null,n.params=null,n.attributes=null}}},Shader.prototype.invalidateProgram=function(){this._executedOnce=!1,this._shaderError=!1,this.graphicUnload()},Shader.prototype.getAttributes=function(t){return this._instances[t||0].attributes},Shader.prototype.getParams=function(t){return this._instances[t||0].params},Shader.prototype.upgrade=function(t,e){return 1===e&&Object.assign(t.properties,{_vertexCode:{typeName:"String",data:t.properties._vertexCode},_fragmentCode:{typeName:"String",data:t.properties._fragmentCode}}),t},Shader.prototype.loadInstance=function(t,e,r,n,i,o){var a=t.createProgram();if(t.attachShader(a,r),t.attachShader(a,n),t.linkProgram(a),!t.getProgramParameter(a,t.LINK_STATUS))return V.logError("Shader error in "+this.name+":"),V.logError(t.getProgramInfoLog(a)),this._shaderError=!0,!1;t.useProgram(a),e.params||(e.params=this.extractUniforms(i,o));for(var s=0,c=Object.keys(e.params);s<c.length;s++){var u=c[s],l=t.getUniformLocation(a,u);e.params[u].uniformLocation=l}e.attributes=this.extractAttributes(i);for(var p=0,f=Object.keys(e.attributes);p<f.length;p++){var h=f[p],d=t.getAttribLocation(a,h);e.attributes[h].location=d}return e.vertexShader=r,e.fragmentShader=n,e.program=a,!0},Shader.prototype.createShader=function(t,e,r){var n=gt.context,i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),n.getShaderParameter(i,n.COMPILE_STATUS)?i:(V.log("Shader error in "+this.name+"."+r+":"),V.log(n.getShaderInfoLog(i)),null)},Shader.prototype.setupInstance=function(t,e,r){var n=fu.doVertexShader(this._vertexCode,r.isSkinned,r.receiveFog,r.receiveShadows,r.hasVertexColor),i=this.createShader(e.VERTEX_SHADER,n,"vertex");if(!i)return this._shaderError=!0,!1;var o=fu.doFragmentShader(this._fragmentCode,r.receiveFog,r.receiveShadows,r.hasVertexColor),a=this.createShader(e.FRAGMENT_SHADER,o,"fragment");return a?this.loadInstance(e,t,i,a,n,o):(this._shaderError=!0,!1)},Shader.prototype.extractAttributes=function(t){var e={},r=this.removeComments(t).match(/attribute (vec|float|uint|int|bool|mat|sampler|samplerCube)+[1234D]* [_a-zA-Z0-9]+/g);if(r)for(var n=0,i=r;n<i.length;n++){var o=i[n],a=o.split(" "),s=a[1],c=a[2];if(s&&c){var u=hu.attributeTypeToComponentCount[s];void 0!==u?e[c]={location:-1,componentCount:u}:V.logWarning("Unsupported type: '"+s+"' for shader attribute '"+c+"', ignoring this attribute.")}else V.logWarning("Invalid shader attribute syntax: '"+o+"', ignoring this attribute.")}return e},Shader.prototype.extractUniforms=function(t,e){var r={},n=this.parseUniforms(t,r,0);return this.parseUniforms(e,r,n),r},Shader.prototype.parseUniforms=function(t,e,r){var n=this.removeComments(t).match(/uniform (vec|float|uint|int|bool|mat|sampler|samplerCube)+[234D]* [_a-zA-Z0-9]+/g);if(n)for(var i=0,o=n;i<o.length;i++){var a=o[i],s=a.split(" "),c=s[1],u=s[2];c&&u?e[u]={type:c,uniformLocation:null,textureStage:c.match(/sampler+[234D]*/)?r++:void 0}:V.logWarning("Invalid shader uniform syntax: '"+a+"', ignoring this uniform.")}return r},Shader.prototype.removeComments=function(t){return t.replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")},mu([unserializable(),vu("design:type",Object)],Shader.prototype,"codeChanged",void 0),mu([unserializable(),vu("design:type",Object)],Shader.prototype,"_instances",void 0),mu([Attributes_hidden(),vu("design:type",String)],Shader.prototype,"_vertexCode",void 0),mu([Attributes_hidden(),vu("design:type",String)],Shader.prototype,"_fragmentCode",void 0),mu([unserializable(),vu("design:type",Object)],Shader.prototype,"_shaderError",void 0),mu([unserializable(),vu("design:type",Object)],Shader.prototype,"_executedOnce",void 0),Shader=mu([creatable(!0),referencable(!0),hasDedicatedEditor(!0),vu("design:paramtypes",[Object])],Shader)}(q),wu=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Pu=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},xu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};(gu||(gu={})).shaderParamsPropertySetter="shaderParams",function(t){t.shaderPropertyKey="_shader",t.shaderParamsPropertyKey="_"+gu.shaderParamsPropertySetter}(_u||(_u={}));var Ou,Cu=function(t){function Material(e){var r,n=t.call(this)||this;if(n._blending=i.None,n._renderPass=p.Opaque,n._cullMode=u.Back,n._depthTest=!0,n._priority=0,n._shaderParams=new O,n._shader=new re(bu),n.onShaderCodeChanged=n.onShaderCodeChanged.bind(n),n.onShaderChanged=n.onShaderChanged.bind(n),n._shader.assetChanged.attach(n.onShaderChanged),e){if(gu.shaderParamsPropertySetter in e){var o=e[gu.shaderParamsPropertySetter],a=e.shader;a&&(delete e[gu.shaderParamsPropertySetter],delete e.shader,Object.assign(e,((r={shader:a})[gu.shaderParamsPropertySetter]=o,r)))}n.setState(e)}return n}return wu(Material,t),Object.defineProperty(Material.prototype,"version",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"shader",{get:function(){return this._shader.asset},set:function(t){this._shader.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"blending",{get:function(){return this._blending},set:function(t){this._blending=t},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"renderPass",{get:function(){return this._renderPass},set:function(t){this._renderPass=t},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"cullMode",{get:function(){return this._cullMode},set:function(t){this._cullMode=t},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"priority",{get:function(){return this._priority},set:function(t){this._priority=t},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"shaderParams",{get:function(){return this._shaderParams},set:function(t){if(this.shader){var e=this.shader.getParams();Object.keys(t).filter(function(t){return t in e&&("sampler2D"===e[t].type||"sampler1D"===e[t].type)}).forEach(function(e){var r=t[e];console.assert(r),"string"==typeof r?t[e]=new re(En,new Dn({textureData:r})):r.isA&&r.isA(En)?t[e]=new re(En,r):console.error("Invalid sampler uniform '"+e+"', must be an Url or a Texture object.")}),this._shaderParams=du.buildMaterialParams(e,t,!1),this.updateRuntimeAccessors()}else console.error("Cannot set property 'shaderParams' on Material because it has no shader.")},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"depthTest",{get:function(){return this._depthTest},set:function(t){this._depthTest=t},enumerable:!0,configurable:!0}),Object.defineProperty(Material.prototype,"buckedId",{get:function(){return""+(1<<this.blending|1<<i.Additive+1<<this.cullMode|1<<i.Additive+1+(u.None+1)<<(this._depthTest?0:1))},enumerable:!0,configurable:!0}),Material.prototype.begin=function(){var t=this.shader;return!(!t||!t.beginWithParams(this.shaderParams))&&(this.uploadState(),!0)},Material.prototype.uploadState=function(){var t=gt.context,e=this.blending;e===i.None?t.disable(t.BLEND):e===i.Linear?(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)):e===i.Additive&&(t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE));var r=this.cullMode;r===u.Back?(t.enable(t.CULL_FACE),t.cullFace(t.BACK)):r===u.Front?(t.enable(t.CULL_FACE),t.cullFace(t.FRONT)):t.disable(t.CULL_FACE)},Material.prototype.destroy=function(){this._shader.asset&&this._shader.asset.codeChanged.detach(this.onShaderCodeChanged),this._shader.detach();for(var e=0,r=Object.values(this._shaderParams);e<r.length;e++){var n=r[e];"AssetReference"===n.constructor.name&&n.detach()}t.prototype.destroy.call(this)},Material.prototype.isLoaded=function(){return!!S.isAssetRefLoaded(this._shader)&&S.isObjectLoaded(this._shaderParams)},Material.prototype.queueParameter=function(t,e){this._shaderParams[t]=e},Material.prototype.queueReferenceParameter=function(t,e){var r=this._shaderParams[t];r?r.setAssetFast(e):V.logError("queueReferenceParameter failed")},Material.prototype.getParameter=function(t){return this._shaderParams[t]},Material.prototype.applyParameter=function(t,e){var r=this.shader;r&&(this._shaderParams[t]=e,r.applyParameter(t,e))},Material.prototype.applyReferenceParameter=function(t,e){var r=this.shader;if(r){var n=this._shaderParams[t];n.setAssetFast(e),r.applyParameter(t,n)}},Material.prototype.upgrade=function(t,e){if(1===e)Object.assign(t.properties,{_blending:t.properties.blending,_renderPass:t.properties.renderPass,_cullMode:t.properties.cullMode,_priority:t.properties.priority,_shaderParams:t.properties.shaderParams,_shader:t.properties.shader}),delete t.properties.blending,delete t.properties.renderPass,delete t.properties.cullMode,delete t.properties.priority,delete t.properties.shaderParams,delete t.properties.shader;else if(2===e)for(var r=t.properties._shaderParams,n=0,i=Object.keys(r.properties);n<i.length;n++){var o=i[n],a=r.properties[o];if("TextureReference"===a.typeName){var s=a.data.properties.texture;r.properties[o]={typeName:"AssetReference",data:JSON.parse(JSON.stringify(s))}}}else if(3===e){var c=t.properties._renderPass;"object"==typeof c&&(c=c.value),c>0&&Object.assign(t.properties,{_renderPass:c-1})}return t},Material.prototype.onShaderCodeChanged=function(t){var e=this.shader;e&&(this._shaderParams=du.buildMaterialParams(e.getParams(),this._shaderParams,!0),this.updateRuntimeAccessors())},Material.prototype.onShaderChanged=function(t){t.newAsset&&(this._shaderParams=du.buildMaterialParams(t.newAsset.getParams(),this._shaderParams,!1),this.updateRuntimeAccessors())},Material.prototype.updateRuntimeAccessors=function(){for(var t=this,e=function(e){var n=r._shaderParams[e];"AssetReference"===n.constructor.name?Object.defineProperty(r,e,{get:function(){return n.asset},set:function(t){n.asset=t},configurable:!0}):Object.defineProperty(r,e,{get:function(){return n},set:function(r){t._shaderParams[e]=r},configurable:!0})},r=this,n=0,i=Object.keys(this._shaderParams);n<i.length;n++){e(i[n])}},Pu([Attributes_enumLiterals(c.literals),xu("design:type",Object)],Material.prototype,"_blending",void 0),Pu([Attributes_enumLiterals(d.literals),xu("design:type",Object)],Material.prototype,"_renderPass",void 0),Pu([Attributes_enumLiterals(f.literals),xu("design:type",Object)],Material.prototype,"_cullMode",void 0),Material}(F),Su=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ru=function(t){function StaticMesh(){var e=null!==t&&t.apply(this,arguments)||this;return e.mesh=new re(ma),e}return Su(StaticMesh,t),StaticMesh.prototype.getVertexBuffer=function(){var t=this.mesh.asset;return t?t.vertexBuffer:null},StaticMesh.prototype.getBoundingBox=function(){var t=this.mesh.asset;return t?t.boundingBox:null},StaticMesh.prototype.destroy=function(){this.mesh.detach(),t.prototype.destroy.call(this)},StaticMesh}(as),ju=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Tu=function(t){function Bone(e){var r=t.call(this)||this;return r.worldMatrix=new st,r.inverseMatrix=new st,r.fbxId=0,e&&r.setState(e),r}return ju(Bone,t),Object.defineProperty(Bone.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Bone.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{worldMatrix:t.properties.boneWorldMatrix,inverseMatrix:t.properties.boneInverseMatrix}),delete t.properties.boneWorldMatrix,delete t.properties.boneInverseMatrix),t},Bone}(kt),Eu=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Bu=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Au=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Iu=function(t){function MemoryTexture(e,r,n,i,o){var a=t.call(this)||this;return a._isDirty=!0,a._data=e,a._width=r,a._height=n,a._format=i,a._type=o,a.isPersistent=!1,a}return Eu(MemoryTexture,t),MemoryTexture.prototype.getWidth=function(){return this._width},MemoryTexture.prototype.getHeight=function(){return this._height},MemoryTexture.prototype.begin=function(t){var e=gt.context;return this._textureId?(e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),this._isDirty&&(this.updateTexture(),this._isDirty=!1)):(this._textureId=e.createTexture(),e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.updateTexture()),!0},MemoryTexture.prototype.dirtify=function(){this._isDirty=!0},MemoryTexture.prototype.updateTexture=function(){var t=gt.context;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,this._format,this._width,this._height,0,this._format,this._type,this._data)},Bu([unserializable(),Au("design:type",Object)],MemoryTexture.prototype,"_isDirty",void 0),MemoryTexture=Bu([referencable(!1),Au("design:paramtypes",[Float32Array,Number,Number,Number,Number])],MemoryTexture)}(En),Mu=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),ku=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},zu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};(Ou||(Ou={})).offsetMatrix=new st;var Fu,Du=function(t){function SkinnedMesh(){var e=t.call(this)||this;return e._bindMatrix=new st,e._bindMatrixInverse=new st,e._boneFbxIds=new Rt(Number),e._skeleton=new Wt(void 0),e}return Mu(SkinnedMesh,t),Object.defineProperty(SkinnedMesh.prototype,"skeleton",{get:function(){return this._skeleton.entity},set:function(t){this._skeleton.entity=t},enumerable:!0,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"bindMatrix",{get:function(){return this._bindMatrix},set:function(t){this._bindMatrix.copy(t),this._bindMatrixInverse.getInverse(t)},enumerable:!0,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"bindMatrixInverse",{get:function(){return this._bindMatrixInverse},enumerable:!0,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"boneTexture",{get:function(){return this._boneTexture},enumerable:!0,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"boneTextureSize",{get:function(){return this._boneTextureSize},enumerable:!0,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"boneMatrices",{get:function(){return this._boneMatrices},enumerable:!0,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"boneFbxIds",{set:function(t){this._boneFbxIds.data.length=0;for(var e=0,r=t;e<r.length;e++){var n=r[e];this._boneFbxIds.grow(n)}},enumerable:!0,configurable:!0}),SkinnedMesh.prototype.getVertexBuffer=function(){return t.prototype.getVertexBuffer.call(this)},SkinnedMesh.prototype.graphicUpdate=function(t,e,r,n,i){if(!this._skeleton.entity)return ts.Unchanged;var o=gt.extensions.OES_texture_float;if(!this._boneMatrices){this._bones=[],this._boneInverses=[];for(var a=this._skeleton.entity.getComponents(Tu),s=0,c=function(t){var e=t.valueOf(),r=a.find(function(t){return t.fbxId===e});r?(u._bones[s]=r.entity,u._boneInverses[s]=r.inverseMatrix,++s):V.logWarning("Bone with ID '"+t+"' not found")},u=this,l=0,p=this._boneFbxIds.data;l<p.length;l++){c(p[l])}this._bones.length=s,this._boneInverses.length=s;var f=Math.sqrt(4*this._bones.length);if(f=K.ceilPowerOfTwo(f),f=Math.max(f,4),this._boneMatrices=new Float32Array(f*f*4),o){var h=gt.context;this._boneTexture=new Iu(this._boneMatrices,f,f,h.RGBA,h.FLOAT),this._boneTextureSize=f}}return o?(this.updateMatrices(),this._boneTexture.dirtify(),e.applyReferenceParameter("boneTexture",this._boneTexture,r),e.applyParameter("boneTextureSize",this._boneTextureSize,r)):(this.updateMatrices(),e.applyParameter("boneMatrices",this._boneMatrices)),e.applyParameter("bindMatrix",this._bindMatrix,r),e.applyParameter("bindMatrixInverse",this._bindMatrixInverse,r),ts.Unchanged},SkinnedMesh.prototype.destroy=function(){this._vb&&this._vb.unload(gt.context),t.prototype.destroy.call(this)},SkinnedMesh.prototype.updateMatrices=function(){for(var t=Ou.offsetMatrix,e=0;e<this._bones.length;++e){var r=this._bones[e]?this._bones[e].transform.worldMatrix:st.identity;t.multiplyMatrices(r,this._boneInverses[e]),t.toArray(this._boneMatrices,16*e)}},SkinnedMesh.skeletonPropertyKey="_skeleton",ku([Attributes_hidden(),zu("design:type",Wt)],SkinnedMesh.prototype,"_skeleton",void 0),ku([Attributes_hidden(),zu("design:type",Object)],SkinnedMesh.prototype,"_boneFbxIds",void 0),ku([unserializable(),zu("design:type",Ot)],SkinnedMesh.prototype,"_vb",void 0),ku([unserializable(),zu("design:type",Iu)],SkinnedMesh.prototype,"_boneTexture",void 0),ku([unserializable(),zu("design:type",Number)],SkinnedMesh.prototype,"_boneTextureSize",void 0),ku([unserializable(),zu("design:type",Float32Array)],SkinnedMesh.prototype,"_boneMatrices",void 0),ku([unserializable(),zu("design:type",Array)],SkinnedMesh.prototype,"_boneInverses",void 0),ku([unserializable(),zu("design:type",Array)],SkinnedMesh.prototype,"_bones",void 0),SkinnedMesh}(Ru),Nu=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Lu=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Vu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Uu=function(t){function Visual(e){var r=t.call(this)||this;return r.castShadows=!0,r.receiveShadows=!0,r.receiveFog=!0,r._group=new re(bs),r._geometry=new a(as),r._material=new re(Cu),e&&r.setState(e),r}return Nu(Visual,t),Object.defineProperty(Visual.prototype,"version",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"material",{get:function(){return this._material.asset},set:function(t){this._material.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"geometry",{get:function(){return this._geometry.instance},set:function(t){this._geometry.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"group",{get:function(){return this._group.asset},set:function(t){this._group.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"vertexBuffer",{get:function(){return this._geometry.instance?this._geometry.instance.getVertexBuffer():null},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"animatedMaterial",{get:function(){return this._uniqueAnimatedMaterialInstance},set:function(t){this._uniqueAnimatedMaterialInstance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"worldTransform",{get:function(){var t=this._geometry.instance;return t?t.getWorldTransform(this.entity.transform):this.entity.transform.worldMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"localTransform",{get:function(){return this.entity.transform.localMatrix},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"bucketId",{get:function(){var t=0;return this.receiveShadows&&(t=1),this.receiveFog&&(t|=2),this.isSkinned&&(t|=4),this.hasVertexColor&&(t|=8),""+t},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"isSkinned",{get:function(){return!!this._geometry.instance&&this._geometry.instance.isA(Du)},enumerable:!0,configurable:!0}),Object.defineProperty(Visual.prototype,"hasVertexColor",{get:function(){var t=this.geometry?this.geometry.getVertexBuffer():void 0;return!!t&&t.hasAttribute("color")},enumerable:!0,configurable:!0}),Visual.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.getOrSetComponent(Lt)},Visual.prototype.graphicUpdate=function(t,e,r){var n=this._geometry.instance;return n?n.graphicUpdate(t,e,this.bucketId,this.entity.transform,r):ts.Unchanged},Visual.prototype.destroy=function(){var e=this._geometry.instance;e&&e.destroy(),this._uniqueAnimatedMaterialInstance&&this._uniqueAnimatedMaterialInstance.destroy(),this._material.detach(),this._group.detach(),t.prototype.destroy.call(this)},Visual.prototype.upgrade=function(t,e){if(1===e){Object.assign(t.properties,{_group:t.properties.group,_material:t.properties.material});var r=t.properties.geometry.data;r&&"Particles"!==r.typeName&&Object.assign(t.properties,{_geometry:t.properties.geometry}),delete t.properties.group,delete t.properties.material,delete t.properties.geometry}else if(2===e){(n=t.properties._geometry.data)&&"SkyBox"===n.typeName&&delete t.properties._geometry.data}else if(3===e){var n;(n=t.properties._geometry.data)&&"Quad"===n.typeName&&(n.typeName="QuadGeometry")}return t},Lu([unserializable(),Attributes_hidden(),Vu("design:type",Cu)],Visual.prototype,"_uniqueAnimatedMaterialInstance",void 0),Visual=Lu([helpUrl("https://docs.spiderengine.io/3d/visual.html"),Vu("design:paramtypes",[Object])],Visual)}(kt),Wu=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),qu=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Gu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Hu=function(t){function RenderTarget(e,r,n,i,o){var a=t.call(this)||this;return a.sizeChanged=new B.VoidAsyncEvent,a._filtering=s.Linear,a._loadError=!1,a._width=e||new Zt,a._height=r||new Zt,a._rgba=void 0!==n&&n,a.isPersistent=void 0===i||i,void 0!==o&&(a._filtering=o),a}return Wu(RenderTarget,t),Object.defineProperty(RenderTarget.prototype,"width",{set:function(t){t.equals(this._width)||(this._width=t,this._frameBuffer&&this.resize(gt.context),this.sizeChanged.post())},enumerable:!0,configurable:!0}),Object.defineProperty(RenderTarget.prototype,"height",{set:function(t){t.equals(this._height)||(this._height=t,this._frameBuffer&&this.resize(gt.context),this.sizeChanged.post())},enumerable:!0,configurable:!0}),Object.defineProperty(RenderTarget.prototype,"isValid",{get:function(){return this._frameBuffer},enumerable:!0,configurable:!0}),RenderTarget.prototype.getWidth=function(){return this._actualWidth},RenderTarget.prototype.getHeight=function(){return this._actualHeight},RenderTarget.prototype.bind=function(t){if(!this._frameBuffer){if(this._loadError)return!1;if(!this.graphicLoad())return!1}return t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),t.viewport(0,0,this._actualWidth,this._actualHeight),t.depthMask(!0),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),!0},RenderTarget.prototype.begin=function(t){if(!this._textureId)return!1;if(xt.renderer.renderTarget===this)return!1;var e=gt.context;return e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,this._textureId),!0},RenderTarget.prototype.graphicLoad=function(){if(this._frameBuffer)return!0;var t=gt.context;return this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),this._textureId=t.createTexture(),this._depthBuffer=t.createRenderbuffer(),this.resize(t),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._textureId,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this._depthBuffer),t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE||(V.logError("Could not create render target"),this._loadError=!0,!1)},RenderTarget.prototype.graphicUnload=function(){if(t.prototype.graphicUnload.call(this),this._frameBuffer){var e=gt.context;e.deleteFramebuffer(this._frameBuffer),e.deleteRenderbuffer(this._depthBuffer),this._frameBuffer=null,this._depthBuffer=null}},RenderTarget.prototype.resize=function(t){this._actualWidth=this._width.value,this._width.type===Vt.Relative&&(this._actualWidth=xt.renderer.screenSize.x*this._actualWidth),this._actualHeight=this._height.value,this._height.type===Vt.Relative&&(this._actualHeight=xt.renderer.screenSize.y*this._actualHeight),t.bindTexture(t.TEXTURE_2D,this._textureId),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._rgba?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this._actualWidth,this._actualHeight,0,t.RGBA,t.UNSIGNED_BYTE,null):t.texImage2D(t.TEXTURE_2D,0,t.RGB,this._actualWidth,this._actualHeight,0,t.RGB,t.UNSIGNED_BYTE,null),this._filtering===s.Nearest?(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST)):(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)),t.bindRenderbuffer(t.RENDERBUFFER,this._depthBuffer),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this._actualWidth,this._actualHeight),t.bindRenderbuffer(t.RENDERBUFFER,null)},qu([unserializable(),Gu("design:type",Object)],RenderTarget.prototype,"sizeChanged",void 0),qu([Attributes_enumLiterals(l.literals),Gu("design:type",Object)],RenderTarget.prototype,"_filtering",void 0),qu([unserializable(),Gu("design:type",Object)],RenderTarget.prototype,"_frameBuffer",void 0),qu([unserializable(),Gu("design:type",Object)],RenderTarget.prototype,"_depthBuffer",void 0),qu([unserializable(),Gu("design:type",Object)],RenderTarget.prototype,"_loadError",void 0),qu([unserializable(),Gu("design:type",Number)],RenderTarget.prototype,"_actualWidth",void 0),qu([unserializable(),Gu("design:type",Number)],RenderTarget.prototype,"_actualHeight",void 0),RenderTarget=qu([creatable(!0),referencable(!0),displayName("Render Target"),Gu("design:paramtypes",[Zt,Zt,Boolean,Boolean,Number])],RenderTarget)}(En),Xu=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ku=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Qu=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Yu=function(t){function PerspectiveProjector(){var e=null!==t&&t.apply(this,arguments)||this;return e._fov=60,e._zNear=.1,e._zFar=1e3,e._projectionMatrix=new st,e}return Xu(PerspectiveProjector,t),Object.defineProperty(PerspectiveProjector.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(PerspectiveProjector.prototype,"fov",{get:function(){return this._fov},set:function(t){this._fov=t,this.changed.post()},enumerable:!0,configurable:!0}),Object.defineProperty(PerspectiveProjector.prototype,"zNear",{get:function(){return this._zNear},set:function(t){this._zNear=t,this.changed.post()},enumerable:!0,configurable:!0}),Object.defineProperty(PerspectiveProjector.prototype,"zFar",{get:function(){return this._zFar},set:function(t){this._zFar=t,this.changed.post()},enumerable:!0,configurable:!0}),PerspectiveProjector.prototype.getProjectionMatrix=function(){return this._projectionMatrix},PerspectiveProjector.prototype.updateFrustum=function(t,e){var r=K.toRadians(this._fov);this._projectionMatrix.makePerspectiveProjection(r,e,this._zNear,this._zFar);var n=r/2,i=Math.tan(n)*this.zNear,o=i*e,a=Math.tan(n)*this.zFar,s=a*e;this._frustum.update(o,i,s,a,this.zNear,this.zFar,t)},PerspectiveProjector.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_zNear:t.properties.zNear,_zFar:t.properties.zFar,_fov:t.properties.fov}),delete t.properties.zNear,delete t.properties.zFar,delete t.properties.fov),t},Ku([unserializable(),Qu("design:type",Object)],PerspectiveProjector.prototype,"_projectionMatrix",void 0),PerspectiveProjector}(Ya),Zu=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ju=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},$u=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},tl=function(t){function Bloom(){var e=null!==t&&t.apply(this,arguments)||this;return e.intensity=.2,e}return Zu(Bloom,t),Bloom.prototype.render=function(t,e,r){return null},Bloom}(O),el=function(t){function FastBloom(){var e=null!==t&&t.apply(this,arguments)||this;return e.threshold=.9,e._downSample=8,e}return Zu(FastBloom,t),Object.defineProperty(FastBloom.prototype,"downSample",{set:function(t){var e=Math.max(t,1);if(this._buffer1&&e!==this._downSample){var r=this._buffer1.getWidth()*this._downSample/e,n=this._buffer1.getHeight()*this._downSample/e,i=new Zt(Vt.Absolute,r),o=new Zt(Vt.Absolute,n);this._buffer1.width=i,this._buffer1.height=o,this._buffer2.width=i,this._buffer2.height=o}this._downSample=e},enumerable:!0,configurable:!0}),FastBloom.prototype.render=function(t,e,r){if(!this._buffer1){var n=e.getWidth()/this._downSample,i=e.getHeight()/this._downSample,o=new Zt(Vt.Absolute,n),a=new Zt(Vt.Absolute,i);this._buffer1=new Hu(o,a,!1,!1),this._buffer2=new Hu(o,a,!1,!1)}var s=xt.renderer,c=ai.shaders.fullScreen;if(!c.begin())return null;s.renderTarget=this._buffer1,c.applyReferenceParameter("texture",e),c.applyParameter("threshold",this.threshold),oi.drawVertexBuffer(t,r,c);var u=ai.shaders.blur;if(!u.begin())return null;var l=it.fromPool().set(1/this._buffer1.getWidth(),1/this._buffer1.getHeight());return s.renderTarget=this._buffer2,u.applyParameter("horizontal",!0),u.applyReferenceParameter("texture",this._buffer1),u.applyParameter("pixelSize",l),oi.drawVertexBuffer(t,r,u),s.renderTarget=this._buffer1,u.applyParameter("horizontal",!1),u.applyReferenceParameter("texture",this._buffer2),oi.drawVertexBuffer(t,r,u),this._buffer1},FastBloom.prototype.destroy=function(){this._buffer1&&this._buffer1.destroy(),this._buffer2&&this._buffer2.destroy()},Ju([unserializable(),$u("design:type",Hu)],FastBloom.prototype,"_buffer1",void 0),Ju([unserializable(),$u("design:type",Hu)],FastBloom.prototype,"_buffer2",void 0),FastBloom}(tl),rl=function(t){function Desaturate(){return null!==t&&t.apply(this,arguments)||this}return Zu(Desaturate,t),Desaturate}(O),nl=function(t){function FastDesaturate(){var e=null!==t&&t.apply(this,arguments)||this;return e.rgbWeights=new H(.3,.59,.11),e}return Zu(FastDesaturate,t),FastDesaturate}(rl),il=function(t){function PostEffects(){var e=null!==t&&t.apply(this,arguments)||this;return e._bloom=new a(tl),e}return Zu(PostEffects,t),Object.defineProperty(PostEffects.prototype,"bloom",{get:function(){return this._bloom.instance},enumerable:!0,configurable:!0}),PostEffects.prototype.destroy=function(){var t=this.bloom;t&&t.destroy()},PostEffects}(O),ol=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),al=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},sl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},cl=function(t){function OrthographicProjector(){var e=null!==t&&t.apply(this,arguments)||this;return e._zNear=.1,e._zFar=1e3,e._size=5,e._projectionMatrix=new st,e}return ol(OrthographicProjector,t),Object.defineProperty(OrthographicProjector.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(OrthographicProjector.prototype,"zNear",{get:function(){return this._zNear},set:function(t){this._zNear=t,this.changed.post()},enumerable:!0,configurable:!0}),Object.defineProperty(OrthographicProjector.prototype,"zFar",{get:function(){return this._zFar},set:function(t){this._zFar=t,this.changed.post()},enumerable:!0,configurable:!0}),Object.defineProperty(OrthographicProjector.prototype,"size",{get:function(){return this._size},set:function(t){this._size=t,this.changed.post()},enumerable:!0,configurable:!0}),OrthographicProjector.prototype.getProjectionMatrix=function(){return this._projectionMatrix},OrthographicProjector.prototype.updateFrustum=function(t,e){var r=this._size*e,n=this._size;this._projectionMatrix.makeOrthoProjection(-r,r,n,-n,this._zNear,this._zFar);var i=this._size*e,o=this._size;this._frustum.update(i,o,i,o,this._zNear,this._zFar,t)},OrthographicProjector.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_zNear:t.properties.zNear,_zFar:t.properties.zFar,_size:t.properties.size}),delete t.properties.zNear,delete t.properties.zFar,delete t.properties.size),t},al([unserializable(),sl("design:type",Object)],OrthographicProjector.prototype,"_projectionMatrix",void 0),OrthographicProjector}(Ya),ul=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),ll=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},pl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};!function(t){t[t.Environment=0]="Environment",t[t.None=1]="None"}(Fu||(Fu={}));var fl,hl=function(){function CameraClearMetadata(){}return CameraClearMetadata.literals={Environment:0,None:1},CameraClearMetadata}();(fl||(fl={})).projectorProperty="_projector";var dl,yl=function(t){function Camera(e){var r=t.call(this)||this;return r._projector=new a(Ya),r._clearValue=Fu.Environment,r._priority=0,r._excludedGroups=new ne(bs),r._includedGroups=new ne(bs),r._renderTarget=new re(Hu),r._postEffects=new a(il),r._viewMatrix=new st,r._viewMatrixDirty=!0,r._invalidFrustum=!0,e&&r.setState(e),r.onTransformChanged=r.onTransformChanged.bind(r),r.onProjectorChanged=r.onProjectorChanged.bind(r),r.onRenderTargetChanged=r.onRenderTargetChanged.bind(r),r.onRenderTargetSizeChanged=r.onRenderTargetSizeChanged.bind(r),r._renderTarget.assetChanged.attach(r.onRenderTargetChanged),r.projector||(r.projector=new Yu),r}return ul(Camera,t),Object.defineProperty(Camera.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"projector",{get:function(){return this._projector.instance},set:function(t){var e=this._projector.instance;e&&e.changed.detach(this.onProjectorChanged),this._projector.instance=t,t&&(t.changed.attach(this.onProjectorChanged),this.entity&&this.updateFrustum())},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"clearValue",{get:function(){return this._clearValue},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"postEffects",{get:function(){return this._postEffects.instance},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"renderTarget",{get:function(){return this._renderTarget.asset},set:function(t){this._renderTarget.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"priority",{get:function(){return this._priority},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"sceneRenderTarget",{get:function(){if(!this._sceneRenderTarget){var t=it.fromPool().copy(xt.renderer.screenSize),e=this.renderTarget;e&&(t.x=e.getWidth(),t.y=e.getHeight());var r=new Zt(Vt.Absolute,t.x),n=new Zt(Vt.Absolute,t.y);this._sceneRenderTarget=new Hu(r,n,!1,!1)}return this._sceneRenderTarget},enumerable:!0,configurable:!0}),Object.defineProperty(Camera.prototype,"frustum",{get:function(){var t=this.projector;return t?(this._invalidFrustum&&this.updateFrustum(),t.frustum):null},enumerable:!0,configurable:!0}),Camera.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.getOrSetComponent(Lt).changed.attach(this.onTransformChanged);var r=this.projector;r&&0===r.changed.listenerCount()&&r.changed.attach(this.onProjectorChanged),this.updateFrustum()},Camera.prototype.destroy=function(){this._excludedGroups.detach(),this._includedGroups.detach(),this._renderTarget.detach(),this._sceneRenderTarget&&this._sceneRenderTarget.destroy();var e=this.postEffects;e&&e.destroy();var r=this.entity.transform;r&&r.changed.detach(this.onTransformChanged),t.prototype.destroy.call(this)},Camera.prototype.canRenderGroup=function(t){return!this._excludedGroups.data.some(function(e){return e.id===t})&&(!(this._includedGroups.data.length>0)||this._includedGroups.data.some(function(e){return e.id===t}))},Camera.prototype.getProjectionMatrix=function(){var t=this.projector;return t?(this._invalidFrustum&&this.updateFrustum(),t.getProjectionMatrix()):st.identity},Camera.prototype.getViewMatrix=function(){return this._viewMatrixDirty&&(this._viewMatrix.copy(this.entity.transform.worldMatrix),this._viewMatrix.invert(),this._viewMatrixDirty=!0),this._viewMatrix},Camera.prototype.getWorldRay=function(t,e){var r,n,i=this.projector;if(!i)return null;var o=this.renderTarget;if(o&&o.isValid)r=o.getWidth(),n=o.getHeight();else{var a=xt.renderer.screenSize;r=a.x,n=a.y}if(i.isA(Yu)){var s=i;return De.dummy.setFromPerspectiveView(s.fov*K.degreesToRadians,this.entity.transform.worldMatrix,t,e,r,n)}if(i.isA(cl)){var c=i;return De.dummy.setFromOrthographicView(c.size,this.entity.transform.worldMatrix,t,e,r,n)}return null},Camera.prototype.getViewPosition=function(t,e){var r=st.fromPool().copy(this.getProjectionMatrix()).multiply(this.getViewMatrix()),n=ot.fromPool().set(t.x,t.y,t.z,1).transform(r);return!(n.w<=0)&&(e.set(n.x/n.w,n.y/n.w,n.z/n.w),!0)},Camera.prototype.getScreenPosition=function(t,e){if(this.getViewPosition(t,e)){var r=xt.renderer.screenSize;return e.x=r.x*(.5*(e.x+1)),e.y=r.y*(.5*(1-e.y)),!0}return!1},Camera.prototype.setupFrame=function(){this._viewMatrixDirty=!0},Camera.prototype.setProperty=function(e,r){e===fl.projectorProperty?this.projector=r.instance:t.prototype.setProperty.call(this,e,r)},Camera.prototype.upgrade=function(t,e){if(1===e){var r={_projector:t.properties.projector,_clearValue:t.properties.clear,_excludedGroups:t.properties.excludedGroups,_includedGroups:t.properties.includedGroups,_renderTarget:t.properties.renderTarget,_priority:t.properties.priority};Object.assign(t.properties,r),delete t.properties.projector,delete t.properties.clear,delete t.properties.excludedGroups,delete t.properties.includedGroups,delete t.properties.renderTarget,delete t.properties.priority}return t},Camera.prototype.invalidateFrustum=function(){this._invalidFrustum=!0},Camera.prototype.updateFrustum=function(){var t=this.projector;if(t)if(this._invalidFrustum=!0,this._renderTarget.id){var e=this.renderTarget;if(e&&e.isValid){var r=e.getWidth()/e.getHeight();t.updateFrustum(this.entity.transform,r),this._invalidFrustum=!1}}else{var n=xt.renderer.screenSize;r=n.x/n.y;t.updateFrustum(this.entity.transform,r),this._invalidFrustum=!1}},Camera.prototype.onRenderTargetChanged=function(t){t.oldAsset&&t.oldAsset.sizeChanged.detach(this.onRenderTargetSizeChanged),t.newAsset&&t.newAsset.sizeChanged.attach(this.onRenderTargetSizeChanged),this.invalidateFrustum()},Camera.prototype.onTransformChanged=function(){this.invalidateFrustum()},Camera.prototype.onProjectorChanged=function(){this.invalidateFrustum()},Camera.prototype.onRenderTargetSizeChanged=function(){this.invalidateFrustum()},ll([Attributes_enumLiterals(hl.literals),pl("design:type",Object)],Camera.prototype,"_clearValue",void 0),ll([unserializable(),pl("design:type",Hu)],Camera.prototype,"_sceneRenderTarget",void 0),ll([unserializable(),pl("design:type",Object)],Camera.prototype,"_viewMatrix",void 0),ll([unserializable(),pl("design:type",Object)],Camera.prototype,"_viewMatrixDirty",void 0),ll([unserializable(),pl("design:type",Object)],Camera.prototype,"_invalidFrustum",void 0),Camera=ll([helpUrl("https://docs.spiderengine.io/3d/camera.html"),pl("design:paramtypes",[Object])],Camera)}(kt),ml=function(){function MapPool(t){this._size=0,this._initialCapacity=t,this._capacity=t,this._maps=[],this._maps.length=t;for(var e=0;e<t;++e)this._maps[e]=new Map}return MapPool.prototype.flush=function(){for(var t=0;t<this._size;++t)this._maps[t].clear();this._size=0},MapPool.prototype.get=function(){return this._size===this._capacity&&this.grow(),this._maps[this._size++]},MapPool.prototype.shrink=function(){this._capacity=this._initialCapacity,this._maps.length=this._capacity,this._size=Math.min(this._size,this._capacity)},MapPool.prototype.grow=function(){V.log("MapPool capacity reached, doubling the pool. Consider allocation a bigger pool.");var t=2*this._capacity;this._maps.length=t;for(var e=this._capacity;e<t;++e)this._maps[e]=new Map;this._capacity=t},MapPool}(),vl=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),gl=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},_l=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},bl=function(t){function LightType(){return null!==t&&t.apply(this,arguments)||this}return vl(LightType,t),LightType}(O),wl=function(t){function DirectionalLight(){return null!==t&&t.apply(this,arguments)||this}return vl(DirectionalLight,t),DirectionalLight}(bl),Pl=function(t){function PointLight(){var e=null!==t&&t.apply(this,arguments)||this;return e.radius=10,e}return vl(PointLight,t),PointLight}(bl);(dl||(dl={})).projectorProperty="_projector";var xl,Ol=function(t){function Light(e){var r=t.call(this)||this;return r.intensity=1,r.color=new Z(1,1,1,1),r.castShadows=!0,r.shadowBias=.001,r.shadowRadius=4,r.shadowMapSize=h._2048,r.viewMatrix=new st,r._type=new a(bl),r._projector=new a(Ya),r.onTransformChanged=r.onTransformChanged.bind(r),r.onProjectorChanged=r.onProjectorChanged.bind(r),e&&r.setState(e),r._type.instance||(r._type.instance=new wl),r._projector.instance||(r._projector.instance=new cl),r}return vl(Light,t),Object.defineProperty(Light.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Light.prototype,"projector",{get:function(){return this._projector.instance},set:function(t){var e=this._projector.instance;e&&e.changed.detach(this.onProjectorChanged),this._projector.instance=t,t&&(t.changed.attach(this.onProjectorChanged),this.entity&&this.updateFrustum())},enumerable:!0,configurable:!0}),Object.defineProperty(Light.prototype,"type",{set:function(t){this._type.instance=t},enumerable:!0,configurable:!0}),Object.defineProperty(Light.prototype,"frustum",{get:function(){return this._projector.instance?this._projector.instance.frustum:null},enumerable:!0,configurable:!0}),Light.prototype.setEntity=function(e){t.prototype.setEntity.call(this,e),e.getOrSetComponent(Lt),this.entity.transform.changed.attach(this.onTransformChanged);var r=this.projector;r&&0===r.changed.listenerCount()&&r.changed.attach(this.onProjectorChanged),this.updateFrustum()},Light.prototype.setProperty=function(e,r){e===dl.projectorProperty?this.projector=r.instance:t.prototype.setProperty.call(this,e,r)},Light.prototype.destroy=function(){var e=this.entity.transform;e&&e.changed.detach(this.onTransformChanged),t.prototype.destroy.call(this)},Light.prototype.getProjectionMatrix=function(){var t=this._projector.instance;return t?t.getProjectionMatrix():st.identity},Light.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_type:t.properties.type}),delete t.properties.type),t},Light.prototype.updateFrustum=function(){var t=this._projector.instance;t&&t.updateFrustum(this.entity.transform,1)},Light.prototype.onTransformChanged=function(){this.updateFrustum()},Light.prototype.onProjectorChanged=function(){this.updateFrustum()},gl([Attributes_enumLiterals(v.literals,function(t){return t.substring(1)}),_l("design:type",Object)],Light.prototype,"shadowMapSize",void 0),gl([unserializable(),_l("design:type",Object)],Light.prototype,"viewMatrix",void 0),Light}(kt);!function(t){function makeLightViewMatrix(t,e){var r=st.fromPool();return r.copy(e.entity.transform.worldMatrix),r.invert(),r}t.initialShadowCastersPoolSize=128,t.numRenderPasses=p.Transparent+1,t.initialCameraPoolSize=8,t.initialMaterialPoolSize=128,t.maxLights=1,t.defaultShadowMapSize=new it(2048,2048),t.defaultPerspectiveCamera=null,t.screenSize=new it,t.matrix=new st,t.normalMatrix=new lt,t.uiProjectionMatrix=new st,t.cameraToRenderPassMap=new Map,t.renderPassToDefinitionMapPool=new ml(t.initialCameraPoolSize),t.renderStateBucketMapPool=new ml(3*t.numRenderPasses),t.shaderToVisualBucketsMapPool=new ml(16),t.visualBucketsMapPool=new ml(16),t.vertexBufferToVisualsMapPool=new ml(16),t.currentRenderTarget=null,t.showWireFrame=!1,t.lights=[],t.shadowCasters=new Map,t.shadowMaps=[],t.skinnedRenderDepthBonesTexture=new re(En),t.doRenderPass=function doRenderPass(e,r,n){if(0!==e.renderStateBucketMap.size){var i=t.lights.length>0,o=Hc.list()[0].fog;e.begin(r);for(var a=function(a){var s=e.renderStateBucketMap.get(a);s.reference.uploadState(),s.reference.depthTest?r.enable(r.DEPTH_TEST):r.disable(r.DEPTH_TEST);var c=e.makeViewMatrix(n.getViewMatrix());s.shaderToVisualBucketsMap.forEach(function(a,s){a.forEach(function(a,u){var l=s.beginWithVisual(a.reference);if(l){if(s.applyParameter("projectionMatrix",n.getProjectionMatrix(),u),s.applyParameter("viewMatrix",c,u),i){var p=t.lights[0];a.reference.receiveShadows&&(t.matrix.multiplyMatrices(p.getProjectionMatrix(),p.viewMatrix),s.applyParameter("lightMatrix",t.matrix,u),s.applyReferenceParameter("shadowMap",t.shadowMaps[0],u));var f=H.fromPool().copy(p.entity.transform.worldForward);f.transformDirection(c),s.applyParameter("directionalLight.direction",f,u),s.applyParameter("directionalLight.color",p.color,u),s.applyParameter("directionalLight.shadow",p.castShadows,u),s.applyParameter("directionalLight.shadowBias",p.shadowBias,u),s.applyParameter("directionalLight.shadowRadius",p.shadowRadius,u),s.applyParameter("directionalLight.shadowMapSize",t.defaultShadowMapSize,u)}if(a.reference.receiveFog&&o)if(s.applyParameter("fogColor",o.color,u),o.isA(tt))s.applyParameter("fogDensity",o.density,u);else{var h=o;s.applyParameter("fogNear",h.near,u),s.applyParameter("fogFar",h.far,u)}var d=l.attributes;a.vertexBufferToVisualsMap.forEach(function(i,o){o.bindBuffers(r),o.bindAttributes(r,d);for(var a=0,l=i;a<l.length;a++){var p=l[a];p.graphicUpdate(n,s,nt.deltaTime)===ts.Changed&&o.updateBufferDatas(r);var f=e.makeWorldMatrix(p.worldTransform);t.matrix.multiplyMatrices(c,f),t.normalMatrix.getNormalMatrix(t.matrix),s.applyParameter("worldMatrix",f,u),s.applyParameter("localMatrix",p.localTransform,u),s.applyParameter("modelViewMatrix",t.matrix,u),s.applyParameter("normalMatrix",t.normalMatrix,u),s.applyParameter("screenSize",t.screenSize,u),s.applyParameter("time",nt.time,u),s.applyParameter("deltaTime",nt.deltaTime,u),s.applyParameter("frame",nt.currentFrame,u);for(var h=(p.animatedMaterial||p.material).shaderParams,y=0,m=Object.keys(h);y<m.length;y++){var v=m[y];s.applyParameter(v,h[v],u)}o.draw(r)}o.unbindAttributes(r,d)})}})})},s=0,c=Array.from(e.renderStateBucketMap.keys()).sort();s<c.length;s++)a(c[s])}},t.addToRenderMap=function addToRenderMap(e,r){var n=r.vertexBuffer;if(n){var i=r.animatedMaterial||r.material;if(i&&i.shader){var o=t.cameraToRenderPassMap.get(e).get(i.renderPass).renderStateBucketMap,a=i.buckedId,s=o.get(a);s||(s={reference:i,shaderToVisualBucketsMap:t.shaderToVisualBucketsMapPool.get()},o.set(a,s));var c=s.shaderToVisualBucketsMap.get(i.shader);c||(c=t.visualBucketsMapPool.get(),s.shaderToVisualBucketsMap.set(i.shader,c));var u=c.get(r.bucketId);u||(u={reference:r,vertexBufferToVisualsMap:t.vertexBufferToVisualsMapPool.get()},c.set(r.bucketId,u));var l=u.vertexBufferToVisualsMap.get(n);l?l.push(r):u.vertexBufferToVisualsMap.set(n,[r])}}},t.renderShadowMaps=function renderShadowMaps(e){t.shadowMaps.length=t.maxLights;var r=gt.context;r.enable(r.DEPTH_TEST),r.disable(r.BLEND),r.depthMask(!0),r.enable(r.CULL_FACE),r.cullFace(r.FRONT);for(var n=Math.min(t.lights.length,t.shadowMaps.length),i=null,o=function(n){var o=t.shadowMaps[n];if(!o){var a=new Zt(Vt.Absolute,t.defaultShadowMapSize.x);o=new Hu(a,a,!0,!1,s.Nearest),t.shadowMaps[n]=o}try{bt.instance.renderTarget=o,t.lights[n].viewMatrix.copy(makeLightViewMatrix(e,t.lights[n])),t.shadowCasters.forEach(function(e,o){var a=e[0].isSkinned,s=a?ai.shaders.skinnedRenderDepth:ai.shaders.renderDepth;s!==i&&(s.begin(),s.applyParameter("projectionMatrix",t.lights[n].getProjectionMatrix()),a&&s.applyParameter("viewMatrix",t.lights[n].viewMatrix),i=s),o.begin(r,s);for(var c=0,u=e;c<u.length;c++){var l=u[c];if(a){var p=l.geometry;if(!p.boneTexture)continue;s.applyParameter("localMatrix",l.localTransform),s.applyParameter("bindMatrix",p.bindMatrix),s.applyParameter("bindMatrixInverse",p.bindMatrixInverse),gt.extensions.OES_texture_float?(t.skinnedRenderDepthBonesTexture.asset=p.boneTexture,s.applyParameter("boneTexture",t.skinnedRenderDepthBonesTexture),s.applyParameter("boneTextureSize",p.boneTextureSize)):s.applyParameter("boneMatrices",p.boneMatrices)}else t.matrix.multiplyMatrices(t.lights[n].viewMatrix,l.worldTransform),s.applyParameter("modelViewMatrix",t.matrix);o.draw(r)}o.end(r,s)})}catch(t){}},a=0;a<n;++a)o(a)},t.setupCameraRenderPassDefinition=function setupCameraRenderPassDefinition(e){var r=t.renderPassToDefinitionMapPool.get();r.set(p.Opaque,{begin:function(t){t.enable(t.DEPTH_TEST),t.depthMask(!0)},makeViewMatrix:function(t){return t},makeWorldMatrix:function(t){return t},renderStateBucketMap:t.renderStateBucketMapPool.get()}),r.set(p.Transparent,{begin:function(t){t.enable(t.DEPTH_TEST),t.depthMask(!1)},makeViewMatrix:function(t){return t},makeWorldMatrix:function(t){return t},renderStateBucketMap:t.renderStateBucketMapPool.get()}),t.cameraToRenderPassMap.set(e,r)},t.makeSkyViewMatrix=function makeSkyViewMatrix(t){var e=st.fromPool();return e.copy(t.entity.transform.worldMatrix).setPosition(H.zero),e.transpose(),e},t.makeLightViewMatrix=makeLightViewMatrix}(xl||(xl={}));var Cl,Sl=function(){function Renderer(){}return Object.defineProperty(Renderer.prototype,"screenSize",{get:function(){return xl.screenSize},enumerable:!0,configurable:!0}),Object.defineProperty(Renderer.prototype,"defaultPerspectiveCamera",{get:function(){return xl.defaultPerspectiveCamera},enumerable:!0,configurable:!0}),Object.defineProperty(Renderer.prototype,"renderTarget",{get:function(){return xl.currentRenderTarget},set:function(t){var e=gt.context;if(t){if(!t.bind(e))throw"RenderTarget not ready for rendering";xl.currentRenderTarget=t}else e.bindFramebuffer(e.FRAMEBUFFER,null),e.viewport(0,0,this.screenSize.x,this.screenSize.y),xl.currentRenderTarget=null},enumerable:!0,configurable:!0}),Object.defineProperty(Renderer.prototype,"showWireFrame",{get:function(){return xl.showWireFrame},set:function(t){t!==xl.showWireFrame&&(I.instance.forEach(function(t){t.isA(bu)&&t.invalidateProgram()}),xl.showWireFrame=t)},enumerable:!0,configurable:!0}),Renderer}(),Rl=function(){function RendererInternal(){}return RendererInternal.processCanvasDimensions=function(t){var e=t.clientWidth,r=t.clientHeight;0!==e&&0!==r&&(xl.screenSize.set(e,r),xl.uiProjectionMatrix.makeOrthoProjection(0,t.clientWidth,0,t.clientHeight,-100,100),t.width=t.clientWidth,t.height=t.clientHeight)},RendererInternal.create=function(t){bt.instance=new Sl,RendererInternal.processCanvasDimensions(t)},RendererInternal.render=function(t,e,r,n,i){xl.renderPassToDefinitionMapPool.flush(),xl.renderStateBucketMapPool.flush(),xl.shaderToVisualBucketsMapPool.flush(),xl.visualBucketsMapPool.flush(),xl.vertexBufferToVisualsMapPool.flush(),xl.cameraToRenderPassMap.clear();for(var o=0,a=e;o<a.length;o++){var s=a[o];xl.setupCameraRenderPassDefinition(s)}xl.defaultPerspectiveCamera=null,xl.shadowCasters.clear();for(var c=0,u=Aa.ofType(Uu);c<u.length;c++){var l=u[c];if(l.vertexBuffer){for(var f=0,h=e;f<h.length;f++){s=h[f];l.group?s.canRenderGroup(l.group.id)&&xl.addToRenderMap(s,l):xl.addToRenderMap(s,l)}if(l.castShadows){var d=l.vertexBuffer,y=xl.shadowCasters.get(d);y?y.push(l):xl.shadowCasters.set(d,[l])}}}var m=gt.context;xl.lights=Aa.ofType(Ol),xl.cameraToRenderPassMap.size>0?xl.cameraToRenderPassMap.forEach(function(e,i){xl.renderShadowMaps(i),i.setupFrame();var o=i.postEffects,a=o?o.bloom:void 0;if(bt.instance.renderTarget=a?i.sceneRenderTarget:i.renderTarget,!xl.defaultPerspectiveCamera){var s=i.projector;s&&s.isA(Yu)&&(xl.defaultPerspectiveCamera=i)}if(i.clearValue===Fu.Environment&&t)if(t.isA(ru)){var c=t.color;m.clearColor(c.r,c.g,c.b,c.a),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT)}else if(t.isA(nu)){var u=t;m.enable(m.DEPTH_TEST),m.depthMask(!1),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT),(l=ai.materials.sky).queueParameter("projectionMatrix",i.getProjectionMatrix()),l.queueParameter("modelViewMatrix",xl.makeSkyViewMatrix(i)),l.queueParameter("sunPosition",u.sunPosition),l.queueParameter("rayleigh",u.rayleigh),l.queueParameter("turbidity",u.turbidity),l.queueParameter("mieCoefficient",u.mieCoefficient),l.queueParameter("luminance",u.luminance),l.queueParameter("mieDirectionalG",u.mieDirectionalG),l.begin()&&oi.drawVertexBuffer(m,ai.primitives.sphere.vertexBuffer,l.shader)}else if(t.isA(iu)){var l;if((l=t).cubeMap){m.enable(m.DEPTH_TEST),m.depthMask(!1),m.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT);var f=ai.materials.cubeMap;if(f.queueParameter("projectionMatrix",i.getProjectionMatrix()),f.queueParameter("modelViewMatrix",xl.makeSkyViewMatrix(i)),f.queueReferenceParameter("cubemap",l.cubeMap),f.begin()){var h=pi.skyBox;oi.drawVertexBuffer(m,h,f.shader)}}}if(r&&r(i),xl.doRenderPass(e.get(p.Opaque),m,i),xl.doRenderPass(e.get(p.Transparent),m,i),n&&n(i),a){var d=pi.centeredQuad,y=a.render(m,i.sceneRenderTarget,d),v=ai.shaders.compose;v.begin()&&(bt.instance.renderTarget=i.renderTarget,v.applyReferenceParameter("scene",i.sceneRenderTarget),v.applyReferenceParameter("postFX",y),v.applyParameter("postFxIntensity",a.intensity),oi.drawVertexBuffer(m,d,v))}}):(bt.instance.renderTarget=null,r&&e.length>0&&r(e[0]),n&&e.length>0&&n(e[0])),bt.instance.renderTarget=null,m.disable(m.DEPTH_TEST),ai.materials.ui.queueParameter("projectionMatrix",xl.uiProjectionMatrix);for(var v=0,g=Aa.ofType(bc);v<g.length;v++){var _=g[v];_.updateTransforms(),_.render(ai.materials.ui)}i&&i()},RendererInternal.clearDefaultPerspectiveCamera=function(){xl.defaultPerspectiveCamera=null},Object.defineProperty(RendererInternal,"uiProjectionMatrix",{get:function(){return xl.uiProjectionMatrix},enumerable:!0,configurable:!0}),RendererInternal}(),jl=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Tl=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},El=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Bl=function(t){function CenteredQuad(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundingBox=new pt(new H(-1,-1,-.1),new H(1,1,.1)),e}return jl(CenteredQuad,t),CenteredQuad.prototype.getVertexBuffer=function(){return pi.centeredQuad},CenteredQuad.prototype.getBoundingBox=function(){return this._boundingBox},Tl([unserializable(),El("design:type",Object)],CenteredQuad.prototype,"_boundingBox",void 0),CenteredQuad}(as),Al=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Il=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Ml=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},kl=function(t){function Delay(){var e=t.call(this)||this;return e._remainingTime=0,e.createPin("_delay",fe.Input,qe),e}return Al(Delay,t),Delay.prototype.onStart=function(){return this._remainingTime=this._delay.getData(),this._remainingTime>0?or.Continue:or.Finish},Delay.prototype.onUpdate=function(){return this._remainingTime-=nt.deltaTime,this._remainingTime<0?or.Finish:or.Continue},Il([unserializable(),Ml("design:type",qe)],Delay.prototype,"_delay",void 0),Il([unserializable(),Ml("design:type",Object)],Delay.prototype,"_remainingTime",void 0),Delay}(vr),zl=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Fl=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Dl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Nl=function(t){function ModelElement(){var e=t.call(this)||this;return e.userData={},e.children=new Tt(ModelElement),e.transform=new Lt,e}return zl(ModelElement,t),Object.defineProperty(ModelElement.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),ModelElement.prototype.addChild=function(t){this.children.grow(t),t._parent=this},ModelElement.prototype.traverse=function(t){t(this);for(var e=0,r=this.children.data.map(function(t){return t.instance});e<r.length;e++){var n=r[e];n&&n.traverse(t)}},Fl([unserializable(),Dl("design:type",Object)],ModelElement.prototype,"userData",void 0),Fl([Attributes_hidden(),Dl("design:type",Object)],ModelElement.prototype,"children",void 0),Fl([Attributes_hidden(),Dl("design:type",Number)],ModelElement.prototype,"fbxNodeId",void 0),Fl([unserializable(),Dl("design:type",ModelElement)],ModelElement.prototype,"_parent",void 0),ModelElement}(E),Ll=function(t){function ModelMesh(){var e=null!==t&&t.apply(this,arguments)||this;return e.material=new re(Cu),e.mesh=new re(ma),e}return zl(ModelMesh,t),Object.defineProperty(ModelMesh.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),ModelMesh.prototype.destroy=function(){this.material.detach(),this.mesh.detach()},ModelMesh.prototype.upgrade=function(t,e){if(1===e){for(var r={typeName:"ModelElement",data:[]},n=0,i=t.properties.children.data;n<i.length;n++){var o=i[n],a={baseTypeName:"ModelElement",data:{typeName:t.properties.children.typeName}};Object.assign(a.data,o),r.data.push(a)}t.properties.children=r}return t},ModelMesh}(Nl),Vl=function(t){function ModelBone(){var e=null!==t&&t.apply(this,arguments)||this;return e.worldMatrix=new st,e}return zl(ModelBone,t),ModelBone}(Nl),Ul=function(t){function ModelSkinnedMesh(){var e=null!==t&&t.apply(this,arguments)||this;return e._bindMatrix=new st,e._bonesFbxIds=new Rt(Number),e}return zl(ModelSkinnedMesh,t),Object.defineProperty(ModelSkinnedMesh.prototype,"bindMatrix",{get:function(){return this._bindMatrix},set:function(t){this._bindMatrix.copy(t)},enumerable:!0,configurable:!0}),Object.defineProperty(ModelSkinnedMesh.prototype,"boneFbxIds",{get:function(){return this._bonesFbxIds.data.map(function(t){return t.valueOf()})},enumerable:!0,configurable:!0}),ModelSkinnedMesh.prototype.setBones=function(t){this._bonesFbxIds.data.length=0;for(var e=0,r=t;e<r.length;e++){var n=r[e];this._bonesFbxIds.grow(n.fbxNodeId)}},ModelSkinnedMesh}(Ll),Wl=function(t){function Model(){var e=null!==t&&t.apply(this,arguments)||this;return e.fbxScaleFactor=1,e.elements=new Tt(Nl),e._animations=new ne(co),e}return zl(Model,t),Object.defineProperty(Model.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(Model.prototype,"animations",{get:function(){return this._animations.data.map(function(t){return t.asset})},enumerable:!0,configurable:!0}),Object.defineProperty(Model.prototype,"animationRefs",{get:function(){return this._animations},enumerable:!0,configurable:!0}),Model.prototype.findElement=function(t,e){for(var r=e||this.elements.data,n=0;n<r.length;++n){var i=r[n].instance;if(t(i))return{element:i,parentArray:r,indexInParent:n}}for(var o=0,a=r;o<a.length;o++){var s=a[o].instance.children.data,c=this.findElement(t,s);if(c)return c}return null},Model.prototype.clearAnimations=function(){this._animations.data.length=0},Model.prototype.addAnimation=function(t){this._animations.grow(t)},Model.prototype.destroy=function(){for(var e=0,r=this.elements.data;e<r.length;e++){var n=r[e];n.instance&&n.instance.destroy()}t.prototype.destroy.call(this)},Model.prototype.traverse=function(t){for(var e=0,r=this.elements.data.map(function(t){return t.instance});e<r.length;e++){var n=r[e];n&&n.traverse(t)}},Model.prototype.upgrade=function(t,e){if(1===e){for(var r={typeName:"ModelElement",data:[]},n=0,i=t.properties.meshes.data;n<i.length;n++){var o=i[n],a={baseTypeName:"ModelElement",data:{typeName:t.properties.meshes.typeName}};Object.assign(a.data,o),r.data.push(a)}Object.assign(t.properties,{elements:r}),delete t.properties.meshes}return t},Model=Fl([creatable(!1)],Model)}(F),ql=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Gl=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Hl=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Xl=function(t){function AnimationTrack(){var e=null!==t&&t.apply(this,arguments)||this;return e.tokenCache={},e}return ql(AnimationTrack,t),AnimationTrack.prototype.getKeys=function(){return[]},AnimationTrack.prototype.getSample=function(t,e){var r=this.getKeys();if(0!==r.length){var n=r.filter(function(e){return e.time>t});if(n.length===r.length)return n[0].getValue();var i=r.filter(function(e){return e.time<=t});console.assert(i.length>0);var o=i[i.length-1];if(i.length===r.length)return o.getValue();console.assert(n.length>0);var a=n[0],s=(t-o.time)/(a.time-o.time);return o.lerp(o,a,s,e)}},AnimationTrack.prototype.isLoaded=function(){return!0},AnimationTrack.prototype.createKey=function(t,e,r){},AnimationTrack.prototype.removeKey=function(t){},AnimationTrack.prototype.sortByTime=function(t){void 0===t&&(t=!0)},Gl([unserializable(),Hl("design:type",Object)],AnimationTrack.prototype,"tokenCache",void 0),AnimationTrack}(O),Kl=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}();!function(t){t.find=function find(t,e){return t.find(function(t){return t.time===e})}}(Cl||(Cl={}));var Ql,Yl=function(t){function AnimationKey(){return null!==t&&t.apply(this,arguments)||this}return Kl(AnimationKey,t),AnimationKey.prototype.lerp=function(t,e,r,n){},AnimationKey.prototype.getValue=function(){},AnimationKey.prototype.setValue=function(t){},AnimationKey}(O),Zl=function(t){function TAnimationKey(){return null!==t&&t.apply(this,arguments)||this}return Kl(TAnimationKey,t),TAnimationKey.prototype.getValue=function(){return this.value},TAnimationKey.prototype.setValue=function(t){this.value=t},TAnimationKey}(Yl),Jl=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),$l=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},tp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},ep=function(t){function TouchInput(){var e=t.call(this)||this;return e.createPin("_x",fe.Output,qe),e.createPin("_y",fe.Output,qe),e.createPin("_wheelDelta",fe.Output,qe),e.createPin("_button",fe.Output,qe),e.createPin("_isPressed",fe.Output,He),e.createPin("_pressed",fe.Output,Pe),e.createPin("_released",fe.Output,Pe),e.createPin("_moved",fe.Output,Pe),e.createPin("_wheel",fe.Output,Pe),e.createPin("_swipe",fe.Output,Pe),e.createPin("_swipeVelocity",fe.Output,Xe),e}return Jl(TouchInput,t),TouchInput.prototype.onBehaviorStarted=function(){this.onTouchPressed=this.onTouchPressed.bind(this),this.onTouchMoved=this.onTouchMoved.bind(this),this.onTouchReleased=this.onTouchReleased.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),ic.touchPressed.attach(this.onTouchPressed),ic.touchMoved.attach(this.onTouchMoved),ic.touchReleased.attach(this.onTouchReleased),ic.wheelMoved.attach(this.onMouseWheel),this._x.setData(ic.touchX),this._y.setData(ic.touchY)},TouchInput.prototype.destroy=function(){ic.touchPressed.detach(this.onTouchPressed),ic.touchMoved.detach(this.onTouchMoved),ic.touchReleased.detach(this.onTouchReleased),ic.wheelMoved.detach(this.onMouseWheel),t.prototype.destroy.call(this)},TouchInput.prototype.onTouchPressed=function(t){this._x.setData(t.x),this._y.setData(t.y),this._button.setData(t.button),this._isPressed.setData(t.pressed),this.sendSignal(this._pressed.name)},TouchInput.prototype.onTouchMoved=function(t){this._x.setData(t.x),this._y.setData(t.y),this.sendSignal(this._moved.name)},TouchInput.prototype.onTouchReleased=function(t){this._x.setData(t.x),this._y.setData(t.y),this._button.setData(t.button),this._isPressed.setData(t.pressed),t.swipe&&(this._swipeVelocity.value.copy(t.swipeVelocity),this.sendSignal(this._swipe.name)),this.sendSignal(this._released.name)},TouchInput.prototype.onMouseWheel=function(t){this._wheelDelta.setData(t),this.sendSignal(this._wheel.name)},$l([unserializable(),tp("design:type",qe)],TouchInput.prototype,"_x",void 0),$l([unserializable(),tp("design:type",qe)],TouchInput.prototype,"_y",void 0),$l([unserializable(),tp("design:type",qe)],TouchInput.prototype,"_wheelDelta",void 0),$l([unserializable(),tp("design:type",qe)],TouchInput.prototype,"_button",void 0),$l([unserializable(),tp("design:type",He)],TouchInput.prototype,"_isPressed",void 0),$l([unserializable(),tp("design:type",Pe)],TouchInput.prototype,"_pressed",void 0),$l([unserializable(),tp("design:type",Pe)],TouchInput.prototype,"_released",void 0),$l([unserializable(),tp("design:type",Pe)],TouchInput.prototype,"_moved",void 0),$l([unserializable(),tp("design:type",Pe)],TouchInput.prototype,"_wheel",void 0),$l([unserializable(),tp("design:type",Pe)],TouchInput.prototype,"_swipe",void 0),$l([unserializable(),tp("design:type",Xe)],TouchInput.prototype,"_swipeVelocity",void 0),TouchInput=$l([displayName("Touch Input"),tp("design:paramtypes",[])],TouchInput)}(fr),rp=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),np=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},ip=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},op=function(t){function KeyInput(){var e=t.call(this)||this;return e.createPin("_keyCode",fe.Output,qe),e.createPin("_keyDown",fe.Output,Pe),e.createPin("_keyUp",fe.Output,Pe),e}return rp(KeyInput,t),KeyInput.prototype.onBehaviorStarted=function(){this.onKeyChanged=this.onKeyChanged.bind(this),ic.keyChanged.attach(this.onKeyChanged)},KeyInput.prototype.destroy=function(){ic.keyChanged.detach(this.onKeyChanged),t.prototype.destroy.call(this)},KeyInput.prototype.onKeyChanged=function(t){this._keyCode.setData(t.keyCode),t.pressed?this.sendSignal(this._keyDown.name):this.sendSignal(this._keyUp.name)},np([unserializable(),ip("design:type",qe)],KeyInput.prototype,"_keyCode",void 0),np([unserializable(),ip("design:type",Pe)],KeyInput.prototype,"_keyDown",void 0),np([unserializable(),ip("design:type",Pe)],KeyInput.prototype,"_keyUp",void 0),KeyInput=np([displayName("Key Input"),ip("design:paramtypes",[])],KeyInput)}(fr),ap=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),sp=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},cp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},up=function(t){function SphereVolume(e){var r=t.call(this)||this;return r.center=new H,r.radius=1,e&&r.setState(e),r}return ap(SphereVolume,t),SphereVolume.prototype.emitPoint=function(t){return K.sphericalToCartesian(this.radius*Math.random(),K.PI2*Math.random(),Math.PI*Math.random(),t)},SphereVolume.prototype.getCenter=function(t){return t.copy(this.center)},SphereVolume=sp([displayName("Sphere"),cp("design:paramtypes",[Object])],SphereVolume)}(ns),lp=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),pp=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},fp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},hp=function(t){function Billboard(){var e=null!==t&&t.apply(this,arguments)||this;return e.stretched=!1,e._orientMatrix=new st,e._toTarget=new H,e}return lp(Billboard,t),Billboard.prototype.getVertexBuffer=function(){return pi.centeredQuad},Billboard.prototype.getWorldTransform=function(t){return this._orientMatrix},Billboard.prototype.graphicUpdate=function(t,e,r,n,i){return this.stretched?(this._toTarget.copy(n.worldPosition).substract(t.entity.transform.worldPosition),this._orientMatrix.makeLookAt(this._toTarget,t.entity.transform.worldUp).transpose()):this._orientMatrix.makeLookAt(t.entity.transform.worldForward,t.entity.transform.worldUp).transpose(),this._orientMatrix.scale(n.worldScale),this._orientMatrix.setPosition(n.worldPosition),ts.Unchanged},pp([unserializable(),fp("design:type",Object)],Billboard.prototype,"_orientMatrix",void 0),pp([unserializable(),fp("design:type",Object)],Billboard.prototype,"_toTarget",void 0),Billboard}(as),dp=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),yp=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},mp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},vp=function(t){function QuadGeometry(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundingBox=new pt(new H(0,0,-.1),new H(1,1,.1)),e}return dp(QuadGeometry,t),QuadGeometry.prototype.getVertexBuffer=function(){return pi.quad},QuadGeometry.prototype.getBoundingBox=function(){return this._boundingBox},yp([unserializable(),mp("design:type",Object)],QuadGeometry.prototype,"_boundingBox",void 0),QuadGeometry=yp([displayName("Quad")],QuadGeometry)}(as),gp=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),_p=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},bp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},wp=function(t){function Vector2Converter(){var e=t.call(this)||this;return e.createPin("_x",fe.Input,qe),e.createPin("_y",fe.Input,qe),e.createPin("_output",fe.Output,Xe),e}return gp(Vector2Converter,t),Vector2Converter.prototype.convert=function(){this._output.getData().set(this._x.getData(),this._y.getData())},_p([unserializable(),bp("design:type",qe)],Vector2Converter.prototype,"_x",void 0),_p([unserializable(),bp("design:type",qe)],Vector2Converter.prototype,"_y",void 0),_p([unserializable(),bp("design:type",Xe)],Vector2Converter.prototype,"_output",void 0),Vector2Converter=_p([displayName("Vector2"),bp("design:paramtypes",[])],Vector2Converter)}(Dr),Pp=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),xp=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Op=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Cp=function(t){function ScreenToRay(){var e=t.call(this)||this;return e.createComponentReferencePin("_camera",fe.Input,yl),e.createPin("_screenPos",fe.Input,Xe),e.createPin("_ray",fe.Output,Ze),e}return Pp(ScreenToRay,t),ScreenToRay.prototype.convert=function(){var t=this._camera.value.component;if(t||(t=xt.renderer.defaultPerspectiveCamera),t){var e=this._screenPos.value,r=t.getWorldRay(e.x,e.y);r&&this._ray.setData(r)}},xp([unserializable(),Op("design:type",Xe)],ScreenToRay.prototype,"_screenPos",void 0),xp([unserializable(),Op("design:type",tr)],ScreenToRay.prototype,"_camera",void 0),xp([unserializable(),Op("design:type",Ze)],ScreenToRay.prototype,"_ray",void 0),ScreenToRay=xp([displayName("Screen to Ray"),Op("design:paramtypes",[])],ScreenToRay)}(Dr),Sp=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Rp=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},jp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Tp=function(t){function RayCastOnPlane(){var e=t.call(this)||this;return e._plane=new he,e.createPin("_ray",fe.Input,Ze),e.createPin("_planeNormal",fe.Input,Ke),e.createPin("_planeDist",fe.Input,qe),e.createPin("_intersects",fe.Output,He),e.createPin("_intersection",fe.Output,Ke),e}return Sp(RayCastOnPlane,t),RayCastOnPlane.prototype.convert=function(){this._plane.set(this._planeNormal.getData(),this._planeDist.getData());var t=this._ray.getData().castOnPlane(this._plane),e=null!==t.intersection;this._intersects.setData(e),e&&this._intersection.setData(t.intersection)},Rp([unserializable(),jp("design:type",Ze)],RayCastOnPlane.prototype,"_ray",void 0),Rp([unserializable(),jp("design:type",Ke)],RayCastOnPlane.prototype,"_planeNormal",void 0),Rp([unserializable(),jp("design:type",qe)],RayCastOnPlane.prototype,"_planeDist",void 0),Rp([unserializable(),jp("design:type",He)],RayCastOnPlane.prototype,"_intersects",void 0),Rp([unserializable(),jp("design:type",Ke)],RayCastOnPlane.prototype,"_intersection",void 0),Rp([unserializable(),jp("design:type",Object)],RayCastOnPlane.prototype,"_plane",void 0),RayCastOnPlane=Rp([displayName("RayCast on Plane"),jp("design:paramtypes",[])],RayCastOnPlane)}(Dr),Ep=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Bp=function(t){function ParticlesCollisionShape(e){var r=t.call(this)||this;return r.tag="Particles",r._particles=new qt(Is),e&&r.setState(e),r}return Ep(ParticlesCollisionShape,t),Object.defineProperty(ParticlesCollisionShape.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(ParticlesCollisionShape.prototype,"particlesEntity",{set:function(t){this._particles.component=t.getComponent(Is)},enumerable:!0,configurable:!0}),Object.defineProperty(ParticlesCollisionShape.prototype,"particles",{get:function(){return this._particles.component},enumerable:!0,configurable:!0}),ParticlesCollisionShape.prototype.getTestPriority=function(){return ca.Particles},ParticlesCollisionShape.prototype.checkCollisions=function(t,e,r,n){var i=this._particles.component;i&&i.checkCollisions(t,r,n)},ParticlesCollisionShape.prototype.upgrade=function(t,e){return 1===e&&(Object.assign(t.properties,{_particles:t.properties.particles}),delete t.properties.particles),t},ParticlesCollisionShape}(fa),Ap=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ip=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Mp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},kp=function(t){function SpriteGeometry(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprite=new re(qn),e}return Ap(SpriteGeometry,t),SpriteGeometry.prototype.getVertexBuffer=function(){return this._vertexBuffer||(this._vertexBuffer=new Ot,this._vertexBuffer.isDynamic=!0,this._vertexBuffer.primitiveType="TRIANGLES",this._vertexBuffer.setData("position",[]),this._vertexBuffer.setData("uv",[])),this.sprite.asset&&this.sprite.asset.tesselateInWorldUnits(this._vertexBuffer),this._vertexBuffer},SpriteGeometry.prototype.destroy=function(){this._vertexBuffer&&this._vertexBuffer.unload(gt.context),t.prototype.destroy.call(this)},Ip([unserializable(),Mp("design:type",Ot)],SpriteGeometry.prototype,"_vertexBuffer",void 0),SpriteGeometry=Ip([displayName("Sprite")],SpriteGeometry)}(as),zp=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Fp=function(t){function Data(e){var r=t.call(this)||this;return r._pins=new Tt(we),r._declaration=new re(Re),e&&r.setState(e),r.onDeclarationPinChanged=r.onDeclarationPinChanged.bind(r),r.onDeclarationChanged=r.onDeclarationChanged.bind(r),r._declaration.assetChanged.attach(r.onDeclarationChanged),r}return zp(Data,t),Object.defineProperty(Data.prototype,"declaration",{get:function(){return this._declaration.asset},set:function(t){this._declaration.asset=t},enumerable:!0,configurable:!0}),Object.defineProperty(Data.prototype,"declarationId",{get:function(){return this._declaration.id},enumerable:!0,configurable:!0}),Object.defineProperty(Data.prototype,"pins",{get:function(){return this._pins},enumerable:!0,configurable:!0}),Data.prototype.destroy=function(){this.declaration&&this.declaration.pinChanged.detach(this.onDeclarationPinChanged),this._declaration.detach(),t.prototype.destroy.call(this)},Data.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r),e===Data.pinsPropertyKey&&Bc.updatePinAccessors(this)},Data.prototype.getPins=function(){return this._pins},Data.prototype.setPins=function(t){this._pins=t},Data.prototype.findPinByName=function(t){return this._pins.data.map(function(t){return t.instance}).find(function(e){return e.name===t})},Data.prototype.isLoaded=function(){if(!t.prototype.isLoaded.call(this))return!1;for(var e=0,r=this._pins.data;e<r.length;e++){var n=r[e];if(!Bc.isPinLoaded(n.instance))return!1}return!0},Data.prototype.onDeclarationPinChanged=function(t){Bc.buildPins(this,this.declaration)},Data.prototype.onDeclarationChanged=function(t){var e=t.oldAsset;e&&e.pinChanged.detach(this.onDeclarationPinChanged);var r=t.newAsset;r&&(Bc.buildPins(this,r),r.pinChanged.attach(this.onDeclarationPinChanged))},Data.pinsPropertyKey="_pins",Data}(kt),Dp=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Np=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Lp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Vp=function(t){function DynamicGeometry(){return null!==t&&t.apply(this,arguments)||this}return Dp(DynamicGeometry,t),Object.defineProperty(DynamicGeometry.prototype,"vertexBuffer",{get:function(){return this._vb},set:function(t){this._vb=t},enumerable:!0,configurable:!0}),DynamicGeometry.prototype.getVertexBuffer=function(){return this._vb},DynamicGeometry.prototype.getBoundingBox=function(){if(!this._boundingBox&&this._vb){var t=this._vb,e=t.data,r=t.primitiveType,n=t.indices;this._boundingBox=pt.fromVertexArray(e.position,r,n)}return this._boundingBox},Np([unserializable(),Lp("design:type",Ot)],DynamicGeometry.prototype,"_vb",void 0),Np([unserializable(),Lp("design:type",pt)],DynamicGeometry.prototype,"_boundingBox",void 0),DynamicGeometry}(as),Up=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Wp=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a};!function(t){t.diffuseKey="diffuse",t.diffuseMapKey="diffuseMap"}(Ql||(Ql={}));var qp,Gp=function(t){function PhongShader(){return null!==t&&t.apply(this,arguments)||this}return Up(PhongShader,t),PhongShader.prototype.loadInstance=function(e,r,n,i,o,a){if(!t.prototype.loadInstance.call(this,e,r,n,i,o,a))return!1;for(var s=r.params,c=r.program,u={"directionalLight.direction":{type:"vec3",uniformLocation:null},"directionalLight.color":{type:"vec4",uniformLocation:null},"directionalLight.shadow":{type:"bool",uniformLocation:null},"directionalLight.shadowBias":{type:"float",uniformLocation:null},"directionalLight.shadowRadius":{type:"float",uniformLocation:null},"directionalLight.shadowMapSize":{type:"vec2",uniformLocation:null}},l=0,p=Object.keys(u);l<p.length;l++){var f=p[l],h=e.getUniformLocation(c,f);u[f].uniformLocation=h,console.assert(null!==h,"getUniformLocation("+f+") failed in shader '"+this.templatePath+"'")}return Object.assign(s,u),!0},PhongShader=Wp([displayName("Phong Shader")],PhongShader)}(bu),Hp=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Xp=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Kp=function(t){function GamepadData(){var e=null!==t&&t.apply(this,arguments)||this;return e._data={},e}return Hp(GamepadData,t),Object.defineProperty(GamepadData.prototype,"version",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(GamepadData.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,this.save()},enumerable:!0,configurable:!0}),GamepadData.prototype.serialize=function(){return{typeName:this.constructor.name,version:this.version,id:this.id,name:this.name,data:this._data}},GamepadData.prototype.deserialize=function(t){var e=t;return this.id=e.id,this.name=e.name,this._data=e.data,Promise.resolve(this)},GamepadData=Xp([displayName("Gamepad Data")],GamepadData)}(F),Qp=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Yp=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Zp=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Jp=function(t){function GamepadRecorder(){var e=t.call(this)||this;return e.createPin("_frameSkip",fe.Input,qe),e.createPin("_gamePadIndex",fe.Input,qe),e.createAssetPin("_dataStore",fe.Input,Kp),e}return Qp(GamepadRecorder,t),GamepadRecorder.prototype.onStart=function(){return this._data={},or.Continue},GamepadRecorder.prototype.onUpdate=function(){var t=this._frameSkip.value+1,e=nt.currentFrame;if(e%t==0){var r=this._gamePadIndex.value,n=zo.get(r);n&&(this._data[e]={buttons:n.buttons.map(function(t){return t}),axes:JSON.parse(JSON.stringify(n.axes))})}return or.Continue},GamepadRecorder.prototype.destroy=function(){var t=this._dataStore.value.asset;t&&(t.data=this._data)},Yp([unserializable(),Zp("design:type",qe)],GamepadRecorder.prototype,"_frameSkip",void 0),Yp([unserializable(),Zp("design:type",qe)],GamepadRecorder.prototype,"_gamePadIndex",void 0),Yp([unserializable(),Zp("design:type",ir)],GamepadRecorder.prototype,"_dataStore",void 0),Yp([unserializable(),Zp("design:type",Object)],GamepadRecorder.prototype,"_data",void 0),GamepadRecorder=Yp([displayName("Gamepad Recorder"),Zp("design:paramtypes",[])],GamepadRecorder)}(vr),$p=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),tf=function(t){function Proxy(){return null!==t&&t.apply(this,arguments)||this}return $p(Proxy,t),Proxy}(kt),ef=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),rf=function(t){function NumberKey(){return null!==t&&t.apply(this,arguments)||this}return ef(NumberKey,t),NumberKey.prototype.setValue=function(t){this.value=t},NumberKey.prototype.lerp=function(t,e,r){return K.lerp(t.value,e.value,r)},NumberKey}(Zl),nf=function(t){function BooleanKey(){return null!==t&&t.apply(this,arguments)||this}return ef(BooleanKey,t),BooleanKey.prototype.lerp=function(t,e,r){return t.value},BooleanKey}(Zl),of=function(t){function StringKey(){return null!==t&&t.apply(this,arguments)||this}return ef(StringKey,t),StringKey.prototype.lerp=function(t,e,r){return t.value},StringKey}(Zl),af=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),sf=function(t){function ColorKey(){return null!==t&&t.apply(this,arguments)||this}return af(ColorKey,t),ColorKey.prototype.lerp=function(t,e,r,n){return Z.lerp(t.value,e.value,r,n)},ColorKey.prototype.setValue=function(t){this.value=new Z(t.r,t.g,t.b,t.a)},ColorKey}(Zl),cf=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),uf=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},lf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},pf=function(t){function AssetKey(){return null!==t&&t.apply(this,arguments)||this}return cf(AssetKey,t),AssetKey.prototype.lerp=function(t,e,r){return t.assetRef?t.assetRef.asset:null},AssetKey.prototype.initializeReference=function(e,r,n){var i=this;t.prototype.setValue.call(this,e),this.assetRef||(this.assetRef=x.instance.createAssetReference(r),this.assetRef.state=Qt.Loading),void 0!==e?I.instance.loadObjectById(e).then(function(t){i.assetRef.asset=t[0],n()}):(this.assetRef.asset=null,n())},AssetKey.prototype.isLoaded=function(){return S.isAssetRefLoaded(this.assetRef)},AssetKey.prototype.getValue=function(){return this.assetRef.asset},uf([unserializable(),lf("design:type",re)],AssetKey.prototype,"assetRef",void 0),AssetKey}(Zl),ff=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),hf=function(t){function SingleTrack(e){var r=t.call(this)||this;return r.keys=new Rt(e),r.internalCreateKey=function(){return new e},r}return ff(SingleTrack,t),Object.defineProperty(SingleTrack.prototype,"version",{get:function(){return 2},enumerable:!0,configurable:!0}),SingleTrack.prototype.getKeys=function(){return this.keys.data},SingleTrack.prototype.createKey=function(t,e,r){var n=Cl.find(this.keys.data,t);n?n.setValue(e):((n=this.internalCreateKey()).time=t,n.setValue(e),this.keys.grow(n),this.sortByTime()),r&&r(n)},SingleTrack.prototype.removeKey=function(t){for(var e=0;e<this.keys.data.length;++e)if(this.keys.data[e]===t){this.keys.data.splice(e,1);break}},SingleTrack.prototype.sortByTime=function(t){if(void 0===t&&(t=!0),this.keys.data.sort(function(t,e){return t.time-e.time}),t)for(var e=0;e<this.keys.data.length-1;){var r=this.keys.data[e],n=this.keys.data[e+1];r.time===n.time?this.keys.data.splice(e,1):++e}},SingleTrack.prototype.serialize=function(){return{typeName:this.constructor.name,version:this.version,times:this.keys.data.map(function(t){return t.time}),values:this.keys.data.map(function(t){return t.value})}},SingleTrack.prototype.deserialize=function(t){1===t.version&&console.assert(!1);for(var e=t,r=0;r<e.times.length;++r){var n=this.internalCreateKey();n.time=e.times[r],n.setValue(e.values[r]),this.keys.grow(n)}return Promise.resolve(this)},SingleTrack}(Xl),df=function(t){function BooleanTrack(){return t.call(this,nf)||this}return ff(BooleanTrack,t),BooleanTrack}(hf),yf=function(t){function StringTrack(){return t.call(this,of)||this}return ff(StringTrack,t),StringTrack}(hf),mf=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),vf=function(t){function NumberTrack(){return t.call(this,rf)||this}return mf(NumberTrack,t),Object.defineProperty(NumberTrack.prototype,"version",{get:function(){return 3},enumerable:!0,configurable:!0}),NumberTrack.prototype.getSample=function(t){var e=this.getKeys();if(0!==e.length){var r=e.filter(function(e){return e.time>t});if(r.length===e.length)return r[0].value;var n=e.filter(function(e){return e.time<=t});console.assert(n.length>0);var i=n[n.length-1];if(n.length===e.length)return i.value;console.assert(r.length>0);var o=r[0],a=(t-i.time)/(o.time-i.time);return i.lerp(i,o,a)}},NumberTrack.prototype.serialize=function(){return{typeName:this.constructor.name,version:this.version,times:this.keys.data.map(function(t){return[t.time,t.tangents[0][0],t.tangents[1][0]]}),values:this.keys.data.map(function(t){return[t.value,t.tangents[0][1],t.tangents[1][1]]})}},NumberTrack.prototype.deserialize=function(t){if(1===t.version)console.assert(!1);else if(2===t.version){var e=t,r=e.times,n=e.values;Object.assign(t,{times:r.map(function(t){return[t,t,t]}),values:n.map(function(t){return[t,t,t]})})}for(var i=t,o=0;o<i.times.length;++o){var a=this.internalCreateKey();a.time=i.times[o][0],a.setValue(i.values[o][0]),a.tangents=[[i.times[o][1],i.values[o][1]],[i.times[o][2],i.values[o][2]]],this.keys.grow(a)}return Promise.resolve(this)},NumberTrack}(hf),gf=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),_f=function(t){function AnimationSubTrackDefinition(e,r){var n=t.call(this)||this;return n.componentId=e||"",n.track=r||new a(vf),n}return gf(AnimationSubTrackDefinition,t),AnimationSubTrackDefinition}(O),bf=function(t){function CompositeTrack(){var e=null!==t&&t.apply(this,arguments)||this;return e.tracks=new Rt(_f),e}return gf(CompositeTrack,t),CompositeTrack.prototype.getSample=function(t,e){for(var r=0,n=this.tracks.data;r<n.length;r++){var i=n[r],o=i.track.instance.getSample(t);void 0!==o&&(e[i.componentId]=o)}return e},CompositeTrack}(Xl),wf=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Pf=function(t){function AssetTrack(e){var r=t.call(this,pf)||this;return r._typeName=e,r}return wf(AssetTrack,t),Object.defineProperty(AssetTrack.prototype,"typeName",{get:function(){return this._typeName},enumerable:!0,configurable:!0}),AssetTrack.prototype.createKey=function(t,e,r){var n=Cl.find(this.keys.data,t);if(n)n.initializeReference(e,this._typeName,function(){r&&r(n)});else{var i=this.internalCreateKey();i.time=t,this.keys.grow(i),this.sortByTime(),i.initializeReference(e,this._typeName,function(){r&&r(i)})}},AssetTrack.prototype.isLoaded=function(){if(!this._typeName)return!1;if(this.keys)for(var t=0,e=this.keys.data;t<e.length;t++){if(!e[t].isLoaded())return!1}return!0},AssetTrack.prototype.serialize=function(){var e=t.prototype.serialize.call(this);return Object.assign(e,{_typeName:this._typeName}),e},AssetTrack.prototype.deserialize=function(e){1===e.version?this._typeName=e.properties._typeName.data:this._typeName=e._typeName,t.prototype.deserialize.call(this,e);for(var r=0,n=this.keys.data;r<n.length;r++){var i=n[r];i.initializeReference(i.value,this.typeName,function(){})}return Promise.resolve(this)},AssetTrack}(hf),xf=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Of=function(t){function ColorTrack(){return t.call(this,sf)||this}return xf(ColorTrack,t),ColorTrack.prototype.createKey=function(t,e,r){var n=Cl.find(this.keys.data,t);n?n.getValue().copy(e):((n=this.internalCreateKey()).time=t,n.setValue((new Z).copy(e)),this.keys.grow(n),this.sortByTime()),r&&r(n)},ColorTrack.prototype.getSample=function(t,e){var r=this.getKeys();if(0!==r.length&&e){var n=r.filter(function(e){return e.time>t});if(n.length===r.length)return e.copy(n[0].getValue());var i=r.filter(function(e){return e.time<=t});console.assert(i.length>0);var o=i[i.length-1];if(i.length===r.length)return e.copy(o.getValue());var a=n[0],s=(t-o.time)/(a.time-o.time);return o.lerp(o,a,s,e)}},ColorTrack}(hf),Cf=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Sf=function(t){function RotationTrack(){var e=t.call(this)||this;return e.eulerOrder="YXZ",e.tracks.grow(new _f("x",new a(vf,new vf))),e.tracks.grow(new _f("y",new a(vf,new vf))),e.tracks.grow(new _f("z",new a(vf,new vf))),e}return Cf(RotationTrack,t),RotationTrack.prototype.getSample=function(t,e){var r=this.tracks.data[0].track.instance,n=this.tracks.data[1].track.instance,i=this.tracks.data[2].track.instance;return e.setFromEulerAngles(r.getSample(t)||0,n.getSample(t)||0,i.getSample(t)||0,this.eulerOrder)},RotationTrack}(bf),Rf=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),jf=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Tf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};(qp||(qp={})).meshPropertyKey="mesh";var Ef,Bf=function(t){function MeshParticle(){var e=t.call(this)||this;return e.mesh=new re(ma),e.scale=new H(1,1,1),e.onMeshChanged=e.onMeshChanged.bind(e),e.mesh.assetChanged.attach(e.onMeshChanged),e}return Rf(MeshParticle,t),MeshParticle.prototype.tesselate=function(t,e,r){var n=this.mesh.asset?this.mesh.asset.vertexBuffer:null;if(n)for(var i=n.getData("position"),o=0;o<n.vertexCount;++o){var a=3*o,s=e+a;t[s+0]=i[a+0]*r*this.scale.x,t[s+1]=i[a+1]*r*this.scale.y,t[s+2]=i[a+2]*r*this.scale.z}},MeshParticle.prototype.getUvs=function(t,e){var r=this.mesh.asset?this.mesh.asset.vertexBuffer:null;if(r)for(var n=r.getData("uv"),i=2*r.vertexCount,o=0;o<i;++o)t[e+o]=n[o]},MeshParticle.prototype.makeLocalTransform=function(t,e){},MeshParticle.prototype.makeParticleTransform=function(t,e){t.makeLookAt(e.normalize(),H.up).transpose()},MeshParticle.prototype.vertexCount=function(){return this.mesh.asset?this.mesh.asset.vertexBuffer.vertexCount:0},MeshParticle.prototype.setProperty=function(e,r){t.prototype.setProperty.call(this,e,r),this.onPropertyChanged&&this.onPropertyChanged(e)},MeshParticle.prototype.destroy=function(){this.mesh.detach()},MeshParticle.prototype.onMeshChanged=function(t){this.onPropertyChanged&&this.onPropertyChanged(qp.meshPropertyKey)},MeshParticle=jf([displayName("Mesh"),Tf("design:paramtypes",[])],MeshParticle)}(cs),Af=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),If=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Mf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},kf=function(t){function BoxGeometry(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundingBox=new pt(new H(-1,-1,-1),new H(1,1,1)),e}return Af(BoxGeometry,t),BoxGeometry.prototype.getVertexBuffer=function(){return ai.primitives.box.vertexBuffer},BoxGeometry.prototype.getBoundingBox=function(){return this._boundingBox},If([unserializable(),Mf("design:type",Object)],BoxGeometry.prototype,"_boundingBox",void 0),BoxGeometry=If([displayName("Box")],BoxGeometry)}(as),zf=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Ff=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Df=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Nf=function(t){function SphereGeometry(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundingBox=new pt(new H(-1,-1,-1),new H(1,1,1)),e}return zf(SphereGeometry,t),SphereGeometry.prototype.getVertexBuffer=function(){return ai.primitives.sphere.vertexBuffer},SphereGeometry.prototype.getBoundingBox=function(){return this._boundingBox},Ff([unserializable(),Df("design:type",Object)],SphereGeometry.prototype,"_boundingBox",void 0),SphereGeometry=Ff([displayName("Sphere")],SphereGeometry)}(as),Lf=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Vf=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Uf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Wf=function(t){function PlaneGeometry(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundingBox=new pt(new H(-1,-.1,-1),new H(1,.1,1)),e}return Lf(PlaneGeometry,t),PlaneGeometry.prototype.getVertexBuffer=function(){return ai.primitives.plane.vertexBuffer},PlaneGeometry.prototype.getBoundingBox=function(){return this._boundingBox},Vf([unserializable(),Uf("design:type",Object)],PlaneGeometry.prototype,"_boundingBox",void 0),PlaneGeometry=Vf([displayName("Plane")],PlaneGeometry)}(as),qf=function(){var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(e,r)};return function(e,r){function __(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(__.prototype=r.prototype,new __)}}(),Gf=function(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a},Hf=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},Xf=function(t){function ConeGeometry(){var e=null!==t&&t.apply(this,arguments)||this;return e._boundingBox=new pt(new H(-1,-1,-1),new H(1,1,1)),e}return qf(ConeGeometry,t),ConeGeometry.prototype.getVertexBuffer=function(){return ai.primitives.cone.vertexBuffer},ConeGeometry.prototype.getBoundingBox=function(){return this._boundingBox},Gf([unserializable(),Hf("design:type",Object)],ConeGeometry.prototype,"_boundingBox",void 0),ConeGeometry=Gf([displayName("Cone")],ConeGeometry)}(as),Kf=function(){function TypeRegistration(){}return TypeRegistration.registerDefaultTypes=function(){var t=x.instance;t.registerObject(O),t.registerObject(E,O),t.registerObject(Xc,E),t.registerObject(Ya,O),t.registerObject(F,E),t.registerObject(cu,F),t.registerObject(Be,F),t.registerObject(kt,O,!0),t.registerObject(Lt,kt),t.registerObject(yl,kt),t.registerObject(Tu,kt),t.registerObject(cl,Ya),t.registerObject(Yu,Ya),t.registerObject(Go,E),t.registerObject(tf,kt),t.registerObject(Po,O),t.registerObject(xo,Po),t.registerObject(Oo,Po),t.registerObject(Uu,kt),t.registerObject(as,O),t.registerObject(Bl,as),t.registerObject(vp,as),t.registerObject(Ru,as),t.registerObject(Du,Ru),t.registerObject(hp,as),t.registerObject(kp,as),t.registerObject(Vp,as),t.registerObject(kf,as),t.registerObject(Nf,as),t.registerObject(Wf,as),t.registerObject(Xf,as),t.registerObject(bs,F),t.registerObject(Cu,F),t.registerObject(q,F),t.registerObject(bu,q),t.registerObject(Gp,bu),t.registerObject(En,q),t.registerObject(Dn,En),t.registerObject(Hu,En),t.registerObject(Di,En),t.registerObject(Iu,En),t.registerObject(qa,En),t.registerObject(Zc,q),t.registerObject(ma,q),t.registerObject(Wl,F),t.registerObject(Nl,E),t.registerObject(Ll,Nl),t.registerObject(Ul,Ll),t.registerObject(Vl,Nl),t.registerObject(ns,O),t.registerObject(up,ns),t.registerObject(vs,ns),t.registerObject(Ol,kt),t.registerObject(bl,O),t.registerObject(wl,bl),t.registerObject(Es,O),t.registerObject(Bs,Es),t.registerObject(As,Es),t.registerObject(eu,O),t.registerObject(ru,eu),t.registerObject(nu,eu),t.registerObject(iu,eu),t.registerObject($,O),t.registerObject(et,$),t.registerObject(tt,$),t.registerObject(il,O),t.registerObject(tl,O),t.registerObject(el,tl),t.registerObject(rl,O),t.registerObject(nl,rl),t.registerObject(es,kt),t.registerObject(Is,kt),t.registerObject(hs,as),t.registerObject(cs,O),t.registerObject(xs,cs),t.registerObject(Bf,cs),t.registerObject(Ba,kt),t.registerObject(Ra,F),t.registerObject(fa,O),t.registerObject(Pa,fa),t.registerObject(Oa,fa),t.registerObject(Bp,fa),t.registerObject(ga,fa),t.registerObject(Ma,fa),t.registerObject(qs,fa),t.registerObject(er,xe),t.registerObject(Us,kt),t.registerObject(Js,kt),t.registerObject(_i,kt),t.registerObject(Yi,kt),t.registerObject(Sn,kt),t.registerObject(rc,_i),t.registerObject(to,_i),t.registerObject(uc,_i),t.registerObject(Hi,_i),t.registerObject(bc,kt),t.registerObject(qn,F),t.registerObject(Kn,F),t.registerObject(Jn,O),t.registerObject($n,Jn),t.registerObject(ti,Jn),t.registerObject(ei,Jn),t.registerObject(ri,Jn),t.registerObject(ni,Jn),t.registerObject(ii,ni),t.registerObject(Hr,fr),t.registerObject(wi,O),t.registerObject(Ii,O),t.registerObject(Mi,Ii),t.registerObject(Ui,wi),t.registerObject(Ti,wi),t.registerObject(Oi,F),t.registerObject(hc,O),t.registerObject(dc,hc),t.registerObject(Re,F),t.registerObject(kc,F),t.registerObject(mn,kt),t.registerObject(Fp,kt),t.registerObject(ln,F),t.registerObject(fr,O),t.registerObject(vr,fr),t.registerObject(Dr,fr),t.registerObject(tn,Dr),t.registerObject(on,O),t.registerObject(Mr,vr),t.registerObject(Er,vr),t.registerObject(Ur,fr),t.registerObject(Sr,F),t.registerObject(Yr,Sr),t.registerObject(zr,O),t.registerObject(be,O),t.registerObject(we,O),t.registerObject(Pe,we),t.registerObject(xe,we,!0),t.registerObject(qe,xe),t.registerObject(Ge,xe),t.registerObject(He,xe),t.registerObject(Xe,xe),t.registerObject(Ke,xe),t.registerObject(Ze,xe),t.registerObject(Qe,xe),t.registerObject(Ye,xe),t.registerObject($e,xe),t.registerObject(tr,xe),t.registerObject(ir,xe),t.registerObject(Je,xe),t.registerObject(nr,xe),t.registerObject(rr,xe),t.registerObject(co,F),t.registerObject(Xl,O),t.registerObject(Yl,O),t.registerObject(io,O),t.registerObject(_f,O),t.registerObject(bf,Xl),t.registerObject(vf,Xl),t.registerObject(df,Xl),t.registerObject(yf,Xl),t.registerObject(Pf,Xl),t.registerObject(Of,Xl),t.registerObject(Sf,bf),t.registerObject(rf,Yl),t.registerObject(nf,Yl),t.registerObject(of,Yl),t.registerObject(sf,Yl),t.registerObject(pf,Yl),t.registerObject(bo,kt),t.registerObject(fo,O),t.registerObject(kl,vr),t.registerObject(op,fr),t.registerObject(ep,fr),t.registerObject(Tp,Dr),t.registerObject(Cp,Dr),t.registerObject(wp,Dr),t.registerObject(Jp,vr),t.registerObject(Kp,F)},TypeRegistration}();!function(t){t.objectRegister={},t.getObjectInfo=function getObjectInfo(e){return e in t.objectRegister?t.objectRegister[e]:(V.logError("Unknown object type: "+e),null)}}(Ef||(Ef={}));var Qf,Yf,Zf=function(){function Factory(){}return Factory.prototype.registerObject=function(t,e,r){Ef.objectRegister[t.name]={createInstance:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new(t.bind.apply(t,[void 0].concat(e)))},createReference:function(e){return new a(t,e)},createAssetReference:function(){return new re(t)},createComponentReference:function(){return new qt(t,void 0)},createObjectArray:function(e){return new Rt(t,e)},createReferenceArray:function(e){return new Tt(t,e)},createAssetReferenceArray:function(e){return new ne(t,e)}},r&&(Ef.objectRegister[t.name].isAbstract=r),e&&m.registerRawTypeInfo(e.name,t.name)},Factory.prototype.createObject=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var n=Ef.getObjectInfo(t);return n&&!n.isAbstract?n.createInstance.apply(n,e):null},Factory.prototype.createReference=function(t,e){var r=Ef.getObjectInfo(t);return r?r.createReference(e):null},Factory.prototype.createAssetReference=function(t){var e=Ef.getObjectInfo(t);return e?e.createAssetReference():null},Factory.prototype.createAssetReferenceArray=function(t,e){var r=Ef.getObjectInfo(t);return r?r.createAssetReferenceArray(e):null},Factory.prototype.createComponentReference=function(t){var e=Ef.getObjectInfo(t);return e?e.createComponentReference():null},Factory.prototype.createObjectArray=function(t,e){var r=Ef.getObjectInfo(t);return r?r.createObjectArray(e):null},Factory.prototype.createReferenceArray=function(t,e){var r=Ef.getObjectInfo(t);return r?r.createReferenceArray(e):null},Factory.prototype.isAbstract=function(t){if(t in Ef.objectRegister){var e=Ef.objectRegister[t].isAbstract;return void 0!==e&&e}return!1},Factory}(),Jf=function(){function FactoryInternal(){}return FactoryInternal.create=function(t){var e=new Zf;x.instance=e,Kf.registerDefaultTypes(),t&&t.forEach(function(t){var r=t[0],n=t[1];return e.registerObject(r,n)}),m.buildTypeTree()},FactoryInternal}(),$f=function(){function Serializer(){}return Serializer.prototype.copyVertexBuffer=function(t){var e=ye.properties.VertexBuffer.writeProperty(t);return ye.properties.VertexBuffer.readProperty(JSON.parse(JSON.stringify(e)))},Serializer.prototype.serializeObject=function(t){return Lc.serializeObject(t)},Serializer.prototype.deserializeObject=function(t,e){Lc.deserializeObject(t,e)},Serializer}();!function(t){(Qf||(Qf={})).create=function create(){w.instance=new $f}}(),(Yf||(Yf={})).requests={};var th,eh=function(){function WebUtils(){}return WebUtils.request=function(t,e,r,n,i,o,a){var s=t+"_"+e,c=new XMLHttpRequest;if(c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE){var t=null;s in Yf.requests&&(t=Yf.requests[s],delete Yf.requests[s]),t&&(200===c.status||0===c.status?t&&("blob"===o?t.onSuccess(c.response):t.onSuccess(c.responseText)):t.onError(c.statusText))}},c.upload.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;WebUtils.uploadProgressChanged.post(e)}},c.onprogress=function(t){if(t.lengthComputable){var e=t.loaded/t.total*100;WebUtils.downloadProgressChanged.post(e)}},o&&(c.responseType=o),Yf.requests[s]={request:c,onSuccess:r,onError:n},c.open(t,e,!0),a)for(var u=0,l=Object.keys(a);u<l.length;u++){var p=l[u];c.setRequestHeader(p,a[p])}return c.send(i),s},WebUtils.abortRequest=function(t){var e=Yf.requests[t],r=e?e.request:null;r&&(delete Yf.requests[t],r.abort())},WebUtils.downloadProgressChanged=new B.AsyncEvent,WebUtils.uploadProgressChanged=new B.AsyncEvent,WebUtils}(),rh=function(){function DOMUtils(){}return DOMUtils.getWheelDelta=function(t,e){return 1===e?32*t:2===e?32*t*10:t},DOMUtils}();!function(t){t.translateEntityRef=function translateEntityRef(t,e,r){return!!(t.id&&t.id in e)&&(t.id=e[t.id],!0)},t.translateComponentRef=function translateComponentRef(t,e){return!!(t.entityId&&t.entityId in e)&&(t.entityId=e[t.entityId],!0)},t.recordTranslatedReference=function recordTranslatedReference(t,e,r,n,i){t&&(e in t||(t[e]={}),r in t[e]||(t[e][r]=[]),t[e][r][n]=i)},t.invParentMatrix=new st,t.localScale=new H}(th||(th={}));var nh,ih=function(){function EntityUtils(){}return EntityUtils.prototype.preserveWorldPosition=function(t,e){var r=t.transform;if(r){(s=e.transform?e.transform.worldMatrix:null)||(s=st.identity);var n=th.invParentMatrix,i=r.worldMatrix;n.copy(s).invert(),r.position.setFromMatrix(i).transform(n);var o=r.worldScale;n.getScale(r.scale),r.scale.x*=o.x,r.scale.y*=o.y,r.scale.z*=o.z,n.multiply(i).getRotation(r.rotation)}else{var a=t.getComponent(Sn);if(a){var s,c=e.getComponent(Sn);if(s=c?c.worldMatrix:null)s.translateFromCoords(-c.pivot.x*c.actualWidth,-c.pivot.y*c.actualHeight,0);else{var u=e.getComponent(bc);u&&(s=st.fromPool().copy(st.identity).translateFromCoords(u.offset.x,u.offset.y,0))}if(s){n=th.invParentMatrix;var l=th.localScale;i=a.worldMatrix;a.horizontalAlignment=yn.Left,a.verticalAlignment=vn.Top,a.margin.set(0,0,0,0),n.copy(s).invert(),a.offset.setFromMatrix(i).transform(n);o=a.absoluteScale;n.getScale(l),l.x*=o.x,l.y*=o.y,a.scale.set(l.x,l.y),n.multiply(i).getRotation(a.rotation)}}}},EntityUtils.prototype.updateLayoutMatrixIfNecessary=function(t){var e=this;t.traverse(function(t){var r=t.getComponent(Sn);return!!r&&(e.updateLayoutWorldMatrix(r),!0)},!0)},EntityUtils.prototype.dirtifyWorldMatrixIfNecessary=function(t){var e=t.transform;e&&e.dirtifyWorldMatrix()},EntityUtils.prototype.updateLayoutWorldMatrix=function(t){var e=t.entity.getAncestorOfType(bc);e&&lc.updateLayoutWorldMatrix(t,e.getResolution(bt.instance.screenSize),e.offset)},EntityUtils.prototype.translateReferences=function(t,e,r){t.traverse(function(t){return t.iterateComponents(function(n){for(var i=0,o=Object.keys(n);i<o.length;i++){var a=o[i],s=Lc.getSerializablePropertyTypeName(n,a);if("EntityReference"===s){var c=n[a];th.translateEntityRef(c,e)&&th.recordTranslatedReference(r,t.id,n.constructor.name,a,c)}else if("ComponentReference"===s){var u=n[a];th.translateComponentRef(u,e)&&th.recordTranslatedReference(r,t.id,n.constructor.name,a,u)}else if("ReferenceArray"===s)for(var l=n[a],p=0,f=l.data;p<f.length;p++){var h=f[p].instance;if(h)for(var d=0,y=Object.keys(h);d<y.length;d++){var m=y[d],v=Lc.getSerializablePropertyTypeName(h,m);if("EntityReference"===v){c=h[m];th.translateEntityRef(c,e)&&th.recordTranslatedReference(r,t.id,n.constructor.name,a,l)}else if("ComponentReference"===v){u=h[m];th.translateComponentRef(u,e)&&th.recordTranslatedReference(r,t.id,n.constructor.name,a,l)}}}else if("_geometry"===a&&"Reference"===s){var g=n[a];if(g.instance&&g.instance.isA(Du)){c=g.instance[Du.skeletonPropertyKey];th.translateEntityRef(c,e)&&th.recordTranslatedReference(r,t.id,n.constructor.name,a,n[a])}}}}),!0},!0)},EntityUtils}();!function(t){(nh||(nh={})).create=function create(){Uc.instance=new ih}}();var oh,ah,sh,ch=function(){return(ch=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};!function(t){t.canvasResized=!1,t.playRequestId=null,t.engineActive=!1,t.keysDown=new Map,t.onDownloadProgressChanged=function onDownloadProgressChanged(e){t.engineConfig.onDownloadProgress&&t.engineConfig.onDownloadProgress(e,!1)},t.createFileInterface=function createFileInterface(){var e=!1,n=Boolean(t.engineConfig.startupUrl)?r(102).FileInMemory:(e=!0,r(103).FileStandaloneWeb);return console.assert(n),e?r.e(0).then(r.t.bind(null,105,3)).then(function(t){return t}).then(function(t){var e=t.default,r=Object.entries(e).reduce(function(t,e){var r,n=e[0],i=e[1];return ch({},t,((r={})["Assets/DefaultAssets/"+n]=JSON.stringify(i),r))},{});Pt.instance=new n(r)}):(Pt.instance=new n,Promise.resolve())},t.downloadPlayableProject=function downloadPlayableProject(e){return new Promise(function(r,n){console.assert(!t.playRequestId),t.playRequestId=eh.request("GET",e,function(e){t.engineConfig.onDownloadProgress&&t.engineConfig.onDownloadProgress(100,!0),eh.downloadProgressChanged.detach(t.onDownloadProgressChanged),Ko.importGameFromBlob(e,function(){return r()},n)},function(){return eh.downloadProgressChanged.detach(t.onDownloadProgressChanged)},void 0,"blob"),eh.downloadProgressChanged.attach(t.onDownloadProgressChanged)})}}(oh||(oh={})),function(t){function onTouchEnd(t){t.preventDefault();for(var e=0;e<t.changedTouches.length;++e){var r=oh.targetCanvas.getBoundingClientRect(),n=t.changedTouches[e];oc.onTouchUp(n.clientX-r.left,n.clientY-r.top,0);break}}t.onWindowResized=function onWindowResized(){oh.targetCanvas&&(Rl.processCanvasDimensions(oh.targetCanvas),oh.canvasResized=!0)},t.onMouseDown=function onMouseDown(t){var e=oh.targetCanvas.getBoundingClientRect();oc.onTouchDown(t.clientX-e.left,t.clientY-e.top,t.button),t.preventDefault()},t.onMouseWheel=function onMouseWheel(t){var e=rh.getWheelDelta(t.deltaY,t.deltaMode);oc.onMouseWheel(e),t.preventDefault()},t.onMouseMove=function onMouseMove(t){var e=oh.targetCanvas.getBoundingClientRect();oc.onTouchMove(t.clientX-e.left,t.clientY-e.top,t.button),t.preventDefault()},t.onMouseUp=function onMouseUp(t){var e=oh.targetCanvas.getBoundingClientRect();oc.onTouchUp(t.clientX-e.left,t.clientY-e.top,t.button),t.preventDefault()},t.onTouchStart=function onTouchStart(t){t.preventDefault();for(var e=0;e<t.changedTouches.length;++e){var r=oh.targetCanvas.getBoundingClientRect(),n=t.changedTouches[e];oc.onTouchDown(n.clientX-r.left,n.clientY-r.top,0);break}},t.onTouchEnd=onTouchEnd,t.onTouchCancel=function onTouchCancel(t){t.preventDefault(),onTouchEnd(t)},t.onTouchMove=function onTouchMove(t){t.preventDefault();for(var e=0;e<t.changedTouches.length;++e){var r=oh.targetCanvas.getBoundingClientRect(),n=t.changedTouches[e];oc.onTouchMove(n.clientX-r.left,n.clientY-r.top,0);break}},t.onKeyDown=function onKeyDown(t){var e=oc.keyChangedInfo;oh.keysDown.has(t.keyCode)||(e.pressed=!0,e.keyCode=t.keyCode,oh.keysDown.set(t.keyCode,!0),ic.keyChanged.post(e))},t.onKeyUp=function onKeyUp(t){var e=oc.keyChangedInfo;e.pressed=!1,e.keyCode=t.keyCode,oh.keysDown.delete(t.keyCode),ic.keyChanged.post(e)}}(ah||(ah={})),function(t){function unload(){pi.unload(gt.context),Hc.destroy(),I.instance.clearCache(),br.clear()}function render(t,e,r,n){oh.canvasResized&&(t.forEach(function(t){return t.invalidateFrustum()}),oh.canvasResized=!1);for(var i=0,o=Hc.list();i<o.length;i++){var a=o[i];Rl.render(a.environment,t,e,r,n)}}t.targetCanvas=function(){return oh.targetCanvas},t.initializeWithCanvas=function initializeWithCanvas(t){var e={alpha:Go.instance.canvasAlpha},r=t.getContext("webgl",e)||t.getContext("experimental-webgl",e);return r?(gt.create(r),Io.initialize(),"isMobile"in window&&window.isMobile.any?(window.addEventListener("touchstart",ah.onTouchStart),window.addEventListener("touchend",ah.onTouchEnd),window.addEventListener("touchcancel",ah.onTouchCancel),window.addEventListener("touchmove",ah.onTouchMove)):(window.addEventListener("mousemove",ah.onMouseMove),window.addEventListener("mouseup",ah.onMouseUp),window.addEventListener("mousedown",ah.onMouseDown),window.addEventListener("wheel",ah.onMouseWheel,{passive:!1})),window.addEventListener("resize",ah.onWindowResized),window.addEventListener("keyup",ah.onKeyUp),window.addEventListener("keydown",ah.onKeyDown),Promise.resolve()):Promise.reject(Lo.WebGLContextCreationFailed)},t.unload=unload,t.reload=function reload(){return unload(),Go.load().then(function(){return ui.load()}).then(function(){return gt.context?Promise.resolve():t.initializeWithCanvas(oh.targetCanvas)})},t.flushPools=function flushPools(){it.pool.flush(),H.pool.flush(),ot.pool.flush(),st.pool.flush(),lt.pool.flush(),he.pool.flush(),ut.pool.flush(),ar.pool.flush()},t.render=render,t.updateFrame=function updateFrame(){if(oh.engineActive)if(oa.updateLoading(),ui.isLoaded()){Hc.updateTransition(),Y.updateDeltaTime(),t.flushPools();var e=Hc.list();if(0===e.length)return gt.context.clear(gt.context.COLOR_BUFFER_BIT|gt.context.DEPTH_BUFFER_BIT),void requestAnimationFrame(function(){return updateFrame()});if(e.every(function(t){return t.isLoaded()})){xc.update();var r=Aa.ofType(yl);r.sort(function(t,e){return t.priority-e.priority}),render(r),requestAnimationFrame(function(){return updateFrame()})}else requestAnimationFrame(function(){return updateFrame()})}else requestAnimationFrame(function(){return updateFrame()})}}(sh||(sh={}));var uh=function(){function Engine(){}return Engine.create=function(t){var e,r,n,i,o;V.log("SpiderEngine creation - Platform: web, Config: standalone, Env: production"),oh.engineConfig=t,Do.create(),Jf.create(t.customTypes),Qf.create(),nh.create(),t.container&&(oh.targetCanvas=t.container,Rl.create(oh.targetCanvas),oc.create((e=oh.targetCanvas.getBoundingClientRect(),r=e.left,n=e.top,i=e.width,o=e.height,new it(t.initialTouchPosition?t.initialTouchPosition.x-r:i/2,t.initialTouchPosition?t.initialTouchPosition.y-n:o/2))));return oh.createFileInterface().then(function(){return t.startupUrl?oh.downloadPlayableProject(t.startupUrl):Promise.resolve()}).then(function(){return oh.targetCanvas?Promise.resolve().then(function(){return Promise.resolve()}).then(function(){return Go.load()}).then(function(){return sh.initializeWithCanvas(oh.targetCanvas)}):Promise.resolve()}).then(function(){return Eo.preload()}).then(function(){return ui.load()}).then(function(){if(oh.targetCanvas){oh.engineActive=!0,sh.updateFrame();var e=t.startupScene||Go.instance.startupScene;if(e)return lu.load(e)}return Promise.resolve(null)}).then(function(e){e&&t.onSceneLoaded&&t.onSceneLoaded(e.templatePath)}).catch(function(t){return oh.engineActive=!1,Promise.reject(t)})},Engine.destroy=function(){oh.engineActive&&(V.log("SpiderEngine destruction"),oh.engineActive=!1,eh.downloadProgressChanged.detach(oh.onDownloadProgressChanged),oh.playRequestId&&(eh.abortRequest(oh.playRequestId),oh.playRequestId=null),oh.engineConfig.container&&(Io.destroy(),"isMobile"in window&&window.isMobile.any?(window.removeEventListener("touchstart",ah.onTouchStart),window.removeEventListener("touchend",ah.onTouchEnd),window.removeEventListener("touchcancel",ah.onTouchCancel),window.removeEventListener("touchmove",ah.onTouchMove)):(window.removeEventListener("mousemove",ah.onMouseMove),window.removeEventListener("mouseup",ah.onMouseUp),window.removeEventListener("mousedown",ah.onMouseDown),window.removeEventListener("wheel",ah.onMouseWheel)),window.removeEventListener("resize",ah.onWindowResized),window.removeEventListener("keyup",ah.onKeyUp),window.removeEventListener("keydown",ah.onKeyDown),sh.unload()))},Engine}();r.d(e,"Engine",function(){return uh}),r.d(e,"Interfaces",function(){return xt}),r.d(e,"Entities",function(){return Ut}),r.d(e,"Component",function(){return kt}),r.d(e,"SerializableObject",function(){return O}),r.d(e,"ModelElement",function(){return Nl}),r.d(e,"ModelMesh",function(){return Ll}),r.d(e,"ModelBone",function(){return Vl}),r.d(e,"ModelSkinnedMesh",function(){return Ul}),r.d(e,"Model",function(){return Wl}),r.d(e,"Input",function(){return ic}),r.d(e,"InputInternal",function(){return oc}),r.d(e,"Scenes",function(){return lu}),r.d(e,"Update",function(){return Sc}),r.d(e,"Transform",function(){return Lt}),r.d(e,"Assets",function(){return ua}),r.d(e,"Time",function(){return nt}),r.d(e,"Range",function(){return Ht}),r.d(e,"defaultAssets",function(){return ai}),r.d(e,"DefaultAssetsInternal",function(){return ui}),r.d(e,"CameraClear",function(){return Fu}),r.d(e,"CameraClearMetadata",function(){return hl}),r.d(e,"Camera",function(){return yl}),r.d(e,"Visual",function(){return Uu}),r.d(e,"LightType",function(){return bl}),r.d(e,"DirectionalLight",function(){return wl}),r.d(e,"PointLight",function(){return Pl}),r.d(e,"Light",function(){return Ol}),r.d(e,"ParticleEmitDirection",function(){return fs}),r.d(e,"ParticleValueOverLife",function(){return Es}),r.d(e,"ParticleNumberOverLife",function(){return Bs}),r.d(e,"ParticleColorOverLife",function(){return As}),r.d(e,"Particles",function(){return Is}),r.d(e,"Material",function(){return Cu}),r.d(e,"Shader",function(){return bu}),r.d(e,"PhongShaderInternal",function(){return Ql}),r.d(e,"PhongShader",function(){return Gp}),r.d(e,"BoxVolume",function(){return vs}),r.d(e,"SphereVolume",function(){return up}),r.d(e,"BoxGeometry",function(){return kf}),r.d(e,"SphereGeometry",function(){return Nf}),r.d(e,"ConeGeometry",function(){return Xf}),r.d(e,"PlaneGeometry",function(){return Wf}),r.d(e,"Billboard",function(){return hp}),r.d(e,"CenteredQuad",function(){return Bl}),r.d(e,"DynamicGeometry",function(){return Vp}),r.d(e,"QuadGeometry",function(){return vp}),r.d(e,"SkinnedMesh",function(){return Du}),r.d(e,"SpriteGeometry",function(){return kp}),r.d(e,"StaticMesh",function(){return Ru}),r.d(e,"Color",function(){return Z}),r.d(e,"Animation",function(){return co}),r.d(e,"AnimationComponent",function(){return bo}),r.d(e,"Layout",function(){return Sn}),r.d(e,"UIOverflow",function(){return fi}),r.d(e,"UIOverflowMetadata",function(){return gi}),r.d(e,"UIElement",function(){return _i}),r.d(e,"SpriteRenderMode",function(){return Fn}),r.d(e,"SpriteRenderModeMetadata",function(){return Wn}),r.d(e,"Sprite",function(){return qn}),r.d(e,"SpriteSheet",function(){return Kn}),r.d(e,"FontMetrics",function(){return Oi}),r.d(e,"Image",function(){return uc}),r.d(e,"Screen",function(){return bc}),r.d(e,"UIFill",function(){return Jn}),r.d(e,"MaterialFill",function(){return $n}),r.d(e,"SpriteFill",function(){return ti}),r.d(e,"TextureFill",function(){return ei}),r.d(e,"ColorFill",function(){return ri}),r.d(e,"SpriteSheetFill",function(){return ni}),r.d(e,"SpriteSheetMaterialFill",function(){return ii}),r.d(e,"TouchInteractions",function(){return Yi}),r.d(e,"BehaviorComponent",function(){return mn}),r.d(e,"Behavior",function(){return ln}),r.d(e,"BehaviorAPI",function(){return Tc}),r.d(e,"BehaviorAPIFactory",function(){return sr}),r.d(e,"CodeBlock",function(){return Sr}),r.d(e,"Data",function(){return Fp}),r.d(e,"Vector3",function(){return H}),r.d(e,"Vector2",function(){return it}),r.d(e,"Quaternion",function(){return ut}),r.d(e,"Matrix44",function(){return st}),r.d(e,"Vector4",function(){return ot}),r.d(e,"MathEx",function(){return K}),r.d(e,"RayPlaneCollisionResult",function(){return Me}),r.d(e,"RayAABBCollisionResult",function(){return ke}),r.d(e,"RaySphereCollisionResult",function(){return ze}),r.d(e,"Ray",function(){return De}),r.d(e,"PlaneClassification",function(){return ue}),r.d(e,"Plane",function(){return he}),r.d(e,"Random",function(){return Gt}),r.d(e,"BoxCollisionShape",function(){return Oa}),r.d(e,"MeshCollisionShape",function(){return ga}),r.d(e,"ParticlesCollisionShape",function(){return Bp}),r.d(e,"PlaneCollisionShape",function(){return qs}),r.d(e,"SphereCollisionShape",function(){return Pa}),r.d(e,"VisualCollisionShape",function(){return Ma}),r.d(e,"Collider",function(){return Ba}),r.d(e,"PhysicsBroadPhaseType",function(){return Ts}),r.d(e,"PhysicsBroadPhaseTypeMetadata",function(){return Ls}),r.d(e,"PhysicsContext",function(){return Us}),r.d(e,"RigidBodyType",function(){return Ns}),r.d(e,"RigidBodyTypeMetadata",function(){return Ys}),r.d(e,"RigidBody",function(){return Js})}]));
      