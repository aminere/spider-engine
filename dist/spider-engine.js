
      if (typeof exports === 'undefined') { var exports = {}; }
      var spider = exports;/*! For license information please see spider-engine.js.LICENSE.txt */
!function(t,n){for(var r in n)t[r]=n[r]}(exports,function(t){var n={};function __webpack_require__(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,__webpack_require__),o.l=!0,o.exports}return __webpack_require__.m=t,__webpack_require__.c=n,__webpack_require__.d=function(t,n,r){__webpack_require__.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},__webpack_require__.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},__webpack_require__.t=function(t,n){if(1&n&&(t=__webpack_require__(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(__webpack_require__.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)__webpack_require__.d(r,o,function(n){return t[n]}.bind(null,o));return r},__webpack_require__.n=function(t){var n=t&&t.__esModule?function getDefault(){return t.default}:function getModuleExports(){return t};return __webpack_require__.d(n,"a",n),n},__webpack_require__.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},__webpack_require__.p="/dist/",__webpack_require__(__webpack_require__.s=107)}([function(t,n,r){"use strict";function __export(t){for(var r in t)n.hasOwnProperty(r)||(n[r]=t[r])}Object.defineProperty(n,"__esModule",{value:!0}),__export(r(16)),__export(r(19)),__export(r(29)),__export(r(30)),__export(r(58));var o=r(20),i=r(20);n.EventQueue=i.default,n.queue=function queue(){return o.default.global()},n.flushOnce=function flushOnce(){o.default.global().flushOnce()},n.flush=function flush(t){void 0===t&&(t=10),o.default.global().flush(t)}},function(t,n,r){"use strict";var o=r(6),i=r(39),a=r(18),c=r(80),u=r(14);function identity(t){return t}function stringToArrayLike(t,n){for(var r=0;r<t.length;++r)n[r]=255&t.charCodeAt(r);return n}n.newBlob=function(t,r){n.checkSupport("blob");try{return new Blob([t],{type:r})}catch(n){try{var o=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return o.append(t),o.getBlob(r)}catch(t){throw new Error("Bug : can't construct the Blob.")}}};var l={stringifyByChunk:function(t,n,r){var o=[],i=0,a=t.length;if(a<=r)return String.fromCharCode.apply(null,t);for(;i<a;)"array"===n||"nodebuffer"===n?o.push(String.fromCharCode.apply(null,t.slice(i,Math.min(i+r,a)))):o.push(String.fromCharCode.apply(null,t.subarray(i,Math.min(i+r,a)))),i+=r;return o.join("")},stringifyByChar:function(t){for(var n="",r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return n},applyCanBeUsed:{uint8array:function(){try{return o.uint8array&&1===String.fromCharCode.apply(null,new Uint8Array(1)).length}catch(t){return!1}}(),nodebuffer:function(){try{return o.nodebuffer&&1===String.fromCharCode.apply(null,a.allocBuffer(1)).length}catch(t){return!1}}()}};function arrayLikeToString(t){var r=65536,o=n.getTypeOf(t),i=!0;if("uint8array"===o?i=l.applyCanBeUsed.uint8array:"nodebuffer"===o&&(i=l.applyCanBeUsed.nodebuffer),i)for(;r>1;)try{return l.stringifyByChunk(t,o,r)}catch(t){r=Math.floor(r/2)}return l.stringifyByChar(t)}function arrayLikeToArrayLike(t,n){for(var r=0;r<t.length;r++)n[r]=t[r];return n}n.applyFromCharCode=arrayLikeToString;var p={};p.string={string:identity,array:function(t){return stringToArrayLike(t,new Array(t.length))},arraybuffer:function(t){return p.string.uint8array(t).buffer},uint8array:function(t){return stringToArrayLike(t,new Uint8Array(t.length))},nodebuffer:function(t){return stringToArrayLike(t,a.allocBuffer(t.length))}},p.array={string:arrayLikeToString,array:identity,arraybuffer:function(t){return new Uint8Array(t).buffer},uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return a.newBufferFrom(t)}},p.arraybuffer={string:function(t){return arrayLikeToString(new Uint8Array(t))},array:function(t){return arrayLikeToArrayLike(new Uint8Array(t),new Array(t.byteLength))},arraybuffer:identity,uint8array:function(t){return new Uint8Array(t)},nodebuffer:function(t){return a.newBufferFrom(new Uint8Array(t))}},p.uint8array={string:arrayLikeToString,array:function(t){return arrayLikeToArrayLike(t,new Array(t.length))},arraybuffer:function(t){return t.buffer},uint8array:identity,nodebuffer:function(t){return a.newBufferFrom(t)}},p.nodebuffer={string:arrayLikeToString,array:function(t){return arrayLikeToArrayLike(t,new Array(t.length))},arraybuffer:function(t){return p.nodebuffer.uint8array(t).buffer},uint8array:function(t){return arrayLikeToArrayLike(t,new Uint8Array(t.length))},nodebuffer:identity},n.transformTo=function(t,r){if(r||(r=""),!t)return r;n.checkSupport(t);var o=n.getTypeOf(r);return p[o][t](r)},n.getTypeOf=function(t){return"string"==typeof t?"string":"[object Array]"===Object.prototype.toString.call(t)?"array":o.nodebuffer&&a.isBuffer(t)?"nodebuffer":o.uint8array&&t instanceof Uint8Array?"uint8array":o.arraybuffer&&t instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(t){if(!o[t.toLowerCase()])throw new Error(t+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(t){var n,r,o="";for(r=0;r<(t||"").length;r++)o+="\\x"+((n=t.charCodeAt(r))<16?"0":"")+n.toString(16).toUpperCase();return o},n.delay=function(t,n,r){c((function(){t.apply(r||null,n||[])}))},n.inherits=function(t,n){var Obj=function(){};Obj.prototype=n.prototype,t.prototype=new Obj},n.extend=function(){var t,n,r={};for(t=0;t<arguments.length;t++)for(n in arguments[t])arguments[t].hasOwnProperty(n)&&void 0===r[n]&&(r[n]=arguments[t][n]);return r},n.prepareContent=function(t,r,a,c,l){return u.Promise.resolve(r).then((function(t){return o.blob&&(t instanceof Blob||-1!==["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(t)))&&"undefined"!=typeof FileReader?new u.Promise((function(n,r){var o=new FileReader;o.onload=function(t){n(t.target.result)},o.onerror=function(t){r(t.target.error)},o.readAsArrayBuffer(t)})):t})).then((function(r){var p=n.getTypeOf(r);return p?("arraybuffer"===p?r=n.transformTo("uint8array",r):"string"===p&&(l?r=i.decode(r):a&&!0!==c&&(r=function string2binary(t){return stringToArrayLike(t,o.uint8array?new Uint8Array(t.length):new Array(t.length))}(r))),r):u.Promise.reject(new Error("Can't read the data of '"+t+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))}))}},function(t,n,r){t.exports=function e(t,n,r){function s(i,a){if(!n[i]){if(!t[i]){if(o)return o(i,!0);throw new Error("Cannot find module '"+i+"'")}var c=n[i]={exports:{}};t[i][0].call(c.exports,(function(n){var r=t[i][1][n];return s(r||n)}),c,c.exports,e,t,n,r)}return n[i].exports}for(var o=!1,i=0;i<r.length;i++)s(r[i]);return s}({1:[function(t,n,r){n.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,n,r){n.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,n,r){var o=t("../math/Vec3");function AABB(t){t=t||{},this.lowerBound=new o,t.lowerBound&&this.lowerBound.copy(t.lowerBound),this.upperBound=new o,t.upperBound&&this.upperBound.copy(t.upperBound)}t("../utils/Utils"),n.exports=AABB;var i=new o;AABB.prototype.setFromPoints=function(t,n,r,o){var a=this.lowerBound,c=this.upperBound,u=r;a.copy(t[0]),u&&u.vmult(a,a),c.copy(a);for(var l=1;l<t.length;l++){var p=t[l];u&&(u.vmult(p,i),p=i),p.x>c.x&&(c.x=p.x),p.x<a.x&&(a.x=p.x),p.y>c.y&&(c.y=p.y),p.y<a.y&&(a.y=p.y),p.z>c.z&&(c.z=p.z),p.z<a.z&&(a.z=p.z)}return n&&(n.vadd(a,a),n.vadd(c,c)),o&&(a.x-=o,a.y-=o,a.z-=o,c.x+=o,c.y+=o,c.z+=o),this},AABB.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this},AABB.prototype.clone=function(){return(new AABB).copy(this)},AABB.prototype.extend=function(t){var n=t.lowerBound.x;this.lowerBound.x>n&&(this.lowerBound.x=n);var r=t.upperBound.x;this.upperBound.x<r&&(this.upperBound.x=r),n=t.lowerBound.y,this.lowerBound.y>n&&(this.lowerBound.y=n),r=t.upperBound.y,this.upperBound.y<r&&(this.upperBound.y=r),n=t.lowerBound.z,this.lowerBound.z>n&&(this.lowerBound.z=n),r=t.upperBound.z,this.upperBound.z<r&&(this.upperBound.z=r)},AABB.prototype.overlaps=function(t){var n=this.lowerBound,r=this.upperBound,o=t.lowerBound,i=t.upperBound;return(o.x<=r.x&&r.x<=i.x||n.x<=i.x&&i.x<=r.x)&&(o.y<=r.y&&r.y<=i.y||n.y<=i.y&&i.y<=r.y)&&(o.z<=r.z&&r.z<=i.z||n.z<=i.z&&i.z<=r.z)},AABB.prototype.contains=function(t){var n=this.lowerBound,r=this.upperBound,o=t.lowerBound,i=t.upperBound;return n.x<=o.x&&r.x>=i.x&&n.y<=o.y&&r.y>=i.y&&n.z<=o.z&&r.z>=i.z},AABB.prototype.getCorners=function(t,n,r,o,i,a,c,u){var l=this.lowerBound,p=this.upperBound;t.copy(l),n.set(p.x,l.y,l.z),r.set(p.x,p.y,l.z),o.set(l.x,p.y,p.z),i.set(p.x,l.y,l.z),a.set(l.x,p.y,l.z),c.set(l.x,l.y,p.z),u.copy(p)};var a=[new o,new o,new o,new o,new o,new o,new o,new o];AABB.prototype.toLocalFrame=function(t,n){var r=a,o=r[0],i=r[1],c=r[2],u=r[3],l=r[4],p=r[5],f=r[6],h=r[7];this.getCorners(o,i,c,u,l,p,f,h);for(var d=0;8!==d;d++){var y=r[d];t.pointToLocal(y,y)}return n.setFromPoints(r)},AABB.prototype.toWorldFrame=function(t,n){var r=a,o=r[0],i=r[1],c=r[2],u=r[3],l=r[4],p=r[5],f=r[6],h=r[7];this.getCorners(o,i,c,u,l,p,f,h);for(var d=0;8!==d;d++){var y=r[d];t.pointToWorld(y,y)}return n.setFromPoints(r)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,n,r){function ArrayCollisionMatrix(){this.matrix=[]}n.exports=ArrayCollisionMatrix,ArrayCollisionMatrix.prototype.get=function(t,n){if(t=t.index,(n=n.index)>t){var r=n;n=t,t=r}return this.matrix[(t*(t+1)>>1)+n-1]},ArrayCollisionMatrix.prototype.set=function(t,n,r){if(t=t.index,(n=n.index)>t){var o=n;n=t,t=o}this.matrix[(t*(t+1)>>1)+n-1]=r?1:0},ArrayCollisionMatrix.prototype.reset=function(){for(var t=0,n=this.matrix.length;t!==n;t++)this.matrix[t]=0},ArrayCollisionMatrix.prototype.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1}},{}],5:[function(t,n,r){var o=t("../objects/Body"),i=t("../math/Vec3"),a=t("../math/Quaternion");function Broadphase(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}t("../shapes/Shape"),t("../shapes/Plane"),n.exports=Broadphase,Broadphase.prototype.collisionPairs=function(t,n,r){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var c=o.STATIC|o.KINEMATIC;Broadphase.prototype.needBroadphaseCollision=function(t,n){return 0!=(t.collisionFilterGroup&n.collisionFilterMask)&&0!=(n.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&c)&&t.sleepState!==o.SLEEPING||0==(n.type&c)&&n.sleepState!==o.SLEEPING)},Broadphase.prototype.intersectionTest=function(t,n,r,o){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,n,r,o):this.doBoundingSphereBroadphase(t,n,r,o)};var u=new i;new i,new a,new i,Broadphase.prototype.doBoundingSphereBroadphase=function(t,n,r,o){var i=u;n.position.vsub(t.position,i);var a=Math.pow(t.boundingRadius+n.boundingRadius,2);i.norm2()<a&&(r.push(t),o.push(n))},Broadphase.prototype.doBoundingBoxBroadphase=function(t,n,r,o){t.aabbNeedsUpdate&&t.computeAABB(),n.aabbNeedsUpdate&&n.computeAABB(),t.aabb.overlaps(n.aabb)&&(r.push(t),o.push(n))};var l={keys:[]},p=[],f=[];Broadphase.prototype.makePairsUnique=function(t,n){for(var r=l,o=p,i=f,a=t.length,c=0;c!==a;c++)o[c]=t[c],i[c]=n[c];for(t.length=0,n.length=0,c=0;c!==a;c++){var u=o[c].id,h=i[c].id;r[d=u<h?u+","+h:h+","+u]=c,r.keys.push(d)}for(c=0;c!==r.keys.length;c++){var d=r.keys.pop(),y=r[d];t.push(o[y]),n.push(i[y]),delete r[d]}},Broadphase.prototype.setWorld=function(t){};var h=new i;Broadphase.boundingSphereCheck=function(t,n){var r=h;return t.position.vsub(n.position,r),Math.pow(t.shape.boundingSphereRadius+n.shape.boundingSphereRadius,2)>r.norm2()},Broadphase.prototype.aabbQuery=function(t,n,r){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,n,r){n.exports=GridBroadphase;var o=t("./Broadphase"),i=t("../math/Vec3"),a=t("../shapes/Shape");function GridBroadphase(t,n,r,a,c){o.apply(this),this.nx=r||10,this.ny=a||10,this.nz=c||10,this.aabbMin=t||new i(100,100,100),this.aabbMax=n||new i(-100,-100,-100);var u=this.nx*this.ny*this.nz;if(u<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=u,this.binLengths.length=u;for(var l=0;l<u;l++)this.bins[l]=[],this.binLengths[l]=0}GridBroadphase.prototype=new o,GridBroadphase.prototype.constructor=GridBroadphase;var c=new i;new i,GridBroadphase.prototype.collisionPairs=function(t,n,r){for(var o=t.numObjects(),i=t.bodies,u=this.aabbMax,l=this.aabbMin,p=this.nx,f=this.ny,h=this.nz,d=f*h,y=h,m=u.x,v=u.y,g=u.z,_=l.x,b=l.y,w=l.z,x=p/(m-_),P=f/(v-b),O=h/(g-w),C=(m-_)/p,S=(v-b)/f,A=(g-w)/h,E=.5*Math.sqrt(C*C+S*S+A*A),j=a.types,T=j.SPHERE,R=j.PLANE,B=(j.BOX,j.COMPOUND,j.CONVEXPOLYHEDRON,this.bins),M=this.binLengths,I=this.bins.length,z=0;z!==I;z++)M[z]=0;var k=Math.ceil;function addBoxToBins(t,n,r,o,i,a,c){var u=(t-_)*x|0,l=(n-b)*P|0,m=(r-w)*O|0,v=k((o-_)*x),g=k((i-b)*P),C=k((a-w)*O);u<0?u=0:u>=p&&(u=p-1),l<0?l=0:l>=f&&(l=f-1),m<0?m=0:m>=h&&(m=h-1),v<0?v=0:v>=p&&(v=p-1),g<0?g=0:g>=f&&(g=f-1),C<0?C=0:C>=h&&(C=h-1),l*=y,m*=1,v*=d,g*=y,C*=1;for(var S=u*=d;S<=v;S+=d)for(var A=l;A<=g;A+=y)for(var E=m;E<=C;E+=1){var j=S+A+E;B[j][M[j]++]=c}}for(l=Math.min,u=Math.max,z=0;z!==o;z++){var D=(nt=i[z]).shape;switch(D.type){case T:var F=nt.position.x,L=nt.position.y,N=nt.position.z,V=D.radius;addBoxToBins(F-V,L-V,N-V,F+V,L+V,N+V,nt);break;case R:D.worldNormalNeedsUpdate&&D.computeWorldNormal(nt.quaternion);var U=D.worldNormal,W=_+.5*C-nt.position.x,q=b+.5*S-nt.position.y,G=w+.5*A-nt.position.z,H=c;H.set(W,q,G);for(var X=0,K=0;X!==p;X++,K+=d,H.y=q,H.x+=C)for(var Q=0,Y=0;Q!==f;Q++,Y+=y,H.z=G,H.y+=S)for(var Z=0,J=0;Z!==h;Z++,J+=1,H.z+=A)if(H.dot(U)<E){var $=K+Y+J;B[$][M[$]++]=nt}break;default:nt.aabbNeedsUpdate&&nt.computeAABB(),addBoxToBins(nt.aabb.lowerBound.x,nt.aabb.lowerBound.y,nt.aabb.lowerBound.z,nt.aabb.upperBound.x,nt.aabb.upperBound.y,nt.aabb.upperBound.z,nt)}}for(z=0;z!==I;z++){var tt=M[z];if(tt>1){var et=B[z];for(X=0;X!==tt;X++){var nt=et[X];for(Q=0;Q!==X;Q++){var rt=et[Q];this.needBroadphaseCollision(nt,rt)&&this.intersectionTest(nt,rt,n,r)}}}}this.makePairsUnique(n,r)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,n,r){n.exports=NaiveBroadphase;var o=t("./Broadphase"),i=t("./AABB");function NaiveBroadphase(){o.apply(this)}NaiveBroadphase.prototype=new o,NaiveBroadphase.prototype.constructor=NaiveBroadphase,NaiveBroadphase.prototype.collisionPairs=function(t,n,r){var o,i,a,c,u=t.bodies,l=u.length;for(o=0;o!==l;o++)for(i=0;i!==o;i++)a=u[o],c=u[i],this.needBroadphaseCollision(a,c)&&this.intersectionTest(a,c,n,r)},new i,NaiveBroadphase.prototype.aabbQuery=function(t,n,r){r=r||[];for(var o=0;o<t.bodies.length;o++){var i=t.bodies[o];i.aabbNeedsUpdate&&i.computeAABB(),i.aabb.overlaps(n)&&r.push(i)}return r}},{"./AABB":3,"./Broadphase":5}],8:[function(t,n,r){function ObjectCollisionMatrix(){this.matrix={}}n.exports=ObjectCollisionMatrix,ObjectCollisionMatrix.prototype.get=function(t,n){if(t=t.id,(n=n.id)>t){var r=n;n=t,t=r}return t+"-"+n in this.matrix},ObjectCollisionMatrix.prototype.set=function(t,n,r){if(t=t.id,(n=n.id)>t){var o=n;n=t,t=o}r?this.matrix[t+"-"+n]=!0:delete this.matrix[t+"-"+n]},ObjectCollisionMatrix.prototype.reset=function(){this.matrix={}},ObjectCollisionMatrix.prototype.setNumObjects=function(t){}},{}],9:[function(t,n,r){n.exports=Ray;var o=t("../math/Vec3"),i=t("../math/Quaternion"),a=t("../math/Transform"),c=(t("../shapes/ConvexPolyhedron"),t("../shapes/Box"),t("../collision/RaycastResult")),u=t("../shapes/Shape"),l=t("../collision/AABB");function Ray(t,n){this.from=t?t.clone():new o,this.to=n?n.clone():new o,this._direction=new o,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray.ANY,this.result=new c,this.hasHit=!1,this.callback=function(t){}}Ray.prototype.constructor=Ray,Ray.CLOSEST=1,Ray.ANY=2,Ray.ALL=4;var p=new l,f=[];Ray.prototype.intersectWorld=function(t,n){return this.mode=n.mode||Ray.ANY,this.result=n.result||new c,this.skipBackfaces=!!n.skipBackfaces,this.collisionFilterMask=void 0!==n.collisionFilterMask?n.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==n.collisionFilterGroup?n.collisionFilterGroup:-1,n.from&&this.from.copy(n.from),n.to&&this.to.copy(n.to),this.callback=n.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(p),f.length=0,t.broadphase.aabbQuery(t,p,f),this.intersectBodies(f),this.hasHit};var h=new o,d=new o;function pointInTriangle(t,n,r,o){o.vsub(n,I),r.vsub(n,h),t.vsub(n,d);var i,a,c=I.dot(I),u=I.dot(h),l=I.dot(d),p=h.dot(h),f=h.dot(d);return(i=p*l-u*f)>=0&&(a=c*f-u*l)>=0&&i+a<c*p-u*u}Ray.pointInTriangle=pointInTriangle;var y=new o,m=new i;Ray.prototype.intersectBody=function(t,n){n&&(this.result=n,this._updateDirection());var r=this.checkCollisionResponse;if((!r||t.collisionResponse)&&0!=(this.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&this.collisionFilterMask))for(var o=y,i=m,a=0,c=t.shapes.length;a<c;a++){var u=t.shapes[a];if((!r||u.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[a],i),t.quaternion.vmult(t.shapeOffsets[a],o),o.vadd(t.position,o),this.intersectShape(u,i,o,t),this.result._shouldStop))break}},Ray.prototype.intersectBodies=function(t,n){n&&(this.result=n,this._updateDirection());for(var r=0,o=t.length;!this.result._shouldStop&&r<o;r++)this.intersectBody(t[r])},Ray.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},Ray.prototype.intersectShape=function(t,n,r,o){if(!(function distanceFromIntersection(t,n,r){r.vsub(t,I);var o=I.dot(n);return n.mult(o,z),z.vadd(t,z),r.distanceTo(z)}(this.from,this._direction,r)>t.boundingSphereRadius)){var i=this[t.type];i&&i.call(this,t,n,r,o)}},new o,new o;var v=new o,g=new o,_=new o,b=new o;new o,new c,Ray.prototype.intersectBox=function(t,n,r,o){return this.intersectConvex(t.convexPolyhedronRepresentation,n,r,o)},Ray.prototype[u.types.BOX]=Ray.prototype.intersectBox,Ray.prototype.intersectPlane=function(t,n,r,i){var a=this.from,c=this.to,u=this._direction,l=new o(0,0,1);n.vmult(l,l);var p=new o;a.vsub(r,p);var f=p.dot(l);if(c.vsub(r,p),!(f*p.dot(l)>0||a.distanceTo(c)<f)){var h=l.dot(u);if(!(Math.abs(h)<this.precision)){var d=new o,y=new o,m=new o;a.vsub(r,d);var v=-l.dot(d)/h;u.scale(v,y),a.vadd(y,m),this.reportIntersection(l,m,t,i,-1)}}},Ray.prototype[u.types.PLANE]=Ray.prototype.intersectPlane,Ray.prototype.getAABB=function(t){var n=this.to,r=this.from;t.lowerBound.x=Math.min(n.x,r.x),t.lowerBound.y=Math.min(n.y,r.y),t.lowerBound.z=Math.min(n.z,r.z),t.upperBound.x=Math.max(n.x,r.x),t.upperBound.y=Math.max(n.y,r.y),t.upperBound.z=Math.max(n.z,r.z)};var w={faceList:[0]};Ray.prototype.intersectHeightfield=function(t,n,r,i){t.data,t.elementSize;var c=new o,u=new Ray(this.from,this.to);a.pointToLocalFrame(r,n,u.from,u.from),a.pointToLocalFrame(r,n,u.to,u.to);var l=[],p=null,f=null,h=null,d=null,y=t.getIndexOfPosition(u.from.x,u.from.y,l,!1);if(y&&(p=l[0],f=l[1],h=l[0],d=l[1]),(y=t.getIndexOfPosition(u.to.x,u.to.y,l,!1))&&((null===p||l[0]<p)&&(p=l[0]),(null===h||l[0]>h)&&(h=l[0]),(null===f||l[1]<f)&&(f=l[1]),(null===d||l[1]>d)&&(d=l[1])),null!==p){var m=[];t.getRectMinMax(p,f,h,d,m);for(var v=p;v<=h;v++)for(var g=f;g<=d;g++){if(this.result._shouldStop)return;if(t.getConvexTrianglePillar(v,g,!1),a.pointToWorldFrame(r,n,t.pillarOffset,c),this.intersectConvex(t.pillarConvex,n,c,i,w),this.result._shouldStop)return;t.getConvexTrianglePillar(v,g,!0),a.pointToWorldFrame(r,n,t.pillarOffset,c),this.intersectConvex(t.pillarConvex,n,c,i,w)}}},Ray.prototype[u.types.HEIGHTFIELD]=Ray.prototype.intersectHeightfield;var x=new o,P=new o;Ray.prototype.intersectSphere=function(t,n,r,o){var i=this.from,a=this.to,c=t.radius,u=Math.pow(a.x-i.x,2)+Math.pow(a.y-i.y,2)+Math.pow(a.z-i.z,2),l=2*((a.x-i.x)*(i.x-r.x)+(a.y-i.y)*(i.y-r.y)+(a.z-i.z)*(i.z-r.z)),p=Math.pow(i.x-r.x,2)+Math.pow(i.y-r.y,2)+Math.pow(i.z-r.z,2)-Math.pow(c,2),f=Math.pow(l,2)-4*u*p,h=x,d=P;if(!(f<0))if(0===f)i.lerp(a,f,h),h.vsub(r,d),d.normalize(),this.reportIntersection(d,h,t,o,-1);else{var y=(-l-Math.sqrt(f))/(2*u),m=(-l+Math.sqrt(f))/(2*u);if(y>=0&&y<=1&&(i.lerp(a,y,h),h.vsub(r,d),d.normalize(),this.reportIntersection(d,h,t,o,-1)),this.result._shouldStop)return;m>=0&&m<=1&&(i.lerp(a,m,h),h.vsub(r,d),d.normalize(),this.reportIntersection(d,h,t,o,-1))}},Ray.prototype[u.types.SPHERE]=Ray.prototype.intersectSphere;var O=new o,C=(new o,new o,new o);Ray.prototype.intersectConvex=function intersectConvex(t,n,r,o,i){for(var a=O,c=C,u=i&&i.faceList||null,l=t.faces,p=t.vertices,f=t.faceNormals,h=this._direction,d=this.from,y=this.to,m=d.distanceTo(y),w=u?u.length:l.length,x=this.result,P=0;!x._shouldStop&&P<w;P++){var S=u?u[P]:P,A=l[S],E=f[S],j=n,T=r;c.copy(p[A[0]]),j.vmult(c,c),c.vadd(T,c),c.vsub(d,c),j.vmult(E,a);var R=h.dot(a);if(!(Math.abs(R)<this.precision)){var B=a.dot(c)/R;if(!(B<0)){h.mult(B,v),v.vadd(d,v),g.copy(p[A[0]]),j.vmult(g,g),T.vadd(g,g);for(var M=1;!x._shouldStop&&M<A.length-1;M++){_.copy(p[A[M]]),b.copy(p[A[M+1]]),j.vmult(_,_),j.vmult(b,b),T.vadd(_,_),T.vadd(b,b);var I=v.distanceTo(d);!pointInTriangle(v,g,_,b)&&!pointInTriangle(v,_,g,b)||I>m||this.reportIntersection(a,v,t,o,S)}}}}},Ray.prototype[u.types.CONVEXPOLYHEDRON]=Ray.prototype.intersectConvex;var S=new o,A=new o,E=new o,j=new o,T=new o,R=new o,B=(new l,[]),M=new a;Ray.prototype.intersectTrimesh=function intersectTrimesh(t,n,r,o,i){var c=S,u=B,l=M,p=C,f=A,h=E,d=j,y=R,m=T,w=(i&&i.faceList,t.indices),x=(t.vertices,t.faceNormals,this.from),P=this.to,O=this._direction;l.position.copy(r),l.quaternion.copy(n),a.vectorToLocalFrame(r,n,O,f),a.pointToLocalFrame(r,n,x,h),a.pointToLocalFrame(r,n,P,d);var I=h.distanceSquared(d);t.tree.rayQuery(this,l,u);for(var z=0,k=u.length;!this.result._shouldStop&&z!==k;z++){var D=u[z];t.getNormal(D,c),t.getVertex(w[3*D],g),g.vsub(h,p);var F=f.dot(c),L=c.dot(p)/F;if(!(L<0)){f.scale(L,v),v.vadd(h,v),t.getVertex(w[3*D+1],_),t.getVertex(w[3*D+2],b);var N=v.distanceSquared(h);!pointInTriangle(v,_,g,b)&&!pointInTriangle(v,g,_,b)||N>I||(a.vectorToWorldFrame(n,c,m),a.pointToWorldFrame(r,n,v,y),this.reportIntersection(m,y,t,o,D))}}u.length=0},Ray.prototype[u.types.TRIMESH]=Ray.prototype.intersectTrimesh,Ray.prototype.reportIntersection=function(t,n,r,o,i){var a=this.from,c=this.to,u=a.distanceTo(n),l=this.result;if(!(this.skipBackfaces&&t.dot(this._direction)>0))switch(l.hitFaceIndex=void 0!==i?i:-1,this.mode){case Ray.ALL:this.hasHit=!0,l.set(a,c,t,n,r,o,u),l.hasHit=!0,this.callback(l);break;case Ray.CLOSEST:(u<l.distance||!l.hasHit)&&(this.hasHit=!0,l.hasHit=!0,l.set(a,c,t,n,r,o,u));break;case Ray.ANY:this.hasHit=!0,l.hasHit=!0,l.set(a,c,t,n,r,o,u),l._shouldStop=!0}};var I=new o,z=new o},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,n,r){var o=t("../math/Vec3");function RaycastResult(){this.rayFromWorld=new o,this.rayToWorld=new o,this.hitNormalWorld=new o,this.hitPointWorld=new o,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}n.exports=RaycastResult,RaycastResult.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},RaycastResult.prototype.abort=function(){this._shouldStop=!0},RaycastResult.prototype.set=function(t,n,r,o,i,a,c){this.rayFromWorld.copy(t),this.rayToWorld.copy(n),this.hitNormalWorld.copy(r),this.hitPointWorld.copy(o),this.shape=i,this.body=a,this.distance=c}},{"../math/Vec3":30}],11:[function(t,n,r){t("../shapes/Shape");var o=t("../collision/Broadphase");function SAPBroadphase(t){o.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var n=this.axisList;this._addBodyHandler=function(t){n.push(t.body)},this._removeBodyHandler=function(t){var r=n.indexOf(t.body);-1!==r&&n.splice(r,1)},t&&this.setWorld(t)}n.exports=SAPBroadphase,SAPBroadphase.prototype=new o,SAPBroadphase.prototype.setWorld=function(t){this.axisList.length=0;for(var n=0;n<t.bodies.length;n++)this.axisList.push(t.bodies[n]);t.removeEventListener("addBody",this._addBodyHandler),t.removeEventListener("removeBody",this._removeBodyHandler),t.addEventListener("addBody",this._addBodyHandler),t.addEventListener("removeBody",this._removeBodyHandler),this.world=t,this.dirty=!0},SAPBroadphase.insertionSortX=function(t){for(var n=1,r=t.length;n<r;n++){for(var o=t[n],i=n-1;i>=0&&!(t[i].aabb.lowerBound.x<=o.aabb.lowerBound.x);i--)t[i+1]=t[i];t[i+1]=o}return t},SAPBroadphase.insertionSortY=function(t){for(var n=1,r=t.length;n<r;n++){for(var o=t[n],i=n-1;i>=0&&!(t[i].aabb.lowerBound.y<=o.aabb.lowerBound.y);i--)t[i+1]=t[i];t[i+1]=o}return t},SAPBroadphase.insertionSortZ=function(t){for(var n=1,r=t.length;n<r;n++){for(var o=t[n],i=n-1;i>=0&&!(t[i].aabb.lowerBound.z<=o.aabb.lowerBound.z);i--)t[i+1]=t[i];t[i+1]=o}return t},SAPBroadphase.prototype.collisionPairs=function(t,n,r){var o,i,a=this.axisList,c=a.length,u=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),o=0;o!==c;o++){var l=a[o];for(i=o+1;i<c;i++){var p=a[i];if(this.needBroadphaseCollision(l,p)){if(!SAPBroadphase.checkBounds(l,p,u))break;this.intersectionTest(l,p,n,r)}}}},SAPBroadphase.prototype.sortList=function(){for(var t=this.axisList,n=this.axisIndex,r=t.length,o=0;o!==r;o++){var i=t[o];i.aabbNeedsUpdate&&i.computeAABB()}0===n?SAPBroadphase.insertionSortX(t):1===n?SAPBroadphase.insertionSortY(t):2===n&&SAPBroadphase.insertionSortZ(t)},SAPBroadphase.checkBounds=function(t,n,r){var o,i;0===r?(o=t.position.x,i=n.position.x):1===r?(o=t.position.y,i=n.position.y):2===r&&(o=t.position.z,i=n.position.z);var a=t.boundingRadius,c=n.boundingRadius;return i-c<o+a},SAPBroadphase.prototype.autoDetectAxis=function(){for(var t=0,n=0,r=0,o=0,i=0,a=0,c=this.axisList,u=c.length,l=1/u,p=0;p!==u;p++){var f=c[p],h=f.position.x;t+=h,n+=h*h;var d=f.position.y;r+=d,o+=d*d;var y=f.position.z;i+=y,a+=y*y}var m=n-t*t*l,v=o-r*r*l,g=a-i*i*l;this.axisIndex=m>v?m>g?0:2:v>g?1:2},SAPBroadphase.prototype.aabbQuery=function(t,n,r){r=r||[],this.dirty&&(this.sortList(),this.dirty=!1);var o=this.axisIndex,i="x";1===o&&(i="y"),2===o&&(i="z");for(var a=this.axisList,c=(n.lowerBound[i],n.upperBound[i],0);c<a.length;c++){var u=a[c];u.aabbNeedsUpdate&&u.computeAABB(),u.aabb.overlaps(n)&&r.push(u)}return r}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,n,r){n.exports=ConeTwistConstraint,t("./Constraint");var o=t("./PointToPointConstraint"),i=t("../equations/ConeEquation"),a=t("../equations/RotationalEquation"),c=(t("../equations/ContactEquation"),t("../math/Vec3"));function ConeTwistConstraint(t,n,r){var u=void 0!==(r=r||{}).maxForce?r.maxForce:1e6,l=r.pivotA?r.pivotA.clone():new c,p=r.pivotB?r.pivotB.clone():new c;this.axisA=r.axisA?r.axisA.clone():new c,this.axisB=r.axisB?r.axisB.clone():new c,o.call(this,t,l,n,p,u),this.collideConnected=!!r.collideConnected,this.angle=void 0!==r.angle?r.angle:0;var f=this.coneEquation=new i(t,n,r),h=this.twistEquation=new a(t,n,r);this.twistAngle=void 0!==r.twistAngle?r.twistAngle:0,f.maxForce=0,f.minForce=-u,h.maxForce=0,h.minForce=-u,this.equations.push(f,h)}ConeTwistConstraint.prototype=new o,ConeTwistConstraint.constructor=ConeTwistConstraint,new c,new c,ConeTwistConstraint.prototype.update=function(){var t=this.bodyA,n=this.bodyB,r=this.coneEquation,i=this.twistEquation;o.prototype.update.call(this),t.vectorToWorldFrame(this.axisA,r.axisA),n.vectorToWorldFrame(this.axisB,r.axisB),this.axisA.tangents(i.axisA,i.axisA),t.vectorToWorldFrame(i.axisA,i.axisA),this.axisB.tangents(i.axisB,i.axisB),n.vectorToWorldFrame(i.axisB,i.axisB),r.angle=this.angle,i.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,n,r){n.exports=Constraint;var o=t("../utils/Utils");function Constraint(t,n,r){r=o.defaults(r,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=n,this.id=Constraint.idCounter++,this.collideConnected=r.collideConnected,r.wakeUpBodies&&(t&&t.wakeUp(),n&&n.wakeUp())}Constraint.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},Constraint.prototype.enable=function(){for(var t=this.equations,n=0;n<t.length;n++)t[n].enabled=!0},Constraint.prototype.disable=function(){for(var t=this.equations,n=0;n<t.length;n++)t[n].enabled=!1},Constraint.idCounter=0},{"../utils/Utils":53}],14:[function(t,n,r){n.exports=DistanceConstraint;var o=t("./Constraint"),i=t("../equations/ContactEquation");function DistanceConstraint(t,n,r,a){o.call(this,t,n),void 0===r&&(r=t.position.distanceTo(n.position)),void 0===a&&(a=1e6),this.distance=r;var c=this.distanceEquation=new i(t,n);this.equations.push(c),c.minForce=-a,c.maxForce=a}DistanceConstraint.prototype=new o,DistanceConstraint.prototype.update=function(){var t=this.bodyA,n=this.bodyB,r=this.distanceEquation,o=.5*this.distance,i=r.ni;n.position.vsub(t.position,i),i.normalize(),i.mult(o,r.ri),i.mult(-o,r.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,n,r){n.exports=HingeConstraint,t("./Constraint");var o=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation"),a=t("../equations/RotationalMotorEquation"),c=(t("../equations/ContactEquation"),t("../math/Vec3"));function HingeConstraint(t,n,r){var u=void 0!==(r=r||{}).maxForce?r.maxForce:1e6,l=r.pivotA?r.pivotA.clone():new c,p=r.pivotB?r.pivotB.clone():new c;o.call(this,t,l,n,p,u),(this.axisA=r.axisA?r.axisA.clone():new c(1,0,0)).normalize(),(this.axisB=r.axisB?r.axisB.clone():new c(1,0,0)).normalize();var f=this.rotationalEquation1=new i(t,n,r),h=this.rotationalEquation2=new i(t,n,r),d=this.motorEquation=new a(t,n,u);d.enabled=!1,this.equations.push(f,h,d)}HingeConstraint.prototype=new o,HingeConstraint.constructor=HingeConstraint,HingeConstraint.prototype.enableMotor=function(){this.motorEquation.enabled=!0},HingeConstraint.prototype.disableMotor=function(){this.motorEquation.enabled=!1},HingeConstraint.prototype.setMotorSpeed=function(t){this.motorEquation.targetVelocity=t},HingeConstraint.prototype.setMotorMaxForce=function(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t};var u=new c,l=new c;HingeConstraint.prototype.update=function(){var t=this.bodyA,n=this.bodyB,r=this.motorEquation,i=this.rotationalEquation1,a=this.rotationalEquation2,c=u,p=l,f=this.axisA,h=this.axisB;o.prototype.update.call(this),t.quaternion.vmult(f,c),n.quaternion.vmult(h,p),c.tangents(i.axisA,a.axisA),i.axisB.copy(p),a.axisB.copy(p),this.motorEquation.enabled&&(t.quaternion.vmult(this.axisA,r.axisA),n.quaternion.vmult(this.axisB,r.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,n,r){n.exports=LockConstraint,t("./Constraint");var o=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation"),a=(t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation"),t("../math/Vec3"));function LockConstraint(t,n,r){var c=void 0!==(r=r||{}).maxForce?r.maxForce:1e6,u=new a,l=new a,p=new a;t.position.vadd(n.position,p),p.scale(.5,p),n.pointToLocalFrame(p,l),t.pointToLocalFrame(p,u),o.call(this,t,u,n,l,c);var f=this.rotationalEquation1=new i(t,n,r),h=this.rotationalEquation2=new i(t,n,r),d=this.rotationalEquation3=new i(t,n,r);this.equations.push(f,h,d)}LockConstraint.prototype=new o,LockConstraint.constructor=LockConstraint,new a,new a,LockConstraint.prototype.update=function(){var t=this.bodyA,n=this.bodyB,r=(this.motorEquation,this.rotationalEquation1),i=this.rotationalEquation2,c=this.rotationalEquation3;o.prototype.update.call(this),t.vectorToWorldFrame(a.UNIT_X,r.axisA),n.vectorToWorldFrame(a.UNIT_Y,r.axisB),t.vectorToWorldFrame(a.UNIT_Y,i.axisA),n.vectorToWorldFrame(a.UNIT_Z,i.axisB),t.vectorToWorldFrame(a.UNIT_Z,c.axisA),n.vectorToWorldFrame(a.UNIT_X,c.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,n,r){n.exports=PointToPointConstraint;var o=t("./Constraint"),i=t("../equations/ContactEquation"),a=t("../math/Vec3");function PointToPointConstraint(t,n,r,c,u){o.call(this,t,r),u=void 0!==u?u:1e6,this.pivotA=n?n.clone():new a,this.pivotB=c?c.clone():new a;var l=this.equationX=new i(t,r),p=this.equationY=new i(t,r),f=this.equationZ=new i(t,r);this.equations.push(l,p,f),l.minForce=p.minForce=f.minForce=-u,l.maxForce=p.maxForce=f.maxForce=u,l.ni.set(1,0,0),p.ni.set(0,1,0),f.ni.set(0,0,1)}PointToPointConstraint.prototype=new o,PointToPointConstraint.prototype.update=function(){var t=this.bodyA,n=this.bodyB,r=this.equationX,o=this.equationY,i=this.equationZ;t.quaternion.vmult(this.pivotA,r.ri),n.quaternion.vmult(this.pivotB,r.rj),o.ri.copy(r.ri),o.rj.copy(r.rj),i.ri.copy(r.ri),i.rj.copy(r.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,n,r){n.exports=ConeEquation;var o=t("../math/Vec3"),i=(t("../math/Mat3"),t("./Equation"));function ConeEquation(t,n,r){var a=void 0!==(r=r||{}).maxForce?r.maxForce:1e6;i.call(this,t,n,-a,a),this.axisA=r.axisA?r.axisA.clone():new o(1,0,0),this.axisB=r.axisB?r.axisB.clone():new o(0,1,0),this.angle=void 0!==r.angle?r.angle:0}ConeEquation.prototype=new i,ConeEquation.prototype.constructor=ConeEquation;var a=new o,c=new o;ConeEquation.prototype.computeB=function(t){var n=this.a,r=this.b,o=this.axisA,i=this.axisB,u=a,l=c,p=this.jacobianElementA,f=this.jacobianElementB;return o.cross(i,u),i.cross(o,l),p.rotational.copy(l),f.rotational.copy(u),-(Math.cos(this.angle)-o.dot(i))*n-this.computeGW()*r-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,n,r){n.exports=ContactEquation;var o=t("./Equation"),i=t("../math/Vec3");function ContactEquation(t,n,r){r=void 0!==r?r:1e6,o.call(this,t,n,0,r),this.restitution=0,this.ri=new i,this.rj=new i,this.ni=new i}t("../math/Mat3"),ContactEquation.prototype=new o,ContactEquation.prototype.constructor=ContactEquation;var a=new i,c=new i,u=new i;ContactEquation.prototype.computeB=function(t){var n=this.a,r=this.b,o=this.bi,i=this.bj,l=this.ri,p=this.rj,f=a,h=c,d=o.velocity,y=o.angularVelocity,m=(o.force,o.torque,i.velocity),v=i.angularVelocity,g=(i.force,i.torque,u),_=this.jacobianElementA,b=this.jacobianElementB,w=this.ni;l.cross(w,f),p.cross(w,h),w.negate(_.spatial),f.negate(_.rotational),b.spatial.copy(w),b.rotational.copy(h),g.copy(i.position),g.vadd(p,g),g.vsub(o.position,g),g.vsub(l,g);var x=w.dot(g),P=this.restitution+1;return-x*n-(P*m.dot(w)-P*d.dot(w)+v.dot(h)-y.dot(f))*r-t*this.computeGiMf()};var l=new i,p=new i,f=new i,h=new i,d=new i;ContactEquation.prototype.getImpactVelocityAlongNormal=function(){var t=l,n=p,r=f,o=h,i=d;return this.bi.position.vadd(this.ri,r),this.bj.position.vadd(this.rj,o),this.bi.getVelocityAtWorldPoint(r,t),this.bj.getVelocityAtWorldPoint(o,n),t.vsub(n,i),this.ni.dot(i)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,n,r){n.exports=Equation;var o=t("../math/JacobianElement"),i=t("../math/Vec3");function Equation(t,n,r,i){this.id=Equation.id++,this.minForce=void 0===r?-1e6:r,this.maxForce=void 0===i?1e6:i,this.bi=t,this.bj=n,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new o,this.jacobianElementB=new o,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}Equation.prototype.constructor=Equation,Equation.id=0,Equation.prototype.setSpookParams=function(t,n,r){var o=n,i=t,a=r;this.a=4/(a*(1+4*o)),this.b=4*o/(1+4*o),this.eps=4/(a*a*i*(1+4*o))},Equation.prototype.computeB=function(t,n,r){var o=this.computeGW();return-this.computeGq()*t-o*n-this.computeGiMf()*r},Equation.prototype.computeGq=function(){var t=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,o=this.bj,i=r.position,a=o.position;return t.spatial.dot(i)+n.spatial.dot(a)};var a=new i;Equation.prototype.computeGW=function(){var t=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,o=this.bj,i=r.velocity,c=o.velocity,u=r.angularVelocity||a,l=o.angularVelocity||a;return t.multiplyVectors(i,u)+n.multiplyVectors(c,l)},Equation.prototype.computeGWlambda=function(){var t=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,o=this.bj,i=r.vlambda,c=o.vlambda,u=r.wlambda||a,l=o.wlambda||a;return t.multiplyVectors(i,u)+n.multiplyVectors(c,l)};var c=new i,u=new i,l=new i,p=new i;Equation.prototype.computeGiMf=function(){var t=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,o=this.bj,i=r.force,a=r.torque,f=o.force,h=o.torque,d=r.invMassSolve,y=o.invMassSolve;return r.invInertiaWorldSolve?r.invInertiaWorldSolve.vmult(a,l):l.set(0,0,0),o.invInertiaWorldSolve?o.invInertiaWorldSolve.vmult(h,p):p.set(0,0,0),i.mult(d,c),f.mult(y,u),t.multiplyVectors(c,l)+n.multiplyVectors(u,p)};var f=new i;Equation.prototype.computeGiMGt=function(){var t=this.jacobianElementA,n=this.jacobianElementB,r=this.bi,o=this.bj,i=r.invMassSolve,a=o.invMassSolve,c=r.invInertiaWorldSolve,u=o.invInertiaWorldSolve,l=i+a;return c&&(c.vmult(t.rotational,f),l+=f.dot(t.rotational)),u&&(u.vmult(n.rotational,f),l+=f.dot(n.rotational)),l};var h=new i;new i,new i,new i,new i,new i,Equation.prototype.addToWlambda=function(t){var n=this.jacobianElementA,r=this.jacobianElementB,o=this.bi,i=this.bj,a=h;n.spatial.mult(o.invMassSolve*t,a),o.vlambda.vadd(a,o.vlambda),r.spatial.mult(i.invMassSolve*t,a),i.vlambda.vadd(a,i.vlambda),o.invInertiaWorldSolve&&(o.invInertiaWorldSolve.vmult(n.rotational,a),a.mult(t,a),o.wlambda.vadd(a,o.wlambda)),i.invInertiaWorldSolve&&(i.invInertiaWorldSolve.vmult(r.rotational,a),a.mult(t,a),i.wlambda.vadd(a,i.wlambda))},Equation.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,n,r){n.exports=FrictionEquation;var o=t("./Equation"),i=t("../math/Vec3");function FrictionEquation(t,n,r){o.call(this,t,n,-r,r),this.ri=new i,this.rj=new i,this.t=new i}t("../math/Mat3"),FrictionEquation.prototype=new o,FrictionEquation.prototype.constructor=FrictionEquation;var a=new i,c=new i;FrictionEquation.prototype.computeB=function(t){this.a;var n=this.b,r=(this.bi,this.bj,this.ri),o=this.rj,i=a,u=c,l=this.t;r.cross(l,i),o.cross(l,u);var p=this.jacobianElementA,f=this.jacobianElementB;return l.negate(p.spatial),i.negate(p.rotational),f.spatial.copy(l),f.rotational.copy(u),-this.computeGW()*n-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,n,r){n.exports=RotationalEquation;var o=t("../math/Vec3"),i=(t("../math/Mat3"),t("./Equation"));function RotationalEquation(t,n,r){var a=void 0!==(r=r||{}).maxForce?r.maxForce:1e6;i.call(this,t,n,-a,a),this.axisA=r.axisA?r.axisA.clone():new o(1,0,0),this.axisB=r.axisB?r.axisB.clone():new o(0,1,0),this.maxAngle=Math.PI/2}RotationalEquation.prototype=new i,RotationalEquation.prototype.constructor=RotationalEquation;var a=new o,c=new o;RotationalEquation.prototype.computeB=function(t){var n=this.a,r=this.b,o=this.axisA,i=this.axisB,u=a,l=c,p=this.jacobianElementA,f=this.jacobianElementB;return o.cross(i,u),i.cross(o,l),p.rotational.copy(l),f.rotational.copy(u),-(Math.cos(this.maxAngle)-o.dot(i))*n-this.computeGW()*r-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,n,r){n.exports=RotationalMotorEquation;var o=t("../math/Vec3"),i=(t("../math/Mat3"),t("./Equation"));function RotationalMotorEquation(t,n,r){r=void 0!==r?r:1e6,i.call(this,t,n,-r,r),this.axisA=new o,this.axisB=new o,this.targetVelocity=0}RotationalMotorEquation.prototype=new i,RotationalMotorEquation.prototype.constructor=RotationalMotorEquation,RotationalMotorEquation.prototype.computeB=function(t){this.a;var n=this.b,r=(this.bi,this.bj,this.axisA),o=this.axisB,i=this.jacobianElementA,a=this.jacobianElementB;return i.rotational.copy(r),o.negate(a.rotational),-(this.computeGW()-this.targetVelocity)*n-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,n,r){var o=t("../utils/Utils");function ContactMaterial(t,n,r){r=o.defaults(r,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=ContactMaterial.idCounter++,this.materials=[t,n],this.friction=r.friction,this.restitution=r.restitution,this.contactEquationStiffness=r.contactEquationStiffness,this.contactEquationRelaxation=r.contactEquationRelaxation,this.frictionEquationStiffness=r.frictionEquationStiffness,this.frictionEquationRelaxation=r.frictionEquationRelaxation}n.exports=ContactMaterial,ContactMaterial.idCounter=0},{"../utils/Utils":53}],25:[function(t,n,r){function Material(t){var n="";"string"==typeof(t=t||{})?(n=t,t={}):"object"==typeof t&&(n=""),this.name=n,this.id=Material.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}n.exports=Material,Material.idCounter=0},{}],26:[function(t,n,r){n.exports=JacobianElement;var o=t("./Vec3");function JacobianElement(){this.spatial=new o,this.rotational=new o}JacobianElement.prototype.multiplyElement=function(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)},JacobianElement.prototype.multiplyVectors=function(t,n){return t.dot(this.spatial)+n.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,n,r){n.exports=Mat3;var o=t("./Vec3");function Mat3(t){this.elements=t||[0,0,0,0,0,0,0,0,0]}Mat3.prototype.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},Mat3.prototype.setZero=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0},Mat3.prototype.setTrace=function(t){var n=this.elements;n[0]=t.x,n[4]=t.y,n[8]=t.z},Mat3.prototype.getTrace=function(t){t=t||new o;var n=this.elements;t.x=n[0],t.y=n[4],t.z=n[8]},Mat3.prototype.vmult=function(t,n){n=n||new o;var r=this.elements,i=t.x,a=t.y,c=t.z;return n.x=r[0]*i+r[1]*a+r[2]*c,n.y=r[3]*i+r[4]*a+r[5]*c,n.z=r[6]*i+r[7]*a+r[8]*c,n},Mat3.prototype.smult=function(t){for(var n=0;n<this.elements.length;n++)this.elements[n]*=t},Mat3.prototype.mmult=function(t,n){for(var r=n||new Mat3,o=0;o<3;o++)for(var i=0;i<3;i++){for(var a=0,c=0;c<3;c++)a+=t.elements[o+3*c]*this.elements[c+3*i];r.elements[o+3*i]=a}return r},Mat3.prototype.scale=function(t,n){n=n||new Mat3;for(var r=this.elements,o=n.elements,i=0;3!==i;i++)o[3*i+0]=t.x*r[3*i+0],o[3*i+1]=t.y*r[3*i+1],o[3*i+2]=t.z*r[3*i+2];return n},Mat3.prototype.solve=function(t,n){n=n||new o;for(var r,i=[],a=0;a<12;a++)i.push(0);for(a=0;a<3;a++)for(r=0;r<3;r++)i[a+4*r]=this.elements[a+3*r];i[3]=t.x,i[7]=t.y,i[11]=t.z;var c,u,l=3,p=l;do{if(0===i[(a=p-l)+4*a])for(r=a+1;r<p;r++)if(0!==i[a+4*r]){c=4;do{i[(u=4-c)+4*a]+=i[u+4*r]}while(--c);break}if(0!==i[a+4*a])for(r=a+1;r<p;r++){var f=i[a+4*r]/i[a+4*a];c=4;do{i[(u=4-c)+4*r]=u<=a?0:i[u+4*r]-i[u+4*a]*f}while(--c)}}while(--l);if(n.z=i[11]/i[10],n.y=(i[7]-i[6]*n.z)/i[5],n.x=(i[3]-i[2]*n.z-i[1]*n.y)/i[0],isNaN(n.x)||isNaN(n.y)||isNaN(n.z)||n.x===1/0||n.y===1/0||n.z===1/0)throw"Could not solve equation! Got x=["+n.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]";return n},Mat3.prototype.e=function(t,n,r){if(void 0===r)return this.elements[n+3*t];this.elements[n+3*t]=r},Mat3.prototype.copy=function(t){for(var n=0;n<t.elements.length;n++)this.elements[n]=t.elements[n];return this},Mat3.prototype.toString=function(){for(var t="",n=0;n<9;n++)t+=this.elements[n]+",";return t},Mat3.prototype.reverse=function(t){t=t||new Mat3;for(var n,r=[],o=0;o<18;o++)r.push(0);for(o=0;o<3;o++)for(n=0;n<3;n++)r[o+6*n]=this.elements[o+3*n];r[3]=1,r[9]=0,r[15]=0,r[4]=0,r[10]=1,r[16]=0,r[5]=0,r[11]=0,r[17]=1;var i,a,c=3,u=c;do{if(0===r[(o=u-c)+6*o])for(n=o+1;n<u;n++)if(0!==r[o+6*n]){i=6;do{r[(a=6-i)+6*o]+=r[a+6*n]}while(--i);break}if(0!==r[o+6*o])for(n=o+1;n<u;n++){var l=r[o+6*n]/r[o+6*o];i=6;do{r[(a=6-i)+6*n]=a<=o?0:r[a+6*n]-r[a+6*o]*l}while(--i)}}while(--c);o=2;do{n=o-1;do{l=r[o+6*n]/r[o+6*o],i=6;do{r[(a=6-i)+6*n]=r[a+6*n]-r[a+6*o]*l}while(--i)}while(n--)}while(--o);o=2;do{l=1/r[o+6*o],i=6;do{r[(a=6-i)+6*o]=r[a+6*o]*l}while(--i)}while(o--);o=2;do{n=2;do{if(a=r[3+n+6*o],isNaN(a)||a===1/0)throw"Could not reverse! A=["+this.toString()+"]";t.e(o,n,a)}while(n--)}while(o--);return t},Mat3.prototype.setRotationFromQuaternion=function(t){var n=t.x,r=t.y,o=t.z,i=t.w,a=n+n,c=r+r,u=o+o,l=n*a,p=n*c,f=n*u,h=r*c,d=r*u,y=o*u,m=i*a,v=i*c,g=i*u,_=this.elements;return _[0]=1-(h+y),_[1]=p-g,_[2]=f+v,_[3]=p+g,_[4]=1-(l+y),_[5]=d-m,_[6]=f-v,_[7]=d+m,_[8]=1-(l+h),this},Mat3.prototype.transpose=function(t){for(var n=(t=t||new Mat3).elements,r=this.elements,o=0;3!==o;o++)for(var i=0;3!==i;i++)n[3*o+i]=r[3*i+o];return t}},{"./Vec3":30}],28:[function(t,n,r){n.exports=Quaternion;var o=t("./Vec3");function Quaternion(t,n,r,o){this.x=void 0!==t?t:0,this.y=void 0!==n?n:0,this.z=void 0!==r?r:0,this.w=void 0!==o?o:1}Quaternion.prototype.set=function(t,n,r,o){this.x=t,this.y=n,this.z=r,this.w=o},Quaternion.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},Quaternion.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},Quaternion.prototype.setFromAxisAngle=function(t,n){var r=Math.sin(.5*n);this.x=t.x*r,this.y=t.y*r,this.z=t.z*r,this.w=Math.cos(.5*n)},Quaternion.prototype.toAxisAngle=function(t){t=t||new o,this.normalize();var n=2*Math.acos(this.w),r=Math.sqrt(1-this.w*this.w);return r<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/r,t.y=this.y/r,t.z=this.z/r),[t,n]};var i=new o,a=new o;Quaternion.prototype.setFromVectors=function(t,n){if(t.isAntiparallelTo(n)){var r=i,o=a;t.tangents(r,o),this.setFromAxisAngle(r,Math.PI)}else{var c=t.cross(n);this.x=c.x,this.y=c.y,this.z=c.z,this.w=Math.sqrt(Math.pow(t.norm(),2)*Math.pow(n.norm(),2))+t.dot(n),this.normalize()}};var c=new o,u=new o,l=new o;Quaternion.prototype.mult=function(t,n){n=n||new Quaternion;var r=this.w,o=c,i=u,a=l;return o.set(this.x,this.y,this.z),i.set(t.x,t.y,t.z),n.w=r*t.w-o.dot(i),o.cross(i,a),n.x=r*i.x+t.w*o.x+a.x,n.y=r*i.y+t.w*o.y+a.y,n.z=r*i.z+t.w*o.z+a.z,n},Quaternion.prototype.inverse=function(t){var n=this.x,r=this.y,o=this.z,i=this.w;t=t||new Quaternion,this.conjugate(t);var a=1/(n*n+r*r+o*o+i*i);return t.x*=a,t.y*=a,t.z*=a,t.w*=a,t},Quaternion.prototype.conjugate=function(t){return(t=t||new Quaternion).x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t},Quaternion.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t)},Quaternion.prototype.normalizeFast=function(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t)},Quaternion.prototype.vmult=function(t,n){n=n||new o;var r=t.x,i=t.y,a=t.z,c=this.x,u=this.y,l=this.z,p=this.w,f=p*r+u*a-l*i,h=p*i+l*r-c*a,d=p*a+c*i-u*r,y=-c*r-u*i-l*a;return n.x=f*p+y*-c+h*-l-d*-u,n.y=h*p+y*-u+d*-c-f*-l,n.z=d*p+y*-l+f*-u-h*-c,n},Quaternion.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},Quaternion.prototype.toEuler=function(t,n){var r,o,i;n=n||"YZX";var a=this.x,c=this.y,u=this.z,l=this.w;switch(n){case"YZX":var p=a*c+u*l;if(p>.499&&(r=2*Math.atan2(a,l),o=Math.PI/2,i=0),p<-.499&&(r=-2*Math.atan2(a,l),o=-Math.PI/2,i=0),isNaN(r)){var f=a*a,h=c*c,d=u*u;r=Math.atan2(2*c*l-2*a*u,1-2*h-2*d),o=Math.asin(2*p),i=Math.atan2(2*a*l-2*c*u,1-2*f-2*d)}break;default:throw new Error("Euler order "+n+" not supported yet.")}t.y=r,t.z=o,t.x=i},Quaternion.prototype.setFromEuler=function(t,n,r,o){o=o||"XYZ";var i=Math.cos(t/2),a=Math.cos(n/2),c=Math.cos(r/2),u=Math.sin(t/2),l=Math.sin(n/2),p=Math.sin(r/2);return"XYZ"===o?(this.x=u*a*c+i*l*p,this.y=i*l*c-u*a*p,this.z=i*a*p+u*l*c,this.w=i*a*c-u*l*p):"YXZ"===o?(this.x=u*a*c+i*l*p,this.y=i*l*c-u*a*p,this.z=i*a*p-u*l*c,this.w=i*a*c+u*l*p):"ZXY"===o?(this.x=u*a*c-i*l*p,this.y=i*l*c+u*a*p,this.z=i*a*p+u*l*c,this.w=i*a*c-u*l*p):"ZYX"===o?(this.x=u*a*c-i*l*p,this.y=i*l*c+u*a*p,this.z=i*a*p-u*l*c,this.w=i*a*c+u*l*p):"YZX"===o?(this.x=u*a*c+i*l*p,this.y=i*l*c+u*a*p,this.z=i*a*p-u*l*c,this.w=i*a*c-u*l*p):"XZY"===o&&(this.x=u*a*c-i*l*p,this.y=i*l*c-u*a*p,this.z=i*a*p+u*l*c,this.w=i*a*c+u*l*p),this},Quaternion.prototype.clone=function(){return new Quaternion(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,n,r){var o=t("./Vec3"),i=t("./Quaternion");function Transform(t){t=t||{},this.position=new o,t.position&&this.position.copy(t.position),this.quaternion=new i,t.quaternion&&this.quaternion.copy(t.quaternion)}n.exports=Transform;var a=new i;Transform.pointToLocalFrame=function(t,n,r,i){return i=i||new o,r.vsub(t,i),n.conjugate(a),a.vmult(i,i),i},Transform.prototype.pointToLocal=function(t,n){return Transform.pointToLocalFrame(this.position,this.quaternion,t,n)},Transform.pointToWorldFrame=function(t,n,r,i){return i=i||new o,n.vmult(r,i),i.vadd(t,i),i},Transform.prototype.pointToWorld=function(t,n){return Transform.pointToWorldFrame(this.position,this.quaternion,t,n)},Transform.prototype.vectorToWorldFrame=function(t,n){return n=n||new o,this.quaternion.vmult(t,n),n},Transform.vectorToWorldFrame=function(t,n,r){return t.vmult(n,r),r},Transform.vectorToLocalFrame=function(t,n,r,i){return i=i||new o,n.w*=-1,n.vmult(r,i),n.w*=-1,i}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,n,r){n.exports=Vec3;var o=t("./Mat3");function Vec3(t,n,r){this.x=t||0,this.y=n||0,this.z=r||0}Vec3.ZERO=new Vec3(0,0,0),Vec3.UNIT_X=new Vec3(1,0,0),Vec3.UNIT_Y=new Vec3(0,1,0),Vec3.UNIT_Z=new Vec3(0,0,1),Vec3.prototype.cross=function(t,n){var r=t.x,o=t.y,i=t.z,a=this.x,c=this.y,u=this.z;return(n=n||new Vec3).x=c*i-u*o,n.y=u*r-a*i,n.z=a*o-c*r,n},Vec3.prototype.set=function(t,n,r){return this.x=t,this.y=n,this.z=r,this},Vec3.prototype.setZero=function(){this.x=this.y=this.z=0},Vec3.prototype.vadd=function(t,n){if(!n)return new Vec3(this.x+t.x,this.y+t.y,this.z+t.z);n.x=t.x+this.x,n.y=t.y+this.y,n.z=t.z+this.z},Vec3.prototype.vsub=function(t,n){if(!n)return new Vec3(this.x-t.x,this.y-t.y,this.z-t.z);n.x=this.x-t.x,n.y=this.y-t.y,n.z=this.z-t.z},Vec3.prototype.crossmat=function(){return new o([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},Vec3.prototype.normalize=function(){var t=this.x,n=this.y,r=this.z,o=Math.sqrt(t*t+n*n+r*r);if(o>0){var i=1/o;this.x*=i,this.y*=i,this.z*=i}else this.x=0,this.y=0,this.z=0;return o},Vec3.prototype.unit=function(t){t=t||new Vec3;var n=this.x,r=this.y,o=this.z,i=Math.sqrt(n*n+r*r+o*o);return i>0?(i=1/i,t.x=n*i,t.y=r*i,t.z=o*i):(t.x=1,t.y=0,t.z=0),t},Vec3.prototype.norm=function(){var t=this.x,n=this.y,r=this.z;return Math.sqrt(t*t+n*n+r*r)},Vec3.prototype.length=Vec3.prototype.norm,Vec3.prototype.norm2=function(){return this.dot(this)},Vec3.prototype.lengthSquared=Vec3.prototype.norm2,Vec3.prototype.distanceTo=function(t){var n=this.x,r=this.y,o=this.z,i=t.x,a=t.y,c=t.z;return Math.sqrt((i-n)*(i-n)+(a-r)*(a-r)+(c-o)*(c-o))},Vec3.prototype.distanceSquared=function(t){var n=this.x,r=this.y,o=this.z,i=t.x,a=t.y,c=t.z;return(i-n)*(i-n)+(a-r)*(a-r)+(c-o)*(c-o)},Vec3.prototype.mult=function(t,n){n=n||new Vec3;var r=this.x,o=this.y,i=this.z;return n.x=t*r,n.y=t*o,n.z=t*i,n},Vec3.prototype.scale=Vec3.prototype.mult,Vec3.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},Vec3.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},Vec3.prototype.negate=function(t){return(t=t||new Vec3).x=-this.x,t.y=-this.y,t.z=-this.z,t};var i=new Vec3,a=new Vec3;Vec3.prototype.tangents=function(t,n){var r=this.norm();if(r>0){var o=i,c=1/r;o.set(this.x*c,this.y*c,this.z*c);var u=a;Math.abs(o.x)<.9?(u.set(1,0,0),o.cross(u,t)):(u.set(0,1,0),o.cross(u,t)),o.cross(t,n)}else t.set(1,0,0),n.set(0,1,0)},Vec3.prototype.toString=function(){return this.x+","+this.y+","+this.z},Vec3.prototype.toArray=function(){return[this.x,this.y,this.z]},Vec3.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},Vec3.prototype.lerp=function(t,n,r){var o=this.x,i=this.y,a=this.z;r.x=o+(t.x-o)*n,r.y=i+(t.y-i)*n,r.z=a+(t.z-a)*n},Vec3.prototype.almostEquals=function(t,n){return void 0===n&&(n=1e-6),!(Math.abs(this.x-t.x)>n||Math.abs(this.y-t.y)>n||Math.abs(this.z-t.z)>n)},Vec3.prototype.almostZero=function(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)};var c=new Vec3;Vec3.prototype.isAntiparallelTo=function(t,n){return this.negate(c),c.almostEquals(t,n)},Vec3.prototype.clone=function(){return new Vec3(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,n,r){n.exports=Body;var o=t("../utils/EventTarget"),i=(t("../shapes/Shape"),t("../math/Vec3")),a=t("../math/Mat3"),c=t("../math/Quaternion"),u=(t("../material/Material"),t("../collision/AABB")),l=t("../shapes/Box");function Body(t){t=t||{},o.apply(this),this.id=Body.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new i,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:1,this.collisionResponse=!0,this.position=new i,t.position&&this.position.copy(t.position),this.previousPosition=new i,this.initPosition=new i,this.velocity=new i,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new i,this.force=new i;var n="number"==typeof t.mass?t.mass:0;this.mass=n,this.invMass=n>0?1/n:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=n<=0?Body.STATIC:Body.DYNAMIC,typeof t.type==typeof Body.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new i,this.quaternion=new c,t.quaternion&&this.quaternion.copy(t.quaternion),this.initQuaternion=new c,this.angularVelocity=new i,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new i,this.interpolatedPosition=new i,this.interpolatedQuaternion=new c,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new i,this.invInertia=new i,this.invInertiaWorld=new a,this.invMassSolve=0,this.invInertiaSolve=new i,this.invInertiaWorldSolve=new a,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.aabb=new u,this.aabbNeedsUpdate=!0,this.wlambda=new i,t.shape&&this.addShape(t.shape),this.updateMassProperties()}Body.prototype=new o,Body.prototype.constructor=Body,Body.DYNAMIC=1,Body.STATIC=2,Body.KINEMATIC=4,Body.AWAKE=0,Body.SLEEPY=1,Body.SLEEPING=2,Body.idCounter=0,Body.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=0,t===Body.SLEEPING&&this.dispatchEvent({type:"wakeup"})},Body.prototype.sleep=function(){this.sleepState=Body.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},Body.sleepyEvent={type:"sleepy"},Body.sleepEvent={type:"sleep"},Body.prototype.sleepTick=function(t){if(this.allowSleep){var n=this.sleepState,r=this.velocity.norm2()+this.angularVelocity.norm2(),o=Math.pow(this.sleepSpeedLimit,2);n===Body.AWAKE&&r<o?(this.sleepState=Body.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(Body.sleepyEvent)):n===Body.SLEEPY&&r>o?this.wakeUp():n===Body.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(Body.sleepEvent))}},Body.prototype.updateSolveMassProperties=function(){this.sleepState===Body.SLEEPING||this.type===Body.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},Body.prototype.pointToLocalFrame=function(t,n){return n=n||new i,t.vsub(this.position,n),this.quaternion.conjugate().vmult(n,n),n},Body.prototype.vectorToLocalFrame=function(t,n){return n=n||new i,this.quaternion.conjugate().vmult(t,n),n},Body.prototype.pointToWorldFrame=function(t,n){return n=n||new i,this.quaternion.vmult(t,n),n.vadd(this.position,n),n},Body.prototype.vectorToWorldFrame=function(t,n){return n=n||new i,this.quaternion.vmult(t,n),n};var p=new i,f=new c;Body.prototype.addShape=function(t,n,r){var o=new i,a=new c;return n&&o.copy(n),r&&a.copy(r),this.shapes.push(t),this.shapeOffsets.push(o),this.shapeOrientations.push(a),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},Body.prototype.updateBoundingRadius=function(){for(var t=this.shapes,n=this.shapeOffsets,r=t.length,o=0,i=0;i!==r;i++){var a=t[i];a.updateBoundingSphereRadius();var c=n[i].norm(),u=a.boundingSphereRadius;c+u>o&&(o=c+u)}this.boundingRadius=o};var h=new u;Body.prototype.computeAABB=function(){for(var t=this.shapes,n=this.shapeOffsets,r=this.shapeOrientations,o=t.length,i=p,a=f,c=this.quaternion,u=this.aabb,l=h,d=0;d!==o;d++){var y=t[d];r[d].mult(c,a),a.vmult(n[d],i),i.vadd(this.position,i),y.calculateWorldAABB(i,a,l.lowerBound,l.upperBound),0===d?u.copy(l):u.extend(l)}this.aabbNeedsUpdate=!1};var d=new a,y=new a;new a,Body.prototype.updateInertiaWorld=function(t){var n=this.invInertia;if(n.x!==n.y||n.y!==n.z||t){var r=d,o=y;r.setRotationFromQuaternion(this.quaternion),r.transpose(o),r.scale(n,r),r.mmult(o,this.invInertiaWorld)}};var m=new i,v=new i;Body.prototype.applyForce=function(t,n){if(this.type===Body.DYNAMIC){var r=m;n.vsub(this.position,r);var o=v;r.cross(t,o),this.force.vadd(t,this.force),this.torque.vadd(o,this.torque)}};var g=new i,_=new i;Body.prototype.applyLocalForce=function(t,n){if(this.type===Body.DYNAMIC){var r=g,o=_;this.vectorToWorldFrame(t,r),this.pointToWorldFrame(n,o),this.applyForce(r,o)}};var b=new i,w=new i,x=new i;Body.prototype.applyImpulse=function(t,n){if(this.type===Body.DYNAMIC){var r=b;n.vsub(this.position,r);var o=w;o.copy(t),o.mult(this.invMass,o),this.velocity.vadd(o,this.velocity);var i=x;r.cross(t,i),this.invInertiaWorld.vmult(i,i),this.angularVelocity.vadd(i,this.angularVelocity)}};var P=new i,O=new i;Body.prototype.applyLocalImpulse=function(t,n){if(this.type===Body.DYNAMIC){var r=P,o=O;this.vectorToWorldFrame(t,r),this.pointToWorldFrame(n,o),this.applyImpulse(r,o)}};var C=new i;Body.prototype.updateMassProperties=function(){var t=C;this.invMass=this.mass>0?1/this.mass:0;var n=this.inertia,r=this.fixedRotation;this.computeAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),l.calculateInertia(t,this.mass,n),this.invInertia.set(n.x>0&&!r?1/n.x:0,n.y>0&&!r?1/n.y:0,n.z>0&&!r?1/n.z:0),this.updateInertiaWorld(!0)},Body.prototype.getVelocityAtWorldPoint=function(t,n){var r=new i;return t.vsub(this.position,r),this.angularVelocity.cross(r,n),this.velocity.vadd(n,n),n}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,n,r){t("./Body");var o=t("../math/Vec3"),i=t("../math/Quaternion"),a=(t("../collision/RaycastResult"),t("../collision/Ray")),c=t("../objects/WheelInfo");function RaycastVehicle(t){this.chassisBody=t.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==t.indexRightAxis?t.indexRightAxis:1,this.indexForwardAxis=void 0!==t.indexForwardAxis?t.indexForwardAxis:0,this.indexUpAxis=void 0!==t.indexUpAxis?t.indexUpAxis:2}n.exports=RaycastVehicle,new o,new o,new o;var u=new o,l=new o,p=new o;new a,RaycastVehicle.prototype.addWheel=function(t){var n=new c(t=t||{}),r=this.wheelInfos.length;return this.wheelInfos.push(n),r},RaycastVehicle.prototype.setSteeringValue=function(t,n){this.wheelInfos[n].steering=t},new o,RaycastVehicle.prototype.applyEngineForce=function(t,n){this.wheelInfos[n].engineForce=t},RaycastVehicle.prototype.setBrake=function(t,n){this.wheelInfos[n].brake=t},RaycastVehicle.prototype.addToWorld=function(t){this.constraints,t.add(this.chassisBody);var n=this;this.preStepCallback=function(){n.updateVehicle(t.dt)},t.addEventListener("preStep",this.preStepCallback),this.world=t},RaycastVehicle.prototype.getVehicleAxisWorld=function(t,n){n.set(0===t?1:0,1===t?1:0,2===t?1:0),this.chassisBody.vectorToWorldFrame(n,n)},RaycastVehicle.prototype.updateVehicle=function(t){for(var n=this.wheelInfos,r=n.length,i=this.chassisBody,a=0;a<r;a++)this.updateWheelTransform(a);this.currentVehicleSpeedKmHour=3.6*i.velocity.norm();var c=new o;for(this.getVehicleAxisWorld(this.indexForwardAxis,c),c.dot(i.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1),a=0;a<r;a++)this.castRay(n[a]);this.updateSuspension(t);var u=new o,l=new o;for(a=0;a<r;a++){var p=(y=n[a]).suspensionForce;p>y.maxSuspensionForce&&(p=y.maxSuspensionForce),y.raycastResult.hitNormalWorld.scale(p*t,u),y.raycastResult.hitPointWorld.vsub(i.position,l),i.applyImpulse(u,y.raycastResult.hitPointWorld)}this.updateFriction(t);var f=new o,h=new o,d=new o;for(a=0;a<r;a++){var y=n[a];i.getVelocityAtWorldPoint(y.chassisConnectionPointWorld,d);var m=1;switch(this.indexUpAxis){case 1:m=-1}if(y.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,h);var v=h.dot(y.raycastResult.hitNormalWorld);y.raycastResult.hitNormalWorld.scale(v,f),h.vsub(f,h);var g=h.dot(d);y.deltaRotation=m*g*t/y.radius}!y.sliding&&y.isInContact||0===y.engineForce||!y.useCustomSlidingRotationalSpeed||(y.deltaRotation=(y.engineForce>0?1:-1)*y.customSlidingRotationalSpeed*t),Math.abs(y.brake)>Math.abs(y.engineForce)&&(y.deltaRotation=0),y.rotation+=y.deltaRotation,y.deltaRotation*=.99}},RaycastVehicle.prototype.updateSuspension=function(t){for(var n=this.chassisBody.mass,r=this.wheelInfos,o=r.length,i=0;i<o;i++){var a=r[i];if(a.isInContact){var c,u=a.suspensionRestLength-a.suspensionLength;c=a.suspensionStiffness*u*a.clippedInvContactDotSuspension;var l=a.suspensionRelativeVelocity;c-=(l<0?a.dampingCompression:a.dampingRelaxation)*l,a.suspensionForce=c*n,a.suspensionForce<0&&(a.suspensionForce=0)}else a.suspensionForce=0}},RaycastVehicle.prototype.removeFromWorld=function(t){this.constraints,t.remove(this.chassisBody),t.removeEventListener("preStep",this.preStepCallback),this.world=null};var f=new o,h=new o;RaycastVehicle.prototype.castRay=function(t){var n=f,r=h;this.updateWheelTransformWorld(t);var i=this.chassisBody,a=-1,c=t.suspensionRestLength+t.radius;t.directionWorld.scale(c,n);var u=t.chassisConnectionPointWorld;u.vadd(n,r);var l=t.raycastResult;l.reset();var p=i.collisionResponse;i.collisionResponse=!1,this.world.rayTest(u,r,l),i.collisionResponse=p;var d=l.body;if(t.raycastResult.groundObject=0,d){a=l.distance,t.raycastResult.hitNormalWorld=l.hitNormalWorld,t.isInContact=!0;var y=l.distance;t.suspensionLength=y-t.radius;var m=t.suspensionRestLength-t.maxSuspensionTravel,v=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<m&&(t.suspensionLength=m),t.suspensionLength>v&&(t.suspensionLength=v,t.raycastResult.reset());var g=t.raycastResult.hitNormalWorld.dot(t.directionWorld),_=new o;i.getVelocityAtWorldPoint(t.raycastResult.hitPointWorld,_);var b=t.raycastResult.hitNormalWorld.dot(_);if(g>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{var w=-1/g;t.suspensionRelativeVelocity=b*w,t.clippedInvContactDotSuspension=w}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return a},RaycastVehicle.prototype.updateWheelTransformWorld=function(t){t.isInContact=!1;var n=this.chassisBody;n.pointToWorldFrame(t.chassisConnectionPointLocal,t.chassisConnectionPointWorld),n.vectorToWorldFrame(t.directionLocal,t.directionWorld),n.vectorToWorldFrame(t.axleLocal,t.axleWorld)},RaycastVehicle.prototype.updateWheelTransform=function(t){var n=u,r=l,o=p,a=this.wheelInfos[t];this.updateWheelTransformWorld(a),a.directionLocal.scale(-1,n),r.copy(a.axleLocal),n.cross(r,o),o.normalize(),r.normalize();var c=a.steering,f=new i;f.setFromAxisAngle(n,c);var h=new i;h.setFromAxisAngle(r,a.rotation);var d=a.worldTransform.quaternion;this.chassisBody.quaternion.mult(f,d),d.mult(h,d),d.normalize();var y=a.worldTransform.position;y.copy(a.directionWorld),y.scale(a.suspensionLength,y),y.vadd(a.chassisConnectionPointWorld,y)};var d=[new o(1,0,0),new o(0,1,0),new o(0,0,1)];RaycastVehicle.prototype.getWheelTransformWorld=function(t){return this.wheelInfos[t].worldTransform};var y=new o,m=[],v=[];RaycastVehicle.prototype.updateFriction=function(t){for(var n=y,r=this.wheelInfos,i=r.length,a=this.chassisBody,c=v,u=m,l=0;l<i;l++)g=(A=r[l]).raycastResult.body,A.sideImpulse=0,A.forwardImpulse=0,c[l]||(c[l]=new o),u[l]||(u[l]=new o);for(l=0;l<i;l++)if(g=(A=r[l]).raycastResult.body){var p=u[l];this.getWheelTransformWorld(l).vectorToWorldFrame(d[this.indexRightAxis],p);var f=A.raycastResult.hitNormalWorld,h=p.dot(f);f.scale(h,n),p.vsub(n,p),p.normalize(),f.cross(p,c[l]),c[l].normalize(),A.sideImpulse=resolveSingleBilateral(a,A.raycastResult.hitPointWorld,g,A.raycastResult.hitPointWorld,p),A.sideImpulse*=1}for(this.sliding=!1,l=0;l<i;l++){var g=(A=r[l]).raycastResult.body,_=0;if(A.slipInfo=1,g){var b=A.brake?A.brake:0;_=calcRollingFriction(a,g,A.raycastResult.hitPointWorld,c[l],b);var w=b/(_+=A.engineForce*t);A.slipInfo*=w}if(A.forwardImpulse=0,A.skidInfo=1,g){A.skidInfo=1;var x=A.suspensionForce*t*A.frictionSlip,P=x*x;A.forwardImpulse=_;var O=.5*A.forwardImpulse,C=1*A.sideImpulse,S=O*O+C*C;A.sliding=!1,S>P&&(this.sliding=!0,A.sliding=!0,w=x/Math.sqrt(S),A.skidInfo*=w)}}if(this.sliding)for(l=0;l<i;l++)0!==(A=r[l]).sideImpulse&&A.skidInfo<1&&(A.forwardImpulse*=A.skidInfo,A.sideImpulse*=A.skidInfo);for(l=0;l<i;l++){var A=r[l],E=new o;if(E.copy(A.raycastResult.hitPointWorld),0!==A.forwardImpulse){var j=new o;c[l].scale(A.forwardImpulse,j),a.applyImpulse(j,E)}if(0!==A.sideImpulse){g=A.raycastResult.body;var T=new o;T.copy(A.raycastResult.hitPointWorld);var R=new o;u[l].scale(A.sideImpulse,R),a.pointToLocalFrame(E,E),E["xyz"[this.indexUpAxis]]*=A.rollInfluence,a.pointToWorldFrame(E,E),a.applyImpulse(R,E),R.scale(-1,R),g.applyImpulse(R,T)}}};var g=new o,_=new o,b=new o;function calcRollingFriction(t,n,r,o,i){var a=0,c=r,u=g,l=_,p=b;return t.getVelocityAtWorldPoint(c,u),n.getVelocityAtWorldPoint(c,l),u.vsub(l,p),i<(a=-o.dot(p)*(1/(computeImpulseDenominator(t,r,o)+computeImpulseDenominator(n,r,o))))&&(a=i),a<-i&&(a=-i),a}var w=new o,x=new o,P=new o,O=new o;function computeImpulseDenominator(t,n,r){var o=w,i=x,a=P,c=O;return n.vsub(t.position,o),o.cross(r,i),t.invInertiaWorld.vmult(i,c),c.cross(o,a),t.invMass+r.dot(a)}var C=new o,S=new o,A=new o;function resolveSingleBilateral(t,n,r,o,i,a){if(i.norm2()>1.1)return 0;var c=C,u=S,l=A;return t.getVelocityAtWorldPoint(n,c),r.getVelocityAtWorldPoint(o,u),c.vsub(u,l),-.2*i.dot(l)*(1/(t.invMass+r.invMass))}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,n,r){var o=t("./Body"),i=t("../shapes/Sphere"),a=t("../shapes/Box"),c=t("../math/Vec3"),u=t("../constraints/HingeConstraint");function RigidVehicle(t){if(this.wheelBodies=[],this.coordinateSystem=void 0===t.coordinateSystem?new c(1,2,3):t.coordinateSystem.clone(),this.chassisBody=t.chassisBody,!this.chassisBody){var n=new a(new c(5,2,.5));this.chassisBody=new o(1,n)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}n.exports=RigidVehicle,RigidVehicle.prototype.addWheel=function(t){var n=(t=t||{}).body;n||(n=new o(1,new i(1.2))),this.wheelBodies.push(n),this.wheelForces.push(0),new c;var r=void 0!==t.position?t.position.clone():new c,a=new c;this.chassisBody.pointToWorldFrame(r,a),n.position.set(a.x,a.y,a.z);var l=void 0!==t.axis?t.axis.clone():new c(0,1,0);this.wheelAxes.push(l);var p=new u(this.chassisBody,n,{pivotA:r,axisA:l,pivotB:c.ZERO,axisB:l,collideConnected:!1});return this.constraints.push(p),this.wheelBodies.length-1},RigidVehicle.prototype.setSteeringValue=function(t,n){var r=this.wheelAxes[n],o=Math.cos(t),i=Math.sin(t),a=r.x,c=r.y;this.constraints[n].axisA.set(o*a-i*c,i*a+o*c,0)},RigidVehicle.prototype.setMotorSpeed=function(t,n){var r=this.constraints[n];r.enableMotor(),r.motorTargetVelocity=t},RigidVehicle.prototype.disableMotor=function(t){this.constraints[t].disableMotor()};var l=new c;RigidVehicle.prototype.setWheelForce=function(t,n){this.wheelForces[n]=t},RigidVehicle.prototype.applyWheelForce=function(t,n){var r=this.wheelAxes[n],o=this.wheelBodies[n],i=o.torque;r.scale(t,l),o.vectorToWorldFrame(l,l),i.vadd(l,i)},RigidVehicle.prototype.addToWorld=function(t){for(var n=this.constraints,r=this.wheelBodies.concat([this.chassisBody]),o=0;o<r.length;o++)t.add(r[o]);for(o=0;o<n.length;o++)t.addConstraint(n[o]);t.addEventListener("preStep",this._update.bind(this))},RigidVehicle.prototype._update=function(){for(var t=this.wheelForces,n=0;n<t.length;n++)this.applyWheelForce(t[n],n)},RigidVehicle.prototype.removeFromWorld=function(t){for(var n=this.constraints,r=this.wheelBodies.concat([this.chassisBody]),o=0;o<r.length;o++)t.remove(r[o]);for(o=0;o<n.length;o++)t.removeConstraint(n[o])};var p=new c;RigidVehicle.prototype.getWheelSpeed=function(t){var n=this.wheelAxes[t],r=this.wheelBodies[t].angularVelocity;return this.chassisBody.vectorToWorldFrame(n,p),r.dot(p)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,n,r){n.exports=SPHSystem,t("../shapes/Shape");var o=t("../math/Vec3");function SPHSystem(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material"),SPHSystem.prototype.add=function(t){this.particles.push(t),this.neighbors.length<this.particles.length&&this.neighbors.push([])},SPHSystem.prototype.remove=function(t){var n=this.particles.indexOf(t);-1!==n&&(this.particles.splice(n,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var i=new o;SPHSystem.prototype.getNeighbors=function(t,n){for(var r=this.particles.length,o=t.id,a=this.smoothingRadius*this.smoothingRadius,c=i,u=0;u!==r;u++){var l=this.particles[u];l.position.vsub(t.position,c),o!==l.id&&c.norm2()<a&&n.push(l)}};var a=new o,c=new o,u=new o,l=new o,p=new o,f=new o;SPHSystem.prototype.update=function(){for(var t=this.particles.length,n=a,r=this.speedOfSound,o=this.eps,i=0;i!==t;i++){var h=this.particles[i];(S=this.neighbors[i]).length=0,this.getNeighbors(h,S),S.push(this.particles[i]);for(var d=S.length,y=0,m=0;m!==d;m++){h.position.vsub(S[m].position,n);var v=n.norm(),g=this.w(v);y+=S[m].mass*g}this.densities[i]=y,this.pressures[i]=r*r*(this.densities[i]-this.density)}var _=c,b=u,w=l,x=p,P=f;for(i=0;i!==t;i++){var O,C,S,A=this.particles[i];for(_.set(0,0,0),b.set(0,0,0),d=(S=this.neighbors[i]).length,m=0;m!==d;m++){var E=S[m];A.position.vsub(E.position,x);var j=x.norm();O=-E.mass*(this.pressures[i]/(this.densities[i]*this.densities[i]+o)+this.pressures[m]/(this.densities[m]*this.densities[m]+o)),this.gradw(x,w),w.mult(O,w),_.vadd(w,_),E.velocity.vsub(A.velocity,P),P.mult(1/(1e-4+this.densities[i]*this.densities[m])*this.viscosity*E.mass,P),C=this.nablaw(j),P.mult(C,P),b.vadd(P,b)}b.mult(A.mass,b),_.mult(A.mass,_),A.force.vadd(b,A.force),A.force.vadd(_,A.force)}},SPHSystem.prototype.w=function(t){var n=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(n,9))*Math.pow(n*n-t*t,3)},SPHSystem.prototype.gradw=function(t,n){var r=t.norm(),o=this.smoothingRadius;t.mult(945/(32*Math.PI*Math.pow(o,9))*Math.pow(o*o-r*r,2),n)},SPHSystem.prototype.nablaw=function(t){var n=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(n,9))*(n*n-t*t)*(7*t*t-3*n*n)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,n,r){var o=t("../math/Vec3");function Spring(t,n,r){r=r||{},this.restLength="number"==typeof r.restLength?r.restLength:1,this.stiffness=r.stiffness||100,this.damping=r.damping||1,this.bodyA=t,this.bodyB=n,this.localAnchorA=new o,this.localAnchorB=new o,r.localAnchorA&&this.localAnchorA.copy(r.localAnchorA),r.localAnchorB&&this.localAnchorB.copy(r.localAnchorB),r.worldAnchorA&&this.setWorldAnchorA(r.worldAnchorA),r.worldAnchorB&&this.setWorldAnchorB(r.worldAnchorB)}n.exports=Spring,Spring.prototype.setWorldAnchorA=function(t){this.bodyA.pointToLocalFrame(t,this.localAnchorA)},Spring.prototype.setWorldAnchorB=function(t){this.bodyB.pointToLocalFrame(t,this.localAnchorB)},Spring.prototype.getWorldAnchorA=function(t){this.bodyA.pointToWorldFrame(this.localAnchorA,t)},Spring.prototype.getWorldAnchorB=function(t){this.bodyB.pointToWorldFrame(this.localAnchorB,t)};var i=new o,a=new o,c=new o,u=new o,l=new o,p=new o,f=new o,h=new o,d=new o,y=new o,m=new o;Spring.prototype.applyForce=function(){var t=this.stiffness,n=this.damping,r=this.restLength,o=this.bodyA,v=this.bodyB,g=i,_=a,b=c,w=u,x=m,P=l,O=p,C=f,S=h,A=d,E=y;this.getWorldAnchorA(P),this.getWorldAnchorB(O),P.vsub(o.position,C),O.vsub(v.position,S),O.vsub(P,g);var j=g.norm();_.copy(g),_.normalize(),v.velocity.vsub(o.velocity,b),v.angularVelocity.cross(S,x),b.vadd(x,b),o.angularVelocity.cross(C,x),b.vsub(x,b),_.mult(-t*(j-r)-n*b.dot(_),w),o.force.vsub(w,o.force),v.force.vadd(w,v.force),C.cross(w,A),S.cross(w,E),o.torque.vsub(A,o.torque),v.torque.vadd(E,v.torque)}},{"../math/Vec3":30}],36:[function(t,n,r){var o=t("../math/Vec3"),i=t("../math/Transform"),a=t("../collision/RaycastResult"),c=t("../utils/Utils");function WheelInfo(t){t=c.defaults(t,{chassisConnectionPointLocal:new o,chassisConnectionPointWorld:new o,directionLocal:new o,directionWorld:new o,axleLocal:new o,axleWorld:new o,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointWorld.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionWorld.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleWorld.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new a,this.worldTransform=new i,this.isInContact=!1}n.exports=WheelInfo;var u=new o,l=new o;u=new o,WheelInfo.prototype.updateWheel=function(t){var n=this.raycastResult;if(this.isInContact){var r=n.hitNormalWorld.dot(n.directionWorld);n.hitPointWorld.vsub(t.position,l),t.getVelocityAtWorldPoint(l,u);var o=n.hitNormalWorld.dot(u);if(r>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var i=-1/r;this.suspensionRelativeVelocity=o*i,this.clippedInvContactDotSuspension=i}}else n.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,n.directionWorld.scale(-1,n.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,n,r){n.exports=Box;var o=t("./Shape"),i=t("../math/Vec3"),a=t("./ConvexPolyhedron");function Box(t){o.call(this),this.type=o.types.BOX,this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}Box.prototype=new o,Box.prototype.constructor=Box,Box.prototype.updateConvexPolyhedronRepresentation=function(){var t=this.halfExtents.x,n=this.halfExtents.y,r=this.halfExtents.z,o=i,c=[new o(-t,-n,-r),new o(t,-n,-r),new o(t,n,-r),new o(-t,n,-r),new o(-t,-n,r),new o(t,-n,r),new o(t,n,r),new o(-t,n,r)],u=(new o(0,0,1),new o(0,1,0),new o(1,0,0),new a(c,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=u,u.material=this.material},Box.prototype.calculateLocalInertia=function(t,n){return n=n||new i,Box.calculateInertia(this.halfExtents,t,n),n},Box.calculateInertia=function(t,n,r){var o=t;r.x=1/12*n*(2*o.y*2*o.y+2*o.z*2*o.z),r.y=1/12*n*(2*o.x*2*o.x+2*o.z*2*o.z),r.z=1/12*n*(2*o.y*2*o.y+2*o.x*2*o.x)},Box.prototype.getSideNormals=function(t,n){var r=t,o=this.halfExtents;if(r[0].set(o.x,0,0),r[1].set(0,o.y,0),r[2].set(0,0,o.z),r[3].set(-o.x,0,0),r[4].set(0,-o.y,0),r[5].set(0,0,-o.z),void 0!==n)for(var i=0;i!==r.length;i++)n.vmult(r[i],r[i]);return r},Box.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},Box.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var c=new i;new i,Box.prototype.forEachWorldCorner=function(t,n,r){for(var o=this.halfExtents,i=[[o.x,o.y,o.z],[-o.x,o.y,o.z],[-o.x,-o.y,o.z],[-o.x,-o.y,-o.z],[o.x,-o.y,-o.z],[o.x,o.y,-o.z],[-o.x,o.y,-o.z],[o.x,-o.y,o.z]],a=0;a<i.length;a++)c.set(i[a][0],i[a][1],i[a][2]),n.vmult(c,c),t.vadd(c,c),r(c.x,c.y,c.z)};var u=[new i,new i,new i,new i,new i,new i,new i,new i];Box.prototype.calculateWorldAABB=function(t,n,r,o){var i=this.halfExtents;u[0].set(i.x,i.y,i.z),u[1].set(-i.x,i.y,i.z),u[2].set(-i.x,-i.y,i.z),u[3].set(-i.x,-i.y,-i.z),u[4].set(i.x,-i.y,-i.z),u[5].set(i.x,i.y,-i.z),u[6].set(-i.x,i.y,-i.z),u[7].set(i.x,-i.y,i.z);var a=u[0];n.vmult(a,a),t.vadd(a,a),o.copy(a),r.copy(a);for(var c=1;c<8;c++){a=u[c],n.vmult(a,a),t.vadd(a,a);var l=a.x,p=a.y,f=a.z;l>o.x&&(o.x=l),p>o.y&&(o.y=p),f>o.z&&(o.z=f),l<r.x&&(r.x=l),p<r.y&&(r.y=p),f<r.z&&(r.z=f)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,n,r){n.exports=ConvexPolyhedron;var o=t("./Shape"),i=t("../math/Vec3"),a=(t("../math/Quaternion"),t("../math/Transform"));function ConvexPolyhedron(t,n,r){o.call(this),this.type=o.types.CONVEXPOLYHEDRON,this.vertices=t||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=n||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=r?r.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}ConvexPolyhedron.prototype=new o,ConvexPolyhedron.prototype.constructor=ConvexPolyhedron;var c=new i;ConvexPolyhedron.prototype.computeEdges=function(){var t=this.faces,n=this.vertices,r=(n.length,this.uniqueEdges);r.length=0;for(var o=c,i=0;i!==t.length;i++)for(var a=t[i],u=a.length,l=0;l!==u;l++){var p=(l+1)%u;n[a[l]].vsub(n[a[p]],o),o.normalize();for(var f=!1,h=0;h!==r.length;h++)if(r[h].almostEquals(o)||r[h].almostEquals(o)){f=!0;break}f||r.push(o.clone())}},ConvexPolyhedron.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var t=0;t<this.faces.length;t++){for(var n=0;n<this.faces[t].length;n++)if(!this.vertices[this.faces[t][n]])throw new Error("Vertex "+this.faces[t][n]+" not found!");var r=this.faceNormals[t]||new i;this.getFaceNormal(t,r),r.negate(r),this.faceNormals[t]=r;var o=this.vertices[this.faces[t][0]];if(r.dot(o)<0)for(console.error(".faceNormals["+t+"] = Vec3("+r.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),n=0;n<this.faces[t].length;n++)console.warn(".vertices["+this.faces[t][n]+"] = Vec3("+this.vertices[this.faces[t][n]].toString()+")")}};var u=new i,l=new i;ConvexPolyhedron.computeNormal=function(t,n,r,o){n.vsub(t,l),r.vsub(n,u),u.cross(l,o),o.isZero()||o.normalize()},ConvexPolyhedron.prototype.getFaceNormal=function(t,n){var r=this.faces[t],o=this.vertices[r[0]],i=this.vertices[r[1]],a=this.vertices[r[2]];return ConvexPolyhedron.computeNormal(o,i,a,n)};var p=new i;ConvexPolyhedron.prototype.clipAgainstHull=function(t,n,r,o,a,c,u,l,f){for(var h=p,d=-1,y=-Number.MAX_VALUE,m=0;m<r.faces.length;m++){h.copy(r.faceNormals[m]),a.vmult(h,h);var v=h.dot(c);v>y&&(y=v,d=m)}for(var g=[],_=r.faces[d],b=_.length,w=0;w<b;w++){var x=r.vertices[_[w]],P=new i;P.copy(x),a.vmult(P,P),o.vadd(P,P),g.push(P)}d>=0&&this.clipFaceAgainstHull(c,t,n,g,u,l,f)};var f=new i,h=new i,d=new i,y=new i,m=new i,v=new i;ConvexPolyhedron.prototype.findSeparatingAxis=function(t,n,r,o,i,a,c,u){var l=f,p=h,g=d,_=y,b=m,w=v,x=Number.MAX_VALUE;if(this.uniqueAxes)for(O=0;O!==this.uniqueAxes.length;O++){if(r.vmult(this.uniqueAxes[O],l),!1===(A=this.testSepAxis(l,t,n,r,o,i)))return!1;A<x&&(x=A,a.copy(l))}else for(var P=c?c.length:this.faces.length,O=0;O<P;O++){var C=c?c[O]:O;if(l.copy(this.faceNormals[C]),r.vmult(l,l),!1===(A=this.testSepAxis(l,t,n,r,o,i)))return!1;A<x&&(x=A,a.copy(l))}if(t.uniqueAxes)for(O=0;O!==t.uniqueAxes.length;O++){if(i.vmult(t.uniqueAxes[O],p),!1===(A=this.testSepAxis(p,t,n,r,o,i)))return!1;A<x&&(x=A,a.copy(p))}else for(var S=u?u.length:t.faces.length,O=0;O<S;O++){var A;if(C=u?u[O]:O,p.copy(t.faceNormals[C]),i.vmult(p,p),!1===(A=this.testSepAxis(p,t,n,r,o,i)))return!1;A<x&&(x=A,a.copy(p))}for(var E=0;E!==this.uniqueEdges.length;E++){r.vmult(this.uniqueEdges[E],_);for(var j=0;j!==t.uniqueEdges.length;j++)if(i.vmult(t.uniqueEdges[j],b),_.cross(b,w),!w.almostZero()){w.normalize();var T=this.testSepAxis(w,t,n,r,o,i);if(!1===T)return!1;T<x&&(x=T,a.copy(w))}}return o.vsub(n,g),g.dot(a)>0&&a.negate(a),!0};var g=[],_=[];ConvexPolyhedron.prototype.testSepAxis=function(t,n,r,o,i,a){ConvexPolyhedron.project(this,t,r,o,g),ConvexPolyhedron.project(n,t,i,a,_);var c=g[0],u=g[1],l=_[0],p=_[1];if(c<p||l<u)return!1;var f=c-p,h=l-u;return f<h?f:h};var b=new i,w=new i;ConvexPolyhedron.prototype.calculateLocalInertia=function(t,n){this.computeLocalAABB(b,w);var r=w.x-b.x,o=w.y-b.y,i=w.z-b.z;n.x=1/12*t*(2*o*2*o+2*i*2*i),n.y=1/12*t*(2*r*2*r+2*i*2*i),n.z=1/12*t*(2*o*2*o+2*r*2*r)},ConvexPolyhedron.prototype.getPlaneConstantOfFace=function(t){var n=this.faces[t],r=this.faceNormals[t],o=this.vertices[n[0]];return-r.dot(o)};var x=new i,P=new i,O=new i,C=new i,S=new i,A=new i,E=new i,j=new i;ConvexPolyhedron.prototype.clipFaceAgainstHull=function(t,n,r,o,i,a,c){for(var u=x,l=P,p=O,f=C,h=S,d=A,y=E,m=j,v=o,g=[],_=-1,b=Number.MAX_VALUE,w=0;w<this.faces.length;w++){u.copy(this.faceNormals[w]),r.vmult(u,u);var T=u.dot(t);T<b&&(b=T,_=w)}if(!(_<0)){var R=this.faces[_];R.connectedFaces=[];for(var B=0;B<this.faces.length;B++)for(var M=0;M<this.faces[B].length;M++)-1!==R.indexOf(this.faces[B][M])&&B!==_&&-1===R.connectedFaces.indexOf(B)&&R.connectedFaces.push(B);v.length;for(var I=R.length,z=0;z<I;z++){var k=this.vertices[R[z]],D=this.vertices[R[(z+1)%I]];k.vsub(D,l),p.copy(l),r.vmult(p,p),n.vadd(p,p),f.copy(this.faceNormals[_]),r.vmult(f,f),n.vadd(f,f),p.cross(f,h),h.negate(h),d.copy(k),r.vmult(d,d),n.vadd(d,d),d.dot(h);var F=R.connectedFaces[z];y.copy(this.faceNormals[F]);var L=this.getPlaneConstantOfFace(F);m.copy(y),r.vmult(m,m);var N=L-m.dot(n);for(this.clipFaceAgainstPlane(v,g,m,N);v.length;)v.shift();for(;g.length;)v.push(g.shift())}for(y.copy(this.faceNormals[_]),L=this.getPlaneConstantOfFace(_),m.copy(y),r.vmult(m,m),N=L-m.dot(n),B=0;B<v.length;B++){var V=m.dot(v[B])+N;if(V<=i&&(console.log("clamped: depth="+V+" to minDist="+i),V=i),V<=a){var U=v[B];if(V<=0){var W={point:U,normal:m,depth:V};c.push(W)}}}}},ConvexPolyhedron.prototype.clipFaceAgainstPlane=function(t,n,r,o){var a,c,u=t.length;if(u<2)return n;var l=t[t.length-1],p=t[0];a=r.dot(l)+o;for(var f=0;f<u;f++){if(p=t[f],c=r.dot(p)+o,a<0)if(c<0)(h=new i).copy(p),n.push(h);else{var h=new i;l.lerp(p,a/(a-c),h),n.push(h)}else c<0&&(h=new i,l.lerp(p,a/(a-c),h),n.push(h),n.push(p));l=p,a=c}return n},ConvexPolyhedron.prototype.computeWorldVertices=function(t,n){for(var r=this.vertices.length;this.worldVertices.length<r;)this.worldVertices.push(new i);for(var o=this.vertices,a=this.worldVertices,c=0;c!==r;c++)n.vmult(o[c],a[c]),t.vadd(a[c],a[c]);this.worldVerticesNeedsUpdate=!1},new i,ConvexPolyhedron.prototype.computeLocalAABB=function(t,n){var r=this.vertices.length,o=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var i=0;i<r;i++){var a=o[i];a.x<t.x?t.x=a.x:a.x>n.x&&(n.x=a.x),a.y<t.y?t.y=a.y:a.y>n.y&&(n.y=a.y),a.z<t.z?t.z=a.z:a.z>n.z&&(n.z=a.z)}},ConvexPolyhedron.prototype.computeWorldFaceNormals=function(t){for(var n=this.faceNormals.length;this.worldFaceNormals.length<n;)this.worldFaceNormals.push(new i);for(var r=this.faceNormals,o=this.worldFaceNormals,a=0;a!==n;a++)t.vmult(r[a],o[a]);this.worldFaceNormalsNeedsUpdate=!1},ConvexPolyhedron.prototype.updateBoundingSphereRadius=function(){for(var t=0,n=this.vertices,r=0,o=n.length;r!==o;r++){var i=n[r].norm2();i>t&&(t=i)}this.boundingSphereRadius=Math.sqrt(t)};var T=new i;ConvexPolyhedron.prototype.calculateWorldAABB=function(t,n,r,o){for(var i,a,c,u,l,p,f=this.vertices.length,h=this.vertices,d=0;d<f;d++){T.copy(h[d]),n.vmult(T,T),t.vadd(T,T);var y=T;y.x<i||void 0===i?i=y.x:(y.x>u||void 0===u)&&(u=y.x),y.y<a||void 0===a?a=y.y:(y.y>l||void 0===l)&&(l=y.y),y.z<c||void 0===c?c=y.z:(y.z>p||void 0===p)&&(p=y.z)}r.set(i,a,c),o.set(u,l,p)},ConvexPolyhedron.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},ConvexPolyhedron.prototype.getAveragePointLocal=function(t){t=t||new i;for(var n=this.vertices.length,r=this.vertices,o=0;o<n;o++)t.vadd(r[o],t);return t.mult(1/n,t),t},ConvexPolyhedron.prototype.transformAllPoints=function(t,n){var r=this.vertices.length,o=this.vertices;if(n){for(var i=0;i<r;i++){var a=o[i];n.vmult(a,a)}for(i=0;i<this.faceNormals.length;i++)a=this.faceNormals[i],n.vmult(a,a)}if(t)for(i=0;i<r;i++)(a=o[i]).vadd(t,a)};var R=new i,B=new i,M=new i;ConvexPolyhedron.prototype.pointIsInside=function(t){var n=this.vertices.length,r=this.vertices,o=this.faces,i=this.faceNormals,a=this.faces.length,c=R;this.getAveragePointLocal(c);for(var u=0;u<a;u++){this.faces[u].length,n=i[u];var l=r[o[u][0]],p=B;t.vsub(l,p);var f=n.dot(p),h=M;c.vsub(l,h);var d=n.dot(h);if(f<0&&d>0||f>0&&d<0)return!1}return-1},new i;var I=new i,z=new i;ConvexPolyhedron.project=function(t,n,r,o,i){var c=t.vertices.length,u=I,l=0,p=0,f=z,h=t.vertices;f.setZero(),a.vectorToLocalFrame(r,o,n,u),a.pointToLocalFrame(r,o,f,f);var d=f.dot(u);p=l=h[0].dot(u);for(var y=1;y<c;y++){var m=h[y].dot(u);m>l&&(l=m),m<p&&(p=m)}if((p-=d)>(l-=d)){var v=p;p=l,l=v}i[0]=l,i[1]=p}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,n,r){n.exports=Cylinder;var o=t("./Shape"),i=t("../math/Vec3"),a=(t("../math/Quaternion"),t("./ConvexPolyhedron"));function Cylinder(t,n,r,c){var u=c,l=[],p=[],f=[],h=[],d=[],y=Math.cos,m=Math.sin;l.push(new i(n*y(0),n*m(0),.5*-r)),h.push(0),l.push(new i(t*y(0),t*m(0),.5*r)),d.push(1);for(var v=0;v<u;v++){var g=2*Math.PI/u*(v+1),_=2*Math.PI/u*(v+.5);v<u-1?(l.push(new i(n*y(g),n*m(g),.5*-r)),h.push(2*v+2),l.push(new i(t*y(g),t*m(g),.5*r)),d.push(2*v+3),f.push([2*v+2,2*v+3,2*v+1,2*v])):f.push([0,1,2*v+1,2*v]),(u%2==1||v<u/2)&&p.push(new i(y(_),m(_),0))}f.push(d),p.push(new i(0,0,1));var b=[];for(v=0;v<h.length;v++)b.push(h[h.length-v-1]);f.push(b),this.type=o.types.CONVEXPOLYHEDRON,a.call(this,l,f,p)}Cylinder.prototype=new a},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,n,r){var o=t("./Shape"),i=t("./ConvexPolyhedron"),a=t("../math/Vec3"),c=t("../utils/Utils");function Heightfield(t,n){n=c.defaults(n,{maxValue:null,minValue:null,elementSize:1}),this.data=t,this.maxValue=n.maxValue,this.minValue=n.minValue,this.elementSize=n.elementSize,null===n.minValue&&this.updateMinValue(),null===n.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,o.call(this),this.pillarConvex=new i,this.pillarOffset=new a,this.type=o.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}n.exports=Heightfield,Heightfield.prototype=new o,Heightfield.prototype.update=function(){this._cachedPillars={}},Heightfield.prototype.updateMinValue=function(){for(var t=this.data,n=t[0][0],r=0;r!==t.length;r++)for(var o=0;o!==t[r].length;o++){var i=t[r][o];i<n&&(n=i)}this.minValue=n},Heightfield.prototype.updateMaxValue=function(){for(var t=this.data,n=t[0][0],r=0;r!==t.length;r++)for(var o=0;o!==t[r].length;o++){var i=t[r][o];i>n&&(n=i)}this.maxValue=n},Heightfield.prototype.setHeightValueAtIndex=function(t,n,r){this.data[t][n]=r,this.clearCachedConvexTrianglePillar(t,n,!1),t>0&&(this.clearCachedConvexTrianglePillar(t-1,n,!0),this.clearCachedConvexTrianglePillar(t-1,n,!1)),n>0&&(this.clearCachedConvexTrianglePillar(t,n-1,!0),this.clearCachedConvexTrianglePillar(t,n-1,!1)),n>0&&t>0&&this.clearCachedConvexTrianglePillar(t-1,n-1,!0)},Heightfield.prototype.getRectMinMax=function(t,n,r,o,i){i=i||[];for(var a=this.data,c=this.minValue,u=t;u<=r;u++)for(var l=n;l<=o;l++){var p=a[u][l];p>c&&(c=p)}i[0]=this.minValue,i[1]=c},Heightfield.prototype.getIndexOfPosition=function(t,n,r,o){var i=this.elementSize,a=this.data,c=Math.floor(t/i),u=Math.floor(n/i);return r[0]=c,r[1]=u,o&&(c<0&&(c=0),u<0&&(u=0),c>=a.length-1&&(c=a.length-1),u>=a[0].length-1&&(u=a[0].length-1)),!(c<0||u<0||c>=a.length-1||u>=a[0].length-1)},Heightfield.prototype.getHeightAt=function(t,n,r){var o=[];this.getIndexOfPosition(t,n,o,r);var i=[];return this.getRectMinMax(o[0],o[1]+1,o[0],o[1]+1,i),(i[0]+i[1])/2},Heightfield.prototype.getCacheConvexTrianglePillarKey=function(t,n,r){return t+"_"+n+"_"+(r?1:0)},Heightfield.prototype.getCachedConvexTrianglePillar=function(t,n,r){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,n,r)]},Heightfield.prototype.setCachedConvexTrianglePillar=function(t,n,r,o,i){this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,n,r)]={convex:o,offset:i}},Heightfield.prototype.clearCachedConvexTrianglePillar=function(t,n,r){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,n,r)]},Heightfield.prototype.getConvexTrianglePillar=function(t,n,r){var o=this.pillarConvex,c=this.pillarOffset;if(this.cacheEnabled){if(u=this.getCachedConvexTrianglePillar(t,n,r))return this.pillarConvex=u.convex,void(this.pillarOffset=u.offset);o=new i,c=new a,this.pillarConvex=o,this.pillarOffset=c}var u=this.data,l=this.elementSize,p=o.faces;o.vertices.length=6;for(var f=0;f<6;f++)o.vertices[f]||(o.vertices[f]=new a);for(p.length=5,f=0;f<5;f++)p[f]||(p[f]=[]);var h=o.vertices,d=(Math.min(u[t][n],u[t+1][n],u[t][n+1],u[t+1][n+1])-this.minValue)/2+this.minValue;r?(c.set((t+.75)*l,(n+.75)*l,d),h[0].set(.25*l,.25*l,u[t+1][n+1]-d),h[1].set(-.75*l,.25*l,u[t][n+1]-d),h[2].set(.25*l,-.75*l,u[t+1][n]-d),h[3].set(.25*l,.25*l,-d-1),h[4].set(-.75*l,.25*l,-d-1),h[5].set(.25*l,-.75*l,-d-1),p[0][0]=0,p[0][1]=1,p[0][2]=2,p[1][0]=5,p[1][1]=4,p[1][2]=3,p[2][0]=2,p[2][1]=5,p[2][2]=3,p[2][3]=0,p[3][0]=3,p[3][1]=4,p[3][2]=1,p[3][3]=0,p[4][0]=1,p[4][1]=4,p[4][2]=5,p[4][3]=2):(c.set((t+.25)*l,(n+.25)*l,d),h[0].set(-.25*l,-.25*l,u[t][n]-d),h[1].set(.75*l,-.25*l,u[t+1][n]-d),h[2].set(-.25*l,.75*l,u[t][n+1]-d),h[3].set(-.25*l,-.25*l,-d-1),h[4].set(.75*l,-.25*l,-d-1),h[5].set(-.25*l,.75*l,-d-1),p[0][0]=0,p[0][1]=1,p[0][2]=2,p[1][0]=5,p[1][1]=4,p[1][2]=3,p[2][0]=0,p[2][1]=2,p[2][2]=5,p[2][3]=3,p[3][0]=1,p[3][1]=0,p[3][2]=3,p[3][3]=4,p[4][0]=4,p[4][1]=5,p[4][2]=2,p[4][3]=1),o.computeNormals(),o.computeEdges(),o.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(t,n,r,o,c)},Heightfield.prototype.calculateLocalInertia=function(t,n){return(n=n||new a).set(0,0,0),n},Heightfield.prototype.volume=function(){return Number.MAX_VALUE},Heightfield.prototype.calculateWorldAABB=function(t,n,r,o){r.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},Heightfield.prototype.updateBoundingSphereRadius=function(){var t=this.data,n=this.elementSize;this.boundingSphereRadius=new a(t.length*n,t[0].length*n,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,n,r){n.exports=Particle;var o=t("./Shape"),i=t("../math/Vec3");function Particle(){o.call(this),this.type=o.types.PARTICLE}Particle.prototype=new o,Particle.prototype.constructor=Particle,Particle.prototype.calculateLocalInertia=function(t,n){return(n=n||new i).set(0,0,0),n},Particle.prototype.volume=function(){return 0},Particle.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},Particle.prototype.calculateWorldAABB=function(t,n,r,o){r.copy(t),o.copy(t)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,n,r){n.exports=Plane;var o=t("./Shape"),i=t("../math/Vec3");function Plane(){o.call(this),this.type=o.types.PLANE,this.worldNormal=new i,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}Plane.prototype=new o,Plane.prototype.constructor=Plane,Plane.prototype.computeWorldNormal=function(t){var n=this.worldNormal;n.set(0,0,1),t.vmult(n,n),this.worldNormalNeedsUpdate=!1},Plane.prototype.calculateLocalInertia=function(t,n){return n=n||new i},Plane.prototype.volume=function(){return Number.MAX_VALUE};var a=new i;Plane.prototype.calculateWorldAABB=function(t,n,r,o){a.set(0,0,1),n.vmult(a,a);var i=Number.MAX_VALUE;r.set(-i,-i,-i),o.set(i,i,i),1===a.x&&(o.x=t.x),1===a.y&&(o.y=t.y),1===a.z&&(o.z=t.z),-1===a.x&&(r.x=t.x),-1===a.y&&(r.y=t.y),-1===a.z&&(r.z=t.z)},Plane.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,n,r){n.exports=o;var o=t("./Shape");function o(){this.id=o.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material"),o.prototype.constructor=o,o.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},o.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},o.prototype.calculateLocalInertia=function(t,n){throw"calculateLocalInertia() not implemented for shape type "+this.type},o.idCounter=0,o.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,n,r){n.exports=Sphere;var o=t("./Shape"),i=t("../math/Vec3");function Sphere(t){if(o.call(this),this.radius=void 0!==t?Number(t):1,this.type=o.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}Sphere.prototype=new o,Sphere.prototype.constructor=Sphere,Sphere.prototype.calculateLocalInertia=function(t,n){n=n||new i;var r=2*t*this.radius*this.radius/5;return n.x=r,n.y=r,n.z=r,n},Sphere.prototype.volume=function(){return 4*Math.PI*this.radius/3},Sphere.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},Sphere.prototype.calculateWorldAABB=function(t,n,r,o){for(var i=this.radius,a=["x","y","z"],c=0;c<a.length;c++){var u=a[c];r[u]=t[u]-i,o[u]=t[u]+i}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,n,r){n.exports=Trimesh;var o=t("./Shape"),i=t("../math/Vec3"),a=(t("../math/Quaternion"),t("../math/Transform")),c=t("../collision/AABB"),u=t("../utils/Octree");function Trimesh(t,n){o.call(this),this.type=o.types.TRIMESH,this.vertices=new Float32Array(t),this.indices=new Int16Array(n),this.normals=new Float32Array(n.length),this.aabb=new c,this.edges=null,this.scale=new i(1,1,1),this.tree=new u,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}Trimesh.prototype=new o,Trimesh.prototype.constructor=Trimesh;var l=new i;Trimesh.prototype.updateTree=function(){var t=this.tree;t.reset(),t.aabb.copy(this.aabb);var n=this.scale;t.aabb.lowerBound.x*=1/n.x,t.aabb.lowerBound.y*=1/n.y,t.aabb.lowerBound.z*=1/n.z,t.aabb.upperBound.x*=1/n.x,t.aabb.upperBound.y*=1/n.y,t.aabb.upperBound.z*=1/n.z;for(var r=new c,o=new i,a=new i,u=new i,l=[o,a,u],p=0;p<this.indices.length/3;p++){var f=3*p;this._getUnscaledVertex(this.indices[f],o),this._getUnscaledVertex(this.indices[f+1],a),this._getUnscaledVertex(this.indices[f+2],u),r.setFromPoints(l),t.insert(r,p)}t.removeEmptyNodes()};var p=new c;Trimesh.prototype.getTrianglesInAABB=function(t,n){p.copy(t);var r=this.scale,o=r.x,i=r.y,a=r.z,c=p.lowerBound,u=p.upperBound;return c.x/=o,c.y/=i,c.z/=a,u.x/=o,u.y/=i,u.z/=a,this.tree.aabbQuery(p,n)},Trimesh.prototype.setScale=function(t){var n=this.scale.x===this.scale.y===this.scale.z,r=t.x===t.y===t.z;n&&r||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()},Trimesh.prototype.updateNormals=function(){for(var t=l,n=this.normals,r=0;r<this.indices.length/3;r++){var o=3*r,i=this.indices[o],a=this.indices[o+1],c=this.indices[o+2];this.getVertex(i,m),this.getVertex(a,v),this.getVertex(c,g),Trimesh.computeNormal(v,m,g,t),n[o]=t.x,n[o+1]=t.y,n[o+2]=t.z}},Trimesh.prototype.updateEdges=function(){for(var t={},add=function(n,r){t[o<i?o+"_"+i:i+"_"+o]=!0},n=0;n<this.indices.length/3;n++){var r=3*n,o=this.indices[r],i=this.indices[r+1];this.indices[r+2],add(),add(),add()}var a=Object.keys(t);for(this.edges=new Int16Array(2*a.length),n=0;n<a.length;n++){var c=a[n].split("_");this.edges[2*n]=parseInt(c[0],10),this.edges[2*n+1]=parseInt(c[1],10)}},Trimesh.prototype.getEdgeVertex=function(t,n,r){var o=this.edges[2*t+(n?1:0)];this.getVertex(o,r)};var f=new i,h=new i;Trimesh.prototype.getEdgeVector=function(t,n){var r=f,o=h;this.getEdgeVertex(t,0,r),this.getEdgeVertex(t,1,o),o.vsub(r,n)};var d=new i,y=new i;Trimesh.computeNormal=function(t,n,r,o){n.vsub(t,y),r.vsub(n,d),d.cross(y,o),o.isZero()||o.normalize()};var m=new i,v=new i,g=new i;Trimesh.prototype.getVertex=function(t,n){var r=this.scale;return this._getUnscaledVertex(t,n),n.x*=r.x,n.y*=r.y,n.z*=r.z,n},Trimesh.prototype._getUnscaledVertex=function(t,n){var r=3*t,o=this.vertices;return n.set(o[r],o[r+1],o[r+2])},Trimesh.prototype.getWorldVertex=function(t,n,r,o){return this.getVertex(t,o),a.pointToWorldFrame(n,r,o,o),o},Trimesh.prototype.getTriangleVertices=function(t,n,r,o){var i=3*t;this.getVertex(this.indices[i],n),this.getVertex(this.indices[i+1],r),this.getVertex(this.indices[i+2],o)},Trimesh.prototype.getNormal=function(t,n){var r=3*t;return n.set(this.normals[r],this.normals[r+1],this.normals[r+2])};var _=new c;Trimesh.prototype.calculateLocalInertia=function(t,n){this.computeLocalAABB(_);var r=_.upperBound.x-_.lowerBound.x,o=_.upperBound.y-_.lowerBound.y,i=_.upperBound.z-_.lowerBound.z;return n.set(1/12*t*(2*o*2*o+2*i*2*i),1/12*t*(2*r*2*r+2*i*2*i),1/12*t*(2*o*2*o+2*r*2*r))};var b=new i;Trimesh.prototype.computeLocalAABB=function(t){var n=t.lowerBound,r=t.upperBound,o=this.vertices.length,i=(this.vertices,b);this.getVertex(0,i),n.copy(i),r.copy(i);for(var a=0;a!==o;a++)this.getVertex(a,i),i.x<n.x?n.x=i.x:i.x>r.x&&(r.x=i.x),i.y<n.y?n.y=i.y:i.y>r.y&&(r.y=i.y),i.z<n.z?n.z=i.z:i.z>r.z&&(r.z=i.z)},Trimesh.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},Trimesh.prototype.updateBoundingSphereRadius=function(){for(var t=0,n=this.vertices,r=new i,o=0,a=n.length/3;o!==a;o++){this.getVertex(o,r);var c=r.norm2();c>t&&(t=c)}this.boundingSphereRadius=Math.sqrt(t)},new i;var w=new a,x=new c;Trimesh.prototype.calculateWorldAABB=function(t,n,r,o){var i=w,a=x;i.position=t,i.quaternion=n,this.aabb.toWorldFrame(i,a),r.copy(a.lowerBound),o.copy(a.upperBound)},Trimesh.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},Trimesh.createTorus=function(t,n,r,o,i){t=t||1,n=n||.5,r=r||8,o=o||6,i=i||2*Math.PI;for(var a=[],c=[],u=0;u<=r;u++)for(var l=0;l<=o;l++){var p=l/o*i,f=u/r*Math.PI*2,h=(t+n*Math.cos(f))*Math.cos(p),d=(t+n*Math.cos(f))*Math.sin(p),y=n*Math.sin(f);a.push(h,d,y)}for(u=1;u<=r;u++)for(l=1;l<=o;l++){var m=(o+1)*u+l-1,v=(o+1)*(u-1)+l-1,g=(o+1)*(u-1)+l,_=(o+1)*u+l;c.push(m,v,_),c.push(v,g,_)}return new Trimesh(a,c)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,n,r){n.exports=GSSolver,t("../math/Vec3"),t("../math/Quaternion");var o=t("./Solver");function GSSolver(){o.call(this),this.iterations=10,this.tolerance=1e-7}GSSolver.prototype=new o;var i=[],a=[],c=[];GSSolver.prototype.solve=function(t,n){var r,o,u,l,p,f=0,h=this.iterations,d=this.tolerance*this.tolerance,y=this.equations,m=y.length,v=n.bodies,g=v.length,_=t;if(0!==m)for(var b=0;b!==g;b++)v[b].updateSolveMassProperties();var w=a,x=c,P=i;for(w.length=m,x.length=m,P.length=m,b=0;b!==m;b++){var O=y[b];P[b]=0,x[b]=O.computeB(_),w[b]=1/O.computeC()}if(0!==m){for(b=0;b!==g;b++){var C=(E=v[b]).vlambda,S=E.wlambda;C.set(0,0,0),S&&S.set(0,0,0)}for(f=0;f!==h;f++){l=0;for(var A=0;A!==m;A++)O=y[A],r=x[A],o=w[A],(p=P[A])+(u=o*(r-O.computeGWlambda()-O.eps*p))<O.minForce?u=O.minForce-p:p+u>O.maxForce&&(u=O.maxForce-p),P[A]+=u,l+=u>0?u:-u,O.addToWlambda(u);if(l*l<d)break}for(b=0;b!==g;b++){var E,j=(E=v[b]).velocity,T=E.angularVelocity;j.vadd(E.vlambda,j),T&&T.vadd(E.wlambda,T)}}return f}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,n,r){function Solver(){this.equations=[]}n.exports=Solver,Solver.prototype.solve=function(t,n){return 0},Solver.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},Solver.prototype.removeEquation=function(t){var n=this.equations,r=n.indexOf(t);-1!==r&&n.splice(r,1)},Solver.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,n,r){n.exports=SplitSolver,t("../math/Vec3"),t("../math/Quaternion");var o=t("./Solver"),i=t("../objects/Body");function SplitSolver(t){for(o.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=t,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}SplitSolver.prototype=new o;var a=[],c=[],u={bodies:[]},l=i.STATIC;function getUnvisitedNode(t){for(var n=t.length,r=0;r!==n;r++){var o=t[r];if(!(o.visited||o.body.type&l))return o}return!1}var p=[];function bfs(t,n,r,o){for(p.push(t),t.visited=!0,n(t,r,o);p.length;)for(var i,a=p.pop();i=getUnvisitedNode(a.children);)i.visited=!0,n(i,r,o),p.push(i)}function visitFunc(t,n,r){n.push(t.body);for(var o=t.eqs.length,i=0;i!==o;i++){var a=t.eqs[i];-1===r.indexOf(a)&&r.push(a)}}function sortById(t,n){return n.id-t.id}SplitSolver.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},SplitSolver.prototype.solve=function(t,n){for(var r=a,o=this.nodePool,i=n.bodies,l=this.equations,p=l.length,f=i.length,h=this.subsolver;o.length<f;)o.push(this.createNode());r.length=f;for(var d=0;d<f;d++)r[d]=o[d];for(d=0;d!==f;d++){var y=r[d];y.body=i[d],y.children.length=0,y.eqs.length=0,y.visited=!1}for(var m=0;m!==p;m++){var v=l[m],g=(d=i.indexOf(v.bi),i.indexOf(v.bj)),_=r[d],b=r[g];_.children.push(b),_.eqs.push(v),b.children.push(_),b.eqs.push(v)}var w,x=0,P=c;h.tolerance=this.tolerance,h.iterations=this.iterations;for(var O=u;w=getUnvisitedNode(r);){P.length=0,O.bodies.length=0,bfs(w,visitFunc,O.bodies,P);var C=P.length;for(P=P.sort(sortById),d=0;d!==C;d++)h.addEquation(P[d]);h.solve(t,O),h.removeAllEquations(),x++}return x}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,n,r){var EventTarget=function(){};n.exports=EventTarget,EventTarget.prototype={constructor:EventTarget,addEventListener:function(t,n){void 0===this._listeners&&(this._listeners={});var r=this._listeners;return void 0===r[t]&&(r[t]=[]),-1===r[t].indexOf(n)&&r[t].push(n),this},hasEventListener:function(t,n){if(void 0===this._listeners)return!1;var r=this._listeners;return void 0!==r[t]&&-1!==r[t].indexOf(n)},removeEventListener:function(t,n){if(void 0===this._listeners)return this;var r=this._listeners;if(void 0===r[t])return this;var o=r[t].indexOf(n);return-1!==o&&r[t].splice(o,1),this},dispatchEvent:function(t){if(void 0===this._listeners)return this;var n=this._listeners[t.type];if(void 0!==n){t.target=this;for(var r=0,o=n.length;r<o;r++)n[r].call(this,t)}return this}}},{}],50:[function(t,n,r){var o=t("../collision/AABB"),i=t("../math/Vec3");function OctreeNode(t){t=t||{},this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new o,this.data=[],this.children=[]}function Octree(t,n){(n=n||{}).root=null,n.aabb=t,OctreeNode.call(this,n),this.maxDepth=void 0!==n.maxDepth?n.maxDepth:8}n.exports=Octree,Octree.prototype=new OctreeNode,OctreeNode.prototype.reset=function(t,n){this.children.length=this.data.length=0},OctreeNode.prototype.insert=function(t,n,r){var o=this.data;if(r=r||0,!this.aabb.contains(t))return!1;var i=this.children;if(r<(this.maxDepth||this.root.maxDepth)){var a=!1;i.length||(this.subdivide(),a=!0);for(var c=0;8!==c;c++)if(i[c].insert(t,n,r+1))return!0;a&&(i.length=0)}return o.push(n),!0};var a=new i;OctreeNode.prototype.subdivide=function(){var t=this.aabb,n=t.lowerBound,r=t.upperBound,c=this.children;c.push(new OctreeNode({aabb:new o({lowerBound:new i(0,0,0)})}),new OctreeNode({aabb:new o({lowerBound:new i(1,0,0)})}),new OctreeNode({aabb:new o({lowerBound:new i(1,1,0)})}),new OctreeNode({aabb:new o({lowerBound:new i(1,1,1)})}),new OctreeNode({aabb:new o({lowerBound:new i(0,1,1)})}),new OctreeNode({aabb:new o({lowerBound:new i(0,0,1)})}),new OctreeNode({aabb:new o({lowerBound:new i(1,0,1)})}),new OctreeNode({aabb:new o({lowerBound:new i(0,1,0)})})),r.vsub(n,a),a.scale(.5,a);for(var u=this.root||this,l=0;8!==l;l++){var p=c[l];p.root=u;var f=p.aabb.lowerBound;f.x*=a.x,f.y*=a.y,f.z*=a.z,f.vadd(n,f),f.vadd(a,p.aabb.upperBound)}},OctreeNode.prototype.aabbQuery=function(t,n){this.data,this.children;for(var r=[this];r.length;){var o=r.pop();o.aabb.overlaps(t)&&Array.prototype.push.apply(n,o.data),Array.prototype.push.apply(r,o.children)}return n};var c=new o;OctreeNode.prototype.rayQuery=function(t,n,r){return t.getAABB(c),c.toLocalFrame(n,c),this.aabbQuery(c,r),r},OctreeNode.prototype.removeEmptyNodes=function(){for(var t=[this];t.length;){for(var n=t.pop(),r=n.children.length-1;r>=0;r--)n.children[r].data.length||n.children.splice(r,1);Array.prototype.push.apply(t,n.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,n,r){function Pool(){this.objects=[],this.type=Object}n.exports=Pool,Pool.prototype.release=function(){for(var t=arguments.length,n=0;n!==t;n++)this.objects.push(arguments[n])},Pool.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},Pool.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,n,r){function TupleDictionary(){this.data={keys:[]}}n.exports=TupleDictionary,TupleDictionary.prototype.get=function(t,n){if(t>n){var r=n;n=t,t=r}return this.data[t+"-"+n]},TupleDictionary.prototype.set=function(t,n,r){if(t>n){var o=n;n=t,t=o}var i=t+"-"+n;this.get(t,n)||this.data.keys.push(i),this.data[i]=r},TupleDictionary.prototype.reset=function(){for(var t=this.data,n=t.keys;n.length>0;)delete t[n.pop()]}},{}],53:[function(t,n,r){function Utils(){}n.exports=Utils,Utils.defaults=function(t,n){for(var r in t=t||{},n)r in t||(t[r]=n[r]);return t}},{}],54:[function(t,n,r){n.exports=Vec3Pool;var o=t("../math/Vec3"),i=t("./Pool");function Vec3Pool(){i.call(this),this.type=o}Vec3Pool.prototype=new i,Vec3Pool.prototype.constructObject=function(){return new o}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,n,r){n.exports=Narrowphase;var o=t("../collision/AABB"),i=t("../shapes/Shape"),a=t("../collision/Ray"),c=t("../math/Vec3"),u=t("../math/Transform"),l=(t("../shapes/ConvexPolyhedron"),t("../math/Quaternion")),p=(t("../solver/Solver"),t("../utils/Vec3Pool")),f=t("../equations/ContactEquation"),h=t("../equations/FrictionEquation");function Narrowphase(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new p,this.world=t,this.currentContactMaterial=null,this.enableFrictionReduction=!1}Narrowphase.prototype.createContactEquation=function(t,n,r,o,i,a){var c;this.contactPointPool.length?((c=this.contactPointPool.pop()).bi=t,c.bj=n):c=new f(t,n),c.enabled=t.collisionResponse&&n.collisionResponse&&r.collisionResponse&&o.collisionResponse;var u=this.currentContactMaterial;c.restitution=u.restitution,c.setSpookParams(u.contactEquationStiffness,u.contactEquationRelaxation,this.world.dt);var l=r.material||t.material,p=o.material||n.material;return l&&p&&l.restitution>=0&&p.restitution>=0&&(c.restitution=l.restitution*p.restitution),c.si=i||r,c.sj=a||o,c},Narrowphase.prototype.createFrictionEquationsFromContact=function(t,n){var r=t.bi,o=t.bj,i=t.si,a=t.sj,c=this.world,u=this.currentContactMaterial,l=u.friction,p=i.material||r.material,f=a.material||o.material;if(p&&f&&p.friction>=0&&f.friction>=0&&(l=p.friction*f.friction),l>0){var d=l*c.gravity.length(),y=r.invMass+o.invMass;y>0&&(y=1/y);var m=this.frictionEquationPool,v=m.length?m.pop():new h(r,o,d*y),g=m.length?m.pop():new h(r,o,d*y);return v.bi=g.bi=r,v.bj=g.bj=o,v.minForce=g.minForce=-d*y,v.maxForce=g.maxForce=d*y,v.ri.copy(t.ri),v.rj.copy(t.rj),g.ri.copy(t.ri),g.rj.copy(t.rj),t.ni.tangents(v.t,g.t),v.setSpookParams(u.frictionEquationStiffness,u.frictionEquationRelaxation,c.dt),g.setSpookParams(u.frictionEquationStiffness,u.frictionEquationRelaxation,c.dt),v.enabled=g.enabled=t.enabled,n.push(v,g),!0}return!1};var d=new c,y=new c,m=new c;Narrowphase.prototype.createFrictionFromAverage=function(t){var n=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(n,this.frictionResult)&&1!==t){var r=this.frictionResult[this.frictionResult.length-2],o=this.frictionResult[this.frictionResult.length-1];d.setZero(),y.setZero(),m.setZero();for(var i=n.bi,a=(n.bj,0);a!==t;a++)(n=this.result[this.result.length-1-a]).bodyA!==i?(d.vadd(n.ni,d),y.vadd(n.ri,y),m.vadd(n.rj,m)):(d.vsub(n.ni,d),y.vadd(n.rj,y),m.vadd(n.ri,m));var c=1/t;y.scale(c,r.ri),m.scale(c,r.rj),o.ri.copy(r.ri),o.rj.copy(r.rj),d.normalize(),d.tangents(r.t,o.t)}};var v=new c,g=new c,_=new l,b=new l;Narrowphase.prototype.getContacts=function(t,n,r,o,i,a,c){this.contactPointPool=i,this.frictionEquationPool=c,this.result=o,this.frictionResult=a;for(var u=_,l=b,p=v,f=g,h=0,d=t.length;h!==d;h++){var y=t[h],m=n[h],w=null;y.material&&m.material&&(w=r.getContactMaterial(y.material,m.material)||null);for(var x=0;x<y.shapes.length;x++){y.quaternion.mult(y.shapeOrientations[x],u),y.quaternion.vmult(y.shapeOffsets[x],p),p.vadd(y.position,p);for(var P=y.shapes[x],O=0;O<m.shapes.length;O++){m.quaternion.mult(m.shapeOrientations[O],l),m.quaternion.vmult(m.shapeOffsets[O],f),f.vadd(m.position,f);var C=m.shapes[O];if(!(p.distanceTo(f)>P.boundingSphereRadius+C.boundingSphereRadius)){var S=null;P.material&&C.material&&(S=r.getContactMaterial(P.material,C.material)||null),this.currentContactMaterial=S||w||r.defaultContactMaterial;var A=this[P.type|C.type];A&&(P.type<C.type?A.call(this,P,C,p,f,u,l,y,m,P,C):A.call(this,C,P,f,p,l,u,m,y,P,C))}}}}},Narrowphase.prototype[i.types.BOX|i.types.BOX]=Narrowphase.prototype.boxBox=function(t,n,r,o,i,a,c,u){t.convexPolyhedronRepresentation.material=t.material,n.convexPolyhedronRepresentation.material=n.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,n.convexPolyhedronRepresentation.collisionResponse=n.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,n.convexPolyhedronRepresentation,r,o,i,a,c,u,t,n)},Narrowphase.prototype[i.types.BOX|i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.boxConvex=function(t,n,r,o,i,a,c,u){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,n,r,o,i,a,c,u,t,n)},Narrowphase.prototype[i.types.BOX|i.types.PARTICLE]=Narrowphase.prototype.boxParticle=function(t,n,r,o,i,a,c,u){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,n,r,o,i,a,c,u,t,n)},Narrowphase.prototype[i.types.SPHERE]=Narrowphase.prototype.sphereSphere=function(t,n,r,o,i,a,c,u){var l=this.createContactEquation(c,u,t,n);o.vsub(r,l.ni),l.ni.normalize(),l.ri.copy(l.ni),l.rj.copy(l.ni),l.ri.mult(t.radius,l.ri),l.rj.mult(-n.radius,l.rj),l.ri.vadd(r,l.ri),l.ri.vsub(c.position,l.ri),l.rj.vadd(o,l.rj),l.rj.vsub(u.position,l.rj),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)};var w=new c,x=new c,P=new c;Narrowphase.prototype[i.types.PLANE|i.types.TRIMESH]=Narrowphase.prototype.planeTrimesh=function(t,n,r,o,i,a,l,p){var f=new c,h=w;h.set(0,0,1),i.vmult(h,h);for(var d=0;d<n.vertices.length/3;d++){n.getVertex(d,f);var y=new c;y.copy(f),u.pointToWorldFrame(o,a,y,f);var m=x;if(f.vsub(r,m),h.dot(m)<=0){var v=this.createContactEquation(l,p,t,n);v.ni.copy(h);var g=P;h.scale(m.dot(h),g),f.vsub(g,g),v.ri.copy(g),v.ri.vsub(l.position,v.ri),v.rj.copy(f),v.rj.vsub(p.position,v.rj),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}};var O=new c,C=new c,S=(new c,new c),A=new c,E=new c,j=new c,T=new c,R=new c,B=new c,M=new c,I=new c,z=new c,k=new c,D=new o,F=[];Narrowphase.prototype[i.types.SPHERE|i.types.TRIMESH]=Narrowphase.prototype.sphereTrimesh=function(t,n,r,o,i,c,l,p){var f=E,h=j,d=T,y=R,m=B,v=M,g=D,_=A,b=C,w=F;u.pointToLocalFrame(o,c,r,m);var x=t.radius;g.lowerBound.set(m.x-x,m.y-x,m.z-x),g.upperBound.set(m.x+x,m.y+x,m.z+x),n.getTrianglesInAABB(g,w);for(var P=S,L=t.radius*t.radius,N=0;N<w.length;N++)for(var V=0;V<3;V++)n.getVertex(n.indices[3*w[N]+V],P),P.vsub(m,b),b.norm2()<=L&&(_.copy(P),u.pointToWorldFrame(o,c,_,P),P.vsub(r,b),(q=this.createContactEquation(l,p,t,n)).ni.copy(b),q.ni.normalize(),q.ri.copy(q.ni),q.ri.scale(t.radius,q.ri),q.ri.vadd(r,q.ri),q.ri.vsub(l.position,q.ri),q.rj.copy(P),q.rj.vsub(p.position,q.rj),this.result.push(q),this.createFrictionEquationsFromContact(q,this.frictionResult));for(N=0;N<w.length;N++)for(V=0;V<3;V++){n.getVertex(n.indices[3*w[N]+V],f),n.getVertex(n.indices[3*w[N]+(V+1)%3],h),h.vsub(f,d),m.vsub(h,v);var U=v.dot(d);m.vsub(f,v);var W=v.dot(d);if(W>0&&U<0&&(m.vsub(f,v),y.copy(d),y.normalize(),W=v.dot(y),y.scale(W,v),v.vadd(f,v),(Y=v.distanceTo(m))<t.radius)){var q=this.createContactEquation(l,p,t,n);v.vsub(m,q.ni),q.ni.normalize(),q.ni.scale(t.radius,q.ri),u.pointToWorldFrame(o,c,v,v),v.vsub(p.position,q.rj),u.vectorToWorldFrame(c,q.ni,q.ni),u.vectorToWorldFrame(c,q.ri,q.ri),this.result.push(q),this.createFrictionEquationsFromContact(q,this.frictionResult)}}for(var G=I,H=z,X=k,K=O,Q=(N=0,w.length);N!==Q;N++){n.getTriangleVertices(w[N],G,H,X),n.getNormal(w[N],K),m.vsub(G,v);var Y=v.dot(K);K.scale(Y,v),m.vsub(v,v),Y=v.distanceTo(m),a.pointInTriangle(v,G,H,X)&&Y<t.radius&&(q=this.createContactEquation(l,p,t,n),v.vsub(m,q.ni),q.ni.normalize(),q.ni.scale(t.radius,q.ri),u.pointToWorldFrame(o,c,v,v),v.vsub(p.position,q.rj),u.vectorToWorldFrame(c,q.ni,q.ni),u.vectorToWorldFrame(c,q.ri,q.ri),this.result.push(q),this.createFrictionEquationsFromContact(q,this.frictionResult))}w.length=0};var L=new c,N=new c;Narrowphase.prototype[i.types.SPHERE|i.types.PLANE]=Narrowphase.prototype.spherePlane=function(t,n,r,o,i,a,c,u){var l=this.createContactEquation(c,u,t,n);if(l.ni.set(0,0,1),a.vmult(l.ni,l.ni),l.ni.negate(l.ni),l.ni.normalize(),l.ni.mult(t.radius,l.ri),r.vsub(o,L),l.ni.mult(l.ni.dot(L),N),L.vsub(N,l.rj),-L.dot(l.ni)<=t.radius){var p=l.ri,f=l.rj;p.vadd(r,p),p.vsub(c.position,p),f.vadd(o,f),f.vsub(u.position,f),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)}};var V=new c,U=new c,W=new c;function pointInPolygon(t,n,r){for(var o=null,i=t.length,a=0;a!==i;a++){var c=t[a],u=V;t[(a+1)%i].vsub(c,u);var l=U;u.cross(n,l);var p=W;r.vsub(c,p);var f=l.dot(p);if(!(null===o||f>0&&!0===o||f<=0&&!1===o))return!1;null===o&&(o=f>0)}return!0}var q=new c,G=new c,H=new c,X=new c,K=[new c,new c,new c,new c,new c,new c],Q=new c,Y=new c,Z=new c,J=new c;Narrowphase.prototype[i.types.SPHERE|i.types.BOX]=Narrowphase.prototype.sphereBox=function(t,n,r,o,i,a,c,u){var l=this.v3pool,p=K;r.vsub(o,q),n.getSideNormals(p,a);for(var f=t.radius,h=!1,d=Y,y=Z,m=J,v=null,g=0,_=0,b=0,w=null,x=0,P=p.length;x!==P&&!1===h;x++){var O=G;O.copy(p[x]);var C=O.norm();O.normalize();var S=q.dot(O);if(S<C+f&&S>0){var A=H,E=X;A.copy(p[(x+1)%3]),E.copy(p[(x+2)%3]);var j=A.norm(),T=E.norm();A.normalize(),E.normalize();var R=q.dot(A),B=q.dot(E);if(R<j&&R>-j&&B<T&&B>-T){var M=Math.abs(S-C-f);(null===w||M<w)&&(w=M,_=R,b=B,v=C,d.copy(O),y.copy(A),m.copy(E),g++)}}}if(g){h=!0;var I=this.createContactEquation(c,u,t,n);d.mult(-f,I.ri),I.ni.copy(d),I.ni.negate(I.ni),d.mult(v,d),y.mult(_,y),d.vadd(y,d),m.mult(b,m),d.vadd(m,I.rj),I.ri.vadd(r,I.ri),I.ri.vsub(c.position,I.ri),I.rj.vadd(o,I.rj),I.rj.vsub(u.position,I.rj),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult)}for(var z=l.get(),k=Q,D=0;2!==D&&!h;D++)for(var F=0;2!==F&&!h;F++)for(var L=0;2!==L&&!h;L++)z.set(0,0,0),D?z.vadd(p[0],z):z.vsub(p[0],z),F?z.vadd(p[1],z):z.vsub(p[1],z),L?z.vadd(p[2],z):z.vsub(p[2],z),o.vadd(z,k),k.vsub(r,k),k.norm2()<f*f&&(h=!0,(I=this.createContactEquation(c,u,t,n)).ri.copy(k),I.ri.normalize(),I.ni.copy(I.ri),I.ri.mult(f,I.ri),I.rj.copy(z),I.ri.vadd(r,I.ri),I.ri.vsub(c.position,I.ri),I.rj.vadd(o,I.rj),I.rj.vsub(u.position,I.rj),this.result.push(I),this.createFrictionEquationsFromContact(I,this.frictionResult));l.release(z),z=null;var N=l.get(),V=l.get(),U=(I=l.get(),l.get()),W=(M=l.get(),p.length);for(D=0;D!==W&&!h;D++)for(F=0;F!==W&&!h;F++)if(D%3!=F%3){p[F].cross(p[D],N),N.normalize(),p[D].vadd(p[F],V),I.copy(r),I.vsub(V,I),I.vsub(o,I);var $=I.dot(N);for(N.mult($,U),L=0;L===D%3||L===F%3;)L++;M.copy(r),M.vsub(U,M),M.vsub(V,M),M.vsub(o,M);var tt=Math.abs($),et=M.norm();if(tt<p[L].norm()&&et<f){h=!0;var nt=this.createContactEquation(c,u,t,n);V.vadd(U,nt.rj),nt.rj.copy(nt.rj),M.negate(nt.ni),nt.ni.normalize(),nt.ri.copy(nt.rj),nt.ri.vadd(o,nt.ri),nt.ri.vsub(r,nt.ri),nt.ri.normalize(),nt.ri.mult(f,nt.ri),nt.ri.vadd(r,nt.ri),nt.ri.vsub(c.position,nt.ri),nt.rj.vadd(o,nt.rj),nt.rj.vsub(u.position,nt.rj),this.result.push(nt),this.createFrictionEquationsFromContact(nt,this.frictionResult)}}l.release(N,V,I,U,M)};var $=new c,tt=new c,et=new c,nt=new c,rt=new c,ot=new c,it=new c,at=new c,st=new c,ct=new c;Narrowphase.prototype[i.types.SPHERE|i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.sphereConvex=function(t,n,r,o,i,a,c,u){var l=this.v3pool;r.vsub(o,$);for(var p=n.faceNormals,f=n.faces,h=n.vertices,d=t.radius,y=0;y!==h.length;y++){var m=h[y],v=rt;a.vmult(m,v),o.vadd(v,v);var g=nt;if(v.vsub(r,g),g.norm2()<d*d)return _=!0,(M=this.createContactEquation(c,u,t,n)).ri.copy(g),M.ri.normalize(),M.ni.copy(M.ri),M.ri.mult(d,M.ri),v.vsub(o,M.rj),M.ri.vadd(r,M.ri),M.ri.vsub(c.position,M.ri),M.rj.vadd(o,M.rj),M.rj.vsub(u.position,M.rj),this.result.push(M),void this.createFrictionEquationsFromContact(M,this.frictionResult)}for(var _=!1,b=(y=0,f.length);y!==b&&!1===_;y++){var w=p[y],x=f[y],P=ot;a.vmult(w,P);var O=it;a.vmult(h[x[0]],O),O.vadd(o,O);var C=at;P.mult(-d,C),r.vadd(C,C);var S=st;C.vsub(O,S);var A=S.dot(P),E=ct;if(r.vsub(O,E),A<0&&E.dot(P)>0){for(var j=[],T=0,R=x.length;T!==R;T++){var B=l.get();a.vmult(h[x[T]],B),o.vadd(B,B),j.push(B)}if(pointInPolygon(j,P,r)){_=!0;var M=this.createContactEquation(c,u,t,n);P.mult(-d,M.ri),P.negate(M.ni);var I=l.get();P.mult(-A,I);var z=l.get();P.mult(-d,z),r.vsub(o,M.rj),M.rj.vadd(z,M.rj),M.rj.vadd(I,M.rj),M.rj.vadd(o,M.rj),M.rj.vsub(u.position,M.rj),M.ri.vadd(r,M.ri),M.ri.vsub(c.position,M.ri),l.release(I),l.release(z),this.result.push(M),this.createFrictionEquationsFromContact(M,this.frictionResult),T=0;for(var k=j.length;T!==k;T++)l.release(j[T]);return}for(T=0;T!==x.length;T++){var D=l.get(),F=l.get();a.vmult(h[x[(T+1)%x.length]],D),a.vmult(h[x[(T+2)%x.length]],F),o.vadd(D,D),o.vadd(F,F);var L=tt;F.vsub(D,L);var N=et;L.unit(N);var V=l.get(),U=l.get();r.vsub(D,U);var W=U.dot(N);N.mult(W,V),V.vadd(D,V);var q=l.get();if(V.vsub(r,q),W>0&&W*W<L.norm2()&&q.norm2()<d*d){for(M=this.createContactEquation(c,u,t,n),V.vsub(o,M.rj),V.vsub(r,M.ni),M.ni.normalize(),M.ni.mult(d,M.ri),M.rj.vadd(o,M.rj),M.rj.vsub(u.position,M.rj),M.ri.vadd(r,M.ri),M.ri.vsub(c.position,M.ri),this.result.push(M),this.createFrictionEquationsFromContact(M,this.frictionResult),T=0,k=j.length;T!==k;T++)l.release(j[T]);return l.release(D),l.release(F),l.release(V),l.release(q),void l.release(U)}l.release(D),l.release(F),l.release(V),l.release(q),l.release(U)}for(T=0,k=j.length;T!==k;T++)l.release(j[T])}}},new c,new c,Narrowphase.prototype[i.types.PLANE|i.types.BOX]=Narrowphase.prototype.planeBox=function(t,n,r,o,i,a,c,u){n.convexPolyhedronRepresentation.material=n.material,n.convexPolyhedronRepresentation.collisionResponse=n.collisionResponse,this.planeConvex(t,n.convexPolyhedronRepresentation,r,o,i,a,c,u)};var ut=new c,lt=new c,pt=new c,ft=new c;Narrowphase.prototype[i.types.PLANE|i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.planeConvex=function(t,n,r,o,i,a,c,u){var l=ut,p=lt;p.set(0,0,1),i.vmult(p,p);for(var f=0,h=pt,d=0;d!==n.vertices.length;d++)if(l.copy(n.vertices[d]),a.vmult(l,l),o.vadd(l,l),l.vsub(r,h),p.dot(h)<=0){var y=this.createContactEquation(c,u,t,n),m=ft;p.mult(p.dot(h),m),l.vsub(m,m),m.vsub(r,y.ri),y.ni.copy(p),l.vsub(o,y.rj),y.ri.vadd(r,y.ri),y.ri.vsub(c.position,y.ri),y.rj.vadd(o,y.rj),y.rj.vsub(u.position,y.rj),this.result.push(y),f++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(y,this.frictionResult)}this.enableFrictionReduction&&f&&this.createFrictionFromAverage(f)};var ht=new c,dt=new c;Narrowphase.prototype[i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.convexConvex=function(t,n,r,o,i,a,c,u,l,p,f,h){var d=ht;if(!(r.distanceTo(o)>t.boundingSphereRadius+n.boundingSphereRadius)&&t.findSeparatingAxis(n,r,i,o,a,d,f,h)){var y=[],m=dt;t.clipAgainstHull(r,i,n,o,a,d,-100,100,y);for(var v=0,g=0;g!==y.length;g++){var _=this.createContactEquation(c,u,t,n,l,p),b=_.ri,w=_.rj;d.negate(_.ni),y[g].normal.negate(m),m.mult(y[g].depth,m),y[g].point.vadd(m,b),w.copy(y[g].point),b.vsub(r,b),w.vsub(o,w),b.vadd(r,b),b.vsub(c.position,b),w.vadd(o,w),w.vsub(u.position,w),this.result.push(_),v++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(_,this.frictionResult)}this.enableFrictionReduction&&v&&this.createFrictionFromAverage(v)}};var yt=new c,mt=new c,vt=new c;Narrowphase.prototype[i.types.PLANE|i.types.PARTICLE]=Narrowphase.prototype.planeParticle=function(t,n,r,o,i,a,c,u){var l=yt;l.set(0,0,1),c.quaternion.vmult(l,l);var p=mt;if(o.vsub(c.position,p),l.dot(p)<=0){var f=this.createContactEquation(u,c,n,t);f.ni.copy(l),f.ni.negate(f.ni),f.ri.set(0,0,0);var h=vt;l.mult(l.dot(o),h),o.vsub(h,h),f.rj.copy(h),this.result.push(f),this.createFrictionEquationsFromContact(f,this.frictionResult)}};var gt=new c;Narrowphase.prototype[i.types.PARTICLE|i.types.SPHERE]=Narrowphase.prototype.sphereParticle=function(t,n,r,o,i,a,c,u){var l=gt;if(l.set(0,0,1),o.vsub(r,l),l.norm2()<=t.radius*t.radius){var p=this.createContactEquation(u,c,n,t);l.normalize(),p.rj.copy(l),p.rj.mult(t.radius,p.rj),p.ni.copy(l),p.ni.negate(p.ni),p.ri.set(0,0,0),this.result.push(p),this.createFrictionEquationsFromContact(p,this.frictionResult)}};var _t=new l,bt=new c,wt=(new c,new c),xt=new c,Pt=new c;Narrowphase.prototype[i.types.PARTICLE|i.types.CONVEXPOLYHEDRON]=Narrowphase.prototype.convexParticle=function(t,n,r,o,i,a,c,u){var l=-1,p=wt,f=Pt,h=null,d=bt;if(d.copy(o),d.vsub(r,d),i.conjugate(_t),_t.vmult(d,d),t.pointIsInside(d)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(r,i),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(i);for(var y=0,m=t.faces.length;y!==m;y++){var v=[t.worldVertices[t.faces[y][0]]],g=t.worldFaceNormals[y];o.vsub(v[0],xt);var _=-g.dot(xt);(null===h||Math.abs(_)<Math.abs(h))&&(h=_,l=y,p.copy(g))}if(-1!==l){var b=this.createContactEquation(u,c,n,t);p.mult(h,f),f.vadd(o,f),f.vsub(r,f),b.rj.copy(f),p.negate(b.ni),b.ri.set(0,0,0);var w=b.ri,x=b.rj;w.vadd(o,w),w.vsub(u.position,w),x.vadd(r,x),x.vsub(c.position,x),this.result.push(b),this.createFrictionEquationsFromContact(b,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},Narrowphase.prototype[i.types.BOX|i.types.HEIGHTFIELD]=Narrowphase.prototype.boxHeightfield=function(t,n,r,o,i,a,c,u){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,n,r,o,i,a,c,u)};var Ot=new c,Ct=new c,St=[0];Narrowphase.prototype[i.types.CONVEXPOLYHEDRON|i.types.HEIGHTFIELD]=Narrowphase.prototype.convexHeightfield=function(t,n,r,o,i,a,c,l){var p=n.data,f=n.elementSize,h=t.boundingSphereRadius,d=Ct,y=St,m=Ot;u.pointToLocalFrame(o,a,r,m);var v=Math.floor((m.x-h)/f)-1,g=Math.ceil((m.x+h)/f)+1,_=Math.floor((m.y-h)/f)-1,b=Math.ceil((m.y+h)/f)+1;if(!(g<0||b<0||v>p.length||_>p[0].length)){v<0&&(v=0),g<0&&(g=0),_<0&&(_=0),b<0&&(b=0),v>=p.length&&(v=p.length-1),g>=p.length&&(g=p.length-1),b>=p[0].length&&(b=p[0].length-1),_>=p[0].length&&(_=p[0].length-1);var w=[];n.getRectMinMax(v,_,g,b,w);var x=w[0],P=w[1];if(!(m.z-h>P||m.z+h<x))for(var O=v;O<g;O++)for(var C=_;C<b;C++)n.getConvexTrianglePillar(O,C,!1),u.pointToWorldFrame(o,a,n.pillarOffset,d),r.distanceTo(d)<n.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,n.pillarConvex,r,d,i,a,c,l,null,null,y,null),n.getConvexTrianglePillar(O,C,!0),u.pointToWorldFrame(o,a,n.pillarOffset,d),r.distanceTo(d)<n.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,n.pillarConvex,r,d,i,a,c,l,null,null,y,null)}};var At=new c,Et=new c;Narrowphase.prototype[i.types.SPHERE|i.types.HEIGHTFIELD]=Narrowphase.prototype.sphereHeightfield=function(t,n,r,o,i,a,c,l){var p=n.data,f=t.radius,h=n.elementSize,d=Et,y=At;u.pointToLocalFrame(o,a,r,y);var m=Math.floor((y.x-f)/h)-1,v=Math.ceil((y.x+f)/h)+1,g=Math.floor((y.y-f)/h)-1,_=Math.ceil((y.y+f)/h)+1;if(!(v<0||_<0||m>p.length||_>p[0].length)){m<0&&(m=0),v<0&&(v=0),g<0&&(g=0),_<0&&(_=0),m>=p.length&&(m=p.length-1),v>=p.length&&(v=p.length-1),_>=p[0].length&&(_=p[0].length-1),g>=p[0].length&&(g=p[0].length-1);var b=[];n.getRectMinMax(m,g,v,_,b);var w=b[0],x=b[1];if(!(y.z-f>x||y.z+f<w))for(var P=this.result,O=m;O<v;O++)for(var C=g;C<_;C++){var S=P.length;if(n.getConvexTrianglePillar(O,C,!1),u.pointToWorldFrame(o,a,n.pillarOffset,d),r.distanceTo(d)<n.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,n.pillarConvex,r,d,i,a,c,l),n.getConvexTrianglePillar(O,C,!0),u.pointToWorldFrame(o,a,n.pillarOffset,d),r.distanceTo(d)<n.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,n.pillarConvex,r,d,i,a,c,l),P.length-S>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,n,r){n.exports=World;var o=t("../shapes/Shape"),i=t("../math/Vec3"),a=t("../math/Quaternion"),c=t("../solver/GSSolver"),u=(t("../utils/Vec3Pool"),t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("./Narrowphase")),l=t("../utils/EventTarget"),p=t("../collision/ArrayCollisionMatrix"),f=t("../material/Material"),h=t("../material/ContactMaterial"),d=t("../objects/Body"),y=t("../utils/TupleDictionary"),m=t("../collision/RaycastResult"),v=t("../collision/AABB"),g=t("../collision/Ray"),_=t("../collision/NaiveBroadphase");function World(){l.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new i,this.broadphase=new _,this.bodies=[],this.solver=new c,this.constraints=[],this.narrowphase=new u(this),this.collisionMatrix=new p,this.collisionMatrixPrevious=new p,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new y,this.defaultMaterial=new f("default"),this.defaultContactMaterial=new h(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}World.prototype=new l,new v;var b=new g;if(World.prototype.getContactMaterial=function(t,n){return this.contactMaterialTable.get(t.id,n.id)},World.prototype.numObjects=function(){return this.bodies.length},World.prototype.collisionMatrixTick=function(){var t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset()},World.prototype.add=World.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof d&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.dispatchEvent(this.addBodyEvent))},World.prototype.addConstraint=function(t){this.constraints.push(t)},World.prototype.removeConstraint=function(t){var n=this.constraints.indexOf(t);-1!==n&&this.constraints.splice(n,1)},World.prototype.rayTest=function(t,n,r){r instanceof m?this.raycastClosest(t,n,{skipBackfaces:!0},r):this.raycastAll(t,n,{skipBackfaces:!0},r)},World.prototype.raycastAll=function(t,n,r,o){return r.mode=g.ALL,r.from=t,r.to=n,r.callback=o,b.intersectWorld(this,r)},World.prototype.raycastAny=function(t,n,r,o){return r.mode=g.ANY,r.from=t,r.to=n,r.result=o,b.intersectWorld(this,r)},World.prototype.raycastClosest=function(t,n,r,o){return r.mode=g.CLOSEST,r.from=t,r.to=n,r.result=o,b.intersectWorld(this,r)},World.prototype.remove=function(t){t.world=null;var n=this.bodies.length-1,r=this.bodies,o=r.indexOf(t);if(-1!==o){r.splice(o,1);for(var i=0;i!==r.length;i++)r[i].index=i;this.collisionMatrix.setNumObjects(n),this.removeBodyEvent.body=t,this.dispatchEvent(this.removeBodyEvent)}},World.prototype.removeBody=World.prototype.remove,World.prototype.addMaterial=function(t){this.materials.push(t)},World.prototype.addContactMaterial=function(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)},"undefined"==typeof performance&&(performance={}),!performance.now){var w=Date.now();performance.timing&&performance.timing.navigationStart&&(w=performance.timing.navigationStart),performance.now=function(){return Date.now()-w}}var x=new i;World.prototype.step=function(t,n,r){if(r=r||10,0===(n=n||0))this.internalStep(t),this.time+=t;else{var o=Math.floor((this.time+n)/t)-Math.floor(this.time/t);o=Math.min(o,r);for(var i=performance.now(),a=0;a!==o&&(this.internalStep(t),!(performance.now()-i>1e3*t));a++);this.time+=n;for(var c=this.time%t/t,u=x,l=this.bodies,p=0;p!==l.length;p++){var f=l[p];f.type!==d.STATIC&&f.sleepState!==d.SLEEPING?(f.position.vsub(f.previousPosition,u),u.scale(c,u),f.position.vadd(u,f.interpolatedPosition)):(f.interpolatedPosition.copy(f.position),f.interpolatedQuaternion.copy(f.quaternion))}}};var P={type:"postStep"},O={type:"preStep"},C={type:"collide",body:null,contact:null},S=[],A=[],E=[],j=[],T=(new i,new i,new i,new i,new i,new i,new i,new i,new i,new a,new a),R=new a,B=new i;World.prototype.internalStep=function(t){this.dt=t;var n,r=this.contacts,i=E,a=j,c=this.numObjects(),u=this.bodies,l=this.solver,p=this.gravity,f=this.doProfiling,h=this.profile,y=d.DYNAMIC,m=this.constraints,v=A,g=(p.norm(),p.x),_=p.y,b=p.z,w=0;for(f&&(n=performance.now()),w=0;w!==c;w++)if((U=u[w]).type&y){var x=U.force,M=U.mass;x.x+=M*g,x.y+=M*_,x.z+=M*b}w=0;for(var I=this.subsystems.length;w!==I;w++)this.subsystems[w].update();f&&(n=performance.now()),i.length=0,a.length=0,this.broadphase.collisionPairs(this,i,a),f&&(h.broadphase=performance.now()-n);var z=m.length;for(w=0;w!==z;w++)if(!(q=m[w]).collideConnected)for(var k=i.length-1;k>=0;k-=1)(q.bodyA===i[k]&&q.bodyB===a[k]||q.bodyB===i[k]&&q.bodyA===a[k])&&(i.splice(k,1),a.splice(k,1));this.collisionMatrixTick(),f&&(n=performance.now());var D=S,F=r.length;for(w=0;w!==F;w++)D.push(r[w]);r.length=0;var L=this.frictionEquations.length;for(w=0;w!==L;w++)v.push(this.frictionEquations[w]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(i,a,this,r,D,this.frictionEquations,v),f&&(h.narrowphase=performance.now()-n),f&&(n=performance.now()),w=0;w<this.frictionEquations.length;w++)l.addEquation(this.frictionEquations[w]);for(var N=r.length,V=0;V!==N;V++){var U=(q=r[V]).bi,W=q.bj;q.si,q.sj,(U.material&&W.material&&this.getContactMaterial(U.material,W.material)||this.defaultContactMaterial).friction,U.material&&W.material&&(U.material.friction>=0&&W.material.friction>=0&&(U.material.friction,W.material.friction),U.material.restitution>=0&&W.material.restitution>=0&&(q.restitution=U.material.restitution*W.material.restitution)),l.addEquation(q),U.allowSleep&&U.type===d.DYNAMIC&&U.sleepState===d.SLEEPING&&W.sleepState===d.AWAKE&&W.type!==d.STATIC&&W.velocity.norm2()+W.angularVelocity.norm2()>=2*Math.pow(W.sleepSpeedLimit,2)&&(U._wakeUpAfterNarrowphase=!0),W.allowSleep&&W.type===d.DYNAMIC&&W.sleepState===d.SLEEPING&&U.sleepState===d.AWAKE&&U.type!==d.STATIC&&U.velocity.norm2()+U.angularVelocity.norm2()>=2*Math.pow(U.sleepSpeedLimit,2)&&(W._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(U,W,!0),this.collisionMatrixPrevious.get(U,W)||(C.body=W,C.contact=q,U.dispatchEvent(C),C.body=U,W.dispatchEvent(C))}for(f&&(h.makeContactConstraints=performance.now()-n,n=performance.now()),w=0;w!==c;w++)(U=u[w])._wakeUpAfterNarrowphase&&(U.wakeUp(),U._wakeUpAfterNarrowphase=!1);for(z=m.length,w=0;w!==z;w++){var q;(q=m[w]).update(),k=0;for(var G=q.equations.length;k!==G;k++){var H=q.equations[k];l.addEquation(H)}}l.solve(t,this),f&&(h.solve=performance.now()-n),l.removeAllEquations();var X=Math.pow;for(w=0;w!==c;w++)if((U=u[w]).type&y){var K=X(1-U.linearDamping,t),Q=U.velocity;Q.mult(K,Q);var Y=U.angularVelocity;if(Y){var Z=X(1-U.angularDamping,t);Y.mult(Z,Y)}}for(this.dispatchEvent(O),w=0;w!==c;w++)(U=u[w]).preStep&&U.preStep.call(U);f&&(n=performance.now());var J=T,$=R,tt=this.stepnumber,et=d.DYNAMIC|d.KINEMATIC,nt=tt%(this.quatNormalizeSkip+1)==0,rt=this.quatNormalizeFast,ot=.5*t;for(o.types.PLANE,o.types.CONVEXPOLYHEDRON,w=0;w!==c;w++){var it=u[w],at=it.force,st=it.torque;if(it.type&et&&it.sleepState!==d.SLEEPING){var ct=it.velocity,ut=it.angularVelocity,lt=it.position,pt=it.quaternion,ft=it.invMass,ht=it.invInertiaWorld;ct.x+=at.x*ft*t,ct.y+=at.y*ft*t,ct.z+=at.z*ft*t,it.angularVelocity&&(ht.vmult(st,B),B.mult(t,B),B.vadd(ut,ut)),lt.x+=ct.x*t,lt.y+=ct.y*t,lt.z+=ct.z*t,it.angularVelocity&&(J.set(ut.x,ut.y,ut.z,0),J.mult(pt,$),pt.x+=ot*$.x,pt.y+=ot*$.y,pt.z+=ot*$.z,pt.w+=ot*$.w,nt&&(rt?pt.normalizeFast():pt.normalize())),it.aabb&&(it.aabbNeedsUpdate=!0),it.updateInertiaWorld&&it.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,f&&(h.integrate=performance.now()-n),this.time+=t,this.stepnumber+=1,this.dispatchEvent(P),w=0;w!==c;w++){var dt=(U=u[w]).postStep;dt&&dt.call(U)}if(this.allowSleep)for(w=0;w!==c;w++)u[w].sleepTick(this.time)},World.prototype.clearForces=function(){for(var t=this.bodies,n=t.length,r=0;r!==n;r++){var o=t[r];o.force,o.torque,o.force.set(0,0,0),o.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)},function(t,n,r){"use strict";var o;r.d(n,"a",(function(){return i})),function(t){t.defaultAssets={}}(o||(o={}));var i=function(){function IFileInternal(){}return Object.defineProperty(IFileInternal,"instance",{get:function(){return o.instance},set:function(t){o.instance=t},enumerable:!1,configurable:!0}),Object.defineProperty(IFileInternal,"defaultAssets",{set:function(t){o.defaultAssets=t},enumerable:!1,configurable:!0}),IFileInternal.getDefaultAsset=function(t){return o.defaultAssets[t]},IFileInternal}()},function(t,n,r){"use strict";function GenericWorker(t){this.name=t||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}GenericWorker.prototype={push:function(t){this.emit("data",t)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(t){this.emit("error",t)}return!0},error:function(t){return!this.isFinished&&(this.isPaused?this.generatedError=t:(this.isFinished=!0,this.emit("error",t),this.previous&&this.previous.error(t),this.cleanUp()),!0)},on:function(t,n){return this._listeners[t].push(n),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(t,n){if(this._listeners[t])for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].call(this,n)},pipe:function(t){return t.registerPrevious(this)},registerPrevious:function(t){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=t.streamInfo,this.mergeStreamInfo(),this.previous=t;var n=this;return t.on("data",(function(t){n.processChunk(t)})),t.on("end",(function(){n.end()})),t.on("error",(function(t){n.error(t)})),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;this.isPaused=!1;var t=!1;return this.generatedError&&(this.error(this.generatedError),t=!0),this.previous&&this.previous.resume(),!t},flush:function(){},processChunk:function(t){this.push(t)},withStreamInfo:function(t,n){return this.extraStreamInfo[t]=n,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var t in this.extraStreamInfo)this.extraStreamInfo.hasOwnProperty(t)&&(this.streamInfo[t]=this.extraStreamInfo[t])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var t="Worker "+this.name;return this.previous?this.previous+" -> "+t:t}},t.exports=GenericWorker},function(t,n){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(t){"object"==typeof window&&(r=window)}t.exports=r},function(t,n,r){"use strict";(function(t){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer=void 0!==t,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var o=new ArrayBuffer(0);try{n.blob=0===new Blob([o],{type:"application/zip"}).size}catch(t){try{var i=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);i.append(o),n.blob=0===i.getBlob("application/zip").size}catch(t){n.blob=!1}}}try{n.nodestream=!!r(33).Readable}catch(t){n.nodestream=!1}}).call(this,r(8).Buffer)},function(t,n,r){"use strict";var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function _has(t,n){return Object.prototype.hasOwnProperty.call(t,n)}n.assign=function(t){for(var n=Array.prototype.slice.call(arguments,1);n.length;){var r=n.shift();if(r){if("object"!=typeof r)throw new TypeError(r+"must be non-object");for(var o in r)_has(r,o)&&(t[o]=r[o])}}return t},n.shrinkBuf=function(t,n){return t.length===n?t:t.subarray?t.subarray(0,n):(t.length=n,t)};var i={arraySet:function(t,n,r,o,i){if(n.subarray&&t.subarray)t.set(n.subarray(r,r+o),i);else for(var a=0;a<o;a++)t[i+a]=n[r+a]},flattenChunks:function(t){var n,r,o,i,a,c;for(o=0,n=0,r=t.length;n<r;n++)o+=t[n].length;for(c=new Uint8Array(o),i=0,n=0,r=t.length;n<r;n++)a=t[n],c.set(a,i),i+=a.length;return c}},a={arraySet:function(t,n,r,o,i){for(var a=0;a<o;a++)t[i+a]=n[r+a]},flattenChunks:function(t){return[].concat.apply([],t)}};n.setTyped=function(t){t?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,i)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(o)},function(t,n,r){"use strict";(function(t){var o=r(63),i=r(64),a=r(65);function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(t,n){if(kMaxLength()<n)throw new RangeError("Invalid typed array length");return Buffer.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(n)).__proto__=Buffer.prototype:(null===t&&(t=new Buffer(n)),t.length=n),t}function Buffer(t,n,r){if(!(Buffer.TYPED_ARRAY_SUPPORT||this instanceof Buffer))return new Buffer(t,n,r);if("number"==typeof t){if("string"==typeof n)throw new Error("If encoding is specified then the first argument must be a string");return allocUnsafe(this,t)}return from(this,t,n,r)}function from(t,n,r,o){if("number"==typeof n)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&n instanceof ArrayBuffer?function fromArrayBuffer(t,n,r,o){if(n.byteLength,r<0||n.byteLength<r)throw new RangeError("'offset' is out of bounds");if(n.byteLength<r+(o||0))throw new RangeError("'length' is out of bounds");n=void 0===r&&void 0===o?new Uint8Array(n):void 0===o?new Uint8Array(n,r):new Uint8Array(n,r,o);Buffer.TYPED_ARRAY_SUPPORT?(t=n).__proto__=Buffer.prototype:t=fromArrayLike(t,n);return t}(t,n,r,o):"string"==typeof n?function fromString(t,n,r){"string"==typeof r&&""!==r||(r="utf8");if(!Buffer.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var o=0|byteLength(n,r),i=(t=createBuffer(t,o)).write(n,r);i!==o&&(t=t.slice(0,i));return t}(t,n,r):function fromObject(t,n){if(Buffer.isBuffer(n)){var r=0|checked(n.length);return 0===(t=createBuffer(t,r)).length||n.copy(t,0,0,r),t}if(n){if("undefined"!=typeof ArrayBuffer&&n.buffer instanceof ArrayBuffer||"length"in n)return"number"!=typeof n.length||function isnan(t){return t!=t}(n.length)?createBuffer(t,0):fromArrayLike(t,n);if("Buffer"===n.type&&a(n.data))return fromArrayLike(t,n.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,n)}function assertSize(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function allocUnsafe(t,n){if(assertSize(n),t=createBuffer(t,n<0?0:0|checked(n)),!Buffer.TYPED_ARRAY_SUPPORT)for(var r=0;r<n;++r)t[r]=0;return t}function fromArrayLike(t,n){var r=n.length<0?0:0|checked(n.length);t=createBuffer(t,r);for(var o=0;o<r;o+=1)t[o]=255&n[o];return t}function checked(t){if(t>=kMaxLength())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+kMaxLength().toString(16)+" bytes");return 0|t}function byteLength(t,n){if(Buffer.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var o=!1;;)switch(n){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return utf8ToBytes(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return base64ToBytes(t).length;default:if(o)return utf8ToBytes(t).length;n=(""+n).toLowerCase(),o=!0}}function slowToString(t,n,r){var o=!1;if((void 0===n||n<0)&&(n=0),n>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(n>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return hexSlice(this,n,r);case"utf8":case"utf-8":return utf8Slice(this,n,r);case"ascii":return asciiSlice(this,n,r);case"latin1":case"binary":return latin1Slice(this,n,r);case"base64":return base64Slice(this,n,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,n,r);default:if(o)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),o=!0}}function swap(t,n,r){var o=t[n];t[n]=t[r],t[r]=o}function bidirectionalIndexOf(t,n,r,o,i){if(0===t.length)return-1;if("string"==typeof r?(o=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof n&&(n=Buffer.from(n,o)),Buffer.isBuffer(n))return 0===n.length?-1:arrayIndexOf(t,n,r,o,i);if("number"==typeof n)return n&=255,Buffer.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,n,r):Uint8Array.prototype.lastIndexOf.call(t,n,r):arrayIndexOf(t,[n],r,o,i);throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(t,n,r,o,i){var a,c=1,u=t.length,l=n.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(t.length<2||n.length<2)return-1;c=2,u/=2,l/=2,r/=2}function read(t,n){return 1===c?t[n]:t.readUInt16BE(n*c)}if(i){var p=-1;for(a=r;a<u;a++)if(read(t,a)===read(n,-1===p?0:a-p)){if(-1===p&&(p=a),a-p+1===l)return p*c}else-1!==p&&(a-=a-p),p=-1}else for(r+l>u&&(r=u-l),a=r;a>=0;a--){for(var f=!0,h=0;h<l;h++)if(read(t,a+h)!==read(n,h)){f=!1;break}if(f)return a}return-1}function hexWrite(t,n,r,o){r=Number(r)||0;var i=t.length-r;o?(o=Number(o))>i&&(o=i):o=i;var a=n.length;if(a%2!=0)throw new TypeError("Invalid hex string");o>a/2&&(o=a/2);for(var c=0;c<o;++c){var u=parseInt(n.substr(2*c,2),16);if(isNaN(u))return c;t[r+c]=u}return c}function utf8Write(t,n,r,o){return blitBuffer(utf8ToBytes(n,t.length-r),t,r,o)}function asciiWrite(t,n,r,o){return blitBuffer(function asciiToBytes(t){for(var n=[],r=0;r<t.length;++r)n.push(255&t.charCodeAt(r));return n}(n),t,r,o)}function latin1Write(t,n,r,o){return asciiWrite(t,n,r,o)}function base64Write(t,n,r,o){return blitBuffer(base64ToBytes(n),t,r,o)}function ucs2Write(t,n,r,o){return blitBuffer(function utf16leToBytes(t,n){for(var r,o,i,a=[],c=0;c<t.length&&!((n-=2)<0);++c)r=t.charCodeAt(c),o=r>>8,i=r%256,a.push(i),a.push(o);return a}(n,t.length-r),t,r,o)}function base64Slice(t,n,r){return 0===n&&r===t.length?o.fromByteArray(t):o.fromByteArray(t.slice(n,r))}function utf8Slice(t,n,r){r=Math.min(t.length,r);for(var o=[],i=n;i<r;){var a,c,u,l,p=t[i],f=null,h=p>239?4:p>223?3:p>191?2:1;if(i+h<=r)switch(h){case 1:p<128&&(f=p);break;case 2:128==(192&(a=t[i+1]))&&(l=(31&p)<<6|63&a)>127&&(f=l);break;case 3:a=t[i+1],c=t[i+2],128==(192&a)&&128==(192&c)&&(l=(15&p)<<12|(63&a)<<6|63&c)>2047&&(l<55296||l>57343)&&(f=l);break;case 4:a=t[i+1],c=t[i+2],u=t[i+3],128==(192&a)&&128==(192&c)&&128==(192&u)&&(l=(15&p)<<18|(63&a)<<12|(63&c)<<6|63&u)>65535&&l<1114112&&(f=l)}null===f?(f=65533,h=1):f>65535&&(f-=65536,o.push(f>>>10&1023|55296),f=56320|1023&f),o.push(f),i+=h}return function decodeCodePointsArray(t){var n=t.length;if(n<=4096)return String.fromCharCode.apply(String,t);var r="",o=0;for(;o<n;)r+=String.fromCharCode.apply(String,t.slice(o,o+=4096));return r}(o)}n.Buffer=Buffer,n.SlowBuffer=function SlowBuffer(t){+t!=t&&(t=0);return Buffer.alloc(+t)},n.INSPECT_MAX_BYTES=50,Buffer.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function typedArraySupport(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),n.kMaxLength=kMaxLength(),Buffer.poolSize=8192,Buffer._augment=function(t){return t.__proto__=Buffer.prototype,t},Buffer.from=function(t,n,r){return from(null,t,n,r)},Buffer.TYPED_ARRAY_SUPPORT&&(Buffer.prototype.__proto__=Uint8Array.prototype,Buffer.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})),Buffer.alloc=function(t,n,r){return function alloc(t,n,r,o){return assertSize(n),n<=0?createBuffer(t,n):void 0!==r?"string"==typeof o?createBuffer(t,n).fill(r,o):createBuffer(t,n).fill(r):createBuffer(t,n)}(null,t,n,r)},Buffer.allocUnsafe=function(t){return allocUnsafe(null,t)},Buffer.allocUnsafeSlow=function(t){return allocUnsafe(null,t)},Buffer.isBuffer=function isBuffer(t){return!(null==t||!t._isBuffer)},Buffer.compare=function compare(t,n){if(!Buffer.isBuffer(t)||!Buffer.isBuffer(n))throw new TypeError("Arguments must be Buffers");if(t===n)return 0;for(var r=t.length,o=n.length,i=0,a=Math.min(r,o);i<a;++i)if(t[i]!==n[i]){r=t[i],o=n[i];break}return r<o?-1:o<r?1:0},Buffer.isEncoding=function isEncoding(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function concat(t,n){if(!a(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return Buffer.alloc(0);var r;if(void 0===n)for(n=0,r=0;r<t.length;++r)n+=t[r].length;var o=Buffer.allocUnsafe(n),i=0;for(r=0;r<t.length;++r){var c=t[r];if(!Buffer.isBuffer(c))throw new TypeError('"list" argument must be an Array of Buffers');c.copy(o,i),i+=c.length}return o},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function swap16(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var n=0;n<t;n+=2)swap(this,n,n+1);return this},Buffer.prototype.swap32=function swap32(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var n=0;n<t;n+=4)swap(this,n,n+3),swap(this,n+1,n+2);return this},Buffer.prototype.swap64=function swap64(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var n=0;n<t;n+=8)swap(this,n,n+7),swap(this,n+1,n+6),swap(this,n+2,n+5),swap(this,n+3,n+4);return this},Buffer.prototype.toString=function toString(){var t=0|this.length;return 0===t?"":0===arguments.length?utf8Slice(this,0,t):slowToString.apply(this,arguments)},Buffer.prototype.equals=function equals(t){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===Buffer.compare(this,t)},Buffer.prototype.inspect=function inspect(){var t="",r=n.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},Buffer.prototype.compare=function compare(t,n,r,o,i){if(!Buffer.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===n&&(n=0),void 0===r&&(r=t?t.length:0),void 0===o&&(o=0),void 0===i&&(i=this.length),n<0||r>t.length||o<0||i>this.length)throw new RangeError("out of range index");if(o>=i&&n>=r)return 0;if(o>=i)return-1;if(n>=r)return 1;if(this===t)return 0;for(var a=(i>>>=0)-(o>>>=0),c=(r>>>=0)-(n>>>=0),u=Math.min(a,c),l=this.slice(o,i),p=t.slice(n,r),f=0;f<u;++f)if(l[f]!==p[f]){a=l[f],c=p[f];break}return a<c?-1:c<a?1:0},Buffer.prototype.includes=function includes(t,n,r){return-1!==this.indexOf(t,n,r)},Buffer.prototype.indexOf=function indexOf(t,n,r){return bidirectionalIndexOf(this,t,n,r,!0)},Buffer.prototype.lastIndexOf=function lastIndexOf(t,n,r){return bidirectionalIndexOf(this,t,n,r,!1)},Buffer.prototype.write=function write(t,n,r,o){if(void 0===n)o="utf8",r=this.length,n=0;else if(void 0===r&&"string"==typeof n)o=n,r=this.length,n=0;else{if(!isFinite(n))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");n|=0,isFinite(r)?(r|=0,void 0===o&&(o="utf8")):(o=r,r=void 0)}var i=this.length-n;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||n<0)||n>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var a=!1;;)switch(o){case"hex":return hexWrite(this,t,n,r);case"utf8":case"utf-8":return utf8Write(this,t,n,r);case"ascii":return asciiWrite(this,t,n,r);case"latin1":case"binary":return latin1Write(this,t,n,r);case"base64":return base64Write(this,t,n,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,t,n,r);default:if(a)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),a=!0}},Buffer.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function asciiSlice(t,n,r){var o="";r=Math.min(t.length,r);for(var i=n;i<r;++i)o+=String.fromCharCode(127&t[i]);return o}function latin1Slice(t,n,r){var o="";r=Math.min(t.length,r);for(var i=n;i<r;++i)o+=String.fromCharCode(t[i]);return o}function hexSlice(t,n,r){var o=t.length;(!n||n<0)&&(n=0),(!r||r<0||r>o)&&(r=o);for(var i="",a=n;a<r;++a)i+=toHex(t[a]);return i}function utf16leSlice(t,n,r){for(var o=t.slice(n,r),i="",a=0;a<o.length;a+=2)i+=String.fromCharCode(o[a]+256*o[a+1]);return i}function checkOffset(t,n,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+n>r)throw new RangeError("Trying to access beyond buffer length")}function checkInt(t,n,r,o,i,a){if(!Buffer.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(n>i||n<a)throw new RangeError('"value" argument is out of bounds');if(r+o>t.length)throw new RangeError("Index out of range")}function objectWriteUInt16(t,n,r,o){n<0&&(n=65535+n+1);for(var i=0,a=Math.min(t.length-r,2);i<a;++i)t[r+i]=(n&255<<8*(o?i:1-i))>>>8*(o?i:1-i)}function objectWriteUInt32(t,n,r,o){n<0&&(n=4294967295+n+1);for(var i=0,a=Math.min(t.length-r,4);i<a;++i)t[r+i]=n>>>8*(o?i:3-i)&255}function checkIEEE754(t,n,r,o,i,a){if(r+o>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function writeFloat(t,n,r,o,a){return a||checkIEEE754(t,0,r,4),i.write(t,n,r,o,23,4),r+4}function writeDouble(t,n,r,o,a){return a||checkIEEE754(t,0,r,8),i.write(t,n,r,o,52,8),r+8}Buffer.prototype.slice=function slice(t,n){var r,o=this.length;if((t=~~t)<0?(t+=o)<0&&(t=0):t>o&&(t=o),(n=void 0===n?o:~~n)<0?(n+=o)<0&&(n=0):n>o&&(n=o),n<t&&(n=t),Buffer.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,n)).__proto__=Buffer.prototype;else{var i=n-t;r=new Buffer(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+t]}return r},Buffer.prototype.readUIntLE=function readUIntLE(t,n,r){t|=0,n|=0,r||checkOffset(t,n,this.length);for(var o=this[t],i=1,a=0;++a<n&&(i*=256);)o+=this[t+a]*i;return o},Buffer.prototype.readUIntBE=function readUIntBE(t,n,r){t|=0,n|=0,r||checkOffset(t,n,this.length);for(var o=this[t+--n],i=1;n>0&&(i*=256);)o+=this[t+--n]*i;return o},Buffer.prototype.readUInt8=function readUInt8(t,n){return n||checkOffset(t,1,this.length),this[t]},Buffer.prototype.readUInt16LE=function readUInt16LE(t,n){return n||checkOffset(t,2,this.length),this[t]|this[t+1]<<8},Buffer.prototype.readUInt16BE=function readUInt16BE(t,n){return n||checkOffset(t,2,this.length),this[t]<<8|this[t+1]},Buffer.prototype.readUInt32LE=function readUInt32LE(t,n){return n||checkOffset(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},Buffer.prototype.readUInt32BE=function readUInt32BE(t,n){return n||checkOffset(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},Buffer.prototype.readIntLE=function readIntLE(t,n,r){t|=0,n|=0,r||checkOffset(t,n,this.length);for(var o=this[t],i=1,a=0;++a<n&&(i*=256);)o+=this[t+a]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*n)),o},Buffer.prototype.readIntBE=function readIntBE(t,n,r){t|=0,n|=0,r||checkOffset(t,n,this.length);for(var o=n,i=1,a=this[t+--o];o>0&&(i*=256);)a+=this[t+--o]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*n)),a},Buffer.prototype.readInt8=function readInt8(t,n){return n||checkOffset(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},Buffer.prototype.readInt16LE=function readInt16LE(t,n){n||checkOffset(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt16BE=function readInt16BE(t,n){n||checkOffset(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},Buffer.prototype.readInt32LE=function readInt32LE(t,n){return n||checkOffset(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},Buffer.prototype.readInt32BE=function readInt32BE(t,n){return n||checkOffset(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},Buffer.prototype.readFloatLE=function readFloatLE(t,n){return n||checkOffset(t,4,this.length),i.read(this,t,!0,23,4)},Buffer.prototype.readFloatBE=function readFloatBE(t,n){return n||checkOffset(t,4,this.length),i.read(this,t,!1,23,4)},Buffer.prototype.readDoubleLE=function readDoubleLE(t,n){return n||checkOffset(t,8,this.length),i.read(this,t,!0,52,8)},Buffer.prototype.readDoubleBE=function readDoubleBE(t,n){return n||checkOffset(t,8,this.length),i.read(this,t,!1,52,8)},Buffer.prototype.writeUIntLE=function writeUIntLE(t,n,r,o){(t=+t,n|=0,r|=0,o)||checkInt(this,t,n,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[n]=255&t;++a<r&&(i*=256);)this[n+a]=t/i&255;return n+r},Buffer.prototype.writeUIntBE=function writeUIntBE(t,n,r,o){(t=+t,n|=0,r|=0,o)||checkInt(this,t,n,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[n+i]=255&t;--i>=0&&(a*=256);)this[n+i]=t/a&255;return n+r},Buffer.prototype.writeUInt8=function writeUInt8(t,n,r){return t=+t,n|=0,r||checkInt(this,t,n,1,255,0),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[n]=255&t,n+1},Buffer.prototype.writeUInt16LE=function writeUInt16LE(t,n,r){return t=+t,n|=0,r||checkInt(this,t,n,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8):objectWriteUInt16(this,t,n,!0),n+2},Buffer.prototype.writeUInt16BE=function writeUInt16BE(t,n,r){return t=+t,n|=0,r||checkInt(this,t,n,2,65535,0),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=t>>>8,this[n+1]=255&t):objectWriteUInt16(this,t,n,!1),n+2},Buffer.prototype.writeUInt32LE=function writeUInt32LE(t,n,r){return t=+t,n|=0,r||checkInt(this,t,n,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[n+3]=t>>>24,this[n+2]=t>>>16,this[n+1]=t>>>8,this[n]=255&t):objectWriteUInt32(this,t,n,!0),n+4},Buffer.prototype.writeUInt32BE=function writeUInt32BE(t,n,r){return t=+t,n|=0,r||checkInt(this,t,n,4,4294967295,0),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=255&t):objectWriteUInt32(this,t,n,!1),n+4},Buffer.prototype.writeIntLE=function writeIntLE(t,n,r,o){if(t=+t,n|=0,!o){var i=Math.pow(2,8*r-1);checkInt(this,t,n,r,i-1,-i)}var a=0,c=1,u=0;for(this[n]=255&t;++a<r&&(c*=256);)t<0&&0===u&&0!==this[n+a-1]&&(u=1),this[n+a]=(t/c>>0)-u&255;return n+r},Buffer.prototype.writeIntBE=function writeIntBE(t,n,r,o){if(t=+t,n|=0,!o){var i=Math.pow(2,8*r-1);checkInt(this,t,n,r,i-1,-i)}var a=r-1,c=1,u=0;for(this[n+a]=255&t;--a>=0&&(c*=256);)t<0&&0===u&&0!==this[n+a+1]&&(u=1),this[n+a]=(t/c>>0)-u&255;return n+r},Buffer.prototype.writeInt8=function writeInt8(t,n,r){return t=+t,n|=0,r||checkInt(this,t,n,1,127,-128),Buffer.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[n]=255&t,n+1},Buffer.prototype.writeInt16LE=function writeInt16LE(t,n,r){return t=+t,n|=0,r||checkInt(this,t,n,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8):objectWriteUInt16(this,t,n,!0),n+2},Buffer.prototype.writeInt16BE=function writeInt16BE(t,n,r){return t=+t,n|=0,r||checkInt(this,t,n,2,32767,-32768),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=t>>>8,this[n+1]=255&t):objectWriteUInt16(this,t,n,!1),n+2},Buffer.prototype.writeInt32LE=function writeInt32LE(t,n,r){return t=+t,n|=0,r||checkInt(this,t,n,4,2147483647,-2147483648),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=255&t,this[n+1]=t>>>8,this[n+2]=t>>>16,this[n+3]=t>>>24):objectWriteUInt32(this,t,n,!0),n+4},Buffer.prototype.writeInt32BE=function writeInt32BE(t,n,r){return t=+t,n|=0,r||checkInt(this,t,n,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),Buffer.TYPED_ARRAY_SUPPORT?(this[n]=t>>>24,this[n+1]=t>>>16,this[n+2]=t>>>8,this[n+3]=255&t):objectWriteUInt32(this,t,n,!1),n+4},Buffer.prototype.writeFloatLE=function writeFloatLE(t,n,r){return writeFloat(this,t,n,!0,r)},Buffer.prototype.writeFloatBE=function writeFloatBE(t,n,r){return writeFloat(this,t,n,!1,r)},Buffer.prototype.writeDoubleLE=function writeDoubleLE(t,n,r){return writeDouble(this,t,n,!0,r)},Buffer.prototype.writeDoubleBE=function writeDoubleBE(t,n,r){return writeDouble(this,t,n,!1,r)},Buffer.prototype.copy=function copy(t,n,r,o){if(r||(r=0),o||0===o||(o=this.length),n>=t.length&&(n=t.length),n||(n=0),o>0&&o<r&&(o=r),o===r)return 0;if(0===t.length||0===this.length)return 0;if(n<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),t.length-n<o-r&&(o=t.length-n+r);var i,a=o-r;if(this===t&&r<n&&n<o)for(i=a-1;i>=0;--i)t[i+n]=this[i+r];else if(a<1e3||!Buffer.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)t[i+n]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+a),n);return a},Buffer.prototype.fill=function fill(t,n,r,o){if("string"==typeof t){if("string"==typeof n?(o=n,n=0,r=this.length):"string"==typeof r&&(o=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!Buffer.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof t&&(t&=255);if(n<0||this.length<n||this.length<r)throw new RangeError("Out of range index");if(r<=n)return this;var a;if(n>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(a=n;a<r;++a)this[a]=t;else{var c=Buffer.isBuffer(t)?t:utf8ToBytes(new Buffer(t,o).toString()),u=c.length;for(a=0;a<r-n;++a)this[a+n]=c[a%u]}return this};var c=/[^+\/0-9A-Za-z-_]/g;function toHex(t){return t<16?"0"+t.toString(16):t.toString(16)}function utf8ToBytes(t,n){var r;n=n||1/0;for(var o=t.length,i=null,a=[],c=0;c<o;++c){if((r=t.charCodeAt(c))>55295&&r<57344){if(!i){if(r>56319){(n-=3)>-1&&a.push(239,191,189);continue}if(c+1===o){(n-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(n-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(n-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((n-=1)<0)break;a.push(r)}else if(r<2048){if((n-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((n-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((n-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function base64ToBytes(t){return o.toByteArray(function base64clean(t){if((t=function stringtrim(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(c,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function blitBuffer(t,n,r,o){for(var i=0;i<o&&!(i+r>=n.length||i>=t.length);++i)n[i+r]=t[i];return i}}).call(this,r(5))},function(t,n,r){"use strict";var o=r(17),i=Object.keys||function(t){var n=[];for(var r in t)n.push(r);return n};t.exports=Duplex;var a=Object.create(r(13));a.inherits=r(11);var c=r(34),u=r(25);a.inherits(Duplex,c);for(var l=i(u.prototype),p=0;p<l.length;p++){var f=l[p];Duplex.prototype[f]||(Duplex.prototype[f]=u.prototype[f])}function Duplex(t){if(!(this instanceof Duplex))return new Duplex(t);c.call(this,t),u.call(this,t),t&&!1===t.readable&&(this.readable=!1),t&&!1===t.writable&&(this.writable=!1),this.allowHalfOpen=!0,t&&!1===t.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",onend)}function onend(){this.allowHalfOpen||this._writableState.ended||o.nextTick(onEndNT,this)}function onEndNT(t){t.end()}Object.defineProperty(Duplex.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(Duplex.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(t){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=t,this._writableState.destroyed=t)}}),Duplex.prototype._destroy=function(t,n){this.push(null),this.end(),o.nextTick(n,t)}},function(t,n,r){"use strict";for(var o=r(1),i=r(6),a=r(18),c=r(4),u=new Array(256),l=0;l<256;l++)u[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;u[254]=u[254]=1;function Utf8DecodeWorker(){c.call(this,"utf-8 decode"),this.leftOver=null}function Utf8EncodeWorker(){c.call(this,"utf-8 encode")}n.utf8encode=function utf8encode(t){return i.nodebuffer?a.newBufferFrom(t,"utf-8"):function(t){var n,r,o,a,c,u=t.length,l=0;for(a=0;a<u;a++)55296==(64512&(r=t.charCodeAt(a)))&&a+1<u&&56320==(64512&(o=t.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(o-56320),a++),l+=r<128?1:r<2048?2:r<65536?3:4;for(n=i.uint8array?new Uint8Array(l):new Array(l),c=0,a=0;c<l;a++)55296==(64512&(r=t.charCodeAt(a)))&&a+1<u&&56320==(64512&(o=t.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(o-56320),a++),r<128?n[c++]=r:r<2048?(n[c++]=192|r>>>6,n[c++]=128|63&r):r<65536?(n[c++]=224|r>>>12,n[c++]=128|r>>>6&63,n[c++]=128|63&r):(n[c++]=240|r>>>18,n[c++]=128|r>>>12&63,n[c++]=128|r>>>6&63,n[c++]=128|63&r);return n}(t)},n.utf8decode=function utf8decode(t){return i.nodebuffer?o.transformTo("nodebuffer",t).toString("utf-8"):function(t){var n,r,i,a,c=t.length,l=new Array(2*c);for(r=0,n=0;n<c;)if((i=t[n++])<128)l[r++]=i;else if((a=u[i])>4)l[r++]=65533,n+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&n<c;)i=i<<6|63&t[n++],a--;a>1?l[r++]=65533:i<65536?l[r++]=i:(i-=65536,l[r++]=55296|i>>10&1023,l[r++]=56320|1023&i)}return l.length!==r&&(l.subarray?l=l.subarray(0,r):l.length=r),o.applyFromCharCode(l)}(t=o.transformTo(i.uint8array?"uint8array":"array",t))},o.inherits(Utf8DecodeWorker,c),Utf8DecodeWorker.prototype.processChunk=function(t){var r=o.transformTo(i.uint8array?"uint8array":"array",t.data);if(this.leftOver&&this.leftOver.length){if(i.uint8array){var a=r;(r=new Uint8Array(a.length+this.leftOver.length)).set(this.leftOver,0),r.set(a,this.leftOver.length)}else r=this.leftOver.concat(r);this.leftOver=null}var c=function(t,n){var r;for((n=n||t.length)>t.length&&(n=t.length),r=n-1;r>=0&&128==(192&t[r]);)r--;return r<0||0===r?n:r+u[t[r]]>n?r:n}(r),l=r;c!==r.length&&(i.uint8array?(l=r.subarray(0,c),this.leftOver=r.subarray(c,r.length)):(l=r.slice(0,c),this.leftOver=r.slice(c,r.length))),this.push({data:n.utf8decode(l),meta:t.meta})},Utf8DecodeWorker.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=Utf8DecodeWorker,o.inherits(Utf8EncodeWorker,c),Utf8EncodeWorker.prototype.processChunk=function(t){this.push({data:n.utf8encode(t.data),meta:t.meta})},n.Utf8EncodeWorker=Utf8EncodeWorker},function(t,n){"function"==typeof Object.create?t.exports=function inherits(t,n){t.super_=n,t.prototype=Object.create(n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function inherits(t,n){t.super_=n;var TempCtor=function(){};TempCtor.prototype=n.prototype,t.prototype=new TempCtor,t.prototype.constructor=t}},function(t,n){var r,o,i=t.exports={};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(t){if(r===setTimeout)return setTimeout(t,0);if((r===defaultSetTimout||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(n){try{return r.call(null,t,0)}catch(n){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(t){r=defaultSetTimout}try{o="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(t){o=defaultClearTimeout}}();var a,c=[],u=!1,l=-1;function cleanUpNextTick(){u&&a&&(u=!1,a.length?c=a.concat(c):l=-1,c.length&&drainQueue())}function drainQueue(){if(!u){var t=runTimeout(cleanUpNextTick);u=!0;for(var n=c.length;n;){for(a=c,c=[];++l<n;)a&&a[l].run();l=-1,n=c.length}a=null,u=!1,function runClearTimeout(t){if(o===clearTimeout)return clearTimeout(t);if((o===defaultClearTimeout||!o)&&clearTimeout)return o=clearTimeout,clearTimeout(t);try{return o(t)}catch(n){try{return o.call(null,t)}catch(n){return o.call(this,t)}}}(t)}}function Item(t,n){this.fun=t,this.array=n}function noop(){}i.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];c.push(new Item(t,n)),1!==c.length||u||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=noop,i.addListener=noop,i.once=noop,i.off=noop,i.removeListener=noop,i.removeAllListeners=noop,i.emit=noop,i.prependListener=noop,i.prependOnceListener=noop,i.listeners=function(t){return[]},i.binding=function(t){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(t){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(t,n,r){(function(t){function objectToString(t){return Object.prototype.toString.call(t)}n.isArray=function isArray(t){return Array.isArray?Array.isArray(t):"[object Array]"===objectToString(t)},n.isBoolean=function isBoolean(t){return"boolean"==typeof t},n.isNull=function isNull(t){return null===t},n.isNullOrUndefined=function isNullOrUndefined(t){return null==t},n.isNumber=function isNumber(t){return"number"==typeof t},n.isString=function isString(t){return"string"==typeof t},n.isSymbol=function isSymbol(t){return"symbol"==typeof t},n.isUndefined=function isUndefined(t){return void 0===t},n.isRegExp=function isRegExp(t){return"[object RegExp]"===objectToString(t)},n.isObject=function isObject(t){return"object"==typeof t&&null!==t},n.isDate=function isDate(t){return"[object Date]"===objectToString(t)},n.isError=function isError(t){return"[object Error]"===objectToString(t)||t instanceof Error},n.isFunction=function isFunction(t){return"function"==typeof t},n.isPrimitive=function isPrimitive(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||void 0===t},n.isBuffer=t.isBuffer}).call(this,r(8).Buffer)},function(t,n,r){"use strict";var o=null;o="undefined"!=typeof Promise?Promise:r(81),t.exports={Promise:o}},function(t,n,r){"use strict";(function(t){r.d(n,"a",(function(){return o}));var o=function(){function NativeU8Array(n){if(n){var r=t.from(n,"base64");this.array=new Uint8Array(r)}}return Object.defineProperty(NativeU8Array.prototype,"length",{set:function(t){this.array&&t===this.array.length||(this.array=new Uint8Array(t))},enumerable:!1,configurable:!0}),NativeU8Array.prototype.serialize=function(){if(this.array)return t.from(this.array.buffer).toString("base64")},NativeU8Array}()}).call(this,r(8).Buffer)},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function BaseEvent(){}return BaseEvent.prototype.attach=function(t,n){this._attach(t,n,!1)},BaseEvent.prototype.once=function(t,n){this._attach(t,n,!0)},BaseEvent.prototype._attach=function(t,n,r){var o,i,a;if("function"==typeof t)i=t;else if(n||"function"!=typeof t.post){if("object"!=typeof t)throw new Error("Expect a function or object as first argument");if("function"!=typeof n)throw new Error("Expect a function as second argument");o=t,i=n}else a=t;this._listeners?this._listeners=this._listeners.slice():this._listeners=[],this._listeners.push({deleted:!1,boundTo:o,handler:i,event:a,once:r})},BaseEvent.prototype.detach=function(){for(var t,n,r,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];this._listeners&&0!==this._listeners.length&&(o.length>=1&&("function"==typeof o[0]?n=o[0]:1===o.length&&"function"==typeof o[0].post?r=o[0]:t=o[0]),o.length>=2&&(n=o[1]),this._listeners=this._listeners.filter((function(o){return void 0!==n&&o.handler!==n||void 0!==r&&o.event!==r||void 0!==t&&o.boundTo!==t||(o.deleted=!0,!1)})),0===this._listeners.length&&delete this._listeners)},BaseEvent.prototype.post=function(t){throw new Error("abstract")},BaseEvent.prototype.listenerCount=function(){return this._listeners?this._listeners.length:0},BaseEvent.prototype._call=function(t,n){t.deleted||(t.once&&(t.deleted=!0,this._listeners=this._listeners.filter((function(n){return n!==t})),0===this._listeners.length&&delete this._listeners),t.event?t.event.post.apply(t.event,n):t.handler.apply("object"==typeof t.boundTo?t.boundTo:this,n))},BaseEvent}();n.BaseEvent=o},function(t,n,r){"use strict";(function(n){!n.version||0===n.version.indexOf("v0.")||0===n.version.indexOf("v1.")&&0!==n.version.indexOf("v1.8.")?t.exports={nextTick:function nextTick(t,r,o,i){if("function"!=typeof t)throw new TypeError('"callback" argument must be a function');var a,c,u=arguments.length;switch(u){case 0:case 1:return n.nextTick(t);case 2:return n.nextTick((function afterTickOne(){t.call(null,r)}));case 3:return n.nextTick((function afterTickTwo(){t.call(null,r,o)}));case 4:return n.nextTick((function afterTickThree(){t.call(null,r,o,i)}));default:for(a=new Array(u-1),c=0;c<a.length;)a[c++]=arguments[c];return n.nextTick((function afterTick(){t.apply(null,a)}))}}}:t.exports=n}).call(this,r(12))},function(t,n,r){"use strict";(function(n){t.exports={isNode:void 0!==n,newBufferFrom:function(t,r){if(n.from&&n.from!==Uint8Array.from)return n.from(t,r);if("number"==typeof t)throw new Error('The "data" argument must not be a number');return new n(t,r)},allocBuffer:function(t){if(n.alloc)return n.alloc(t);var r=new n(t);return r.fill(0),r},isBuffer:function(t){return n.isBuffer(t)},isStream:function(t){return t&&"function"==typeof t.on&&"function"==typeof t.pause&&"function"==typeof t.resume}}}).call(this,r(8).Buffer)},function(t,n,r){"use strict";var o,i=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0});var a=function(t){function SyncEvent(){var n=null!==t&&t.apply(this,arguments)||this;return n._recursion=0,n}return i(SyncEvent,t),SyncEvent.prototype.post=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];if(this._listeners&&0!==this._listeners.length){if(this._recursion++,SyncEvent.MAX_RECURSION_DEPTH>0&&this._recursion>SyncEvent.MAX_RECURSION_DEPTH)throw new Error("event fired recursively");for(var r=this._listeners,o=0;o<r.length;++o){var i=r[o];this._call(i,t)}this._recursion--}},SyncEvent.MAX_RECURSION_DEPTH=10,SyncEvent}(r(16).BaseEvent);n.SyncEvent=a;var c=function(t){function VoidSyncEvent(){return null!==t&&t.apply(this,arguments)||this}return i(VoidSyncEvent,t),VoidSyncEvent.prototype.post=function(){t.prototype.post.call(this,void 0)},VoidSyncEvent}(a);n.VoidSyncEvent=c;var u=function(t){function ErrorSyncEvent(){return null!==t&&t.apply(this,arguments)||this}return i(ErrorSyncEvent,t),ErrorSyncEvent.prototype.post=function(n){if(0===this.listenerCount())throw new Error("error event posted while no listeners attached. Error: "+n.message);t.prototype.post.call(this,n)},ErrorSyncEvent}(a);n.ErrorSyncEvent=u},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=r(19),i=function(){function EventQueue(){this.evtFilled=new o.SyncEvent,this.evtDrained=new o.SyncEvent,this._queue=[],this._flushing=!1}return EventQueue.global=function(){return EventQueue._instance||EventQueue.resetGlobal(),EventQueue._instance},EventQueue.resetGlobal=function(){EventQueue._instance=new EventQueue},EventQueue.prototype.empty=function(){return 0===this._queue.length},EventQueue.prototype.add=function(t){this._queue.push(t),1!==this._queue.length||this._flushing||this.evtFilled.post(this)},EventQueue.prototype.flushOnce=function(){var t=0===this._queue.length,n=this._flushing;this._flushing=!0;try{var r=this._queue;this._queue=[];for(var o=0;o<r.length;++o)r[o]()}finally{this._flushing=n,t||n||0!==this._queue.length||this.evtDrained.post(this)}},EventQueue.prototype.flush=function(t){void 0===t&&(t=10);var n=0===this._queue.length,r=this._flushing;this._flushing=!0;try{for(var o=0;this._queue.length>0;){if("number"==typeof t&&o>=t)throw this._queue=[],new Error("unable to flush the queue due to recursively added event. Clearing queue now");this.flushOnce(),++o}}finally{this._flushing=r,n||r||0!==this._queue.length||this.evtDrained.post(this)}},EventQueue}();n.default=i},function(t,n,r){(function(t){var o=void 0!==t&&t||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function Timeout(t,n){this._id=t,this._clearFn=n}n.setTimeout=function(){return new Timeout(i.call(setTimeout,o,arguments),clearTimeout)},n.setInterval=function(){return new Timeout(i.call(setInterval,o,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(t){t&&t.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(o,this._id)},n.enroll=function(t,n){clearTimeout(t._idleTimeoutId),t._idleTimeout=n},n.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},n._unrefActive=n.active=function(t){clearTimeout(t._idleTimeoutId);var n=t._idleTimeout;n>=0&&(t._idleTimeoutId=setTimeout((function onTimeout(){t._onTimeout&&t._onTimeout()}),n))},r(57),n.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==t&&t.setImmediate||this&&this.setImmediate,n.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==t&&t.clearImmediate||this&&this.clearImmediate}).call(this,r(5))},function(t,n,r){"use strict";var o,i="object"==typeof Reflect?Reflect:null,a=i&&"function"==typeof i.apply?i.apply:function ReflectApply(t,n,r){return Function.prototype.apply.call(t,n,r)};o=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function ReflectOwnKeys(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function ReflectOwnKeys(t){return Object.getOwnPropertyNames(t)};var c=Number.isNaN||function NumberIsNaN(t){return t!=t};function EventEmitter(){EventEmitter.init.call(this)}t.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._eventsCount=0,EventEmitter.prototype._maxListeners=void 0;var u=10;function checkListener(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function _getMaxListeners(t){return void 0===t._maxListeners?EventEmitter.defaultMaxListeners:t._maxListeners}function _addListener(t,n,r,o){var i,a,c;if(checkListener(r),void 0===(a=t._events)?(a=t._events=Object.create(null),t._eventsCount=0):(void 0!==a.newListener&&(t.emit("newListener",n,r.listener?r.listener:r),a=t._events),c=a[n]),void 0===c)c=a[n]=r,++t._eventsCount;else if("function"==typeof c?c=a[n]=o?[r,c]:[c,r]:o?c.unshift(r):c.push(r),(i=_getMaxListeners(t))>0&&c.length>i&&!c.warned){c.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+c.length+" "+String(n)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=n,u.count=c.length,function ProcessEmitWarning(t){console&&console.warn&&console.warn(t)}(u)}return t}function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(t,n,r){var o={fired:!1,wrapFn:void 0,target:t,type:n,listener:r},i=onceWrapper.bind(o);return i.listener=r,o.wrapFn=i,i}function _listeners(t,n,r){var o=t._events;if(void 0===o)return[];var i=o[n];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function unwrapListeners(t){for(var n=new Array(t.length),r=0;r<n.length;++r)n[r]=t[r].listener||t[r];return n}(i):arrayClone(i,i.length)}function listenerCount(t){var n=this._events;if(void 0!==n){var r=n[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function arrayClone(t,n){for(var r=new Array(n),o=0;o<n;++o)r[o]=t[o];return r}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(t){if("number"!=typeof t||t<0||c(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");u=t}}),EventEmitter.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter.prototype.setMaxListeners=function setMaxListeners(t){if("number"!=typeof t||t<0||c(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},EventEmitter.prototype.getMaxListeners=function getMaxListeners(){return _getMaxListeners(this)},EventEmitter.prototype.emit=function emit(t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var o="error"===t,i=this._events;if(void 0!==i)o=o&&void 0===i.error;else if(!o)return!1;if(o){var c;if(n.length>0&&(c=n[0]),c instanceof Error)throw c;var u=new Error("Unhandled error."+(c?" ("+c.message+")":""));throw u.context=c,u}var l=i[t];if(void 0===l)return!1;if("function"==typeof l)a(l,this,n);else{var p=l.length,f=arrayClone(l,p);for(r=0;r<p;++r)a(f[r],this,n)}return!0},EventEmitter.prototype.addListener=function addListener(t,n){return _addListener(this,t,n,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function prependListener(t,n){return _addListener(this,t,n,!0)},EventEmitter.prototype.once=function once(t,n){return checkListener(n),this.on(t,_onceWrap(this,t,n)),this},EventEmitter.prototype.prependOnceListener=function prependOnceListener(t,n){return checkListener(n),this.prependListener(t,_onceWrap(this,t,n)),this},EventEmitter.prototype.removeListener=function removeListener(t,n){var r,o,i,a,c;if(checkListener(n),void 0===(o=this._events))return this;if(void 0===(r=o[t]))return this;if(r===n||r.listener===n)0==--this._eventsCount?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,r.listener||n));else if("function"!=typeof r){for(i=-1,a=r.length-1;a>=0;a--)if(r[a]===n||r[a].listener===n){c=r[a].listener,i=a;break}if(i<0)return this;0===i?r.shift():function spliceOne(t,n){for(;n+1<t.length;n++)t[n]=t[n+1];t.pop()}(r,i),1===r.length&&(o[t]=r[0]),void 0!==o.removeListener&&this.emit("removeListener",t,c||n)}return this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.removeAllListeners=function removeAllListeners(t){var n,r,o;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var i,a=Object.keys(r);for(o=0;o<a.length;++o)"removeListener"!==(i=a[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(n=r[t]))this.removeListener(t,n);else if(void 0!==n)for(o=n.length-1;o>=0;o--)this.removeListener(t,n[o]);return this},EventEmitter.prototype.listeners=function listeners(t){return _listeners(this,t,!0)},EventEmitter.prototype.rawListeners=function rawListeners(t){return _listeners(this,t,!1)},EventEmitter.listenerCount=function(t,n){return"function"==typeof t.listenerCount?t.listenerCount(n):listenerCount.call(t,n)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function eventNames(){return this._eventsCount>0?o(this._events):[]}},function(t,n,r){(n=t.exports=r(34)).Stream=n,n.Readable=n,n.Writable=r(25),n.Duplex=r(9),n.Transform=r(38),n.PassThrough=r(75)},function(t,n,r){var o=r(8),i=o.Buffer;function copyProps(t,n){for(var r in t)n[r]=t[r]}function SafeBuffer(t,n,r){return i(t,n,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=o:(copyProps(o,n),n.Buffer=SafeBuffer),copyProps(i,SafeBuffer),SafeBuffer.from=function(t,n,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,n,r)},SafeBuffer.alloc=function(t,n,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var o=i(t);return void 0!==n?"string"==typeof r?o.fill(n,r):o.fill(n):o.fill(0),o},SafeBuffer.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},SafeBuffer.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return o.SlowBuffer(t)}},function(t,n,r){"use strict";(function(n,o,i){var a=r(17);function CorkedRequest(t){var n=this;this.next=null,this.entry=null,this.finish=function(){!function onCorkedFinish(t,n,r){var o=t.entry;t.entry=null;for(;o;){var i=o.callback;n.pendingcb--,i(r),o=o.next}n.corkedRequestsFree?n.corkedRequestsFree.next=t:n.corkedRequestsFree=t}(n,t)}}t.exports=Writable;var c,u=!n.browser&&["v0.10","v0.9."].indexOf(n.version.slice(0,5))>-1?o:a.nextTick;Writable.WritableState=WritableState;var l=Object.create(r(13));l.inherits=r(11);var p={deprecate:r(73)},f=r(35),h=r(24).Buffer,d=i.Uint8Array||function(){};var y,m=r(36);function nop(){}function WritableState(t,n){c=c||r(9),t=t||{};var o=n instanceof c;this.objectMode=!!t.objectMode,o&&(this.objectMode=this.objectMode||!!t.writableObjectMode);var i=t.highWaterMark,l=t.writableHighWaterMark,p=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:o&&(l||0===l)?l:p,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var f=!1===t.decodeStrings;this.decodeStrings=!f,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){!function onwrite(t,n){var r=t._writableState,o=r.sync,i=r.writecb;if(function onwriteStateUpdate(t){t.writing=!1,t.writecb=null,t.length-=t.writelen,t.writelen=0}(r),n)!function onwriteError(t,n,r,o,i){--n.pendingcb,r?(a.nextTick(i,o),a.nextTick(finishMaybe,t,n),t._writableState.errorEmitted=!0,t.emit("error",o)):(i(o),t._writableState.errorEmitted=!0,t.emit("error",o),finishMaybe(t,n))}(t,r,o,n,i);else{var c=needFinish(r);c||r.corked||r.bufferProcessing||!r.bufferedRequest||clearBuffer(t,r),o?u(afterWrite,t,r,c,i):afterWrite(t,r,c,i)}}(n,t)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(t){if(c=c||r(9),!(y.call(Writable,this)||this instanceof c))return new Writable(t);this._writableState=new WritableState(t,this),this.writable=!0,t&&("function"==typeof t.write&&(this._write=t.write),"function"==typeof t.writev&&(this._writev=t.writev),"function"==typeof t.destroy&&(this._destroy=t.destroy),"function"==typeof t.final&&(this._final=t.final)),f.call(this)}function doWrite(t,n,r,o,i,a,c){n.writelen=o,n.writecb=c,n.writing=!0,n.sync=!0,r?t._writev(i,n.onwrite):t._write(i,a,n.onwrite),n.sync=!1}function afterWrite(t,n,r,o){r||function onwriteDrain(t,n){0===n.length&&n.needDrain&&(n.needDrain=!1,t.emit("drain"))}(t,n),n.pendingcb--,o(),finishMaybe(t,n)}function clearBuffer(t,n){n.bufferProcessing=!0;var r=n.bufferedRequest;if(t._writev&&r&&r.next){var o=n.bufferedRequestCount,i=new Array(o),a=n.corkedRequestsFree;a.entry=r;for(var c=0,u=!0;r;)i[c]=r,r.isBuf||(u=!1),r=r.next,c+=1;i.allBuffers=u,doWrite(t,n,!0,n.length,i,"",a.finish),n.pendingcb++,n.lastBufferedRequest=null,a.next?(n.corkedRequestsFree=a.next,a.next=null):n.corkedRequestsFree=new CorkedRequest(n),n.bufferedRequestCount=0}else{for(;r;){var l=r.chunk,p=r.encoding,f=r.callback;if(doWrite(t,n,!1,n.objectMode?1:l.length,l,p,f),r=r.next,n.bufferedRequestCount--,n.writing)break}null===r&&(n.lastBufferedRequest=null)}n.bufferedRequest=r,n.bufferProcessing=!1}function needFinish(t){return t.ending&&0===t.length&&null===t.bufferedRequest&&!t.finished&&!t.writing}function callFinal(t,n){t._final((function(r){n.pendingcb--,r&&t.emit("error",r),n.prefinished=!0,t.emit("prefinish"),finishMaybe(t,n)}))}function finishMaybe(t,n){var r=needFinish(n);return r&&(!function prefinish(t,n){n.prefinished||n.finalCalled||("function"==typeof t._final?(n.pendingcb++,n.finalCalled=!0,a.nextTick(callFinal,t,n)):(n.prefinished=!0,t.emit("prefinish")))}(t,n),0===n.pendingcb&&(n.finished=!0,t.emit("finish"))),r}l.inherits(Writable,f),WritableState.prototype.getBuffer=function getBuffer(){for(var t=this.bufferedRequest,n=[];t;)n.push(t),t=t.next;return n},function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:p.deprecate((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(t){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(y=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{value:function(t){return!!y.call(this,t)||this===Writable&&(t&&t._writableState instanceof WritableState)}})):y=function(t){return t instanceof this},Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},Writable.prototype.write=function(t,n,r){var o=this._writableState,i=!1,c=!o.objectMode&&function _isUint8Array(t){return h.isBuffer(t)||t instanceof d}(t);return c&&!h.isBuffer(t)&&(t=function _uint8ArrayToBuffer(t){return h.from(t)}(t)),"function"==typeof n&&(r=n,n=null),c?n="buffer":n||(n=o.defaultEncoding),"function"!=typeof r&&(r=nop),o.ended?function writeAfterEnd(t,n){var r=new Error("write after end");t.emit("error",r),a.nextTick(n,r)}(this,r):(c||function validChunk(t,n,r,o){var i=!0,c=!1;return null===r?c=new TypeError("May not write null values to stream"):"string"==typeof r||void 0===r||n.objectMode||(c=new TypeError("Invalid non-string/buffer chunk")),c&&(t.emit("error",c),a.nextTick(o,c),i=!1),i}(this,o,t,r))&&(o.pendingcb++,i=function writeOrBuffer(t,n,r,o,i,a){if(!r){var c=function decodeChunk(t,n,r){t.objectMode||!1===t.decodeStrings||"string"!=typeof n||(n=h.from(n,r));return n}(n,o,i);o!==c&&(r=!0,i="buffer",o=c)}var u=n.objectMode?1:o.length;n.length+=u;var l=n.length<n.highWaterMark;l||(n.needDrain=!0);if(n.writing||n.corked){var p=n.lastBufferedRequest;n.lastBufferedRequest={chunk:o,encoding:i,isBuf:r,callback:a,next:null},p?p.next=n.lastBufferedRequest:n.bufferedRequest=n.lastBufferedRequest,n.bufferedRequestCount+=1}else doWrite(t,n,!1,u,o,i,a);return l}(this,o,c,t,n,r)),i},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var t=this._writableState;t.corked&&(t.corked--,t.writing||t.corked||t.finished||t.bufferProcessing||!t.bufferedRequest||clearBuffer(this,t))},Writable.prototype.setDefaultEncoding=function setDefaultEncoding(t){if("string"==typeof t&&(t=t.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((t+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+t);return this._writableState.defaultEncoding=t,this},Object.defineProperty(Writable.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Writable.prototype._write=function(t,n,r){r(new Error("_write() is not implemented"))},Writable.prototype._writev=null,Writable.prototype.end=function(t,n,r){var o=this._writableState;"function"==typeof t?(r=t,t=null,n=null):"function"==typeof n&&(r=n,n=null),null!=t&&this.write(t,n),o.corked&&(o.corked=1,this.uncork()),o.ending||o.finished||function endWritable(t,n,r){n.ending=!0,finishMaybe(t,n),r&&(n.finished?a.nextTick(r):t.once("finish",r));n.ended=!0,t.writable=!1}(this,o,r)},Object.defineProperty(Writable.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(t){this._writableState&&(this._writableState.destroyed=t)}}),Writable.prototype.destroy=m.destroy,Writable.prototype._undestroy=m.undestroy,Writable.prototype._destroy=function(t,n){this.end(),n(t)}}).call(this,r(12),r(21).setImmediate,r(5))},function(t,n,r){"use strict";var o=r(14),i=r(42),a=r(43),c=r(44);a=r(43);function CompressedObject(t,n,r,o,i){this.compressedSize=t,this.uncompressedSize=n,this.crc32=r,this.compression=o,this.compressedContent=i}CompressedObject.prototype={getContentWorker:function(){var t=new i(o.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new a("data_length")),n=this;return t.on("end",(function(){if(this.streamInfo.data_length!==n.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")})),t},getCompressedWorker:function(){return new i(o.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},CompressedObject.createWorkerFrom=function(t,n,r){return t.pipe(new c).pipe(new a("uncompressedSize")).pipe(n.compressWorker(r)).pipe(new a("compressedSize")).withStreamInfo("compression",n)},t.exports=CompressedObject},function(t,n,r){"use strict";var o=r(1);var i=function makeTable(){for(var t,n=[],r=0;r<256;r++){t=r;for(var o=0;o<8;o++)t=1&t?3988292384^t>>>1:t>>>1;n[r]=t}return n}();t.exports=function crc32wrapper(t,n){return void 0!==t&&t.length?"string"!==o.getTypeOf(t)?function crc32(t,n,r,o){var a=i,c=o+r;t^=-1;for(var u=o;u<c;u++)t=t>>>8^a[255&(t^n[u])];return-1^t}(0|n,t,t.length,0):function crc32str(t,n,r,o){var a=i,c=o+r;t^=-1;for(var u=o;u<c;u++)t=t>>>8^a[255&(t^n.charCodeAt(u))];return-1^t}(0|n,t,t.length,0):0}},function(t,n,r){"use strict";t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(t,n,r){"use strict";var o,i=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0});var a=r(16),c=r(20),u=function(t){function QueuedEvent(n){var r=t.call(this)||this;r._queued=!1,r.options=n;var o=n||{};return"boolean"==typeof o.condensed?r._condensed=o.condensed:r._condensed=!1,"object"==typeof o.queue&&null!==o.queue&&(r._queue=o.queue),r}return i(QueuedEvent,t),QueuedEvent.prototype.post=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(this._listeners&&0!==this._listeners.length){var o=this._queue?this._queue:c.default.global();if(this._condensed){if(this._queuedData=n,this._queuedListeners=this._listeners,this._queued)return;this._queued=!0,o.add((function(){t._queued=!1;for(var n=t._queuedData,r=t._queuedListeners,o=0;o<r.length;++o){var i=r[o];t._call(i,n)}}))}else{var i=this._listeners;o.add((function(){for(var r=0;r<i.length;++r){var o=i[r];t._call(o,n)}}))}}},QueuedEvent}(a.BaseEvent);n.QueuedEvent=u;var l=function(t){function VoidQueuedEvent(){return null!==t&&t.apply(this,arguments)||this}return i(VoidQueuedEvent,t),VoidQueuedEvent.prototype.post=function(){t.prototype.post.call(this,void 0)},VoidQueuedEvent}(u);n.VoidQueuedEvent=l;var p=function(t){function ErrorQueuedEvent(){return null!==t&&t.apply(this,arguments)||this}return i(ErrorQueuedEvent,t),ErrorQueuedEvent.prototype.post=function(n){if(!this._listeners||0===this._listeners.length)throw new Error("error event posted while no listeners attached. Error: "+n.message);t.prototype.post.call(this,n)},ErrorQueuedEvent}(u);n.ErrorQueuedEvent=p},function(t,n,r){"use strict";(function(t){var o,i=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0});var a=function(n){function AsyncEvent(t){var r=n.call(this)||this;r._queued=!1,r.options=t;var o=t||{};return"boolean"==typeof o.condensed?r._condensed=o.condensed:r._condensed=!1,r}return i(AsyncEvent,n),AsyncEvent.defaultScheduler=function(n){"undefined"!=typeof window?setTimeout(n,0):t(n)},AsyncEvent.setScheduler=function(t){AsyncEvent._scheduler=t},AsyncEvent.prototype.post=function(){for(var t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(this._listeners&&0!==this._listeners.length)if(this._condensed){if(this._queuedData=n,this._queuedListeners=this._listeners,this._queued)return;this._queued=!0,AsyncEvent._scheduler((function(){t._queued=!1;for(var n=t._queuedData,r=t._queuedListeners,o=0;o<r.length;++o){var i=r[o];t._call(i,n)}}))}else{var o=this._listeners;AsyncEvent._scheduler((function(){for(var r=0;r<o.length;++r){var i=o[r];t._call(i,n)}}))}},AsyncEvent.prototype._call=function(t,r){t.event&&t.event instanceof AsyncEvent?t.event._postDirect(r):n.prototype._call.call(this,t,r)},AsyncEvent.prototype._postDirect=function(t){if(this._listeners&&0!==this._listeners.length)for(var n=this._listeners,r=0;r<n.length;++r){var o=n[r];this._call(o,t)}},AsyncEvent._scheduler=AsyncEvent.defaultScheduler,AsyncEvent}(r(16).BaseEvent);n.AsyncEvent=a;var c=function(t){function VoidAsyncEvent(){return null!==t&&t.apply(this,arguments)||this}return i(VoidAsyncEvent,t),VoidAsyncEvent.prototype.post=function(){t.prototype.post.call(this,void 0)},VoidAsyncEvent}(a);n.VoidAsyncEvent=c;var u=function(t){function ErrorAsyncEvent(){return null!==t&&t.apply(this,arguments)||this}return i(ErrorAsyncEvent,t),ErrorAsyncEvent.prototype.post=function(n){if(0===this.listenerCount())throw new Error("error event posted while no listeners attached. Error: "+n.message);t.prototype.post.call(this,n)},ErrorAsyncEvent}(a);n.ErrorAsyncEvent=u}).call(this,r(21).setImmediate)},function(t,n){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var o=new Uint8Array(16);t.exports=function whatwgRNG(){return r(o),o}}else{var i=new Array(16);t.exports=function mathRNG(){for(var t,n=0;n<16;n++)0==(3&n)&&(t=4294967296*Math.random()),i[n]=t>>>((3&n)<<3)&255;return i}}},function(t,n){for(var r=[],o=0;o<256;++o)r[o]=(o+256).toString(16).substr(1);t.exports=function bytesToUuid(t,n){var o=n||0,i=r;return[i[t[o++]],i[t[o++]],i[t[o++]],i[t[o++]],"-",i[t[o++]],i[t[o++]],"-",i[t[o++]],i[t[o++]],"-",i[t[o++]],i[t[o++]],"-",i[t[o++]],i[t[o++]],i[t[o++]],i[t[o++]],i[t[o++]],i[t[o++]]].join("")}},function(t,n,r){t.exports=r(68)},function(t,n,r){"use strict";(function(n,o){var i=r(17);t.exports=Readable;var a,c=r(69);Readable.ReadableState=ReadableState;r(22).EventEmitter;var EElistenerCount=function(t,n){return t.listeners(n).length},u=r(35),l=r(24).Buffer,p=n.Uint8Array||function(){};var f=Object.create(r(13));f.inherits=r(11);var h=r(70),d=void 0;d=h&&h.debuglog?h.debuglog("stream"):function(){};var y,m=r(71),v=r(36);f.inherits(Readable,u);var g=["error","close","destroy","pause","resume"];function ReadableState(t,n){t=t||{};var o=n instanceof(a=a||r(9));this.objectMode=!!t.objectMode,o&&(this.objectMode=this.objectMode||!!t.readableObjectMode);var i=t.highWaterMark,c=t.readableHighWaterMark,u=this.objectMode?16:16384;this.highWaterMark=i||0===i?i:o&&(c||0===c)?c:u,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new m,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=t.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,t.encoding&&(y||(y=r(37).StringDecoder),this.decoder=new y(t.encoding),this.encoding=t.encoding)}function Readable(t){if(a=a||r(9),!(this instanceof Readable))return new Readable(t);this._readableState=new ReadableState(t,this),this.readable=!0,t&&("function"==typeof t.read&&(this._read=t.read),"function"==typeof t.destroy&&(this._destroy=t.destroy)),u.call(this)}function readableAddChunk(t,n,r,o,i){var a,c=t._readableState;null===n?(c.reading=!1,function onEofChunk(t,n){if(n.ended)return;if(n.decoder){var r=n.decoder.end();r&&r.length&&(n.buffer.push(r),n.length+=n.objectMode?1:r.length)}n.ended=!0,emitReadable(t)}(t,c)):(i||(a=function chunkInvalid(t,n){var r;(function _isUint8Array(t){return l.isBuffer(t)||t instanceof p})(n)||"string"==typeof n||void 0===n||t.objectMode||(r=new TypeError("Invalid non-string/buffer chunk"));return r}(c,n)),a?t.emit("error",a):c.objectMode||n&&n.length>0?("string"==typeof n||c.objectMode||Object.getPrototypeOf(n)===l.prototype||(n=function _uint8ArrayToBuffer(t){return l.from(t)}(n)),o?c.endEmitted?t.emit("error",new Error("stream.unshift() after end event")):addChunk(t,c,n,!0):c.ended?t.emit("error",new Error("stream.push() after EOF")):(c.reading=!1,c.decoder&&!r?(n=c.decoder.write(n),c.objectMode||0!==n.length?addChunk(t,c,n,!1):maybeReadMore(t,c)):addChunk(t,c,n,!1))):o||(c.reading=!1));return function needMoreData(t){return!t.ended&&(t.needReadable||t.length<t.highWaterMark||0===t.length)}(c)}function addChunk(t,n,r,o){n.flowing&&0===n.length&&!n.sync?(t.emit("data",r),t.read(0)):(n.length+=n.objectMode?1:r.length,o?n.buffer.unshift(r):n.buffer.push(r),n.needReadable&&emitReadable(t)),maybeReadMore(t,n)}Object.defineProperty(Readable.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(t){this._readableState&&(this._readableState.destroyed=t)}}),Readable.prototype.destroy=v.destroy,Readable.prototype._undestroy=v.undestroy,Readable.prototype._destroy=function(t,n){this.push(null),n(t)},Readable.prototype.push=function(t,n){var r,o=this._readableState;return o.objectMode?r=!0:"string"==typeof t&&((n=n||o.defaultEncoding)!==o.encoding&&(t=l.from(t,n),n=""),r=!0),readableAddChunk(this,t,n,!1,r)},Readable.prototype.unshift=function(t){return readableAddChunk(this,t,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(t){return y||(y=r(37).StringDecoder),this._readableState.decoder=new y(t),this._readableState.encoding=t,this};function howMuchToRead(t,n){return t<=0||0===n.length&&n.ended?0:n.objectMode?1:t!=t?n.flowing&&n.length?n.buffer.head.data.length:n.length:(t>n.highWaterMark&&(n.highWaterMark=function computeNewHighWaterMark(t){return t>=8388608?t=8388608:(t--,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,t|=t>>>16,t++),t}(t)),t<=n.length?t:n.ended?n.length:(n.needReadable=!0,0))}function emitReadable(t){var n=t._readableState;n.needReadable=!1,n.emittedReadable||(d("emitReadable",n.flowing),n.emittedReadable=!0,n.sync?i.nextTick(emitReadable_,t):emitReadable_(t))}function emitReadable_(t){d("emit readable"),t.emit("readable"),flow(t)}function maybeReadMore(t,n){n.readingMore||(n.readingMore=!0,i.nextTick(maybeReadMore_,t,n))}function maybeReadMore_(t,n){for(var r=n.length;!n.reading&&!n.flowing&&!n.ended&&n.length<n.highWaterMark&&(d("maybeReadMore read 0"),t.read(0),r!==n.length);)r=n.length;n.readingMore=!1}function nReadingNextTick(t){d("readable nexttick read 0"),t.read(0)}function resume_(t,n){n.reading||(d("resume read 0"),t.read(0)),n.resumeScheduled=!1,n.awaitDrain=0,t.emit("resume"),flow(t),n.flowing&&!n.reading&&t.read(0)}function flow(t){var n=t._readableState;for(d("flow",n.flowing);n.flowing&&null!==t.read(););}function fromList(t,n){return 0===n.length?null:(n.objectMode?r=n.buffer.shift():!t||t>=n.length?(r=n.decoder?n.buffer.join(""):1===n.buffer.length?n.buffer.head.data:n.buffer.concat(n.length),n.buffer.clear()):r=function fromListPartial(t,n,r){var o;t<n.head.data.length?(o=n.head.data.slice(0,t),n.head.data=n.head.data.slice(t)):o=t===n.head.data.length?n.shift():r?function copyFromBufferString(t,n){var r=n.head,o=1,i=r.data;t-=i.length;for(;r=r.next;){var a=r.data,c=t>a.length?a.length:t;if(c===a.length?i+=a:i+=a.slice(0,t),0===(t-=c)){c===a.length?(++o,r.next?n.head=r.next:n.head=n.tail=null):(n.head=r,r.data=a.slice(c));break}++o}return n.length-=o,i}(t,n):function copyFromBuffer(t,n){var r=l.allocUnsafe(t),o=n.head,i=1;o.data.copy(r),t-=o.data.length;for(;o=o.next;){var a=o.data,c=t>a.length?a.length:t;if(a.copy(r,r.length-t,0,c),0===(t-=c)){c===a.length?(++i,o.next?n.head=o.next:n.head=n.tail=null):(n.head=o,o.data=a.slice(c));break}++i}return n.length-=i,r}(t,n);return o}(t,n.buffer,n.decoder),r);var r}function endReadable(t){var n=t._readableState;if(n.length>0)throw new Error('"endReadable()" called on non-empty stream');n.endEmitted||(n.ended=!0,i.nextTick(endReadableNT,n,t))}function endReadableNT(t,n){t.endEmitted||0!==t.length||(t.endEmitted=!0,n.readable=!1,n.emit("end"))}function indexOf(t,n){for(var r=0,o=t.length;r<o;r++)if(t[r]===n)return r;return-1}Readable.prototype.read=function(t){d("read",t),t=parseInt(t,10);var n=this._readableState,r=t;if(0!==t&&(n.emittedReadable=!1),0===t&&n.needReadable&&(n.length>=n.highWaterMark||n.ended))return d("read: emitReadable",n.length,n.ended),0===n.length&&n.ended?endReadable(this):emitReadable(this),null;if(0===(t=howMuchToRead(t,n))&&n.ended)return 0===n.length&&endReadable(this),null;var o,i=n.needReadable;return d("need readable",i),(0===n.length||n.length-t<n.highWaterMark)&&d("length less than watermark",i=!0),n.ended||n.reading?d("reading or ended",i=!1):i&&(d("do read"),n.reading=!0,n.sync=!0,0===n.length&&(n.needReadable=!0),this._read(n.highWaterMark),n.sync=!1,n.reading||(t=howMuchToRead(r,n))),null===(o=t>0?fromList(t,n):null)?(n.needReadable=!0,t=0):n.length-=t,0===n.length&&(n.ended||(n.needReadable=!0),r!==t&&n.ended&&endReadable(this)),null!==o&&this.emit("data",o),o},Readable.prototype._read=function(t){this.emit("error",new Error("_read() is not implemented"))},Readable.prototype.pipe=function(t,n){var r=this,a=this._readableState;switch(a.pipesCount){case 0:a.pipes=t;break;case 1:a.pipes=[a.pipes,t];break;default:a.pipes.push(t)}a.pipesCount+=1,d("pipe count=%d opts=%j",a.pipesCount,n);var u=(!n||!1!==n.end)&&t!==o.stdout&&t!==o.stderr?onend:unpipe;function onunpipe(n,o){d("onunpipe"),n===r&&o&&!1===o.hasUnpiped&&(o.hasUnpiped=!0,function cleanup(){d("cleanup"),t.removeListener("close",onclose),t.removeListener("finish",onfinish),t.removeListener("drain",l),t.removeListener("error",onerror),t.removeListener("unpipe",onunpipe),r.removeListener("end",onend),r.removeListener("end",unpipe),r.removeListener("data",ondata),p=!0,!a.awaitDrain||t._writableState&&!t._writableState.needDrain||l()}())}function onend(){d("onend"),t.end()}a.endEmitted?i.nextTick(u):r.once("end",u),t.on("unpipe",onunpipe);var l=function pipeOnDrain(t){return function(){var n=t._readableState;d("pipeOnDrain",n.awaitDrain),n.awaitDrain&&n.awaitDrain--,0===n.awaitDrain&&EElistenerCount(t,"data")&&(n.flowing=!0,flow(t))}}(r);t.on("drain",l);var p=!1;var f=!1;function ondata(n){d("ondata"),f=!1,!1!==t.write(n)||f||((1===a.pipesCount&&a.pipes===t||a.pipesCount>1&&-1!==indexOf(a.pipes,t))&&!p&&(d("false write response, pause",r._readableState.awaitDrain),r._readableState.awaitDrain++,f=!0),r.pause())}function onerror(n){d("onerror",n),unpipe(),t.removeListener("error",onerror),0===EElistenerCount(t,"error")&&t.emit("error",n)}function onclose(){t.removeListener("finish",onfinish),unpipe()}function onfinish(){d("onfinish"),t.removeListener("close",onclose),unpipe()}function unpipe(){d("unpipe"),r.unpipe(t)}return r.on("data",ondata),function prependListener(t,n,r){if("function"==typeof t.prependListener)return t.prependListener(n,r);t._events&&t._events[n]?c(t._events[n])?t._events[n].unshift(r):t._events[n]=[r,t._events[n]]:t.on(n,r)}(t,"error",onerror),t.once("close",onclose),t.once("finish",onfinish),t.emit("pipe",r),a.flowing||(d("pipe resume"),r.resume()),t},Readable.prototype.unpipe=function(t){var n=this._readableState,r={hasUnpiped:!1};if(0===n.pipesCount)return this;if(1===n.pipesCount)return t&&t!==n.pipes||(t||(t=n.pipes),n.pipes=null,n.pipesCount=0,n.flowing=!1,t&&t.emit("unpipe",this,r)),this;if(!t){var o=n.pipes,i=n.pipesCount;n.pipes=null,n.pipesCount=0,n.flowing=!1;for(var a=0;a<i;a++)o[a].emit("unpipe",this,r);return this}var c=indexOf(n.pipes,t);return-1===c||(n.pipes.splice(c,1),n.pipesCount-=1,1===n.pipesCount&&(n.pipes=n.pipes[0]),t.emit("unpipe",this,r)),this},Readable.prototype.on=function(t,n){var r=u.prototype.on.call(this,t,n);if("data"===t)!1!==this._readableState.flowing&&this.resume();else if("readable"===t){var o=this._readableState;o.endEmitted||o.readableListening||(o.readableListening=o.needReadable=!0,o.emittedReadable=!1,o.reading?o.length&&emitReadable(this):i.nextTick(nReadingNextTick,this))}return r},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.resume=function(){var t=this._readableState;return t.flowing||(d("resume"),t.flowing=!0,function resume(t,n){n.resumeScheduled||(n.resumeScheduled=!0,i.nextTick(resume_,t,n))}(this,t)),this},Readable.prototype.pause=function(){return d("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(d("pause"),this._readableState.flowing=!1,this.emit("pause")),this},Readable.prototype.wrap=function(t){var n=this,r=this._readableState,o=!1;for(var i in t.on("end",(function(){if(d("wrapped end"),r.decoder&&!r.ended){var t=r.decoder.end();t&&t.length&&n.push(t)}n.push(null)})),t.on("data",(function(i){(d("wrapped data"),r.decoder&&(i=r.decoder.write(i)),r.objectMode&&null==i)||(r.objectMode||i&&i.length)&&(n.push(i)||(o=!0,t.pause()))})),t)void 0===this[i]&&"function"==typeof t[i]&&(this[i]=function(n){return function(){return t[n].apply(t,arguments)}}(i));for(var a=0;a<g.length;a++)t.on(g[a],this.emit.bind(this,g[a]));return this._read=function(n){d("wrapped _read",n),o&&(o=!1,t.resume())},this},Object.defineProperty(Readable.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Readable._fromList=fromList}).call(this,r(5),r(12))},function(t,n,r){t.exports=r(22).EventEmitter},function(t,n,r){"use strict";var o=r(17);function emitErrorNT(t,n){t.emit("error",n)}t.exports={destroy:function destroy(t,n){var r=this,i=this._readableState&&this._readableState.destroyed,a=this._writableState&&this._writableState.destroyed;return i||a?(n?n(t):!t||this._writableState&&this._writableState.errorEmitted||o.nextTick(emitErrorNT,this,t),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(t||null,(function(t){!n&&t?(o.nextTick(emitErrorNT,r,t),r._writableState&&(r._writableState.errorEmitted=!0)):n&&n(t)})),this)},undestroy:function undestroy(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(t,n,r){"use strict";var o=r(74).Buffer,i=o.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function StringDecoder(t){var n;switch(this.encoding=function normalizeEncoding(t){var n=function _normalizeEncoding(t){if(!t)return"utf8";for(var n;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(n)return;t=(""+t).toLowerCase(),n=!0}}(t);if("string"!=typeof n&&(o.isEncoding===i||!i(t)))throw new Error("Unknown encoding: "+t);return n||t}(t),this.encoding){case"utf16le":this.text=utf16Text,this.end=utf16End,n=4;break;case"utf8":this.fillLast=utf8FillLast,n=4;break;case"base64":this.text=base64Text,this.end=base64End,n=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=o.allocUnsafe(n)}function utf8CheckByte(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function utf8FillLast(t){var n=this.lastTotal-this.lastNeed,r=function utf8CheckExtraBytes(t,n,r){if(128!=(192&n[0]))return t.lastNeed=0,"";if(t.lastNeed>1&&n.length>1){if(128!=(192&n[1]))return t.lastNeed=1,"";if(t.lastNeed>2&&n.length>2&&128!=(192&n[2]))return t.lastNeed=2,""}}(this,t);return void 0!==r?r:this.lastNeed<=t.length?(t.copy(this.lastChar,n,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,n,0,t.length),void(this.lastNeed-=t.length))}function utf16Text(t,n){if((t.length-n)%2==0){var r=t.toString("utf16le",n);if(r){var o=r.charCodeAt(r.length-1);if(o>=55296&&o<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",n,t.length-1)}function utf16End(t){var n=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return n+this.lastChar.toString("utf16le",0,r)}return n}function base64Text(t,n){var r=(t.length-n)%3;return 0===r?t.toString("base64",n):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",n,t.length-r))}function base64End(t){var n=t&&t.length?this.write(t):"";return this.lastNeed?n+this.lastChar.toString("base64",0,3-this.lastNeed):n}function simpleWrite(t){return t.toString(this.encoding)}function simpleEnd(t){return t&&t.length?this.write(t):""}n.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(t){if(0===t.length)return"";var n,r;if(this.lastNeed){if(void 0===(n=this.fillLast(t)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?n?n+this.text(t,r):this.text(t,r):n||""},StringDecoder.prototype.end=function utf8End(t){var n=t&&t.length?this.write(t):"";return this.lastNeed?n+"":n},StringDecoder.prototype.text=function utf8Text(t,n){var r=function utf8CheckIncomplete(t,n,r){var o=n.length-1;if(o<r)return 0;var i=utf8CheckByte(n[o]);if(i>=0)return i>0&&(t.lastNeed=i-1),i;if(--o<r||-2===i)return 0;if((i=utf8CheckByte(n[o]))>=0)return i>0&&(t.lastNeed=i-2),i;if(--o<r||-2===i)return 0;if((i=utf8CheckByte(n[o]))>=0)return i>0&&(2===i?i=0:t.lastNeed=i-3),i;return 0}(this,t,n);if(!this.lastNeed)return t.toString("utf8",n);this.lastTotal=r;var o=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,o),t.toString("utf8",n,o)},StringDecoder.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},function(t,n,r){"use strict";t.exports=Transform;var o=r(9),i=Object.create(r(13));function afterTransform(t,n){var r=this._transformState;r.transforming=!1;var o=r.writecb;if(!o)return this.emit("error",new Error("write callback called multiple times"));r.writechunk=null,r.writecb=null,null!=n&&this.push(n),o(t);var i=this._readableState;i.reading=!1,(i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}function Transform(t){if(!(this instanceof Transform))return new Transform(t);o.call(this,t),this._transformState={afterTransform:afterTransform.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,t&&("function"==typeof t.transform&&(this._transform=t.transform),"function"==typeof t.flush&&(this._flush=t.flush)),this.on("prefinish",prefinish)}function prefinish(){var t=this;"function"==typeof this._flush?this._flush((function(n,r){done(t,n,r)})):done(this,null,null)}function done(t,n,r){if(n)return t.emit("error",n);if(null!=r&&t.push(r),t._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(t._transformState.transforming)throw new Error("Calling transform done when still transforming");return t.push(null)}i.inherits=r(11),i.inherits(Transform,o),Transform.prototype.push=function(t,n){return this._transformState.needTransform=!1,o.prototype.push.call(this,t,n)},Transform.prototype._transform=function(t,n,r){throw new Error("_transform() is not implemented")},Transform.prototype._write=function(t,n,r){var o=this._transformState;if(o.writecb=r,o.writechunk=t,o.writeencoding=n,!o.transforming){var i=this._readableState;(o.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},Transform.prototype._read=function(t){var n=this._transformState;null!==n.writechunk&&n.writecb&&!n.transforming?(n.transforming=!0,this._transform(n.writechunk,n.writeencoding,n.afterTransform)):n.needTransform=!0},Transform.prototype._destroy=function(t,n){var r=this;o.prototype._destroy.call(this,t,(function(t){n(t),r.emit("close")}))}},function(t,n,r){"use strict";var o=r(1),i=r(6),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(t){for(var n,r,i,c,u,l,p,f=[],h=0,d=t.length,y=d,m="string"!==o.getTypeOf(t);h<t.length;)y=d-h,m?(n=t[h++],r=h<d?t[h++]:0,i=h<d?t[h++]:0):(n=t.charCodeAt(h++),r=h<d?t.charCodeAt(h++):0,i=h<d?t.charCodeAt(h++):0),c=n>>2,u=(3&n)<<4|r>>4,l=y>1?(15&r)<<2|i>>6:64,p=y>2?63&i:64,f.push(a.charAt(c)+a.charAt(u)+a.charAt(l)+a.charAt(p));return f.join("")},n.decode=function(t){var n,r,o,c,u,l,p=0,f=0;if("data:"===t.substr(0,"data:".length))throw new Error("Invalid base64 input, it looks like a data url.");var h,d=3*(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"")).length/4;if(t.charAt(t.length-1)===a.charAt(64)&&d--,t.charAt(t.length-2)===a.charAt(64)&&d--,d%1!=0)throw new Error("Invalid base64 input, bad content length.");for(h=i.uint8array?new Uint8Array(0|d):new Array(0|d);p<t.length;)n=a.indexOf(t.charAt(p++))<<2|(c=a.indexOf(t.charAt(p++)))>>4,r=(15&c)<<4|(u=a.indexOf(t.charAt(p++)))>>2,o=(3&u)<<6|(l=a.indexOf(t.charAt(p++))),h[f++]=n,64!==u&&(h[f++]=r),64!==l&&(h[f++]=o);return h}},function(t,n,r){"use strict";(function(n){var o=r(1),i=r(83),a=r(4),c=r(39),u=r(6),l=r(14),p=null;if(u.nodestream)try{p=r(84)}catch(t){}function accumulate(t,r){return new l.Promise((function(i,a){var u=[],l=t._internalType,p=t._outputType,f=t._mimeType;t.on("data",(function(t,n){u.push(t),r&&r(n)})).on("error",(function(t){u=[],a(t)})).on("end",(function(){try{var t=function transformZipOutput(t,n,r){switch(t){case"blob":return o.newBlob(o.transformTo("arraybuffer",n),r);case"base64":return c.encode(n);default:return o.transformTo(t,n)}}(p,function concat(t,r){var o,i=0,a=null,c=0;for(o=0;o<r.length;o++)c+=r[o].length;switch(t){case"string":return r.join("");case"array":return Array.prototype.concat.apply([],r);case"uint8array":for(a=new Uint8Array(c),o=0;o<r.length;o++)a.set(r[o],i),i+=r[o].length;return a;case"nodebuffer":return n.concat(r);default:throw new Error("concat : unsupported type '"+t+"'")}}(l,u),f);i(t)}catch(t){a(t)}u=[]})).resume()}))}function StreamHelper(t,n,r){var c=n;switch(n){case"blob":case"arraybuffer":c="uint8array";break;case"base64":c="string"}try{this._internalType=c,this._outputType=n,this._mimeType=r,o.checkSupport(c),this._worker=t.pipe(new i(c)),t.lock()}catch(t){this._worker=new a("error"),this._worker.error(t)}}StreamHelper.prototype={accumulate:function(t){return accumulate(this,t)},on:function(t,n){var r=this;return"data"===t?this._worker.on(t,(function(t){n.call(r,t.data,t.meta)})):this._worker.on(t,(function(){o.delay(n,arguments,r)})),this},resume:function(){return o.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(t){if(o.checkSupport("nodestream"),"nodebuffer"!==this._outputType)throw new Error(this._outputType+" is not supported by this method");return new p(this,{objectMode:"nodebuffer"!==this._outputType},t)}},t.exports=StreamHelper}).call(this,r(8).Buffer)},function(t,n,r){"use strict";n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},function(t,n,r){"use strict";var o=r(1),i=r(4);function DataWorker(t){i.call(this,"DataWorker");var n=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,t.then((function(t){n.dataIsReady=!0,n.data=t,n.max=t&&t.length||0,n.type=o.getTypeOf(t),n.isPaused||n._tickAndRepeat()}),(function(t){n.error(t)}))}o.inherits(DataWorker,i),DataWorker.prototype.cleanUp=function(){i.prototype.cleanUp.call(this),this.data=null},DataWorker.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,o.delay(this._tickAndRepeat,[],this)),!0)},DataWorker.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(o.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},DataWorker.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var t=null,n=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":t=this.data.substring(this.index,n);break;case"uint8array":t=this.data.subarray(this.index,n);break;case"array":case"nodebuffer":t=this.data.slice(this.index,n)}return this.index=n,this.push({data:t,meta:{percent:this.max?this.index/this.max*100:0}})},t.exports=DataWorker},function(t,n,r){"use strict";var o=r(1),i=r(4);function DataLengthProbe(t){i.call(this,"DataLengthProbe for "+t),this.propName=t,this.withStreamInfo(t,0)}o.inherits(DataLengthProbe,i),DataLengthProbe.prototype.processChunk=function(t){if(t){var n=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=n+t.data.length}i.prototype.processChunk.call(this,t)},t.exports=DataLengthProbe},function(t,n,r){"use strict";var o=r(4),i=r(27);function Crc32Probe(){o.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}r(1).inherits(Crc32Probe,o),Crc32Probe.prototype.processChunk=function(t){this.streamInfo.crc32=i(t.data,this.streamInfo.crc32||0),this.push(t)},t.exports=Crc32Probe},function(t,n,r){"use strict";var o=r(4);n.STORE={magic:"\0\0",compressWorker:function(t){return new o("STORE compression")},uncompressWorker:function(){return new o("STORE decompression")}},n.DEFLATE=r(87)},function(t,n,r){"use strict";t.exports=function adler32(t,n,r,o){for(var i=65535&t|0,a=t>>>16&65535|0,c=0;0!==r;){r-=c=r>2e3?2e3:r;do{a=a+(i=i+n[o++]|0)|0}while(--c);i%=65521,a%=65521}return i|a<<16|0}},function(t,n,r){"use strict";var o=function makeTable(){for(var t,n=[],r=0;r<256;r++){t=r;for(var o=0;o<8;o++)t=1&t?3988292384^t>>>1:t>>>1;n[r]=t}return n}();t.exports=function crc32(t,n,r,i){var a=o,c=i+r;t^=-1;for(var u=i;u<c;u++)t=t>>>8^a[255&(t^n[u])];return-1^t}},function(t,n,r){"use strict";var o=r(7),i=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch(t){i=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){a=!1}for(var c=new o.Buf8(256),u=0;u<256;u++)c[u]=u>=252?6:u>=248?5:u>=240?4:u>=224?3:u>=192?2:1;function buf2binstring(t,n){if(n<65534&&(t.subarray&&a||!t.subarray&&i))return String.fromCharCode.apply(null,o.shrinkBuf(t,n));for(var r="",c=0;c<n;c++)r+=String.fromCharCode(t[c]);return r}c[254]=c[254]=1,n.string2buf=function(t){var n,r,i,a,c,u=t.length,l=0;for(a=0;a<u;a++)55296==(64512&(r=t.charCodeAt(a)))&&a+1<u&&56320==(64512&(i=t.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),l+=r<128?1:r<2048?2:r<65536?3:4;for(n=new o.Buf8(l),c=0,a=0;c<l;a++)55296==(64512&(r=t.charCodeAt(a)))&&a+1<u&&56320==(64512&(i=t.charCodeAt(a+1)))&&(r=65536+(r-55296<<10)+(i-56320),a++),r<128?n[c++]=r:r<2048?(n[c++]=192|r>>>6,n[c++]=128|63&r):r<65536?(n[c++]=224|r>>>12,n[c++]=128|r>>>6&63,n[c++]=128|63&r):(n[c++]=240|r>>>18,n[c++]=128|r>>>12&63,n[c++]=128|r>>>6&63,n[c++]=128|63&r);return n},n.buf2binstring=function(t){return buf2binstring(t,t.length)},n.binstring2buf=function(t){for(var n=new o.Buf8(t.length),r=0,i=n.length;r<i;r++)n[r]=t.charCodeAt(r);return n},n.buf2string=function(t,n){var r,o,i,a,u=n||t.length,l=new Array(2*u);for(o=0,r=0;r<u;)if((i=t[r++])<128)l[o++]=i;else if((a=c[i])>4)l[o++]=65533,r+=a-1;else{for(i&=2===a?31:3===a?15:7;a>1&&r<u;)i=i<<6|63&t[r++],a--;a>1?l[o++]=65533:i<65536?l[o++]=i:(i-=65536,l[o++]=55296|i>>10&1023,l[o++]=56320|1023&i)}return buf2binstring(l,o)},n.utf8border=function(t,n){var r;for((n=n||t.length)>t.length&&(n=t.length),r=n-1;r>=0&&128==(192&t[r]);)r--;return r<0||0===r?n:r+c[t[r]]>n?r:n}},function(t,n,r){"use strict";t.exports=function ZStream(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(t,n,r){"use strict";t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(t,n,r){"use strict";n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\b"},function(t,n,r){"use strict";var o=r(1),i=r(6),a=r(53),c=r(101),u=r(102),l=r(55);t.exports=function(t){var n=o.getTypeOf(t);return o.checkSupport(n),"string"!==n||i.uint8array?"nodebuffer"===n?new u(t):i.uint8array?new l(o.transformTo("uint8array",t)):new a(o.transformTo("array",t)):new c(t)}},function(t,n,r){"use strict";var o=r(54);function ArrayReader(t){o.call(this,t);for(var n=0;n<this.data.length;n++)t[n]=255&t[n]}r(1).inherits(ArrayReader,o),ArrayReader.prototype.byteAt=function(t){return this.data[this.zero+t]},ArrayReader.prototype.lastIndexOfSignature=function(t){for(var n=t.charCodeAt(0),r=t.charCodeAt(1),o=t.charCodeAt(2),i=t.charCodeAt(3),a=this.length-4;a>=0;--a)if(this.data[a]===n&&this.data[a+1]===r&&this.data[a+2]===o&&this.data[a+3]===i)return a-this.zero;return-1},ArrayReader.prototype.readAndCheckSignature=function(t){var n=t.charCodeAt(0),r=t.charCodeAt(1),o=t.charCodeAt(2),i=t.charCodeAt(3),a=this.readData(4);return n===a[0]&&r===a[1]&&o===a[2]&&i===a[3]},ArrayReader.prototype.readData=function(t){if(this.checkOffset(t),0===t)return[];var n=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,n},t.exports=ArrayReader},function(t,n,r){"use strict";var o=r(1);function DataReader(t){this.data=t,this.length=t.length,this.index=0,this.zero=0}DataReader.prototype={checkOffset:function(t){this.checkIndex(this.index+t)},checkIndex:function(t){if(this.length<this.zero+t||t<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+t+"). Corrupted zip ?")},setIndex:function(t){this.checkIndex(t),this.index=t},skip:function(t){this.setIndex(this.index+t)},byteAt:function(t){},readInt:function(t){var n,r=0;for(this.checkOffset(t),n=this.index+t-1;n>=this.index;n--)r=(r<<8)+this.byteAt(n);return this.index+=t,r},readString:function(t){return o.transformTo("string",this.readData(t))},readData:function(t){},lastIndexOfSignature:function(t){},readAndCheckSignature:function(t){},readDate:function(){var t=this.readInt(4);return new Date(Date.UTC(1980+(t>>25&127),(t>>21&15)-1,t>>16&31,t>>11&31,t>>5&63,(31&t)<<1))}},t.exports=DataReader},function(t,n,r){"use strict";var o=r(53);function Uint8ArrayReader(t){o.call(this,t)}r(1).inherits(Uint8ArrayReader,o),Uint8ArrayReader.prototype.readData=function(t){if(this.checkOffset(t),0===t)return new Uint8Array(0);var n=this.data.subarray(this.zero+this.index,this.zero+this.index+t);return this.index+=t,n},t.exports=Uint8ArrayReader},function(t,n,r){(function(t,n){var r;!function(r){!function(o){var i="object"==typeof n?n:"object"==typeof self?self:"object"==typeof this?this:Function("return this;")(),a=makeExporter(r);function makeExporter(t,n){return function(r,o){"function"!=typeof t[r]&&Object.defineProperty(t,r,{configurable:!0,writable:!0,value:o}),n&&n(r,o)}}void 0===i.Reflect?i.Reflect=r:a=makeExporter(i.Reflect,a),function(n){var r=Object.prototype.hasOwnProperty,o="function"==typeof Symbol,i=o&&void 0!==Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",a=o&&void 0!==Symbol.iterator?Symbol.iterator:"@@iterator",c="function"==typeof Object.create,u={__proto__:[]}instanceof Array,l=!c&&!u,p={create:c?function(){return MakeDictionary(Object.create(null))}:u?function(){return MakeDictionary({__proto__:null})}:function(){return MakeDictionary({})},has:l?function(t,n){return r.call(t,n)}:function(t,n){return n in t},get:l?function(t,n){return r.call(t,n)?t[n]:void 0}:function(t,n){return t[n]}},f=Object.getPrototypeOf(Function),h="object"==typeof t&&t.env&&"true"===t.env.REFLECT_METADATA_USE_MAP_POLYFILL,d=h||"function"!=typeof Map||"function"!=typeof Map.prototype.entries?function CreateMapPolyfill(){var t={},n=[],r=function(){function MapIterator(t,n,r){this._index=0,this._keys=t,this._values=n,this._selector=r}return MapIterator.prototype["@@iterator"]=function(){return this},MapIterator.prototype[a]=function(){return this},MapIterator.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var r=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=n,this._values=n):this._index++,{value:r,done:!1}}return{value:void 0,done:!0}},MapIterator.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=n,this._values=n),t},MapIterator.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=n,this._values=n),{value:t,done:!0}},MapIterator}();return function(){function Map(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(Map.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Map.prototype.has=function(t){return this._find(t,!1)>=0},Map.prototype.get=function(t){var n=this._find(t,!1);return n>=0?this._values[n]:void 0},Map.prototype.set=function(t,n){var r=this._find(t,!0);return this._values[r]=n,this},Map.prototype.delete=function(n){var r=this._find(n,!1);if(r>=0){for(var o=this._keys.length,i=r+1;i<o;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,n===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},Map.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},Map.prototype.keys=function(){return new r(this._keys,this._values,getKey)},Map.prototype.values=function(){return new r(this._keys,this._values,getValue)},Map.prototype.entries=function(){return new r(this._keys,this._values,getEntry)},Map.prototype["@@iterator"]=function(){return this.entries()},Map.prototype[a]=function(){return this.entries()},Map.prototype._find=function(t,n){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&n&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},Map}();function getKey(t,n){return t}function getValue(t,n){return n}function getEntry(t,n){return[t,n]}}():Map,y=h||"function"!=typeof Set||"function"!=typeof Set.prototype.entries?function CreateSetPolyfill(){return function(){function Set(){this._map=new d}return Object.defineProperty(Set.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Set.prototype.has=function(t){return this._map.has(t)},Set.prototype.add=function(t){return this._map.set(t,t),this},Set.prototype.delete=function(t){return this._map.delete(t)},Set.prototype.clear=function(){this._map.clear()},Set.prototype.keys=function(){return this._map.keys()},Set.prototype.values=function(){return this._map.values()},Set.prototype.entries=function(){return this._map.entries()},Set.prototype["@@iterator"]=function(){return this.keys()},Set.prototype[a]=function(){return this.keys()},Set}()}():Set,m=new(h||"function"!=typeof WeakMap?function CreateWeakMapPolyfill(){var t=p.create(),n=CreateUniqueKey();return function(){function WeakMap(){this._key=CreateUniqueKey()}return WeakMap.prototype.has=function(t){var n=GetOrCreateWeakMapTable(t,!1);return void 0!==n&&p.has(n,this._key)},WeakMap.prototype.get=function(t){var n=GetOrCreateWeakMapTable(t,!1);return void 0!==n?p.get(n,this._key):void 0},WeakMap.prototype.set=function(t,n){return GetOrCreateWeakMapTable(t,!0)[this._key]=n,this},WeakMap.prototype.delete=function(t){var n=GetOrCreateWeakMapTable(t,!1);return void 0!==n&&delete n[this._key]},WeakMap.prototype.clear=function(){this._key=CreateUniqueKey()},WeakMap}();function CreateUniqueKey(){var n;do{n="@@WeakMap@@"+CreateUUID()}while(p.has(t,n));return t[n]=!0,n}function GetOrCreateWeakMapTable(t,o){if(!r.call(t,n)){if(!o)return;Object.defineProperty(t,n,{value:p.create()})}return t[n]}function FillRandomBytes(t,n){for(var r=0;r<n;++r)t[r]=255*Math.random()|0;return t}function CreateUUID(){var t=function GenRandomBytes(t){return"function"==typeof Uint8Array?"undefined"!=typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!=typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):FillRandomBytes(new Uint8Array(t),t):FillRandomBytes(new Array(t),t)}(16);t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<16;++r){var o=t[r];4!==r&&6!==r&&8!==r||(n+="-"),o<16&&(n+="0"),n+=o.toString(16).toLowerCase()}return n}}():WeakMap);function GetOrCreateMetadataMap(t,n,r){var o=m.get(t);if(IsUndefined(o)){if(!r)return;o=new d,m.set(t,o)}var i=o.get(n);if(IsUndefined(i)){if(!r)return;i=new d,o.set(n,i)}return i}function OrdinaryHasOwnMetadata(t,n,r){var o=GetOrCreateMetadataMap(n,r,!1);return!IsUndefined(o)&&function ToBoolean(t){return!!t}(o.has(t))}function OrdinaryGetOwnMetadata(t,n,r){var o=GetOrCreateMetadataMap(n,r,!1);if(!IsUndefined(o))return o.get(t)}function OrdinaryDefineOwnMetadata(t,n,r,o){GetOrCreateMetadataMap(r,o,!0).set(t,n)}function OrdinaryOwnMetadataKeys(t,n){var r=[],o=GetOrCreateMetadataMap(t,n,!1);if(IsUndefined(o))return r;for(var i=function GetIterator(t){var n=GetMethod(t,a);if(!IsCallable(n))throw new TypeError;var r=n.call(t);if(!IsObject(r))throw new TypeError;return r}(o.keys()),c=0;;){var u=IteratorStep(i);if(!u)return r.length=c,r;var l=u.value;try{r[c]=l}catch(t){try{IteratorClose(i)}finally{throw t}}c++}}function Type(t){if(null===t)return 1;switch(typeof t){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function IsUndefined(t){return void 0===t}function IsNull(t){return null===t}function IsObject(t){return"object"==typeof t?null!==t:"function"==typeof t}function ToPrimitive(t,n){switch(Type(t)){case 0:case 1:case 2:case 3:case 4:case 5:return t}var r=3===n?"string":5===n?"number":"default",o=GetMethod(t,i);if(void 0!==o){var a=o.call(t,r);if(IsObject(a))throw new TypeError;return a}return function OrdinaryToPrimitive(t,n){if("string"===n){var r=t.toString;if(IsCallable(r))if(!IsObject(i=r.call(t)))return i;if(IsCallable(o=t.valueOf))if(!IsObject(i=o.call(t)))return i}else{var o;if(IsCallable(o=t.valueOf))if(!IsObject(i=o.call(t)))return i;var i,a=t.toString;if(IsCallable(a))if(!IsObject(i=a.call(t)))return i}throw new TypeError}(t,"default"===r?"number":r)}function ToPropertyKey(t){var n=ToPrimitive(t,3);return function IsSymbol(t){return"symbol"==typeof t}(n)?n:function ToString(t){return""+t}(n)}function IsArray(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function IsCallable(t){return"function"==typeof t}function IsConstructor(t){return"function"==typeof t}function GetMethod(t,n){var r=t[n];if(null!=r){if(!IsCallable(r))throw new TypeError;return r}}function IteratorStep(t){var n=t.next();return!n.done&&n}function IteratorClose(t){var n=t.return;n&&n.call(t)}function OrdinaryGetPrototypeOf(t){var n=Object.getPrototypeOf(t);if("function"!=typeof t||t===f)return n;if(n!==f)return n;var r=t.prototype,o=r&&Object.getPrototypeOf(r);if(null==o||o===Object.prototype)return n;var i=o.constructor;return"function"!=typeof i||i===t?n:i}function MakeDictionary(t){return t.__=void 0,delete t.__,t}n("decorate",(function decorate(t,n,r,o){if(IsUndefined(r)){if(!IsArray(t))throw new TypeError;if(!IsConstructor(n))throw new TypeError;return function DecorateConstructor(t,n){for(var r=t.length-1;r>=0;--r){var o=(0,t[r])(n);if(!IsUndefined(o)&&!IsNull(o)){if(!IsConstructor(o))throw new TypeError;n=o}}return n}(t,n)}if(!IsArray(t))throw new TypeError;if(!IsObject(n))throw new TypeError;if(!IsObject(o)&&!IsUndefined(o)&&!IsNull(o))throw new TypeError;return IsNull(o)&&(o=void 0),function DecorateProperty(t,n,r,o){for(var i=t.length-1;i>=0;--i){var a=(0,t[i])(n,r,o);if(!IsUndefined(a)&&!IsNull(a)){if(!IsObject(a))throw new TypeError;o=a}}return o}(t,n,r=ToPropertyKey(r),o)})),n("metadata",(function metadata(t,n){return function decorator(r,o){if(!IsObject(r))throw new TypeError;if(!IsUndefined(o)&&!function IsPropertyKey(t){switch(Type(t)){case 3:case 4:return!0;default:return!1}}(o))throw new TypeError;OrdinaryDefineOwnMetadata(t,n,r,o)}})),n("defineMetadata",(function defineMetadata(t,n,r,o){if(!IsObject(r))throw new TypeError;return IsUndefined(o)||(o=ToPropertyKey(o)),OrdinaryDefineOwnMetadata(t,n,r,o)})),n("hasMetadata",(function hasMetadata(t,n,r){if(!IsObject(n))throw new TypeError;return IsUndefined(r)||(r=ToPropertyKey(r)),function OrdinaryHasMetadata(t,n,r){if(OrdinaryHasOwnMetadata(t,n,r))return!0;var o=OrdinaryGetPrototypeOf(n);return!IsNull(o)&&OrdinaryHasMetadata(t,o,r)}(t,n,r)})),n("hasOwnMetadata",(function hasOwnMetadata(t,n,r){if(!IsObject(n))throw new TypeError;return IsUndefined(r)||(r=ToPropertyKey(r)),OrdinaryHasOwnMetadata(t,n,r)})),n("getMetadata",(function getMetadata(t,n,r){if(!IsObject(n))throw new TypeError;return IsUndefined(r)||(r=ToPropertyKey(r)),function OrdinaryGetMetadata(t,n,r){if(OrdinaryHasOwnMetadata(t,n,r))return OrdinaryGetOwnMetadata(t,n,r);var o=OrdinaryGetPrototypeOf(n);return IsNull(o)?void 0:OrdinaryGetMetadata(t,o,r)}(t,n,r)})),n("getOwnMetadata",(function getOwnMetadata(t,n,r){if(!IsObject(n))throw new TypeError;return IsUndefined(r)||(r=ToPropertyKey(r)),OrdinaryGetOwnMetadata(t,n,r)})),n("getMetadataKeys",(function getMetadataKeys(t,n){if(!IsObject(t))throw new TypeError;return IsUndefined(n)||(n=ToPropertyKey(n)),function OrdinaryMetadataKeys(t,n){var r=OrdinaryOwnMetadataKeys(t,n),o=OrdinaryGetPrototypeOf(t);if(null===o)return r;var i=OrdinaryMetadataKeys(o,n);if(i.length<=0)return r;if(r.length<=0)return i;for(var a=new y,c=[],u=0,l=r;u<l.length;u++){var p=l[u];a.has(p)||(a.add(p),c.push(p))}for(var f=0,h=i;f<h.length;f++){p=h[f];a.has(p)||(a.add(p),c.push(p))}return c}(t,n)})),n("getOwnMetadataKeys",(function getOwnMetadataKeys(t,n){if(!IsObject(t))throw new TypeError;return IsUndefined(n)||(n=ToPropertyKey(n)),OrdinaryOwnMetadataKeys(t,n)})),n("deleteMetadata",(function deleteMetadata(t,n,r){if(!IsObject(n))throw new TypeError;IsUndefined(r)||(r=ToPropertyKey(r));var o=GetOrCreateMetadataMap(n,r,!1);if(IsUndefined(o))return!1;if(!o.delete(t))return!1;if(o.size>0)return!0;var i=m.get(n);return i.delete(r),i.size>0||m.delete(n),!0}))}(a)}()}(r||(r={}))}).call(this,r(12),r(5))},function(t,n,r){(function(t,n){!function(t,r){"use strict";if(!t.setImmediate){var o,i=1,a={},c=!1,u=t.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(t);l=l&&l.setTimeout?l:t,"[object process]"==={}.toString.call(t.process)?function installNextTickImplementation(){o=function(t){n.nextTick((function(){runIfPresent(t)}))}}():!function canUsePostMessage(){if(t.postMessage&&!t.importScripts){var n=!0,r=t.onmessage;return t.onmessage=function(){n=!1},t.postMessage("","*"),t.onmessage=r,n}}()?t.MessageChannel?function installMessageChannelImplementation(){var t=new MessageChannel;t.port1.onmessage=function(t){runIfPresent(t.data)},o=function(n){t.port2.postMessage(n)}}():u&&"onreadystatechange"in u.createElement("script")?function installReadyStateChangeImplementation(){var t=u.documentElement;o=function(n){var r=u.createElement("script");r.onreadystatechange=function(){runIfPresent(n),r.onreadystatechange=null,t.removeChild(r),r=null},t.appendChild(r)}}():function installSetTimeoutImplementation(){o=function(t){setTimeout(runIfPresent,0,t)}}():function installPostMessageImplementation(){var n="setImmediate$"+Math.random()+"$",onGlobalMessage=function(r){r.source===t&&"string"==typeof r.data&&0===r.data.indexOf(n)&&runIfPresent(+r.data.slice(n.length))};t.addEventListener?t.addEventListener("message",onGlobalMessage,!1):t.attachEvent("onmessage",onGlobalMessage),o=function(r){t.postMessage(n+r,"*")}}(),l.setImmediate=function setImmediate(t){"function"!=typeof t&&(t=new Function(""+t));for(var n=new Array(arguments.length-1),r=0;r<n.length;r++)n[r]=arguments[r+1];var c={callback:t,args:n};return a[i]=c,o(i),i++},l.clearImmediate=clearImmediate}function clearImmediate(t){delete a[t]}function runIfPresent(t){if(c)setTimeout(runIfPresent,0,t);else{var n=a[t];if(n){c=!0;try{!function run(t){var n=t.callback,r=t.args;switch(r.length){case 0:n();break;case 1:n(r[0]);break;case 2:n(r[0],r[1]);break;case 3:n(r[0],r[1],r[2]);break;default:n.apply(void 0,r)}}(n)}finally{clearImmediate(t),c=!1}}}}}("undefined"==typeof self?void 0===t?this:t:self)}).call(this,r(5),r(12))},function(t,n,r){"use strict";var o,i=this&&this.__extends||(o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(t,n)},function(t,n){function __(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)});Object.defineProperty(n,"__esModule",{value:!0});var a,c=r(59),u=r(19),l=r(30),p=r(29);!function(t){t[t.Sync=0]="Sync",t[t.Async=1]="Async",t[t.Queued=2]="Queued"}(a=n.EventType||(n.EventType={}));var f=function(){function AnyEvent(t){this._events=[],t&&t.monitorAttach&&(this.evtFirstAttached=new h,this.evtLastDetached=new h)}return AnyEvent.prototype.attach=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=a.Sync;t.length>0&&"number"==typeof t[0]&&(r=t.shift());var o,i,c,u=this;"function"==typeof t[0]||t[0]&&"object"==typeof t[0]&&"function"==typeof t[0].post?("function"==typeof t[0]?o=t[0]:c=t[0],i=t[1]):(u=t[0],o=t[1],i=t[2]),this._attach(r,u,o,c,i,!1)},AnyEvent.prototype.once=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=a.Sync;t.length>0&&"number"==typeof t[0]&&(r=t.shift());var o,i,c,u=this;"function"==typeof t[0]||t[0]&&"object"==typeof t[0]&&"function"==typeof t[0].post?("function"==typeof t[0]?o=t[0]:c=t[0],i=t[1]):(u=t[0],o=t[1],i=t[2]),this._attach(r,u,o,c,i,!0)},AnyEvent.prototype._attach=function(t,n,r,o,i,f){var h,d=this.evtFirstAttached?this.listenerCount():0;switch(t){case a.Sync:for(var y=0,m=this._events;y<m.length;y++){(w=m[y])instanceof u.SyncEvent&&(h=w)}h||(h=new u.SyncEvent,this._events.push(h));break;case a.Async:for(var v=0,g=this._events;v<g.length;v++){(w=g[v])instanceof l.AsyncEvent&&c.shallowEquals(w.options,i)&&(h=w)}h||(h=new l.AsyncEvent(i),this._events.push(h));break;case a.Queued:for(var _=0,b=this._events;_<b.length;_++){var w;(w=b[_])instanceof p.QueuedEvent&&c.shallowEquals(w.options,i)&&(h=w)}h||(h=new p.QueuedEvent(i),this._events.push(h));break;default:throw new Error("unknown EventType")}f?o?h.once(o):h.once(n,r):o?h.attach(o):h.attach(n,r),this.evtFirstAttached&&0===d&&this.evtFirstAttached.post()},AnyEvent.prototype.attachSync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.unshift(a.Sync),this.attach.apply(this,t)},AnyEvent.prototype.onceSync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.unshift(a.Sync),this.once.apply(this,t)},AnyEvent.prototype.attachAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.unshift(a.Async),this.attach.apply(this,t)},AnyEvent.prototype.onceAsync=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.unshift(a.Async),this.once.apply(this,t)},AnyEvent.prototype.attachQueued=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.unshift(a.Queued),this.attach.apply(this,t)},AnyEvent.prototype.onceQueued=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];t.unshift(a.Queued),this.once.apply(this,t)},AnyEvent.prototype.detach=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=this.evtLastDetached?this.listenerCount():0,o=0;o<this._events.length;++o)this._events[o].detach.apply(this._events[o],t);this.evtLastDetached&&r>0&&0===this.listenerCount()&&this.evtLastDetached.post()},AnyEvent.prototype.post=function(t){for(var n=[],r=0;r<this._events.length;++r)n.push(this._events[r]);for(r=0;r<n.length;++r)n[r].post(t)},AnyEvent.prototype.listenerCount=function(){for(var t=0,n=0;n<this._events.length;++n)t+=this._events[n].listenerCount();return t},AnyEvent}();n.AnyEvent=f;var h=function(t){function VoidAnyEvent(){return null!==t&&t.apply(this,arguments)||this}return i(VoidAnyEvent,t),VoidAnyEvent.prototype.post=function(){t.prototype.post.call(this,void 0)},VoidAnyEvent}(f);n.VoidAnyEvent=h;var d=function(t){function ErrorAnyEvent(){return null!==t&&t.apply(this,arguments)||this}return i(ErrorAnyEvent,t),ErrorAnyEvent.prototype.post=function(n){if(0===this.listenerCount())throw new Error("error event posted while no listeners attached. Error: "+n.message);t.prototype.post.call(this,n)},ErrorAnyEvent}(f);n.ErrorAnyEvent=d},function(t,n,r){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.shallowEquals=function shallowEquals(t,n){if(t===n)return!0;if(typeof t!=typeof n)return!1;switch(typeof t){case"boolean":case"number":case"string":case"function":case"symbol":case"undefined":return!1;case"object":if(null===t||null===n)return!1;if(Array.isArray(t)||Array.isArray(n)){if(!Array.isArray(t)||!Array.isArray(n))return!1;if(t.length!==n.length)return!1;for(var r=0;r<t.length;++r)if(t[r]!==n[r])return!1;return!0}var o=[],i=[];for(var a in t)t.hasOwnProperty(a)&&o.push(a);for(var c in n)n.hasOwnProperty(c)&&i.push(c);if(o.sort(),i.sort(),o.join(",")!==i.join(","))return!1;for(r=0;r<o.length;++r)if(t[o[r]]!==n[o[r]])return!1;return!0;default:return!1}}},function(t,n,r){var o=r(61),i=r(62),a=i;a.v1=o,a.v4=i,t.exports=a},function(t,n,r){var o,i,a=r(31),c=r(32),u=0,l=0;t.exports=function v1(t,n,r){var p=n&&r||0,f=n||[],h=(t=t||{}).node||o,d=void 0!==t.clockseq?t.clockseq:i;if(null==h||null==d){var y=a();null==h&&(h=o=[1|y[0],y[1],y[2],y[3],y[4],y[5]]),null==d&&(d=i=16383&(y[6]<<8|y[7]))}var m=void 0!==t.msecs?t.msecs:(new Date).getTime(),v=void 0!==t.nsecs?t.nsecs:l+1,g=m-u+(v-l)/1e4;if(g<0&&void 0===t.clockseq&&(d=d+1&16383),(g<0||m>u)&&void 0===t.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");u=m,l=v,i=d;var _=(1e4*(268435455&(m+=122192928e5))+v)%4294967296;f[p++]=_>>>24&255,f[p++]=_>>>16&255,f[p++]=_>>>8&255,f[p++]=255&_;var b=m/4294967296*1e4&268435455;f[p++]=b>>>8&255,f[p++]=255&b,f[p++]=b>>>24&15|16,f[p++]=b>>>16&255,f[p++]=d>>>8|128,f[p++]=255&d;for(var w=0;w<6;++w)f[p+w]=h[w];return n||c(f)}},function(t,n,r){var o=r(31),i=r(32);t.exports=function v4(t,n,r){var a=n&&r||0;"string"==typeof t&&(n="binary"===t?new Array(16):null,t=null);var c=(t=t||{}).random||(t.rng||o)();if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,n)for(var u=0;u<16;++u)n[a+u]=c[u];return n||i(c)}},function(t,n,r){"use strict";n.byteLength=function byteLength(t){var n=getLens(t),r=n[0],o=n[1];return 3*(r+o)/4-o},n.toByteArray=function toByteArray(t){var n,r,o=getLens(t),c=o[0],u=o[1],l=new a(function _byteLength(t,n,r){return 3*(n+r)/4-r}(0,c,u)),p=0,f=u>0?c-4:c;for(r=0;r<f;r+=4)n=i[t.charCodeAt(r)]<<18|i[t.charCodeAt(r+1)]<<12|i[t.charCodeAt(r+2)]<<6|i[t.charCodeAt(r+3)],l[p++]=n>>16&255,l[p++]=n>>8&255,l[p++]=255&n;2===u&&(n=i[t.charCodeAt(r)]<<2|i[t.charCodeAt(r+1)]>>4,l[p++]=255&n);1===u&&(n=i[t.charCodeAt(r)]<<10|i[t.charCodeAt(r+1)]<<4|i[t.charCodeAt(r+2)]>>2,l[p++]=n>>8&255,l[p++]=255&n);return l},n.fromByteArray=function fromByteArray(t){for(var n,r=t.length,i=r%3,a=[],c=0,u=r-i;c<u;c+=16383)a.push(encodeChunk(t,c,c+16383>u?u:c+16383));1===i?(n=t[r-1],a.push(o[n>>2]+o[n<<4&63]+"==")):2===i&&(n=(t[r-2]<<8)+t[r-1],a.push(o[n>>10]+o[n>>4&63]+o[n<<2&63]+"="));return a.join("")};for(var o=[],i=[],a="undefined"!=typeof Uint8Array?Uint8Array:Array,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",u=0,l=c.length;u<l;++u)o[u]=c[u],i[c.charCodeAt(u)]=u;function getLens(t){var n=t.length;if(n%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=n),[r,r===n?0:4-r%4]}function encodeChunk(t,n,r){for(var i,a,c=[],u=n;u<r;u+=3)i=(t[u]<<16&16711680)+(t[u+1]<<8&65280)+(255&t[u+2]),c.push(o[(a=i)>>18&63]+o[a>>12&63]+o[a>>6&63]+o[63&a]);return c.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(t,n){n.read=function(t,n,r,o,i){var a,c,u=8*i-o-1,l=(1<<u)-1,p=l>>1,f=-7,h=r?i-1:0,d=r?-1:1,y=t[n+h];for(h+=d,a=y&(1<<-f)-1,y>>=-f,f+=u;f>0;a=256*a+t[n+h],h+=d,f-=8);for(c=a&(1<<-f)-1,a>>=-f,f+=o;f>0;c=256*c+t[n+h],h+=d,f-=8);if(0===a)a=1-p;else{if(a===l)return c?NaN:1/0*(y?-1:1);c+=Math.pow(2,o),a-=p}return(y?-1:1)*c*Math.pow(2,a-o)},n.write=function(t,n,r,o,i,a){var c,u,l,p=8*a-i-1,f=(1<<p)-1,h=f>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,y=o?0:a-1,m=o?1:-1,v=n<0||0===n&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(u=isNaN(n)?1:0,c=f):(c=Math.floor(Math.log(n)/Math.LN2),n*(l=Math.pow(2,-c))<1&&(c--,l*=2),(n+=c+h>=1?d/l:d*Math.pow(2,1-h))*l>=2&&(c++,l/=2),c+h>=f?(u=0,c=f):c+h>=1?(u=(n*l-1)*Math.pow(2,i),c+=h):(u=n*Math.pow(2,h-1)*Math.pow(2,i),c=0));i>=8;t[r+y]=255&u,y+=m,u/=256,i-=8);for(c=c<<i|u,p+=i;p>0;t[r+y]=255&c,y+=m,c/=256,p-=8);t[r+y-m]|=128*v}},function(t,n){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,n,r){"use strict";function JSZip(){if(!(this instanceof JSZip))return new JSZip;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files={},this.comment=null,this.root="",this.clone=function(){var t=new JSZip;for(var n in this)"function"!=typeof this[n]&&(t[n]=this[n]);return t}}JSZip.prototype=r(67),JSZip.prototype.loadAsync=r(99),JSZip.support=r(6),JSZip.defaults=r(41),JSZip.version="3.2.0",JSZip.loadAsync=function(t,n){return(new JSZip).loadAsync(t,n)},JSZip.external=r(14),t.exports=JSZip},function(t,n,r){"use strict";var o=r(10),i=r(1),a=r(4),c=r(40),u=r(41),l=r(26),p=r(85),f=r(86),h=r(18),d=r(98),fileAdd=function(t,n,r){var o,c=i.getTypeOf(n),f=i.extend(r||{},u);f.date=f.date||new Date,null!==f.compression&&(f.compression=f.compression.toUpperCase()),"string"==typeof f.unixPermissions&&(f.unixPermissions=parseInt(f.unixPermissions,8)),f.unixPermissions&&16384&f.unixPermissions&&(f.dir=!0),f.dosPermissions&&16&f.dosPermissions&&(f.dir=!0),f.dir&&(t=forceTrailingSlash(t)),f.createFolders&&(o=parentFolder(t))&&folderAdd.call(this,o,!0);var y="string"===c&&!1===f.binary&&!1===f.base64;r&&void 0!==r.binary||(f.binary=!y),(n instanceof l&&0===n.uncompressedSize||f.dir||!n||0===n.length)&&(f.base64=!1,f.binary=!0,n="",f.compression="STORE",c="string");var m=null;m=n instanceof l||n instanceof a?n:h.isNode&&h.isStream(n)?new d(t,n):i.prepareContent(t,n,f.binary,f.optimizedBinaryString,f.base64);var v=new p(t,m,f);this.files[t]=v},parentFolder=function(t){"/"===t.slice(-1)&&(t=t.substring(0,t.length-1));var n=t.lastIndexOf("/");return n>0?t.substring(0,n):""},forceTrailingSlash=function(t){return"/"!==t.slice(-1)&&(t+="/"),t},folderAdd=function(t,n){return n=void 0!==n?n:u.createFolders,t=forceTrailingSlash(t),this.files[t]||fileAdd.call(this,t,null,{dir:!0,createFolders:n}),this.files[t]};function isRegExp(t){return"[object RegExp]"===Object.prototype.toString.call(t)}var y={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(t){var n,r,o;for(n in this.files)this.files.hasOwnProperty(n)&&(o=this.files[n],(r=n.slice(this.root.length,n.length))&&n.slice(0,this.root.length)===this.root&&t(r,o))},filter:function(t){var n=[];return this.forEach((function(r,o){t(r,o)&&n.push(o)})),n},file:function(t,n,r){if(1===arguments.length){if(isRegExp(t)){var o=t;return this.filter((function(t,n){return!n.dir&&o.test(t)}))}var i=this.files[this.root+t];return i&&!i.dir?i:null}return(t=this.root+t,fileAdd.call(this,t,n,r),this)},folder:function(t){if(!t)return this;if(isRegExp(t))return this.filter((function(n,r){return r.dir&&t.test(n)}));var n=this.root+t,r=folderAdd.call(this,n),o=this.clone();return o.root=r.name,o},remove:function(t){t=this.root+t;var n=this.files[t];if(n||("/"!==t.slice(-1)&&(t+="/"),n=this.files[t]),n&&!n.dir)delete this.files[t];else for(var r=this.filter((function(n,r){return r.name.slice(0,t.length)===t})),o=0;o<r.length;o++)delete this.files[r[o].name];return this},generate:function(t){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(t){var n,r={};try{if((r=i.extend(t||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:o.utf8encode})).type=r.type.toLowerCase(),r.compression=r.compression.toUpperCase(),"binarystring"===r.type&&(r.type="string"),!r.type)throw new Error("No output type specified.");i.checkSupport(r.type),"darwin"!==r.platform&&"freebsd"!==r.platform&&"linux"!==r.platform&&"sunos"!==r.platform||(r.platform="UNIX"),"win32"===r.platform&&(r.platform="DOS");var u=r.comment||this.comment||"";n=f.generateWorker(this,r,u)}catch(t){(n=new a("error")).error(t)}return new c(n,r.type||"string",r.mimeType)},generateAsync:function(t,n){return this.generateInternalStream(t).accumulate(n)},generateNodeStream:function(t,n){return(t=t||{}).type||(t.type="nodebuffer"),this.generateInternalStream(t).toNodejsStream(n)}};t.exports=y},function(t,n,r){t.exports=Stream;var o=r(22).EventEmitter;function Stream(){o.call(this)}r(11)(Stream,o),Stream.Readable=r(23),Stream.Writable=r(76),Stream.Duplex=r(77),Stream.Transform=r(78),Stream.PassThrough=r(79),Stream.Stream=Stream,Stream.prototype.pipe=function(t,n){var r=this;function ondata(n){t.writable&&!1===t.write(n)&&r.pause&&r.pause()}function ondrain(){r.readable&&r.resume&&r.resume()}r.on("data",ondata),t.on("drain",ondrain),t._isStdio||n&&!1===n.end||(r.on("end",onend),r.on("close",onclose));var i=!1;function onend(){i||(i=!0,t.end())}function onclose(){i||(i=!0,"function"==typeof t.destroy&&t.destroy())}function onerror(t){if(cleanup(),0===o.listenerCount(this,"error"))throw t}function cleanup(){r.removeListener("data",ondata),t.removeListener("drain",ondrain),r.removeListener("end",onend),r.removeListener("close",onclose),r.removeListener("error",onerror),t.removeListener("error",onerror),r.removeListener("end",cleanup),r.removeListener("close",cleanup),t.removeListener("close",cleanup)}return r.on("error",onerror),t.on("error",onerror),r.on("end",cleanup),r.on("close",cleanup),t.on("close",cleanup),t.emit("pipe",r),t}},function(t,n){var r={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==r.call(t)}},function(t,n){},function(t,n,r){"use strict";var o=r(24).Buffer,i=r(72);t.exports=function(){function BufferList(){!function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,BufferList),this.head=null,this.tail=null,this.length=0}return BufferList.prototype.push=function push(t){var n={data:t,next:null};this.length>0?this.tail.next=n:this.head=n,this.tail=n,++this.length},BufferList.prototype.unshift=function unshift(t){var n={data:t,next:this.head};0===this.length&&(this.tail=n),this.head=n,++this.length},BufferList.prototype.shift=function shift(){if(0!==this.length){var t=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,t}},BufferList.prototype.clear=function clear(){this.head=this.tail=null,this.length=0},BufferList.prototype.join=function join(t){if(0===this.length)return"";for(var n=this.head,r=""+n.data;n=n.next;)r+=t+n.data;return r},BufferList.prototype.concat=function concat(t){if(0===this.length)return o.alloc(0);if(1===this.length)return this.head.data;for(var n,r,i,a=o.allocUnsafe(t>>>0),c=this.head,u=0;c;)n=c.data,r=a,i=u,n.copy(r,i),u+=c.data.length,c=c.next;return a},BufferList}(),i&&i.inspect&&i.inspect.custom&&(t.exports.prototype[i.inspect.custom]=function(){var t=i.inspect({length:this.length});return this.constructor.name+" "+t})},function(t,n){},function(t,n,r){(function(n){function config(t){try{if(!n.localStorage)return!1}catch(t){return!1}var r=n.localStorage[t];return null!=r&&"true"===String(r).toLowerCase()}t.exports=function deprecate(t,n){if(config("noDeprecation"))return t;var r=!1;return function deprecated(){if(!r){if(config("throwDeprecation"))throw new Error(n);config("traceDeprecation")?console.trace(n):console.warn(n),r=!0}return t.apply(this,arguments)}}}).call(this,r(5))},function(t,n,r){var o=r(8),i=o.Buffer;function copyProps(t,n){for(var r in t)n[r]=t[r]}function SafeBuffer(t,n,r){return i(t,n,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=o:(copyProps(o,n),n.Buffer=SafeBuffer),SafeBuffer.prototype=Object.create(i.prototype),copyProps(i,SafeBuffer),SafeBuffer.from=function(t,n,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,n,r)},SafeBuffer.alloc=function(t,n,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var o=i(t);return void 0!==n?"string"==typeof r?o.fill(n,r):o.fill(n):o.fill(0),o},SafeBuffer.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},SafeBuffer.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return o.SlowBuffer(t)}},function(t,n,r){"use strict";t.exports=PassThrough;var o=r(38),i=Object.create(r(13));function PassThrough(t){if(!(this instanceof PassThrough))return new PassThrough(t);o.call(this,t)}i.inherits=r(11),i.inherits(PassThrough,o),PassThrough.prototype._transform=function(t,n,r){r(null,t)}},function(t,n,r){t.exports=r(25)},function(t,n,r){t.exports=r(9)},function(t,n,r){t.exports=r(23).Transform},function(t,n,r){t.exports=r(23).PassThrough},function(t,n,r){"use strict";(function(n){t.exports="function"==typeof n?n:function setImmediate(){var t=[].slice.apply(arguments);t.splice(1,0,0),setTimeout.apply(null,t)}}).call(this,r(21).setImmediate)},function(t,n,r){"use strict";var o=r(82);function INTERNAL(){}var i={},a=["REJECTED"],c=["FULFILLED"],u=["PENDING"];function Promise(t){if("function"!=typeof t)throw new TypeError("resolver must be a function");this.state=u,this.queue=[],this.outcome=void 0,t!==INTERNAL&&safelyResolveThenable(this,t)}function QueueItem(t,n,r){this.promise=t,"function"==typeof n&&(this.onFulfilled=n,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function unwrap(t,n,r){o((function(){var o;try{o=n(r)}catch(n){return i.reject(t,n)}o===t?i.reject(t,new TypeError("Cannot resolve promise with itself")):i.resolve(t,o)}))}function getThen(t){var n=t&&t.then;if(t&&("object"==typeof t||"function"==typeof t)&&"function"==typeof n)return function appyThen(){n.apply(t,arguments)}}function safelyResolveThenable(t,n){var r=!1;function onError(n){r||(r=!0,i.reject(t,n))}function onSuccess(n){r||(r=!0,i.resolve(t,n))}var o=tryCatch((function tryToUnwrap(){n(onSuccess,onError)}));"error"===o.status&&onError(o.value)}function tryCatch(t,n){var r={};try{r.value=t(n),r.status="success"}catch(t){r.status="error",r.value=t}return r}t.exports=Promise,Promise.prototype.finally=function(t){if("function"!=typeof t)return this;var n=this.constructor;return this.then((function resolve(r){return n.resolve(t()).then((function yes(){return r}))}),(function reject(r){return n.resolve(t()).then((function no(){throw r}))}))},Promise.prototype.catch=function(t){return this.then(null,t)},Promise.prototype.then=function(t,n){if("function"!=typeof t&&this.state===c||"function"!=typeof n&&this.state===a)return this;var r=new this.constructor(INTERNAL);this.state!==u?unwrap(r,this.state===c?t:n,this.outcome):this.queue.push(new QueueItem(r,t,n));return r},QueueItem.prototype.callFulfilled=function(t){i.resolve(this.promise,t)},QueueItem.prototype.otherCallFulfilled=function(t){unwrap(this.promise,this.onFulfilled,t)},QueueItem.prototype.callRejected=function(t){i.reject(this.promise,t)},QueueItem.prototype.otherCallRejected=function(t){unwrap(this.promise,this.onRejected,t)},i.resolve=function(t,n){var r=tryCatch(getThen,n);if("error"===r.status)return i.reject(t,r.value);var o=r.value;if(o)safelyResolveThenable(t,o);else{t.state=c,t.outcome=n;for(var a=-1,u=t.queue.length;++a<u;)t.queue[a].callFulfilled(n)}return t},i.reject=function(t,n){t.state=a,t.outcome=n;for(var r=-1,o=t.queue.length;++r<o;)t.queue[r].callRejected(n);return t},Promise.resolve=function resolve(t){if(t instanceof this)return t;return i.resolve(new this(INTERNAL),t)},Promise.reject=function reject(t){var n=new this(INTERNAL);return i.reject(n,t)},Promise.all=function all(t){var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,o=!1;if(!r)return this.resolve([]);var a=new Array(r),c=0,u=-1,l=new this(INTERNAL);for(;++u<r;)allResolver(t[u],u);return l;function allResolver(t,u){n.resolve(t).then((function resolveFromAll(t){a[u]=t,++c!==r||o||(o=!0,i.resolve(l,a))}),(function(t){o||(o=!0,i.reject(l,t))}))}},Promise.race=function race(t){var n=this;if("[object Array]"!==Object.prototype.toString.call(t))return this.reject(new TypeError("must be an array"));var r=t.length,o=!1;if(!r)return this.resolve([]);var a=-1,c=new this(INTERNAL);for(;++a<r;)u=t[a],n.resolve(u).then((function(t){o||(o=!0,i.resolve(c,t))}),(function(t){o||(o=!0,i.reject(c,t))}));var u;return c}},function(t,n,r){"use strict";(function(n){var r,o,i=n.MutationObserver||n.WebKitMutationObserver;if(i){var a=0,c=new i(nextTick),u=n.document.createTextNode("");c.observe(u,{characterData:!0}),r=function(){u.data=a=++a%2}}else if(n.setImmediate||void 0===n.MessageChannel)r="document"in n&&"onreadystatechange"in n.document.createElement("script")?function(){var t=n.document.createElement("script");t.onreadystatechange=function(){nextTick(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},n.document.documentElement.appendChild(t)}:function(){setTimeout(nextTick,0)};else{var l=new n.MessageChannel;l.port1.onmessage=nextTick,r=function(){l.port2.postMessage(0)}}var p=[];function nextTick(){var t,n;o=!0;for(var r=p.length;r;){for(n=p,p=[],t=-1;++t<r;)n[t]();r=p.length}o=!1}t.exports=function immediate(t){1!==p.push(t)||o||r()}}).call(this,r(5))},function(t,n,r){"use strict";var o=r(4),i=r(1);function ConvertWorker(t){o.call(this,"ConvertWorker to "+t),this.destType=t}i.inherits(ConvertWorker,o),ConvertWorker.prototype.processChunk=function(t){this.push({data:i.transformTo(this.destType,t.data),meta:t.meta})},t.exports=ConvertWorker},function(t,n,r){"use strict";var o=r(33).Readable;function NodejsStreamOutputAdapter(t,n,r){o.call(this,n),this._helper=t;var i=this;t.on("data",(function(t,n){i.push(t)||i._helper.pause(),r&&r(n)})).on("error",(function(t){i.emit("error",t)})).on("end",(function(){i.push(null)}))}r(1).inherits(NodejsStreamOutputAdapter,o),NodejsStreamOutputAdapter.prototype._read=function(){this._helper.resume()},t.exports=NodejsStreamOutputAdapter},function(t,n,r){"use strict";var o=r(40),i=r(42),a=r(10),c=r(26),u=r(4),ZipObject=function(t,n,r){this.name=t,this.dir=r.dir,this.date=r.date,this.comment=r.comment,this.unixPermissions=r.unixPermissions,this.dosPermissions=r.dosPermissions,this._data=n,this._dataBinary=r.binary,this.options={compression:r.compression,compressionOptions:r.compressionOptions}};ZipObject.prototype={internalStream:function(t){var n=null,r="string";try{if(!t)throw new Error("No output type specified.");var i="string"===(r=t.toLowerCase())||"text"===r;"binarystring"!==r&&"text"!==r||(r="string"),n=this._decompressWorker();var c=!this._dataBinary;c&&!i&&(n=n.pipe(new a.Utf8EncodeWorker)),!c&&i&&(n=n.pipe(new a.Utf8DecodeWorker))}catch(t){(n=new u("error")).error(t)}return new o(n,r,"")},async:function(t,n){return this.internalStream(t).accumulate(n)},nodeStream:function(t,n){return this.internalStream(t||"nodebuffer").toNodejsStream(n)},_compressWorker:function(t,n){if(this._data instanceof c&&this._data.compression.magic===t.magic)return this._data.getCompressedWorker();var r=this._decompressWorker();return this._dataBinary||(r=r.pipe(new a.Utf8EncodeWorker)),c.createWorkerFrom(r,t,n)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof u?this._data:new i(this._data)}};for(var l=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],removedFn=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<l.length;p++)ZipObject.prototype[l[p]]=removedFn;t.exports=ZipObject},function(t,n,r){"use strict";var o=r(45),i=r(97);n.generateWorker=function(t,n,r){var a=new i(n.streamFiles,r,n.platform,n.encodeFileName),c=0;try{t.forEach((function(t,r){c++;var i=function(t,n){var r=t||n,i=o[r];if(!i)throw new Error(r+" is not a valid compression method !");return i}(r.options.compression,n.compression),u=r.options.compressionOptions||n.compressionOptions||{},l=r.dir,p=r.date;r._compressWorker(i,u).withStreamInfo("file",{name:t,dir:l,date:p,comment:r.comment||"",unixPermissions:r.unixPermissions,dosPermissions:r.dosPermissions}).pipe(a)})),a.entriesCount=c}catch(t){a.error(t)}return a}},function(t,n,r){"use strict";var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,i=r(88),a=r(1),c=r(4),u=o?"uint8array":"array";function FlateWorker(t,n){c.call(this,"FlateWorker/"+t),this._pako=null,this._pakoAction=t,this._pakoOptions=n,this.meta={}}n.magic="\b\0",a.inherits(FlateWorker,c),FlateWorker.prototype.processChunk=function(t){this.meta=t.meta,null===this._pako&&this._createPako(),this._pako.push(a.transformTo(u,t.data),!1)},FlateWorker.prototype.flush=function(){c.prototype.flush.call(this),null===this._pako&&this._createPako(),this._pako.push([],!0)},FlateWorker.prototype.cleanUp=function(){c.prototype.cleanUp.call(this),this._pako=null},FlateWorker.prototype._createPako=function(){this._pako=new i[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var t=this;this._pako.onData=function(n){t.push({data:n,meta:t.meta})}},n.compressWorker=function(t){return new FlateWorker("Deflate",t)},n.uncompressWorker=function(){return new FlateWorker("Inflate",{})}},function(t,n,r){"use strict";var o={};(0,r(7).assign)(o,r(89),r(92),r(50)),t.exports=o},function(t,n,r){"use strict";var o=r(90),i=r(7),a=r(48),c=r(28),u=r(49),l=Object.prototype.toString;function Deflate(t){if(!(this instanceof Deflate))return new Deflate(t);this.options=i.assign({level:-1,method:8,chunkSize:16384,windowBits:15,memLevel:8,strategy:0,to:""},t||{});var n=this.options;n.raw&&n.windowBits>0?n.windowBits=-n.windowBits:n.gzip&&n.windowBits>0&&n.windowBits<16&&(n.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new u,this.strm.avail_out=0;var r=o.deflateInit2(this.strm,n.level,n.method,n.windowBits,n.memLevel,n.strategy);if(0!==r)throw new Error(c[r]);if(n.header&&o.deflateSetHeader(this.strm,n.header),n.dictionary){var p;if(p="string"==typeof n.dictionary?a.string2buf(n.dictionary):"[object ArrayBuffer]"===l.call(n.dictionary)?new Uint8Array(n.dictionary):n.dictionary,0!==(r=o.deflateSetDictionary(this.strm,p)))throw new Error(c[r]);this._dict_set=!0}}function deflate(t,n){var r=new Deflate(n);if(r.push(t,!0),r.err)throw r.msg||c[r.err];return r.result}Deflate.prototype.push=function(t,n){var r,c,u=this.strm,p=this.options.chunkSize;if(this.ended)return!1;c=n===~~n?n:!0===n?4:0,"string"==typeof t?u.input=a.string2buf(t):"[object ArrayBuffer]"===l.call(t)?u.input=new Uint8Array(t):u.input=t,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new i.Buf8(p),u.next_out=0,u.avail_out=p),1!==(r=o.deflate(u,c))&&0!==r)return this.onEnd(r),this.ended=!0,!1;0!==u.avail_out&&(0!==u.avail_in||4!==c&&2!==c)||("string"===this.options.to?this.onData(a.buf2binstring(i.shrinkBuf(u.output,u.next_out))):this.onData(i.shrinkBuf(u.output,u.next_out)))}while((u.avail_in>0||0===u.avail_out)&&1!==r);return 4===c?(r=o.deflateEnd(this.strm),this.onEnd(r),this.ended=!0,0===r):2!==c||(this.onEnd(0),u.avail_out=0,!0)},Deflate.prototype.onData=function(t){this.chunks.push(t)},Deflate.prototype.onEnd=function(t){0===t&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Deflate=Deflate,n.deflate=deflate,n.deflateRaw=function deflateRaw(t,n){return(n=n||{}).raw=!0,deflate(t,n)},n.gzip=function gzip(t,n){return(n=n||{}).gzip=!0,deflate(t,n)}},function(t,n,r){"use strict";var o,i=r(7),a=r(91),c=r(46),u=r(47),l=r(28);function err(t,n){return t.msg=l[n],n}function rank(t){return(t<<1)-(t>4?9:0)}function zero(t){for(var n=t.length;--n>=0;)t[n]=0}function flush_pending(t){var n=t.state,r=n.pending;r>t.avail_out&&(r=t.avail_out),0!==r&&(i.arraySet(t.output,n.pending_buf,n.pending_out,r,t.next_out),t.next_out+=r,n.pending_out+=r,t.total_out+=r,t.avail_out-=r,n.pending-=r,0===n.pending&&(n.pending_out=0))}function flush_block_only(t,n){a._tr_flush_block(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,n),t.block_start=t.strstart,flush_pending(t.strm)}function put_byte(t,n){t.pending_buf[t.pending++]=n}function putShortMSB(t,n){t.pending_buf[t.pending++]=n>>>8&255,t.pending_buf[t.pending++]=255&n}function longest_match(t,n){var r,o,i=t.max_chain_length,a=t.strstart,c=t.prev_length,u=t.nice_match,l=t.strstart>t.w_size-262?t.strstart-(t.w_size-262):0,p=t.window,f=t.w_mask,h=t.prev,d=t.strstart+258,y=p[a+c-1],m=p[a+c];t.prev_length>=t.good_match&&(i>>=2),u>t.lookahead&&(u=t.lookahead);do{if(p[(r=n)+c]===m&&p[r+c-1]===y&&p[r]===p[a]&&p[++r]===p[a+1]){a+=2,r++;do{}while(p[++a]===p[++r]&&p[++a]===p[++r]&&p[++a]===p[++r]&&p[++a]===p[++r]&&p[++a]===p[++r]&&p[++a]===p[++r]&&p[++a]===p[++r]&&p[++a]===p[++r]&&a<d);if(o=258-(d-a),a=d-258,o>c){if(t.match_start=n,c=o,o>=u)break;y=p[a+c-1],m=p[a+c]}}}while((n=h[n&f])>l&&0!=--i);return c<=t.lookahead?c:t.lookahead}function fill_window(t){var n,r,o,a,l,p,f,h,d,y,m=t.w_size;do{if(a=t.window_size-t.lookahead-t.strstart,t.strstart>=m+(m-262)){i.arraySet(t.window,t.window,m,m,0),t.match_start-=m,t.strstart-=m,t.block_start-=m,n=r=t.hash_size;do{o=t.head[--n],t.head[n]=o>=m?o-m:0}while(--r);n=r=m;do{o=t.prev[--n],t.prev[n]=o>=m?o-m:0}while(--r);a+=m}if(0===t.strm.avail_in)break;if(p=t.strm,f=t.window,h=t.strstart+t.lookahead,d=a,y=void 0,(y=p.avail_in)>d&&(y=d),r=0===y?0:(p.avail_in-=y,i.arraySet(f,p.input,p.next_in,y,h),1===p.state.wrap?p.adler=c(p.adler,f,y,h):2===p.state.wrap&&(p.adler=u(p.adler,f,y,h)),p.next_in+=y,p.total_in+=y,y),t.lookahead+=r,t.lookahead+t.insert>=3)for(l=t.strstart-t.insert,t.ins_h=t.window[l],t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+1])&t.hash_mask;t.insert&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[l+3-1])&t.hash_mask,t.prev[l&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=l,l++,t.insert--,!(t.lookahead+t.insert<3)););}while(t.lookahead<262&&0!==t.strm.avail_in)}function deflate_fast(t,n){for(var r,o;;){if(t.lookahead<262){if(fill_window(t),t.lookahead<262&&0===n)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==r&&t.strstart-r<=t.w_size-262&&(t.match_length=longest_match(t,r)),t.match_length>=3)if(o=a._tr_tally(t,t.strstart-t.match_start,t.match_length-3),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=3){t.match_length--;do{t.strstart++,t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!=--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+1])&t.hash_mask;else o=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(o&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}return t.insert=t.strstart<2?t.strstart:2,4===n?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?1:2}function deflate_slow(t,n){for(var r,o,i;;){if(t.lookahead<262){if(fill_window(t),t.lookahead<262&&0===n)return 1;if(0===t.lookahead)break}if(r=0,t.lookahead>=3&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=2,0!==r&&t.prev_length<t.max_lazy_match&&t.strstart-r<=t.w_size-262&&(t.match_length=longest_match(t,r),t.match_length<=5&&(1===t.strategy||3===t.match_length&&t.strstart-t.match_start>4096)&&(t.match_length=2)),t.prev_length>=3&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-3,o=a._tr_tally(t,t.strstart-1-t.prev_match,t.prev_length-3),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=(t.ins_h<<t.hash_shift^t.window[t.strstart+3-1])&t.hash_mask,r=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!=--t.prev_length);if(t.match_available=0,t.match_length=2,t.strstart++,o&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}else if(t.match_available){if((o=a._tr_tally(t,0,t.window[t.strstart-1]))&&flush_block_only(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return 1}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(o=a._tr_tally(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<2?t.strstart:2,4===n?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?1:2}function Config(t,n,r,o,i){this.good_length=t,this.max_lazy=n,this.nice_length=r,this.max_chain=o,this.func=i}function DeflateState(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(1146),this.dyn_dtree=new i.Buf16(122),this.bl_tree=new i.Buf16(78),zero(this.dyn_ltree),zero(this.dyn_dtree),zero(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(16),this.heap=new i.Buf16(573),zero(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(573),zero(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function deflateResetKeep(t){var n;return t&&t.state?(t.total_in=t.total_out=0,t.data_type=2,(n=t.state).pending=0,n.pending_out=0,n.wrap<0&&(n.wrap=-n.wrap),n.status=n.wrap?42:113,t.adler=2===n.wrap?0:1,n.last_flush=0,a._tr_init(n),0):err(t,-2)}function deflateReset(t){var n=deflateResetKeep(t);return 0===n&&function lm_init(t){t.window_size=2*t.w_size,zero(t.head),t.max_lazy_match=o[t.level].max_lazy,t.good_match=o[t.level].good_length,t.nice_match=o[t.level].nice_length,t.max_chain_length=o[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0}(t.state),n}function deflateInit2(t,n,r,o,a,c){if(!t)return-2;var u=1;if(-1===n&&(n=6),o<0?(u=0,o=-o):o>15&&(u=2,o-=16),a<1||a>9||8!==r||o<8||o>15||n<0||n>9||c<0||c>4)return err(t,-2);8===o&&(o=9);var l=new DeflateState;return t.state=l,l.strm=t,l.wrap=u,l.gzhead=null,l.w_bits=o,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=a+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<a+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=1*l.lit_bufsize,l.l_buf=3*l.lit_bufsize,l.level=n,l.strategy=c,l.method=r,deflateReset(t)}o=[new Config(0,0,0,0,(function deflate_stored(t,n){var r=65535;for(r>t.pending_buf_size-5&&(r=t.pending_buf_size-5);;){if(t.lookahead<=1){if(fill_window(t),0===t.lookahead&&0===n)return 1;if(0===t.lookahead)break}t.strstart+=t.lookahead,t.lookahead=0;var o=t.block_start+r;if((0===t.strstart||t.strstart>=o)&&(t.lookahead=t.strstart-o,t.strstart=o,flush_block_only(t,!1),0===t.strm.avail_out))return 1;if(t.strstart-t.block_start>=t.w_size-262&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===n?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):(t.strstart>t.block_start&&(flush_block_only(t,!1),t.strm.avail_out),1)})),new Config(4,4,8,4,deflate_fast),new Config(4,5,16,8,deflate_fast),new Config(4,6,32,32,deflate_fast),new Config(4,4,16,16,deflate_slow),new Config(8,16,32,32,deflate_slow),new Config(8,16,128,128,deflate_slow),new Config(8,32,128,256,deflate_slow),new Config(32,128,258,1024,deflate_slow),new Config(32,258,258,4096,deflate_slow)],n.deflateInit=function deflateInit(t,n){return deflateInit2(t,n,8,15,8,0)},n.deflateInit2=deflateInit2,n.deflateReset=deflateReset,n.deflateResetKeep=deflateResetKeep,n.deflateSetHeader=function deflateSetHeader(t,n){return t&&t.state?2!==t.state.wrap?-2:(t.state.gzhead=n,0):-2},n.deflate=function deflate(t,n){var r,i,c,l;if(!t||!t.state||n>5||n<0)return t?err(t,-2):-2;if(i=t.state,!t.output||!t.input&&0!==t.avail_in||666===i.status&&4!==n)return err(t,0===t.avail_out?-5:-2);if(i.strm=t,r=i.last_flush,i.last_flush=n,42===i.status)if(2===i.wrap)t.adler=0,put_byte(i,31),put_byte(i,139),put_byte(i,8),i.gzhead?(put_byte(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),put_byte(i,255&i.gzhead.time),put_byte(i,i.gzhead.time>>8&255),put_byte(i,i.gzhead.time>>16&255),put_byte(i,i.gzhead.time>>24&255),put_byte(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),put_byte(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(put_byte(i,255&i.gzhead.extra.length),put_byte(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(t.adler=u(t.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69):(put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,0),put_byte(i,9===i.level?2:i.strategy>=2||i.level<2?4:0),put_byte(i,3),i.status=113);else{var p=8+(i.w_bits-8<<4)<<8;p|=(i.strategy>=2||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(p|=32),p+=31-p%31,i.status=113,putShortMSB(i,p),0!==i.strstart&&(putShortMSB(i,t.adler>>>16),putShortMSB(i,65535&t.adler)),t.adler=1}if(69===i.status)if(i.gzhead.extra){for(c=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>c&&(t.adler=u(t.adler,i.pending_buf,i.pending-c,c)),flush_pending(t),c=i.pending,i.pending!==i.pending_buf_size));)put_byte(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>c&&(t.adler=u(t.adler,i.pending_buf,i.pending-c,c)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=73)}else i.status=73;if(73===i.status)if(i.gzhead.name){c=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>c&&(t.adler=u(t.adler,i.pending_buf,i.pending-c,c)),flush_pending(t),c=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,put_byte(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>c&&(t.adler=u(t.adler,i.pending_buf,i.pending-c,c)),0===l&&(i.gzindex=0,i.status=91)}else i.status=91;if(91===i.status)if(i.gzhead.comment){c=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>c&&(t.adler=u(t.adler,i.pending_buf,i.pending-c,c)),flush_pending(t),c=i.pending,i.pending===i.pending_buf_size)){l=1;break}l=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,put_byte(i,l)}while(0!==l);i.gzhead.hcrc&&i.pending>c&&(t.adler=u(t.adler,i.pending_buf,i.pending-c,c)),0===l&&(i.status=103)}else i.status=103;if(103===i.status&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&flush_pending(t),i.pending+2<=i.pending_buf_size&&(put_byte(i,255&t.adler),put_byte(i,t.adler>>8&255),t.adler=0,i.status=113)):i.status=113),0!==i.pending){if(flush_pending(t),0===t.avail_out)return i.last_flush=-1,0}else if(0===t.avail_in&&rank(n)<=rank(r)&&4!==n)return err(t,-5);if(666===i.status&&0!==t.avail_in)return err(t,-5);if(0!==t.avail_in||0!==i.lookahead||0!==n&&666!==i.status){var f=2===i.strategy?function deflate_huff(t,n){for(var r;;){if(0===t.lookahead&&(fill_window(t),0===t.lookahead)){if(0===n)return 1;break}if(t.match_length=0,r=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,r&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===n?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?1:2}(i,n):3===i.strategy?function deflate_rle(t,n){for(var r,o,i,c,u=t.window;;){if(t.lookahead<=258){if(fill_window(t),t.lookahead<=258&&0===n)return 1;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=3&&t.strstart>0&&(o=u[i=t.strstart-1])===u[++i]&&o===u[++i]&&o===u[++i]){c=t.strstart+258;do{}while(o===u[++i]&&o===u[++i]&&o===u[++i]&&o===u[++i]&&o===u[++i]&&o===u[++i]&&o===u[++i]&&o===u[++i]&&i<c);t.match_length=258-(c-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=3?(r=a._tr_tally(t,1,t.match_length-3),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(r=a._tr_tally(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),r&&(flush_block_only(t,!1),0===t.strm.avail_out))return 1}return t.insert=0,4===n?(flush_block_only(t,!0),0===t.strm.avail_out?3:4):t.last_lit&&(flush_block_only(t,!1),0===t.strm.avail_out)?1:2}(i,n):o[i.level].func(i,n);if(3!==f&&4!==f||(i.status=666),1===f||3===f)return 0===t.avail_out&&(i.last_flush=-1),0;if(2===f&&(1===n?a._tr_align(i):5!==n&&(a._tr_stored_block(i,0,0,!1),3===n&&(zero(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),flush_pending(t),0===t.avail_out))return i.last_flush=-1,0}return 4!==n?0:i.wrap<=0?1:(2===i.wrap?(put_byte(i,255&t.adler),put_byte(i,t.adler>>8&255),put_byte(i,t.adler>>16&255),put_byte(i,t.adler>>24&255),put_byte(i,255&t.total_in),put_byte(i,t.total_in>>8&255),put_byte(i,t.total_in>>16&255),put_byte(i,t.total_in>>24&255)):(putShortMSB(i,t.adler>>>16),putShortMSB(i,65535&t.adler)),flush_pending(t),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?0:1)},n.deflateEnd=function deflateEnd(t){var n;return t&&t.state?42!==(n=t.state.status)&&69!==n&&73!==n&&91!==n&&103!==n&&113!==n&&666!==n?err(t,-2):(t.state=null,113===n?err(t,-3):0):-2},n.deflateSetDictionary=function deflateSetDictionary(t,n){var r,o,a,u,l,p,f,h,d=n.length;if(!t||!t.state)return-2;if(2===(u=(r=t.state).wrap)||1===u&&42!==r.status||r.lookahead)return-2;for(1===u&&(t.adler=c(t.adler,n,d,0)),r.wrap=0,d>=r.w_size&&(0===u&&(zero(r.head),r.strstart=0,r.block_start=0,r.insert=0),h=new i.Buf8(r.w_size),i.arraySet(h,n,d-r.w_size,r.w_size,0),n=h,d=r.w_size),l=t.avail_in,p=t.next_in,f=t.input,t.avail_in=d,t.next_in=0,t.input=n,fill_window(r);r.lookahead>=3;){o=r.strstart,a=r.lookahead-2;do{r.ins_h=(r.ins_h<<r.hash_shift^r.window[o+3-1])&r.hash_mask,r.prev[o&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=o,o++}while(--a);r.strstart=o,r.lookahead=2,fill_window(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=2,r.match_available=0,t.next_in=p,t.input=f,t.avail_in=l,r.wrap=u,0},n.deflateInfo="pako deflate (from Nodeca project)"},function(t,n,r){"use strict";var o=r(7);function zero(t){for(var n=t.length;--n>=0;)t[n]=0}var i=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],a=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],c=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],u=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],l=new Array(576);zero(l);var p=new Array(60);zero(p);var f=new Array(512);zero(f);var h=new Array(256);zero(h);var d=new Array(29);zero(d);var y,m,v,g=new Array(30);function StaticTreeDesc(t,n,r,o,i){this.static_tree=t,this.extra_bits=n,this.extra_base=r,this.elems=o,this.max_length=i,this.has_stree=t&&t.length}function TreeDesc(t,n){this.dyn_tree=t,this.max_code=0,this.stat_desc=n}function d_code(t){return t<256?f[t]:f[256+(t>>>7)]}function put_short(t,n){t.pending_buf[t.pending++]=255&n,t.pending_buf[t.pending++]=n>>>8&255}function send_bits(t,n,r){t.bi_valid>16-r?(t.bi_buf|=n<<t.bi_valid&65535,put_short(t,t.bi_buf),t.bi_buf=n>>16-t.bi_valid,t.bi_valid+=r-16):(t.bi_buf|=n<<t.bi_valid&65535,t.bi_valid+=r)}function send_code(t,n,r){send_bits(t,r[2*n],r[2*n+1])}function bi_reverse(t,n){var r=0;do{r|=1&t,t>>>=1,r<<=1}while(--n>0);return r>>>1}function gen_codes(t,n,r){var o,i,a=new Array(16),c=0;for(o=1;o<=15;o++)a[o]=c=c+r[o-1]<<1;for(i=0;i<=n;i++){var u=t[2*i+1];0!==u&&(t[2*i]=bi_reverse(a[u]++,u))}}function init_block(t){var n;for(n=0;n<286;n++)t.dyn_ltree[2*n]=0;for(n=0;n<30;n++)t.dyn_dtree[2*n]=0;for(n=0;n<19;n++)t.bl_tree[2*n]=0;t.dyn_ltree[512]=1,t.opt_len=t.static_len=0,t.last_lit=t.matches=0}function bi_windup(t){t.bi_valid>8?put_short(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0}function smaller(t,n,r,o){var i=2*n,a=2*r;return t[i]<t[a]||t[i]===t[a]&&o[n]<=o[r]}function pqdownheap(t,n,r){for(var o=t.heap[r],i=r<<1;i<=t.heap_len&&(i<t.heap_len&&smaller(n,t.heap[i+1],t.heap[i],t.depth)&&i++,!smaller(n,o,t.heap[i],t.depth));)t.heap[r]=t.heap[i],r=i,i<<=1;t.heap[r]=o}function compress_block(t,n,r){var o,c,u,l,p=0;if(0!==t.last_lit)do{o=t.pending_buf[t.d_buf+2*p]<<8|t.pending_buf[t.d_buf+2*p+1],c=t.pending_buf[t.l_buf+p],p++,0===o?send_code(t,c,n):(send_code(t,(u=h[c])+256+1,n),0!==(l=i[u])&&send_bits(t,c-=d[u],l),send_code(t,u=d_code(--o),r),0!==(l=a[u])&&send_bits(t,o-=g[u],l))}while(p<t.last_lit);send_code(t,256,n)}function build_tree(t,n){var r,o,i,a=n.dyn_tree,c=n.stat_desc.static_tree,u=n.stat_desc.has_stree,l=n.stat_desc.elems,p=-1;for(t.heap_len=0,t.heap_max=573,r=0;r<l;r++)0!==a[2*r]?(t.heap[++t.heap_len]=p=r,t.depth[r]=0):a[2*r+1]=0;for(;t.heap_len<2;)a[2*(i=t.heap[++t.heap_len]=p<2?++p:0)]=1,t.depth[i]=0,t.opt_len--,u&&(t.static_len-=c[2*i+1]);for(n.max_code=p,r=t.heap_len>>1;r>=1;r--)pqdownheap(t,a,r);i=l;do{r=t.heap[1],t.heap[1]=t.heap[t.heap_len--],pqdownheap(t,a,1),o=t.heap[1],t.heap[--t.heap_max]=r,t.heap[--t.heap_max]=o,a[2*i]=a[2*r]+a[2*o],t.depth[i]=(t.depth[r]>=t.depth[o]?t.depth[r]:t.depth[o])+1,a[2*r+1]=a[2*o+1]=i,t.heap[1]=i++,pqdownheap(t,a,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],function gen_bitlen(t,n){var r,o,i,a,c,u,l=n.dyn_tree,p=n.max_code,f=n.stat_desc.static_tree,h=n.stat_desc.has_stree,d=n.stat_desc.extra_bits,y=n.stat_desc.extra_base,m=n.stat_desc.max_length,v=0;for(a=0;a<=15;a++)t.bl_count[a]=0;for(l[2*t.heap[t.heap_max]+1]=0,r=t.heap_max+1;r<573;r++)(a=l[2*l[2*(o=t.heap[r])+1]+1]+1)>m&&(a=m,v++),l[2*o+1]=a,o>p||(t.bl_count[a]++,c=0,o>=y&&(c=d[o-y]),u=l[2*o],t.opt_len+=u*(a+c),h&&(t.static_len+=u*(f[2*o+1]+c)));if(0!==v){do{for(a=m-1;0===t.bl_count[a];)a--;t.bl_count[a]--,t.bl_count[a+1]+=2,t.bl_count[m]--,v-=2}while(v>0);for(a=m;0!==a;a--)for(o=t.bl_count[a];0!==o;)(i=t.heap[--r])>p||(l[2*i+1]!==a&&(t.opt_len+=(a-l[2*i+1])*l[2*i],l[2*i+1]=a),o--)}}(t,n),gen_codes(a,p,t.bl_count)}function scan_tree(t,n,r){var o,i,a=-1,c=n[1],u=0,l=7,p=4;for(0===c&&(l=138,p=3),n[2*(r+1)+1]=65535,o=0;o<=r;o++)i=c,c=n[2*(o+1)+1],++u<l&&i===c||(u<p?t.bl_tree[2*i]+=u:0!==i?(i!==a&&t.bl_tree[2*i]++,t.bl_tree[32]++):u<=10?t.bl_tree[34]++:t.bl_tree[36]++,u=0,a=i,0===c?(l=138,p=3):i===c?(l=6,p=3):(l=7,p=4))}function send_tree(t,n,r){var o,i,a=-1,c=n[1],u=0,l=7,p=4;for(0===c&&(l=138,p=3),o=0;o<=r;o++)if(i=c,c=n[2*(o+1)+1],!(++u<l&&i===c)){if(u<p)do{send_code(t,i,t.bl_tree)}while(0!=--u);else 0!==i?(i!==a&&(send_code(t,i,t.bl_tree),u--),send_code(t,16,t.bl_tree),send_bits(t,u-3,2)):u<=10?(send_code(t,17,t.bl_tree),send_bits(t,u-3,3)):(send_code(t,18,t.bl_tree),send_bits(t,u-11,7));u=0,a=i,0===c?(l=138,p=3):i===c?(l=6,p=3):(l=7,p=4)}}zero(g);var _=!1;function _tr_stored_block(t,n,r,i){send_bits(t,0+(i?1:0),3),function copy_block(t,n,r,i){bi_windup(t),i&&(put_short(t,r),put_short(t,~r)),o.arraySet(t.pending_buf,t.window,n,r,t.pending),t.pending+=r}(t,n,r,!0)}n._tr_init=function _tr_init(t){_||(!function tr_static_init(){var t,n,r,o,u,_=new Array(16);for(r=0,o=0;o<28;o++)for(d[o]=r,t=0;t<1<<i[o];t++)h[r++]=o;for(h[r-1]=o,u=0,o=0;o<16;o++)for(g[o]=u,t=0;t<1<<a[o];t++)f[u++]=o;for(u>>=7;o<30;o++)for(g[o]=u<<7,t=0;t<1<<a[o]-7;t++)f[256+u++]=o;for(n=0;n<=15;n++)_[n]=0;for(t=0;t<=143;)l[2*t+1]=8,t++,_[8]++;for(;t<=255;)l[2*t+1]=9,t++,_[9]++;for(;t<=279;)l[2*t+1]=7,t++,_[7]++;for(;t<=287;)l[2*t+1]=8,t++,_[8]++;for(gen_codes(l,287,_),t=0;t<30;t++)p[2*t+1]=5,p[2*t]=bi_reverse(t,5);y=new StaticTreeDesc(l,i,257,286,15),m=new StaticTreeDesc(p,a,0,30,15),v=new StaticTreeDesc(new Array(0),c,0,19,7)}(),_=!0),t.l_desc=new TreeDesc(t.dyn_ltree,y),t.d_desc=new TreeDesc(t.dyn_dtree,m),t.bl_desc=new TreeDesc(t.bl_tree,v),t.bi_buf=0,t.bi_valid=0,init_block(t)},n._tr_stored_block=_tr_stored_block,n._tr_flush_block=function _tr_flush_block(t,n,r,o){var i,a,c=0;t.level>0?(2===t.strm.data_type&&(t.strm.data_type=function detect_data_type(t){var n,r=4093624447;for(n=0;n<=31;n++,r>>>=1)if(1&r&&0!==t.dyn_ltree[2*n])return 0;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return 1;for(n=32;n<256;n++)if(0!==t.dyn_ltree[2*n])return 1;return 0}(t)),build_tree(t,t.l_desc),build_tree(t,t.d_desc),c=function build_bl_tree(t){var n;for(scan_tree(t,t.dyn_ltree,t.l_desc.max_code),scan_tree(t,t.dyn_dtree,t.d_desc.max_code),build_tree(t,t.bl_desc),n=18;n>=3&&0===t.bl_tree[2*u[n]+1];n--);return t.opt_len+=3*(n+1)+5+5+4,n}(t),i=t.opt_len+3+7>>>3,(a=t.static_len+3+7>>>3)<=i&&(i=a)):i=a=r+5,r+4<=i&&-1!==n?_tr_stored_block(t,n,r,o):4===t.strategy||a===i?(send_bits(t,2+(o?1:0),3),compress_block(t,l,p)):(send_bits(t,4+(o?1:0),3),function send_all_trees(t,n,r,o){var i;for(send_bits(t,n-257,5),send_bits(t,r-1,5),send_bits(t,o-4,4),i=0;i<o;i++)send_bits(t,t.bl_tree[2*u[i]+1],3);send_tree(t,t.dyn_ltree,n-1),send_tree(t,t.dyn_dtree,r-1)}(t,t.l_desc.max_code+1,t.d_desc.max_code+1,c+1),compress_block(t,t.dyn_ltree,t.dyn_dtree)),init_block(t),o&&bi_windup(t)},n._tr_tally=function _tr_tally(t,n,r){return t.pending_buf[t.d_buf+2*t.last_lit]=n>>>8&255,t.pending_buf[t.d_buf+2*t.last_lit+1]=255&n,t.pending_buf[t.l_buf+t.last_lit]=255&r,t.last_lit++,0===n?t.dyn_ltree[2*r]++:(t.matches++,n--,t.dyn_ltree[2*(h[r]+256+1)]++,t.dyn_dtree[2*d_code(n)]++),t.last_lit===t.lit_bufsize-1},n._tr_align=function _tr_align(t){send_bits(t,2,3),send_code(t,256,l),function bi_flush(t){16===t.bi_valid?(put_short(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(t)}},function(t,n,r){"use strict";var o=r(93),i=r(7),a=r(48),c=r(50),u=r(28),l=r(49),p=r(96),f=Object.prototype.toString;function Inflate(t){if(!(this instanceof Inflate))return new Inflate(t);this.options=i.assign({chunkSize:16384,windowBits:0,to:""},t||{});var n=this.options;n.raw&&n.windowBits>=0&&n.windowBits<16&&(n.windowBits=-n.windowBits,0===n.windowBits&&(n.windowBits=-15)),!(n.windowBits>=0&&n.windowBits<16)||t&&t.windowBits||(n.windowBits+=32),n.windowBits>15&&n.windowBits<48&&0==(15&n.windowBits)&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var r=o.inflateInit2(this.strm,n.windowBits);if(r!==c.Z_OK)throw new Error(u[r]);if(this.header=new p,o.inflateGetHeader(this.strm,this.header),n.dictionary&&("string"==typeof n.dictionary?n.dictionary=a.string2buf(n.dictionary):"[object ArrayBuffer]"===f.call(n.dictionary)&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(r=o.inflateSetDictionary(this.strm,n.dictionary))!==c.Z_OK))throw new Error(u[r])}function inflate(t,n){var r=new Inflate(n);if(r.push(t,!0),r.err)throw r.msg||u[r.err];return r.result}Inflate.prototype.push=function(t,n){var r,u,l,p,h,d=this.strm,y=this.options.chunkSize,m=this.options.dictionary,v=!1;if(this.ended)return!1;u=n===~~n?n:!0===n?c.Z_FINISH:c.Z_NO_FLUSH,"string"==typeof t?d.input=a.binstring2buf(t):"[object ArrayBuffer]"===f.call(t)?d.input=new Uint8Array(t):d.input=t,d.next_in=0,d.avail_in=d.input.length;do{if(0===d.avail_out&&(d.output=new i.Buf8(y),d.next_out=0,d.avail_out=y),(r=o.inflate(d,c.Z_NO_FLUSH))===c.Z_NEED_DICT&&m&&(r=o.inflateSetDictionary(this.strm,m)),r===c.Z_BUF_ERROR&&!0===v&&(r=c.Z_OK,v=!1),r!==c.Z_STREAM_END&&r!==c.Z_OK)return this.onEnd(r),this.ended=!0,!1;d.next_out&&(0!==d.avail_out&&r!==c.Z_STREAM_END&&(0!==d.avail_in||u!==c.Z_FINISH&&u!==c.Z_SYNC_FLUSH)||("string"===this.options.to?(l=a.utf8border(d.output,d.next_out),p=d.next_out-l,h=a.buf2string(d.output,l),d.next_out=p,d.avail_out=y-p,p&&i.arraySet(d.output,d.output,l,p,0),this.onData(h)):this.onData(i.shrinkBuf(d.output,d.next_out)))),0===d.avail_in&&0===d.avail_out&&(v=!0)}while((d.avail_in>0||0===d.avail_out)&&r!==c.Z_STREAM_END);return r===c.Z_STREAM_END&&(u=c.Z_FINISH),u===c.Z_FINISH?(r=o.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,r===c.Z_OK):u!==c.Z_SYNC_FLUSH||(this.onEnd(c.Z_OK),d.avail_out=0,!0)},Inflate.prototype.onData=function(t){this.chunks.push(t)},Inflate.prototype.onEnd=function(t){t===c.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=i.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},n.Inflate=Inflate,n.inflate=inflate,n.inflateRaw=function inflateRaw(t,n){return(n=n||{}).raw=!0,inflate(t,n)},n.ungzip=inflate},function(t,n,r){"use strict";var o=r(7),i=r(46),a=r(47),c=r(94),u=r(95);function zswap32(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function InflateState(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new o.Buf16(320),this.work=new o.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function inflateResetKeep(t){var n;return t&&t.state?(n=t.state,t.total_in=t.total_out=n.total=0,t.msg="",n.wrap&&(t.adler=1&n.wrap),n.mode=1,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new o.Buf32(852),n.distcode=n.distdyn=new o.Buf32(592),n.sane=1,n.back=-1,0):-2}function inflateReset(t){var n;return t&&t.state?((n=t.state).wsize=0,n.whave=0,n.wnext=0,inflateResetKeep(t)):-2}function inflateReset2(t,n){var r,o;return t&&t.state?(o=t.state,n<0?(r=0,n=-n):(r=1+(n>>4),n<48&&(n&=15)),n&&(n<8||n>15)?-2:(null!==o.window&&o.wbits!==n&&(o.window=null),o.wrap=r,o.wbits=n,inflateReset(t))):-2}function inflateInit2(t,n){var r,o;return t?(o=new InflateState,t.state=o,o.window=null,0!==(r=inflateReset2(t,n))&&(t.state=null),r):-2}var l,p,f=!0;function fixedtables(t){if(f){var n;for(l=new o.Buf32(512),p=new o.Buf32(32),n=0;n<144;)t.lens[n++]=8;for(;n<256;)t.lens[n++]=9;for(;n<280;)t.lens[n++]=7;for(;n<288;)t.lens[n++]=8;for(u(1,t.lens,0,288,l,0,t.work,{bits:9}),n=0;n<32;)t.lens[n++]=5;u(2,t.lens,0,32,p,0,t.work,{bits:5}),f=!1}t.lencode=l,t.lenbits=9,t.distcode=p,t.distbits=5}function updatewindow(t,n,r,i){var a,c=t.state;return null===c.window&&(c.wsize=1<<c.wbits,c.wnext=0,c.whave=0,c.window=new o.Buf8(c.wsize)),i>=c.wsize?(o.arraySet(c.window,n,r-c.wsize,c.wsize,0),c.wnext=0,c.whave=c.wsize):((a=c.wsize-c.wnext)>i&&(a=i),o.arraySet(c.window,n,r-i,a,c.wnext),(i-=a)?(o.arraySet(c.window,n,r-i,i,0),c.wnext=i,c.whave=c.wsize):(c.wnext+=a,c.wnext===c.wsize&&(c.wnext=0),c.whave<c.wsize&&(c.whave+=a))),0}n.inflateReset=inflateReset,n.inflateReset2=inflateReset2,n.inflateResetKeep=inflateResetKeep,n.inflateInit=function inflateInit(t){return inflateInit2(t,15)},n.inflateInit2=inflateInit2,n.inflate=function inflate(t,n){var r,l,p,f,h,d,y,m,v,g,_,b,w,x,P,O,C,S,A,E,j,T,R,B,M=0,I=new o.Buf8(4),z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&0!==t.avail_in)return-2;12===(r=t.state).mode&&(r.mode=13),h=t.next_out,p=t.output,y=t.avail_out,f=t.next_in,l=t.input,d=t.avail_in,m=r.hold,v=r.bits,g=d,_=y,T=0;t:for(;;)switch(r.mode){case 1:if(0===r.wrap){r.mode=13;break}for(;v<16;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}if(2&r.wrap&&35615===m){r.check=0,I[0]=255&m,I[1]=m>>>8&255,r.check=a(r.check,I,2,0),m=0,v=0,r.mode=2;break}if(r.flags=0,r.head&&(r.head.done=!1),!(1&r.wrap)||(((255&m)<<8)+(m>>8))%31){t.msg="incorrect header check",r.mode=30;break}if(8!=(15&m)){t.msg="unknown compression method",r.mode=30;break}if(v-=4,j=8+(15&(m>>>=4)),0===r.wbits)r.wbits=j;else if(j>r.wbits){t.msg="invalid window size",r.mode=30;break}r.dmax=1<<j,t.adler=r.check=1,r.mode=512&m?10:12,m=0,v=0;break;case 2:for(;v<16;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}if(r.flags=m,8!=(255&r.flags)){t.msg="unknown compression method",r.mode=30;break}if(57344&r.flags){t.msg="unknown header flags set",r.mode=30;break}r.head&&(r.head.text=m>>8&1),512&r.flags&&(I[0]=255&m,I[1]=m>>>8&255,r.check=a(r.check,I,2,0)),m=0,v=0,r.mode=3;case 3:for(;v<32;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}r.head&&(r.head.time=m),512&r.flags&&(I[0]=255&m,I[1]=m>>>8&255,I[2]=m>>>16&255,I[3]=m>>>24&255,r.check=a(r.check,I,4,0)),m=0,v=0,r.mode=4;case 4:for(;v<16;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}r.head&&(r.head.xflags=255&m,r.head.os=m>>8),512&r.flags&&(I[0]=255&m,I[1]=m>>>8&255,r.check=a(r.check,I,2,0)),m=0,v=0,r.mode=5;case 5:if(1024&r.flags){for(;v<16;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}r.length=m,r.head&&(r.head.extra_len=m),512&r.flags&&(I[0]=255&m,I[1]=m>>>8&255,r.check=a(r.check,I,2,0)),m=0,v=0}else r.head&&(r.head.extra=null);r.mode=6;case 6:if(1024&r.flags&&((b=r.length)>d&&(b=d),b&&(r.head&&(j=r.head.extra_len-r.length,r.head.extra||(r.head.extra=new Array(r.head.extra_len)),o.arraySet(r.head.extra,l,f,b,j)),512&r.flags&&(r.check=a(r.check,l,b,f)),d-=b,f+=b,r.length-=b),r.length))break t;r.length=0,r.mode=7;case 7:if(2048&r.flags){if(0===d)break t;b=0;do{j=l[f+b++],r.head&&j&&r.length<65536&&(r.head.name+=String.fromCharCode(j))}while(j&&b<d);if(512&r.flags&&(r.check=a(r.check,l,b,f)),d-=b,f+=b,j)break t}else r.head&&(r.head.name=null);r.length=0,r.mode=8;case 8:if(4096&r.flags){if(0===d)break t;b=0;do{j=l[f+b++],r.head&&j&&r.length<65536&&(r.head.comment+=String.fromCharCode(j))}while(j&&b<d);if(512&r.flags&&(r.check=a(r.check,l,b,f)),d-=b,f+=b,j)break t}else r.head&&(r.head.comment=null);r.mode=9;case 9:if(512&r.flags){for(;v<16;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}if(m!==(65535&r.check)){t.msg="header crc mismatch",r.mode=30;break}m=0,v=0}r.head&&(r.head.hcrc=r.flags>>9&1,r.head.done=!0),t.adler=r.check=0,r.mode=12;break;case 10:for(;v<32;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}t.adler=r.check=zswap32(m),m=0,v=0,r.mode=11;case 11:if(0===r.havedict)return t.next_out=h,t.avail_out=y,t.next_in=f,t.avail_in=d,r.hold=m,r.bits=v,2;t.adler=r.check=1,r.mode=12;case 12:if(5===n||6===n)break t;case 13:if(r.last){m>>>=7&v,v-=7&v,r.mode=27;break}for(;v<3;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}switch(r.last=1&m,v-=1,3&(m>>>=1)){case 0:r.mode=14;break;case 1:if(fixedtables(r),r.mode=20,6===n){m>>>=2,v-=2;break t}break;case 2:r.mode=17;break;case 3:t.msg="invalid block type",r.mode=30}m>>>=2,v-=2;break;case 14:for(m>>>=7&v,v-=7&v;v<32;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}if((65535&m)!=(m>>>16^65535)){t.msg="invalid stored block lengths",r.mode=30;break}if(r.length=65535&m,m=0,v=0,r.mode=15,6===n)break t;case 15:r.mode=16;case 16:if(b=r.length){if(b>d&&(b=d),b>y&&(b=y),0===b)break t;o.arraySet(p,l,f,b,h),d-=b,f+=b,y-=b,h+=b,r.length-=b;break}r.mode=12;break;case 17:for(;v<14;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}if(r.nlen=257+(31&m),m>>>=5,v-=5,r.ndist=1+(31&m),m>>>=5,v-=5,r.ncode=4+(15&m),m>>>=4,v-=4,r.nlen>286||r.ndist>30){t.msg="too many length or distance symbols",r.mode=30;break}r.have=0,r.mode=18;case 18:for(;r.have<r.ncode;){for(;v<3;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}r.lens[z[r.have++]]=7&m,m>>>=3,v-=3}for(;r.have<19;)r.lens[z[r.have++]]=0;if(r.lencode=r.lendyn,r.lenbits=7,R={bits:r.lenbits},T=u(0,r.lens,0,19,r.lencode,0,r.work,R),r.lenbits=R.bits,T){t.msg="invalid code lengths set",r.mode=30;break}r.have=0,r.mode=19;case 19:for(;r.have<r.nlen+r.ndist;){for(;O=(M=r.lencode[m&(1<<r.lenbits)-1])>>>16&255,C=65535&M,!((P=M>>>24)<=v);){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}if(C<16)m>>>=P,v-=P,r.lens[r.have++]=C;else{if(16===C){for(B=P+2;v<B;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}if(m>>>=P,v-=P,0===r.have){t.msg="invalid bit length repeat",r.mode=30;break}j=r.lens[r.have-1],b=3+(3&m),m>>>=2,v-=2}else if(17===C){for(B=P+3;v<B;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}v-=P,j=0,b=3+(7&(m>>>=P)),m>>>=3,v-=3}else{for(B=P+7;v<B;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}v-=P,j=0,b=11+(127&(m>>>=P)),m>>>=7,v-=7}if(r.have+b>r.nlen+r.ndist){t.msg="invalid bit length repeat",r.mode=30;break}for(;b--;)r.lens[r.have++]=j}}if(30===r.mode)break;if(0===r.lens[256]){t.msg="invalid code -- missing end-of-block",r.mode=30;break}if(r.lenbits=9,R={bits:r.lenbits},T=u(1,r.lens,0,r.nlen,r.lencode,0,r.work,R),r.lenbits=R.bits,T){t.msg="invalid literal/lengths set",r.mode=30;break}if(r.distbits=6,r.distcode=r.distdyn,R={bits:r.distbits},T=u(2,r.lens,r.nlen,r.ndist,r.distcode,0,r.work,R),r.distbits=R.bits,T){t.msg="invalid distances set",r.mode=30;break}if(r.mode=20,6===n)break t;case 20:r.mode=21;case 21:if(d>=6&&y>=258){t.next_out=h,t.avail_out=y,t.next_in=f,t.avail_in=d,r.hold=m,r.bits=v,c(t,_),h=t.next_out,p=t.output,y=t.avail_out,f=t.next_in,l=t.input,d=t.avail_in,m=r.hold,v=r.bits,12===r.mode&&(r.back=-1);break}for(r.back=0;O=(M=r.lencode[m&(1<<r.lenbits)-1])>>>16&255,C=65535&M,!((P=M>>>24)<=v);){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}if(O&&0==(240&O)){for(S=P,A=O,E=C;O=(M=r.lencode[E+((m&(1<<S+A)-1)>>S)])>>>16&255,C=65535&M,!(S+(P=M>>>24)<=v);){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}m>>>=S,v-=S,r.back+=S}if(m>>>=P,v-=P,r.back+=P,r.length=C,0===O){r.mode=26;break}if(32&O){r.back=-1,r.mode=12;break}if(64&O){t.msg="invalid literal/length code",r.mode=30;break}r.extra=15&O,r.mode=22;case 22:if(r.extra){for(B=r.extra;v<B;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}r.length+=m&(1<<r.extra)-1,m>>>=r.extra,v-=r.extra,r.back+=r.extra}r.was=r.length,r.mode=23;case 23:for(;O=(M=r.distcode[m&(1<<r.distbits)-1])>>>16&255,C=65535&M,!((P=M>>>24)<=v);){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}if(0==(240&O)){for(S=P,A=O,E=C;O=(M=r.distcode[E+((m&(1<<S+A)-1)>>S)])>>>16&255,C=65535&M,!(S+(P=M>>>24)<=v);){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}m>>>=S,v-=S,r.back+=S}if(m>>>=P,v-=P,r.back+=P,64&O){t.msg="invalid distance code",r.mode=30;break}r.offset=C,r.extra=15&O,r.mode=24;case 24:if(r.extra){for(B=r.extra;v<B;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}r.offset+=m&(1<<r.extra)-1,m>>>=r.extra,v-=r.extra,r.back+=r.extra}if(r.offset>r.dmax){t.msg="invalid distance too far back",r.mode=30;break}r.mode=25;case 25:if(0===y)break t;if(b=_-y,r.offset>b){if((b=r.offset-b)>r.whave&&r.sane){t.msg="invalid distance too far back",r.mode=30;break}b>r.wnext?(b-=r.wnext,w=r.wsize-b):w=r.wnext-b,b>r.length&&(b=r.length),x=r.window}else x=p,w=h-r.offset,b=r.length;b>y&&(b=y),y-=b,r.length-=b;do{p[h++]=x[w++]}while(--b);0===r.length&&(r.mode=21);break;case 26:if(0===y)break t;p[h++]=r.length,y--,r.mode=21;break;case 27:if(r.wrap){for(;v<32;){if(0===d)break t;d--,m|=l[f++]<<v,v+=8}if(_-=y,t.total_out+=_,r.total+=_,_&&(t.adler=r.check=r.flags?a(r.check,p,_,h-_):i(r.check,p,_,h-_)),_=y,(r.flags?m:zswap32(m))!==r.check){t.msg="incorrect data check",r.mode=30;break}m=0,v=0}r.mode=28;case 28:if(r.wrap&&r.flags){for(;v<32;){if(0===d)break t;d--,m+=l[f++]<<v,v+=8}if(m!==(4294967295&r.total)){t.msg="incorrect length check",r.mode=30;break}m=0,v=0}r.mode=29;case 29:T=1;break t;case 30:T=-3;break t;case 31:return-4;case 32:default:return-2}return t.next_out=h,t.avail_out=y,t.next_in=f,t.avail_in=d,r.hold=m,r.bits=v,(r.wsize||_!==t.avail_out&&r.mode<30&&(r.mode<27||4!==n))&&updatewindow(t,t.output,t.next_out,_-t.avail_out)?(r.mode=31,-4):(g-=t.avail_in,_-=t.avail_out,t.total_in+=g,t.total_out+=_,r.total+=_,r.wrap&&_&&(t.adler=r.check=r.flags?a(r.check,p,_,t.next_out-_):i(r.check,p,_,t.next_out-_)),t.data_type=r.bits+(r.last?64:0)+(12===r.mode?128:0)+(20===r.mode||15===r.mode?256:0),(0===g&&0===_||4===n)&&0===T&&(T=-5),T)},n.inflateEnd=function inflateEnd(t){if(!t||!t.state)return-2;var n=t.state;return n.window&&(n.window=null),t.state=null,0},n.inflateGetHeader=function inflateGetHeader(t,n){var r;return t&&t.state?0==(2&(r=t.state).wrap)?-2:(r.head=n,n.done=!1,0):-2},n.inflateSetDictionary=function inflateSetDictionary(t,n){var r,o=n.length;return t&&t.state?0!==(r=t.state).wrap&&11!==r.mode?-2:11===r.mode&&i(1,n,o,0)!==r.check?-3:updatewindow(t,n,o,o)?(r.mode=31,-4):(r.havedict=1,0):-2},n.inflateInfo="pako inflate (from Nodeca project)"},function(t,n,r){"use strict";t.exports=function inflate_fast(t,n){var r,o,i,a,c,u,l,p,f,h,d,y,m,v,g,_,b,w,x,P,O,C,S,A,E;r=t.state,o=t.next_in,A=t.input,i=o+(t.avail_in-5),a=t.next_out,E=t.output,c=a-(n-t.avail_out),u=a+(t.avail_out-257),l=r.dmax,p=r.wsize,f=r.whave,h=r.wnext,d=r.window,y=r.hold,m=r.bits,v=r.lencode,g=r.distcode,_=(1<<r.lenbits)-1,b=(1<<r.distbits)-1;t:do{m<15&&(y+=A[o++]<<m,m+=8,y+=A[o++]<<m,m+=8),w=v[y&_];e:for(;;){if(y>>>=x=w>>>24,m-=x,0===(x=w>>>16&255))E[a++]=65535&w;else{if(!(16&x)){if(0==(64&x)){w=v[(65535&w)+(y&(1<<x)-1)];continue e}if(32&x){r.mode=12;break t}t.msg="invalid literal/length code",r.mode=30;break t}P=65535&w,(x&=15)&&(m<x&&(y+=A[o++]<<m,m+=8),P+=y&(1<<x)-1,y>>>=x,m-=x),m<15&&(y+=A[o++]<<m,m+=8,y+=A[o++]<<m,m+=8),w=g[y&b];n:for(;;){if(y>>>=x=w>>>24,m-=x,!(16&(x=w>>>16&255))){if(0==(64&x)){w=g[(65535&w)+(y&(1<<x)-1)];continue n}t.msg="invalid distance code",r.mode=30;break t}if(O=65535&w,m<(x&=15)&&(y+=A[o++]<<m,(m+=8)<x&&(y+=A[o++]<<m,m+=8)),(O+=y&(1<<x)-1)>l){t.msg="invalid distance too far back",r.mode=30;break t}if(y>>>=x,m-=x,O>(x=a-c)){if((x=O-x)>f&&r.sane){t.msg="invalid distance too far back",r.mode=30;break t}if(C=0,S=d,0===h){if(C+=p-x,x<P){P-=x;do{E[a++]=d[C++]}while(--x);C=a-O,S=E}}else if(h<x){if(C+=p+h-x,(x-=h)<P){P-=x;do{E[a++]=d[C++]}while(--x);if(C=0,h<P){P-=x=h;do{E[a++]=d[C++]}while(--x);C=a-O,S=E}}}else if(C+=h-x,x<P){P-=x;do{E[a++]=d[C++]}while(--x);C=a-O,S=E}for(;P>2;)E[a++]=S[C++],E[a++]=S[C++],E[a++]=S[C++],P-=3;P&&(E[a++]=S[C++],P>1&&(E[a++]=S[C++]))}else{C=a-O;do{E[a++]=E[C++],E[a++]=E[C++],E[a++]=E[C++],P-=3}while(P>2);P&&(E[a++]=E[C++],P>1&&(E[a++]=E[C++]))}break}}break}}while(o<i&&a<u);o-=P=m>>3,y&=(1<<(m-=P<<3))-1,t.next_in=o,t.next_out=a,t.avail_in=o<i?i-o+5:5-(o-i),t.avail_out=a<u?u-a+257:257-(a-u),r.hold=y,r.bits=m}},function(t,n,r){"use strict";var o=r(7),i=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],c=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],u=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function inflate_table(t,n,r,l,p,f,h,d){var y,m,v,g,_,b,w,x,P,O=d.bits,C=0,S=0,A=0,E=0,j=0,T=0,R=0,B=0,M=0,I=0,z=null,k=0,D=new o.Buf16(16),F=new o.Buf16(16),L=null,N=0;for(C=0;C<=15;C++)D[C]=0;for(S=0;S<l;S++)D[n[r+S]]++;for(j=O,E=15;E>=1&&0===D[E];E--);if(j>E&&(j=E),0===E)return p[f++]=20971520,p[f++]=20971520,d.bits=1,0;for(A=1;A<E&&0===D[A];A++);for(j<A&&(j=A),B=1,C=1;C<=15;C++)if(B<<=1,(B-=D[C])<0)return-1;if(B>0&&(0===t||1!==E))return-1;for(F[1]=0,C=1;C<15;C++)F[C+1]=F[C]+D[C];for(S=0;S<l;S++)0!==n[r+S]&&(h[F[n[r+S]]++]=S);if(0===t?(z=L=h,b=19):1===t?(z=i,k-=257,L=a,N-=257,b=256):(z=c,L=u,b=-1),I=0,S=0,C=A,_=f,T=j,R=0,v=-1,g=(M=1<<j)-1,1===t&&M>852||2===t&&M>592)return 1;for(;;){w=C-R,h[S]<b?(x=0,P=h[S]):h[S]>b?(x=L[N+h[S]],P=z[k+h[S]]):(x=96,P=0),y=1<<C-R,A=m=1<<T;do{p[_+(I>>R)+(m-=y)]=w<<24|x<<16|P|0}while(0!==m);for(y=1<<C-1;I&y;)y>>=1;if(0!==y?(I&=y-1,I+=y):I=0,S++,0==--D[C]){if(C===E)break;C=n[r+h[S]]}if(C>j&&(I&g)!==v){for(0===R&&(R=j),_+=A,B=1<<(T=C-R);T+R<E&&!((B-=D[T+R])<=0);)T++,B<<=1;if(M+=1<<T,1===t&&M>852||2===t&&M>592)return 1;p[v=I&g]=j<<24|T<<16|_-f|0}}return 0!==I&&(p[_+I]=C-R<<24|64<<16|0),d.bits=j,0}},function(t,n,r){"use strict";t.exports=function GZheader(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(t,n,r){"use strict";var o=r(1),i=r(4),a=r(10),c=r(27),u=r(51),decToHex=function(t,n){var r,o="";for(r=0;r<n;r++)o+=String.fromCharCode(255&t),t>>>=8;return o},generateZipParts=function(t,n,r,i,l,p){var f,h,d=t.file,y=t.compression,m=p!==a.utf8encode,v=o.transformTo("string",p(d.name)),g=o.transformTo("string",a.utf8encode(d.name)),_=d.comment,b=o.transformTo("string",p(_)),w=o.transformTo("string",a.utf8encode(_)),x=g.length!==d.name.length,P=w.length!==_.length,O="",C="",S="",A=d.dir,E=d.date,j={crc32:0,compressedSize:0,uncompressedSize:0};n&&!r||(j.crc32=t.crc32,j.compressedSize=t.compressedSize,j.uncompressedSize=t.uncompressedSize);var T=0;n&&(T|=8),m||!x&&!P||(T|=2048);var R,B,M,I=0,z=0;A&&(I|=16),"UNIX"===l?(z=798,I|=(R=d.unixPermissions,B=A,M=R,R||(M=B?16893:33204),(65535&M)<<16)):(z=20,I|=63&(d.dosPermissions||0)),f=E.getUTCHours(),f<<=6,f|=E.getUTCMinutes(),f<<=5,f|=E.getUTCSeconds()/2,h=E.getUTCFullYear()-1980,h<<=4,h|=E.getUTCMonth()+1,h<<=5,h|=E.getUTCDate(),x&&(C=decToHex(1,1)+decToHex(c(v),4)+g,O+="up"+decToHex(C.length,2)+C),P&&(S=decToHex(1,1)+decToHex(c(b),4)+w,O+="uc"+decToHex(S.length,2)+S);var k="";return k+="\n\0",k+=decToHex(T,2),k+=y.magic,k+=decToHex(f,2),k+=decToHex(h,2),k+=decToHex(j.crc32,4),k+=decToHex(j.compressedSize,4),k+=decToHex(j.uncompressedSize,4),k+=decToHex(v.length,2),k+=decToHex(O.length,2),{fileRecord:u.LOCAL_FILE_HEADER+k+v+O,dirRecord:u.CENTRAL_FILE_HEADER+decToHex(z,2)+k+decToHex(b.length,2)+"\0\0\0\0"+decToHex(I,4)+decToHex(i,4)+v+O+b}},generateDataDescriptors=function(t){return u.DATA_DESCRIPTOR+decToHex(t.crc32,4)+decToHex(t.compressedSize,4)+decToHex(t.uncompressedSize,4)};function ZipFileWorker(t,n,r,o){i.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=n,this.zipPlatform=r,this.encodeFileName=o,this.streamFiles=t,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}o.inherits(ZipFileWorker,i),ZipFileWorker.prototype.push=function(t){var n=t.meta.percent||0,r=this.entriesCount,o=this._sources.length;this.accumulate?this.contentBuffer.push(t):(this.bytesWritten+=t.data.length,i.prototype.push.call(this,{data:t.data,meta:{currentFile:this.currentFile,percent:r?(n+100*(r-o-1))/r:100}}))},ZipFileWorker.prototype.openedSource=function(t){this.currentSourceOffset=this.bytesWritten,this.currentFile=t.file.name;var n=this.streamFiles&&!t.file.dir;if(n){var r=generateZipParts(t,n,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:r.fileRecord,meta:{percent:0}})}else this.accumulate=!0},ZipFileWorker.prototype.closedSource=function(t){this.accumulate=!1;var n=this.streamFiles&&!t.file.dir,r=generateZipParts(t,n,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(r.dirRecord),n)this.push({data:generateDataDescriptors(t),meta:{percent:100}});else for(this.push({data:r.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},ZipFileWorker.prototype.flush=function(){for(var t=this.bytesWritten,n=0;n<this.dirRecords.length;n++)this.push({data:this.dirRecords[n],meta:{percent:100}});var r=this.bytesWritten-t,i=function(t,n,r,i,a){var c=o.transformTo("string",a(i));return u.CENTRAL_DIRECTORY_END+"\0\0\0\0"+decToHex(t,2)+decToHex(t,2)+decToHex(n,4)+decToHex(r,4)+decToHex(c.length,2)+c}(this.dirRecords.length,r,t,this.zipComment,this.encodeFileName);this.push({data:i,meta:{percent:100}})},ZipFileWorker.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},ZipFileWorker.prototype.registerPrevious=function(t){this._sources.push(t);var n=this;return t.on("data",(function(t){n.processChunk(t)})),t.on("end",(function(){n.closedSource(n.previous.streamInfo),n._sources.length?n.prepareNextSource():n.end()})),t.on("error",(function(t){n.error(t)})),this},ZipFileWorker.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},ZipFileWorker.prototype.error=function(t){var n=this._sources;if(!i.prototype.error.call(this,t))return!1;for(var r=0;r<n.length;r++)try{n[r].error(t)}catch(t){}return!0},ZipFileWorker.prototype.lock=function(){i.prototype.lock.call(this);for(var t=this._sources,n=0;n<t.length;n++)t[n].lock()},t.exports=ZipFileWorker},function(t,n,r){"use strict";var o=r(1),i=r(4);function NodejsStreamInputAdapter(t,n){i.call(this,"Nodejs stream input adapter for "+t),this._upstreamEnded=!1,this._bindStream(n)}o.inherits(NodejsStreamInputAdapter,i),NodejsStreamInputAdapter.prototype._bindStream=function(t){var n=this;this._stream=t,t.pause(),t.on("data",(function(t){n.push({data:t,meta:{percent:0}})})).on("error",(function(t){n.isPaused?this.generatedError=t:n.error(t)})).on("end",(function(){n.isPaused?n._upstreamEnded=!0:n.end()}))},NodejsStreamInputAdapter.prototype.pause=function(){return!!i.prototype.pause.call(this)&&(this._stream.pause(),!0)},NodejsStreamInputAdapter.prototype.resume=function(){return!!i.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},t.exports=NodejsStreamInputAdapter},function(t,n,r){"use strict";var o=r(1),i=r(14),a=r(10),c=(o=r(1),r(100)),u=r(44),l=r(18);function checkEntryCRC32(t){return new i.Promise((function(n,r){var o=t.decompressed.getContentWorker().pipe(new u);o.on("error",(function(t){r(t)})).on("end",(function(){o.streamInfo.crc32!==t.decompressed.crc32?r(new Error("Corrupted zip : CRC32 mismatch")):n()})).resume()}))}t.exports=function(t,n){var r=this;return n=o.extend(n||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),l.isNode&&l.isStream(t)?i.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):o.prepareContent("the loaded zip file",t,!0,n.optimizedBinaryString,n.base64).then((function(t){var r=new c(n);return r.load(t),r})).then((function checkCRC32(t){var r=[i.Promise.resolve(t)],o=t.files;if(n.checkCRC32)for(var a=0;a<o.length;a++)r.push(checkEntryCRC32(o[a]));return i.Promise.all(r)})).then((function addFiles(t){for(var o=t.shift(),i=o.files,a=0;a<i.length;a++){var c=i[a];r.file(c.fileNameStr,c.decompressed,{binary:!0,optimizedBinaryString:!0,date:c.date,dir:c.dir,comment:c.fileCommentStr.length?c.fileCommentStr:null,unixPermissions:c.unixPermissions,dosPermissions:c.dosPermissions,createFolders:n.createFolders})}return o.zipComment.length&&(r.comment=o.zipComment),r}))}},function(t,n,r){"use strict";var o=r(52),i=r(1),a=r(51),c=r(103),u=(r(10),r(6));function ZipEntries(t){this.files=[],this.loadOptions=t}ZipEntries.prototype={checkSignature:function(t){if(!this.reader.readAndCheckSignature(t)){this.reader.index-=4;var n=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+i.pretty(n)+", expected "+i.pretty(t)+")")}},isSignature:function(t,n){var r=this.reader.index;this.reader.setIndex(t);var o=this.reader.readString(4)===n;return this.reader.setIndex(r),o},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var t=this.reader.readData(this.zipCommentLength),n=u.uint8array?"uint8array":"array",r=i.transformTo(n,t);this.zipComment=this.loadOptions.decodeFileName(r)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var t,n,r,o=this.zip64EndOfCentralSize-44;0<o;)t=this.reader.readInt(2),n=this.reader.readInt(4),r=this.reader.readData(n),this.zip64ExtensibleData[t]={id:t,length:n,value:r}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var t,n;for(t=0;t<this.files.length;t++)n=this.files[t],this.reader.setIndex(n.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),n.readLocalPart(this.reader),n.handleUTF8(),n.processAttributes()},readCentralDir:function(){var t;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(t=new c({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(t);if(this.centralDirRecords!==this.files.length&&0!==this.centralDirRecords&&0===this.files.length)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var t=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(t<0)throw!this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html"):new Error("Corrupted zip: can't find end of central directory");this.reader.setIndex(t);var n=t;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===i.MAX_VALUE_16BITS||this.diskWithCentralDirStart===i.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===i.MAX_VALUE_16BITS||this.centralDirRecords===i.MAX_VALUE_16BITS||this.centralDirSize===i.MAX_VALUE_32BITS||this.centralDirOffset===i.MAX_VALUE_32BITS){if(this.zip64=!0,(t=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(t),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var r=this.centralDirOffset+this.centralDirSize;this.zip64&&(r+=20,r+=12+this.zip64EndOfCentralSize);var o=n-r;if(o>0)this.isSignature(n,a.CENTRAL_FILE_HEADER)||(this.reader.zero=o);else if(o<0)throw new Error("Corrupted zip: missing "+Math.abs(o)+" bytes.")},prepareReader:function(t){this.reader=o(t)},load:function(t){this.prepareReader(t),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=ZipEntries},function(t,n,r){"use strict";var o=r(54);function StringReader(t){o.call(this,t)}r(1).inherits(StringReader,o),StringReader.prototype.byteAt=function(t){return this.data.charCodeAt(this.zero+t)},StringReader.prototype.lastIndexOfSignature=function(t){return this.data.lastIndexOf(t)-this.zero},StringReader.prototype.readAndCheckSignature=function(t){return t===this.readData(4)},StringReader.prototype.readData=function(t){this.checkOffset(t);var n=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,n},t.exports=StringReader},function(t,n,r){"use strict";var o=r(55);function NodeBufferReader(t){o.call(this,t)}r(1).inherits(NodeBufferReader,o),NodeBufferReader.prototype.readData=function(t){this.checkOffset(t);var n=this.data.slice(this.zero+this.index,this.zero+this.index+t);return this.index+=t,n},t.exports=NodeBufferReader},function(t,n,r){"use strict";var o=r(52),i=r(1),a=r(26),c=r(27),u=r(10),l=r(45),p=r(6);function ZipEntry(t,n){this.options=t,this.loadOptions=n}ZipEntry.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},readLocalPart:function(t){var n,r;if(t.skip(22),this.fileNameLength=t.readInt(2),r=t.readInt(2),this.fileName=t.readData(this.fileNameLength),t.skip(r),-1===this.compressedSize||-1===this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize === -1 || uncompressedSize === -1)");if(null===(n=function(t){for(var n in l)if(l.hasOwnProperty(n)&&l[n].magic===t)return l[n];return null}(this.compressionMethod)))throw new Error("Corrupted zip : compression "+i.pretty(this.compressionMethod)+" unknown (inner file : "+i.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,n,t.readData(this.compressedSize))},readCentralPart:function(t){this.versionMadeBy=t.readInt(2),t.skip(2),this.bitFlag=t.readInt(2),this.compressionMethod=t.readString(2),this.date=t.readDate(),this.crc32=t.readInt(4),this.compressedSize=t.readInt(4),this.uncompressedSize=t.readInt(4);var n=t.readInt(2);if(this.extraFieldsLength=t.readInt(2),this.fileCommentLength=t.readInt(2),this.diskNumberStart=t.readInt(2),this.internalFileAttributes=t.readInt(2),this.externalFileAttributes=t.readInt(4),this.localHeaderOffset=t.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");t.skip(n),this.readExtraFields(t),this.parseZIP64ExtraField(t),this.fileComment=t.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var t=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),0===t&&(this.dosPermissions=63&this.externalFileAttributes),3===t&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||"/"!==this.fileNameStr.slice(-1)||(this.dir=!0)},parseZIP64ExtraField:function(t){if(this.extraFields[1]){var n=o(this.extraFields[1].value);this.uncompressedSize===i.MAX_VALUE_32BITS&&(this.uncompressedSize=n.readInt(8)),this.compressedSize===i.MAX_VALUE_32BITS&&(this.compressedSize=n.readInt(8)),this.localHeaderOffset===i.MAX_VALUE_32BITS&&(this.localHeaderOffset=n.readInt(8)),this.diskNumberStart===i.MAX_VALUE_32BITS&&(this.diskNumberStart=n.readInt(4))}},readExtraFields:function(t){var n,r,o,i=t.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});t.index<i;)n=t.readInt(2),r=t.readInt(2),o=t.readData(r),this.extraFields[n]={id:n,length:r,value:o}},handleUTF8:function(){var t=p.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=u.utf8decode(this.fileName),this.fileCommentStr=u.utf8decode(this.fileComment);else{var n=this.findExtraFieldUnicodePath();if(null!==n)this.fileNameStr=n;else{var r=i.transformTo(t,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(r)}var o=this.findExtraFieldUnicodeComment();if(null!==o)this.fileCommentStr=o;else{var a=i.transformTo(t,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(a)}}},findExtraFieldUnicodePath:function(){var t=this.extraFields[28789];if(t){var n=o(t.value);return 1!==n.readInt(1)||c(this.fileName)!==n.readInt(4)?null:u.utf8decode(n.readData(t.length-5))}return null},findExtraFieldUnicodeComment:function(){var t=this.extraFields[25461];if(t){var n=o(t.value);return 1!==n.readInt(1)||c(this.fileComment)!==n.readInt(4)?null:u.utf8decode(n.readData(t.length-5))}return null}},t.exports=ZipEntry},function(t,n,r){"use strict";r.r(n),r.d(n,"Bone2D",(function(){return Bone2D})),r.d(n,"Bone3D",(function(){return Bone3D})),r.d(n,"Chain2D",(function(){return Chain2D})),r.d(n,"Chain3D",(function(){return Chain3D})),r.d(n,"DOWN",(function(){return I})),r.d(n,"END",(function(){return S})),r.d(n,"GLOBAL_ABSOLUTE",(function(){return _})),r.d(n,"GLOBAL_HINGE",(function(){return m})),r.d(n,"GLOBAL_ROTOR",(function(){return y})),r.d(n,"HISolver",(function(){return HISolver})),r.d(n,"IKSolver",(function(){return IKSolver})),r.d(n,"J_BALL",(function(){return x})),r.d(n,"J_GLOBAL",(function(){return O})),r.d(n,"J_LOCAL",(function(){return P})),r.d(n,"Joint2D",(function(){return Joint2D})),r.d(n,"Joint3D",(function(){return Joint3D})),r.d(n,"LEFT",(function(){return z})),r.d(n,"LOCAL_ABSOLUTE",(function(){return w})),r.d(n,"LOCAL_HINGE",(function(){return g})),r.d(n,"LOCAL_RELATIVE",(function(){return b})),r.d(n,"LOCAL_ROTOR",(function(){return v})),r.d(n,"M3",(function(){return M3})),r.d(n,"MAX_VALUE",(function(){return l})),r.d(n,"NONE",(function(){return d})),r.d(n,"PI",(function(){return p})),r.d(n,"PRECISION",(function(){return c})),r.d(n,"PRECISION_DEG",(function(){return u})),r.d(n,"REVISION",(function(){return a})),r.d(n,"RIGHT",(function(){return k})),r.d(n,"START",(function(){return C})),r.d(n,"Structure2D",(function(){return Structure2D})),r.d(n,"Structure3D",(function(){return Structure3D})),r.d(n,"TODEG",(function(){return h})),r.d(n,"TORAD",(function(){return f})),r.d(n,"UP",(function(){return M})),r.d(n,"V2",(function(){return V2})),r.d(n,"V3",(function(){return V3})),r.d(n,"X_AXE",(function(){return A})),r.d(n,"X_NEG",(function(){return T})),r.d(n,"Y_AXE",(function(){return E})),r.d(n,"Y_NEG",(function(){return R})),r.d(n,"Z_AXE",(function(){return j})),r.d(n,"Z_NEG",(function(){return B})),r.d(n,"_Math",(function(){return i})),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(t),r=1;r<arguments.length;r++){var o=arguments[r];if(null!=o)for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(n[i]=o[i])}return n});var o,Tools_error=function(t){console.error(t)},i={toRad:Math.PI/180,toDeg:180/Math.PI,pi90:.5*Math.PI,findAngle:function(t,n){var r,o,i=t.end.minus(n.end).lengthSq(),a=t.end.minus(t.start).lengthSq();return r=(o=(i+a-n.end.minus(t.start).lengthSq())/Math.sqrt(4*i*a))<=-1?Math.PI:o>=1?0:Math.acos(o),t.end.x*n.end.y-t.end.y*n.end.x>=0?r:-r},clamp:function(t,n,r){return t=(t=t<n?n:t)>r?r:t},lerp:function(t,n,r){return(1-r)*t+r*n},rand:function(t,n){return t+Math.random()*(n-t)},randInt:function(t,n){return t+Math.floor(Math.random()*(n-t+1))},nearEquals:function(t,n,r){return Math.abs(t-n)<=r},perpendicular:function(t,n){return!!i.nearEquals(t.dot(n),0,.01)},genPerpendicularVectorQuick:function(t){var n=t.clone();return Math.abs(t.y)<.99?n.set(-t.z,0,t.x).normalize():n.set(0,t.z,-t.y).normalize()},genPerpendicularVectorFrisvad:function(t){var n=t.clone();if(t.z<-.9999999)return n.set(0,-1,0);var r=1/(1+t.z);return n.set(1-t.x*t.x*r,-t.x*t.y*r,-t.x).normalize()},rotateXDegs:function(t,n){return t.clone().rotate(n*i.toRad,"X")},rotateYDegs:function(t,n){return t.clone().rotate(n*i.toRad,"Y")},rotateZDegs:function(t,n){return t.clone().rotate(n*i.toRad,"Z")},withinManhattanDistance:function(t,n,r){return!(Math.abs(n.x-t.x)>r)&&(!(Math.abs(n.y-t.y)>r)&&!(Math.abs(n.z-t.z)>r))},manhattanDistanceBetween:function(t,n){return Math.abs(n.x-t.x)+Math.abs(n.x-t.x)+Math.abs(n.x-t.x)},distanceBetween:function(t,n){var r=n.x-t.x,o=n.y-t.y,i=void 0!==t.z?n.z-t.z:0;return Math.sqrt(r*r+o*o+i*i)},rotateDegs:function(t,n){return t.clone().rotate(n*i.toRad)},validateDirectionUV:function(t){t.length()<0&&Tools_error("vector direction unit vector cannot be zero.")},validateLength:function(t){t<0&&Tools_error("Length must be a greater than or equal to zero.")}};function V2(t,n){this.x=t||0,this.y=n||0}function V3(t,n,r){this.x=t||0,this.y=n||0,this.z=r||0}function M3(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("M3: the constructor no longer reads arguments. use .set() instead.")}Object.assign(V2.prototype,{isVector2:!0,set:function(t,n){return this.x=t||0,this.y=n||0,this},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var n=this.x-t.x,r=this.y-t.y;return n*n+r*r},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divideScalar:function(t){return this.multiplyScalar(1/t)},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length()||1)},normalised:function(){return new V2(this.x,this.y).normalize()},lengthSq:function(){return this.x*this.x+this.y*this.y},add:function(t){return this.x+=t.x,this.y+=t.y,this},plus:function(t){return new V2(this.x+t.x,this.y+t.y)},min:function(t){return this.x-=t.x,this.y-=t.y,this},minus:function(t){return new V2(this.x-t.x,this.y-t.y)},divideBy:function(t){return new V2(this.x,this.y).divideScalar(t)},dot:function(t,n){return this.x*t.x+this.y*t.y},negate:function(){return this.x=-this.x,this.y=-this.y,this},negated:function(){return new V2(-this.x,-this.y)},clone:function(){return new V2(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},cross:function(t){return this.x*t.y-this.y*t.x},sign:function(t){return this.cross(t)>=0?1:-1},approximatelyEquals:function(t,n){if(n<0)return!1;var r=Math.abs(this.x-t.x),o=Math.abs(this.y-t.y);return r<n&&o<n},rotate:function(t){var n=Math.cos(t),r=Math.sin(t),o=this.x*n-this.y*r,i=this.x*r+this.y*n;return this.x=o,this.y=i,this},angleTo:function(t){var n=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return n<=-1?Math.PI:n>=1?0:Math.acos(n)},getSignedAngle:function(t){var n=this.angleTo(t);return 1===this.sign(t)?n:-n},constrainedUV:function(t,n,r){var o=t.getSignedAngle(this);return o>r&&this.copy(t).rotate(r),o<n&&this.copy(t).rotate(n),this}}),Object.assign(V3.prototype,{isVector3:!0,set:function(t,n,r){return this.x=t||0,this.y=n||0,this.z=r||0,this},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){var n=this.x-t.x,r=this.y-t.y,o=this.z-t.z;return n*n+r*r+o*o},abs:function(){return new V3(this.x<0?-this.x:this.x,this.y<0?-this.y:this.y,this.z<0?-this.z:this.z)},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},normalize:function(){return this.divideScalar(this.length()||1)},normalised:function(){return new V3(this.x,this.y,this.z).normalize()},add:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},min:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},plus:function(t){return new V3(this.x+t.x,this.y+t.y,this.z+t.z)},minus:function(t){return new V3(this.x-t.x,this.y-t.y,this.z-t.z)},divideBy:function(t){return new V3(this.x/t,this.y/t,this.z/t)},multiply:function(t){return new V3(this.x*t,this.y*t,this.z*t)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},divideScalar:function(t){return this.multiplyScalar(1/t)},cross:function(t){return new V3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)},crossVectors:function(t,n){var r=t.x,o=t.y,i=t.z,a=n.x,c=n.y,u=n.z;return this.x=o*u-i*c,this.y=i*a-r*u,this.z=r*c-o*a,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},negated:function(){return new V3(-this.x,-this.y,-this.z)},clone:function(){return new V3(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},approximatelyEquals:function(t,n){if(n<0)return!1;var r=Math.abs(this.x-t.x),o=Math.abs(this.y-t.y),i=Math.abs(this.z-t.z);return r<n&&o<n&&i<n},zero:function(){return this.x=0,this.y=0,this.z=0,this},rotate:function(t,n){var r,o,i,a=Math.cos(t),c=Math.sin(t);switch(n){case"X":r=this.x,o=this.y*a-this.z*c,i=this.y*c+this.z*a;break;case"Y":r=this.z*c+this.x*a,o=this.y,i=this.z*a-this.x*c;break;case"Z":r=this.x*a-this.y*c,o=this.x*c+this.y*a,i=this.z}return this.x=r,this.y=o,this.z=i,this},projectOnVector:function(t){var n=t.dot(this)/t.lengthSq();return this.copy(t).multiplyScalar(n)},projectOnPlane:(o=new V3,function projectOnPlane(t){return o.copy(this).projectOnVector(t.normalised()),this.min(o).normalize()}),applyM3:function(t){var n=this.x,r=this.y,o=this.z,i=t.elements;return this.x=i[0]*n+i[1]*r+i[2]*o,this.y=i[3]*n+i[4]*r+i[5]*o,this.z=i[6]*n+i[7]*r+i[8]*o,this.normalize()},applyMatrix3:function(t){var n=this.x,r=this.y,o=this.z,i=t.elements;return this.x=i[0]*n+i[3]*r+i[6]*o,this.y=i[1]*n+i[4]*r+i[7]*o,this.z=i[2]*n+i[5]*r+i[8]*o,this},applyQuaternion:function(t){var n=this.x,r=this.y,o=this.z,i=t.x,a=t.y,c=t.z,u=t.w,l=u*n+a*o-c*r,p=u*r+c*n-i*o,f=u*o+i*r-a*n,h=-i*n-a*r-c*o;return this.x=l*u+h*-i+p*-c-f*-a,this.y=p*u+h*-a+f*-i-l*-c,this.z=f*u+h*-c+l*-a-p*-i,this},sign:function(t,n){return this.cross(t).dot(n)>=0?1:-1},angleTo:function(t){var n=this.dot(t)/Math.sqrt(this.lengthSq()*t.lengthSq());return n<=-1?Math.PI:n>=1?0:Math.acos(n)},getSignedAngle:function(t,n){var r=this.angleTo(t);return 1===this.sign(t,n)?r:-r},constrainedUV:function(t,n,r,o,i){var a=t.getSignedAngle(this,n);return a>i&&this.copy(r.rotateAboutAxis(t,i,n)),a<o&&this.copy(r.rotateAboutAxis(t,o,n)),this},limitAngle:function(t,n,r){if(t.angleTo(this)>r){var o=t.normalised().cross(this).normalize();this.copy(n.rotateAboutAxis(t,r,o))}return this}}),Object.assign(M3.prototype,{isMatrix3:!0,set:function(t,n,r,o,i,a,c,u,l){var p=this.elements;return p[0]=t,p[1]=o,p[2]=c,p[3]=n,p[4]=i,p[5]=u,p[6]=r,p[7]=a,p[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},setV3:function(t,n,r){var o=this.elements;return o[0]=t.x,o[3]=t.y,o[6]=t.z,o[1]=n.x,o[4]=n.y,o[7]=n.z,o[2]=r.x,o[5]=r.y,o[8]=r.z,this},transpose:function(){var t,n=this.elements;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this},createRotationMatrix:function(t){var n=t,r=new V3(1,0,0),o=new V3(0,1,0);if(t.z<-.9999999)r.set(1,0,0),o.set(0,1,0);else{var i=1/(1+n.z),a=-n.x*n.y*i;r.set(1-n.x*n.x*i,a,-n.x).normalize(),o.set(a,1-n.y*n.y*i,-n.y).normalize()}return this.setV3(r,o,n)},rotateAboutAxis:function(t,n,r){var o=Math.sin(n),i=Math.cos(n),a=1-i,c=r.x*r.y*a,u=r.x*r.z*a,l=r.y*r.z*a,p=this.elements;return p[0]=r.x*r.x*a+i,p[3]=c+r.z*o,p[6]=u-r.y*o,p[1]=c-r.z*o,p[4]=r.y*r.y*a+i,p[7]=l+r.x*o,p[2]=u+r.y*o,p[5]=l-r.x*o,p[8]=r.z*r.z*a+i,t.clone().applyM3(this)}});var a="1.3.3",c=.001,u=.01,l=1/0,p=Math.PI,f=Math.PI/180,h=180/Math.PI,d=1,y=2,m=3,v=4,g=5,_=6,b=7,w=8,x=10,P=11,O=12,C=20,S=21,A=new V3(1,0,0),E=new V3(0,1,0),j=new V3(0,0,1),T=new V3(-1,0,0),R=new V3(0,-1,0),B=new V3(0,0,-1),M=new V2(0,1),I=new V2(0,-1),z=new V2(-1,0),k=new V2(1,0);function Joint3D(){this.rotor=p,this.min=-p,this.max=p,this.freeHinge=!0,this.rotationAxisUV=new V3,this.referenceAxisUV=new V3,this.type=x}function Bone3D(t,n,r,o,i){this.joint=new Joint3D,this.start=new V3,this.end=new V3,this.boneConnectionPoint=S,this.length=0,this.color=i||16777215,this.name="",this.init(t,n,r,o)}function Chain3D(t){this.tmpTarget=new V3,this.tmpMtx=new M3,this.bones=[],this.name="",this.color=t||16777215,this.solveDistanceThreshold=1,this.minIterationChange=.01,this.maxIteration=20,this.precision=.001,this.chainLength=0,this.numBones=0,this.baseLocation=new V3,this.fixedBaseMode=!0,this.baseboneConstraintType=d,this.baseboneConstraintUV=new V3,this.baseboneRelativeConstraintUV=new V3,this.baseboneRelativeReferenceConstraintUV=new V3,this.lastTargetLocation=new V3(l,l,l),this.lastBaseLocation=new V3(l,l,l),this.currentSolveDistance=l,this.connectedChainNumber=-1,this.connectedBoneNumber=-1,this.boneConnectionPoint=S,this.isFullForward=!1,this.embeddedTarget=new V3,this.useEmbeddedTarget=!1}function Structure3D(){this.fixedBaseMode=!0,this.chains=[],this.targets=[],this.numChains=0,this.tmpMtx=new FIK.M3}function Joint2D(t,n,r){this.coordinateSystem=r||P,t<0&&(t*=-1),this.min=void 0!==t?-t*f:-p,this.max=void 0!==n?n*f:p}function Bone2D(t,n,r,o,i,a,c){this.start=new V2,this.end=new V2,this.length=o||0,this.joint=new Joint2D(i,a),this.globalConstraintUV=new V2(1,0),this.boneConnectionPoint=S,this.color=c||null,this.name="",this.setStartLocation(t),n?(this.setEndLocation(n),0===this.length&&(this.length=this.getLength())):r&&this.setEndLocation(this.start.plus(r.normalised().multiplyScalar(this.length)))}function Chain2D(t){this.tmpTarget=new V2,this.bones=[],this.name="",this.solveDistanceThreshold=1,this.minIterationChange=.01,this.maxIteration=15,this.precision=.001,this.chainLength=0,this.numBones=0,this.baseLocation=new V2,this.fixedBaseMode=!0,this.baseboneConstraintType=d,this.baseboneConstraintUV=new V2,this.baseboneRelativeConstraintUV=new V2,this.lastTargetLocation=new V2(l,l),this.lastBaseLocation=new V2(l,l),this.boneConnectionPoint=S,this.currentSolveDistance=l,this.connectedChainNumber=-1,this.connectedBoneNumber=-1,this.color=t||16777215,this.embeddedTarget=new V2,this.useEmbeddedTarget=!1}function Structure2D(){this.fixedBaseMode=!0,this.chains=[],this.targets=[],this.numChains=0}function IKSolver(t){this.startBones=null,this.endBones=null,this.target=null,this.goal=null,this.swivelAngle=0,this.iteration=40,this.thresholds={position:.1,rotation:.1},this.solver=null,this.chain=null}function HISolver(t){this.startBones=null,this.endBones=null,this.scene=t.scene,this.target=null,this.goal=null,this.swivelAngle=0,this.iteration=15,this.thresholds={position:.1,rotation:.1},this.solver=new FIK.Structure2D(this.scene),this.bones=[],this.numBones=0,this.rotation=[],this.initStructure(t)}Object.assign(Joint3D.prototype,{isJoint3D:!0,clone:function(){var t=new Joint3D;return t.type=this.type,t.rotor=this.rotor,t.max=this.max,t.min=this.min,t.freeHinge=this.freeHinge,t.rotationAxisUV.copy(this.rotationAxisUV),t.referenceAxisUV.copy(this.referenceAxisUV),t},testAngle:function(){this.max===p&&this.min===-p?this.freeHinge=!0:this.freeHinge=!1},validateAngle:function(t){return t=(t=t<0?0:t)>180?180:t},setAsBallJoint:function(t){this.rotor=this.validateAngle(t)*f,this.type=x},setHinge:function(t,n,r,o,i){this.type=t,r<0&&(r*=-1),this.min=-this.validateAngle(r)*f,this.max=this.validateAngle(o)*f,this.testAngle(),this.rotationAxisUV.copy(n).normalize(),this.referenceAxisUV.copy(i).normalize()},getHingeReferenceAxis:function(){return this.referenceAxisUV},getHingeRotationAxis:function(){return this.rotationAxisUV},setBallJointConstraintDegs:function(t){this.rotor=this.validateAngle(t)*f},setHingeClockwise:function(t){t<0&&(t*=-1),this.min=-this.validateAngle(t)*f,this.testAngle()},setHingeAnticlockwise:function(t){this.max=this.validateAngle(t)*f,this.testAngle()}}),Object.assign(Bone3D.prototype,{isBone3D:!0,init:function(t,n,r,o){this.setStartLocation(t),n?(this.setEndLocation(n),this.length=this.getLength()):(this.setLength(o),this.setEndLocation(this.start.plus(r.normalised().multiplyScalar(o))))},clone:function(){var t=new Bone3D(this.start,this.end);return t.joint=this.joint.clone(),t},setColor:function(t){this.color=t},setBoneConnectionPoint:function(t){this.boneConnectionPoint=t},setHingeClockwise:function(t){this.joint.setHingeClockwise(t)},setHingeAnticlockwise:function(t){this.joint.setHingeAnticlockwise(t)},setBallJointConstraintDegs:function(t){this.joint.setBallJointConstraintDegs(t)},setStartLocation:function(t){this.start.copy(t)},setEndLocation:function(t){this.end.copy(t)},setLength:function(t){t>0&&(this.length=t)},setJoint:function(t){this.joint=t},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getDirectionUV:function(){return this.end.minus(this.start).normalize()},getLength:function(){return this.start.distanceTo(this.end)}}),Object.assign(Chain3D.prototype,{isChain3D:!0,clone:function(){var t=new Chain3D;return t.solveDistanceThreshold=this.solveDistanceThreshold,t.minIterationChange=this.minIterationChange,t.maxIteration=this.maxIteration,t.precision=this.precision,t.bones=this.cloneBones(),t.baseLocation.copy(this.baseLocation),t.lastTargetLocation.copy(this.lastTargetLocation),t.lastBaseLocation.copy(this.lastBaseLocation),this.baseboneConstraintType!==d&&(t.baseboneConstraintUV.copy(this.baseboneConstraintUV),t.baseboneRelativeConstraintUV.copy(this.baseboneRelativeConstraintUV)),t.fixedBaseMode=this.fixedBaseMode,t.chainLength=this.chainLength,t.numBones=this.numBones,t.currentSolveDistance=this.currentSolveDistance,t.boneConnectionPoint=this.boneConnectionPoint,t.connectedChainNumber=this.connectedChainNumber,t.connectedBoneNumber=this.connectedBoneNumber,t.baseboneConstraintType=this.baseboneConstraintType,t.color=this.color,t.embeddedTarget=this.embeddedTarget.clone(),t.useEmbeddedTarget=this.useEmbeddedTarget,t},clear:function(){for(var t=this.numBones;t--;)this.removeBone(t);this.numBones=0},addBone:function(t){t.setColor(this.color),this.bones.push(t),this.numBones++,1===this.numBones&&(this.baseLocation.copy(t.start),this.baseboneConstraintUV.copy(t.getDirectionUV())),this.updateChainLength()},removeBone:function(t){t<this.numBones&&(this.bones.splice(t,1),this.numBones--,this.updateChainLength())},addConsecutiveBone:function(t,n){this.numBones>0&&this.addBone(new Bone3D(this.bones[this.numBones-1].end,void 0,t.normalised(),n))},addConsecutiveFreelyRotatingHingedBone:function(t,n,r,o){this.addConsecutiveHingedBone(t,n,r,o,180,180,i.genPerpendicularVectorQuick(o))},addConsecutiveHingedBone:function(t,n,r,o,i,a,c){if(0!==this.numBones){var u=t.normalised(),l=o.normalised(),p=new Bone3D(this.bones[this.numBones-1].end,void 0,u,n,this.color);r=r||"global",p.joint.setHinge("global"===r?O:P,l,i,a,c),this.addBone(p)}},addConsecutiveRotorConstrainedBone:function(t,n,r){if(0!==this.numBones){t=t.normalised();var o=new Bone3D(this.bones[this.numBones-1].end,void 0,t,n);o.joint.setAsBallJoint(r),this.addBone(o)}},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getConnectedBoneNumber:function(){return this.connectedBoneNumber},getConnectedChainNumber:function(){return this.connectedChainNumber},getBaseboneConstraintType:function(){return this.baseboneConstraintType},getBaseboneConstraintUV:function(){if(this.baseboneConstraintType!==d)return this.baseboneConstraintUV},getBaseLocation:function(){return this.bones[0].start},getEffectorLocation:function(){return this.bones[this.numBones-1].end},getLastTargetLocation:function(){return this.lastTargetLocation},getLiveChainLength:function(){for(var t=0,n=this.numBones;n--;)t+=this.bones[n].getLength();return t},getBaseboneRelativeReferenceConstraintUV:function(){return this.baseboneRelativeReferenceConstraintUV},setConnectedBoneNumber:function(t){this.connectedBoneNumber=t},setConnectedChainNumber:function(t){this.connectedChainNumber=t},setBoneConnectionPoint:function(t){this.boneConnectionPoint=t},setColor:function(t){this.color=t;for(var n=this.numBones;n--;)this.bones[n].setColor(this.color)},setBaseboneRelativeConstraintUV:function(t){this.baseboneRelativeConstraintUV=t.normalised()},setBaseboneRelativeReferenceConstraintUV:function(t){this.baseboneRelativeReferenceConstraintUV=t.normalised()},setBaseboneConstraintUV:function(t){this.baseboneConstraintUV=t.normalised()},setRotorBaseboneConstraint:function(t,n,r){0!==this.numBones?n.length()>0?(t=t||"global",this.baseboneConstraintType="global"===t?y:v,this.baseboneConstraintUV=n.normalised(),this.baseboneRelativeConstraintUV.copy(this.baseboneConstraintUV),this.bones[0].joint.setAsBallJoint(r)):Tools_error("Constraint axis cannot be zero."):Tools_error("Chain must contain a basebone before we can specify the basebone constraint type.")},setHingeBaseboneConstraint:function(t,n,r,o,a){0!==this.numBones?n.length()<=0?Tools_error("Hinge rotation axis cannot be zero."):a.length()<=0?Tools_error("Hinge reference axis cannot be zero."):i.perpendicular(n,a)?(t=t||"global",this.baseboneConstraintType="global"===t?m:g,this.baseboneConstraintUV=n.normalised(),this.bones[0].joint.setHinge("global"===t?O:P,n,r,o,a)):Tools_error("The hinge reference axis must be in the plane of the hinge rotation axis, that is, they must be perpendicular."):Tools_error("Chain must contain a basebone before we can specify the basebone constraint type.")},setFreelyRotatingGlobalHingedBasebone:function(t){this.setHingeBaseboneConstraint("global",t,180,180,i.genPerpendicularVectorQuick(t))},setGlobalHingedBasebone:function(t,n,r,o){this.setHingeBaseboneConstraint("global",t,n,r,o)},setFreelyRotatingLocalHingedBasebone:function(t){this.setHingeBaseboneConstraint("local",t,180,180,i.genPerpendicularVectorQuick(t))},setLocalHingedBasebone:function(t,n,r,o){this.setHingeBaseboneConstraint("local",t,n,r,o)},setBaseLocation:function(t){this.baseLocation.copy(t)},setFixedBaseMode:function(t){(t||-1===this.connectedChainNumber)&&(this.baseboneConstraintType!==y||t)&&(this.fixedBaseMode=t)},setMaxIterationAttempts:function(t){t<1||(this.maxIteration=t)},setMinIterationChange:function(t){t<0||(this.minIterationChange=t)},setSolveDistanceThreshold:function(t){t<0||(this.solveDistanceThreshold=t)},solveForEmbeddedTarget:function(){if(this.useEmbeddedTarget)return this.solveForTarget(this.embeddedTarget)},resetTarget:function(){this.lastBaseLocation=new V3(l,l,l),this.currentSolveDistance=l},solveForTarget:function(t){this.tmpTarget.set(t.x,t.y,t.z);var n,r=this.precision,o=this.lastBaseLocation.approximatelyEquals(this.baseLocation,r);if(this.lastTargetLocation.approximatelyEquals(this.tmpTarget,r)&&o)return this.currentSolveDistance;var i=null;o?(n=this.bones[this.numBones-1].end.distanceTo(this.tmpTarget),i=this.cloneBones()):n=l;for(var a,c=[],u=l,p=l,f=this.maxIteration;f--;){if((a=this.solveIK(this.tmpTarget))<u){if(u=a,c=this.cloneBones(),a<=this.solveDistanceThreshold)break}else if(Math.abs(a-p)<this.minIterationChange)break;p=a}return u<n?(this.currentSolveDistance=u,this.bones=c):(this.currentSolveDistance=n,this.bones=i),this.lastBaseLocation.copy(this.baseLocation),this.lastTargetLocation.copy(this.tmpTarget),this.currentSolveDistance},solveIK:function(t){if(0!==this.numBones){for(var n,r,o,i,a=this.tmpMtx,c=this.numBones;c--;)if(r=(n=this.bones[c]).length,i=(o=n.joint).type,c!==this.numBones-1){var u=this.bones[c+1].getDirectionUV().negate(),l=n.getDirectionUV().negate();switch(i){case x:l.limitAngle(u,a,o.rotor);break;case O:b=o.getHingeRotationAxis(),l.projectOnPlane(b);break;case P:c>0?(a.createRotationMatrix(this.bones[c-1].getDirectionUV()),b=o.getHingeRotationAxis().clone().applyM3(a)):b=this.baseboneRelativeConstraintUV,l.projectOnPlane(b)}var p=n.end.plus(l.multiplyScalar(r));n.setStartLocation(p),c>0&&this.bones[c-1].setEndLocation(p)}else{n.setEndLocation(t);l=n.getDirectionUV().negated();switch(i){case x:break;case O:b=o.getHingeRotationAxis(),l.projectOnPlane(b);break;case P:a.createRotationMatrix(this.bones[c-1].getDirectionUV()),b=o.getHingeRotationAxis().clone().applyM3(a),l.projectOnPlane(b)}p=t.plus(l.multiplyScalar(r));n.setStartLocation(p),c>0&&this.bones[c-1].setEndLocation(p)}for(c=0;c<this.numBones;c++)if(r=(n=this.bones[c]).length,i=(o=n.joint).type,0!==c){var f=n.getDirectionUV(),h=this.bones[c-1].getDirectionUV();switch(i){case x:f.limitAngle(h,a,o.rotor);break;case O:b=o.getHingeRotationAxis(),w=o.getHingeReferenceAxis(),f.projectOnPlane(b),o.freeHinge||f.constrainedUV(w,b,a,o.min,o.max);break;case P:a.createRotationMatrix(h),b=o.getHingeRotationAxis().clone().applyM3(a),w=o.getHingeReferenceAxis().clone().applyM3(a),f.projectOnPlane(b),o.freeHinge||f.constrainedUV(w,b,a,o.min,o.max)}var _=n.start.plus(f.multiplyScalar(r));n.setEndLocation(_),c<this.numBones-1&&this.bones[c+1].setStartLocation(_)}else{this.fixedBaseMode?n.setStartLocation(this.baseLocation):n.setStartLocation(n.end.minus(n.getDirectionUV().multiplyScalar(r)));var b,w;f=n.getDirectionUV();switch(this.baseboneConstraintType){case d:break;case y:f.limitAngle(this.baseboneConstraintUV,a,o.rotor);break;case v:f.limitAngle(this.baseboneRelativeConstraintUV,a,o.rotor);break;case m:b=o.getHingeRotationAxis(),w=o.getHingeReferenceAxis(),f.projectOnPlane(b),o.freeHinge||f.constrainedUV(w,b,a,o.min,o.max);break;case g:b=this.baseboneRelativeConstraintUV,w=this.baseboneRelativeReferenceConstraintUV,f.projectOnPlane(b),o.freeHinge||f.constrainedUV(w,b,a,o.min,o.max)}_=n.start.plus(f.multiplyScalar(r));n.setEndLocation(_),this.numBones>1&&this.bones[1].setStartLocation(_)}return this.lastTargetLocation.copy(t),this.bones[this.numBones-1].end.distanceTo(t)}},updateChainLength:function(){this.chainLength=0;for(var t=this.numBones;t--;)this.chainLength+=this.bones[t].length},cloneBones:function(){for(var t=[],n=0,r=this.bones.length;n<r;n++)t.push(this.bones[n].clone());return t}}),Object.assign(Structure3D.prototype,{update:function(){for(var t,n,r,o,i,a=0;a<this.numChains;a++){if(t=this.chains[a],n=this.targets[a],-1!==(r=t.getConnectedChainNumber()))switch(o=this.chains[r].bones[t.getConnectedBoneNumber()],t.setBaseLocation(t.getBoneConnectionPoint()===C?o.start:o.end),i=t.getBaseboneConstraintType()){case d:case y:case m:break;case v:case g:this.tmpMtx.createRotationMatrix(o.getDirectionUV());var c=t.getBaseboneConstraintUV().clone().applyM3(this.tmpMtx);t.setBaseboneRelativeConstraintUV(c),i===g&&t.setBaseboneRelativeReferenceConstraintUV(t.bones[0].joint.getHingeReferenceAxis().clone().applyM3(this.tmpMtx))}t.useEmbeddedTarget?t.solveForEmbeddedTarget():t.solveForTarget(n)}},clear:function(){var t;for(t=this.numChains;t--;)this.remove(t);this.chains=[],this.targets=[]},add:function(t,n){this.chains.push(t),this.targets.push(n),this.numChains++},remove:function(t){this.chains[t].clear(),this.chains.splice(t,1),this.targets.splice(t,1),this.numChains--},setFixedBaseMode:function(t){this.fixedBaseMode=t;for(var n=this.numChains;n--;)-1===this.chains[n].getConnectedChainNumber()&&this.chains[n].setFixedBaseMode(this.fixedBaseMode)},getNumChains:function(){return this.numChains},getChain:function(t){return this.chains[t]},connectChain:function(t,n,r,o,i,a,c){var u=n,l=r;if(!(n>this.numChains||r>this.chains[n].numBones)){var p=t.clone();void 0!==c&&p.setColor(c),p.setBoneConnectionPoint("end"===o?S:C),p.setConnectedChainNumber(u),p.setConnectedBoneNumber(l);var f="end"===o?this.chains[u].bones[l].end:this.chains[u].bones[l].start;p.setBaseLocation(f),p.setFixedBaseMode(!0);for(var h=0;h<p.numBones;h++)p.bones[h].start.add(f),p.bones[h].end.add(f);this.add(p,i,a)}}}),Object.assign(Joint2D.prototype,{isJoint2D:!0,clone:function(){var t=new Joint2D;return t.coordinateSystem=this.coordinateSystem,t.max=this.max,t.min=this.min,t},validateAngle:function(t){return t=(t=t<0?0:t)>180?180:t},set:function(t){this.max=t.max,this.min=t.min,this.coordinateSystem=t.coordinateSystem},setClockwiseConstraintDegs:function(t){t<0&&(t*=-1),this.min=-this.validateAngle(t)*f},setAnticlockwiseConstraintDegs:function(t){this.max=this.validateAngle(t)*f},setConstraintCoordinateSystem:function(t){this.coordinateSystem=t},getConstraintCoordinateSystem:function(){return this.coordinateSystem}}),Object.assign(Bone2D.prototype,{isBone2D:!0,clone:function(){var t=new Bone2D(this.start,this.end);return t.length=this.length,t.globalConstraintUV=this.globalConstraintUV,t.boneConnectionPoint=this.boneConnectionPoint,t.joint=this.joint.clone(),t.color=this.color,t.name=this.name,t},setName:function(t){this.name=t},setColor:function(t){this.color=t},setBoneConnectionPoint:function(t){this.boneConnectionPoint=t},setStartLocation:function(t){this.start.copy(t)},setEndLocation:function(t){this.end.copy(t)},setLength:function(t){t>0&&(this.length=t)},setGlobalConstraintUV:function(t){this.globalConstraintUV=t},setJoint:function(t){this.joint=t},setClockwiseConstraintDegs:function(t){this.joint.setClockwiseConstraintDegs(t)},setAnticlockwiseConstraintDegs:function(t){this.joint.setAnticlockwiseConstraintDegs(t)},setJointConstraintCoordinateSystem:function(t){this.joint.setConstraintCoordinateSystem(t)},getGlobalConstraintUV:function(){return this.globalConstraintUV},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getDirectionUV:function(){return this.end.minus(this.start).normalize()},getLength:function(){return this.start.distanceTo(this.end)}}),Object.assign(Chain2D.prototype,{isChain2D:!0,clone:function(){var t=new Chain2D;return t.solveDistanceThreshold=this.solveDistanceThreshold,t.minIterationChange=this.minIterationChange,t.maxIteration=this.maxIteration,t.precision=this.precision,t.bones=this.cloneBones(),t.baseLocation.copy(this.baseLocation),t.lastTargetLocation.copy(this.lastTargetLocation),t.lastBaseLocation.copy(this.lastBaseLocation),this.baseboneConstraintType!==d&&(t.baseboneConstraintUV.copy(this.baseboneConstraintUV),t.baseboneRelativeConstraintUV.copy(this.baseboneRelativeConstraintUV)),t.fixedBaseMode=this.fixedBaseMode,t.chainLength=this.chainLength,t.numBones=this.numBones,t.currentSolveDistance=this.currentSolveDistance,t.boneConnectionPoint=this.boneConnectionPoint,t.connectedChainNumber=this.connectedChainNumber,t.connectedBoneNumber=this.connectedBoneNumber,t.baseboneConstraintType=this.baseboneConstraintType,t.color=this.color,t.embeddedTarget=this.embeddedTarget.clone(),t.useEmbeddedTarget=this.useEmbeddedTarget,t},clear:function(){for(var t=this.numBones;t--;)this.removeBone(t)},addBone:function(t){null===t.color&&t.setColor(this.color),this.bones.push(t),0===this.numBones&&(this.baseLocation.copy(t.start),this.baseboneConstraintUV.copy(t.getDirectionUV())),this.numBones++,this.updateChainLength()},removeBone:function(t){t<this.numBones&&(this.bones.splice(t,1),this.numBones--,this.updateChainLength())},addConsecutiveBone:function(t,n,r,o,a){if(0!==this.numBones){if(t.isBone2D){var c=t,u=c.getDirectionUV();i.validateDirectionUV(u);var l=c.length;i.validateLength(l);var p=this.bones[this.numBones-1].end;c.setStartLocation(p),c.setEndLocation(p.plus(u.multiplyScalar(l))),this.addBone(c)}else if(t.isVector2){a=a||this.color,i.validateDirectionUV(t),i.validateLength(n);p=this.bones[this.numBones-1].end;this.addBone(new Bone2D(p,null,t.normalised(),n,r,o,a))}}else Tools_error("Chain is empty ! need first bone")},getBoneConnectionPoint:function(){return this.boneConnectionPoint},getConnectedBoneNumber:function(){return this.connectedBoneNumber},getConnectedChainNumber:function(){return this.connectedChainNumber},getEmbeddedTarget:function(){return this.embeddedTarget},getBaseboneConstraintType:function(){return this.baseboneConstraintType},getBaseboneConstraintUV:function(){if(this.baseboneConstraintType!==d)return this.baseboneConstraintUV},getBaseLocation:function(){return this.bones[0].start},getEffectorLocation:function(){return this.bones[this.numBones-1].end},getLastTargetLocation:function(){return this.lastTargetLocation},getLiveChainLength:function(){for(var t=0,n=this.numBones;n--;)t+=this.bones[n].getLength();return t},setColor:function(t){this.color=t;for(var n=this.numBones;n--;)this.bones[n].setColor(this.color)},setBaseboneRelativeConstraintUV:function(t){this.baseboneRelativeConstraintUV=t},setConnectedBoneNumber:function(t){this.connectedBoneNumber=t},setConnectedChainNumber:function(t){this.connectedChainNumber=t},setBoneConnectionPoint:function(t){this.boneConnectionPoint=t},setBaseboneConstraintUV:function(t){i.validateDirectionUV(t),this.baseboneConstraintUV.copy(t.normalised())},setBaseLocation:function(t){this.baseLocation.copy(t)},setBaseboneConstraintType:function(t){this.baseboneConstraintType=t},setFixedBaseMode:function(t){(t||-1===this.connectedChainNumber)&&(this.baseboneConstraintType!==_||t)&&(this.fixedBaseMode=t)},setMaxIterationAttempts:function(t){t<1||(this.maxIteration=t)},setMinIterationChange:function(t){t<0||(this.minIterationChange=t)},setSolveDistanceThreshold:function(t){t<0||(this.solveDistanceThreshold=t)},solveForEmbeddedTarget:function(){if(this.useEmbeddedTarget)return this.solveForTarget(this.embeddedTarget)},resetTarget:function(){this.lastBaseLocation=new V2(l,l),this.currentSolveDistance=l},solveForTarget:function(t){this.tmpTarget.set(t.x,t.y);var n,r=this.precision,o=this.lastBaseLocation.approximatelyEquals(this.baseLocation,r);if(this.lastTargetLocation.approximatelyEquals(this.tmpTarget,r)&&o)return this.currentSolveDistance;var i=null;o?(n=this.bones[this.numBones-1].end.distanceTo(this.tmpTarget),i=this.cloneBones()):n=l;for(var a,c=[],u=l,p=l,f=this.maxIteration;f--;){if((a=this.solveIK(this.tmpTarget))<u){if(u=a,c=this.cloneBones(),a<=this.solveDistanceThreshold)break}else if(Math.abs(a-p)<this.minIterationChange)break;p=a}return u<n?(this.currentSolveDistance=u,this.bones=c):(this.currentSolveDistance=n,this.bones=i),this.lastBaseLocation.copy(this.baseLocation),this.lastTargetLocation.copy(this.tmpTarget),this.currentSolveDistance},solveIK:function(t){if(0!==this.numBones){for(var n,r,o,i,a,c,u,l=this.numBones;l--;)r=(n=this.bones[l]).length,l!==this.numBones-1?(o=this.bones[l+1],c=n.getDirectionUV().negate(),u=n.joint.coordinateSystem===P?o.getDirectionUV().negate():n.getGlobalConstraintUV().negated(),c.constrainedUV(u,o.joint.min,o.joint.max),i=n.end.plus(c.multiplyScalar(r)),n.setStartLocation(i),l>0&&this.bones[l-1].setEndLocation(i)):(n.setEndLocation(t),c=n.getDirectionUV().negate(),l>0?(u=n.joint.coordinateSystem===P?this.bones[l-1].getDirectionUV().negate():n.getGlobalConstraintUV().negated(),c.constrainedUV(u,n.joint.min,n.joint.max)):n.joint.coordinateSystem!==P&&(u=n.getGlobalConstraintUV().negated(),c.constrainedUV(u,n.joint.min,n.joint.max)),i=n.end.plus(c.multiplyScalar(r)),n.setStartLocation(i),l>0&&this.bones[l-1].setEndLocation(i));for(l=0;l<this.numBones;l++)r=(n=this.bones[l]).length,0!==l?(c=n.getDirectionUV(),u=n.joint.coordinateSystem===P?this.bones[l-1].getDirectionUV():n.getGlobalConstraintUV(),c.constrainedUV(u,n.joint.min,n.joint.max),a=n.start.plus(c.multiplyScalar(r)),n.setEndLocation(a),l<this.numBones-1&&this.bones[l+1].setStartLocation(a)):(this.fixedBaseMode?n.setStartLocation(this.baseLocation):(i=n.end.minus(n.getDirectionUV().multiplyScalar(r)),n.setStartLocation(i)),c=n.getDirectionUV(),this.baseboneConstraintType===d?(a=n.start.plus(c.multiplyScalar(r)),n.setEndLocation(a),this.numBones>1&&this.bones[1].setStartLocation(a)):(u=this.baseboneConstraintType===w?this.baseboneRelativeConstraintUV:this.baseboneConstraintUV,c.constrainedUV(u,n.joint.min,n.joint.max),a=n.start.plus(c.multiplyScalar(r)),n.setEndLocation(a),l<this.numBones-1&&this.bones[l+1].setStartLocation(a)));return this.lastTargetLocation.copy(t),this.bones[this.numBones-1].end.distanceTo(t)}},updateChainLength:function(){this.chainLength=0;for(var t=this.numBones;t--;)this.chainLength+=this.bones[t].length},cloneBones:function(){for(var t=[],n=0,r=this.bones.length;n<r;n++)t.push(this.bones[n].clone());return t}}),Object.assign(Structure2D.prototype,{isStructure2D:!0,update:function(){new THREE.Vector3;for(var t,n,r,o,i=0;i<this.numChains;i++){if(t=this.chains[i],n=this.targets[i]||null,r=t.getConnectedChainNumber(),o=t.getBaseboneConstraintType(),-1!==r&&o!==_){var a=this.chains[r].bones[t.getConnectedBoneNumber()];t.setBaseLocation(t.getBoneConnectionPoint()===C?a.start:a.end);var c=a.getDirectionUV();if(o===b)t.setBaseboneConstraintUV(c);else if(o===w){var u=M.getSignedAngle(c),l=t.getBaseboneConstraintUV().clone().rotate(u);t.setBaseboneRelativeConstraintUV(l)}}t.useEmbeddedTarget?console.log("embed",t.solveForEmbeddedTarget()):t.solveForTarget(n)}},setFixedBaseMode:function(t){this.fixedBaseMode=t;for(var n=this.numChains;n--;)-1===this.chains[n].getConnectedChainNumber()&&this.chains[n].setFixedBaseMode(this.fixedBaseMode)},clear:function(){var t;for(t=this.numChains;t--;)this.remove(t);this.chains=[],this.targets=[]},add:function(t,n){this.chains.push(t),this.numChains++,n&&this.targets.push(n)},remove:function(t){this.chains[t].clear(),this.chains.splice(t,1),this.targets.splice(t,1),this.numChains--},getNumChains:function(){return this.numChains},getChain:function(t){return this.chains[t]},connectChain:function(t,n,r,o,i,a,c){var u=n,l=r;if(o=o||"end",u>this.numChains)Tools_error("Chain not existe !");else if(l>this.chains[u].numBones)Tools_error("Bone not existe !");else{var p=t.clone();p.setBoneConnectionPoint("end"===o?S:C),p.setConnectedChainNumber(u),p.setConnectedBoneNumber(l);var f="end"===o?this.chains[u].bones[l].end:this.chains[u].bones[l].start;p.setBaseLocation(f),p.setFixedBaseMode(!0);for(var h=0;h<p.numBones;h++)p.bones[h].start.add(f),p.bones[h].end.add(f);this.add(p,i,a)}}}),Object.assign(IKSolver.prototype,{isIKSolver:!0}),Object.assign(HISolver.prototype,{isHISolver:!0,initStructure:function(t){this.startBones=t.start,this.endBones=t.end,this.angles=t.angles;var n=this.startBones,r=n.children[0];this.bones.push(n);for(var o=0;o<100;o++){if(this.bones.push(r),r===this.endBones){this.createChain();break}r=(n=r).children[0]}},createChain:function(){this.numBones=this.bones.length;var t=new Chain2D;t.setFixedBaseMode(!0),t.setBaseboneConstraintType(FIK.LOCAL_ABSOLUTE),this.fakeBone=new Bone2D(new V2(0,-1),new V2(0,0)),this.target=new THREE.Vector3;for(var n=new THREE.Vector3,r=new THREE.Vector3,o=new THREE.Vector3,i=new V2,a=0,c=0;c<this.numBones;c++)c>0&&(this.target.add(this.bones[c].position),a=n.distanceTo(this.bones[c].position),this.bones[c-1].getWorldPosition(r),this.bones[c].getWorldPosition(o),o.sub(r).normalize(),0===o.z?i.set(o.x,o.y):0===o.x&&i.set(o.z,o.y),1===c?t.addBone(new Bone2D(new V2(0,0),null,i,a,this.angles[c-1][0],this.angles[c-1][1])):t.addConsecutiveBone(i,a,this.angles[c-1][0],this.angles[c-1][1]));this.target.set(10,20,0),this.solver.add(t,this.target,!0)},update:function(){this.solver.update();for(var t,n=this.solver.chains[0].bones,r=this.numBones-1,o=0;o<r;o++)t=0===o?i.findAngle(this.fakeBone,n[o]):i.findAngle(n[o-1],n[o]),this.rotation[o]=t*i.toDeg,this.rotation[o]+=t<0?180:-180,this.rotation[o]*=-1;for(o=0;o<r;o++)this.bones[o].rotation.z=this.rotation[o]*i.toRad;console.log(this.rotation)}})},function(t,n,r){"use strict";var o;r.r(n),r.d(n,"FileInMemory",(function(){return i})),function(t){t.files={}}(o||(o={}));var i=function(){function FileInMemory(){}return FileInMemory.prototype.read=function(t){return new Promise((function(n,r){var i=o.files[t];i?n(i):r("Can't open '"+t+"'")}))},FileInMemory.prototype.write=function(t,n){return new Promise((function(r,i){o.files[t]=n,r()}))},FileInMemory.prototype.delete=function(t){return console.assert(!1,"Not Implemented"),Promise.reject()},FileInMemory.prototype.renameFile=function(t,n){return console.assert(!1,"Not Implemented"),Promise.reject()},FileInMemory.prototype.renameFolder=function(t,n){return console.assert(!1,"Not Implemented"),Promise.reject()},FileInMemory.prototype.clearAllFiles=function(){return console.assert(!1,"Not Implemented"),Promise.reject()},FileInMemory.prototype.temporaryGetFiles=function(){return o.files},FileInMemory}()},function(t,n,r){"use strict";r.r(n),r.d(n,"FileStandaloneWeb",(function(){return i}));var o=r(3),i=function(){function FileStandaloneWeb(){}return FileStandaloneWeb.prototype.read=function(t){var n=o.a.getDefaultAsset(t);return n?Promise.resolve(n):new Promise((function(n,r){var o=new XMLHttpRequest;o.onreadystatechange=function(){o.readyState===XMLHttpRequest.DONE&&(200===o.status||0===o.status?n(o.responseText):r("Can't open '"+t+"', status: "+o.status))},o.open("GET",t,!0),o.send(null)}))},FileStandaloneWeb.prototype.write=function(t,n){return Promise.reject()},FileStandaloneWeb.prototype.delete=function(t){return Promise.reject()},FileStandaloneWeb.prototype.renameFile=function(t,n){return Promise.reject()},FileStandaloneWeb.prototype.renameFolder=function(t,n){return Promise.reject()},FileStandaloneWeb.prototype.clearAllFiles=function(){return Promise.reject()},FileStandaloneWeb}()},function(t,n,r){"use strict";var o;r.r(n),r.d(n,"Engine",(function(){return El})),r.d(n,"Interfaces",(function(){return mt})),r.d(n,"Entities",(function(){return Ra})),r.d(n,"Component",(function(){return fn})),r.d(n,"SerializableObject",(function(){return z})),r.d(n,"Model",(function(){return Cc})),r.d(n,"Input",(function(){return Si})),r.d(n,"InputInternal",(function(){return Ai})),r.d(n,"Scenes",(function(){return Un})),r.d(n,"Update",(function(){return aa})),r.d(n,"Transform",(function(){return Yn})),r.d(n,"Assets",(function(){return Gn})),r.d(n,"Time",(function(){return je})),r.d(n,"Range",(function(){return Xt})),r.d(n,"defaultAssets",(function(){return Is})),r.d(n,"DefaultAssetsInternal",(function(){return Ds})),r.d(n,"CameraClear",(function(){return Ys})),r.d(n,"Camera",(function(){return ec})),r.d(n,"Visual",(function(){return zr})),r.d(n,"Light",(function(){return Vc})),r.d(n,"DirectionalLight",(function(){return ac})),r.d(n,"ParticleEmitDirection",(function(){return to})),r.d(n,"ParticleValueOverLife",(function(){return lo})),r.d(n,"ParticleNumberOverLife",(function(){return po})),r.d(n,"ParticleColorOverLife",(function(){return fo})),r.d(n,"Particles",(function(){return ho})),r.d(n,"Material",(function(){return vr})),r.d(n,"Shader",(function(){return rn})),r.d(n,"PhongShaderInternal",(function(){return tc})),r.d(n,"PhongShader",(function(){return dc})),r.d(n,"BoxVolume",(function(){return io})),r.d(n,"SphereVolume",(function(){return Dc})),r.d(n,"BoxGeometry",(function(){return Du})),r.d(n,"SphereGeometry",(function(){return Lu})),r.d(n,"ConeGeometry",(function(){return Wu})),r.d(n,"PlaneGeometry",(function(){return Vu})),r.d(n,"Billboard",(function(){return Lc})),r.d(n,"CenteredQuad",(function(){return _c})),r.d(n,"DynamicGeometry",(function(){return ru})),r.d(n,"QuadGeometry",(function(){return Wc})),r.d(n,"SkinnedMesh",(function(){return Mr})),r.d(n,"SpriteGeometry",(function(){return $c})),r.d(n,"StaticMesh",(function(){return Sr})),r.d(n,"Color",(function(){return It})),r.d(n,"VertexBuffer",(function(){return Vt})),r.d(n,"VisualGroup",(function(){return xr})),r.d(n,"RenderTarget",(function(){return gt})),r.d(n,"InclusionVisualFilter",(function(){return il})),r.d(n,"ExclusionVisualFilter",(function(){return al})),r.d(n,"DrawableTexture",(function(){return Gr})),r.d(n,"Animation",(function(){return mn})),r.d(n,"AnimationComponent",(function(){return Pn})),r.d(n,"Layout",(function(){return Mo})),r.d(n,"UIOverflow",(function(){return $o})),r.d(n,"UIElement",(function(){return ri})),r.d(n,"SpriteRenderMode",(function(){return Io})),r.d(n,"Sprite",(function(){return Do})),r.d(n,"SpriteSheet",(function(){return No})),r.d(n,"FontMetrics",(function(){return si})),r.d(n,"Image",(function(){return ji})),r.d(n,"Screen",(function(){return Li})),r.d(n,"UIFill",(function(){return qo})),r.d(n,"MaterialFill",(function(){return Go})),r.d(n,"SpriteFill",(function(){return Ho})),r.d(n,"TextureFill",(function(){return Xo})),r.d(n,"ColorFill",(function(){return Ko})),r.d(n,"SpriteSheetFill",(function(){return Qo})),r.d(n,"SpriteSheetMaterialFill",(function(){return Yo})),r.d(n,"TouchInteractions",(function(){return xi})),r.d(n,"UISizeType",(function(){return zt})),r.d(n,"UISize",(function(){return Nt})),r.d(n,"BehaviorComponent",(function(){return Es})),r.d(n,"Behavior",(function(){return Os})),r.d(n,"BehaviorAPI",(function(){return ua})),r.d(n,"BehaviorAPIFactory",(function(){return _e})),r.d(n,"CodeBlock",(function(){return ya})),r.d(n,"Data",(function(){return eu})),r.d(n,"Vector3Internal",(function(){return y})),r.d(n,"Vector3",(function(){return w})),r.d(n,"Vector2",(function(){return h})),r.d(n,"Quaternion",(function(){return kt})),r.d(n,"Matrix44",(function(){return A})),r.d(n,"SerializableMatrix44",(function(){return E})),r.d(n,"Vector4",(function(){return Bt})),r.d(n,"MathEx",(function(){return P})),r.d(n,"RayPlaneCollisionResult",(function(){return he})),r.d(n,"RayAABBCollisionResult",(function(){return de})),r.d(n,"RaySphereCollisionResult",(function(){return ye})),r.d(n,"Ray",(function(){return ge})),r.d(n,"PlaneClassification",(function(){return M})),r.d(n,"Plane",(function(){return N})),r.d(n,"Random",(function(){return Ht})),r.d(n,"BoxCollisionShape",(function(){return pr})),r.d(n,"MeshCollisionShape",(function(){return Lr})),r.d(n,"ParticlesCollisionShape",(function(){return Zc})),r.d(n,"PlaneCollisionShape",(function(){return Oo})),r.d(n,"SphereCollisionShape",(function(){return ur})),r.d(n,"VisualCollisionShape",(function(){return Dr})),r.d(n,"Collider",(function(){return hr})),r.d(n,"PhysicsBroadPhaseType",(function(){return uo})),r.d(n,"PhysicsContext",(function(){return xo})),r.d(n,"RigidBodyType",(function(){return go})),r.d(n,"RigidBody",(function(){return To})),r.d(n,"Physics",(function(){return Ur})),function(t){t.externalLogger=function(){}}(o||(o={}));var i,a,c,u,l,p=function(){function Debug(){}return Debug.log=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=1===t.length?t[0]:t;console.log(r),o.externalLogger(r)},Debug.logError=function(t){console.error(t),o.externalLogger(t)},Debug.logWarning=function(t){console.warn(t),o.externalLogger(t)},Debug.logVector3=function(t){var n=t.x+", "+t.y+", "+t.z;console.log(n),o.externalLogger(n)},Debug.logVector2=function(t){var n=t.x+", "+t.y;console.log(n),o.externalLogger(n)},Debug}(),f=function(){function ObjectPool(t,n){this._size=0,this._initialCapacity=n,this._capacity=n,this._objects=[],this._objects.length=n;for(var r=0;r<n;++r)this._objects[r]=new t;this._creator=function(){return new t}}return Object.defineProperty(ObjectPool.prototype,"size",{get:function(){return this._size},enumerable:!1,configurable:!0}),ObjectPool.prototype.flush=function(){this._size=0},ObjectPool.prototype.peek=function(t){return this._objects[t]},ObjectPool.prototype.get=function(){return this._size===this._capacity&&this.grow(),this._objects[this._size++]},ObjectPool.prototype.shrink=function(){this._capacity=this._initialCapacity,this._objects.length=this._capacity,this._size=Math.min(this._size,this._capacity)},ObjectPool.prototype.grow=function(){p.log(this._objects[0].constructor.name+" pool capacity reached, doubling the pool. Consider allocating a bigger pool.");var t=2*this._capacity;this._objects.length=t;for(var n=this._capacity;n<t;++n)this._objects[n]=this._creator();this._capacity=t},ObjectPool}(),h=function(){function Vector2(t,n){this.x=t||0,this.y=n||0}return Object.defineProperty(Vector2.prototype,"length",{get:function(){return Math.sqrt(this.lengthSq)},enumerable:!1,configurable:!0}),Object.defineProperty(Vector2.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y},enumerable:!1,configurable:!0}),Vector2.distance=function(t,n){return Math.sqrt(Vector2.distanceSq(t,n))},Vector2.distanceSq=function(t,n){var r=t.x-n.x,o=t.y-n.y;return r*r+o*o},Vector2.fromArray=function(t){var n=new Vector2;t.length>0&&(n.x=t[0]),t.length>1&&(n.y=t[1])},Vector2.fromPool=function(){return Vector2.pool.get()},Vector2.prototype.set=function(t,n){return this.x=t,this.y=n,this},Vector2.prototype.add=function(t){return this.addVectors(this,t)},Vector2.prototype.addVectors=function(t,n){return this.x=t.x+n.x,this.y=t.y+n.y,this},Vector2.prototype.substract=function(t){return this.substractVectors(this,t)},Vector2.prototype.substractVectors=function(t,n){return this.x=t.x-n.x,this.y=t.y-n.y,this},Vector2.prototype.normalize=function(){var t=this.length;return t<Number.EPSILON?this:this.multiply(1/t)},Vector2.prototype.multiply=function(t){return this.x=this.x*t,this.y=this.y*t,this},Vector2.prototype.dot=function(t){return this.x*t.x+this.y*t.y},Vector2.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},Vector2.prototype.rotate=function(t){var n=Math.cos(t),r=Math.sin(t);return this.set(this.x*n-this.y*r,this.x*r+this.y*n),this},Vector2.prototype.asArray=function(){return this._array?(this._array[0]=this.x,this._array[1]=this.y,this._array):(this._array=[this.x,this.y],this._array)},Vector2.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},Vector2.zero=new Vector2,Vector2.one=new Vector2(1,1),Vector2.right=new Vector2(1,0),Vector2.up=new Vector2(0,1),Vector2.pool=new f(Vector2,128),Vector2.dummy=new Vector2,Vector2}();!function(t){t[t.None=0]="None",t[t.Linear=1]="Linear",t[t.Additive=2]="Additive"}(i||(i={})),function(t){t[t.Linear=0]="Linear",t[t.Nearest=1]="Nearest"}(a||(a={})),function(t){t[t.Back=0]="Back",t[t.Front=1]="Front",t[t.None=2]="None"}(c||(c={})),function(t){t[t.Opaque=0]="Opaque",t[t.Transparent=1]="Transparent"}(u||(u={})),function(t){t[t._8=8]="_8",t[t._16=16]="_16",t[t._32=32]="_32",t[t._64=64]="_64",t[t._256=256]="_256",t[t._512=512]="_512",t[t._1024=1024]="_1024",t[t._2048=2048]="_2048",t[t._4096=4096]="_4096"}(l||(l={}));var d,y,m=(d=function(t,n){return(d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)},function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}d(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}),v=function(t){function Reference(n,r){var o=t.call(this)||this;return o.baseTypeName=function(){return n.name},o.getInstance=function(){return o.instance},o.instance=r,o}return m(Reference,t),Reference}((function ReferenceBase(){}));!function(t){t.xKey="_x",t.yKey="_y",t.zKey="_z",t.wKey="_w"}(y||(y={}));var g,_,b,w=function(){function Vector3(t,n,r){this._x=t||0,this._y=n||0,this._z=r||0}return Object.defineProperty(Vector3.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!1,configurable:!0}),Object.defineProperty(Vector3.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!1,configurable:!0}),Object.defineProperty(Vector3.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t},enumerable:!1,configurable:!0}),Object.defineProperty(Vector3.prototype,"length",{get:function(){return Math.sqrt(this.lengthSq)},enumerable:!1,configurable:!0}),Object.defineProperty(Vector3.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z},enumerable:!1,configurable:!0}),Vector3.distance=function(t,n){return Math.sqrt(Vector3.distanceSq(t,n))},Vector3.distanceSq=function(t,n){var r=t.x-n.x,o=t.y-n.y,i=t.z-n.z;return r*r+o*o+i*i},Vector3.fromPool=function(){return Vector3.pool.get()},Vector3.fromArray=function(t,n){var r=n||0;return new Vector3(t[r],t[r+1],t[r+2])},Vector3.prototype.flip=function(){var t=this.x,n=this.y,r=this.z;return this._x=-t,this._y=-n,this.z=-r,this},Vector3.prototype.cross=function(t){return this.crossVectors(this,t)},Vector3.prototype.crossVectors=function(t,n){var r=t._x,o=t._y,i=t._z,a=n._x,c=n._y,u=n._z;return this._x=o*u-i*c,this._y=i*a-r*u,this.z=r*c-o*a,this},Vector3.prototype.dot=function(t){return this._x*t._x+this._y*t._y+this._z*t._z},Vector3.prototype.substract=function(t){return this.substractVectors(this,t)},Vector3.prototype.substractVectors=function(t,n){return this._x=t._x-n._x,this._y=t._y-n._y,this.z=t._z-n._z,this},Vector3.prototype.add=function(t){return this.addVectors(this,t)},Vector3.prototype.addVectors=function(t,n){return this._x=t._x+n._x,this._y=t._y+n._y,this.z=t._z+n._z,this},Vector3.prototype.multiply=function(t){return this._x*=t,this._y*=t,this.z*=t,this},Vector3.prototype.multiplyVector=function(t){return this._x*=t._x,this._y*=t._y,this.z*=t._z,this},Vector3.prototype.divide=function(t){var n=1/t;return this._x*=n,this._y*=n,this.z*=n,this},Vector3.prototype.divideVector=function(t){return this._x/=t._x,this._y/=t._y,this.z/=t._z,this},Vector3.prototype.min=function(){return Math.min(this._x,this._y,this._z)},Vector3.prototype.max=function(){return Math.max(this._x,this._y,this._z)},Vector3.prototype.normalize=function(){var t=this.length;return 0===t?this:this.divide(t)},Vector3.prototype.lerp=function(t,n){return this.lerpVectors(this,t,n)},Vector3.prototype.lerpVectors=function(t,n,r){return this._x=t._x+(n._x-t._x)*r,this._y=t._y+(n._y-t._y)*r,this.z=t._z+(n._z-t._z)*r,this},Vector3.prototype.slerp=function(t,n){return this.slerpVectors(this,t,n)},Vector3.prototype.slerpVectors=function(t,n,r){var o=t.dot(n);o=Math.max(Math.min(o,1),-1);var i=Math.acos(o)*r,a=Vector3.dummy.copy(t).multiply(-o).add(n),c=a.length;return c>0&&a.multiply(1/c).multiply(Math.sin(i)),this.copy(t).multiply(Math.cos(i)).add(a)},Vector3.prototype.distFromSq=function(t){var n=this._x-t._x,r=this._y-t._y,o=this._z-t._z;return n*n+r*r+o*o},Vector3.prototype.distFrom=function(t){return Math.sqrt(this.distFromSq(t))},Vector3.prototype.set=function(t,n,r){return this._x=t,this._y=n,this.z=r,this},Vector3.prototype.setFromArray=function(t,n){var r=n||0;return console.assert(t.length>r+2),this._x=t[r],this._y=t[r+1],this.z=t[r+2],this},Vector3.prototype.setFromMatrix=function(t){return this._x=t.data[12],this._y=t.data[13],this.z=t.data[14],this},Vector3.prototype.setFromMatrixColumn=function(t,n){return this.setFromArray(t.data,4*n)},Vector3.prototype.rotate=function(t){var n=this._x,r=this._y,o=this._z,i=t.x,a=t.y,c=t.z,u=t.w,l=u*n+a*o-c*r,p=u*r+c*n-i*o,f=u*o+i*r-a*n,h=-i*n-a*r-c*o;return this._x=l*u+h*-i+p*-c-f*-a,this._y=p*u+h*-a+f*-i-l*-c,this.z=f*u+h*-c+l*-a-p*-i,this},Vector3.prototype.transform=function(t){var n=this._x,r=this._y,o=this._z,i=t.data;this._x=i[0]*n+i[4]*r+i[8]*o+i[12],this._y=i[1]*n+i[5]*r+i[9]*o+i[13],this._z=i[2]*n+i[6]*r+i[10]*o+i[14];var a=i[3]*n+i[7]*r+i[11]*o+i[15];return this.multiply(1/a)},Vector3.prototype.transformDirection=function(t){var n=this._x,r=this._y,o=this._z,i=t.data;return this._x=i[0]*n+i[4]*r+i[8]*o,this._y=i[1]*n+i[5]*r+i[9]*o,this._z=i[2]*n+i[6]*r+i[10]*o,this.normalize()},Vector3.prototype.transformMatrix33=function(t){var n=this._x,r=this._y,o=this._z,i=t.data;return this._x=i[0]*n+i[3]*r+i[6]*o,this._y=i[1]*n+i[4]*r+i[7]*o,this._z=i[2]*n+i[5]*r+i[8]*o,this},Vector3.prototype.copy=function(t){return this._x=t._x,this._y=t._y,this.z=t._z,this},Vector3.prototype.equals=function(t){return this._x===t._x&&this._y===t._y&&this._z===t._z},Vector3.prototype.asArray=function(){return this._array?(this._array[0]=this._x,this._array[1]=this._y,this._array[2]=this._z,this._array):(this._array=[this._x,this._y,this._z],this._array)},Vector3.prototype.toArray=function(t,n){return t[n]=this._x,t[n+1]=this._y,t[n+2]=this._z,t},Vector3.prototype.projectOnLine=function(t,n){var r=Vector3.dummy,o=Vector3.dummy2;return r.substractVectors(n,t).normalize(),o.substractVectors(this,t),r.dot(o)},Vector3.prototype.projectOnVector=function(t){var n=t.length;if(n<Number.EPSILON)return this;var r=Vector3.dummy.copy(t).multiply(1/n),o=this.dot(r);return this.copy(r).multiply(o)},Vector3.prototype.plus=function(t){return Vector3.dummy.copy(this).add(t)},Vector3.prototype.minus=function(t){return Vector3.dummy.copy(this).substract(t)},Vector3.prototype.reflect=function(t){Vector3.dummy.copy(t).multiply(2*this.dot(t)),this.substract(Vector3.dummy)},Vector3.zero=new Vector3,Vector3.one=new Vector3(1,1,1),Vector3.right=new Vector3(1,0,0),Vector3.up=new Vector3(0,1,0),Vector3.forward=new Vector3(0,0,1),Vector3.dummy=new Vector3,Vector3.dummy2=new Vector3,Vector3.pool=new f(Vector3,128),Vector3}();b=g||(g={}),(_=b.getClosestPointOnLine||(b.getClosestPointOnLine={})).vc=new w,_.vd=new w;var x,P=function(){function MathEx(){}return MathEx.toRadians=function(t){return t*MathEx.degreesToRadians},MathEx.toDegrees=function(t){return t*MathEx.radiansToDegrees},MathEx.clamp=function(t,n,r){return t<n?n:t>r?r:t},MathEx.isZero=function(t){return t>-MathEx.EPSILON&&t<MathEx.EPSILON},MathEx.isEqual=function(t,n){return MathEx.isZero(Math.abs(t-n))},MathEx.lerp=function(t,n,r){return t+(n-t)*r},MathEx.ceilPowerOfTwo=function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},MathEx.sphericalToCartesian=function(t,n,r,o){return o.x=t*Math.cos(n)*Math.sin(r),o.y=t*Math.sin(n)*Math.sin(r),o.z=t*Math.cos(r),o},MathEx.getClosestPointOnLine=function(t,n,r,o){var i=g.getClosestPointOnLine,a=i.vc,c=i.vd;a.substractVectors(t,n),c.substractVectors(r,n);var u=c.length;c.multiply(1/u);var l=c.dot(a);return l<0?n:l>u?r:o.copy(c).multiply(l).add(n)},MathEx.getNextPow2=function(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t},MathEx.isPowerOf2=function(t){return 0==(t&t-1)},MathEx.euclideanModulo=function(t,n){return(t%n+n)%n},MathEx.PI2=2*Math.PI,MathEx.EPSILON=1e-6,MathEx.degreesToRadians=.017453288,MathEx.radiansToDegrees=57.29579143,MathEx}(),O=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();!function(t){t.dummy=new w,t.dummy2=new w,t.dummy3=new w}(x||(x={}));var C,S,A=function(){function Matrix44(t){this.data=t||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return Matrix44.fromArray=function(t){var n=new Matrix44;return n.data=t.slice(),n},Matrix44.fromPool=function(){return Matrix44.pool.get()},Matrix44.prototype.makeOrthoProjection=function(t,n,r,o,i,a){var c=this.data,u=1/(n-t),l=1/(r-o),p=1/(a-i),f=(n+t)*u,h=(r+o)*l,d=(a+i)*p;return c[0]=2*u,c[4]=0,c[8]=0,c[12]=-f,c[1]=0,c[5]=2*l,c[9]=0,c[13]=-h,c[2]=0,c[6]=0,c[10]=-2*p,c[14]=-d,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this},Matrix44.prototype.makePerspectiveProjection=function(t,n,r,o){var i=this.data,a=1/Math.tan(t/2),c=1/(r-o),u=(o+r)*c,l=r*o*2*c;return i[0]=a/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=a,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=u,i[11]=-1,i[12]=0,i[13]=0,i[14]=l,i[15]=0,this},Matrix44.prototype.setRotation=function(t){var n=this.data,r=t.x,o=t.y,i=t.z,a=t.w,c=r+r,u=o+o,l=i+i,p=r*c,f=r*u,h=r*l,d=o*u,y=o*l,m=i*l,v=a*c,g=a*u,_=a*l;return n[0]=1-(d+m),n[4]=f-_,n[8]=h+g,n[1]=f+_,n[5]=1-(p+m),n[9]=y-v,n[2]=h-g,n[6]=y+v,n[10]=1-(p+d),n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this},Matrix44.prototype.setFromEulerAngles=function(t,n,r,o){void 0===o&&(o="YXZ");var i=this.data,a=Math.cos(t),c=Math.sin(t),u=Math.cos(n),l=Math.sin(n),p=Math.cos(r),f=Math.sin(r);if("XYZ"===o){var h=a*p,d=a*f,y=c*p,m=c*f;i[0]=u*p,i[4]=-u*f,i[8]=l,i[1]=d+y*l,i[5]=h-m*l,i[9]=-c*u,i[2]=m-h*l,i[6]=y+d*l,i[10]=a*u}else if("YXZ"===o){var v=u*p,g=u*f,_=l*p,b=l*f;i[0]=v+b*c,i[4]=_*c-g,i[8]=a*l,i[1]=a*f,i[5]=a*p,i[9]=-c,i[2]=g*c-_,i[6]=b+v*c,i[10]=a*u}else if("ZXY"===o){v=u*p,g=u*f,_=l*p,b=l*f;i[0]=v-b*c,i[4]=-a*f,i[8]=_+g*c,i[1]=g+_*c,i[5]=a*p,i[9]=b-v*c,i[2]=-a*l,i[6]=c,i[10]=a*u}else if("ZYX"===o){h=a*p,d=a*f,y=c*p,m=c*f;i[0]=u*p,i[4]=y*l-d,i[8]=h*l+m,i[1]=u*f,i[5]=m*l+h,i[9]=d*l-y,i[2]=-l,i[6]=c*u,i[10]=a*u}else if("YZX"===o){var w=a*u,x=a*l,P=c*u,O=c*l;i[0]=u*p,i[4]=O-w*f,i[8]=P*f+x,i[1]=f,i[5]=a*p,i[9]=-c*p,i[2]=-l*p,i[6]=x*f+P,i[10]=w-O*f}else if("XZY"===o){w=a*u,x=a*l,P=c*u,O=c*l;i[0]=u*p,i[4]=-f,i[8]=l*p,i[1]=w*f+O,i[5]=a*p,i[9]=x*f-P,i[2]=P*f-x,i[6]=c*p,i[10]=O*f+w}return i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,this},Matrix44.prototype.getRotation=function(t){return this.decompose(w.dummy,t,w.dummy),t},Matrix44.prototype.rotate=function(t){return this.multiply(Matrix44.dummy.setRotation(t))},Matrix44.prototype.makeLookAt=function(t,n){var r=x.dummy,o=x.dummy2,i=x.dummy3;i.copy(t).normalize(),r.crossVectors(n,i),0===r.lengthSq&&(i.z+=1e-4,r.crossVectors(n,i)),r.normalize(),o.crossVectors(i,r);var a=this.data;return a[0]=r.x,a[4]=r.y,a[8]=r.z,a[12]=0,a[1]=o.x,a[5]=o.y,a[9]=o.z,a[13]=0,a[2]=i.x,a[6]=i.y,a[10]=i.z,a[14]=0,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this},Matrix44.prototype.setIdentity=function(){var t=this.data;return t[0]=1,t[4]=0,t[8]=0,t[12]=0,t[1]=0,t[5]=1,t[9]=0,t[13]=0,t[2]=0,t[6]=0,t[10]=1,t[14]=0,t[3]=0,t[7]=0,t[11]=0,t[15]=1,this},Matrix44.prototype.set=function(t,n,r,o,i,a,c,u,l,p,f,h,d,y,m,v){var g=this.data;return g[0]=t,g[4]=n,g[8]=r,g[12]=o,g[1]=i,g[5]=a,g[9]=c,g[13]=u,g[2]=l,g[6]=p,g[10]=f,g[14]=h,g[3]=d,g[7]=y,g[11]=m,g[15]=v,this},Matrix44.prototype.toEuler=function(t){var n=this.data,r=n[0],o=(n[4],n[8]),i=n[1],a=n[5],c=n[9],u=n[2],l=(n[6],n[10]);return t.x=Math.asin(-P.clamp(c,-1,1)),Math.abs(c)<.99999?(t.y=Math.atan2(o,l),t.z=Math.atan2(i,a)):(t.y=Math.atan2(-u,r),t.z=0),t},Matrix44.prototype.scale=function(t){return this.scaleFromCoords(t.x,t.y,t.z)},Matrix44.prototype.scaleFromCoords=function(t,n,r){var o=this.data;return o[0]*=t,o[4]*=n,o[8]*=r,o[1]*=t,o[5]*=n,o[9]*=r,o[2]*=t,o[6]*=n,o[10]*=r,o[3]*=t,o[7]*=n,o[11]*=r,this},Matrix44.prototype.setPosition=function(t){return this.setPositionFromCoords(t.x,t.y,t.z)},Matrix44.prototype.getPosition=function(t){var n=this.data;return t.x=n[12],t.y=n[13],t.z=n[14],t},Matrix44.prototype.setPositionFromCoords=function(t,n,r){var o=this.data;return o[12]=t,o[13]=n,o[14]=r,this},Matrix44.prototype.translate=function(t){return this.translateFromCoords(t.x,t.y,t.z)},Matrix44.prototype.translateFromCoords=function(t,n,r){var o=this.data;return o[12]+=t,o[13]+=n,o[14]+=r,this},Matrix44.prototype.compose=function(t,n,r){return this.setRotation(n),this.scale(r),this.setPosition(t),this},Matrix44.prototype.decompose=function(t,n,r){var o=x.dummy,i=Matrix44.dummy,a=this.data,c=o.set(a[0],a[1],a[2]).length,u=o.set(a[4],a[5],a[6]).length,l=o.set(a[8],a[9],a[10]).length;this.determinant()<0&&(c=-c),t.x=a[12],t.y=a[13],t.z=a[14],this.copy.call(i,this);var p=1/(c||P.EPSILON),f=1/(u||P.EPSILON),h=1/(l||P.EPSILON);return i.data[0]*=p,i.data[1]*=p,i.data[2]*=p,i.data[4]*=f,i.data[5]*=f,i.data[6]*=f,i.data[8]*=h,i.data[9]*=h,i.data[10]*=h,n.setFromMatrix(i),r.x=c,r.y=u,r.z=l,this},Matrix44.prototype.determinant=function(){var t=this.data,n=t[0],r=t[4],o=t[8],i=t[12],a=t[1],c=t[5],u=t[9],l=t[13],p=t[2],f=t[6],h=t[10],d=t[14];return t[3]*(+i*u*f-o*l*f-i*c*h+r*l*h+o*c*d-r*u*d)+t[7]*(+n*u*d-n*l*h+i*a*h-o*a*d+o*l*p-i*u*p)+t[11]*(+n*l*f-n*c*d-i*a*f+r*a*d+i*c*p-r*l*p)+t[15]*(-o*c*p-n*u*f+n*c*h+o*a*f-r*a*h+r*u*p)},Matrix44.prototype.transpose=function(){var t,n=this.data;return t=n[1],n[1]=n[4],n[4]=t,t=n[2],n[2]=n[8],n[8]=t,t=n[6],n[6]=n[9],n[9]=t,t=n[3],n[3]=n[12],n[12]=t,t=n[7],n[7]=n[13],n[13]=t,t=n[11],n[11]=n[14],n[14]=t,this},Matrix44.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},Matrix44.prototype.multiplyMatrices=function(t,n){var r=t.data,o=n.data,i=this.data,a=r[0],c=r[4],u=r[8],l=r[12],p=r[1],f=r[5],h=r[9],d=r[13],y=r[2],m=r[6],v=r[10],g=r[14],_=r[3],b=r[7],w=r[11],x=r[15],P=o[0],O=o[4],C=o[8],S=o[12],A=o[1],E=o[5],j=o[9],T=o[13],R=o[2],B=o[6],M=o[10],I=o[14],z=o[3],k=o[7],D=o[11],F=o[15];return i[0]=a*P+c*A+u*R+l*z,i[4]=a*O+c*E+u*B+l*k,i[8]=a*C+c*j+u*M+l*D,i[12]=a*S+c*T+u*I+l*F,i[1]=p*P+f*A+h*R+d*z,i[5]=p*O+f*E+h*B+d*k,i[9]=p*C+f*j+h*M+d*D,i[13]=p*S+f*T+h*I+d*F,i[2]=y*P+m*A+v*R+g*z,i[6]=y*O+m*E+v*B+g*k,i[10]=y*C+m*j+v*M+g*D,i[14]=y*S+m*T+v*I+g*F,i[3]=_*P+b*A+w*R+x*z,i[7]=_*O+b*E+w*B+x*k,i[11]=_*C+b*j+w*M+x*D,i[15]=_*S+b*T+w*I+x*F,this},Matrix44.prototype.invert=function(){return this.getInverse(this)},Matrix44.prototype.getInverse=function(t){var n=this.data,r=t.data,o=r[0],i=r[1],a=r[2],c=r[3],u=r[4],l=r[5],p=r[6],f=r[7],h=r[8],d=r[9],y=r[10],m=r[11],v=r[12],g=r[13],_=r[14],b=r[15],w=d*_*f-g*y*f+g*p*m-l*_*m-d*p*b+l*y*b,x=v*y*f-h*_*f-v*p*m+u*_*m+h*p*b-u*y*b,P=h*g*f-v*d*f+v*l*m-u*g*m-h*l*b+u*d*b,O=v*d*p-h*g*p-v*l*y+u*g*y+h*l*_-u*d*_,C=o*w+i*x+a*P+c*O;if(0===C)return this.setIdentity();var S=1/C;return n[0]=w*S,n[1]=(g*y*c-d*_*c-g*a*m+i*_*m+d*a*b-i*y*b)*S,n[2]=(l*_*c-g*p*c+g*a*f-i*_*f-l*a*b+i*p*b)*S,n[3]=(d*p*c-l*y*c-d*a*f+i*y*f+l*a*m-i*p*m)*S,n[4]=x*S,n[5]=(h*_*c-v*y*c+v*a*m-o*_*m-h*a*b+o*y*b)*S,n[6]=(v*p*c-u*_*c-v*a*f+o*_*f+u*a*b-o*p*b)*S,n[7]=(u*y*c-h*p*c+h*a*f-o*y*f-u*a*m+o*p*m)*S,n[8]=P*S,n[9]=(v*d*c-h*g*c-v*i*m+o*g*m+h*i*b-o*d*b)*S,n[10]=(u*g*c-v*l*c+v*i*f-o*g*f-u*i*b+o*l*b)*S,n[11]=(h*l*c-u*d*c-h*i*f+o*d*f+u*i*m-o*l*m)*S,n[12]=O*S,n[13]=(h*g*a-v*d*a+v*i*y-o*g*y-h*i*_+o*d*_)*S,n[14]=(v*l*a-u*g*a-v*i*p+o*g*p+u*i*_-o*l*_)*S,n[15]=(u*d*a-h*l*a+h*i*p-o*d*p-u*i*y+o*l*y)*S,this},Matrix44.prototype.getScale=function(t){var n=this.data,r=t.set(n[0],n[1],n[2]).length,o=t.set(n[4],n[5],n[6]).length,i=t.set(n[8],n[9],n[10]).length;return t.set(r,o,i)},Matrix44.prototype.extractRotation=function(t){var n=this.data,r=t.data,o=x.dummy,i=1/o.setFromMatrixColumn(t,0).length,a=1/o.setFromMatrixColumn(t,1).length,c=1/o.setFromMatrixColumn(t,2).length;return n[0]=r[0]*i,n[1]=r[1]*i,n[2]=r[2]*i,n[3]=0,n[4]=r[4]*a,n[5]=r[5]*a,n[6]=r[6]*a,n[7]=0,n[8]=r[8]*c,n[9]=r[9]*c,n[10]=r[10]*c,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this},Matrix44.prototype.copyPosition=function(t){var n=this.data,r=t.data;return n[12]=r[12],n[13]=r[13],n[14]=r[14],this},Matrix44.prototype.copy=function(t){var n=this.data,r=t.data;return n[0]=r[0],n[4]=r[4],n[8]=r[8],n[12]=r[12],n[1]=r[1],n[5]=r[5],n[9]=r[9],n[13]=r[13],n[2]=r[2],n[6]=r[6],n[10]=r[10],n[14]=r[14],n[3]=r[3],n[7]=r[7],n[11]=r[11],n[15]=r[15],this},Matrix44.prototype.toArray=function(t,n){var r=this.data;return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],t[n+4]=r[4],t[n+5]=r[5],t[n+6]=r[6],t[n+7]=r[7],t[n+8]=r[8],t[n+9]=r[9],t[n+10]=r[10],t[n+11]=r[11],t[n+12]=r[12],t[n+13]=r[13],t[n+14]=r[14],t[n+15]=r[15],t},Matrix44.identity=new Matrix44,Matrix44.dummy=new Matrix44,Matrix44.pool=new f(Matrix44,64),Matrix44}(),E=function(t){function SerializableMatrix44(){return null!==t&&t.apply(this,arguments)||this}return O(SerializableMatrix44,t),SerializableMatrix44}(A);!function(t){t.rootTypeName="SerializableObject",t.rawTypeInfos=[],t.findTypeNode=function findTypeNode(t,n){if(t.typeName===n)return t;for(var r=0,o=t.derivedTypes;r<o.length;r++){var i=findTypeNode(o[r],n);if(i)return i}},t.getTypesUnderNode=function getTypesUnderNode(t,n){for(var r=0,o=t.derivedTypes;r<o.length;r++){var i=o[r];n.push(i.typeName),getTypesUnderNode(i,n)}}}(C||(C={})),function(t){t.buildTypeTree=function buildTypeTree(){C.typeTree={typeName:C.rootTypeName,derivedTypes:[]};for(var getDepth=function(t){for(var n=t,r=0;n!==C.rootTypeName;){++r;var o=C.rawTypeInfos.filter((function(t){return t.derivedTypes.some((function(t){return t===n}))})),i=o.length?o[0]:void 0;if(!i)return console.assert(!1,"Cannot find parent type for '"+n+"', please register it using Factory.registerObject()"),-1;n=i.typeName}return r},t=0,n=C.rawTypeInfos;t<n.length;t++){var r=n[t];r.depth=getDepth(r.typeName)}C.rawTypeInfos.sort((function(t,n){return t.depth-n.depth}));for(var o=0,i=C.rawTypeInfos;o<i.length;o++){var a=i[o],c=C.findTypeNode(C.typeTree,a.typeName);if(c)for(var u=0,l=a.derivedTypes;u<l.length;u++){var p=l[u];c.derivedTypes.push({parent:c,typeName:p,derivedTypes:[]})}}},t.registerRawTypeInfo=function registerRawTypeInfo(t,n){var r=C.rawTypeInfos.filter((function(n){return n.typeName===t})),o=r.length?r[0]:void 0;o?o.derivedTypes.push(n):C.rawTypeInfos.push({typeName:t,derivedTypes:[n],depth:-1})}}(S||(S={}));var j,T=function(){function RTTI(){}return RTTI.isObjectOfType=function(t,n){for(var r=C.findTypeNode(C.typeTree,t);r;){if(r.typeName===n)return!0;r=r.parent}return!1},RTTI.getAncestorTypes=function(t,n){for(var r=[],o=C.findTypeNode(C.typeTree,t);o&&o.parent&&o.parent.typeName!==n;)r.push(o.parent.typeName),o=C.findTypeNode(C.typeTree,o.parent.typeName);return r},RTTI.getDerivedObjectTypes=function(t){var n=[],r=C.findTypeNode(C.typeTree,t);return r&&C.getTypesUnderNode(r,n),n},RTTI}();j||(j={});var R,B=function(){function ISerializerInternal(){}return Object.defineProperty(ISerializerInternal,"instance",{get:function(){return j.instance},set:function(t){j.instance=t},enumerable:!1,configurable:!0}),ISerializerInternal}();R||(R={});var M,I=function(){function IFactoryInternal(){}return Object.defineProperty(IFactoryInternal,"instance",{get:function(){return R.instance},set:function(t){R.instance=t},enumerable:!1,configurable:!0}),IFactoryInternal}(),z=function(){function SerializableObject(){}return SerializableObject.prototype.isA=function(t){return T.isObjectOfType(this.constructor.name,t.name)},SerializableObject.prototype.copy=function(){var t=I.instance.createObject(this.constructor.name);return t.deserialize(this.serialize()),t},SerializableObject.prototype.destroy=function(){},SerializableObject.prototype.setProperty=function(t,n){this[t]=n},SerializableObject.prototype.serialize=function(){return B.instance.serializeObject(this)},SerializableObject.prototype.deserialize=function(t){return B.instance.deserializeObject(this,t),this},SerializableObject.prototype.upgrade=function(t,n){return t},SerializableObject.prototype.setState=function(t){var n=this;Object.entries(t).forEach((function(t){var r,o=t[0],i=t[1];Object.assign(n,((r={})[o]=i,r))}))},SerializableObject}();r(56);function Attributes_hidden(){return Reflect.metadata("hidden",!0)}function Attributes_unserializable(){return Reflect.metadata("unserializable",!0)}function editable(t){return Reflect.metadata("editable",t)}function creatable(t){return Reflect.metadata("creatable",t)}function referencable(t){return Reflect.metadata("referencable",t)}function nullable(t){return Reflect.metadata("nullable",t)}function mandatory(){return Reflect.metadata("mandatory",!0)}function hasDedicatedEditor(t){return Reflect.metadata("hasDedicatedEditor",t)}function displayName(t){return Reflect.metadata("displayName",t)}function sortOrder(t){return Reflect.metadata("sortOrder",t)}function helpUrl(t){return Reflect.metadata("helpUrl",t)}function Attributes_enumLiterals(t,n){var r,o={},i=Object.entries(t);console.assert(i.length%2==0);for(var a=i.length/2;a<i.length;++a){var c=i[a],u=c[0],l=c[1];Object.assign(o,((r={})[u]=l,r))}return Reflect.metadata("enumLiterals",{literals:o,getDisplayName:n})}function exclusiveWith(t){return Reflect.metadata("exclusiveWith",t)}!function(t){t[t.Front=0]="Front",t[t.Back=1]="Back",t[t.Planar=2]="Planar"}(M||(M={}));var k,D,F,L,N=function(){function Plane(t,n){this.normal=(new w).copy(w.up),this.distFromOrigin=0,this.normal=t||(new w).copy(w.up),this.distFromOrigin=n||0}return Plane.fromPool=function(){return Plane.pool.get()},Plane.prototype.set=function(t,n){return this.normal.copy(t),this.distFromOrigin=n,this},Plane.prototype.setFromPoint=function(t,n){return this.normal.copy(t),this.distFromOrigin=n.dot(t),this},Plane.prototype.setFromPoints=function(t,n,r){var o=w.dummy;return o.substractVectors(t,n),this.normal.copy(r).substract(t).cross(o).normalize(),this.setFromPoint(this.normal,t)},Plane.prototype.copy=function(t){this.normal.copy(t.normal),this.distFromOrigin=t.distFromOrigin},Plane.prototype.classifyPoint=function(t){var n=this.normal.dot(t)-this.distFromOrigin;return n>1e-6?M.Front:n<-1e-6?M.Back:M.Planar},Plane.prototype.getSignedDistance=function(t){return t.dot(this.normal)-this.distFromOrigin},Plane.pool=new f(Plane,64),Plane}();!function(t){t[t.Near=0]="Near",t[t.Far=1]="Far",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.Bottom=4]="Bottom",t[t.Top=5]="Top",t[t.Count=6]="Count"}(k||(k={})),function(t){t[t.FarTopLeft=0]="FarTopLeft",t[t.FarTopRight=1]="FarTopRight",t[t.FarBottomLeft=2]="FarBottomLeft",t[t.FarBottomRight=3]="FarBottomRight",t[t.NearTopLeft=4]="NearTopLeft",t[t.NearTopRight=5]="NearTopRight",t[t.NearBottomLeft=6]="NearBottomLeft",t[t.NearBottomRight=7]="NearBottomRight",t[t.Count=8]="Count"}(D||(D={})),function(t){t[t.In=0]="In",t[t.Out=1]="Out",t[t.Intersect=2]="Intersect"}(F||(F={})),function(t){!function(t){t.fCenter=new w,t.nCenter=new w,t.temp1=new w,t.temp2=new w}(t.update||(t.update={}))}(L||(L={}));var V,U=function(){function Frustum(){this._planes=[],this._planes.length=k.Count;for(var t=0;t<k.Count;++t)this._planes[t]=new N;this._corners=[],this._corners.length=D.Count;for(t=0;t<D.Count;++t)this._corners[t]=new w}return Object.defineProperty(Frustum.prototype,"corners",{get:function(){return this._corners},enumerable:!1,configurable:!0}),Frustum.prototype.isPointInside=function(t){for(var n=0,r=this._planes;n<r.length;n++){if(r[n].classifyPoint(t)===M.Front)return!1}return!0},Frustum.prototype.update=function(t,n,r,o,i,a,c){var u=L.update,l=u.fCenter,p=u.nCenter,f=u.temp1,h=u.temp2;return l.copy(c.worldForward).multiply(-a).add(c.worldPosition),this._corners[D.FarTopLeft].addVectors(f.copy(c.worldUp).multiply(o),h.copy(c.worldRight).multiply(-r)).add(l),this._corners[D.FarTopRight].addVectors(f.copy(c.worldUp).multiply(o),h.copy(c.worldRight).multiply(r)).add(l),this._corners[D.FarBottomLeft].addVectors(f.copy(c.worldUp).multiply(-o),h.copy(c.worldRight).multiply(-r)).add(l),this._corners[D.FarBottomRight].addVectors(f.copy(c.worldUp).multiply(-o),h.copy(c.worldRight).multiply(r)).add(l),p.copy(c.worldForward).multiply(-i).add(c.worldPosition),this._corners[D.NearTopLeft].addVectors(f.copy(c.worldUp).multiply(n),h.copy(c.worldRight).multiply(-t)).add(p),this._corners[D.NearTopRight].addVectors(f.copy(c.worldUp).multiply(n),h.copy(c.worldRight).multiply(t)).add(p),this._corners[D.NearBottomLeft].addVectors(f.copy(c.worldUp).multiply(-n),h.copy(c.worldRight).multiply(-t)).add(p),this._corners[D.NearBottomRight].addVectors(f.copy(c.worldUp).multiply(-n),h.copy(c.worldRight).multiply(t)).add(p),this._planes[k.Top].setFromPoints(this._corners[D.NearTopLeft],this._corners[D.FarTopLeft],this._corners[D.FarTopRight]),this._planes[k.Bottom].setFromPoints(this._corners[D.NearBottomRight],this._corners[D.FarBottomRight],this._corners[D.FarBottomLeft]),this._planes[k.Left].setFromPoints(this._corners[D.FarBottomLeft],this._corners[D.FarTopLeft],this._corners[D.NearTopLeft]),this._planes[k.Right].setFromPoints(this._corners[D.NearBottomRight],this._corners[D.NearTopRight],this._corners[D.FarTopRight]),this._planes[k.Near].setFromPoints(this._corners[D.NearBottomLeft],this._corners[D.NearTopLeft],this._corners[D.NearTopRight]),this._planes[k.Far].setFromPoints(this._corners[D.FarBottomRight],this._corners[D.FarTopRight],this._corners[D.FarTopLeft]),this},Frustum.prototype.testAABB=function(t){for(var n=0,r=t.corners,o=0;o<k.Count;++o){for(var i=D.Count,a=1,c=0;c<D.Count;++c)this._planes[o].classifyPoint(r[c])===M.Back&&(a=0,--i);if(0===i)return F.Out;n+=a}return n===k.Count?F.In:F.Intersect},Frustum}(),W=r(0);!function(t){t.maxDirectionalLights=4,t.maxShadowCascades=3,t.maxShadowDistance=100,t.shadowCascadeEdges=[.1*t.maxShadowDistance,.25*t.maxShadowDistance,t.maxShadowDistance],t.shaderDefinitions={MAX_DIRECTIONAL_LIGHTS:function(){return t.maxDirectionalLights},MAX_DIRECTIONAL_SHADOWMAPS:function(){return t.maxDirectionalLights*t.maxShadowCascades},MAX_SHADOW_CASCADES:function(){return t.maxShadowCascades}}}(V||(V={}));var q,G=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),__decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},__metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},H=function(t){function Projector(){var n=null!==t&&t.apply(this,arguments)||this;return n.changed=new W.VoidSyncEvent,n._zNear=.1,n._zFar=800,n._frustum={full:new U,splits:Array.from(new Array(V.maxShadowCascades)).map((function(){return new U}))},n}return G(Projector,t),Object.defineProperty(Projector.prototype,"frustum",{get:function(){return this._frustum},enumerable:!1,configurable:!0}),Object.defineProperty(Projector.prototype,"zNear",{get:function(){return this._zNear},set:function(t){this._zNear=t,this.changed.post()},enumerable:!1,configurable:!0}),Object.defineProperty(Projector.prototype,"zFar",{get:function(){return this._zFar},set:function(t){this._zFar=t,this.changed.post()},enumerable:!1,configurable:!0}),Projector.prototype.getProjectionMatrix=function(){return A.identity},Projector.prototype.updateFrustum=function(t,n){},__decorate([Attributes_unserializable(),__metadata("design:type",Object)],Projector.prototype,"changed",void 0),__decorate([Attributes_unserializable(),__metadata("design:type",Object)],Projector.prototype,"_frustum",void 0),Projector}(z),AssetReference_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},AssetReference_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},X=void 0;(function(t){t[t.Loading=0]="Loading",t[t.Resolved=1]="Resolved"})(q||(q={}));var K=function(){function AssetReference(t,n,r){this.assetChanged=new W.SyncEvent,this._asset=null,this._state=q.Resolved,this._inline=!1,this.typeName=function(){return t.name},this.onAssetDeleted=this.onAssetDeleted.bind(this),this._inline=Boolean(r),n&&(this._asset=n,this._id=n.id,this._state=q.Resolved)}return Object.defineProperty(AssetReference.prototype,"id",{get:function(){return this._id},set:function(t){this._id=t,this._state=q.Loading},enumerable:!1,configurable:!0}),Object.defineProperty(AssetReference.prototype,"asset",{get:function(){return this._asset},set:function(t){var n=this._asset;this._asset=t,this._state=q.Resolved,this._id=t?t.templatePath:void 0,t!==n&&this.assetChanged.post({oldAsset:n,newAsset:t})},enumerable:!1,configurable:!0}),Object.defineProperty(AssetReference.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t},enumerable:!1,configurable:!0}),Object.defineProperty(AssetReference.prototype,"resolved",{get:function(){return this._state===q.Resolved},enumerable:!1,configurable:!0}),Object.defineProperty(AssetReference.prototype,"inline",{get:function(){return this._inline},set:function(t){this._inline=t},enumerable:!1,configurable:!0}),AssetReference.prototype.clear=function(){this.asset=null},AssetReference.prototype.setAssetFast=function(t){this._asset=t},AssetReference.prototype.detach=function(){this._asset=null},AssetReference.prototype.onAssetDeleted=function(t){this.detach(),X&&X.assetReferenceCleared.post(t)},AssetReference_decorate([Attributes_unserializable(),AssetReference_metadata("design:type",Object)],AssetReference.prototype,"assetChanged",void 0),AssetReference_decorate([Attributes_unserializable(),AssetReference_metadata("design:type",Object)],AssetReference.prototype,"_asset",void 0),AssetReference_decorate([Attributes_unserializable(),AssetReference_metadata("design:type",Object)],AssetReference.prototype,"_state",void 0),AssetReference_decorate([Attributes_unserializable(),AssetReference_metadata("design:type",Object)],AssetReference.prototype,"_inline",void 0),AssetReference}(),Q=r(60),Y=function(){function EngineUtils(){}return EngineUtils.isObjectLoaded=function(t){for(var n=0,r=Object.values(t);n<r.length;n++){var o=r[n];if(null!==o)if("AssetReference"===(o.constructor?o.constructor.name:null)){var i=o;if(!EngineUtils.isAssetRefLoaded(i))return!1}}return!0},EngineUtils.isAssetRefLoaded=function(t){return!!t.resolved&&!(t.asset&&!t.asset.isLoaded())},EngineUtils.makeUniqueId=function(){return Q()},EngineUtils}(),Z=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),UniqueObject_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},UniqueObject_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},J=function(t){function UniqueObject(){var n=t.call(this)||this;return n.id=Y.makeUniqueId(),n.name=n.constructor.name,n}return Z(UniqueObject,t),UniqueObject.prototype.copy=function(){var t=I.instance.createObject(this.constructor.name);return t.templatePath=this.templatePath,t.deserialize(this.serialize()),t.id=Y.makeUniqueId(),t},UniqueObject_decorate([Attributes_hidden(),UniqueObject_metadata("design:type",String)],UniqueObject.prototype,"id",void 0),UniqueObject_decorate([Attributes_hidden(),UniqueObject_metadata("design:type",String)],UniqueObject.prototype,"name",void 0),UniqueObject_decorate([Attributes_unserializable(),UniqueObject_metadata("design:type",String)],UniqueObject.prototype,"templatePath",void 0),UniqueObject}(z),$=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Asset_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Asset_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},tt=void 0;var et,nt=function(t){function Asset(){var n=null!==t&&t.apply(this,arguments)||this;return n.isPersistent=!1,n.deleted=new W.AsyncEvent,n}return $(Asset,t),Asset.prototype.isLoaded=function(){return!0},Asset.prototype.destroy=function(){this.deleted.post(this.id),t.prototype.destroy.call(this)},Asset.prototype.save=function(t){tt?tt.saveAsset.post({path:(t?t+"/"+this.name+"."+this.constructor.name:null)||this.templatePath,asset:this}):p.logWarning("Asset saving is not yet implemented on this platform")},Asset_decorate([Attributes_unserializable(),Asset_metadata("design:type",Object)],Asset.prototype,"isPersistent",void 0),Asset_decorate([Attributes_unserializable(),Asset_metadata("design:type",Object)],Asset.prototype,"deleted",void 0),Asset}(J),rt=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),GraphicAsset_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},ot=function(t){function GraphicAsset(){return null!==t&&t.apply(this,arguments)||this}return rt(GraphicAsset,t),GraphicAsset.prototype.destroy=function(){this.graphicUnload(),t.prototype.destroy.call(this)},GraphicAsset.prototype.graphicLoad=function(){return!0},GraphicAsset.prototype.graphicUnload=function(){},GraphicAsset=GraphicAsset_decorate([creatable(!1),referencable(!1)],GraphicAsset)}(nt);!function(t){t.depthTest=!0,t.depthWrite=!0,t.blending=!1,t.culling=!0,t.cullMode=-1,t.blendFunc=[-1,-1]}(et||(et={}));var it,at=function(){function WebGL(){}return Object.defineProperty(WebGL,"context",{get:function(){return et.context},enumerable:!1,configurable:!0}),WebGL.create=function(t,n){for(var r in WebGL.primitiveTypes={POINTS:t.POINTS,LINE_STRIP:t.LINE_STRIP,LINE_LOOP:t.LINE_LOOP,LINES:t.LINES,TRIANGLE_STRIP:t.TRIANGLE_STRIP,TRIANGLE_FAN:t.TRIANGLE_FAN,TRIANGLES:t.TRIANGLES},WebGL.cubeMapFaces=[t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_X],WebGL.extensions.OES_texture_float=n>1,WebGL.extensions.OES_standard_derivatives=n>1,WebGL.extensions.WEBGL_depth_texture=n>1,WebGL.extensions.OES_standard_derivatives&&t.hint(t.FRAGMENT_SHADER_DERIVATIVE_HINT,t.FASTEST),this.extensions)this.extensions[r]=this.extensions[r]||Boolean(t.getExtension(r)),console.log(r+": "+this.extensions[r]);if(n>1){var o=t.getExtension("EXT_color_buffer_float");console.log("EXT_color_buffer_float: "+Boolean(o)),console.assert(o,"EXT_color_buffer_float extension is required for skinning.")}console.assert(this.extensions.OES_texture_float,"OES_texture_float extension is required for skinning."),console.assert(this.extensions.OES_standard_derivatives,"OES_standard_derivatives is required for enhanced wireframe visualization."),WebGL.caps.maxVertexUniforms=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),WebGL.version=n,et.context=t,t.enable(t.DEPTH_TEST),t.depthMask(!0),t.disable(t.BLEND),t.enable(t.CULL_FACE),t.clearDepth(1),t.depthFunc(t.LEQUAL),t.frontFace(t.CCW)},WebGL.do=function(t){var n=t(),r=et.context.getError();return r&&p.logError("WebGL error 0x"+Number(r).toString(16)),n},WebGL.enableDepthTest=function(t){t!==et.depthTest&&(t?WebGL.context.enable(WebGL.context.DEPTH_TEST):WebGL.context.disable(WebGL.context.DEPTH_TEST),et.depthTest=t)},WebGL.enableDepthWrite=function(t){t!==et.depthWrite&&(WebGL.context.depthMask(t),et.depthWrite=t)},WebGL.enableBlending=function(t){t!==et.blending&&(t?WebGL.context.enable(WebGL.context.BLEND):WebGL.context.disable(WebGL.context.BLEND),et.blending=t)},WebGL.enableCulling=function(t){t!==et.culling&&(t?WebGL.context.enable(WebGL.context.CULL_FACE):WebGL.context.disable(WebGL.context.CULL_FACE),et.culling=t)},WebGL.setCullMode=function(t){t!==et.cullMode&&(WebGL.context.cullFace(t),et.cullMode=t)},WebGL.setBlendFunc=function(t,n){t===et.blendFunc[0]&&n===et.blendFunc[1]||(WebGL.context.blendFunc(t,n),et.blendFunc[0]=t,et.blendFunc[1]=n)},WebGL.extensions={OES_texture_float:!1,OES_standard_derivatives:!1,WEBGL_depth_texture:!1},WebGL.version=1,WebGL.caps={maxVertexUniforms:0},WebGL}(),st=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Texture_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Texture_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},ct=function(t){function Texture(){var n=null!==t&&t.apply(this,arguments)||this;return n._textureId=null,n}return st(Texture,t),Object.defineProperty(Texture.prototype,"textureId",{get:function(){return this._textureId},enumerable:!1,configurable:!0}),Texture.prototype.getWidth=function(){return 0},Texture.prototype.getHeight=function(){return 0},Texture.prototype.begin=function(t){return!1},Texture.prototype.graphicUnload=function(){this._textureId&&(at.context.deleteTexture(this._textureId),this._textureId=null)},Texture_decorate([Attributes_unserializable(),Texture_metadata("design:type",Object)],Texture.prototype,"_textureId",void 0),Texture}(ot),Size_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Size_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t[t.Absolute=0]="Absolute",t[t.Relative=1]="Relative"}(it||(it={}));var ut,lt=function(){function Size(t,n){this.type=void 0!==t?t:it.Relative,this.value=n||(this.type===it.Relative?1:1024)}return Size.prototype.equals=function(t){return this.value===t.value&&this.type===t.type},Size_decorate([Attributes_enumLiterals(it),Size_metadata("design:type",Number)],Size.prototype,"type",void 0),Size}();ut||(ut={});var pt,ft=function(){function IRendererInternal(){}return Object.defineProperty(IRendererInternal,"instance",{get:function(){return ut.instance},set:function(t){ut.instance=t},enumerable:!1,configurable:!0}),IRendererInternal}(),ht=r(3);pt||(pt={});var dt,yt=function(){function IObjectManagerInternal(){}return Object.defineProperty(IObjectManagerInternal,"instance",{get:function(){return pt.instance},set:function(t){pt.instance=t},enumerable:!1,configurable:!0}),IObjectManagerInternal}(),mt=function(){function Interfaces(){}return Object.defineProperty(Interfaces,"renderer",{get:function(){return ft.instance},enumerable:!1,configurable:!0}),Object.defineProperty(Interfaces,"factory",{get:function(){return I.instance},enumerable:!1,configurable:!0}),Object.defineProperty(Interfaces,"file",{get:function(){return ht.a.instance},enumerable:!1,configurable:!0}),Object.defineProperty(Interfaces,"serializer",{get:function(){return B.instance},enumerable:!1,configurable:!0}),Object.defineProperty(Interfaces,"objectManager",{get:function(){return yt.instance},enumerable:!1,configurable:!0}),Interfaces}(),vt=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),RenderTarget_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},RenderTarget_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},gt=function(t){function RenderTarget(n,r,o,i,c,u){var l=t.call(this)||this;return l.sizeChanged=new W.VoidAsyncEvent,l._filtering=a.Linear,l._frameBuffer=null,l._depthBuffer=null,l._loadError=!1,l._actualWidth=0,l._actualHeight=0,l._width=null!=n?n:new lt,l._height=null!=r?r:new lt,l._rgba=null!=o&&o,l.isPersistent=null==i||i,l._isCubeMap=null!=u&&u,void 0!==c&&(l._filtering=c),l}return vt(RenderTarget,t),Object.defineProperty(RenderTarget.prototype,"width",{set:function(t){t.equals(this._width)||(this._width=t,this._frameBuffer&&this.resize(),this.sizeChanged.post())},enumerable:!1,configurable:!0}),Object.defineProperty(RenderTarget.prototype,"height",{set:function(t){t.equals(this._height)||(this._height=t,this._frameBuffer&&this.resize(),this.sizeChanged.post())},enumerable:!1,configurable:!0}),Object.defineProperty(RenderTarget.prototype,"valid",{get:function(){return Boolean(this._frameBuffer)},enumerable:!1,configurable:!0}),RenderTarget.prototype.getWidth=function(){return this._actualWidth},RenderTarget.prototype.getHeight=function(){return this._actualHeight},RenderTarget.prototype.bind=function(t){if(!this._frameBuffer){if(this._loadError)return!1;if(!this.graphicLoad())return!1}var n=at.context;return n.bindFramebuffer(n.FRAMEBUFFER,this._frameBuffer),void 0!==t&&n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,t,this._textureId,0),n.viewport(0,0,this._actualWidth,this._actualHeight),at.enableDepthWrite(!0),n.clearColor(0,0,0,1),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),!0},RenderTarget.prototype.begin=function(t){return!!this._textureId&&(mt.renderer.renderTarget!==this&&(at.context.activeTexture(at.context.TEXTURE0+t),this._isCubeMap?at.context.bindTexture(at.context.TEXTURE_CUBE_MAP,this._textureId):at.context.bindTexture(at.context.TEXTURE_2D,this._textureId),!0))},RenderTarget.prototype.graphicLoad=function(){if(this._frameBuffer)return!0;var t=at.context;return this._frameBuffer=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,this._frameBuffer),this._textureId=t.createTexture(),this._depthBuffer=t.createRenderbuffer(),this.resize(),this._isCubeMap||t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this._textureId,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this._depthBuffer),t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE||(p.logError("Could not create render target"),this._loadError=!0,!1)},RenderTarget.prototype.graphicUnload=function(){t.prototype.graphicUnload.call(this),this._frameBuffer&&(at.context.deleteFramebuffer(this._frameBuffer),at.context.deleteRenderbuffer(this._depthBuffer),this._frameBuffer=null,this._depthBuffer=null)},RenderTarget.prototype.resize=function(){var t=this;this._actualWidth=this._width.value,this._actualHeight=this._height.value;var n=at.context;this._isCubeMap?(n.bindTexture(n.TEXTURE_CUBE_MAP,this._textureId),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,0),n.pixelStorei(n.UNPACK_ALIGNMENT,4),at.cubeMapFaces.forEach((function(r){n.texImage2D(r,0,n.RGBA,t._actualWidth,t._actualHeight,0,n.RGBA,n.UNSIGNED_BYTE,null)})),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_CUBE_MAP,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)):(n.bindTexture(n.TEXTURE_2D,this._textureId),this._width.type===it.Relative&&(this._actualWidth=mt.renderer.screenSize.x*this._actualWidth),this._height.type===it.Relative&&(this._actualHeight=mt.renderer.screenSize.y*this._actualHeight),this._rgba?n.texImage2D(n.TEXTURE_2D,0,n.RGBA,this._actualWidth,this._actualHeight,0,n.RGBA,n.UNSIGNED_BYTE,null):n.texImage2D(n.TEXTURE_2D,0,n.RGB,this._actualWidth,this._actualHeight,0,n.RGB,n.UNSIGNED_BYTE,null),this._filtering===a.Nearest?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),n.bindRenderbuffer(n.RENDERBUFFER,this._depthBuffer),n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_COMPONENT16,this._actualWidth,this._actualHeight),n.bindRenderbuffer(n.RENDERBUFFER,null)},RenderTarget_decorate([Attributes_unserializable(),RenderTarget_metadata("design:type",Object)],RenderTarget.prototype,"sizeChanged",void 0),RenderTarget_decorate([Attributes_enumLiterals(a),RenderTarget_metadata("design:type",Object)],RenderTarget.prototype,"_filtering",void 0),RenderTarget_decorate([Attributes_unserializable(),RenderTarget_metadata("design:type",Object)],RenderTarget.prototype,"_frameBuffer",void 0),RenderTarget_decorate([Attributes_unserializable(),RenderTarget_metadata("design:type",Object)],RenderTarget.prototype,"_depthBuffer",void 0),RenderTarget_decorate([Attributes_unserializable(),RenderTarget_metadata("design:type",Object)],RenderTarget.prototype,"_loadError",void 0),RenderTarget_decorate([Attributes_unserializable(),RenderTarget_metadata("design:type",Object)],RenderTarget.prototype,"_actualWidth",void 0),RenderTarget_decorate([Attributes_unserializable(),RenderTarget_metadata("design:type",Object)],RenderTarget.prototype,"_actualHeight",void 0),RenderTarget_decorate([Attributes_unserializable(),RenderTarget_metadata("design:type",Boolean)],RenderTarget.prototype,"_isCubeMap",void 0),RenderTarget=RenderTarget_decorate([creatable(!0),referencable(!0),displayName("Render Target"),RenderTarget_metadata("design:paramtypes",[lt,lt,Boolean,Boolean,Number,Boolean])],RenderTarget)}(ct),_t=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),PerspectiveProjector_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},PerspectiveProjector_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},bt=function(t){function PerspectiveProjector(){var n=null!==t&&t.apply(this,arguments)||this;return n._fov=60,n._projectionMatrix=new A,n}return _t(PerspectiveProjector,t),Object.defineProperty(PerspectiveProjector.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(PerspectiveProjector.prototype,"fov",{get:function(){return this._fov},set:function(t){this._fov=t,this.changed.post()},enumerable:!1,configurable:!0}),PerspectiveProjector.prototype.getProjectionMatrix=function(){return this._projectionMatrix},PerspectiveProjector.prototype.updateFrustum=function(t,n){var r=this,o=P.toRadians(this._fov);this._projectionMatrix.makePerspectiveProjection(o,n,this._zNear,this._zFar);var i=o/2,_update=function(r,o,a){var c=Math.tan(i)*o,u=c*n,l=Math.tan(i)*a,p=l*n;r.update(u,c,p,l,o,a,t)};_update(this._frustum.full,this.zNear,this.zFar),V.shadowCascadeEdges.forEach((function(t,n){_update(r._frustum.splits[n],r._zNear+(n>0?V.shadowCascadeEdges[n-1]:0),r._zNear+t)}))},PerspectiveProjector.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_zNear:t.properties.zNear,_zFar:t.properties.zFar,_fov:t.properties.fov}),delete t.properties.zNear,delete t.properties.zFar,delete t.properties.fov),t},PerspectiveProjector_decorate([Attributes_unserializable(),PerspectiveProjector_metadata("design:type",Object)],PerspectiveProjector.prototype,"_projectionMatrix",void 0),PerspectiveProjector}(H),wt=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),xt=function(t){function ArrayProperty(n,r){var o=t.call(this)||this;return o.grow=function(t){return o.data.push(t||new n)},o.typeName=function(){return n.name},o.getData=function(){return o.data},o.data=r||[],o}return wt(ArrayProperty,t),ArrayProperty.prototype.clear=function(){this.data.length=0},ArrayProperty}((function IArrayProperty(){}));!function(t){t[t.Continue=0]="Continue",t[t.Finish=1]="Finish"}(dt||(dt={}));var Pt,Ot=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Pin_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Pin_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t[t.Input=0]="Input",t[t.Output=1]="Output",t[t.InputOutput=2]="InputOutput"}(Pt||(Pt={}));var Ct,St=function(t){function PinReference(n,r){var o=t.call(this)||this;return o.operatorId=n||Y.makeUniqueId(),o.pinId=r||Y.makeUniqueId(),o}return Ot(PinReference,t),PinReference.prototype.equals=function(t){return this.operatorId===t.operatorId&&this.pinId===t.pinId},PinReference}(z),At=function(t){function BasePin(n,r,o){var i=t.call(this)||this;return i.id=o||n||Y.makeUniqueId(),i.name=n||"NewPin",i.type=r||Pt.Input,i}return Ot(BasePin,t),Object.defineProperty(BasePin.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),BasePin.prototype.upgrade=function(t,n){return 1===n&&(t.properties.id=t.properties.name),t},Pin_decorate([Attributes_hidden(),Pin_metadata("design:type",String)],BasePin.prototype,"id",void 0),Pin_decorate([Attributes_hidden(),Pin_metadata("design:type",String)],BasePin.prototype,"name",void 0),Pin_decorate([Attributes_hidden(),Pin_metadata("design:type",Number)],BasePin.prototype,"type",void 0),BasePin}(z),Et=function(t){function SignalPin(){return null!==t&&t.apply(this,arguments)||this}return Ot(SignalPin,t),SignalPin=Pin_decorate([displayName("Signal")],SignalPin)}(At),jt=function(t){function DataPin(){return null!==t&&t.apply(this,arguments)||this}return Ot(DataPin,t),DataPin.prototype.setData=function(t){},DataPin.prototype.getData=function(){},DataPin}(At),Tt=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Rt=function(t){function ReferenceArray(n,r){var o=t.call(this)||this;return o.grow=function(t){return o.data.push(new v(n,t))},o.typeName=function(){return n.name},o.getData=function(){return o.data},o.data=r||[],o._clone=function(){for(var t=new ReferenceArray(n),r=0,i=o.data;r<i.length;r++){var a=i[r];a.instance&&t.grow(a.instance.copy())}return t},o}return Tt(ReferenceArray,t),ReferenceArray.prototype.get=function(t){return this.data[t].instance},ReferenceArray.prototype.copy=function(){return this._clone()},ReferenceArray.prototype.clear=function(){this.data.length=0},ReferenceArray}((function ReferenceArrayBase(){})),Bt=function(){function Vector4(t,n,r,o){this.set(t||0,n||0,r||0,o||0)}return Object.defineProperty(Vector4.prototype,"manhattanLength",{get:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},enumerable:!1,configurable:!0}),Object.defineProperty(Vector4.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!1,configurable:!0}),Object.defineProperty(Vector4.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!1,configurable:!0}),Object.defineProperty(Vector4.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t},enumerable:!1,configurable:!0}),Object.defineProperty(Vector4.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t},enumerable:!1,configurable:!0}),Vector4.fromArray=function(t){var n=new Vector4;t.length>0&&(n.x=t[0]),t.length>1&&(n.y=t[1]),t.length>2&&(n.z=t[2]),t.length>3&&(n.w=t[3])},Vector4.fromPool=function(){return Vector4.pool.get()},Vector4.prototype.set=function(t,n,r,o){return this.x=t,this.y=n,this.z=r,this.w=o,this},Vector4.prototype.copy=function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this.w=t.w,this},Vector4.prototype.multiply=function(t){return this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t,this},Vector4.prototype.toArray=function(){return this._array?(this._array[0]=this.x,this._array[1]=this.y,this._array[2]=this.z,this._array[3]=this.w,this._array):(this._array=[this.x,this.y,this.z,this.w],this._array)},Vector4.prototype.transform=function(t){var n=this.x,r=this.y,o=this.z,i=this.w,a=t.data;return this.x=a[0]*n+a[4]*r+a[8]*o+a[12]*i,this.y=a[1]*n+a[5]*r+a[9]*o+a[13]*i,this.z=a[2]*n+a[6]*r+a[10]*o+a[14]*i,this.w=a[3]*n+a[7]*r+a[11]*o+a[15]*i,this},Vector4.prototype.getVec3=function(t){return t.set(this.x,this.y,this.z)},Vector4.dummy=new Vector4,Vector4.pool=new f(Vector4,128),Vector4}();!function(t){t.hue2rgb=function hue2rgb(t,n,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+6*(n-t)*r:r<.5?n:r<2/3?t+6*(n-t)*(2/3-r):t}}(Ct||(Ct={}));var Mt,It=function(){function Color(t,n,r,o){this.set(t||0,n||0,r||0,o)}return Color.prototype.set=function(t,n,r,o){return this.r=t,this.g=n,this.b=r,this.a=void 0!==o?o:1,this},Color.prototype.setFromArray=function(t){return this.r=t.length>0?t[0]:0,this.g=t.length>1?t[1]:0,this.b=t.length>2?t[2]:0,this.a=t.length>3?t[3]:1,this},Color.prototype.setFromChromeColor=function(t,n,r,o){return this.r=t/255,this.g=n/255,this.b=r/255,this.a=o,this},Color.prototype.toChromeColor=function(){return{r:Math.round(255*this.r),g:Math.round(255*this.g),b:Math.round(255*this.b),a:this.a}},Color.prototype.asArray=function(){return this._array?(this._array[0]=this.r,this._array[1]=this.g,this._array[2]=this.b,this._array[3]=this.a,this._array):(this._array=[this.r,this.g,this.b,this.a],this._array)},Color.prototype.copy=function(t){return this.set(t.r,t.g,t.b,t.a)},Color.prototype.equals=function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},Color.prototype.setAlpha=function(t){return this.a=t,this},Color.prototype.multiplyColor=function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this.a*=t.a,this},Color.prototype.multiply=function(t){return this.r=Math.min(this.r*t,1),this.g=Math.min(this.g*t,1),this.b=Math.min(this.b*t,1),this.a=Math.min(this.a*t,1),this},Color.prototype.add=function(t){return this.r=Math.min(this.r+t.r,1),this.g=Math.min(this.g+t.g,1),this.b=Math.min(this.b+t.b,1),this.a=Math.min(this.a+t.a,1),this},Color.prototype.setHSL=function(t,n,r){if(t=P.euclideanModulo(t,1),n=P.clamp(n,0,1),r=P.clamp(r,0,1),0===n)this.r=this.g=this.b=r;else{var o=r<=.5?r*(1+n):r+n-r*n,i=2*r-o;this.r=Ct.hue2rgb(i,o,t+1/3),this.g=Ct.hue2rgb(i,o,t),this.b=Ct.hue2rgb(i,o,t-1/3)}return this},Color.prototype.lerp=function(t,n){return this.lerpColors(this,t,n)},Color.prototype.lerpColors=function(t,n,r){return this.r=P.lerp(t.r,n.r,r),this.g=P.lerp(t.g,n.g,r),this.b=P.lerp(t.b,n.b,r),this.a=P.lerp(t.a,n.a,r),this},Color.black=new Color,Color.white=new Color(1,1,1),Color.red=new Color(1,0,0),Color.green=new Color(0,1,0),Color.blue=new Color(0,0,1),Color.yellow=new Color(1,1,0),Color.pink=new Color(1,0,1),Color.orange=new Color(1,.5,0),Color.grey=new Color(.7,.7,.7),Color.dummy=new Color,Color}();!function(t){t.dummy=new A}(Mt||(Mt={}));var zt,kt=function(){function Quaternion(t,n,r,o){this._x=t||0,this._y=n||0,this._z=r||0,this._w=o||1}return Object.defineProperty(Quaternion.prototype,"length",{get:function(){return Math.sqrt(this.lengthSq)},enumerable:!1,configurable:!0}),Object.defineProperty(Quaternion.prototype,"lengthSq",{get:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},enumerable:!1,configurable:!0}),Object.defineProperty(Quaternion.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t},enumerable:!1,configurable:!0}),Object.defineProperty(Quaternion.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t},enumerable:!1,configurable:!0}),Object.defineProperty(Quaternion.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t},enumerable:!1,configurable:!0}),Object.defineProperty(Quaternion.prototype,"w",{get:function(){return this._w},set:function(t){this._w=t},enumerable:!1,configurable:!0}),Quaternion.fromPool=function(){return Quaternion.pool.get()},Quaternion.fromEulerAngles=function(t,n,r,o){return void 0===o&&(o="YXZ"),(new Quaternion).setFromEulerAngles(t,n,r,o)},Quaternion.fromAxisAngle=function(t,n){return(new Quaternion).setFromAxisAngle(t,n)},Quaternion.fromUnitVectors=function(t,n){return(new Quaternion).setFromUnitVectors(t,n)},Quaternion.prototype.set=function(t,n,r,o){this._x=t,this._y=n,this._z=r,this.w=o},Quaternion.prototype.setFromAxisAngle=function(t,n){var r=n/2,o=Math.sin(r);return this._x=t.x*o,this._y=t.y*o,this._z=t.z*o,this._w=Math.cos(r),this.normalize()},Quaternion.prototype.setFromEulerAngles=function(t,n,r,o){void 0===o&&(o="YXZ");var i=Math.cos(t/2),a=Math.cos(n/2),c=Math.cos(r/2),u=Math.sin(t/2),l=Math.sin(n/2),p=Math.sin(r/2);return"YXZ"===o?(this._x=u*a*c+i*l*p,this._y=i*l*c-u*a*p,this._z=i*a*p-u*l*c,this._w=i*a*c+u*l*p):"ZYX"===o?(this._x=u*a*c-i*l*p,this._y=i*l*c+u*a*p,this._z=i*a*p-u*l*c,this._w=i*a*c+u*l*p):"XYZ"===o?(this._x=u*a*c+i*l*p,this._y=i*l*c-u*a*p,this._z=i*a*p+u*l*c,this._w=i*a*c-u*l*p):"ZXY"===o?(this._x=u*a*c-i*l*p,this._y=i*l*c+u*a*p,this._z=i*a*p+u*l*c,this._w=i*a*c-u*l*p):"YZX"===o?(this._x=u*a*c+i*l*p,this._y=i*l*c+u*a*p,this._z=i*a*p-u*l*c,this._w=i*a*c-u*l*p):"XZY"===o&&(this._x=u*a*c-i*l*p,this._y=i*l*c-u*a*p,this._z=i*a*p+u*l*c,this._w=i*a*c+u*l*p),this.normalize()},Quaternion.prototype.setFromEulerVector=function(t){return this.setFromEulerAngles(t.x,t.y,t.z)},Quaternion.prototype.setFromUnitVectors=function(t,n){var r=w.dummy,o=t.dot(n)+1;return o<1e-6?(o=0,Math.abs(t.x)>Math.abs(t.z)?r.set(-t.y,t.x,0):r.set(0,-t.z,t.y)):r.crossVectors(t,n),this._x=r.x,this._y=r.y,this._z=r.z,this._w=o,this.normalize()},Quaternion.prototype.setFromMatrix=function(t){var n,r=t.data,o=r[0],i=r[4],a=r[8],c=r[1],u=r[5],l=r[9],p=r[2],f=r[6],h=r[10],d=o+u+h;return d>0?(n=.5/Math.sqrt(d+1),this._w=.25/n,this._x=(f-l)*n,this._y=(a-p)*n,this._z=(c-i)*n):o>u&&o>h?(n=2*Math.sqrt(1+o-u-h),this._w=(f-l)/n,this._x=.25*n,this._y=(i+c)/n,this._z=(a+p)/n):u>h?(n=2*Math.sqrt(1+u-o-h),this._w=(a-p)/n,this._x=(i+c)/n,this._y=.25*n,this._z=(l+f)/n):(n=2*Math.sqrt(1+h-o-u),this._w=(c-i)/n,this._x=(a+p)/n,this._y=(l+f)/n,this._z=.25*n),this.normalize()},Quaternion.prototype.lookAt=function(t,n){var r=Mt.dummy;return r.makeLookAt(t,n).transpose(),this.setFromMatrix(r)},Quaternion.prototype.normalize=function(){var t=this.length;return 0===t||(t=1/t,this._x*=t,this._y*=t,this._z*=t,this.w*=t),this},Quaternion.prototype.multiply=function(t){return this.multiplyQuaternions(this,t)},Quaternion.prototype.multiplyQuaternions=function(t,n){var r=n._x,o=n._y,i=n._z,a=n._w,c=t._x,u=t._y,l=t._z,p=t._w;return this._x=r*p+a*c+o*l-i*u,this._y=o*p+a*u+i*c-r*l,this._z=i*p+a*l+r*u-o*c,this.w=a*p-r*c-o*u-i*l,this},Quaternion.prototype.toEuler=function(t){return Mt.dummy.setRotation(this).toEuler(t)},Quaternion.prototype.equals=function(t){return this._x===t._x&&this._y===t._y&&this._z===t._z&&this._w===t._w},Quaternion.prototype.copy=function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this.w=t._w,this},Quaternion.prototype.invert=function(){return this.conjugate()},Quaternion.prototype.getInverse=function(t){return t.copy(this).invert()},Quaternion.prototype.conjugate=function(){return this._x*=-1,this._y*=-1,this.z*=-1,this},Quaternion.prototype.slerpQuaternions=function(t,n,r){return this.copy(t).slerp(n,r)},Quaternion.prototype.slerp=function(t,n){if(0===n)return this;if(1===n)return this.copy(t);var r=this._x,o=this._y,i=this._z,a=this._w,c=a*t._w+r*t._x+o*t._y+i*t._z;if(c<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,c=-c):this.copy(t),c>=1)return this._w=a,this._x=r,this._y=o,this.z=i,this;var u=Math.sqrt(1-c*c);if(Math.abs(u)<.001)return this._w=.5*(a+this.w),this._x=.5*(r+this.x),this._y=.5*(o+this.y),this.z=.5*(i+this.z),this;var l=Math.atan2(u,c),p=Math.sin((1-n)*l)/u,f=Math.sin(n*l)/u;return this._w=a*p+this.w*f,this._x=r*p+this.x*f,this._y=o*p+this.y*f,this.z=i*p+this.z*f,this},Quaternion.identity=new Quaternion,Quaternion.dummy=new Quaternion,Quaternion.pool=new f(Quaternion,64),Quaternion}(),Dt=function(){function Matrix33(t){this.data=t||[1,0,0,0,1,0,0,0,1]}return Matrix33.fromPool=function(){return Matrix33.pool.get()},Matrix33.prototype.setIdentity=function(){return this.set(1,0,0,0,1,0,0,0,1),this},Matrix33.prototype.set=function(t,n,r,o,i,a,c,u,l){var p=this.data;return p[0]=t,p[3]=n,p[6]=r,p[1]=o,p[4]=i,p[7]=a,p[2]=c,p[5]=u,p[8]=l,this},Matrix33.prototype.setFromMatrix4=function(t){var n=t.data;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this},Matrix33.prototype.multiply=function(t){return this.multiplyMatrices(this,t)},Matrix33.prototype.multiplyMatrices=function(t,n){var r=t.data,o=n.data,i=this.data,a=r[0],c=r[3],u=r[6],l=r[1],p=r[4],f=r[7],h=r[2],d=r[5],y=r[8],m=o[0],v=o[3],g=o[6],_=o[1],b=o[4],w=o[7],x=o[2],P=o[5],O=o[8];return i[0]=a*m+c*_+u*x,i[3]=a*v+c*b+u*P,i[6]=a*g+c*w+u*O,i[1]=l*m+p*_+f*x,i[4]=l*v+p*b+f*P,i[7]=l*g+p*w+f*O,i[2]=h*m+d*_+y*x,i[5]=h*v+d*b+y*P,i[8]=h*g+d*w+y*O,this},Matrix33.prototype.multiplyScalar=function(t){var n=this.data;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=t,n[4]*=t,n[7]*=t,n[2]*=t,n[5]*=t,n[8]*=t,this},Matrix33.prototype.determinant=function(){var t=this.data,n=t[0],r=t[1],o=t[2],i=t[3],a=t[4],c=t[5],u=t[6],l=t[7],p=t[8];return n*a*p-n*c*l-r*i*p+r*c*u+o*i*l-o*a*u},Matrix33.prototype.invert=function(){return this.getInverse(this)},Matrix33.prototype.getInverse=function(t){var n=t.data,r=this.data,o=n[0],i=n[1],a=n[2],c=n[3],u=n[4],l=n[5],p=n[6],f=n[7],h=n[8],d=h*u-l*f,y=l*p-h*c,m=f*c-u*p,v=o*d+i*y+a*m;if(0===v)return this.setIdentity();var g=1/v;return r[0]=d*g,r[1]=(a*f-h*i)*g,r[2]=(l*i-a*u)*g,r[3]=y*g,r[4]=(h*o-a*p)*g,r[5]=(a*c-l*o)*g,r[6]=m*g,r[7]=(i*p-f*o)*g,r[8]=(u*o-i*c)*g,this},Matrix33.prototype.getNormalMatrix=function(t){return this.setFromMatrix4(t)},Matrix33.prototype.transpose=function(){var t,n=this.data;return t=n[1],n[1]=n[3],n[3]=t,t=n[2],n[2]=n[6],n[6]=t,t=n[5],n[5]=n[7],n[7]=t,this},Matrix33.prototype.scale=function(t,n){var r=this.data;return r[0]*=t,r[3]*=t,r[6]*=t,r[1]*=n,r[4]*=n,r[7]*=n,this},Matrix33.prototype.rotate=function(t){var n=Math.cos(t),r=Math.sin(t),o=this.data,i=o[0],a=o[3],c=o[6],u=o[1],l=o[4],p=o[7];return o[0]=n*i+r*u,o[3]=n*a+r*l,o[6]=n*c+r*p,o[1]=-r*i+n*u,o[4]=-r*a+n*l,o[7]=-r*c+n*p,this},Matrix33.prototype.translate=function(t,n){var r=this.data;return r[0]+=t*r[2],r[3]+=t*r[5],r[6]+=t*r[8],r[1]+=n*r[2],r[4]+=n*r[5],r[7]+=n*r[8],this},Matrix33.identity=new Matrix33,Matrix33.pool=new f(Matrix33,8),Matrix33}(),Ft=function(){function AABB(t,n){var r=this;this._corners=Array.from(new Array(8)).map((function(){return new w})),this._cornersDirty=!0,this.min=t||new w,this.max=n||new w;var attachToBound=function(t){Object.defineProperty(t,"x",{set:function(n){t[y.xKey]=n,r._cornersDirty=!0},get:function(){return t[y.xKey]}}),Object.defineProperty(t,"y",{set:function(n){t[y.yKey]=n,r._cornersDirty=!0},get:function(){return t[y.yKey]}}),Object.defineProperty(t,"z",{set:function(n){t[y.zKey]=n,r._cornersDirty=!0},get:function(){return t[y.zKey]}})};attachToBound(this.min),attachToBound(this.max)}return Object.defineProperty(AABB.prototype,"corners",{get:function(){return this._cornersDirty&&(this._corners[0].set(this.min.x,this.min.y,this.min.z),this._corners[1].set(this.max.x,this.min.y,this.min.z),this._corners[2].set(this.min.x,this.min.y,this.max.z),this._corners[3].set(this.max.x,this.min.y,this.max.z),this._corners[4].set(this.min.x,this.max.y,this.min.z),this._corners[5].set(this.max.x,this.max.y,this.min.z),this._corners[6].set(this.min.x,this.max.y,this.max.z),this._corners[7].set(this.max.x,this.max.y,this.max.z),this._cornersDirty=!1),this._corners},enumerable:!1,configurable:!0}),AABB.fromVertexBuffer=function(t){var n=t.attributes,r=t.indices;return AABB.fromVertexArray(n.position,r)},AABB.fromVertexArray=function(t,n){var r=new AABB,updateBBox=function(t,n,o){r.min.x>t&&(r.min.x=t),r.max.x<t&&(r.max.x=t),r.min.y>n&&(r.min.y=n),r.max.y<n&&(r.max.y=n),r.min.z>o&&(r.min.z=o),r.max.z<o&&(r.max.z=o)};if(n){r.min.copy(w.one).multiply(999999),r.max.copy(w.one).multiply(-999999);for(var o=0;o<n.length;++o){var i=3*n[o];updateBBox(t[i],t[i+1],t[i+2])}}else{r.min.copy(w.one).multiply(999999),r.max.copy(w.one).multiply(-999999);for(o=0;o<t.length;o+=3){updateBBox(t[o],t[o+1],t[o+2])}}return r},AABB.fromPool=function(){return AABB.pool.get()},AABB.prototype.set=function(t,n){return this.min.copy(t),this.max.copy(n),this},AABB.prototype.contains=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},AABB.prototype.collidesWith=function(t){return!(this.min.x>t.max.x)&&(!(this.min.y>t.max.y)&&(!(this.min.z>t.max.z)&&(!(t.min.x>this.max.x)&&(!(t.min.y>this.max.y)&&!(t.min.z>this.max.z)))))},AABB.prototype.add=function(t){return this.addAABBs(this,t)},AABB.prototype.addAABBs=function(t,n){return this.min.set(Math.min(t.min.x,n.min.x),Math.min(t.min.y,n.min.y),Math.min(t.min.z,n.min.z)),this.max.set(Math.max(t.max.x,n.max.x),Math.max(t.max.y,n.max.y),Math.max(t.max.z,n.max.z)),this},AABB.prototype.copy=function(t){return this.min.copy(t.min),this.max.copy(t.max),this},AABB.prototype.transform=function(t){for(var n=w.fromPool().set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),r=w.fromPool().set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o=w.fromPool(),i=0,a=this.corners;i<a.length;i++){var c=a[i];o.copy(c).transform(t),n.set(Math.min(n.x,o.x),Math.min(n.y,o.y),Math.min(n.z,o.z)),r.set(Math.max(r.x,o.x),Math.max(r.y,o.y),Math.max(r.z,o.z))}return this.min.copy(n),this.max.copy(r),this},AABB.pool=new f(AABB,32),AABB}(),UISize_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},UISize_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t[t.Auto=0]="Auto",t[t.Relative=1]="Relative",t[t.Absolute=2]="Absolute"}(zt||(zt={}));var Lt,Nt=function(){function UISize(t,n){this.type=zt.Auto,this.value=256,void 0!==t&&(this.type=t),void 0!==n&&(this.value=n)}return UISize_decorate([Attributes_enumLiterals(zt),UISize_metadata("design:type",Object)],UISize.prototype,"type",void 0),UISize}(),Vt=function(){function VertexBuffer(t){var n=this;this._attributes={},this._vertexCount=0,this._metaData={},this._isLoaded=!1,this._isDynamic=!1,this._id=Y.makeUniqueId(),t&&Object.entries(t).forEach((function(t){var r,o=t[0],i=t[1];Object.assign(n,((r={})[o]=i,r))}))}return Object.defineProperty(VertexBuffer.prototype,"vertexCount",{get:function(){return this._vertexCount},set:function(t){this._vertexCount=t},enumerable:!1,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"primitiveType",{get:function(){return this._primitiveType},set:function(t){this._primitiveType=t},enumerable:!1,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"isDynamic",{get:function(){return this._isDynamic},set:function(t){this._isDynamic=t},enumerable:!1,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"name",{get:function(){return this._name},set:function(t){this._name=t},enumerable:!1,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"attributes",{get:function(){return this._attributes},set:function(t){var n=this;Object.entries(t).forEach((function(t){var r=t[0],o=t[1];n.setAttribute(r,o)}))},enumerable:!1,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(VertexBuffer.prototype,"indices",{get:function(){return this._indices},set:function(t){this._indices=t,t?this._indicesMetaData={glBuffer:null,isDirty:!0}:delete this._indicesMetaData},enumerable:!1,configurable:!0}),VertexBuffer.prototype.copy=function(){return mt.serializer.copyVertexBuffer(this)},VertexBuffer.prototype.setAttribute=function(t,n){this._attributes[t]=n,t in this._metaData?this._metaData[t].isDirty=!0:this._metaData[t]={glBuffer:null,isDirty:!0},"position"===t&&(this._vertexCount=n.length/3)},VertexBuffer.prototype.dirtifyAttribute=function(t){t in this._metaData?(this._metaData[t].isDirty=!0,"position"===t&&mt.renderer.showWireFrame&&this.loadBarycentricCoords()):p.log("Attribute '"+t+"' not found on VertexBuffer'")},VertexBuffer.prototype.updateBufferDatas=function(){for(var t=0,n=Object.keys(this._metaData);t<n.length;t++){var r=n[t];this.updateBufferDataIfNecessary(r)}},VertexBuffer.prototype.begin=function(t){this.bindBuffers(),this.bindAttributes(t.getAttributes())},VertexBuffer.prototype.bindBuffers=function(){if(this._isLoaded){var t=mt.renderer.showWireFrame;t!==this.hasBarycentricCoords()&&(t?this.loadBarycentricCoords():(at.context.deleteBuffer(this._metaData.barycentricCoord.glBuffer),delete this._attributes.barycentricCoord,delete this._metaData.barycentricCoord))}else this.load(),mt.renderer.showWireFrame&&this.loadBarycentricCoords(),this._isLoaded=!0;this._indicesMetaData&&at.context.bindBuffer(at.context.ELEMENT_ARRAY_BUFFER,this._indicesMetaData.glBuffer)},VertexBuffer.prototype.end=function(t){this.unbindAttributes(t.getAttributes())},VertexBuffer.prototype.draw=function(){if(0!==this._vertexCount){var t=at.primitiveTypes[this._primitiveType],n=at.context;this._indices?n.drawElements(t,this._indices.length,n.UNSIGNED_SHORT,0):n.drawArrays(t,0,this._vertexCount)}},VertexBuffer.prototype.load=function(){for(var t=at.context,n=0,r=Object.entries(this._attributes);n<r.length;n++){var o,i=r[n],a=i[0],c=i[1];(o=t.createBuffer())&&(t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array(c),this._isDynamic?t.DYNAMIC_DRAW:t.STATIC_DRAW),this._metaData[a].glBuffer=o,this._metaData[a].isDirty=!1)}if(this._indices&&(o=t.createBuffer())){var u=this._indicesMetaData;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,o),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this._indices),t.STATIC_DRAW),u.glBuffer=o,u.isDirty=!1}},VertexBuffer.prototype.unload=function(){if(this._isLoaded){for(var t=at.context,n=0,r=Object.keys(this._attributes);n<r.length;n++){var o=r[n];(i=this._metaData[o].glBuffer)&&(t.deleteBuffer(i),this._metaData[o].glBuffer=null)}if(this._indices){var i,a=this._indicesMetaData;(i=a.glBuffer)&&(t.deleteBuffer(i),a.glBuffer=null)}this._isLoaded=!1}},VertexBuffer.prototype.bindAttributes=function(t){for(var n,r=at.context,o=0,i=Object.entries(this._metaData);o<i.length;o++){var a=i[o],c=a[0],u=a[1],l=null===(n=t[c])||void 0===n?void 0:n.location;if(!(void 0===l||l<0)){var p=u.glBuffer;p&&(this.updateBufferDataIfNecessary(c)||r.bindBuffer(r.ARRAY_BUFFER,p),r.enableVertexAttribArray(l),r.vertexAttribPointer(l,t[c].componentCount,r.FLOAT,!1,0,0))}}},VertexBuffer.prototype.unbindAttributes=function(t){for(var n,r=0,o=Object.entries(this._metaData);r<o.length;r++){var i=o[r],a=i[0],c=(i[1],null===(n=t[a])||void 0===n?void 0:n.location);void 0===c||c<0||at.context.disableVertexAttribArray(c)}},VertexBuffer.prototype.hasAttribute=function(t){return t in this._metaData},VertexBuffer.prototype.updateBufferDataIfNecessary=function(t){if(!this._metaData[t].isDirty)return!1;var n=at.context;return n.bindBuffer(n.ARRAY_BUFFER,this._metaData[t].glBuffer),n.bufferData(n.ARRAY_BUFFER,new Float32Array(this._attributes[t]),this._isDynamic?n.DYNAMIC_DRAW:n.STATIC_DRAW),this._metaData[t].isDirty=!1,!0},VertexBuffer.prototype.loadBarycentricCoords=function(){if(this._attributes.position&&"TRIANGLES"===this.primitiveType){var t=this.hasBarycentricCoords(),n=t?this._attributes.barycentricCoord:[];if(n.length=this._attributes.position.length,this._indices);else for(var r=n.length/9,o=0;o<r;++o){var i=9*o;n[i+0]=1,n[i+1]=0,n[i+2]=0,n[i+3]=0,n[i+4]=1,n[i+5]=0,n[i+6]=0,n[i+7]=0,n[i+8]=1}if(t)this.dirtifyAttribute("barycentricCoord");else{this.setAttribute("barycentricCoord",n);var a=at.context,c=a.createBuffer();c&&(a.bindBuffer(a.ARRAY_BUFFER,c),a.bufferData(a.ARRAY_BUFFER,new Float32Array(n),this._isDynamic?a.DYNAMIC_DRAW:a.STATIC_DRAW),this._metaData.barycentricCoord.glBuffer=c,this._metaData.barycentricCoord.isDirty=!1)}}},VertexBuffer.prototype.hasBarycentricCoords=function(){return"barycentricCoord"in this._attributes},VertexBuffer}(),Ut=function(){function Rect(t,n,r,o){this.left=t||0,this.top=n||0,this.right=r||0,this.bottom=o||0}return Rect.prototype.set=function(t,n,r,o){this.left=t,this.top=n,this.right=r,this.bottom=o},Rect}(),Wt=function Wt(t,n,r){this.format=t,this.fileName=r,this.data=n},qt=function qt(t){this.data=t},Gt=function(){function ComponentReference(t,n){this._entity=null,this._resolved=!1,this._typeName=t.name,this._entityId=n,this._resolved=!1}return Object.defineProperty(ComponentReference.prototype,"entityId",{get:function(){return this._entityId},set:function(t){t!==this._entityId&&(this._entityId=t,this._resolved=!1)},enumerable:!1,configurable:!0}),Object.defineProperty(ComponentReference.prototype,"typeName",{get:function(){return this._typeName},enumerable:!1,configurable:!0}),Object.defineProperty(ComponentReference.prototype,"component",{get:function(){return this._entityId?(this._resolved||(this._entity=Ra.get(this._entityId),this._entity||p.logWarning("A missing entity (id: '"+this._entityId+"') is still referenced by the scene"),this._resolved=!0),this._entity?Oa.getComponentByName(this._entity,this._typeName):null):null},set:function(t){t?(this._typeName=t.constructor.name,this._entity=t.entity,this._entityId=t.entity.id):(this._entity=null,delete this._entityId),this._resolved=!0},enumerable:!1,configurable:!0}),ComponentReference}(),Ht=function(){function Random(){}return Random.range=function(t,n){return P.lerp(t,n,Math.random())},Random.rangeInt=function(t,n){return Math.round(Random.range(t,n))},Random}(),Xt=function(){function Range(t,n){this.min=t||0,this.max=n||0}return Range.prototype.random=function(){return Ht.range(this.min,this.max)},Range}(),Kt=function(){function AssetReferenceArray(t,n){var r=this;this.grow=function(n){return r.data.push(new K(t,n))},this.typeName=function(){return t.name},this.data=n||[]}return AssetReferenceArray.prototype.detach=function(){for(var t=0,n=this.data;t<n.length;t++){n[t].detach()}},AssetReferenceArray}(),Qt=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Yt=function(){function NativeArray(t,n){this._typeName=t,this.data=n||[]}return Object.defineProperty(NativeArray.prototype,"typeName",{get:function(){return this._typeName},enumerable:!1,configurable:!0}),NativeArray}(),Zt=function(t){function NumberNativeArray(n){return t.call(this,"number",n)||this}return Qt(NumberNativeArray,t),NumberNativeArray}(Yt),Jt=function(t){function StringNativeArray(n){return t.call(this,"string",n)||this}return Qt(StringNativeArray,t),StringNativeArray}(Yt),$t=function(t){function BooleanNativeArray(n){return t.call(this,"boolean",n)||this}return Qt(BooleanNativeArray,t),BooleanNativeArray}(Yt);!function(t){t.factory={number:function(t){return new Zt(t)},string:function(t){return new Jt(t)},boolean:function(t){return new $t(t)}}}(Lt||(Lt={}));var te,ee=function(){function NativeArrayFactory(){}return NativeArrayFactory.create=function(t,n){return Lt.factory[t](n)},NativeArrayFactory}(),ne=r(15),__spreadArray=function(t,n){for(var r=0,o=n.length,i=t.length;r<o;r++,i++)t[i]=n[r];return t};!function(t){t.noOp="_noOp"}(te||(te={}));var re,oe=function(){function NativeSerializer(t){this.type=t,this.readProperty=function(n){return"object"==typeof n?new(t.bind.apply(t,__spreadArray([void 0],Object.keys(n).map((function(t){return n[t]}))))):n}}return NativeSerializer.prototype.writeProperty=function(t){return t},NativeSerializer}(),ie=function(){function NullSerializer(t){this.type=t}return NullSerializer.prototype.readProperty=function(t){},NullSerializer.prototype.writeProperty=function(t){return te.noOp},NullSerializer}(),ae=function(){function PropertyFactory(){}return PropertyFactory.properties={Vector3:new oe(w),Vector2:new oe(h),Vector4:new oe(Bt),Quaternion:new oe(kt),Color:new oe(It),Matrix44:new ie(A),SerializableMatrix44:new oe(E),Matrix33:new ie(Dt),Rect:new oe(Ut),FileProperty:new oe(Wt),ThumbnailProperty:new oe(qt),String:new oe(String),Number:new oe(Number),Boolean:new oe(Boolean),Range:new oe(Xt),NativeArray:{type:Yt,readProperty:function(t){return ee.create(t.typeName,t.data)},writeProperty:function(t){return{typeName:t.typeName,data:t.data}}},NativeU8Array:{type:ne.a,readProperty:function(t){return new ne.a(t)},writeProperty:function(t){return t.serialize()}},Object:{type:Object,readProperty:function(t){return JSON.parse(JSON.stringify(t))},writeProperty:function(t){return t}},AABB:{type:Ft,readProperty:function(t){var n=t.min,r=t.max;return new Ft(new w(n.x,n.y,n.z),new w(r.x,r.y,r.z))},writeProperty:function(t){return{min:{x:t.min.x,y:t.min.y,z:t.min.z},max:{x:t.max.x,y:t.max.y,z:t.max.z}}}},Plane:{type:N,readProperty:function(t){var n=t.normal,r=t.distFromOrigin;return new N(new w(n.x,n.y,n.z),r)},writeProperty:function(t){var n=t.normal;return{normal:{x:n.x,y:n.y,z:n.z},distFromOrigin:t.distFromOrigin}}},UISize:{type:Nt,readProperty:function(t){var n=new Nt;return"object"==typeof t.type?n.type=t.type.value:n.type=t.type,n.value=t.value,n},writeProperty:function(t){return{type:t.type,value:t.value}}},Size:{type:lt,readProperty:function(t){var n=new lt;return"object"==typeof t.type?n.type=t.type.value:n.type=t.type,n.value=t.value,n},writeProperty:function(t){return{type:t.type,value:t.value}}},VertexBuffer:{type:Vt,readProperty:function(t){for(var n=new Vt,r=0,o=Object.keys(t.attributes);r<o.length;r++){var i=o[r];n.setAttribute(i,t.attributes[i])}return n.primitiveType=t.primitiveType,n.isDynamic=t.isDynamic,n.name=t.name,n.indices=t.indices,n},writeProperty:function(t){return{attributes:t.attributes,vertexCount:t.vertexCount,primitiveType:t.primitiveType,isDynamic:t.isDynamic,name:t.name,indices:t.indices}}},ArrayProperty:{type:xt,readProperty:function(t){var n=[];n.length=t.data.length;for(var r=0;r<t.data.length;++r)Ca.deserializeProperty(n,r,t.typeName,t.data[r]);return T.isObjectOfType(t.typeName,"SerializableObject")?mt.factory.createObjectArray(t.typeName,n):t.typeName in PropertyFactory.properties?new xt(PropertyFactory.properties[t.typeName].type,n):void p.logError("Unknown type: "+t.typeName)},writeProperty:function(t){var n=T.isObjectOfType(t.typeName(),"SerializableObject");return{typeName:t.typeName(),data:t.getData().map((function(r){var o=Ca.serializeProperty(r,t.typeName());return n&&delete o.typeName,o}))}}},Reference:{type:v,readProperty:function(t){if(t.data){var n=mt.factory.createObject(t.data.typeName);return null!==n&&n.deserialize(t.data),mt.factory.createReference(t.baseTypeName,n)}return mt.factory.createReference(t.baseTypeName)},writeProperty:function(t){var n=t.getInstance();return{baseTypeName:t.baseTypeName(),data:n?n.serialize():void 0}}},ReferenceArray:{type:Rt,readProperty:function(t){var n=t.data.map((function(t){return PropertyFactory.properties.Reference.readProperty(t)}));return mt.factory.createReferenceArray(t.typeName,n)},writeProperty:function(t){return{typeName:t.typeName(),data:t.getData().map((function(t){return PropertyFactory.properties.Reference.writeProperty(t)}))}}},AssetReferenceArray:{type:Kt,readProperty:function(t){var n=[];n.length=t.data.length;for(var r=0;r<t.data.length;++r)Ca.deserializeProperty(n,r,"AssetReference",t.data[r]);return mt.factory.createAssetReferenceArray(t.typeName,n)},writeProperty:function(t){return{typeName:t.typeName(),data:t.data.map((function(t){return Ca.serializeProperty(t)}))}}},EntityReference:{type:Ba,readProperty:function(t){return new Ba(t)},writeProperty:function(t){return t.id}},ComponentReference:{type:Gt,readProperty:function(t){var n=t.typeName||t.componentTypeName,r=mt.factory.createComponentReference(n);return r.entityId=t.entityId,r},writeProperty:function(t){return{entityId:t.entityId,typeName:t.typeName}}}},PropertyFactory}(),se=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ObjectDeclaration_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},ObjectDeclaration_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},ce=function(t){function ObjectDeclaration(){var n=null!==t&&t.apply(this,arguments)||this;return n.pinChanged=new W.AsyncEvent,n._pins=new Rt(At),n}return se(ObjectDeclaration,t),Object.defineProperty(ObjectDeclaration.prototype,"pins",{get:function(){return this._pins},enumerable:!1,configurable:!0}),ObjectDeclaration_decorate([Attributes_unserializable(),ObjectDeclaration_metadata("design:type",Object)],ObjectDeclaration.prototype,"pinChanged",void 0),ObjectDeclaration=ObjectDeclaration_decorate([displayName("Object Declaration")],ObjectDeclaration)}(nt);!function(t){t.dummy=new w,t.dummy2=new w,t.dummy3=new w,t.dummy4=new w,t.dummy5=new w}(re||(re={}));var ue,le=function(){function Triangle(t,n,r){this.a=new w,this.b=new w,this.c=new w,this.set(t||w.zero,n||w.zero,r||w.zero)}return Triangle.fromPool=function(){return Triangle.pool.get()},Triangle.prototype.set=function(t,n,r){return this.a.copy(t),this.b.copy(n),this.c.copy(r),this},Triangle.prototype.contains=function(t,n){var r=this.getBarycentricCoords(t),o=n||.005;return r.y>=0-o&&r.z>=0-o&&r.y+r.z<=1+o},Triangle.prototype.getClosestPoint=function(t){var n=re.dummy,r=re.dummy2,o=re.dummy3,i=re.dummy4,a=re.dummy5,c=n,u=r,l=o,p=i;P.getClosestPointOnLine(t,this.a,this.b,c),P.getClosestPointOnLine(t,this.b,this.c,u),P.getClosestPointOnLine(t,this.c,this.a,l);var f=p.substractVectors(t,c).length,h=p.substractVectors(t,u).length,d=f;return h<d?(d=h,a.copy(u)):a.copy(c),p.substractVectors(t,l).length<d&&a.copy(l),a},Triangle.prototype.getBarycentricCoords=function(t){var n=re.dummy,r=re.dummy2,o=re.dummy3,i=re.dummy4,a=n,c=r,u=o;a.substractVectors(this.b,this.a),c.substractVectors(this.c,this.a),u.substractVectors(t,this.a);var l=a.dot(a),p=a.dot(c),f=c.dot(c),h=u.dot(a),d=u.dot(c),y=l*f-p*p;if(0!==y){var m=(f*h-p*d)/y,v=(l*d-p*h)/y,g=1-m-v;return i.set(g,m,v)}return i.set(0,Number.MAX_VALUE,Number.MAX_VALUE)},Triangle.pool=new f(Triangle,64),Triangle}(),pe=function(){function Basis(){this.right=(new w).copy(w.right),this.up=(new w).copy(w.up),this.forward=(new w).copy(w.forward)}return Basis.fromMatrix=function(t){return(new Basis).setFromMatrix(t)},Basis.fromNormal=function(t){return(new Basis).setFromNormal(t)},Basis.fromForward=function(t){return(new Basis).setFromForward(t)},Basis.prototype.setFromMatrix=function(t){var n=t.data;return this.right.set(n[0],n[1],n[2]),this.up.set(n[4],n[5],n[6]),this.forward.set(n[8],n[9],n[10]),this},Basis.prototype.setFromNormal=function(t){this.up.copy(t);var n=this.up.dot(w.forward);return Math.abs(n)<1?this.right.crossVectors(this.up,w.forward).normalize():this.right.copy(w.right).multiply(Math.sign(n)),this.forward.crossVectors(this.right,this.up).normalize(),this},Basis.prototype.setFromForward=function(t){this.forward.copy(t);var n=t.dot(w.up);return Math.abs(n)<1?this.right.crossVectors(w.up,this.forward).normalize():this.right.copy(w.right).multiply(Math.sign(n)),this.up.crossVectors(this.forward,this.right).normalize(),this},Basis}(),fe=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),he=function he(){},de=function RayAABBCollisionResult(){this.intersection1=new w,this.intersection2=new w,this.normal1=new w,this.normal2=new w},ye=function(t){function RaySphereCollisionResult(){return null!==t&&t.apply(this,arguments)||this}return fe(RaySphereCollisionResult,t),RaySphereCollisionResult}(de);!function(t){t.dummy=new w,t.dummy2=new w,t.rayAABBResult=new de,t.raySphereResult=new ye,t.rayPlaneResult=new he,t.basis=new pe}(ue||(ue={}));var me,ve,ge=function(){function Ray(t,n,r){this._origin=t||new w,this._direction=n||(new w).copy(w.forward),this._length=r||999999}return Object.defineProperty(Ray.prototype,"origin",{get:function(){return this._origin},set:function(t){this._origin.copy(t),delete this._destination},enumerable:!1,configurable:!0}),Object.defineProperty(Ray.prototype,"direction",{get:function(){return this._direction},set:function(t){this._direction.copy(t),delete this._destination},enumerable:!1,configurable:!0}),Object.defineProperty(Ray.prototype,"destination",{get:function(){return this._destination||(this._destination=(new w).copy(this._direction).multiply(this._length).add(this._origin)),this._destination},enumerable:!1,configurable:!0}),Object.defineProperty(Ray.prototype,"length",{get:function(){return this._length},set:function(t){t!==this._length&&(this._length=t,delete this._destination)},enumerable:!1,configurable:!0}),Ray.fromPerspectiveView=function(t,n,r,o,i,a){return(new Ray).setFromPerspectiveView(t,n,r,o,i,a)},Ray.fromOrthographicView=function(t,n,r,o,i,a){return(new Ray).setFromOrthographicView(t,n,r,o,i,a)},Ray.prototype.set=function(t,n,r){this._origin.copy(t),this._direction.copy(n),void 0!==r&&(this._length=r)},Ray.prototype.copy=function(t){return this._origin.copy(t.origin),this._direction.copy(t.direction),this._length=t.length,delete this._destination,this},Ray.prototype.transform=function(t){this._origin.transform(t),this._direction.transformDirection(t),delete this._destination},Ray.prototype.setFromPerspectiveView=function(t,n,r,o,i,a){var c=i/a,u=1/Math.tan(t/2),l=(2*r/i-1)/(u/c),p=-(2*o/a-1)/u,f=n.data;return this.direction.x=l*f[0]+p*f[4]+-1*f[8],this.direction.y=l*f[1]+p*f[5]+-1*f[9],this.direction.z=l*f[2]+p*f[6]+-1*f[10],this.direction.normalize(),this.origin.setFromMatrix(n),this},Ray.prototype.setFromOrthographicView=function(t,n,r,o,i,a){var c=2*t*(1-o/(a-1))-t,u=i*t/a,l=r/(i-1)*(2*u)-u,p=ue.basis;return p.setFromMatrix(n),this.origin.setFromMatrix(n).add(p.right.multiply(l)).add(p.up.multiply(c)),this.direction.copy(p.forward).flip().normalize(),this},Ray.prototype.castOnSphere=function(t,n){var r=ue.dummy,o=ue.raySphereResult,i=r.substractVectors(this.origin,t),a=i.dot(this.direction),c=a*a-(i.dot(i)-n*n);if(c<0)return null;var u=-a-(c=Math.sqrt(c)),l=-a+c,p=u,f=l;if(u<0){if(l<0)return null;p=l,f=u}return o.intersection1.copy(this.direction).multiply(p).add(this.origin),o.normal1.copy(o.intersection1).substract(t).normalize(),o.intersection2.copy(this.direction).multiply(f).add(this.origin),o.normal2.copy(o.intersection2).substract(t).normalize(),o},Ray.prototype.castOnPlane=function(t){var n=ue.rayPlaneResult,r=t.normal.dot(this.origin)-t.distFromOrigin;if(P.isZero(r))n.intersection=w.dummy.copy(this.origin),n.classification=M.Planar;else{var o=t.normal.dot(this.direction);if(P.isZero(o))n.intersection=null;else{var i=-r/o;n.intersection=i<0?null:w.dummy.copy(this.direction).multiply(i).add(this.origin)}n.classification=r>0?M.Front:M.Back}return n},Ray.prototype.castOnAABB=function(t){var n=ue.rayAABBResult,r=ue.dummy,o=ue.dummy2,i=w.dummy.substractVectors(t.min,this.origin).divideVector(this.direction),a=w.dummy2.substractVectors(t.max,this.origin).divideVector(this.direction),c=r.set(Math.min(i.x,a.x),Math.min(i.y,a.y),Math.min(i.z,a.z)),u=o.set(Math.max(i.x,a.x),Math.max(i.y,a.y),Math.max(i.z,a.z)),l=c.max(),p=u.min();if(p>=l){var f=l,h=p;if(l<0){if(p<0)return null;f=p,h=l}return n.intersection1.copy(this.direction).multiply(f).add(this.origin),n.intersection2.copy(this.direction).multiply(h).add(this.origin),n.normal1.copy(this.getAABBNormal(t,n.intersection1)),n.normal2.copy(this.getAABBNormal(t,n.intersection2)),n}return null},Ray.prototype.getAABBNormal=function(t,n){var r=n.x,o=n.y,i=n.z;return P.isEqual(r,t.min.x)?w.dummy.set(-1,0,0):P.isEqual(r,t.max.x)?w.dummy.set(1,0,0):P.isEqual(o,t.min.y)?w.dummy.set(0,-1,0):P.isEqual(o,t.max.y)?w.dummy.set(0,1,0):P.isEqual(i,t.min.z)?w.dummy.set(0,0,-1):P.isEqual(i,t.max.z)?w.dummy.set(0,0,1):w.dummy.set(0,1,0)},Ray.dummy=new Ray,Ray}(),BehaviorAPIFactory_spreadArray=function(t,n){for(var r=0,o=n.length,i=t.length;r<o;r++,i++)t[i]=n[r];return t},_e=function(){function BehaviorAPIFactory(){}return BehaviorAPIFactory.createObject=function(t){for(var n,r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];var i=BehaviorAPIFactory.variableObjectFactory[t];return i?i.apply(void 0,r):(n=mt.factory).createObject.apply(n,BehaviorAPIFactory_spreadArray([t],r))},BehaviorAPIFactory.variableObjectFactory={Vector2:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new(h.bind.apply(h,BehaviorAPIFactory_spreadArray([void 0],t)))},Vector3:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new(w.bind.apply(w,BehaviorAPIFactory_spreadArray([void 0],t)))},Vector4:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new(Bt.bind.apply(Bt,BehaviorAPIFactory_spreadArray([void 0],t)))},Color:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return new(It.bind.apply(It,BehaviorAPIFactory_spreadArray([void 0],t)))},Matrix44:function(t){return new A(t)},Quaternion:function(t,n,r,o){return new kt(t,n,r,o)},Map:function(){return new Map},Plane:function(t,n){return new N(t,n)},Triangle:function(t,n,r){return new le(t,n,r)},Ray:function(t,n,r){return new ge(t,n,r)},Basis:function(){return new pe},VertexBuffer:function(t){return new Vt(t)},Array:function(t){return new Array(t)},Promise:function(t){return new Promise(t)}},BehaviorAPIFactory}();me||(me={}),function(t){t.setProjectId=function setProjectId(t){me.projectId=t}}(ve||(ve={}));var be,we,xe=function(){function Project(){}return Object.defineProperty(Project,"projectId",{get:function(){if(me.projectId)return me.projectId;var t=localStorage.getItem("project_info");return t?JSON.parse(t).info.projectId:"default_project_id"},enumerable:!1,configurable:!0}),Object.defineProperty(Project,"projectName",{get:function(){var t=localStorage.getItem("project_info");return t?JSON.parse(t).info.name:null},enumerable:!1,configurable:!0}),Object.defineProperty(Project,"isOpenSource",{get:function(){var t=localStorage.getItem("project_info");return!!t&&JSON.parse(t).info.isOpenSource},enumerable:!1,configurable:!0}),Project.importToEditor=function(){var t=localStorage.getItem("project_info");if(t){var n=JSON.parse(t).importUrl;window.open(n)}else console.assert(!1,"Can't import project because import information is missing.")},Project}();be||(be={}),(we||(we={})).preload=function preload(){return new Promise((function(t,n){var r=xe.projectId,o=localStorage.getItem("saved_data_"+r);be.savedData=o?JSON.parse(o):{},t()}))};var Pe,Oe,Ce,Se=function(){function SavedData(){}return SavedData.get=function(){return be.savedData},SavedData.flush=function(){localStorage.setItem("saved_data_"+xe.projectId,JSON.stringify(be.savedData,null,2))},SavedData}();!function(t){t.deltaTimeCap=.1,t.previousTime=performance.now(),t.time=0,t.deltaTime=0,t.smoothDeltaTime=0,t.frameTimer=0,t.frameCount=0,t.fps=0,t.currentFrame=0}(Pe||(Pe={})),(Ce=Oe||(Oe={})).updateDeltaTime=function updateDeltaTime(){var t=performance.now(),n=Math.min((t-Pe.previousTime)/1e3,Pe.deltaTimeCap);Pe.smoothDeltaTime=P.lerp(Pe.deltaTime,n,.5),Pe.deltaTime=n,Pe.time+=n,Pe.previousTime=t,Pe.frameTimer+=Pe.deltaTime,Pe.frameCount++,Pe.frameTimer>=1&&(Pe.fps=Pe.frameCount/Pe.frameTimer,Pe.frameCount=0,Pe.frameTimer=0)},Ce.resetCurrentFrame=function resetCurrentFrame(){Pe.currentFrame=0},Ce.incrementCurrentFrame=function incrementCurrentFrame(){++Pe.currentFrame};var Ae,Ee,je=function(){function Time(){}return Object.defineProperty(Time,"time",{get:function(){return Pe.time},enumerable:!1,configurable:!0}),Object.defineProperty(Time,"deltaTime",{get:function(){return Pe.deltaTime},enumerable:!1,configurable:!0}),Object.defineProperty(Time,"smoothDeltaTime",{get:function(){return Pe.smoothDeltaTime},enumerable:!1,configurable:!0}),Object.defineProperty(Time,"fps",{get:function(){return Pe.fps},enumerable:!1,configurable:!0}),Object.defineProperty(Time,"currentFrame",{get:function(){return Pe.currentFrame},enumerable:!1,configurable:!0}),Time}();!function(t){t.gamepadEventsSupported="ongamepadconnected"in window,t.gamepadMap={},t.onGamepadConnected=function onGamepadConnected(n){var r=n;t.gamepadMap[r.gamepad.index]=r.gamepad},t.onGamepadDisconnected=function onGamepadDisconnected(n){var r=n;delete t.gamepadMap[r.gamepad.index]}}(Ae||(Ae={})),function(t){function scanGamepads(){if(!Ae.gamepadEventsSupported){for(var t=navigator,n=navigator.getGamepads?navigator.getGamepads():t.webkitGetGamepads?t.webkitGetGamepads():[],r={},o=0;o<n.length;o++){if(n[o])r[c=n[o].index]=!0,Ae.gamepadMap[c]=n[o]}for(var i=0,a=Object.keys(Ae.gamepadMap);i<a.length;i++){var c;(c=a[i])in r||(Ae.gamepadMap[c]=null)}}}t.scanGamepads=scanGamepads,t.initialize=function initialize(){Ae.gamepadEventsSupported?(window.addEventListener("gamepadconnected",Ae.onGamepadConnected),window.addEventListener("gamepaddisconnected",Ae.onGamepadDisconnected)):setTimeout(scanGamepads,500)},t.destroy=function destroy(){Ae.gamepadEventsSupported&&(window.removeEventListener("gamepadconnected",Ae.onGamepadConnected),window.removeEventListener("gamepaddisconnected",Ae.onGamepadDisconnected))}}(Ee||(Ee={}));var Te,Re=function(){function Gamepads(){}return Gamepads.get=function(t){var n=Ae.gamepadMap[t];return n||null},Gamepads.forEach=function(t){for(var n=Object.values(Ae.gamepadMap),r=0;r<n.length;++r){var o=n[r];o&&t(o,r)}},Gamepads}();!function(t){t.batchListeners={}}(Te||(Te={}));var Be,Me,Ie=function(){function AsyncUtils(){}return AsyncUtils.processBatch=function(t,n,r){var o=Y.makeUniqueId(),i=0,a=!1,onProcessed=function(){++i>=t.length&&o in Te.batchListeners&&(Te.batchListeners[o](a),delete Te.batchListeners[o])};if(t.length>0){Te.batchListeners[o]=r;for(var c=0,u=t;c<u.length;c++){n(u[c],onProcessed,(function(){a=!0,onProcessed()}))}}else r(!1);return o},AsyncUtils.detachBatchListener=function(t){delete Te.batchListeners[t]},AsyncUtils}(),ze=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Texture2D_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Texture2D_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},ke=void 0;(function(t){t[t.JPEG=0]="JPEG",t[t.PNG=1]="PNG",t[t.SVG=2]="SVG"})(Be||(Be={})),function(t){t.textureDataPropertyKey="_textureData"}(Me||(Me={}));var De,Fe=function(t){function Texture2D(n){var r=t.call(this)||this;return r._filtering=a.Linear,r._repeat=!0,r._mipMaps=!0,r._publishFormat=Be.JPEG,r._textureDataLoaded=!1,n&&r.setState(n),r}return ze(Texture2D,t),Object.defineProperty(Texture2D.prototype,"version",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(Texture2D.prototype,"image",{get:function(){return this._image},enumerable:!1,configurable:!0}),Object.defineProperty(Texture2D.prototype,"publishFormat",{get:function(){return this._publishFormat},set:function(t){this._publishFormat=t},enumerable:!1,configurable:!0}),Object.defineProperty(Texture2D.prototype,"textureData",{get:function(){return this._textureData},set:function(t){var n=this;this._textureId&&this.graphicUnload(),this._textureDataLoaded=!1,this._textureData=t,delete this._canvas,delete this._pixels,this.loadTextureData().then((function(){ke&&ke.textureDataLoaded.post(n)}))},enumerable:!1,configurable:!0}),Texture2D.prototype.getWidth=function(){return this._textureDataLoaded?this._image.width:0},Texture2D.prototype.getHeight=function(){return this._textureDataLoaded?this._image.height:0},Texture2D.prototype.setProperty=function(n,r){t.prototype.setProperty.call(this,n,r),n===Me.textureDataPropertyKey?this.textureData=r:this._textureId&&this.setupTexture()},Texture2D.prototype.isLoaded=function(){return this._textureDataLoaded},Texture2D.prototype.begin=function(t){if(!this._textureId){if(!this._textureDataLoaded)return!1;if(!this.graphicLoad())return!1}var n=at.context;return n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,this._textureId),!0},Texture2D.prototype.loadTextureData=function(){var t=this;return this._textureDataLoaded?Promise.resolve(this._image):new Promise((function(n,r){t._image=new Image,t._image.onload=function(){t._textureDataLoaded=!0,n(t._image)},t._image.onerror=function(t){return r(t)},t._image.src=t._textureData}))},Texture2D.prototype.graphicLoad=function(){return!!this._textureId||!!this.setupTexture()},Texture2D.prototype.getPixel=function(t,n,r){if(!this._canvas){this._canvas=document.createElement("canvas"),this._canvas.width=this._image.width,this._canvas.height=this._image.height;var o=this._canvas.getContext("2d");o&&(o.drawImage(this._image,0,0),this._pixels=o.getImageData(0,0,this._canvas.width,this._canvas.height).data)}var i=n*this._canvas.width*4+4*t,a=this._pixels;r.r=a[i+0],r.g=a[i+1],r.b=a[i+2],r.a=a[i+3]},Texture2D.prototype.upgrade=function(t,n){return 2===n&&(Object.assign(t.properties,{_mipMaps:t.properties._generateMipMaps}),delete t.properties._generateMipMaps),t},Texture2D.prototype.setupTexture=function(){if(!this.isLoaded())return p.logWarning("Trying to render with a texture that is not loaded yet '"+this.templatePath+"'"),!1;var t=at.context;this._textureId||(this._textureId=t.createTexture()),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._textureId),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,this._image),this._filtering===a.Nearest?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR);var n=at.version>1;if(n||(n=P.isPowerOf2(this._image.width)&&P.isPowerOf2(this._image.height)),n){var r=this._repeat?t.REPEAT:t.CLAMP_TO_EDGE;t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,r),this._mipMaps?(this._filtering===a.Nearest?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST_MIPMAP_LINEAR):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR_MIPMAP_LINEAR),t.generateMipmap(t.TEXTURE_2D)):this._filtering===a.Nearest?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR)}else t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this._filtering===a.Nearest?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR);return!0},Texture2D_decorate([Attributes_enumLiterals(a),Texture2D_metadata("design:type",Object)],Texture2D.prototype,"_filtering",void 0),Texture2D_decorate([Attributes_enumLiterals(Be),Texture2D_metadata("design:type",Object)],Texture2D.prototype,"_publishFormat",void 0),Texture2D_decorate([Attributes_hidden(),Texture2D_metadata("design:type",String)],Texture2D.prototype,"_textureData",void 0),Texture2D_decorate([Attributes_unserializable(),Texture2D_metadata("design:type",Object)],Texture2D.prototype,"_textureDataLoaded",void 0),Texture2D_decorate([Attributes_unserializable(),Texture2D_metadata("design:type",HTMLImageElement)],Texture2D.prototype,"_image",void 0),Texture2D_decorate([Attributes_unserializable(),Texture2D_metadata("design:type",HTMLCanvasElement)],Texture2D.prototype,"_canvas",void 0),Texture2D_decorate([Attributes_unserializable(),Texture2D_metadata("design:type",Uint8ClampedArray)],Texture2D.prototype,"_pixels",void 0),Texture2D=Texture2D_decorate([displayName("Texture 2D"),referencable(!0),Texture2D_metadata("design:paramtypes",[Object])],Texture2D)}(ct),Le=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),StaticCubemap_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},StaticCubemap_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Ne=function(t){function StaticCubemap(){var n=null!==t&&t.apply(this,arguments)||this;return n.pz=new K(Fe),n.nz=new K(Fe),n.py=new K(Fe),n.ny=new K(Fe),n.px=new K(Fe),n.nx=new K(Fe),n}return Le(StaticCubemap,t),Object.defineProperty(StaticCubemap.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),StaticCubemap.prototype.setProperty=function(n,r){var o=this;if(t.prototype.setProperty.call(this,n,r),this._textureId){var i=r.asset;if(i){this.initConfigIfNecessary();var a=this._config.find((function(t){return t.id===n}));a&&i.loadTextureData().then((function(){var t=at.context;t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,o._textureId),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.texImage2D(a.side,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.image)}))}}},StaticCubemap.prototype.isLoaded=function(){return this.initConfigIfNecessary(),this._config.every((function(t){return Y.isAssetRefLoaded(t.texture)}))},StaticCubemap.prototype.begin=function(t){if(!this._textureId&&!this.graphicLoad())return!1;var n=at.context;return n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_CUBE_MAP,this._textureId),!0},StaticCubemap.prototype.graphicLoad=function(){if(this._textureId)return!0;var t=at.context;this._textureId=t.createTexture(),this.initConfigIfNecessary(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,this._textureId),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.pixelStorei(t.UNPACK_ALIGNMENT,4);for(var n=0,r=this._config;n<r.length;n++){var o=r[n],i=o.texture.asset;i&&t.texImage2D(o.side,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.image)}return t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),!0},StaticCubemap.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{pz:t.properties.front,nz:t.properties.back,py:t.properties.top,ny:t.properties.bottom,px:t.properties.right,nx:t.properties.left}),delete t.properties.front,delete t.properties.back,delete t.properties.top,delete t.properties.bottom,delete t.properties.left,delete t.properties.right),t},StaticCubemap.prototype.makeConfig=function(){var t=at.context;return[{id:"pz",texture:this.pz,side:t.TEXTURE_CUBE_MAP_POSITIVE_Z},{id:"nz",texture:this.nz,side:t.TEXTURE_CUBE_MAP_NEGATIVE_Z},{id:"py",texture:this.py,side:t.TEXTURE_CUBE_MAP_POSITIVE_Y},{id:"ny",texture:this.ny,side:t.TEXTURE_CUBE_MAP_NEGATIVE_Y},{id:"px",texture:this.px,side:t.TEXTURE_CUBE_MAP_POSITIVE_X},{id:"nx",texture:this.nx,side:t.TEXTURE_CUBE_MAP_NEGATIVE_X}]},StaticCubemap.prototype.initConfigIfNecessary=function(){this._config||(this._config=this.makeConfig())},StaticCubemap_decorate([Attributes_unserializable(),StaticCubemap_metadata("design:type",Array)],StaticCubemap.prototype,"_config",void 0),StaticCubemap=StaticCubemap_decorate([creatable(!0),referencable(!0),displayName("Static Cubemap")],StaticCubemap)}(ct),Ve=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Environment_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Environment_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Ue=function(t){function Environment(){return null!==t&&t.apply(this,arguments)||this}return Ve(Environment,t),Environment}(z),We=function(t){function ColorEnvironment(n){var r=t.call(this)||this;return r.color=n||new It,r.color.a=0,r}return Ve(ColorEnvironment,t),ColorEnvironment=Environment_decorate([displayName("Color"),Environment_metadata("design:paramtypes",[It])],ColorEnvironment)}(Ue),qe=function(t){function SkySimulation(){var n=null!==t&&t.apply(this,arguments)||this;return n.luminance=1,n.turbidity=2,n.rayleigh=1,n.mieCoefficient=.005,n.mieDirectionalG=.8,n.sunPosition=new w(0,1,1).normalize(),n}return Ve(SkySimulation,t),SkySimulation}(Ue),Ge=function(t){function SkyBoxEnvironment(){var n=null!==t&&t.apply(this,arguments)||this;return n._cubeMap=new K(Ne),n}return Ve(SkyBoxEnvironment,t),Object.defineProperty(SkyBoxEnvironment.prototype,"cubeMap",{get:function(){return this._cubeMap.asset},set:function(t){this._cubeMap.asset=t},enumerable:!1,configurable:!0}),SkyBoxEnvironment=Environment_decorate([displayName("Skybox")],SkyBoxEnvironment)}(Ue),He=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Xe=function(t){function Fog(){var n=null!==t&&t.apply(this,arguments)||this;return n.color=new It(.7,.7,.7,1),n}return He(Fog,t),Fog}(z),Ke=function(t){function ExponentialFog(){var n=null!==t&&t.apply(this,arguments)||this;return n.density=.005,n}return He(ExponentialFog,t),ExponentialFog}(Xe),Qe=function(t){function LinearFog(){var n=null!==t&&t.apply(this,arguments)||this;return n.near=700,n.far=1e3,n}return He(LinearFog,t),LinearFog}(Xe);!function(t){t.getSections=function getSections(t){var n=t.match(/precision[' ']+(highp|mediump|lowp)[' ']+(float|int)[' ']*;/g),r=n?n.join("\n"):"",o=t.lastIndexOf("}");if(o>=0){var i=t;if(n&&n.length>0){var a=n[n.length-1],c=t.indexOf(a);i=t.substring(c+a.length,o)}else i=t.substring(0,o);return{qualifiers:r,coreMeat:i}}return p.logError("Invalid fragment shader syntax - could not locate closing bracket of entry block"),null},t.unrollLoops=function unrollLoops(t){return t.replace(/_loop_([0-9A-Z_]+)[\r\n]+\$([^\x05]*?)\$/g,(function(t,n,r){var o=isNaN(n)?n in V.shaderDefinitions?V.shaderDefinitions[n]():void 0:parseInt(n,10);return void 0===o?t:""+Array.from(new Array(o)).map((function(t,n){return r.replace(/_i_/g,n)})).join("")}))}}(De||(De={}));var Ye,Ze=function(){function ShaderInjector(){}return ShaderInjector.doVertexShader=function(t,n){var r="",o="",i="",a="",c=!1;if(at.version>1&&(a="#version 300 es",c=!0),mt.renderer.showWireFrame&&(o+="\nin vec3 barycentricCoord;\nout vec3 vBarycentric;",i+="\nvBarycentric = barycentricCoord;",c=!0),n.skinning&&(r+="\n#define USE_SKINNING",c=!0),n.directionalLights&&(r=r+"\n#define MAX_DIRECTIONAL_LIGHTS "+V.maxDirectionalLights+"     \n            ",c=!0),n.fog&&(r+="\n#define USE_FOG",n.fog.isA(Ke)&&(r+="\n#define USE_EXPONENTIAL_FOG"),c=!0),n.shadowMap&&(r+="\n#define USE_SHADOW_MAP",c=!0),n.envMap&&(r+="\n#define USE_ENV_MAP",c=!0),n.vertexColor&&(r+="\n#define USE_VERTEX_COLOR",c=!0),n.normalMap&&(r+="\n#define USE_NORMAL_MAP",c=!0),c){var u=De.getSections(t);if(u)return a+"\n"+r+"\n"+u.qualifiers+"\n"+o+"\n"+u.coreMeat+"\n"+i+"\n}\n"}return t},ShaderInjector.doFragmentShader=function(t,n){var r="",o="",i="",a="",c="gl_FragColor",u=!1;if(at.version>1&&(a="#version 300 es",c="fragColor",u=!0),mt.renderer.showWireFrame&&(at.extensions.OES_standard_derivatives&&(1===at.version&&(r+="\n#extension GL_OES_standard_derivatives: enable"),r+="\n#define Supports_GL_OES_standard_derivatives                \n                "),o+="\nin vec3 vBarycentric;\n#ifdef Supports_GL_OES_standard_derivatives\nfloat edgeFactor() {\n    vec3 d = fwidth(vBarycentric);\n    vec3 a3 = smoothstep(vec3(0.0), d * 1.2, vBarycentric);\n    return min(min(a3.x, a3.y), a3.z);\n}\n#endif",i=i+"\n#ifdef Supports_GL_OES_standard_derivatives\n    "+c+" = mix(vec4(.8, .8, .8, 1.0), "+c+", edgeFactor());    \n#else\n    if(any(lessThan(vBarycentric, vec3(0.01)))) {\n        "+c+" = vec4(vec3(.7), 1.0);\n    }\n#endif",u=!0),n.directionalLights&&(r=r+"\n#define MAX_DIRECTIONAL_LIGHTS "+V.maxDirectionalLights+"     \n            ",u=!0),n.fog&&(r+="\n#define USE_FOG",n.fog.isA(Ke)&&(r+="\n#define USE_EXPONENTIAL_FOG"),u=!0),n.shadowMap&&(mt.renderer.showShadowCascades&&(r+="\n#define SHOW_SHADOW_CASCADES",u=!0),r=r+"\n#define USE_SHADOW_MAP\n#define MAX_DIRECTIONAL_SHADOWMAPS "+V.maxDirectionalLights*V.maxShadowCascades+"\n#define MAX_SHADOW_CASCADES "+V.maxShadowCascades,u=!0),n.vertexColor&&(r+="\n#define USE_VERTEX_COLOR",u=!0),n.envMap&&(r+="\n#define USE_ENV_MAP",u=!0),n.normalMap&&(r+="\n#define USE_NORMAL_MAP",u=!0),t=De.unrollLoops(t),u){var l=De.getSections(t);if(l)return a+"\n"+l.qualifiers+"\n"+r+"\n"+o+"\n"+l.coreMeat+"\n"+i+"\n}\n"}return t},ShaderInjector}();!function(t){t.engineManagedParams={screenSize:!0,projectionMatrix:!0,viewMatrix:!0,worldMatrix:!0,normalMatrix:!0,modelViewMatrix:!0,cameraPosition:!0,boneTexture:!0,boneTextureSize:!0,boneMatrices:!0,bindMatrix:!0,bindMatrixInverse:!0,fogColor:!0,fogDensity:!0,fogNear:!0,fogFar:!0,time:!0,deltaTime:!0,frame:!0,directionalLightMatrices:!0,directionalShadowMaps:!0,directionalLightCount:!0,directionalLightDirs:!0,shadowCascadeEdges:!0,envMap:!0};var n=[];function flattenVectors(t){return t.reduce((function(t,n){return t.concat(n.asArray())}),[])}t.shaderParamFactory={vec2:{typeName:"Vector2",create:function(){return new h},apply:function(t,n,r){n.arraySize?t.uniform2fv(n.uniformLocation,flattenVectors(r.data)):t.uniform2f(n.uniformLocation,r.x,r.y)}},vec3:{typeName:"Vector3",create:function(){return new w},apply:function(t,n,r){n.arraySize?t.uniform3fv(n.uniformLocation,flattenVectors(r.data)):t.uniform3f(n.uniformLocation,r.x,r.y,r.z)}},vec4:{typeName:"Color",create:function(){return new It},apply:function(t,n,r){n.arraySize?t.uniform4fv(n.uniformLocation,flattenVectors(r.data)):t.uniform4f(n.uniformLocation,r.r,r.g,r.b,r.a)}},mat4:{typeName:"Matrix44",create:function(){return new A},apply:function(t,n,r){t.uniformMatrix4fv(n.uniformLocation,!1,r.data)}},mat3:{typeName:"Matrix33",create:function(){return new Dt},apply:function(t,n,r){t.uniformMatrix3fv(n.uniformLocation,!1,r.data)}},sampler2D:{typeName:"Texture",create:function(){return new K(ct)},apply:function(t,n,r){if(void 0!==n.textureStage){var o=n.textureStage,i=r.asset;((null==i?void 0:i.begin(o))||Is.whiteTexture.begin(o))&&t.uniform1i(n.uniformLocation,o)}}},sampler2DArray:{typeName:"Texture",create:function(){return new Kt(ct)},apply:function(t,r,o){if(void 0!==r.textureStage){var i=r.textureStage,a=o;n.length=0;for(var c=0;c<a.data.length;++c){var u=i[c],l=a.data[c].asset;(null==l?void 0:l.begin(u))&&n.push(u)}t.uniform1iv(r.uniformLocation,n)}}},sampler1D:{typeName:"Texture",create:function(){return new K(ct)},apply:function(t,n,r){if(void 0!==n.textureStage){var o=r.asset,i=n.textureStage;(null==o?void 0:o.begin(i))&&t.uniform1i(n.uniformLocation,i)}}},samplerCube:{typeName:"StaticCubemap",create:function(){return new K(Ne)},apply:function(t,n,r){if(void 0!==n.textureStage){var o=r.asset,i=n.textureStage;(null==o?void 0:o.begin(i))&&t.uniform1i(n.uniformLocation,i)}}},float:{typeName:"Number",create:function(){return 0},apply:function(t,n,r){n.arraySize?t.uniform1fv(n.uniformLocation,r.data):t.uniform1f(n.uniformLocation,r)}},int:{typeName:"Number",create:function(){return 0},apply:function(t,n,r){n.arraySize?t.uniform1iv(n.uniformLocation,r.data):t.uniform1i(n.uniformLocation,r)}},bool:{typeName:"Boolean",create:function(){return!1},apply:function(t,n,r){n.arraySize?t.uniform1iv(n.uniformLocation,r.data):t.uniform1i(n.uniformLocation,r)}}}}(Ye||(Ye={}));var Je,$e=function(){function ShaderUtils(){}return ShaderUtils.applyShaderParam=function(t,n,r){n.uniformLocation&&Ye.shaderParamFactory[n.type].apply(t,n,r)},ShaderUtils.buildMaterialParams=function(t,n,r){for(var o=new z,i=0,a=Object.keys(t);i<a.length;i++){var c=a[i];if(!(c in Ye.engineManagedParams)){var u=t[c].type;if("mat4"!==u){var l=!1;if(c in n){var p=Ca.getPropertyTypeName(n[c]);if("AssetReference"===p)p=n[c].typeName();l=p===Ye.shaderParamFactory[u].typeName}o[c]=l?n[c]:Ye.shaderParamFactory[u].create()}}}return o},ShaderUtils.removeComments=function(t){return t.replace(/(\/\*([\s\S]*?)\*\/)|(\/\/(.*)$)/gm,"")},ShaderUtils.editorParamsToFocus="__EditorParamsToFocus__",ShaderUtils}(),tn=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),__assign=function(){return(__assign=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++)for(var i in n=arguments[r])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},Shader_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Shader_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.attributeTypeToComponentCount={float:1,vec2:2,vec3:3,vec4:4},t.ref=new K(ot),t.refArray=new Kt(ot),t.numberArray=new xt(Number),t.vec3Array=new xt(w),t.makeInstance=function makeInstance(){return{program:null,vertexShader:null,vertexCode:null,vertexUniforms:null,vertexAttribs:null,fragmentShader:null,fragmentCode:null,fragmentUniforms:null,uniforms:null}},t.makeDefaultShadingContext=function makeDefaultShadingContext(){return{skinning:!1,shadowMap:!1,vertexColor:!1,directionalLights:!1,envMap:!1,normalMap:!1}}}(Je||(Je={}));var en,nn,rn=function(t){function Shader(n){var r=t.call(this)||this;return r.codeChanged=new W.AsyncEvent,r._shaderError=!1,r._instances={0:Je.makeInstance()},r._executedOnce=!1,n&&r.setState(n),r}return tn(Shader,t),Object.defineProperty(Shader.prototype,"version",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(Shader.prototype,"vertexCode",{get:function(){return this._vertexCode},set:function(t){this._executedOnce=!1,this._shaderError=!1,this._vertexCode=t,Object.values(this._instances).forEach((function(t){t.program&&(at.context.deleteProgram(t.program),t.program=null),t.vertexShader&&(at.context.deleteShader(t.vertexShader),t.vertexShader=null),t.vertexCode=null,t.vertexUniforms=null,t.vertexAttribs=null,t.uniforms=null}))},enumerable:!1,configurable:!0}),Object.defineProperty(Shader.prototype,"fragmentCode",{get:function(){return this._fragmentCode},set:function(t){this._executedOnce=!1,this._shaderError=!1,this._fragmentCode=t,Object.values(this._instances).forEach((function(t){t.program&&(at.context.deleteProgram(t.program),t.program=null),t.fragmentShader&&(at.context.deleteShader(t.fragmentShader),t.vertexShader=null),t.fragmentShader=null,t.fragmentCode=null,t.fragmentUniforms=null,t.uniforms=null,t.program=null}))},enumerable:!1,configurable:!0}),Shader.prototype.begin=function(t){if(this._executedOnce){if(this._shaderError)return!1}else this._executedOnce=!0;var n=this._instances[0].program;return n?(at.context.useProgram(n),!0):this.setupInstance(this._instances[0],null!=t?t:Je.makeDefaultShadingContext())},Shader.prototype.beginWithVisual=function(t,n,r){if(this._executedOnce){if(this._shaderError)return null}else this._executedOnce=!0;var o=this._instances[n];if(o||(o=Je.makeInstance(),this._instances[n]=o),o.program)at.context.useProgram(o.program);else{var i={skinning:t.isSkinned,fog:t.receiveFog?r:void 0,shadowMap:t.receiveShadows,vertexColor:t.hasVertexColor,directionalLights:this.useDirectionalLights(),envMap:Boolean(t.envMap),normalMap:t.hasNormalMap};if(!this.setupInstance(o,i))return null}return o},Shader.prototype.applyParam=function(t,n,r){var o=this.getUniform(t,r);void 0!==o&&$e.applyShaderParam(at.context,o,n)},Shader.prototype.applyReferenceParam=function(t,n,r){var o=this.getUniform(t,r);void 0!==o&&(Je.ref.setAssetFast(n),$e.applyShaderParam(at.context,o,Je.ref))},Shader.prototype.applyReferenceArrayParam=function(t,n,r){var o=this.getUniform(t,r);if(void 0!==o){for(var i=Je.refArray,a=0,c=0;c<n.length&&c<i.data.length;++c)i.data[c].setAssetFast(n[c]),++a;for(c=a;c<n.length;++c)i.grow(n[c]),++a;i.data.length=a,$e.applyShaderParam(at.context,o,i)}},Shader.prototype.applyNumberArrayParam=function(t,n,r){var o=this.getUniform(t,r);void 0!==o&&(Je.numberArray.data=n,$e.applyShaderParam(at.context,o,Je.numberArray))},Shader.prototype.applyVec3ArrayParam=function(t,n,r){var o=this.getUniform(t,r);void 0!==o&&(Je.vec3Array.data=n,$e.applyShaderParam(at.context,o,Je.vec3Array))},Shader.prototype.graphicUnload=function(){Object.values(this._instances).forEach((function(t){t.program&&(at.context.deleteShader(t.vertexShader),at.context.deleteShader(t.fragmentShader),at.context.deleteProgram(t.program))})),this._instances={0:Je.makeInstance()}},Shader.prototype.invalidate=function(){this._executedOnce=!1,this._shaderError=!1,this.graphicUnload()},Shader.prototype.getAttributes=function(t){return this._instances[null!=t?t:0].vertexAttribs},Shader.prototype.getUniforms=function(t){var n;return null!==(n=this._instances[null!=t?t:0].uniforms)&&void 0!==n?n:this.initializeUniforms()},Shader.prototype.upgrade=function(t,n){if(1===n)Object.assign(t.properties,{_vertexCode:{typeName:"String",data:t.properties._vertexCode},_fragmentCode:{typeName:"String",data:t.properties._fragmentCode}});else if(2===n){var r=new RegExp(/varying (vec3|vec2|vec4|float) ([a-zA-Z]+)/,"g"),o=new RegExp(/texture(2D|Cube)/,"g");Object.assign(t.properties._vertexCode,{data:(i=t.properties._vertexCode.data,i.replace(r,(function(t,n,r){return"out "+n+" "+r})).replace(o,(function(){return"texture"})).replace(/attribute (vec3|vec2|vec4) ([a-zA-Z]+)/g,(function(t,n,r){return"in "+n+" "+r})))}),Object.assign(t.properties._fragmentCode,{data:function(t){return t.replace(r,(function(t,n,r){return"in "+n+" "+r})).replace(o,(function(){return"texture"})).replace(/gl_FragColor/g,"fragColor").replace(/void main/,"out vec4 fragColor;\nvoid main")}(t.properties._fragmentCode.data)})}var i;return t},Shader.prototype.loadInstance=function(t){var n=at.context,r=n.createProgram();if(n.attachShader(r,t.vertexShader),n.attachShader(r,t.fragmentShader),n.linkProgram(r),!n.getProgramParameter(r,n.LINK_STATUS))return p.logError("Shader error in "+this.name+":"),p.logError(n.getProgramInfoLog(r)),this._shaderError=!0,!1;n.useProgram(r),t.uniforms||(t.vertexUniforms||(t.vertexUniforms=this.parseUniforms(t.vertexCode)),t.fragmentUniforms||(t.fragmentUniforms=this.parseUniforms(t.fragmentCode)),t.uniforms=__assign(__assign({},t.vertexUniforms),t.fragmentUniforms));var o=0;return Object.entries(t.uniforms).forEach((function(t){var i=t[0],a=t[1],c=n.getUniformLocation(r,i);if((a.uniformLocation=c,null!==c)&&a.type.match(/sampler/)){var u=a.arraySize;a.textureStage=void 0!==u?Array.from(new Array(u)).map((function(){return o++})):o++}})),t.vertexAttribs||(t.vertexAttribs=this.extractAttributes(t.vertexCode)),Object.entries(t.vertexAttribs).forEach((function(t){var o=t[0];t[1].location=n.getAttribLocation(r,o)})),t.program=r,!0},Shader.prototype.useDirectionalLights=function(){return!1},Shader.prototype.createShader=function(t,n,r){var o=at.context,i=o.createShader(t);return o.shaderSource(i,n),o.compileShader(i),o.getShaderParameter(i,o.COMPILE_STATUS)?i:(p.log("Shader error in "+this.name+"."+r+":"),p.log(o.getShaderInfoLog(i)),null)},Shader.prototype.setupInstance=function(t,n){if(!t.vertexShader){if(!t.vertexCode){var r=$e.removeComments(this._vertexCode);t.vertexCode=Ze.doVertexShader(r,n)}var o=this.createShader(at.context.VERTEX_SHADER,t.vertexCode,"vertex");if(!o)return this._shaderError=!0,!1;t.vertexShader=o}if(!t.fragmentShader){if(!t.fragmentCode){r=$e.removeComments(this._fragmentCode);t.fragmentCode=Ze.doFragmentShader(r,n)}var i=this.createShader(at.context.FRAGMENT_SHADER,t.fragmentCode,"fragment");if(!i)return this._shaderError=!0,!1;t.fragmentShader=i}return this.loadInstance(t)},Shader.prototype.extractAttributes=function(t){var n=/in ((vec|float|uint|int|bool|mat|sampler|samplerCube)+[1234D]*) ([_a-zA-Z0-9]+);/,r=t.match(new RegExp(n,"g")),o={};if(!r)return o;for(var i=0,a=r;i<a.length;i++){var c=a[i],u=c.match(n),l=(u[0],u[1]),f=(u[2],u[3]);if(l&&f){var h=Je.attributeTypeToComponentCount[l];void 0!==h?o[f]={location:-1,componentCount:h}:p.logWarning("Unsupported type: '"+l+"' for shader attribute '"+f+"', ignoring this attribute.")}else p.logWarning("Invalid shader attribute syntax: '"+c[0]+"', ignoring this attribute.")}return o},Shader.prototype.parseUniforms=function(t){var n=/uniform ((vec|float|uint|int|bool|mat|sampler|samplerCube)+[1234D]*) ([_a-zA-Z0-9]+)(\[([_a-zA-Z0-9]+)\])*;/,r=t.match(new RegExp(n,"g"));if(!r)return{};for(var parseArraySize=function(n){if(void 0!==n){var r=parseInt(n,10);if(""+r===n)return r;if(n in V.shaderDefinitions)return V.shaderDefinitions[n]();var o=t.match(new RegExp("#define "+n+" ([0-9]+)"));if(o){o[0];var i=o[1];if(void 0!==i)return parseInt(i,10)}}},o={},registerDefaultParam=function(t,n,r){o[t]={type:n,uniformLocation:null,arraySize:r}},i=0,a=r;i<a.length;i++){var c=a[i],u=c.match(n),l=(u[0],u[1]),f=(u[2],u[3]),h=(u[4],u[5]);if(l&&f)if(Boolean(h)){var d=parseArraySize(h);if("sampler2D"===l)o[f]={type:"sampler2DArray",uniformLocation:null,arraySize:d};else if("mat4"===l)for(var y=0;y<d;++y){o[f+"["+y+"]"]={type:l,uniformLocation:null}}else registerDefaultParam(f,l,d)}else registerDefaultParam(f,l);else p.logWarning("Invalid shader uniform syntax: '"+c[0]+"', ignoring this uniform.")}return o},Shader.prototype.getUniform=function(t,n){var r;return(null!==(r=this._instances[null!=n?n:0])&&void 0!==r?r:this._instances[0]).uniforms[t]},Shader.prototype.initializeUniforms=function(){var t=this._instances[0];t.vertexUniforms||(t.vertexUniforms=this.parseUniforms(this._vertexCode)),t.fragmentUniforms||(t.fragmentUniforms=this.parseUniforms(this._fragmentCode));var n=__assign(__assign({},t.vertexUniforms),t.fragmentUniforms);return t.uniforms=n,n},Shader_decorate([Attributes_unserializable(),Shader_metadata("design:type",Object)],Shader.prototype,"codeChanged",void 0),Shader_decorate([Attributes_hidden(),Shader_metadata("design:type",String)],Shader.prototype,"_vertexCode",void 0),Shader_decorate([Attributes_hidden(),Shader_metadata("design:type",String)],Shader.prototype,"_fragmentCode",void 0),Shader_decorate([Attributes_unserializable(),Shader_metadata("design:type",Object)],Shader.prototype,"_shaderError",void 0),Shader_decorate([Attributes_unserializable(),Shader_metadata("design:type",Object)],Shader.prototype,"_instances",void 0),Shader_decorate([Attributes_unserializable(),Shader_metadata("design:type",Object)],Shader.prototype,"_executedOnce",void 0),Shader=Shader_decorate([creatable(!0),referencable(!0),hasDedicatedEditor(!0),Shader_metadata("design:paramtypes",[Object])],Shader)}(ot),on=function(){function GraphicUtils(){}return GraphicUtils.drawVertexBuffer=function(t,n){t.begin(n),t.draw(),t.end(n)},GraphicUtils.invalidateShaders=function(){yt.instance.forEach((function(t){t.isA(rn)&&t.invalidate()}))},GraphicUtils}(),an=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Scene_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Scene_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},sn=function(t){function Scene(){var n=t.call(this)||this;return n._isLoaded=!1,n.root=new ja,n.root.name="root",n._environment=new v(Ue,new We),n._fog=new v(Xe),n}return an(Scene,t),Object.defineProperty(Scene.prototype,"version",{get:function(){return 5},enumerable:!1,configurable:!0}),Object.defineProperty(Scene.prototype,"fog",{get:function(){return this._fog.instance},set:function(t){t!==this._fog.instance&&(on.invalidateShaders(),this._fog.instance=t)},enumerable:!1,configurable:!0}),Object.defineProperty(Scene.prototype,"environment",{get:function(){return this._environment.instance},set:function(t){t!==this._environment.instance&&(on.invalidateShaders(),this._environment.instance=t)},enumerable:!1,configurable:!0}),Scene.prototype.isLoaded=function(){return!!this._isLoaded||!!this.root.isLoaded()&&(this._isLoaded=!0,!0)},Scene.prototype.serialize=function(){var t={typeName:this.constructor.name,version:this.version,id:this.id,name:this.name,root:Ca.serializeEntityWithPrefabRefs(this.root),environment:Ca.serializeProperty(this._environment),fog:Ca.serializeProperty(this._fog)};return this.prefabInstances&&Object.keys(this.prefabInstances).length>0&&(t.prefabInstances=this.prefabInstances),t},Scene.prototype.deserialize=function(t){var n=this,r=t;if(1===r.version){var o=t;r.root=o.properties.root,r.id=o.properties.id,r.name=o.properties.name}else 2===r.version||(3===r.version?Ca.deserializeProperty(this,"_environment","Reference",r.environment):(Ca.deserializeProperty(this,"_environment","Reference",r.environment),Ca.deserializeProperty(this,"_fog","Reference",r.fog)));this.id=r.id,this.name=r.name,this.prefabInstances=r.prefabInstances,Ca.deserializeEntity(this.root,r.root);var i=[];return this.root.traverse((function(t){return!t.prefabId||(i.push({prefabId:t.prefabId,instanceInScene:t}),!1)})),new Promise((function(t){Ie.processBatch(i,(function(t,r,o){n.setEntityFromPrefab(t.instanceInScene,t.prefabId).then(r).catch(o)}),(function(r){return t(n)}))}))},Scene.prototype.destroy=function(){this.root.destroy(),t.prototype.destroy.call(this)},Scene.prototype.setEntityFromPrefab=function(t,n){var r=this;return Promise.resolve().then((function(){return yt.instance.loadObject(n)})).then((function(n){var o=n[0];return r.setEntityFromPrefabInstance(t,o),o}))},Scene.prototype.setEntityFromPrefabInstance=function(t,n){var r=this;t.prefabId=n.id;var o,i=this.prefabInstances?this.prefabInstances[t.id]:void 0,a=i?i.prefabIdToInstanceId:void 0,c=!0;a||(c=!1,a={}),o=c?n.root.copyWithIdMap(a):n.root.copy(a,!0),console.assert(0===t.children.length);for(var u=0,l=o.children;u<l.length;u++){var p=l[u];p.parent=t,t.children.push(p)}if(o.iterateComponents((function(n){return Oa.setComponentFromInstance(t,n)})),c){var f=i;t.traverse((function(t){return f.overrides&&t.id in f.overrides&&r.overrideEntity(t,f.overrides[t.id]),!0}),!0)}else this.prefabInstances||(this.prefabInstances={}),t.id=a[n.root.id],console.assert(void 0!==t.id),this.prefabInstances[t.id]={prefabIdToInstanceId:a}},Scene.prototype.copy=function(){var t=new Scene;return t.templatePath=this.templatePath,t.root=this.root.copy(),t.fog=this.fog?this.fog.copy():void 0,t.environment=this.environment?this.environment.copy():void 0,t},Scene.prototype.overrideEntity=function(t,n){for(var r=0,o=Object.keys(n);r<o.length;r++)for(var i=o[r],a=0,c=Object.keys(n[i]);a<c.length;a++){var u=c[a],l=n[i][u],p=null;if(u in(p="Entity"===i?t:t.hasComponentByName(i)?Oa.getComponentByName(t,i):Oa.setComponentByName(t,i))){var f=Ca.getPropertyTypeName(p[u]);Ca.deserializeProperty(p,u,f,l)}}},Scene_decorate([Attributes_hidden(),Scene_metadata("design:type",ja)],Scene.prototype,"root",void 0),Scene_decorate([Attributes_hidden(),Scene_metadata("design:type",Object)],Scene.prototype,"prefabInstances",void 0),Scene_decorate([Attributes_unserializable(),Scene_metadata("design:type",Object)],Scene.prototype,"_isLoaded",void 0),Scene}(nt),cn=function cn(){};!function(t){t.collisions=new f(cn,64),t.checkCollision=function checkCollision(n,r){for(var _loop_1=function(o){if(!o)return"continue";for(var _loop_2=function(i){if(!i)return"continue";o.getTestPriority()>i.getTestPriority()?o.checkCollisions(i,n.entity.transform,r.entity.transform,(function(a){var c=t.collisions.get();c.self=n,c.collider=r,c.myShape=o,c.otherShape=i,c.particleIndex=a})):i.checkCollisions(o,r.entity.transform,n.entity.transform,(function(a){var c=t.collisions.get();c.self=n,c.collider=r,c.myShape=o,c.otherShape=i,c.particleIndex=a}))},i=0,a=r.shapes;i<a.length;i++){_loop_2(a[i])}},o=0,i=n.shapes;o<i.length;o++){_loop_1(i[o])}}}(en||(en={})),function(t){t.clearCollisions=function clearCollisions(){en.collisions.flush()}}(nn||(nn={}));var un,ln=function(){function CollisionSystem(){}return CollisionSystem.update=function(t,n){var r,o;en.collisions.flush();for(var i={},a=0,c=t;a<c.length;a++)for(var u=c[a],l=0,p=t;l<p.length;l++){var f=p[l];if(u!==f){var h=i[u.id];if(!(h&&f.id in h)){(u.filter?u.filter.canCollideWith(f.group):!f.filter||f.filter.canCollideWith(u.group))&&en.checkCollision(u,f),h?h[f.id]=!0:i[u.id]=((r={})[f.id]=!0,r);var d=i[f.id];d?d[u.id]=!0:i[f.id]=((o={})[u.id]=!0,o)}}}n.forEach((function(n){return n.update(t)}));for(var y=0;y<en.collisions.size;++y){var m=en.collisions.peek(y);m.self.collision.post(m);var v=m.self.entity.getComponent(Es);v&&v.onCollision(m);var g={self:m.collider,collider:m.self,myShape:m.otherShape,otherShape:m.myShape,particleIndex:m.particleIndex};m.collider.collision.post(g);var _=m.collider.entity.getComponent(Es);_&&_.onCollision(g)}},CollisionSystem}(),pn=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Component_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Component_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},fn=function(t){function Component(){var n=null!==t&&t.apply(this,arguments)||this;return n._id=Y.makeUniqueId(),n._active=!0,n}return pn(Component,t),Object.defineProperty(Component.prototype,"parent",{get:function(){return this._entity.parent},enumerable:!1,configurable:!0}),Object.defineProperty(Component.prototype,"entity",{get:function(){return this._entity},enumerable:!1,configurable:!0}),Object.defineProperty(Component.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(Component.prototype,"active",{get:function(){return this._active},set:function(t){this._active=t},enumerable:!1,configurable:!0}),Component.prototype.setEntity=function(t){this._entity=t},Component.prototype.isLoaded=function(){return Y.isObjectLoaded(this)},Component.prototype.reset=function(){var t=this.constructor.name,n=I.instance.createObject(t);Oa.setComponentFromInstance(this.entity,n)},Component.prototype.onReplace=function(t){},Component_decorate([Attributes_hidden(),Attributes_unserializable(),Component_metadata("design:type",Component)],Component.prototype,"controller",void 0),Component_decorate([Attributes_hidden(),Attributes_unserializable(),Component_metadata("design:type",ja)],Component.prototype,"_entity",void 0),Component_decorate([Attributes_unserializable(),Component_metadata("design:type",Object)],Component.prototype,"_id",void 0),Component_decorate([Attributes_hidden(),Component_metadata("design:type",Object)],Component.prototype,"_active",void 0),Component}(z),hn=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),AnimationTrackDefinition_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},AnimationTrackDefinition_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},dn=function(t){function AnimationTrackDefinition(){var n=t.call(this)||this;return n._id=Y.makeUniqueId(),n}return hn(AnimationTrackDefinition,t),Object.defineProperty(AnimationTrackDefinition.prototype,"version",{get:function(){return 5},enumerable:!1,configurable:!0}),Object.defineProperty(AnimationTrackDefinition.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),AnimationTrackDefinition.prototype.upgrade=function(t,n){return 1===n?t.properties.propertyPath&&t.properties.propertyPath.data.indexOf("Visual/material")>=0&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace("Visual/material","Visual/_material")):2===n?t.properties.propertyPath&&t.properties.propertyPath.data.indexOf("UIImage/fill")>=0&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace("UIImage/fill","UIImage/_fill")):3===n?(t.properties.propertyPath&&t.properties.propertyPath.data.indexOf("UIImage/")>=0&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace("UIImage/","Image/")),t.properties.propertyPath&&t.properties.propertyPath.data.indexOf("UIText/")>=0&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace("UIText/","Text/"))):4===n&&(t.properties.propertyPath.data=t.properties.propertyPath.data.replace(/Transform\/local(Position|Rotation|Scale)/,(function(t,n){return"Transform/"+n.toLowerCase()}))),t},AnimationTrackDefinition_decorate([Attributes_hidden(),AnimationTrackDefinition_metadata("design:type",v)],AnimationTrackDefinition.prototype,"track",void 0),AnimationTrackDefinition_decorate([Attributes_unserializable(),AnimationTrackDefinition_metadata("design:type",Object)],AnimationTrackDefinition.prototype,"transition",void 0),AnimationTrackDefinition}(z),yn=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Animation_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Animation_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},mn=function(t){function Animation(){var n=null!==t&&t.apply(this,arguments)||this;return n.tracks=new xt(dn),n._duration=0,n._imported=!1,n}return yn(Animation,t),Object.defineProperty(Animation.prototype,"duration",{get:function(){return this._duration},set:function(t){this._duration=t},enumerable:!1,configurable:!0}),Object.defineProperty(Animation.prototype,"imported",{get:function(){return this._imported},set:function(t){this._imported=t},enumerable:!1,configurable:!0}),Animation.prototype.isLoaded=function(){for(var t=0,n=this.tracks.data;t<n.length;t++){if(!n[t].track.instance.isLoaded())return!1}return!0},Animation.getPropertyAtPath=function(t,n){var internalGetPropertyAtPath=function(t,n,r){var o=n[r];return o in t?r===n.length-1?t[o]:(console.assert("object"==typeof t),internalGetPropertyAtPath(t[o],n,r+1)):void 0},r=n.split("/");if(r.length>1){var o=r[0],i=Oa.getComponentByName(t,o);if(i)return internalGetPropertyAtPath(i,r,1)}},Animation_decorate([Attributes_hidden(),Animation_metadata("design:type",Object)],Animation.prototype,"tracks",void 0),Animation_decorate([Attributes_hidden(),Animation_metadata("design:type",Object)],Animation.prototype,"_imported",void 0),Animation=Animation_decorate([editable(!1)],Animation)}(nt),vn=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),AnimationInstance_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},AnimationInstance_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},gn=function(t){function AnimationInstance(){var n=null!==t&&t.apply(this,arguments)||this;return n.loopCount=0,n.speed=1,n.autoPlay=!0,n._isPlaying=!1,n._localTime=0,n._playTime=0,n._stopRequested=!1,n._playCount=0,n._animation=new K(mn),n}return vn(AnimationInstance,t),Object.defineProperty(AnimationInstance.prototype,"version",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"animation",{get:function(){return this._animation.asset},set:function(t){delete this.targets,this._animation.asset=t},enumerable:!1,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"isPlaying",{get:function(){return this._isPlaying},set:function(t){this._isPlaying=t},enumerable:!1,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"localTime",{get:function(){return this._localTime},set:function(t){this._localTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"playTime",{get:function(){return this._playTime},set:function(t){this._playTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"stopRequested",{get:function(){return this._stopRequested},enumerable:!1,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"playCount",{get:function(){return this._playCount},set:function(t){this._playCount=t},enumerable:!1,configurable:!0}),Object.defineProperty(AnimationInstance.prototype,"autoPlayStatus",{get:function(){return void 0===this._autoPlayStatus&&(this._autoPlayStatus=this.autoPlay),this._autoPlayStatus},set:function(t){this._autoPlayStatus=t},enumerable:!1,configurable:!0}),AnimationInstance.prototype.requestStop=function(){this._stopRequested=!0},AnimationInstance.prototype.upgrade=function(t,n){return 1===n?(!0===t.properties.loop?Object.assign(t.properties,{loopCount:0}):Object.assign(t.properties,{loopCount:1}),delete t.properties.loop):2===n&&(Object.assign(t.properties,{_animation:t.properties.animation}),delete t.properties.animation),t},AnimationInstance.prototype.isLoaded=function(){return Y.isAssetRefLoaded(this._animation)},AnimationInstance.prototype.destroy=function(){delete this.targets,this._animation.detach(),t.prototype.destroy.call(this)},AnimationInstance_decorate([Attributes_unserializable(),AnimationInstance_metadata("design:type",Object)],AnimationInstance.prototype,"targets",void 0),AnimationInstance_decorate([Attributes_unserializable(),AnimationInstance_metadata("design:type",Object)],AnimationInstance.prototype,"_isPlaying",void 0),AnimationInstance_decorate([Attributes_unserializable(),AnimationInstance_metadata("design:type",Object)],AnimationInstance.prototype,"_localTime",void 0),AnimationInstance_decorate([Attributes_unserializable(),AnimationInstance_metadata("design:type",Object)],AnimationInstance.prototype,"_playTime",void 0),AnimationInstance_decorate([Attributes_unserializable(),AnimationInstance_metadata("design:type",Object)],AnimationInstance.prototype,"_stopRequested",void 0),AnimationInstance_decorate([Attributes_unserializable(),AnimationInstance_metadata("design:type",Object)],AnimationInstance.prototype,"_playCount",void 0),AnimationInstance_decorate([Attributes_unserializable(),AnimationInstance_metadata("design:type",Boolean)],AnimationInstance.prototype,"_autoPlayStatus",void 0),AnimationInstance}(z);!function(t){t.evaluateProperty=function evaluateProperty(n,r,o,i,a,c){if(o===r.length-1){if(n){var u=i.getSample(a,n[r[o]]);void 0!==u&&c(n,r[o],u)}}else if(n){var l=r[o];if("Visual"===n.constructor.name&&"_material"===l){var p=n,f=p.animatedMaterial;!f&&p.material&&(f=p.material.copy(),p.animatedMaterial=f),t.evaluateProperty(f,r,o+2,i,a,c)}else t.evaluateProperty(n[l],r,o+1,i,a,c)}}}(un||(un={}));var _n,bn=function(){function AnimationUtils(){}return AnimationUtils.evaluateTrack=function(t,n,r,o,i){var a=t.tokenCache[n];if(a||(a=n.split("/"),t.tokenCache[n]=a),a.length>1){var c=a[0],u=Oa.getComponentByName(r,c);u&&un.evaluateProperty(u,a,1,t,o,(function(t,n,r){return i(t,n,r)}))}},AnimationUtils.applyTrack=function(t,n,r,o){AnimationUtils.evaluateTrack(t.track.instance,t.propertyPath,n,r,(function(n,r,i){if(t.transition)if(o<t.transition.duration){var a=o/t.transition.duration;n[r]=t.transition.blend(t.transition.sourceValue,i,a)}else n[r]=t.transition.blend(t.transition.sourceValue,i,1),delete t.transition;else n[r]=i}))},AnimationUtils.evaluateAnimation=function(t,n,r,o){for(var i=0,a=t.tracks.data;i<a.length;i++){var c=a[i];if(c.track.instance){var u=n;c.targetName&&!(u=o?o[c.targetName]:n.name===c.targetName?n:n.findChild(c.targetName))||r(c,u)}}},AnimationUtils.applyAnimation=function(t,n,r,o,i){AnimationUtils.evaluateAnimation(t,n,(function(t,n){AnimationUtils.applyTrack(t,n,r,o)}),i)},AnimationUtils.playAnimation=function(t,n,r){AnimationUtils.playAnimationInstance(n,r),AnimationUtils.fetchTargetsIfNecessary(t,n),AnimationUtils.resetAnimationTransition(n)},AnimationUtils.playAnimationInstance=function(t,n){var r=t.animation.duration;n&&void 0!==n.startTime?t.localTime=r*P.clamp(n.startTime,0,1):t.localTime>=r&&(t.localTime=0),t.isPlaying=!0,t.playCount=0,t.playTime=0},AnimationUtils.fetchTargetsIfNecessary=function(t,n){if(!n.targets){n.targets={};for(var r=0,o=n.animation.tracks.data;r<o.length;r++){var i=o[r];if(i.targetName){var a=t.name===i.targetName?t:t.findChild(i.targetName);a&&(n.targets[i.targetName]=a)}}}},AnimationUtils.resetAnimationTransition=function(t){for(var n=0,r=t.animation.tracks.data;n<r.length;n++){delete r[n].transition}},AnimationUtils}(),wn=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),AnimationComponent_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},AnimationComponent_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.animationsKey="_animations",t.getAnimationInstance=function getAnimationInstance(t,n){var r=n[t];if(r)return r;for(var o=0,i=n;o<i.length;o++){var a=i[o],c=a.animation;if(c&&c.name===t)return a}return null}}(_n||(_n={}));var xn,Pn=function(t){function AnimationComponent(){var n=null!==t&&t.apply(this,arguments)||this;return n.animationFinished=new W.AsyncEvent,n._animations=new xt(gn),n}return wn(AnimationComponent,t),Object.defineProperty(AnimationComponent.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(AnimationComponent.prototype,"animations",{get:function(){return this._animations.data},enumerable:!1,configurable:!0}),AnimationComponent.prototype.isLoaded=function(){if(!t.prototype.isLoaded.call(this))return!1;for(var n=0,r=this.animations;n<r.length;n++){if(!r[n].isLoaded())return!1}return!0},AnimationComponent.prototype.destroy=function(){for(var n=0,r=this.animations;n<r.length;n++){r[n].destroy()}t.prototype.destroy.call(this)},AnimationComponent.prototype.playAnimationByIndex=function(t,n){if(t<this.animations.length){var r=this.animations[t];bn.playAnimation(this.entity,r,n)}},AnimationComponent.prototype.playAnimation=function(t,n){var r=_n.getAnimationInstance(t,this.animations);r&&bn.playAnimation(this.entity,r,n)},AnimationComponent.prototype.transitionToAnimation=function(t,n,r){var o=_n.getAnimationInstance(n,this.animations),i=o?o.animation:null;if(i){var a=_n.getAnimationInstance(t,this.animations),c=a?a.animation:null;if(c&&!P.isZero(r.duration)){a.isPlaying=!1;bn.evaluateAnimation(c,this.entity,(function(t,n){var c=i.tracks.data.find((function(n){return n.propertyPath===t.propertyPath&&n.targetName===t.targetName}));c&&bn.evaluateTrack(t.track.instance,t.propertyPath,n,a.localTime,(function(t,n,i){var a="Vector3"===i.constructor.name?function(t,n,r){return w.fromPool().lerpVectors(t,n,r)}:"Quaternion"===i.constructor.name?function(t,n,r){return kt.fromPool().slerpQuaternions(t,n,r)}:"Number"===i.constructor.name?function(t,n,r){return P.lerp(t,n,r)}:(p.logWarning("Animation transitions not supported for tracks of type '"+i.constructor.name+"'"),null);if(a){var u=r.duration||.3,l=o.animation.duration,f=P.clamp(u,0,l-P.EPSILON);P.isZero(f)||(c.transition={sourceValue:JSON.parse(JSON.stringify(i)),duration:f,blend:a})}}))})),bn.playAnimationInstance(o,r),bn.fetchTargetsIfNecessary(this.entity,o)}else bn.playAnimation(this.entity,o,r)}},AnimationComponent.prototype.stopAllAnimations=function(t){for(var n=0,r=this.animations;n<r.length;n++){var o=r[n];o.isPlaying&&(!0===t?o.requestStop():(o.animation&&this.animationFinished.post(o.animation.name),o.isPlaying=!1))}},AnimationComponent.prototype.stopAnimation=function(t,n){var r=_n.getAnimationInstance(t,this.animations);r&&r.isPlaying&&(!0===n?r.requestStop():(r.animation&&this.animationFinished.post(r.animation.name),r.isPlaying=!1))},AnimationComponent.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_animations:t.properties.animations}),delete t.properties.animations),t},AnimationComponent.prototype.addAnimation=function(t){var n=new gn;n.animation=t,this._animations.grow(n)},AnimationComponent_decorate([Attributes_unserializable(),AnimationComponent_metadata("design:type",Object)],AnimationComponent.prototype,"animationFinished",void 0),AnimationComponent=AnimationComponent_decorate([displayName("AnimationComponent"),helpUrl("https://docs.spiderengine.io/animation.html")],AnimationComponent)}(fn);!function(t){t[t.IndexedDbCreationFailed=0]="IndexedDbCreationFailed",t[t.EngineSettingsLoadFailed=1]="EngineSettingsLoadFailed",t[t.AssetIdsLoadFailed=2]="AssetIdsLoadFailed",t[t.WebGLContextCreationFailed=3]="WebGLContextCreationFailed"}(xn||(xn={}));var On,AssetIdDatabase_assign=function(){return(AssetIdDatabase_assign=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++)for(var i in n=arguments[r])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};!function(t){t.idDatabase={},t.defaultAssetIds={}}(On||(On={}));var Cn,Sn=function(){function AssetIdDatabaseInternal(){}return Object.defineProperty(AssetIdDatabaseInternal,"fileName",{get:function(){return"ids.json"},enumerable:!1,configurable:!0}),Object.defineProperty(AssetIdDatabaseInternal,"path",{get:function(){return"Assets/"+AssetIdDatabaseInternal.fileName},enumerable:!1,configurable:!0}),Object.defineProperty(AssetIdDatabaseInternal,"defaultAssetIds",{set:function(t){On.defaultAssetIds=t,On.idDatabase=AssetIdDatabase_assign({},On.defaultAssetIds)},enumerable:!1,configurable:!0}),Object.defineProperty(AssetIdDatabaseInternal,"idDatabase",{get:function(){return On.idDatabase},enumerable:!1,configurable:!0}),AssetIdDatabaseInternal.load=function(){return new Promise((function(t,n){ht.a.instance.read(AssetIdDatabaseInternal.path).then((function(n){On.idDatabase=AssetIdDatabase_assign(AssetIdDatabase_assign({},On.defaultAssetIds),JSON.parse(n)),t()})).catch((function(){return n(xn.AssetIdsLoadFailed)}))}))},AssetIdDatabaseInternal.reload=function(){return On.idDatabase=AssetIdDatabase_assign({},On.defaultAssetIds),AssetIdDatabaseInternal.load()},AssetIdDatabaseInternal.setPath=function(t,n){On.idDatabase[t]=n,AssetIdDatabaseInternal.save().then((function(){In.recordAssetChange(jn.create,[t])}))},AssetIdDatabaseInternal.setPaths=function(t,n){Object.assign(On.idDatabase,t),(void 0===n||n)&&AssetIdDatabaseInternal.save().then((function(){In.recordAssetChange(jn.create,Object.keys(t))}))},AssetIdDatabaseInternal.save=function(){return ht.a.instance.write(AssetIdDatabaseInternal.path,JSON.stringify(On.idDatabase,null,2))},AssetIdDatabaseInternal.deleteId=function(t){delete On.idDatabase[t],AssetIdDatabaseInternal.save().then((function(){In.recordAssetChange(jn.delete,[t])})),AssetIdDatabaseInternal.events.assetsDeleted.post([t])},AssetIdDatabaseInternal.deleteIds=function(t,n){for(var r=0,o=t;r<o.length;r++){var i=o[r].valueOf();delete On.idDatabase[i]}if(void 0===n||n){var a=t.map((function(t){return t.valueOf()}));AssetIdDatabaseInternal.events.assetsDeleted.post(a),AssetIdDatabaseInternal.save().then((function(){In.recordAssetChange(jn.delete,a)}))}},AssetIdDatabaseInternal.events={assetsDeleted:new W.AsyncEvent,assetMoved:new W.AsyncEvent},AssetIdDatabaseInternal}(),An=function(){function AssetIdDatabase(){}return AssetIdDatabase.getPath=function(t){return On.idDatabase[t]},AssetIdDatabase}(),En=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();!function(t){t.path="spider-engine.json"}(Cn||(Cn={}));var jn,Tn=function(t){function EngineSettings(){var n=null!==t&&t.apply(this,arguments)||this;return n.canvasAlpha=!0,n.startupScene=void 0,n.useCustomDefaultAssets=void 0,n}return En(EngineSettings,t),Object.defineProperty(EngineSettings.prototype,"version",{get:function(){return 3},enumerable:!1,configurable:!0}),EngineSettings.load=function(){var t=this;return new Promise((function(n,r){yt.instance.loadObject(Cn.path).then((function(r){var o=r[0];t._instance=o,n()})).catch((function(){t._instance=new EngineSettings,console.warn("spider-engine.json not found. Falling back to factory settings."),n()}))}))},Object.defineProperty(EngineSettings,"instance",{get:function(){return this._instance},enumerable:!1,configurable:!0}),EngineSettings.prototype.upgrade=function(t,n){return 1===n?delete t.properties.startupScenePath:2===n&&(console.assert(!1),Object.assign(t.properties,{startupScene:An.getPath(t.properties.startupSceneId)}),console.assert(t.properties.startupScene),delete t.properties.startupSceneId),t},EngineSettings.prototype.save=function(){yt.instance.saveObjectAtPath(this,Cn.path)},EngineSettings}(J),Rn=r(66);!function(t){t[t.update=0]="update",t[t.delete=1]="delete",t[t.create=2]="create"}(jn||(jn={}));var Bn,Mn,In=function(){function IOUtils(){}return IOUtils.recordAssetChange=function(t,n){var r=JSON.stringify(Date.now());localStorage.setItem("last_asset_write_time",r),localStorage.setItem("asset_changed",JSON.stringify({timeStamp:r,action:t,ids:n,metadata:IOUtils.assetChangeMetaData})),IOUtils.assetChangeMetaData&&(IOUtils.assetChangeMetaData=void 0)},IOUtils.parseFileName=function(t,n){var r=t.split(".");if(r.length>1){var o=r.pop();n(r.reduce((function(t,n){return t+"."+n})),o)}else n(t,"")},IOUtils.parseFilePath=function(t,n){var r=t.split(/[/\\]+/);if(r.length>1){var o=r.slice(-1)[0];IOUtils.parseFileName(o,n)}else IOUtils.parseFileName(t,n)},IOUtils.parseFolderPath=function(t,n){var r=t.split(/[/\\]+/);r.length>1?(r.pop(),n(r.reduce((function(t,n){return t+"/"+n})))):n(t)},IOUtils.parseFolderName=function(t,n){n(t.split(/[/\\]+/).pop()||"")},IOUtils.importGameFromBlob=function(t,n,r){var finished=function(t,o){t?n(o||!1):r()};(new Rn).loadAsync(t).then((function(t){var n={},r=Object.keys(t.files);Ie.processBatch(r,(function(r,o,i){var a=t.file(r);a?a.async("string").then((function(t){["Assets/EngineSettings.json"].some((function(t){return t===r}))?r=Cn.path:["idDatabase"].some((function(t){return t===r}))&&(r=Sn.path),n[r]=t,o()}),i):o()}),(function(t){var r=Object.keys(n);Ie.processBatch(r,(function(t,r,o){var i=n[t];ht.a.instance.write(t,i).then((function(){return r()})).catch((function(){return o()}))}),(function(t){finished(!0,t)}))}))}),(function(){return finished(!1)})).catch((function(){return finished(!1)}))},IOUtils.isDefaultAsset=function(t){var n=t.split("/");return n.length>1&&("Assets"===n[0]&&"DefaultAssets"===n[1])},IOUtils.assetChangeMetaData=void 0,IOUtils}(),zn=function(){function EngineEvents(){}return EngineEvents.assetLoaded=new W.AsyncEvent,EngineEvents.objectSaved=new W.AsyncEvent,EngineEvents}();!function(t){t.objectCache={},t.objectLoadingInProgress={}}(Bn||(Bn={})),function(t){function loadObject(t,n,r,o){var i=Bn.objectCache[t];if(i){if(!o)return void n(i,!0);delete Bn.objectCache[t]}var a={loaded:n,error:r},c=Bn.objectLoadingInProgress[t];c?c.push(a):(Bn.objectLoadingInProgress[t]=[a],ht.a.instance.read(t).then((function(n){return loadObjectFromData(t,n)})).then((function(n){for(var r=0,o=Bn.objectLoadingInProgress[t];r<o.length;r++){o[r].loaded(n,!1)}delete Bn.objectLoadingInProgress[t]})).catch((function(n){for(var r=0,o=Bn.objectLoadingInProgress[t];r<o.length;r++){o[r].error(n)}delete Bn.objectLoadingInProgress[t]})))}function loadObjectFromData(t,n){var r=JSON.parse(n),o=I.instance.createObject(r.typeName);return Bn.objectCache[t]=o,o.isA(nt)&&(o.isPersistent=!0),o.templatePath=t,o.deserialize(r)}t.loadObject=loadObject,t.loadObjectFromData=loadObjectFromData,t.loadObjectById=function loadObjectById(t,n,r){var o=An.getPath(t);o?loadObject(o,n,r,!1):r()},t.loadObjectIgnoreCache=function loadObjectIgnoreCache(t){return new Promise((function(n,r){loadObject(t,(function(t){return n([t,!1])}),r,!0)}))},t.objectCache=function(){return Bn.objectCache}}(Mn||(Mn={}));var kn,Dn,Fn,Ln=function(){function ObjectManager(){}return ObjectManager.prototype.loadObject=function(t){return new Promise((function(n,r){Mn.loadObject(t,(function(t,r){return n([t,r])}),r,!1)}))},ObjectManager.prototype.loadObjectById=function(t){return new Promise((function(n,r){Mn.loadObjectById(t,(function(t,r){return n([t,r])}),r)}))},ObjectManager.prototype.getObject=function(t){var n;return null!==(n=Bn.objectCache[t])&&void 0!==n?n:null},ObjectManager.prototype.getObjectById=function(t){var n=An.getPath(t);return n?this.getObject(n):null},ObjectManager.prototype.saveObject=function(t){var n=t.id,r=An.getPath(n);return r?this.saveObjectAtPath(t,r):(p.log("Could not save object with id '"+n+"' (could not resolve its path)"),Promise.reject())},ObjectManager.prototype.saveObjectAtPath=function(t,n,r){return new Promise((function(o,i){try{var a=JSON.stringify(t.serialize(),null,2);ht.a.instance.write(n,a).then((function(){!1!==r&&In.recordAssetChange(jn.update,[t.id]),zn.objectSaved.post(t),o()})).catch(i)}catch(t){i(t)}}))},ObjectManager.prototype.renameObject=function(t,n){var r=this;In.parseFilePath(n,(function(o,i){if(t in Bn.objectCache){var a=Bn.objectCache[t];delete Bn.objectCache[t],a.templatePath=n,Bn.objectCache[n]=a,a.name=o,r.saveObjectAtPath(a,n)}else In.parseFilePath(t,(function(t,i){t!==o&&r.loadObject(n).then((function(t){var i=t[0];i.name=o,r.saveObjectAtPath(i,n)}))}))}))},ObjectManager.prototype.deleteObject=function(t){t.destroy(),t.templatePath&&delete Bn.objectCache[t.templatePath]},ObjectManager.prototype.deleteObjectById=function(t){var n=An.getPath(t);n&&this.deleteObjectByPath(n)},ObjectManager.prototype.deleteObjectByPath=function(t){var n=Bn.objectCache[t];n&&(this.deleteObject(n),delete Bn.objectCache[t])},ObjectManager.prototype.loadGraphicObjects=function(){for(var t=0,n=Object.values(Bn.objectCache);t<n.length;t++){var r=n[t];r.isA(ot)&&r.graphicLoad()}},ObjectManager.prototype.unloadGraphicObjects=function(){for(var t=0,n=Object.values(Bn.objectCache);t<n.length;t++){var r=n[t];r.isA(ot)&&r.graphicUnload()}},ObjectManager.prototype.addToCache=function(t){var n=t.templatePath;console.assert(n),console.assert(!(n in Bn.objectCache)),Bn.objectCache[n]=t},ObjectManager.prototype.clearCache=function(){for(var t=0,n=Object.values(Bn.objectCache);t<n.length;t++){n[t].destroy()}Bn.objectCache={}},ObjectManager.prototype.forEach=function(t){for(var n=0,r=Object.values(Bn.objectCache);n<r.length;n++){t(r[n])}},ObjectManager}();(Mn||(Mn={})).create=function create(){yt.instance=new Ln},function(t){function getTransitionAnimComponent(){return Is.transitionScene.root.findChild("FadeQuad").getComponent(Pn)}function finalizeSceneLoad(){var n,r,o=0===t.scenes.length;if(t.sceneLoadInProgress){var i=t.sceneLoadInProgress,a=i.additive,c=i.scene,u=i.previousFogType,l=i.previousEnvType,p=i.resolve;if(c){var f=!1;a||(t.scenes.forEach((function(t){f=t.templatePath===c.templatePath,yt.instance.deleteObject(t)})),vc.clearDefaultPerspectiveCamera(),Oe.resetCurrentFrame(),Ls.onSceneDestroyed(),nn.clearCollisions(),t.scenes.length=0),f&&yt.instance.addToCache(c),t.scenes.push(c);var h=null===(n=null==c?void 0:c.fog)||void 0===n?void 0:n.constructor.name,d=null===(r=null==c?void 0:c.environment)||void 0===r?void 0:r.constructor.name;h===u&&d===l||on.invalidateShaders(),o?(Ls.create(),yt.instance.loadGraphicObjects()):yt.instance.loadGraphicObjects(),t.sceneLoadInProgress=null,Ca.clearNonPersistentObjectCache(),p(c)}else console.assert(!1)}else console.assert(!1)}t.scenes=[],t.transitionInProgress=!1,t.sceneLoadInProgress=null,t.preloadedScenesRequests=[],t.preloadedScenesInProgress=[],t.preloadedScenes=[],t.getTransitionAnimComponent=getTransitionAnimComponent,t.finalizeSceneLoad=finalizeSceneLoad,t.onTransitionAnimFinished=function onTransitionAnimFinished(n){var r=getTransitionAnimComponent();"FadeOut"===n?(t.scenes.pop(),finalizeSceneLoad(),r.animationFinished.once(onTransitionAnimFinished),r.playAnimation("FadeIn"),t.scenes.push(Is.transitionScene)):"FadeIn"===n&&(t.scenes.pop(),t.transitionInProgress=!1)}}(kn||(kn={})),(Fn=Dn||(Dn={})).list=function list(){return kn.scenes},Fn.updateTransition=function updateTransition(){if(!kn.transitionInProgress&&kn.sceneLoadInProgress){var t=kn.sceneLoadInProgress.scene;if(t&&t.isLoaded())if(p.log("Scene '"+t.templatePath+"' loaded."),kn.scenes.length>0){var n=kn.getTransitionAnimComponent();n.animationFinished.once(kn.onTransitionAnimFinished),n.playAnimation("FadeOut"),kn.transitionInProgress=!0,kn.scenes.push(Is.transitionScene)}else kn.finalizeSceneLoad()}},Fn.destroy=function destroy(){kn.scenes.forEach((function(t){return yt.instance.deleteObject(t)})),kn.scenes=[]},Fn.updatePreloading=function updatePreloading(){for(var t=0;t<kn.preloadedScenesInProgress.length;){var n=kn.preloadedScenesInProgress[t];n.scene.isLoaded()?(kn.preloadedScenes.push(n.scene),kn.preloadedScenesInProgress.splice(t,1),n.resolve()):++t}};var Nn,Vn,Un=function(){function Scenes(){}return Scenes.load=function(t,n){var r,o,i,a;if(void 0===n&&(n=!1),kn.sceneLoadInProgress)return console.warn("Only one scene load is supported at a time. Loading '"+kn.sceneLoadInProgress.path+"', skipping '"+t+"'"),Promise.reject();var c=kn.preloadedScenes.findIndex((function(n){return n.templatePath===t}));if(c>=0){kn.preloadedScenes.splice(c,1);var u=kn.preloadedScenes[c];return kn.sceneLoadInProgress={scene:u,path:t,additive:n,previousFogType:null===(o=null===(r=kn.scenes[0])||void 0===r?void 0:r.fog)||void 0===o?void 0:o.constructor.name,previousEnvType:null===(a=null===(i=kn.scenes[0])||void 0===i?void 0:i.environment)||void 0===a?void 0:a.constructor.name,resolve:function(){}},kn.finalizeSceneLoad(),Promise.resolve(u)}return new Promise((function(r,o){var i,a,c,u;kn.sceneLoadInProgress={path:t,additive:n,previousFogType:null===(a=null===(i=kn.scenes[0])||void 0===i?void 0:i.fog)||void 0===a?void 0:a.constructor.name,previousEnvType:null===(u=null===(c=kn.scenes[0])||void 0===c?void 0:c.environment)||void 0===u?void 0:u.constructor.name,resolve:r},Mn.loadObjectIgnoreCache(t).then((function(t){var n=t[0];kn.sceneLoadInProgress.scene=n})).catch((function(){p.logError("Could not load '"+t+"'"),kn.sceneLoadInProgress=null,o()}))}))},Scenes.loadById=function(t){var n=An.getPath(t);return n?Scenes.load(n):Promise.reject()},Scenes.unload=function(t){var n=kn.scenes.indexOf(t);n>=0?(t.destroy(),kn.scenes.splice(n,1)):console.warn("Trying to unload an unregistered scene instance")},Scenes.unloadByPath=function(t){var n=kn.scenes.find((function(n){return n.templatePath===t}));n?Scenes.unload(n):console.warn("Trying to unload an unknown scene '"+t+"'")},Scenes.create=function(){var t=new sn;return kn.scenes.push(t),t},Scenes.preLoad=function(t){return kn.preloadedScenesRequests.some((function(n){return n===t}))||kn.preloadedScenesInProgress.some((function(n){return n.scene.templatePath===t}))||kn.preloadedScenes.some((function(n){return n.templatePath===t}))?(console.warn("Scene '"+t+"' is already pre-load(ed/ing). Skipping request."),Promise.reject()):(kn.preloadedScenesRequests.push(t),new Promise((function(n,r){Mn.loadObjectIgnoreCache(t).then((function(r){var o=r[0];kn.preloadedScenesInProgress.push({scene:o,resolve:n});var i=kn.preloadedScenesRequests.indexOf(t);console.assert(i>=0),kn.preloadedScenesRequests.splice(i,1)})).catch(r)})))},Scenes.clear=function(){Dn.destroy()},Scenes}();!function(t){t.loadingMap=new Map}(Nn||(Nn={})),function(t){t.updateLoading=function updateLoading(){var t=Nn.loadingMap;if(0===t.size)return!1;var n=[];t.forEach((function(t,r){if(r.isLoaded()){for(var o=0,i=t;o<i.length;o++){i[o].post()}n.push(r)}}));for(var r=0,o=n;r<o.length;r++){var i=o[r];t.delete(i)}return t.size>0}}(Vn||(Vn={}));var Wn,qn,Gn=function(){function Assets(){}return Assets.load=function(t){return new Promise((function(n,r){yt.instance.loadObject(t).then((function(t){var r=t[0];if(r.isLoaded())n(r);else{var o=Nn.loadingMap,i=o.get(r);i?i.push(new W.VoidAsyncEvent):(i=[new W.VoidAsyncEvent],o.set(r,i)),i[i.length-1].once((function(){return n(r)}))}})).catch(r)}))},Assets.loadById=function(t){var n=An.getPath(t);return n?Assets.load(n):Promise.reject("Could not resolve path for asset with id '"+t+"'")},Assets}(),Hn=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),CollisionGroup_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Xn=function(t){function CollisionGroup(){return null!==t&&t.apply(this,arguments)||this}return Hn(CollisionGroup,t),CollisionGroup=CollisionGroup_decorate([displayName("Collision Group")],CollisionGroup)}(nt),Kn=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Transform_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Transform_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.changeCallbacks=[]}(Wn||(Wn={})),function(t){t.positionKey="_position",t.rotationKey="_rotation",t.scaleKey="_scale"}(qn||(qn={}));var Qn,Yn=function(t){function Transform(n){var r=t.call(this)||this;return r.changed=new W.VoidSyncEvent,r._position=new w,r._rotation=new kt,r._scale=new w(1,1,1),r._worldMatrix=new A,r._invWorldMatrix=new A,r._worldMatrixDirty=!0,r._invWorldMatrixDirty=!0,r._localMatrix=new A,r._localMatrixDirty=!0,r._disableDirtification=!1,r._eventsEnabled=!0,n&&r.setState(n),r.attachToPosition(),r.attachToRotation(),r.attachToScale(),r}return Kn(Transform,t),Object.defineProperty(Transform.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"position",{get:function(){return this._position},set:function(t){this._position.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"eventsEnabled",{set:function(t){this._eventsEnabled=t},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"localMatrix",{get:function(){return this._localMatrixDirty&&(this._localMatrix.compose(this._position,this._rotation,this._scale),this._localMatrixDirty=!1),this._localMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"worldMatrix",{get:function(){if(this._worldMatrixDirty){this._worldMatrix.copy(this.localMatrix);var t=this.entity.parent?this.entity.parent.transform:void 0;t&&this._worldMatrix.multiplyMatrices(t.worldMatrix,this._worldMatrix),this._worldMatrixDirty=!1}return this._worldMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"invWorldMatrix",{get:function(){return this._invWorldMatrixDirty&&(this._invWorldMatrix.getInverse(this.worldMatrix),this._invWorldMatrixDirty=!1),this._invWorldMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"worldRight",{get:function(){return this.worldMatrix.decompose(w.dummy,kt.dummy,w.dummy),w.fromPool().copy(w.right).rotate(kt.dummy).normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"worldForward",{get:function(){return this.worldMatrix.decompose(w.dummy,kt.dummy,w.dummy),w.fromPool().copy(w.forward).rotate(kt.dummy).normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"worldUp",{get:function(){return this.worldMatrix.decompose(w.dummy,kt.dummy,w.dummy),w.fromPool().copy(w.up).rotate(kt.dummy).normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"right",{get:function(){return w.fromPool().copy(w.right).rotate(this.rotation).normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"forward",{get:function(){return w.fromPool().copy(w.forward).rotate(this.rotation).normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"up",{get:function(){return w.fromPool().copy(w.up).rotate(this.rotation).normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"worldPosition",{get:function(){return w.fromPool().setFromMatrix(this.worldMatrix)},set:function(t){this._position.copy(t);var n=this.entity.parent?this.entity.parent.transform:null;if(n){var r=A.fromPool().copy(n.worldMatrix).invert();this._position.transform(r)}},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"worldRotation",{get:function(){return this.worldMatrix.getRotation(kt.fromPool())},enumerable:!1,configurable:!0}),Object.defineProperty(Transform.prototype,"worldScale",{get:function(){return this.worldMatrix.getScale(w.fromPool())},enumerable:!1,configurable:!0}),Transform.prototype.setProperty=function(n,r){t.prototype.setProperty.call(this,n,r),n===qn.positionKey?(this.attachToPosition(),this.dirtifyWorldMatrix()):n===qn.rotationKey?(this.attachToRotation(),this.dirtifyWorldMatrix()):n===qn.scaleKey&&(this.attachToScale(),this.dirtifyWorldMatrix())},Transform.prototype.translate=function(t){this.position.add(t)},Transform.prototype.upgrade=function(t,n){var r;return 1===n&&(Object.assign(t.properties,((r={})[qn.positionKey]=t.properties.position,r[qn.rotationKey]=t.properties.rotation,r[qn.scaleKey]=t.properties.scale,r)),delete t.properties.position,delete t.properties.rotation,delete t.properties.scale),t},Transform.prototype.worldToLocal=function(t,n){return n.copy(t).transform(this.invWorldMatrix)},Transform.prototype.localToWorld=function(t,n){return n.copy(t).transform(this.worldMatrix)},Transform.prototype.worldToLocalDirection=function(t,n){return Bt.fromPool().set(t.x,t.y,t.z,0).transform(this.invWorldMatrix).getVec3(n)},Transform.prototype.worldToLocalRotation=function(t,n){return n.copy(t).multiply(kt.dummy.setFromMatrix(this.invWorldMatrix))},Transform.prototype.dirtifyWorldMatrix=function(){this._disableDirtification||(this._localMatrixDirty=!0,this._worldMatrixDirty=!0,this._invWorldMatrixDirty=!0,this.entity&&this.entity.traverse((function(t){var n=t.transform;return!!n&&(n._worldMatrixDirty=!0,n._invWorldMatrixDirty=!0,Wn.changeCallbacks.push(n.changed),!0)})),this._eventsEnabled&&(Wn.changeCallbacks.forEach((function(t){return t.post()})),this.changed.post()),Wn.changeCallbacks.length=0)},Transform.prototype.setLocalMatrix=function(t){this._localMatrix.copy(t),this._localMatrix.decompose(this._position,this._rotation,this._scale),this._localMatrixDirty=!1,this._worldMatrixDirty=!0},Transform.prototype.reset=function(){this._disableDirtification=!0,this._position.copy(w.zero),this._rotation.copy(kt.identity),this._scale.copy(w.one),this._disableDirtification=!1,this.dirtifyWorldMatrix()},Transform.prototype.onReplace=function(t){this.changed=t.changed,this.changed.post()},Transform.prototype.attachToPosition=function(){var t=this;Object.defineProperty(this._position,"x",{set:function(n){t._position[y.xKey]=n,t.dirtifyWorldMatrix()},get:function(){return t._position[y.xKey]}}),Object.defineProperty(this._position,"y",{set:function(n){t._position[y.yKey]=n,t.dirtifyWorldMatrix()},get:function(){return t._position[y.yKey]}}),Object.defineProperty(this._position,"z",{set:function(n){t._position[y.zKey]=n,t.dirtifyWorldMatrix()},get:function(){return t._position[y.zKey]}})},Transform.prototype.attachToScale=function(){var t=this;Object.defineProperty(this._scale,"x",{set:function(n){t._scale[y.xKey]=n,t.dirtifyWorldMatrix()},get:function(){return t._scale[y.xKey]}}),Object.defineProperty(this._scale,"y",{set:function(n){t._scale[y.yKey]=n,t.dirtifyWorldMatrix()},get:function(){return t._scale[y.yKey]}}),Object.defineProperty(this._scale,"z",{set:function(n){t._scale[y.zKey]=n,t.dirtifyWorldMatrix()},get:function(){return t._scale[y.zKey]}})},Transform.prototype.attachToRotation=function(){var t=this;Object.defineProperty(this._rotation,"x",{set:function(n){t._rotation[y.xKey]=n,t.dirtifyWorldMatrix()},get:function(){return t._rotation[y.xKey]}}),Object.defineProperty(this._rotation,"y",{set:function(n){t._rotation[y.yKey]=n,t.dirtifyWorldMatrix()},get:function(){return t._rotation[y.yKey]}}),Object.defineProperty(this._rotation,"z",{set:function(n){t._rotation[y.zKey]=n,t.dirtifyWorldMatrix()},get:function(){return t._rotation[y.zKey]}}),Object.defineProperty(this._rotation,"w",{set:function(n){t._rotation[y.wKey]=n,t.dirtifyWorldMatrix()},get:function(){return t._rotation[y.wKey]}})},Transform_decorate([Attributes_unserializable(),Transform_metadata("design:type",Object)],Transform.prototype,"changed",void 0),Transform_decorate([Attributes_unserializable(),Transform_metadata("design:type",Object)],Transform.prototype,"_worldMatrix",void 0),Transform_decorate([Attributes_unserializable(),Transform_metadata("design:type",Object)],Transform.prototype,"_invWorldMatrix",void 0),Transform_decorate([Attributes_unserializable(),Transform_metadata("design:type",Object)],Transform.prototype,"_worldMatrixDirty",void 0),Transform_decorate([Attributes_unserializable(),Transform_metadata("design:type",Object)],Transform.prototype,"_invWorldMatrixDirty",void 0),Transform_decorate([Attributes_unserializable(),Transform_metadata("design:type",Object)],Transform.prototype,"_localMatrix",void 0),Transform_decorate([Attributes_unserializable(),Transform_metadata("design:type",Object)],Transform.prototype,"_localMatrixDirty",void 0),Transform_decorate([Attributes_unserializable(),Transform_metadata("design:type",Object)],Transform.prototype,"_disableDirtification",void 0),Transform_decorate([Attributes_unserializable(),Transform_metadata("design:type",Object)],Transform.prototype,"_eventsEnabled",void 0),Transform=Transform_decorate([mandatory(),sortOrder(0),Transform_metadata("design:paramtypes",[Object])],Transform)}(fn),Zn=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),CollisionFilter_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},CollisionFilter_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.emptyArray=new Kt(Xn)}(Qn||(Qn={}));var Jn,$n=function(t){function CollisionFilter(){return null!==t&&t.apply(this,arguments)||this}return Zn(CollisionFilter,t),CollisionFilter.prototype.getIncluded=function(){return Qn.emptyArray},CollisionFilter.prototype.getExcluded=function(){return Qn.emptyArray},CollisionFilter.prototype.detach=function(){this.getExcluded().detach(),this.getIncluded().detach()},CollisionFilter.prototype.canCollideWith=function(t){var n=Boolean(t);return!(!!n&&this.getExcluded().data.some((function(n){return n.asset===t})))&&(!(this.getIncluded().data.length>0)||n&&this.getIncluded().data.some((function(n){return n.asset===t})))},CollisionFilter}(z),tr=function(t){function InclusionCollisionFilter(n){var r=t.call(this)||this;return r._included=new Kt(Xn),n&&(r._included.data=n.map((function(t){return new K(Xn,t)}))),r}return Zn(InclusionCollisionFilter,t),InclusionCollisionFilter.prototype.getIncluded=function(){return this._included},InclusionCollisionFilter=CollisionFilter_decorate([displayName("Include"),CollisionFilter_metadata("design:paramtypes",[Array])],InclusionCollisionFilter)}($n),er=function(t){function ExclusionCollisionFilter(n){var r=t.call(this)||this;return r._excluded=new Kt(Xn),n&&(r._excluded.data=n.map((function(t){return new K(Xn,t)}))),r}return Zn(ExclusionCollisionFilter,t),ExclusionCollisionFilter.prototype.getExcluded=function(){return this._excluded},ExclusionCollisionFilter=CollisionFilter_decorate([displayName("Exclude"),CollisionFilter_metadata("design:paramtypes",[Array])],ExclusionCollisionFilter)}($n);!function(t){t[t.Normal=0]="Normal",t[t.Particles=1]="Particles"}(Jn||(Jn={}));var nr,rr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),or=function(t){function CollisionShape(){return null!==t&&t.apply(this,arguments)||this}return rr(CollisionShape,t),CollisionShape.prototype.getTestPriority=function(){return Jn.Normal},CollisionShape.prototype.checkCollisions=function(t,n,r,o){},CollisionShape}(z);!function(t){!function(t){t.boxMin=new w,t.boxMax=new w}(t.boxIntersectsWithSphere||(t.boxIntersectsWithSphere={})),function(t){t._sphereWorldPos=new w}(t.boxIntersectsWithSphereShape||(t.boxIntersectsWithSphereShape={})),function(t){t.box1Min=new w,t.box1Max=new w,t.box2Min=new w,t.box2Max=new w}(t.boxIntersectsWithBox||(t.boxIntersectsWithBox={})),function(t){t._sphere1WorldPos=new w,t._sphere2WorldPos=new w}(t.sphereIntersectsWithSphereShape||(t.sphereIntersectsWithSphereShape={})),t.getBoxShapeMin=function getBoxShapeMin(t,n,r){return r.set(t.center.x-t.extent.x+n.x,t.center.y-t.extent.y+n.y,t.center.z-t.extent.z+n.z).asArray()},t.getBoxShapeMax=function getBoxShapeMax(t,n,r){return r.set(t.center.x+t.extent.x+n.x,t.center.y+t.extent.y+n.y,t.center.z+t.extent.z+n.z).asArray()}}(nr||(nr={}));var ir,ar,sr=function(){function CollisionUtils(){}return CollisionUtils.boxIntersectsWithSphereShape=function(t,n,r,o){var i=nr.boxIntersectsWithSphereShape._sphereWorldPos,a=w.dummy.copy(r.center).rotate(o.worldRotation);return i.addVectors(a,o.worldPosition),CollisionUtils.boxIntersectsWithSphere(t,n.worldPosition,i,r.radius)},CollisionUtils.boxIntersectsWithSphere=function(t,n,r,o){for(var i=0,a=0,c=nr.boxIntersectsWithSphere,u=c.boxMin,l=c.boxMax,p=nr.getBoxShapeMin(t,n,u),f=nr.getBoxShapeMax(t,n,l),h=r.asArray(),d=0;d<3;++d)h[d]<p[d]?a+=(i=h[d]-p[d])*i:h[d]>f[d]&&(a+=(i=h[d]-f[d])*i);return a<=o*o},CollisionUtils.boxIntersectsWithBox=function(t,n,r,o){for(var i=nr.boxIntersectsWithBox,a=i.box1Min,c=i.box1Max,u=i.box2Min,l=i.box2Max,p=nr.getBoxShapeMin(t,n,a),f=nr.getBoxShapeMax(t,n,c),h=nr.getBoxShapeMin(r,o,u),d=nr.getBoxShapeMax(r,o,l),y=0;y<3;++y)if(p[y]>d[y])return!1;for(y=0;y<3;++y)if(h[y]>f[y])return!1;return!0},CollisionUtils.sphereIntersectsWithSphereShape=function(t,n,r,o){var i=nr.sphereIntersectsWithSphereShape,a=i._sphere1WorldPos,c=i._sphere2WorldPos,u=w.dummy.copy(t.center).rotate(n.worldRotation),l=w.dummy2.copy(r.center).rotate(o.worldRotation);return a.addVectors(u,n.worldPosition),c.addVectors(l,o.worldPosition),this.sphereIntersectsWithSphere(a,t.radius,c,r.radius)},CollisionUtils.sphereIntersectsWithSphere=function(t,n,r,o){var i=n+o;return w.distanceSq(t,r)<i*i},CollisionUtils}(),cr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ur=function(t){function SphereCollisionShape(n){var r=t.call(this)||this;return r.tag="Sphere",r.center=new w,r.radius=1,n&&r.setState(n),r}return cr(SphereCollisionShape,t),SphereCollisionShape.prototype.checkCollisions=function(t,n,r,o){if(t.isA(pr)){var i=t;sr.boxIntersectsWithSphereShape(i,r,this,n)&&o()}else if(t.isA(SphereCollisionShape)){var a=t;sr.sphereIntersectsWithSphereShape(this,n,a,r)&&o()}},SphereCollisionShape}(or),lr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),pr=function(t){function BoxCollisionShape(n){var r=t.call(this)||this;return r.tag="Box",r.center=new w,r.extent=new w(1,1,1),n&&r.setState(n),r}return lr(BoxCollisionShape,t),BoxCollisionShape.prototype.checkCollisions=function(t,n,r,o){if(t.isA(BoxCollisionShape)){var i=t;sr.boxIntersectsWithBox(this,n.worldPosition,i,r.worldPosition)&&o()}else if(t.isA(ur)){var a=t;sr.boxIntersectsWithSphereShape(this,n,a,r)&&o()}},BoxCollisionShape}(or),fr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Collider_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Collider_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},hr=function(t){function Collider(n){var r=t.call(this)||this;return r._group=new K(Xn),r._filter=new v($n),r._shapes=new Rt(or),r._collision=new W.SyncEvent,n&&r.setState(n),0===r.shapes.length&&r._shapes.grow(new pr),r}var n;return fr(Collider,t),Object.defineProperty(Collider.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(Collider.prototype,"group",{get:function(){return this._group.asset},enumerable:!1,configurable:!0}),Object.defineProperty(Collider.prototype,"shapes",{get:function(){return this._shapes.data.filter((function(t){return Boolean(t.instance)})).map((function(t){return t.instance}))},set:function(t){var n=this;this._shapes.clear(),t.forEach((function(t){return n._shapes.grow(t)}))},enumerable:!1,configurable:!0}),Object.defineProperty(Collider.prototype,"filter",{get:function(){return this._filter.instance},enumerable:!1,configurable:!0}),Object.defineProperty(Collider.prototype,"onCollision",{set:function(t){this._collision.detach(),t&&this._collision.attach(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Collider.prototype,"collision",{get:function(){return this._collision},enumerable:!1,configurable:!0}),Collider.prototype.setEntity=function(n){t.prototype.setEntity.call(this,n),n.getOrSetComponent(Yn)},Collider.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_shapes:t.properties.shapes}),delete t.properties.shapes),t},Collider.prototype.destroy=function(){t.prototype.destroy.call(this),this._collision.detach(),this.filter&&this.filter.detach()},Collider_decorate([(n="BoxCollisionShape",Reflect.metadata("defaultType",n)),nullable(!1),Collider_metadata("design:type",Object)],Collider.prototype,"_shapes",void 0),Collider_decorate([Attributes_unserializable(),Collider_metadata("design:type",Object)],Collider.prototype,"_collision",void 0),Collider}(fn),Components_assign=function(){return(Components_assign=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++)for(var i in n=arguments[r])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},dr=function(){function Components(){}return Components.ofType=function(t){for(var n=[],r=0,o=Dn.list();r<o.length;r++){var i=o[r];n=n.concat(i.root.getComponents(t))}return n},Components.ofTypes=function(t){var n=t.reduce((function(t,n){var r;return Components_assign(Components_assign({},t),((r={})[n.name]=[],r))}),{});return Dn.list().forEach((function(r){r.root.traverse((function(r){if(!r.active||r.transient)return!1;for(var o=0,i=t;o<i.length;o++){var a=i[o],c=r.getComponent(a);c&&c.active&&n[a.name].push(c)}return!0}))})),n},Components}(),yr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Material_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Material_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.shaderParamsPropertySetter="shaderParams"}(ir||(ir={})),function(t){t.shaderPropertyKey="_shader",t.shaderParamsPropertyKey="_"+ir.shaderParamsPropertySetter}(ar||(ar={}));var mr,vr=function(t){function Material(n){var r,o=t.call(this)||this;if(o._blending=i.None,o._renderPass=u.Opaque,o._cullMode=c.Back,o._depthTest=!0,o._priority=0,o._shaderParams=new z,o._shader=new K(rn),o._bucketId=null,o.onShaderCodeChanged=o.onShaderCodeChanged.bind(o),o.onShaderChanged=o.onShaderChanged.bind(o),o._shader.assetChanged.attach(o.onShaderChanged),n){if(ir.shaderParamsPropertySetter in n){var a=n[ir.shaderParamsPropertySetter],l=n.shader;l&&(delete n[ir.shaderParamsPropertySetter],delete n.shader,Object.assign(n,((r={shader:l})[ir.shaderParamsPropertySetter]=a,r)))}o.setState(n)}return o}return yr(Material,t),Object.defineProperty(Material.prototype,"version",{get:function(){return 4},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"shader",{get:function(){return this._shader.asset},set:function(t){this._shader.asset=t},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"blending",{get:function(){return this._blending},set:function(t){this._blending=t,this._bucketId=null},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"renderPass",{get:function(){return this._renderPass},set:function(t){this._renderPass=t},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"cullMode",{get:function(){return this._cullMode},set:function(t){this._cullMode=t,this._bucketId=null},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"priority",{get:function(){return this._priority},set:function(t){this._priority=t},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"shaderParams",{get:function(){return this._shaderParams},set:function(t){if(this.shader){var n=this.shader.getUniforms();Object.keys(t).filter((function(t){var r=n[t];return!!r&&Boolean(r.type.match(/sampler/))})).forEach((function(n){var r=t[n];console.assert(r),"string"==typeof r?t[n]=new K(ct,new Fe({textureData:r})):r.isA&&r.isA(ct)?t[n]=new K(ct,r):console.error("Invalid sampler uniform '"+n+"', must be an Url or a Texture object.")})),this._shaderParams=$e.buildMaterialParams(n,t,!1),this.updateRuntimeAccessors()}else console.error("Cannot set property 'shaderParams' on Material because it has no shader.")},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"depthTest",{get:function(){return this._depthTest},set:function(t){this._depthTest=t,this._bucketId=null},enumerable:!1,configurable:!0}),Object.defineProperty(Material.prototype,"buckedId",{get:function(){if(this._bucketId)return this._bucketId;var t=i.Additive+1,n=c.None+1,r=1<<this.blending,o=1<<t<<this.cullMode,a=1<<t+n<<(this._depthTest?0:1);return this._bucketId=""+(r|o|a),this._bucketId},enumerable:!1,configurable:!0}),Material.prototype.begin=function(t){var n=this.shader;if(!n||!n.begin(t))return!1;for(var r=0,o=Object.entries(this.shaderParams);r<o.length;r++){var i=o[r],a=i[0],c=i[1];n.applyParam(a,c)}return this.uploadState(),!0},Material.prototype.uploadState=function(){var t=at.context,n=this.blending;n===i.None?at.enableBlending(!1):n===i.Linear?(at.enableBlending(!0),at.setBlendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)):n===i.Additive&&(at.enableBlending(!0),at.setBlendFunc(t.SRC_ALPHA,t.ONE));var r=this.cullMode;r===c.Back?(at.enableCulling(!0),at.setCullMode(t.BACK)):r===c.Front?(at.enableCulling(!0),at.setCullMode(t.FRONT)):at.enableCulling(!1)},Material.prototype.destroy=function(){this._shader.asset&&this._shader.asset.codeChanged.detach(this.onShaderCodeChanged),this._shader.detach();for(var n=0,r=Object.values(this._shaderParams);n<r.length;n++){var o=r[n];"AssetReference"===o.constructor.name&&o.detach()}t.prototype.destroy.call(this)},Material.prototype.isLoaded=function(){return!!Y.isAssetRefLoaded(this._shader)&&Y.isObjectLoaded(this._shaderParams)},Material.prototype.queueParameter=function(t,n){this._shaderParams[t]=n},Material.prototype.queueReferenceParameter=function(t,n){var r=this._shaderParams[t];r?r.setAssetFast(n):p.logError("queueReferenceParameter failed")},Material.prototype.getParameter=function(t){return this._shaderParams[t]},Material.prototype.applyParameter=function(t,n){var r=this.shader;r&&(this._shaderParams[t]=n,r.applyParam(t,n))},Material.prototype.applyReferenceParameter=function(t,n){var r=this.shader;if(r){var o=this._shaderParams[t];o.setAssetFast(n),r.applyParam(t,o)}},Material.prototype.upgrade=function(t,n){if(1===n)Object.assign(t.properties,{_blending:t.properties.blending,_renderPass:t.properties.renderPass,_cullMode:t.properties.cullMode,_priority:t.properties.priority,_shaderParams:t.properties.shaderParams,_shader:t.properties.shader}),delete t.properties.blending,delete t.properties.renderPass,delete t.properties.cullMode,delete t.properties.priority,delete t.properties.shaderParams,delete t.properties.shader;else if(2===n)for(var r=t.properties._shaderParams,o=0,i=Object.keys(r.properties);o<i.length;o++){var a=i[o],c=r.properties[a];if("TextureReference"===c.typeName){var u=c.data.properties.texture;r.properties[a]={typeName:"AssetReference",data:JSON.parse(JSON.stringify(u))}}}else if(3===n){var l=t.properties._renderPass;"object"==typeof l&&(l=l.value),l>0&&Object.assign(t.properties,{_renderPass:l-1})}return t},Material.prototype.onShaderCodeChanged=function(t){var n=this.shader;n&&(this.updateParamsFromShader(n,!0),this.updateRuntimeAccessors())},Material.prototype.onShaderChanged=function(t){t.newAsset&&(this.updateParamsFromShader(t.newAsset,!1),this.updateRuntimeAccessors())},Material.prototype.updateRuntimeAccessors=function(){var t=this;Object.entries(this._shaderParams).forEach((function(n){var r=n[0],o=n[1];"AssetReference"===o.constructor.name?Object.defineProperty(t,r,{get:function(){return o.asset},set:function(n){var i;"normalMap"===r&&Boolean(o.asset)!==Boolean(n)&&(null===(i=t.shader)||void 0===i||i.invalidate()),o.asset=n},configurable:!0}):Object.defineProperty(t,r,{get:function(){return t._shaderParams[r]},set:function(n){var o;"reflectivity"===r&&(t._shaderParams[r]>0!=n>0&&(null===(o=t.shader)||void 0===o||o.invalidate()));t._shaderParams[r]=n},configurable:!0})}))},Material.prototype.updateParamsFromShader=function(t,n){this._shaderParams=$e.buildMaterialParams(t.getUniforms(),this._shaderParams,n)},Material_decorate([Attributes_enumLiterals(i),Material_metadata("design:type",Object)],Material.prototype,"_blending",void 0),Material_decorate([Attributes_enumLiterals(u),Material_metadata("design:type",Object)],Material.prototype,"_renderPass",void 0),Material_decorate([Attributes_enumLiterals(c),Material_metadata("design:type",Object)],Material.prototype,"_cullMode",void 0),Material_decorate([Attributes_unserializable(),Material_metadata("design:type",Object)],Material.prototype,"_bucketId",void 0),Material}(nt),gr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();!function(t){t[t.Changed=0]="Changed",t[t.Unchanged=1]="Unchanged"}(mr||(mr={}));var _r,br=function(t){function Geometry(){return null!==t&&t.apply(this,arguments)||this}return gr(Geometry,t),Geometry.prototype.getVertexBuffer=function(){return null},Geometry.prototype.getBoundingBox=function(){return null},Geometry.prototype.getWorldTransform=function(t){return t.worldMatrix},Geometry.prototype.graphicUpdate=function(t,n){return mr.Unchanged},Geometry}(z),wr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),VisualGroup_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},xr=function(t){function VisualGroup(){return null!==t&&t.apply(this,arguments)||this}return wr(VisualGroup,t),VisualGroup=VisualGroup_decorate([displayName("Visual Group")],VisualGroup)}(nt),Pr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),StaticMeshAsset_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},StaticMeshAsset_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Or=function(t){function StaticMeshAsset(){return null!==t&&t.apply(this,arguments)||this}return Pr(StaticMeshAsset,t),Object.defineProperty(StaticMeshAsset.prototype,"vertexBuffer",{get:function(){return this._vertexBuffer},set:function(t){this._vertexBuffer&&this.graphicUnload(),this._vertexBuffer=t,delete this._boundingBox},enumerable:!1,configurable:!0}),Object.defineProperty(StaticMeshAsset.prototype,"boundingBox",{get:function(){if(!this._boundingBox&&this._vertexBuffer){var t=this._vertexBuffer,n=t.attributes,r=t.indices;this._boundingBox=Ft.fromVertexArray(n.position,r)}return this._boundingBox},enumerable:!1,configurable:!0}),StaticMeshAsset.prototype.graphicUnload=function(){this._vertexBuffer.unload()},StaticMeshAsset_decorate([Attributes_unserializable(),StaticMeshAsset_metadata("design:type",Ft)],StaticMeshAsset.prototype,"_boundingBox",void 0),StaticMeshAsset=StaticMeshAsset_decorate([displayName("Static Mesh"),editable(!1),referencable(!0)],StaticMeshAsset)}(ot),Cr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Sr=function(t){function StaticMesh(n){var r=t.call(this)||this;return r._mesh=new K(Or),n&&r.setState(n),r}return Cr(StaticMesh,t),Object.defineProperty(StaticMesh.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(StaticMesh.prototype,"mesh",{get:function(){return this._mesh.asset},set:function(t){this._mesh.asset=t},enumerable:!1,configurable:!0}),StaticMesh.prototype.getVertexBuffer=function(){var t=this._mesh.asset;return t?t.vertexBuffer:null},StaticMesh.prototype.getBoundingBox=function(){var t=this._mesh.asset;return t?t.boundingBox:null},StaticMesh.prototype.destroy=function(){this._mesh.detach(),t.prototype.destroy.call(this)},StaticMesh.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_mesh:t.properties.mesh}),delete t.properties.mesh),t},StaticMesh}(br),Ar=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Bone_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Bone_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Er=function(t){function Bone(n){var r=t.call(this)||this;return r.worldMatrix=new E,r.inverseMatrix=new E,r.fbxId=0,n&&r.setState(n),r}return Ar(Bone,t),Object.defineProperty(Bone.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Bone.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{worldMatrix:t.properties.boneWorldMatrix,inverseMatrix:t.properties.boneInverseMatrix}),delete t.properties.boneWorldMatrix,delete t.properties.boneInverseMatrix),t},Bone_decorate([Attributes_hidden(),Bone_metadata("design:type",Object)],Bone.prototype,"fbxId",void 0),Bone}(fn),jr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),MemoryTexture_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},MemoryTexture_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Tr=function(t){function MemoryTexture(n,r,o,i,a,c){var u=t.call(this)||this;return u._isDirty=!0,u._data=n,u._width=r,u._height=o,u._internalFormat=i,u._format=a,u._type=c,u.isPersistent=!1,u}return jr(MemoryTexture,t),MemoryTexture.prototype.getWidth=function(){return this._width},MemoryTexture.prototype.getHeight=function(){return this._height},MemoryTexture.prototype.begin=function(t){var n=at.context;return this._textureId?(n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,this._textureId),this._isDirty&&(this.updateTexture(),this._isDirty=!1)):(this._textureId=n.createTexture(),n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,this._textureId),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),this.updateTexture()),!0},MemoryTexture.prototype.dirtify=function(){this._isDirty=!0},MemoryTexture.prototype.updateTexture=function(){var t=at.context;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,0),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.texImage2D(t.TEXTURE_2D,0,this._internalFormat,this._width,this._height,0,this._format,this._type,this._data)},MemoryTexture_decorate([Attributes_unserializable(),MemoryTexture_metadata("design:type",Object)],MemoryTexture.prototype,"_isDirty",void 0),MemoryTexture=MemoryTexture_decorate([referencable(!1),MemoryTexture_metadata("design:paramtypes",[Float32Array,Number,Number,Number,Number,Number])],MemoryTexture)}(ct),Rr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),SkinnedMesh_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},SkinnedMesh_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.offsetMatrix=new A}(_r||(_r={}));var Br,Mr=function(t){function SkinnedMesh(){var n=t.call(this)||this;return n._bindMatrix=new E,n._bindMatrixInverse=new E,n._boneFbxIds=new xt(Number),n._skeleton=new Ba(void 0),n}return Rr(SkinnedMesh,t),Object.defineProperty(SkinnedMesh.prototype,"skeleton",{get:function(){return this._skeleton.entity},set:function(t){this._skeleton.entity=t},enumerable:!1,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"bindMatrix",{get:function(){return this._bindMatrix},set:function(t){this._bindMatrix.copy(t),this._bindMatrixInverse.getInverse(t)},enumerable:!1,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"bindMatrixInverse",{get:function(){return this._bindMatrixInverse},enumerable:!1,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"boneTexture",{get:function(){return this._boneTexture},enumerable:!1,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"boneTextureSize",{get:function(){return this._boneTextureSize},enumerable:!1,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"boneMatrices",{get:function(){return this._boneMatrices},enumerable:!1,configurable:!0}),Object.defineProperty(SkinnedMesh.prototype,"boneFbxIds",{set:function(t){this._boneFbxIds.data.length=0;for(var n=0,r=t;n<r.length;n++){var o=r[n];this._boneFbxIds.grow(o)}},enumerable:!1,configurable:!0}),SkinnedMesh.prototype.getVertexBuffer=function(){return t.prototype.getVertexBuffer.call(this)},SkinnedMesh.prototype.destroy=function(){this._vb&&this._vb.unload(),t.prototype.destroy.call(this)},SkinnedMesh.prototype.updateMatrices=function(){this._boneMatrices||this.initMatrices();for(var t=_r.offsetMatrix,n=0;n<this._bones.length;++n){var r=this._bones[n]?this._bones[n].transform.worldMatrix:A.identity;t.multiplyMatrices(r,this._boneInverses[n]),t.toArray(this._boneMatrices,16*n)}},SkinnedMesh.prototype.updateShader=function(t,n){at.extensions.OES_texture_float?(this._boneTexture.dirtify(),t.applyReferenceParam("boneTexture",this._boneTexture,n),t.applyParam("boneTextureSize",this._boneTextureSize,n)):t.applyParam("boneMatrices",this._boneMatrices),t.applyParam("bindMatrix",this._bindMatrix,n),t.applyParam("bindMatrixInverse",this._bindMatrixInverse,n)},SkinnedMesh.prototype.initMatrices=function(){var t=this._skeleton.entity;this._bones=[],this._boneInverses=[];for(var n=t.getComponents(Er),r=0,_loop_1=function(t){var i=t.valueOf(),a=n.find((function(t){return t.fbxId===i}));a?(o._bones[r]=a.entity,o._boneInverses[r]=a.inverseMatrix,++r):p.logWarning("Bone with ID '"+t+"' not found")},o=this,i=0,a=this._boneFbxIds.data;i<a.length;i++){_loop_1(a[i])}this._bones.length=r,this._boneInverses.length=r;var c=Math.sqrt(4*this._bones.length);if(c=P.ceilPowerOfTwo(c),c=Math.max(c,4),this._boneMatrices=new Float32Array(c*c*4),at.extensions.OES_texture_float){var u=at.context;this._boneTexture=new Tr(this._boneMatrices,c,c,at.version>1?u.RGBA32F:u.RGBA,u.RGBA,u.FLOAT),this._boneTextureSize=c}},SkinnedMesh.skeletonPropertyKey="_skeleton",SkinnedMesh_decorate([Attributes_hidden(),SkinnedMesh_metadata("design:type",Ba)],SkinnedMesh.prototype,"_skeleton",void 0),SkinnedMesh_decorate([Attributes_hidden(),SkinnedMesh_metadata("design:type",Object)],SkinnedMesh.prototype,"_boneFbxIds",void 0),SkinnedMesh_decorate([Attributes_unserializable(),SkinnedMesh_metadata("design:type",Vt)],SkinnedMesh.prototype,"_vb",void 0),SkinnedMesh_decorate([Attributes_unserializable(),SkinnedMesh_metadata("design:type",Tr)],SkinnedMesh.prototype,"_boneTexture",void 0),SkinnedMesh_decorate([Attributes_unserializable(),SkinnedMesh_metadata("design:type",Number)],SkinnedMesh.prototype,"_boneTextureSize",void 0),SkinnedMesh_decorate([Attributes_unserializable(),SkinnedMesh_metadata("design:type",Float32Array)],SkinnedMesh.prototype,"_boneMatrices",void 0),SkinnedMesh_decorate([Attributes_unserializable(),SkinnedMesh_metadata("design:type",Array)],SkinnedMesh.prototype,"_boneInverses",void 0),SkinnedMesh_decorate([Attributes_unserializable(),SkinnedMesh_metadata("design:type",Array)],SkinnedMesh.prototype,"_bones",void 0),SkinnedMesh}(Sr),Ir=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Visual_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Visual_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},zr=function(t){function Visual(n){var r=t.call(this)||this;return r._castShadows=!0,r._receiveShadows=!0,r._receiveFog=!0,r._group=new K(xr),r._geometry=new v(br),r._material=new K(vr),r._envMap=null,n&&r.setState(n),r}return Ir(Visual,t),Object.defineProperty(Visual.prototype,"version",{get:function(){return 5},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"material",{get:function(){return this._material.asset},set:function(t){this._material.asset=t},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"geometry",{get:function(){return this._geometry.instance},set:function(t){this._geometry.instance=t},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"group",{get:function(){return this._group.asset},set:function(t){this._group.asset=t},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"castShadows",{get:function(){return this._castShadows},set:function(t){this._castShadows=t},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"receiveShadows",{get:function(){return this._receiveShadows},set:function(t){this._receiveShadows=t},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"receiveFog",{get:function(){return this._receiveFog},set:function(t){this._receiveFog=t},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"vertexBuffer",{get:function(){var t,n;return null!==(n=null===(t=this.geometry)||void 0===t?void 0:t.getVertexBuffer())&&void 0!==n?n:null},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"animatedMaterial",{get:function(){return this._uniqueAnimatedMaterialInstance},set:function(t){this._uniqueAnimatedMaterialInstance=t},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"envMap",{get:function(){return this._envMap},set:function(t){this._envMap=t},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"worldTransform",{get:function(){var t,n;return null!==(n=null===(t=this.geometry)||void 0===t?void 0:t.getWorldTransform(this.entity.transform))&&void 0!==n?n:this.entity.transform.worldMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"bucketId",{get:function(){var t=0;return this._receiveShadows&&(t=1),this._receiveFog&&(t|=2),this.isSkinned&&(t|=4),this.hasVertexColor&&(t|=8),this._envMap&&(t|=16),this.hasNormalMap&&(t|=32),""+t},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"isSkinned",{get:function(){var t;return Boolean(null===(t=this.geometry)||void 0===t?void 0:t.isA(Mr))},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"isReflective",{get:function(){var t,n;return(null!==(n=(null===(t=this.material)||void 0===t?void 0:t.shaderParams).reflectivity)&&void 0!==n?n:0)>0},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"hasNormalMap",{get:function(){var t,n,r;return Boolean(null===(r=null===(n=null===(t=this.material)||void 0===t?void 0:t.shaderParams)||void 0===n?void 0:n.normalMap)||void 0===r?void 0:r.asset)},enumerable:!1,configurable:!0}),Object.defineProperty(Visual.prototype,"hasVertexColor",{get:function(){var t,n;return Boolean(null===(n=null===(t=this.geometry)||void 0===t?void 0:t.getVertexBuffer())||void 0===n?void 0:n.hasAttribute("color"))},enumerable:!1,configurable:!0}),Visual.prototype.setEntity=function(n){t.prototype.setEntity.call(this,n),n.getOrSetComponent(Yn)},Visual.prototype.graphicUpdate=function(t){var n,r;return null!==(r=null===(n=this.geometry)||void 0===n?void 0:n.graphicUpdate(t,this.entity.transform))&&void 0!==r?r:mr.Unchanged},Visual.prototype.destroy=function(){var n,r;null===(n=this.geometry)||void 0===n||n.destroy(),null===(r=this._uniqueAnimatedMaterialInstance)||void 0===r||r.destroy(),this._material.detach(),this._group.detach(),t.prototype.destroy.call(this)},Visual.prototype.upgrade=function(t,n){if(1===n){Object.assign(t.properties,{_group:t.properties.group,_material:t.properties.material});var r=t.properties.geometry.data;r&&"Particles"!==r.typeName&&Object.assign(t.properties,{_geometry:t.properties.geometry}),delete t.properties.group,delete t.properties.material,delete t.properties.geometry}else if(2===n){(o=t.properties._geometry.data)&&"SkyBox"===o.typeName&&delete t.properties._geometry.data}else if(3===n){var o;(o=t.properties._geometry.data)&&"Quad"===o.typeName&&(o.typeName="QuadGeometry")}else 4===n&&(Object.assign(t.properties,{_castShadows:t.properties.castShadows,_receiveShadows:t.properties.receiveShadows,_receiveFog:t.properties.receiveFog}),delete t.properties.castShadows,delete t.properties.receiveShadows,delete t.properties.receiveFog);return t},Visual_decorate([Attributes_unserializable(),Attributes_hidden(),Visual_metadata("design:type",vr)],Visual.prototype,"_uniqueAnimatedMaterialInstance",void 0),Visual_decorate([Attributes_unserializable(),Visual_metadata("design:type",Object)],Visual.prototype,"_envMap",void 0),Visual=Visual_decorate([helpUrl("https://docs.spiderengine.io/3d/visual.html"),Visual_metadata("design:paramtypes",[Object])],Visual)}(fn),kr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Dr=function(t){function VisualCollisionShape(n){var r=t.call(this)||this;return r.tag="Visual",r._visual=new Gt(zr),n&&r.setState(n),r}return kr(VisualCollisionShape,t),Object.defineProperty(VisualCollisionShape.prototype,"visualEntity",{set:function(t){this._visual.component=t.getComponent(zr)},enumerable:!1,configurable:!0}),Object.defineProperty(VisualCollisionShape.prototype,"visual",{get:function(){return this._visual.component},enumerable:!1,configurable:!0}),VisualCollisionShape.prototype.checkCollisions=function(t,n,r,o){},VisualCollisionShape}(or),Fr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Lr=function(t){function MeshCollisionShape(n){var r=t.call(this)||this;return r.tag="Mesh",r.mesh=new K(Or),n&&r.setState(n),r}return Fr(MeshCollisionShape,t),MeshCollisionShape.prototype.checkCollisions=function(t,n,r,o){},MeshCollisionShape}(or),Nr=function RaycastResult(){this.position=new w,this.normal=new w};!function(t){t.aabb=new Ft,t.result=new Nr,t.localRay=new ge,t.invWorld=new A,t.rotatedCenter=new w,t.v1=new w,t.v2=new w,t.v3=new w,t.plane=new N,t.triangle=new le}(Br||(Br={}));var Vr,Ur=function(){function Physics(){}return Physics.rayCast=function(t,n){for(var r=dr.ofType(hr),o=!1,i=999999,a=Br.aabb,c=Br.result,u=Br.localRay,l=Br.invWorld,p=Br.rotatedCenter,f=Br.v1,h=Br.v2,d=Br.v3,y=Br.plane,m=Br.triangle,v=0,g=r;v<g.length;v++){var _=g[v];if(!n||n.canCollideWith(_.group)){var b=_.shapes[0],x=_.entity.transform;if(b)if(b.isA(ur)){var P=b;l.copy(x.worldMatrix).translate(P.center).invert(),u.copy(t).transform(l);var O=u.castOnSphere(w.zero,P.radius);if(O){var C=O.intersection1.transform(x.worldMatrix);(D=w.distance(C,t.origin))<i&&(i=D,c.position.copy(C),c.normal.copy(O.normal1.rotate(x.worldRotation)),c.collider=_,c.shape=b,o=!0)}}else if(b.isA(pr)){var S=b;p.copy(S.center).rotate(x.worldRotation),a.min.set(p.x-S.extent.x,p.y-S.extent.y,p.z-S.extent.z),a.max.set(p.x+S.extent.x,p.y+S.extent.y,p.z+S.extent.z),l.getInverse(x.worldMatrix),u.copy(t).transform(l);var A=u.castOnAABB(a);if(A){C=A.intersection1.transform(x.worldMatrix);(D=w.distance(C,t.origin))<i&&(i=D,c.position.copy(C),c.normal.copy(A.normal1.rotate(x.worldRotation)),c.collider=_,c.shape=b,o=!0)}}else if(b.isA(Dr)||b.isA(Lr)){var E=null;if(b.isA(Dr)){var j=b.visual,T=j?j.geometry:void 0;E=T?T.getVertexBuffer():null}else{var R=b.mesh.asset;E=R?R.vertexBuffer:null}if(E){if("TRIANGLES"!==E.primitiveType||E.indices)continue;for(var B=E.attributes.position,I=B.length/3/3,z=0;z<I;++z){var k=9*z;f.set(B[k],B[k+1],B[k+2]).transform(x.worldMatrix),h.set(B[k+3],B[k+4],B[k+5]).transform(x.worldMatrix),d.set(B[k+6],B[k+7],B[k+8]).transform(x.worldMatrix),y.setFromPoints(f,h,d);var D,F=t.castOnPlane(y);if(F.intersection)if(F.classification===M.Front)if(m.set(f,h,d),m.contains(F.intersection))(D=w.distance(F.intersection,t.origin))<i&&(i=D,c.position.copy(F.intersection),c.normal.copy(y.normal),c.collider=_,c.shape=b,o=!0)}}}}}return o?c:null},Physics}(),Wr=function(){function Config(){}return Config.isWeb=function(){return!0},Config.isDesktop=function(){return!1},Config.isProduction=function(){return!0},Config.isDevelopment=function(){return!1},Config.isEditor=function(){return!1},Config.isStandalone=function(){return!0},Config}(),qr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),DrawableTexture_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},DrawableTexture_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Gr=function(t){function DrawableTexture(){var n=null!==t&&t.apply(this,arguments)||this;return n._width=1024,n._height=768,n._rgba=!1,n._filtering=a.Linear,n._data=new ne.a,n._structureDirty=!0,n._pixelsDirty=!0,n}return qr(DrawableTexture,t),Object.defineProperty(DrawableTexture.prototype,"rgba",{get:function(){return this._rgba},set:function(t){this._rgba=t,this._structureDirty=!0},enumerable:!1,configurable:!0}),Object.defineProperty(DrawableTexture.prototype,"width",{get:function(){return this._width},set:function(t){t!==this._width&&(this._width=t,this._structureDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(DrawableTexture.prototype,"height",{get:function(){return this._height},set:function(t){t!==this._height&&(this._height=t,this._structureDirty=!0)},enumerable:!1,configurable:!0}),Object.defineProperty(DrawableTexture.prototype,"data",{get:function(){return this._data.array},set:function(t){this._data.array=t,this._pixelsDirty=!0},enumerable:!1,configurable:!0}),DrawableTexture.prototype.getWidth=function(){return this._width},DrawableTexture.prototype.getHeight=function(){return this._height},DrawableTexture.prototype.begin=function(t){var n=at.context;return this._textureId?(n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,this._textureId),this._structureDirty&&this.updateStructure(),this._pixelsDirty&&this.uploadTexturePixels()):(this._textureId=n.createTexture(),n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,this._textureId),this._filtering===a.Nearest?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),this._structureDirty&&this.updateStructure(),this.uploadTexturePixels()),!0},DrawableTexture.prototype.setPixel=function(t,n,r){if(t<0||t>this._width)p.logWarning("DrawableTexture.putPixel: pixel is out of bounds (x = "+t+", width = "+this._width+")");else if(n<0||n>this._height)p.logWarning("DrawableTexture.putPixel: pixel is out of bounds (y = "+t+", height = "+this._height+")");else{this._structureDirty&&this.updateStructure();var o=this._width*this._bytesPerPixel*n+t*this._bytesPerPixel;this._data.array[o+0]=255*r.r,this._data.array[o+1]=255*r.g,this._data.array[o+2]=255*r.b,this.rgba&&(this._data.array[o+3]=255*r.a),this._pixelsDirty=!0}},DrawableTexture.prototype.updateStructure=function(){this._bytesPerPixel=this._rgba?4:3,this._data.length=this._width*this._height*this._bytesPerPixel,this._structureDirty=!1},DrawableTexture.prototype.uploadTexturePixels=function(){var t=at.context;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1);var n=this._rgba?t.RGBA:t.RGB;t.texImage2D(t.TEXTURE_2D,0,n,this._width,this._height,0,n,t.UNSIGNED_BYTE,this._data.array),this._pixelsDirty=!1},DrawableTexture_decorate([Attributes_enumLiterals(a),DrawableTexture_metadata("design:type",Object)],DrawableTexture.prototype,"_filtering",void 0),DrawableTexture_decorate([Attributes_hidden(),DrawableTexture_metadata("design:type",Object)],DrawableTexture.prototype,"_data",void 0),DrawableTexture_decorate([Attributes_unserializable(),DrawableTexture_metadata("design:type",Object)],DrawableTexture.prototype,"_structureDirty",void 0),DrawableTexture_decorate([Attributes_unserializable(),DrawableTexture_metadata("design:type",Object)],DrawableTexture.prototype,"_pixelsDirty",void 0),DrawableTexture_decorate([Attributes_unserializable(),DrawableTexture_metadata("design:type",Number)],DrawableTexture.prototype,"_bytesPerPixel",void 0),DrawableTexture=DrawableTexture_decorate([creatable(!0),referencable(!0),displayName("Drawable Texture")],DrawableTexture)}(ct),Hr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Raytracer_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Raytracer_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.worker=null}(Vr||(Vr={}));var Xr,Kr=function(t){function Raytracer(n){var r=t.call(this)||this;return r.reflections=!0,r.shadows=!0,r.shadowRadius=.6,r.shadowResolution=6,r.maxBounces=3,r._target=new K(Gr),r._projector=new v(H),r._initialized=!1,n&&r.setState(n),r}return Hr(Raytracer,t),Object.defineProperty(Raytracer.prototype,"target",{set:function(t){this._target.asset=t},enumerable:!1,configurable:!0}),Object.defineProperty(Raytracer.prototype,"projector",{set:function(t){this._projector.instance=t},enumerable:!1,configurable:!0}),Raytracer.prototype.update=function(){this._initialized||(Vr.worker?p.logWarning("Only one raytracing worker allowed, ignoring Raytracer component on Entity '"+this.entity.name):this.raytrace())},Raytracer.prototype.destroy=function(){t.prototype.destroy.call(this),this.terminate()},Raytracer.prototype.restart=function(){this.terminate(),this.raytrace()},Raytracer.prototype.raytrace=function(){var t=this._target.asset,n=this._projector.instance;if(t&&n){var r=new Worker("/dist/spider_raytracer_prod.js"),o={config:"standalone",scenePath:Dn.list()[0].templatePath,targetWidth:t.getWidth(),targetHeight:t.getHeight(),rgba:t.rgba,projector:n.serialize(),worldMatrix:this.entity.transform.worldMatrix,settings:{reflections:this.reflections,shadows:this.shadows,shadowRadius:this.shadowRadius,shadowResolution:this.shadowResolution,maxBounces:this.maxBounces}};Object.assign(o,{standaloneFiles:mt.file.temporaryGetFiles()}),r.postMessage(o),r.onmessage=function(n){n.data?t.data=new Uint8Array(n.data):(p.log("Raytracer finished."),Vr.worker=null)},Vr.worker=r,this._initialized=!0}},Raytracer.prototype.terminate=function(){this._initialized&&Vr.worker&&(p.log("Terminating Raytracer.."),Vr.worker.terminate(),Vr.worker=null,this._initialized=!1)},Raytracer_decorate([Attributes_unserializable(),Raytracer_metadata("design:type",Object)],Raytracer.prototype,"_initialized",void 0),Raytracer}(fn),Qr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Yr=function(t){function Volume(){return null!==t&&t.apply(this,arguments)||this}return Qr(Volume,t),Volume.prototype.emitPoint=function(t){return t},Volume.prototype.getCenter=function(t){return t},Volume}(z),Zr=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Jr=function(t){function ParticleShape(){return null!==t&&t.apply(this,arguments)||this}return Zr(ParticleShape,t),ParticleShape.prototype.getPositions=function(t,n,r){t[n+0]=-r,t[n+1]=-r,t[n+2]=0,t[n+3]=r,t[n+4]=-r,t[n+5]=0,t[n+6]=r,t[n+7]=r,t[n+8]=0,t[n+9]=-r,t[n+10]=-r,t[n+11]=0,t[n+12]=r,t[n+13]=r,t[n+14]=0,t[n+15]=-r,t[n+16]=r,t[n+17]=0},ParticleShape.prototype.getUvs=function(t,n){t[n+0]=0,t[n+1]=0,t[n+2]=1,t[n+3]=0,t[n+4]=1,t[n+5]=1,t[n+6]=0,t[n+7]=0,t[n+8]=1,t[n+9]=1,t[n+10]=0,t[n+11]=1},ParticleShape.prototype.makeLocalTransform=function(t,n){t.makeLookAt(n.worldForward,n.worldUp).transpose()},ParticleShape.prototype.makeParticleTransform=function(t,n){},ParticleShape.prototype.vertexCount=function(){return 6},ParticleShape.prototype.destroy=function(){},ParticleShape}(z),$r=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ParticlesGeometry_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},ParticlesGeometry_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.dataOffsets={position:0,velocity:3,color:6,life:10,remainingLife:11,size:12,active:13,MAX:14},t.getDataOffset=function getDataOffset(n,r,o){return r*t.dataOffsets.MAX+t.dataOffsets[n]+o},t.particlePos=new w,t.particleVelocity=new w,t.color=new It,t.localTransform=new A}(Xr||(Xr={}));var to,eo,ro=function(t){function ParticlesGeometry(n,r){var o=t.call(this)||this;return o._worldTransform=new A,o._worldSpace=!1,o._particleCount=0,o._maxParticles=0,o._shape=r,r&&(r.onPropertyChanged=function(t){return o.onParticleShapePropertyChanged(t)}),n&&(o._maxParticles=n),o._maxParticles&&o.initVertexBuffer(o._maxParticles),o}return $r(ParticlesGeometry,t),Object.defineProperty(ParticlesGeometry.prototype,"vb",{get:function(){return this._vb},enumerable:!1,configurable:!0}),Object.defineProperty(ParticlesGeometry.prototype,"worldSpace",{set:function(t){this._worldSpace=t},enumerable:!1,configurable:!0}),Object.defineProperty(ParticlesGeometry.prototype,"particleCount",{set:function(t){this._particleCount=t},enumerable:!1,configurable:!0}),Object.defineProperty(ParticlesGeometry.prototype,"shape",{set:function(t){var n=this;this._shape&&delete this._shape.onPropertyChanged,this._shape=t,t&&(t.onPropertyChanged=function(t){return n.onParticleShapePropertyChanged(t)}),this.initVertexBuffer(this._maxParticles)},enumerable:!1,configurable:!0}),ParticlesGeometry.prototype.destroy=function(){this._vb&&this._vb.unload(),t.prototype.destroy.call(this)},ParticlesGeometry.prototype.getVertexBuffer=function(){return this._vb},ParticlesGeometry.prototype.getWorldTransform=function(t){return this._worldTransform.copy(A.identity),this._worldSpace||(this._worldTransform.scale(t.worldScale),this._worldTransform.setPosition(t.worldPosition)),this._worldTransform},ParticlesGeometry.prototype.graphicUpdate=function(t,n){if(!this._shape)return this._vb.vertexCount=0,mr.Unchanged;var r=Xr.particlePos,o=Xr.particleVelocity,i=Xr.color,a=Xr.localTransform,c=this._vb.attributes.position,u=this._vb.attributes.color,l=0,p=0;this._shape.makeLocalTransform(a,t.entity.transform);for(var f=this._shape.vertexCount(),h=this._particleCount,d=w.fromPool(),y=0;y<this._maxParticles&&0!==h;++y){if(0!==this.getData("active",y)){this.getVector3("position",y,r),this.getVector3("velocity",y,o),this._shape.makeParticleTransform(a,o),a.setPosition(r);var m=this.getData("size",y);this._shape.getPositions(c,l,m);for(var v=0;v<f;++v){var g=3*v;d.setFromArray(c,l+g).transform(a).toArray(c,l+g)}l+=3*f,this.getColor(y,i);for(v=0;v<f;++v){u[(g=p+4*v)+0]=i.r,u[g+1]=i.g,u[g+2]=i.b,u[g+3]=i.a}p+=4*f,--h}}return this._vb.vertexCount=l/3,this._vb.dirtifyAttribute("position"),this._vb.dirtifyAttribute("color"),mr.Changed},ParticlesGeometry.prototype.initVertexBuffer=function(t){if(this._vb&&this._vb.unload(),this._vb=new Vt,this._maxParticles=t,this._interleavedData||(this._interleavedData=[]),this.resetData(t),this._shape){var n=this._shape.vertexCount();if(0!==n){var r=[];r.length=n*t,this._vb.setAttribute("position",r);var o=[];o.length=4*this._vb.vertexCount,this._vb.setAttribute("color",o);var i=[];i.length=2*this._vb.vertexCount;for(var a=0,c=0;c<t;++c)this._shape.getUvs(i,a),a+=2*n;this._vb.setAttribute("uv",i),this._vb.isDynamic=!0,this._vb.primitiveType="TRIANGLES"}}},ParticlesGeometry.prototype.resetData=function(t){var n=t*Xr.dataOffsets.MAX;this._interleavedData.length=n;for(var r=0;r<n;++r)this._interleavedData[r]=0},ParticlesGeometry.prototype.getData=function(t,n,r){var o=Xr.getDataOffset(t,n,r||0);return this._interleavedData[o]},ParticlesGeometry.prototype.setData=function(t,n,r,o){var i=Xr.getDataOffset(t,n,o||0);this._interleavedData[i]=r},ParticlesGeometry.prototype.setVector3=function(t,n,r){this.setData(t,n,r.x,0),this.setData(t,n,r.y,1),this.setData(t,n,r.z,2)},ParticlesGeometry.prototype.getVector3=function(t,n,r){r.x=this.getData(t,n,0),r.y=this.getData(t,n,1),r.z=this.getData(t,n,2)},ParticlesGeometry.prototype.setColor=function(t,n){this.setData("color",t,n.r,0),this.setData("color",t,n.g,1),this.setData("color",t,n.b,2),this.setData("color",t,n.a,3)},ParticlesGeometry.prototype.getColor=function(t,n){n.r=this.getData("color",t,0),n.g=this.getData("color",t,1),n.b=this.getData("color",t,2),n.a=this.getData("color",t,3)},ParticlesGeometry.prototype.onParticleShapePropertyChanged=function(t){this.initVertexBuffer(this._maxParticles)},ParticlesGeometry_decorate([Attributes_unserializable(),ParticlesGeometry_metadata("design:type",Vt)],ParticlesGeometry.prototype,"_vb",void 0),ParticlesGeometry_decorate([Attributes_unserializable(),ParticlesGeometry_metadata("design:type",Array)],ParticlesGeometry.prototype,"_interleavedData",void 0),ParticlesGeometry_decorate([Attributes_unserializable(),ParticlesGeometry_metadata("design:type",Object)],ParticlesGeometry.prototype,"_worldTransform",void 0),ParticlesGeometry_decorate([Attributes_unserializable(),ParticlesGeometry_metadata("design:type",Object)],ParticlesGeometry.prototype,"_worldSpace",void 0),ParticlesGeometry_decorate([Attributes_unserializable(),ParticlesGeometry_metadata("design:type",Object)],ParticlesGeometry.prototype,"_particleCount",void 0),ParticlesGeometry_decorate([Attributes_unserializable(),ParticlesGeometry_metadata("design:type",Object)],ParticlesGeometry.prototype,"_maxParticles",void 0),ParticlesGeometry_decorate([Attributes_unserializable(),ParticlesGeometry_metadata("design:type",Jr)],ParticlesGeometry.prototype,"_shape",void 0),ParticlesGeometry=ParticlesGeometry_decorate([creatable(!1),displayName("Particles"),ParticlesGeometry_metadata("design:paramtypes",[Number,Jr])],ParticlesGeometry)}(br),oo=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),BoxVolume_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},BoxVolume_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},io=function(t){function BoxVolume(n){var r=t.call(this)||this;return r.center=new w,r.extent=new w(1,1,1),n&&r.setState(n),r}return oo(BoxVolume,t),BoxVolume.prototype.emitPoint=function(t){return t.x=this.center.x+P.lerp(-this.extent.x,this.extent.x,Math.random()),t.y=this.center.y+P.lerp(-this.extent.y,this.extent.y,Math.random()),t.z=this.center.z+P.lerp(-this.extent.z,this.extent.z,Math.random()),t},BoxVolume.prototype.getCenter=function(t){return t.copy(this.center)},BoxVolume=BoxVolume_decorate([displayName("Box"),BoxVolume_metadata("design:paramtypes",[Object])],BoxVolume)}(Yr),ao=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),BillboardParticle_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},so=function(t){function BillboardParticle(){return null!==t&&t.apply(this,arguments)||this}return ao(BillboardParticle,t),BillboardParticle=BillboardParticle_decorate([displayName("Billboard")],BillboardParticle)}(Jr),co=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Particles_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Particles_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t[t.Up=0]="Up",t[t.Forward=1]="Forward",t[t.Right=2]="Right",t[t.AwayFromCenter=3]="AwayFromCenter"}(to||(to={})),function(t){var n;t.shapeWorldPos=new w,t.particlePos=new w,t.particleVelocity=new w,t.particleColor=new It,t.worldPos=new w,t.makeDirection=((n={})[to.Up]=function(t,n,r,o){return o.copy(t.worldUp)},n[to.Forward]=function(t,n,r,o){return o.copy(t.worldForward)},n[to.Right]=function(t,n,r,o){return o.copy(t.worldRight)},n[to.AwayFromCenter]=function(t,n,r,o){o.copy(n).substract(r);var i=o.length;return i>0?o.multiply(1/i):o.set(Ht.range(-1,1),Ht.range(-1,1),Ht.range(-1,1)).normalize()},n)}(eo||(eo={}));var uo,lo=function(t){function ParticleValueOverLife(n,r){var o=t.call(this)||this;return o.life=0,o.life=n||0,void 0!==r&&(o.value=r),o}return co(ParticleValueOverLife,t),ParticleValueOverLife.evaluate=function(t,n,r){var o=t.filter((function(t){return t.life>n}));if(o.length===t.length)return r&&r.copy(o[0].value),o[0].value;var i=t.filter((function(t){return t.life<=n}));console.assert(i.length>0);var a=i[i.length-1];if(i.length===t.length)return r&&r.copy(a.value),a.value;console.assert(o.length>0);var c=o[0],u=(n-a.life)/(c.life-a.life);return a.lerp(a.value,c.value,u,r)},ParticleValueOverLife.prototype.lerp=function(t,n,r,o){},ParticleValueOverLife}(z),po=function(t){function ParticleNumberOverLife(n,r){return t.call(this,n,r||0)||this}return co(ParticleNumberOverLife,t),ParticleNumberOverLife.prototype.lerp=function(t,n,r){return P.lerp(t,n,r)},ParticleNumberOverLife}(lo),fo=function(t){function ParticleColorOverLife(n,r){return t.call(this,n,r||new It)||this}return co(ParticleColorOverLife,t),ParticleColorOverLife.prototype.lerp=function(t,n,r,o){return(o||It.dummy).copy(t).lerp(n,r)},ParticleColorOverLife}(lo),ho=function(t){function Particles(n){var r=t.call(this)||this;return r.duration=6,r.isLooping=!1,r.worldSpace=!1,r.maxParticles=128,r.particlesPerSecond=30,r.life=new Xt(1,2),r.gravity=9.8,r.direction=to.Up,r.initialSpeed=new Xt(1,2),r.initialSize=new Xt(1,2),r.initialColor=new It(1,1,1,1),r._volume=new v(Yr),r._shape=new v(Jr),r._speedOverLife=new xt(po),r._sizeOverLife=new xt(po),r._colorOverLife=new xt(fo),r._group=new K(xr),r._material=new K(vr),r._particleCount=0,r._newParticlesCounter=0,r._isEmitting=!0,r._emitTime=-1,r._emitCenter=new w,n&&r.setState(n),r.onMaterialChanged=r.onMaterialChanged.bind(r),r.onGroupChanged=r.onGroupChanged.bind(r),r._material.assetChanged.attach(r.onMaterialChanged),r._group.assetChanged.attach(r.onGroupChanged),r._volume.instance||(r._volume.instance=new io),r._material.asset||(r._material.asset=Is.materials.particles),r._shape.instance||(r._shape.instance=new so),r}return co(Particles,t),Object.defineProperty(Particles.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(Particles.prototype,"visual",{get:function(){return this.entity.getComponent(zr)},enumerable:!1,configurable:!0}),Object.defineProperty(Particles.prototype,"geometry",{get:function(){return this.visual.geometry},enumerable:!1,configurable:!0}),Object.defineProperty(Particles.prototype,"volume",{set:function(t){this._volume.instance=t},enumerable:!1,configurable:!0}),Object.defineProperty(Particles.prototype,"shape",{set:function(t){this._shape.instance=t},enumerable:!1,configurable:!0}),Object.defineProperty(Particles.prototype,"speedOverLife",{set:function(t){var n=this;this._speedOverLife.clear(),t.forEach((function(t){return n._speedOverLife.grow(t)}))},enumerable:!1,configurable:!0}),Object.defineProperty(Particles.prototype,"sizeOverLife",{set:function(t){var n=this;this._sizeOverLife.clear(),t.forEach((function(t){return n._sizeOverLife.grow(t)}))},enumerable:!1,configurable:!0}),Object.defineProperty(Particles.prototype,"colorOverLife",{set:function(t){var n=this;this._colorOverLife.clear(),t.forEach((function(t){return n._colorOverLife.grow(t)}))},enumerable:!1,configurable:!0}),Object.defineProperty(Particles.prototype,"group",{set:function(t){this._group.asset=t},enumerable:!1,configurable:!0}),Object.defineProperty(Particles.prototype,"material",{set:function(t){this._material.asset=t},enumerable:!1,configurable:!0}),Particles.prototype.setParticleLife=function(t,n){this.geometry.setData("remainingLife",t,n)},Particles.prototype.setEntity=function(n){t.prototype.setEntity.call(this,n),n.getOrSetComponent(Yn),n.setComponent(zr,{geometry:new ro(this.maxParticles,this._shape.instance),material:this._material.asset,group:this._group.asset,castShadows:!1,controller:this}),this.initEmitter()},Particles.prototype.setProperty=function(n,r){t.prototype.setProperty.call(this,n,r)},Particles.prototype.destroy=function(){t.prototype.destroy.call(this),this.entity.clearComponent(zr),this._shape.instance&&this._shape.instance.destroy(),this._material.detach(),this._group.detach()},Particles.prototype.emitParticle=function(){this._volume.instance&&this._newParticlesCounter++},Particles.prototype.update=function(){var t=je.deltaTime,n=this._volume.instance,r=0;this._isEmitting&&(this._emitTime<=0&&(this.isLooping?this._emitTime+=this.duration:this._isEmitting=!1),this._isEmitting&&n&&(this._newParticlesCounter+=t*this.particlesPerSecond)),r=Math.floor(this._newParticlesCounter),this._particleCount+r>this.maxParticles&&(r=this.maxParticles-this._particleCount);for(var o=0,i=r+this._particleCount,a=eo.particlePos,c=eo.particleVelocity,u=eo.particleColor,l=0;l<this.maxParticles&&0!==i;++l){if(0===this.geometry.getData("active",l)){if(o<r){this.geometry.setData("active",l,1);var p=this.life.random();if(this.geometry.setData("life",l,p),this.geometry.setData("remainingLife",l,p),this._sizeOverLife.data.length>0){var f=lo.evaluate(this._sizeOverLife.data,0);this.geometry.setData("size",l,f)}else this.geometry.setData("size",l,this.initialSize.random());n.emitPoint(a),n.getCenter(this._emitCenter),eo.makeDirection[this.direction](this.entity.transform,a,this._emitCenter,c),c.multiply(this.initialSpeed.random()),this.worldSpace&&a.add(this.entity.transform.worldPosition),this.geometry.setVector3("position",l,a),this.geometry.setVector3("velocity",l,c),this._colorOverLife.data.length>0?(lo.evaluate(this._colorOverLife.data,0,u),this.geometry.setColor(l,u)):this.geometry.setColor(l,this.initialColor),++o,++this._particleCount,--i}}else{var h=this.geometry.getData("remainingLife",l)-t;if(h<0)this.geometry.setData("active",l,0),--this._particleCount;else{var d=1-h/(p=this.geometry.getData("life",l));if(this.geometry.getVector3("velocity",l,c),c.y+=-this.gravity*t,this.geometry.setData("velocity",l,c.y,1),this._speedOverLife.data.length>0){var y=lo.evaluate(this._speedOverLife.data,d);c.normalize().multiply(y)}if(this.geometry.getVector3("position",l,a),a.add(c.multiply(t)),this.geometry.setVector3("position",l,a),this._colorOverLife.data.length>0&&(lo.evaluate(this._colorOverLife.data,d,u),this.geometry.setColor(l,u)),this._sizeOverLife.data.length>0){f=lo.evaluate(this._sizeOverLife.data,d);this.geometry.setData("size",l,f)}this.geometry.setData("remainingLife",l,h)}--i}}this._newParticlesCounter-=r,this._isEmitting&&(this._emitTime-=t),this.geometry.particleCount=this._particleCount},Particles.prototype.checkCollisions=function(t,n,r){var o=this,i=eo.shapeWorldPos;if(t.isA(pr)){var a=t;i.copy(a.center).add(n.worldPosition),this.checkCollisionsInternal((function(t,n){sr.boxIntersectsWithSphere(a,i,n,o.geometry.getData("size",t))&&r(t)}))}else if(t.isA(ur)){var c=t;i.copy(c.center).add(n.worldPosition),this.checkCollisionsInternal((function(t,n){sr.sphereIntersectsWithSphere(i,c.radius,n,o.geometry.getData("size",t))&&r(t)}))}},Particles.prototype.upgrade=function(t,n){if(1===n){Object.assign(t.properties,{_volume:t.properties.volume,_shape:t.properties.shape,_speedOverLife:t.properties.speedOverLife,_sizeOverLife:t.properties.sizeOverLife,_colorOverLife:t.properties.colorOverLife,_group:t.properties.group,_material:t.properties.material}),delete t.properties.volume,delete t.properties.shape,delete t.properties.speedOverLife,delete t.properties.sizeOverLife,delete t.properties.colorOverLife,delete t.properties.group,delete t.properties.material,t.properties._volume.baseTypeName="Volume";var r=t.properties._volume.data.typeName;t.properties._volume.data.typeName=r+"Volume"}return t},Particles.prototype.checkCollisionsInternal=function(t){for(var n=this._particleCount,r=0;r<this.maxParticles&&0!==n;++r){if(0!==this.geometry.getData("active",r)){var o=eo.worldPos;this.geometry.getVector3("position",r,o),this.worldSpace||o.add(this.entity.transform.worldPosition),t(r,o),--n}}},Particles.prototype.initEmitter=function(){this._newParticlesCounter=0,this._particleCount=0,this._emitTime=this.duration,this._isEmitting=!0,this.geometry.worldSpace=this.worldSpace},Particles.prototype.onMaterialChanged=function(t){this.entity&&(this.visual.material=t.newAsset)},Particles.prototype.onGroupChanged=function(t){this.entity&&(this.visual.group=t.newAsset)},Particles_decorate([Attributes_enumLiterals(to),Particles_metadata("design:type",Object)],Particles.prototype,"direction",void 0),Particles_decorate([nullable(!1),Particles_metadata("design:type",Object)],Particles.prototype,"_volume",void 0),Particles_decorate([nullable(!1),Particles_metadata("design:type",Object)],Particles.prototype,"_shape",void 0),Particles_decorate([Attributes_unserializable(),Particles_metadata("design:type",Object)],Particles.prototype,"_particleCount",void 0),Particles_decorate([Attributes_unserializable(),Particles_metadata("design:type",Object)],Particles.prototype,"_newParticlesCounter",void 0),Particles_decorate([Attributes_unserializable(),Particles_metadata("design:type",Object)],Particles.prototype,"_isEmitting",void 0),Particles_decorate([Attributes_unserializable(),Particles_metadata("design:type",Object)],Particles.prototype,"_emitTime",void 0),Particles_decorate([Attributes_unserializable(),Particles_metadata("design:type",Object)],Particles.prototype,"_emitCenter",void 0),Particles=Particles_decorate([helpUrl("https://docs.spiderengine.io/3d/particles.html"),Particles_metadata("design:paramtypes",[Object])],Particles)}(fn),yo=function(){function AnimationSystem(){}return AnimationSystem.update=function(t){t.forEach((function(t){t.animations.forEach((function(n){var r=n.animation;if(r){if(!n.isPlaying){if(!n.autoPlayStatus)return;bn.playAnimation(t.entity,n),n.autoPlayStatus=!1}var o=je.smoothDeltaTime*n.speed;n.localTime+=o,n.playTime+=o,bn.applyAnimation(r,t.entity,n.localTime,n.playTime,n.targets),n.localTime<r.duration||(n.loopCount>0?(++n.playCount,n.playCount===n.loopCount?(t.animationFinished.post(r.name),n.isPlaying=!1):n.localTime-=r.duration):n.stopRequested?(t.animationFinished.post(r.name),n.isPlaying=!1):n.localTime-=r.duration)}}))}))},AnimationSystem}(),mo=r(2),vo=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),PhysicsContext_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},PhysicsContext_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t[t.Naive=0]="Naive",t[t.Grid=1]="Grid",t[t.SAP=2]="SAP"}(uo||(uo={}));var go,_o,bo,wo=function(){function PhysicsBroadPhaseFactory(){}return PhysicsBroadPhaseFactory.create=function(t){switch(t){case uo.Grid:return new mo.GridBroadphase;case uo.SAP:return new mo.SAPBroadphase;default:return new mo.NaiveBroadphase}},PhysicsBroadPhaseFactory}(),xo=function(t){function PhysicsContext(){var n=null!==t&&t.apply(this,arguments)||this;return n._gravity=new w(0,-9.8,0),n._broadPhase=uo.Naive,n._solverIterations=10,n}return vo(PhysicsContext,t),Object.defineProperty(PhysicsContext.prototype,"broadPhase",{set:function(t){this._broadPhase=t,this._world&&(this._world.broadphase=wo.create(this._broadPhase))},enumerable:!1,configurable:!0}),Object.defineProperty(PhysicsContext.prototype,"gravity",{set:function(t){this._gravity=t,this._world&&this._world.gravity.set(this._gravity.x,this._gravity.y,this._gravity.z)},enumerable:!1,configurable:!0}),Object.defineProperty(PhysicsContext.prototype,"solverIterations",{set:function(t){this._solverIterations=t,this._world&&(this._world.solver.iterations=this._solverIterations)},enumerable:!1,configurable:!0}),Object.defineProperty(PhysicsContext.prototype,"world",{get:function(){return this._world},set:function(t){this._world=t},enumerable:!1,configurable:!0}),PhysicsContext.prototype.update=function(){this._world||(this._world=new mo.World,this._world.gravity.set(this._gravity.x,this._gravity.y,this._gravity.z),this._world.broadphase=wo.create(this._broadPhase),this._world.solver.iterations=this._solverIterations,this._world.defaultContactMaterial.contactEquationStiffness=1e9,this._world.defaultContactMaterial.contactEquationRelaxation=4,this.beginContact=this.beginContact.bind(this),this.endContact=this.endContact.bind(this),this._world.addEventListener("beginContact",this.beginContact),this._world.addEventListener("endContact",this.endContact)),this._world.step(1/60,je.deltaTime,3)},PhysicsContext.prototype.destroy=function(){this._world&&(this._world.removeEventListener("beginContact",this.beginContact),this._world.removeEventListener("endContact",this.endContact))},PhysicsContext.prototype.beginContact=function(t){},PhysicsContext.prototype.endContact=function(t){},PhysicsContext_decorate([Attributes_enumLiterals(uo),PhysicsContext_metadata("design:type",Object)],PhysicsContext.prototype,"_broadPhase",void 0),PhysicsContext_decorate([Attributes_unserializable(),PhysicsContext_metadata("design:type",mo.World)],PhysicsContext.prototype,"_world",void 0),PhysicsContext}(fn),Po=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Oo=function(t){function PlaneCollisionShape(){return null!==t&&t.apply(this,arguments)||this}return Po(PlaneCollisionShape,t),PlaneCollisionShape.prototype.checkCollisions=function(t,n,r,o){},PlaneCollisionShape}(or),Co=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),RigidBody_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},RigidBody_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},So=function(){function PhysicsShapeFactory(){}return PhysicsShapeFactory.create=function(t,n){var r=n.scale;if(t.isA(pr)){var o=t,i=new mo.Vec3(o.extent.x*r.x,o.extent.y*r.y,o.extent.z*r.z);return{shape:new mo.Box(i),offset:o.center}}if(t.isA(ur)){var a=t;return{shape:new mo.Sphere(a.radius*r.x),offset:a.center}}return t.isA(Oo)?{shape:new mo.Plane,offset:n.worldPosition}:null},PhysicsShapeFactory}();(_o=go||(go={}))[_o.Static=mo.Body.STATIC]="Static",_o[_o.Dynamic=mo.Body.DYNAMIC]="Dynamic",_o[_o.Kinematic=mo.Body.KINEMATIC]="Kinematic",function(t){t.applyRigidBodyToTransform=function applyRigidBodyToTransform(t,n,r){var o=t.x,i=t.y,a=t.z;r.position.set(o,i,a),o=n.x,i=n.y,a=n.z;var c=n.w;r.rotation.set(o,i,a,c)}}(bo||(bo={}));var Ao,Eo,jo,To=function(t){function RigidBody(){var n=null!==t&&t.apply(this,arguments)||this;return n._mass=1,n._type=go.Dynamic,n._cannonPlaneRotationAdjustment=!1,n}return Co(RigidBody,t),Object.defineProperty(RigidBody.prototype,"mass",{get:function(){return this._mass},set:function(t){t<=0?(t=0,this._type=go.Static):this._type===go.Static&&(this._type=go.Dynamic),this._mass=t,this._rigidBody&&(this._rigidBody.mass=t,this._rigidBody.type=this._type)},enumerable:!1,configurable:!0}),Object.defineProperty(RigidBody.prototype,"body",{get:function(){return this._rigidBody},enumerable:!1,configurable:!0}),Object.defineProperty(RigidBody.prototype,"type",{set:function(t){this._type=t,t===go.Static?this._mass=0:this._mass<=0&&(this._mass=1),this._rigidBody&&(this._rigidBody.mass=this._mass,this._rigidBody.type=this._type)},enumerable:!1,configurable:!0}),RigidBody.prototype.update=function(t){var n=this.entity.transform;if(this._rigidBody)this._type===go.Static?this.applyTransformToRigidBody(n,this._rigidBody.position,this._rigidBody.quaternion):bo.applyRigidBodyToTransform(this._rigidBody.position,this._rigidBody.quaternion,n);else{this._rigidBody=new mo.Body,this._rigidBody.mass=this._mass,this._rigidBody.type=this._type;var r=this.entity.getComponent(hr);if(r)for(var o=0,i=r.shapes;o<i.length;o++){var a=i[o];if(a){var c=So.create(a,this.entity.transform);if(c){var u=c.offset,l=u.x,p=u.y,f=u.z;this._rigidBody.addShape(c.shape,new mo.Vec3(l,p,f)),a.isA(Oo)&&(this._cannonPlaneRotationAdjustment=!0)}}}this.applyTransformToRigidBody(n,this._rigidBody.position,this._rigidBody.quaternion),t.world.addBody(this._rigidBody),this._rigidBody.addEventListener("collide",this.onCollision)}},RigidBody.prototype.destroy=function(){if(this._rigidBody){this._rigidBody.removeEventListener("collide",this.onCollision);var t=this.entity.getAncestorOfType(xo);t&&t.world.remove(this._rigidBody)}},RigidBody.prototype.onCollision=function(t){},RigidBody.prototype.applyTransformToRigidBody=function(t,n,r){var o=t.position,i=o.x,a=o.y,c=o.z;n.set(i,a,c);var u=t.rotation;this._cannonPlaneRotationAdjustment&&(u=kt.fromPool().copy(u).multiply(kt.fromPool().setFromAxisAngle(w.right,-Math.PI/2)));i=u.x,a=u.y,c=u.z;var l=u.w;r.set(i,a,c,l)},RigidBody_decorate([Attributes_enumLiterals(go),RigidBody_metadata("design:type",Object)],RigidBody.prototype,"_type",void 0),RigidBody_decorate([Attributes_unserializable(),RigidBody_metadata("design:type",mo.Body)],RigidBody.prototype,"_rigidBody",void 0),RigidBody_decorate([Attributes_unserializable(),RigidBody_metadata("design:type",Object)],RigidBody.prototype,"_cannonPlaneRotationAdjustment",void 0),RigidBody}(fn);!function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right",t[t.Stretch=3]="Stretch"}(Ao||(Ao={})),function(t){t[t.Top=0]="Top",t[t.Center=1]="Center",t[t.Bottom=2]="Bottom",t[t.Stretch=3]="Stretch"}(Eo||(Eo={})),function(t){t[t.Left=0]="Left",t[t.Center=1]="Center",t[t.Right=2]="Right"}(jo||(jo={}));var Ro,Bo=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Layout_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Layout_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Mo=function(t){function Layout(n){var r=t.call(this)||this;return r._horizontalAlignment=Ao.Left,r._verticalAlignment=Eo.Top,r._pivot=new h,r._offset=new w,r._width=new Nt,r._height=new Nt,r._margin=new Ut,r._rotation=new kt,r._scale=new h(1,1),r._tint=new It(1,1,1,1),r._inheritTint=!0,r._worldMatrix=new A,r._actualWidth=0,r._actualHeight=0,r._finalTint=new It(1,1,1,1),n&&r.setState(n),r}return Bo(Layout,t),Object.defineProperty(Layout.prototype,"version",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"offset",{get:function(){return this._offset},set:function(t){this._offset.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"pivot",{get:function(){return this._pivot},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"width",{get:function(){return this._width},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"height",{get:function(){return this._height},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"horizontalAlignment",{get:function(){return this._horizontalAlignment},set:function(t){this._horizontalAlignment=t},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"verticalAlignment",{get:function(){return this._verticalAlignment},set:function(t){this._verticalAlignment=t},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"margin",{get:function(){return this._margin},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"rotation",{get:function(){return this._rotation},set:function(t){this._rotation.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"tint",{get:function(){return this._tint},set:function(t){this._tint.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"inheritTint",{get:function(){return this._inheritTint},set:function(t){this._inheritTint=t},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"actualWidth",{get:function(){return this._actualWidth},set:function(t){this._actualWidth=t},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"actualHeight",{get:function(){return this._actualHeight},set:function(t){this._actualHeight=t},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"worldMatrix",{get:function(){return this._worldMatrix},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"finalTint",{get:function(){return this._finalTint},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"right",{get:function(){return this._worldMatrix.decompose(w.dummy,kt.dummy,w.dummy),w.fromPool().copy(w.right).rotate(kt.dummy).normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"forward",{get:function(){return this._worldMatrix.decompose(w.dummy,kt.dummy,w.dummy),w.fromPool().copy(w.forward).rotate(kt.dummy).normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"up",{get:function(){return this._worldMatrix.decompose(w.dummy,kt.dummy,w.dummy),w.fromPool().copy(w.up).rotate(kt.dummy).normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"localRight",{get:function(){return w.fromPool().copy(w.right).rotate(this.rotation).normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"localForward",{get:function(){return w.fromPool().copy(w.forward).rotate(this.rotation).normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"localUp",{get:function(){return w.fromPool().copy(w.up).rotate(this.rotation).normalize()},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"absoluteScale",{get:function(){return this.worldMatrix.getScale(w.fromPool())},enumerable:!1,configurable:!0}),Object.defineProperty(Layout.prototype,"absolutePos",{get:function(){return w.fromPool().setFromMatrix(this.worldMatrix)},enumerable:!1,configurable:!0}),Layout.prototype.upgrade=function(t,n){return 1===n?(t.properties.offset=t.properties.position,delete t.properties.position):2===n&&(Object.assign(t.properties,{_horizontalAlignment:t.properties.horizontalAlignment,_verticalAlignment:t.properties.verticalAlignment,_pivot:t.properties.pivot,_offset:t.properties.offset,_width:t.properties.width,_height:t.properties.height,_margin:t.properties.margin,_rotation:t.properties.rotation,_scale:t.properties.scale}),delete t.properties.horizontalAlignment,delete t.properties.verticalAlignment,delete t.properties.pivot,delete t.properties.offset,delete t.properties.width,delete t.properties.height,delete t.properties.margin,delete t.properties.rotation,delete t.properties.scale),t},Layout.horizontalAlignmentPropertyKey="_horizontalAlignment",Layout.verticalAlignmentPropertyKey="_verticalAlignment",Layout.rotationKey="_rotation",Layout.offsetKey="_offset",Layout.scaleKey="_scale",Layout_decorate([Attributes_enumLiterals(Ao),Layout_metadata("design:type",Object)],Layout.prototype,"_horizontalAlignment",void 0),Layout_decorate([Attributes_enumLiterals(Eo),Layout_metadata("design:type",Object)],Layout.prototype,"_verticalAlignment",void 0),Layout_decorate([Attributes_unserializable(),Layout_metadata("design:type",Object)],Layout.prototype,"_worldMatrix",void 0),Layout_decorate([Attributes_unserializable(),Layout_metadata("design:type",Object)],Layout.prototype,"_actualWidth",void 0),Layout_decorate([Attributes_unserializable(),Layout_metadata("design:type",Object)],Layout.prototype,"_actualHeight",void 0),Layout_decorate([Attributes_unserializable(),Layout_metadata("design:type",Object)],Layout.prototype,"_finalTint",void 0),Layout=Layout_decorate([mandatory(),sortOrder(0),helpUrl("https://docs.spiderengine.io/2d/layout.html"),Layout_metadata("design:paramtypes",[Object])],Layout)}(fn);!function(t){t.integerPixels=!0}(Ro||(Ro={}));var Io,zo=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Sprite_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Sprite_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t[t.Stretch=0]="Stretch",t[t.Tile=1]="Tile"}(Io||(Io={}));var ko,Do=function(t){function Sprite(){var n=null!==t&&t.apply(this,arguments)||this;return n.texture=new K(Fe),n.borderSize=new h,n.renderMode=Io.Stretch,n.borderMode=Io.Stretch,n}return zo(Sprite,t),Sprite.prototype.destroy=function(){this.texture.detach(),t.prototype.destroy.call(this)},Sprite.prototype.isLoaded=function(){return Y.isAssetRefLoaded(this.texture)},Sprite.prototype.tesselateInPixelsUnits=function(t,n,r,o,i){var a=this.texture.asset;a&&this.tesselateInternal(t,o,i,a.getWidth(),a.getHeight(),this.borderSize.x,this.borderSize.y,n,r)},Sprite.prototype.tesselateInWorldUnits=function(t){var n=this.texture.asset;n&&this.tesselateInternal(t,1,1,1,1,this.borderSize.x/n.getWidth(),this.borderSize.y/n.getHeight(),0,0)},Sprite.prototype.tesselateInternal=function(t,n,r,o,i,a,c,u,l){var p=8,f=0,h=0;if(this.renderMode===Io.Tile){var d=(n-2*a)/(O=o-2*a),y=Math.floor(d);h=y,d-y>0&&++h;var m=(r-2*c)/(C=i-2*c),v=Math.floor(m);f=v,m-v>0&&++f,h=Math.max(h,1),p+=(f=Math.max(f,1))*h}else p++;var g=6*p,_=t.attributes.position;_.length=3*g;var b=t.attributes.uv;b.length=2*g,t.vertexCount=g;var w=this.makeQuadPos(_,0,0,0,a,c,u,l);if(w=this.makeQuadPos(_,w,a,0,n-2*a,c,u,l),w=this.makeQuadPos(_,w,n-a,0,a,c,u,l),w=this.makeQuadPos(_,w,0,c,a,r-2*c,u,l),this.renderMode===Io.Tile)for(var x=a,P=c,O=o-2*a,C=i-2*c,S=0;S<f;++S){P+(T=C)>r-c&&(T=Math.max(r-c-P,0));for(var A=0;A<h;++A){x+(M=O)>n-a&&(M=Math.max(n-a-x,0)),w=this.makeQuadPos(_,w,x,P,M,T,u,l),x+=O}x=a,P+=C}else w=this.makeQuadPos(_,w,a,c,n-2*a,r-2*c,u,l);w=this.makeQuadPos(_,w,n-a,c,a,r-2*c,u,l),w=this.makeQuadPos(_,w,0,r-c,a,c,u,l),w=this.makeQuadPos(_,w,a,r-c,n-2*a,c,u,l),w=this.makeQuadPos(_,w,n-a,r-c,a,c,u,l),console.assert(w===3*t.vertexCount);var E=a/o,j=c/i;if(w=this.makeQuadUv(b,0,0,1,E,1-j),w=this.makeQuadUv(b,w,E,1,1-E,1-j),w=this.makeQuadUv(b,w,1-E,1,1,1-j),w=this.makeQuadUv(b,w,0,1-j,E,j),this.renderMode===Io.Tile)for(x=a,P=c,O=o-2*a,C=i-2*c,S=0;S<f;++S){var T,R=1-E,B=j;P+(T=C)>r-c&&(B+=(C-(T=r-c-P))/i);for(A=0;A<h;++A){var M;x+(M=O)>n-a&&(R-=(O-(M=n-a-x))/o),w=this.makeQuadUv(b,w,E,1-j,R,B),x+=O}x=a,P+=C}else w=this.makeQuadUv(b,w,E,1-j,1-E,j);w=this.makeQuadUv(b,w,1-E,1-j,1,j),w=this.makeQuadUv(b,w,0,j,E,0),w=this.makeQuadUv(b,w,E,j,1-E,0),w=this.makeQuadUv(b,w,1-E,j,1,0),console.assert(w===2*t.vertexCount),t.dirtifyAttribute("position"),t.dirtifyAttribute("uv")},Sprite.prototype.makeQuadPos=function(t,n,r,o,i,a,c,u){var l=r+c,p=r+i+c,f=o+u,h=o+a+u;return Ro.integerPixels&&(l=Math.floor(l),p=Math.floor(p),f=Math.floor(f),h=Math.floor(h)),t[n+0]=l,t[n+1]=f,t[n+2]=0,t[n+3]=p,t[n+4]=f,t[n+5]=0,t[n+6]=l,t[n+7]=h,t[n+8]=0,t[n+9]=l,t[n+10]=h,t[n+11]=0,t[n+12]=p,t[n+13]=f,t[n+14]=0,t[n+15]=p,t[n+16]=h,t[n+17]=0,n+18},Sprite.prototype.makeQuadUv=function(t,n,r,o,i,a){return t[n+0]=r,t[n+1]=o,t[n+2]=i,t[n+3]=o,t[n+4]=r,t[n+5]=a,t[n+6]=r,t[n+7]=a,t[n+8]=i,t[n+9]=o,t[n+10]=i,t[n+11]=a,n+12},Sprite_decorate([Attributes_enumLiterals(Io),Sprite_metadata("design:type",Object)],Sprite.prototype,"renderMode",void 0),Sprite_decorate([Attributes_enumLiterals(Io),Sprite_metadata("design:type",Object)],Sprite.prototype,"borderMode",void 0),Sprite}(nt),Fo=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),SpriteSheet_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c};!function(t){t.countTiles=function countTiles(t,n){var r=t.getWidth()/Math.max(n.x,1);return t.getHeight()/Math.max(n.y,1)*r}}(ko||(ko={}));var Lo,No=function(t){function SpriteSheet(){var n=null!==t&&t.apply(this,arguments)||this;return n._texture=new K(Fe),n._tileSize=new h(32,32),n._tileCount=4,n}return Fo(SpriteSheet,t),Object.defineProperty(SpriteSheet.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(SpriteSheet.prototype,"texture",{get:function(){return this._texture.asset},set:function(t){this._texture.asset=t,t&&(this._tileCount=ko.countTiles(t,this._tileSize))},enumerable:!1,configurable:!0}),Object.defineProperty(SpriteSheet.prototype,"tileSize",{get:function(){return this._tileSize},set:function(t){this._tileSize.copy(t),this.texture&&(this._tileCount=ko.countTiles(this.texture,this._tileSize))},enumerable:!1,configurable:!0}),Object.defineProperty(SpriteSheet.prototype,"tileCount",{get:function(){return this._tileCount},enumerable:!1,configurable:!0}),SpriteSheet.prototype.isLoaded=function(){return Y.isAssetRefLoaded(this._texture)},SpriteSheet.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_tileSize:t.properties.tileSize,_tileCount:t.properties.tileCount}),delete t.properties.tileSize,delete t.properties.tileCount),t},SpriteSheet=SpriteSheet_decorate([displayName("Sprite Sheet")],SpriteSheet)}(nt),Vo=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Mask_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Uo=function(t){function Mask(){var n=null!==t&&t.apply(this,arguments)||this;return n._texture=new K(ct),n}return Vo(Mask,t),Object.defineProperty(Mask.prototype,"texture",{get:function(){return this._texture.asset},set:function(t){this._texture.asset=t},enumerable:!1,configurable:!0}),Mask=Mask_decorate([exclusiveWith(["Image","Text","Button","CheckBox"])],Mask)}(fn),Wo=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),UIFill_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},UIFill_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},qo=function(t){function UIFill(){return null!==t&&t.apply(this,arguments)||this}return Wo(UIFill,t),UIFill.prototype.isLoaded=function(){return!0},UIFill}(z),Go=function(t){function MaterialFill(){var n=null!==t&&t.apply(this,arguments)||this;return n._material=new K(vr),n}return Wo(MaterialFill,t),Object.defineProperty(MaterialFill.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(MaterialFill.prototype,"material",{get:function(){return this._material.asset},set:function(t){this._material.asset=t},enumerable:!1,configurable:!0}),MaterialFill.prototype.isLoaded=function(){return Y.isAssetRefLoaded(this._material)},MaterialFill.prototype.destroy=function(){this._material.detach(),t.prototype.destroy.call(this)},MaterialFill.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_material:t.properties.material}),delete t.properties.material),t},MaterialFill=UIFill_decorate([displayName("Material")],MaterialFill)}(qo),Ho=function(t){function SpriteFill(n){var r=t.call(this)||this;return r.sprite=new K(Do),r._color=new It(1,1,1,1),r._isDirty=!0,r._width=0,r._height=0,r._offsetX=0,r._offsetY=0,r._renderMode=Io.Stretch,r._borderMode=Io.Stretch,n&&(r.sprite.asset=n),r}return Wo(SpriteFill,t),Object.defineProperty(SpriteFill.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(SpriteFill.prototype,"color",{get:function(){return this._color},enumerable:!1,configurable:!0}),SpriteFill.prototype.isLoaded=function(){return Y.isAssetRefLoaded(this.sprite)},SpriteFill.prototype.destroy=function(){this._vertexBuffer&&this._vertexBuffer.unload(),this.sprite.detach(),t.prototype.destroy.call(this)},SpriteFill.prototype.tesselate=function(t){this._vertexBuffer||(this._vertexBuffer=new Vt,this._vertexBuffer.isDynamic=!0,this._vertexBuffer.primitiveType="TRIANGLES",this._vertexBuffer.setAttribute("position",[]),this._vertexBuffer.setAttribute("uv",[])),t.actualWidth!==this._width&&(this._width=t.actualWidth,this._isDirty=!0),t.actualHeight!==this._height&&(this._height=t.actualHeight,this._isDirty=!0);var n=-t.pivot.x*t.actualWidth,r=-t.pivot.y*t.actualHeight;n!==this._offsetX&&(this._offsetX=n,this._isDirty=!0),r!==this._offsetY&&(this._offsetY=r,this._isDirty=!0);var o=this.sprite.asset,i=o?o.texture.asset:null;return o&&i&&(o.renderMode!==this._renderMode&&(this._renderMode=o.renderMode,this._isDirty=!0),o.borderMode!==this._borderMode&&(this._borderMode=o.borderMode,this._isDirty=!0),o.texture.id!==this._textureId&&(this._textureId=o.texture.id,this._isDirty=!0),this._isDirty&&(o.tesselateInPixelsUnits(this._vertexBuffer,n,r,t.actualWidth,t.actualHeight),this._isDirty=!1)),this._vertexBuffer},SpriteFill.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_color:t.properties.tint}),delete t.properties.tint),t},UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Vt)],SpriteFill.prototype,"_vertexBuffer",void 0),UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Object)],SpriteFill.prototype,"_isDirty",void 0),UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Object)],SpriteFill.prototype,"_width",void 0),UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Object)],SpriteFill.prototype,"_height",void 0),UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Object)],SpriteFill.prototype,"_offsetX",void 0),UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Object)],SpriteFill.prototype,"_offsetY",void 0),UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Object)],SpriteFill.prototype,"_renderMode",void 0),UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Object)],SpriteFill.prototype,"_borderMode",void 0),UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Object)],SpriteFill.prototype,"_textureId",void 0),SpriteFill=UIFill_decorate([displayName("Sprite"),UIFill_metadata("design:paramtypes",[Do])],SpriteFill)}(qo),Xo=function(t){function TextureFill(n,r){var o=t.call(this)||this;return o._color=new It(1,1,1,1),o._texture=new K(ct),o._mask=new Gt(Uo),n&&(o.texture=n),r&&o._color.copy(r),o}return Wo(TextureFill,t),Object.defineProperty(TextureFill.prototype,"version",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(TextureFill.prototype,"texture",{get:function(){return this._texture.asset},set:function(t){this._texture.asset=t},enumerable:!1,configurable:!0}),Object.defineProperty(TextureFill.prototype,"textureRef",{get:function(){return this._texture},enumerable:!1,configurable:!0}),Object.defineProperty(TextureFill.prototype,"color",{get:function(){return this._color},set:function(t){this._color.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(TextureFill.prototype,"mask",{get:function(){return this._mask.component},set:function(t){this._mask.component=t},enumerable:!1,configurable:!0}),TextureFill.prototype.isLoaded=function(){return Y.isAssetRefLoaded(this._texture)},TextureFill.prototype.destroy=function(){this._texture.detach(),t.prototype.destroy.call(this)},TextureFill.prototype.upgrade=function(t,n){return 1===n?(Object.assign(t.properties,{_texture:t.properties.texture}),delete t.properties.texture):2===n&&(Object.assign(t.properties,{_color:t.properties.tint}),delete t.properties.tint),t},TextureFill.maskPropertyKey="_mask",TextureFill=UIFill_decorate([displayName("Texture"),UIFill_metadata("design:paramtypes",[ct,It])],TextureFill)}(qo),Ko=function(t){function ColorFill(n){var r=t.call(this)||this;return r._color=new It(1,1,1,1),n&&r._color.copy(n),r}return Wo(ColorFill,t),Object.defineProperty(ColorFill.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(ColorFill.prototype,"color",{get:function(){return this._color},set:function(t){this._color.copy(t)},enumerable:!1,configurable:!0}),ColorFill.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_color:t.properties.color}),delete t.properties.color),t},ColorFill=UIFill_decorate([displayName("Color"),UIFill_metadata("design:paramtypes",[It])],ColorFill)}(qo),Qo=function(t){function SpriteSheetFill(n){var r=t.call(this)||this;return r._color=new It(1,1,1,1),r._spriteSheet=new K(No),r._currentTile=0,r._isDirty=!0,r._offsetX=0,r._offsetY=0,r._currentTesselatedTile=0,n&&(r._spriteSheet.asset=n),r}return Wo(SpriteSheetFill,t),Object.defineProperty(SpriteSheetFill.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"texture",{get:function(){return this._spriteSheet.asset?this._spriteSheet.asset.texture:null},enumerable:!1,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"tileSize",{get:function(){return this._spriteSheet.asset?this._spriteSheet.asset.tileSize:h.zero},enumerable:!1,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"currentTile",{get:function(){return this._currentTile},set:function(t){this._currentTile=t},enumerable:!1,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"spriteSheet",{get:function(){return this._spriteSheet.asset},set:function(t){this._spriteSheet.asset=t},enumerable:!1,configurable:!0}),Object.defineProperty(SpriteSheetFill.prototype,"color",{get:function(){return this._color},enumerable:!1,configurable:!0}),SpriteSheetFill.prototype.isLoaded=function(){return Y.isAssetRefLoaded(this._spriteSheet)},SpriteSheetFill.prototype.destroy=function(){this._vertexBuffer&&this._vertexBuffer.unload(),this._spriteSheet.detach(),t.prototype.destroy.call(this)},SpriteSheetFill.prototype.tesselate=function(t){this._vertexBuffer||(this._vertexBuffer=new Vt,this._vertexBuffer.isDynamic=!0,this._vertexBuffer.setAttribute("position",[0,0,0,1,0,0,0,1,0,0,1,0,1,0,0,1,1,0]),this._vertexBuffer.setAttribute("uv",[0,1,1,1,0,0,0,0,1,1,1,0]),this._vertexBuffer.primitiveType="TRIANGLES");var n=this.texture;if(n){var r=-t.pivot.x*t.actualWidth,o=-t.pivot.y*t.actualHeight;if(Ro.integerPixels&&(r=Math.floor(r),o=Math.floor(o)),r!==this._offsetX&&(this._offsetX=r,this._isDirty=!0),o!==this._offsetY&&(this._offsetY=o,this._isDirty=!0),this._currentTesselatedTile!==this._currentTile&&(this._currentTesselatedTile=this._currentTile,this._isDirty=!0),this._isDirty){var i=this._vertexBuffer.attributes.position;i[0]=0+r,i[1]=0+o,i[2]=0,i[3]=t.actualWidth+r,i[4]=0+o,i[5]=0,i[6]=0+r,i[7]=t.actualHeight+o,i[8]=0,i[9]=0+r,i[10]=t.actualHeight+o,i[11]=0,i[12]=t.actualWidth+r,i[13]=0+o,i[14]=0,i[15]=t.actualWidth+r,i[16]=t.actualHeight+o,i[17]=0;var a=n.getWidth()/Math.max(this.tileSize.x,1),c=n.getHeight()/Math.max(this.tileSize.y,1),u=Math.floor(this.currentTile/a),l=Math.round(this.currentTile)%a,p=this._vertexBuffer.attributes.uv,f=1/a,h=1/c,d=1/n.getWidth()/2*(l>0?1:0),y=1/n.getHeight()/2*(u>0?1:0);p[0]=f*l+d,p[1]=1-(h*u+y),p[2]=f*l+f-d,p[3]=1-(h*u+y),p[4]=f*l+d,p[5]=1-(h*u+h-y),p[6]=f*l+d,p[7]=1-(h*u+h-y),p[8]=f*l+f-d,p[9]=1-(h*u+y),p[10]=f*l+f-d,p[11]=1-(h*u+h-y),this._vertexBuffer.dirtifyAttribute("position"),this._vertexBuffer.dirtifyAttribute("uv"),this._isDirty=!1}}return this._vertexBuffer},SpriteSheetFill.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_color:t.properties.tint}),delete t.properties.tint),t},UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Vt)],SpriteSheetFill.prototype,"_vertexBuffer",void 0),UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Object)],SpriteSheetFill.prototype,"_isDirty",void 0),UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Object)],SpriteSheetFill.prototype,"_offsetX",void 0),UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Object)],SpriteSheetFill.prototype,"_offsetY",void 0),UIFill_decorate([Attributes_unserializable(),UIFill_metadata("design:type",Object)],SpriteSheetFill.prototype,"_currentTesselatedTile",void 0),SpriteSheetFill=UIFill_decorate([displayName("SpriteSheet"),UIFill_metadata("design:paramtypes",[No])],SpriteSheetFill)}(qo),Yo=function(t){function SpriteSheetMaterialFill(){var n=null!==t&&t.apply(this,arguments)||this;return n._material=new K(vr),n}return Wo(SpriteSheetMaterialFill,t),Object.defineProperty(SpriteSheetMaterialFill.prototype,"material",{get:function(){return this._material.asset},set:function(t){this._material.asset=t},enumerable:!1,configurable:!0}),SpriteSheetMaterialFill.prototype.isLoaded=function(){return!!t.prototype.isLoaded.call(this)&&Y.isAssetRefLoaded(this._material)},SpriteSheetMaterialFill.prototype.destroy=function(){this._material.detach(),t.prototype.destroy.call(this)},SpriteSheetMaterialFill=UIFill_decorate([displayName("SpriteSheet Material")],SpriteSheetMaterialFill)}(Qo);!function(t){t.quad=new Vt({attributes:{position:[0,0,0,1,0,0,1,1,0,0,0,0,1,1,0,0,1,0],uv:[0,0,1,0,1,1,0,0,1,1,0,1],normal:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1]},primitiveType:"TRIANGLES"}),t.centeredQuad=new Vt({attributes:{position:[-1,-1,0,1,-1,0,1,1,0,-1,-1,0,1,1,0,-1,1,0],uv:t.quad.attributes.uv,normal:t.quad.attributes.normal},primitiveType:"TRIANGLES"}),t.uiQuad=new Vt({attributes:{position:[0,0,0,0,1,0,1,0,0,0,1,0,1,1,0,1,0,0],uv:[0,1,0,0,1,1,0,0,1,0,1,1]},primitiveType:"TRIANGLES"})}(Lo||(Lo={}));var Zo,Jo=function(){function GeometryProvider(){}return Object.defineProperty(GeometryProvider,"quad",{get:function(){return Lo.quad},enumerable:!1,configurable:!0}),Object.defineProperty(GeometryProvider,"centeredQuad",{get:function(){return Lo.centeredQuad},enumerable:!1,configurable:!0}),Object.defineProperty(GeometryProvider,"uiQuad",{get:function(){return Lo.uiQuad},enumerable:!1,configurable:!0}),Object.defineProperty(GeometryProvider,"skyBox",{get:function(){if(!Lo.skyBox){var t=new Vt({attributes:{position:[-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1]},primitiveType:"TRIANGLES"});Lo.skyBox=t}return Lo.skyBox},enumerable:!1,configurable:!0}),GeometryProvider.unload=function(){Lo.centeredQuad.unload(),Lo.quad.unload(),Lo.uiQuad.unload(),Lo.skyBox&&Lo.skyBox.unload()},GeometryProvider}();!function(t){t.tint=new It,t.maskStart=new h,t.maskEnd=new h,t.getUIElementVertexBuffer=function getUIElementVertexBuffer(t){var n=Jo.uiQuad,r=n.attributes.position,o=t.actualWidth,i=t.actualHeight,a=-t.pivot.x*o,c=-t.pivot.y*i;return Ro.integerPixels&&(a=Math.floor(a),c=Math.floor(c)),r[0]=0+a,r[1]=0+c,r[2]=0,r[3]=0+a,r[4]=i+c,r[5]=0,r[6]=o+a,r[7]=0+c,r[8]=0,r[9]=0+a,r[10]=i+c,r[11]=0,r[12]=o+a,r[13]=i+c,r[14]=0,r[15]=o+a,r[16]=0+c,r[17]=0,n.dirtifyAttribute("position"),n}}(Zo||(Zo={}));var $o,ti=function(){function UIFillUtils(){}return UIFillUtils.getVertexBuffer=function(t,n){if(n){if(n.isA(Ho))return n.tesselate(t);if(n.isA(Qo))return n.tesselate(t)}return Zo.getUIElementVertexBuffer(t)},UIFillUtils.renderFill=function(t){var n=t.fill,r=t.material,o=t.vertexBuffer,i=t.modelView,a=t.tint,c=(t.context,t.screenOffset),u=t.screenPosition,l=t.screenScale;if(n.isA(Go))(A=(p=n).material)&&A.shader&&(A.queueParameter("projectionMatrix",r.getParameter("projectionMatrix")),A.queueParameter("modelViewMatrix",i),A.queueParameter("tint",a),A.queueParameter("time",je.time),A.begin()&&on.drawVertexBuffer(o,A.shader));else if(n.isA(Ko)){var p=n,f=Is.whiteTexture;r.queueParameter("useMask",!1),r.queueReferenceParameter(UIFillUtils.uiShaderTextureParam,f),r.queueParameter(UIFillUtils.uiShaderColorParam,Zo.tint.copy(p.color).multiplyColor(a)),r.begin()&&on.drawVertexBuffer(o,r.shader)}else if(n.isA(Xo)){if((p=n).texture){var h=p.mask?p.mask.texture:null;if(h){var d=mt.renderer.screenSize;r.queueParameter("useMask",!0),r.queueReferenceParameter("mask",h);var y=c.x+u.x*l,m=c.y+u.y*l,v=p.mask.entity.getComponent(Mo),g=v.absolutePos.x*l+y,_=v.absolutePos.y*l+m,b=v.actualWidth*v.absoluteScale.x*l,w=v.actualHeight*v.absoluteScale.y*l;b=b/d.x*2,w=w/d.y*2;var x=g/d.x*2-1,P=-(_/d.y*2-1),O=Zo.maskStart,C=Zo.maskEnd;O.set(x,P-w),C.set(O.x+b,O.y+w),r.queueParameter("maskStart",O),r.queueParameter("maskEnd",C)}else r.queueParameter("useMask",!1);r.queueReferenceParameter(UIFillUtils.uiShaderTextureParam,p.texture),r.queueParameter(UIFillUtils.uiShaderColorParam,Zo.tint.copy(p.color).multiplyColor(a)),r.begin()&&on.drawVertexBuffer(o,r.shader)}}else if(n.isA(Ho)){var S=(p=n).sprite.asset?p.sprite.asset.texture.asset:null;S&&(r.queueParameter("useMask",!1),r.queueReferenceParameter(UIFillUtils.uiShaderTextureParam,S),r.queueParameter(UIFillUtils.uiShaderColorParam,Zo.tint.copy(p.color).multiplyColor(a)),r.begin()&&on.drawVertexBuffer(o,r.shader))}else if(n.isA(Yo)){var A;(A=(p=n).material)&&A.shader&&(A.queueParameter("projectionMatrix",r.getParameter("projectionMatrix")),A.queueParameter("modelViewMatrix",i),A.queueParameter("tint",a),A.begin()&&on.drawVertexBuffer(o,A.shader))}else if(n.isA(Qo)){(p=n).texture&&(r.queueParameter("useMask",!1),r.queueReferenceParameter(UIFillUtils.uiShaderTextureParam,p.texture),r.queueParameter(UIFillUtils.uiShaderColorParam,Zo.tint.copy(p.color).multiplyColor(a)),r.begin()&&on.drawVertexBuffer(o,r.shader))}},UIFillUtils.getFillSize=function(t,n){if(t.isA(Xo))return(f=t.texture)?n?f.getWidth():f.getHeight():0;if(t.isA(Ho)){var r=t;return(f=r.sprite.asset?r.sprite.asset.texture.asset:null)?n?f.getWidth():f.getHeight():0}if(t.isA(Qo)){var o=t;return n?o.tileSize.x:o.tileSize.y}if(t.isA(Go)){var i=t.material,a=i?i.shader:void 0;if(a)for(var c=a.getUniforms(),u=i.shaderParams,l=0,p=Object.keys(c);l<p.length;l++){var f,h=p[l];if("sampler2D"===c[h].type&&h in u)return(f=u[h].asset)?n?f.getWidth():f.getHeight():0}}return 256},UIFillUtils.uiShaderTextureParam="diffuse",UIFillUtils.uiShaderColorParam="ambient",UIFillUtils}(),ei=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),UIElement_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},UIElement_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t[t.Clip=0]="Clip",t[t.Scroll=1]="Scroll"}($o||($o={}));var ni,ri=function(t){function UIElement(){var n=null!==t&&t.apply(this,arguments)||this;return n._touchInside=!1,n._touchPressed=!1,n}return ei(UIElement,t),Object.defineProperty(UIElement.prototype,"isTouchInside",{get:function(){return this._touchInside},enumerable:!1,configurable:!0}),Object.defineProperty(UIElement.prototype,"isTouchPressed",{get:function(){return this._touchPressed},enumerable:!1,configurable:!0}),UIElement.prototype.setEntity=function(n){t.prototype.setEntity.call(this,n),n.clearComponent(Yn),n.getOrSetComponent(Mo)},UIElement.prototype.getVertexBuffer=function(){return ti.getVertexBuffer(this.entity.getComponent(Mo))},UIElement.prototype.setTouchInside=function(t){this._touchInside=t},UIElement.prototype.setTouchPressed=function(t){this._touchPressed=t},UIElement_decorate([Attributes_unserializable(),UIElement_metadata("design:type",Object)],UIElement.prototype,"_touchInside",void 0),UIElement_decorate([Attributes_unserializable(),UIElement_metadata("design:type",Object)],UIElement.prototype,"_touchPressed",void 0),UIElement}(fn),oi=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ii=function(t){function Font(){return null!==t&&t.apply(this,arguments)||this}return oi(Font,t),Font.prototype.getTexture=function(){return console.assert(!1,"Calling Abstract Method"),0},Font.prototype.setText=function(t){},Font.prototype.setAlignment=function(t){},Font.prototype.getWidth=function(){return 0},Font.prototype.getHeight=function(){return 0},Font.prototype.isLoaded=function(){return!0},Font.prototype.prepareForRendering=function(t,n){},Font}(z),ai=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),FontMetrics_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},si=function(t){function FontMetrics(){var n=null!==t&&t.apply(this,arguments)||this;return n.widths={},n.cellWidth=32,n.cellHeight=32,n.textureWidth=512,n.textureHeight=256,n.startCharacter=32,n}return ai(FontMetrics,t),FontMetrics=FontMetrics_decorate([displayName("Font Metrics"),creatable(!1)],FontMetrics)}(nt),ci=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),BitmapFont_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},BitmapFont_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.wordWrap=function wordWrap(t,n,r){for(var o=[],i=n.split(" "),a="",c=0;c<i.length;c++){for(var u=a+i[c]+" ",l=0,p=0;p<u.length;++p){var f=u.charCodeAt(p);l+=t.widths[f]}l>r&&c>0?(o.push(a),a=i[c]+" "):a=u}return o.push(a),o}}(ni||(ni={}));var ui,li=function(t){function BitmapFont(){var n=null!==t&&t.apply(this,arguments)||this;return n.texture=new K(Fe),n.metrics=new K(si),n.lineHeight=16,n.spacing=0,n._isDirty=!0,n._maxWidth=0,n._width=0,n._height=0,n._pivotX=0,n._pivotY=0,n}return ci(BitmapFont,t),Object.defineProperty(BitmapFont.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),BitmapFont.prototype.getTexture=function(){return this.texture.asset},BitmapFont.prototype.getWidth=function(){return this._width},BitmapFont.prototype.getHeight=function(){return this._height},BitmapFont.prototype.setText=function(t){t!==this._text&&(this._text=t,this._isDirty=!0)},BitmapFont.prototype.setAlignment=function(t){t!==this._alignment&&(this._alignment=t,this._isDirty=!0)},BitmapFont.prototype.isLoaded=function(){return Y.isAssetRefLoaded(this.texture)&&Y.isAssetRefLoaded(this.metrics)},BitmapFont.prototype.destroy=function(){this.texture.detach(),this._vertexBuffer&&this._vertexBuffer.unload(),t.prototype.destroy.call(this)},BitmapFont.prototype.upgrade=function(t,n){return 1===n&&(t.properties.metrics.typeName="FontMetrics"),t},BitmapFont.prototype.tesselate=function(t,n){this._vertexBuffer||(this._vertexBuffer=new Vt,this._vertexBuffer.isDynamic=!0,this._vertexBuffer.primitiveType="TRIANGLES",this._vertexBuffer.setAttribute("position",[]),this._vertexBuffer.setAttribute("uv",[]));var r=this.getTexture(),o=this.metrics.asset;t!==this._pivotX&&(this._pivotX=t,this._isDirty=!0),n!==this._pivotY&&(this._pivotY=n,this._isDirty=!0);var i=this._text.split("\\n");if(this._isDirty&&r&&o&&i.length>0){if(this._maxWidth>0){for(var a=[],c=0,u=i;c<u.length;c++){var l=u[c];a=a.concat(ni.wordWrap(o,l,this._maxWidth))}this._width=this._maxWidth,this._height=this.lineHeight*a.length,this.drawText(a,this.lineHeight)}else this._height=this.lineHeight*i.length,this._width=0,this._width=this.drawText(i,this.lineHeight);this._vertexBuffer.dirtifyAttribute("position"),this._vertexBuffer.dirtifyAttribute("uv"),this._isDirty=!1}return this._vertexBuffer},BitmapFont.prototype.setProperty=function(n,r){t.prototype.setProperty.call(this,n,r),("metrics"===n||"lineHeight"===n||"spacing"===n)&&(this._isDirty||(this._isDirty=!0))},BitmapFont.prototype.prepareForRendering=function(t,n){this._maxWidth!==n&&(this._maxWidth=n,this._isDirty=!0)},BitmapFont.prototype.drawText=function(t,n){var r=this.getTexture(),o=this.metrics.asset,i=r.getWidth()/Math.max(o.cellWidth,1),a=r.getHeight()/Math.max(o.cellHeight,1),c=o.startCharacter,u=6*t.reduce((function(t,n){return t+n.length}),0);this._vertexBuffer.vertexCount=u;var l=this._vertexBuffer.attributes.position,p=this._vertexBuffer.attributes.uv;l.length=3*u,p.length=2*u;for(var f=1/i,h=1/a,d=0,y=[],m=0;m<t.length;++m){for(var v=t[m],g=0,_=0;_<v.length;++_){var b=v.charCodeAt(_);g+=C=o.widths[b],_>0&&_<this._text.length&&(g+=this.spacing)}y[m]=g,g>d&&(d=g)}var w=-this._pivotX*(this._width||d),x=-this._pivotY*(n*t.length),P=0;for(m=0;m<t.length;++m){v=t[m];var O=0;this._alignment===jo.Center?O=((this._width||d)-y[m])/2:this._alignment===jo.Right&&(O=(this._width||d)-y[m]);for(_=0;_<v.length;++_){b=v.charCodeAt(_);var C=o.widths[b],S=b-c,A=Math.floor(S/i),E=Math.round(S)%i,j=18*P,T=O,R=m*n;l[j+0]=w+T,l[j+1]=x+R,l[j+2]=0,l[j+3]=w+T+C,l[j+4]=x+R,l[j+5]=0,l[j+6]=w+T,l[j+7]=x+R+n,l[j+8]=0,l[j+9]=w+T,l[j+10]=x+R+n,l[j+11]=0,l[j+12]=w+T+C,l[j+13]=x+R,l[j+14]=0,l[j+15]=w+T+C,l[j+16]=x+R+n,l[j+17]=0;var B=C/r.getWidth(),M=n/r.getHeight();p[(j=12*P)+0]=f*E,p[j+1]=1-h*A,p[j+2]=f*E+B,p[j+3]=1-h*A,p[j+4]=f*E,p[j+5]=1-(h*A+M),p[j+6]=f*E,p[j+7]=1-(h*A+M),p[j+8]=f*E+B,p[j+9]=1-h*A,p[j+10]=f*E+B,p[j+11]=1-(h*A+M),O+=C+this.spacing,++P}}return d},BitmapFont_decorate([Attributes_unserializable(),BitmapFont_metadata("design:type",Vt)],BitmapFont.prototype,"_vertexBuffer",void 0),BitmapFont_decorate([Attributes_unserializable(),BitmapFont_metadata("design:type",String)],BitmapFont.prototype,"_text",void 0),BitmapFont_decorate([Attributes_unserializable(),BitmapFont_metadata("design:type",Object)],BitmapFont.prototype,"_isDirty",void 0),BitmapFont_decorate([Attributes_unserializable(),BitmapFont_metadata("design:type",Object)],BitmapFont.prototype,"_maxWidth",void 0),BitmapFont_decorate([Attributes_unserializable(),BitmapFont_metadata("design:type",Object)],BitmapFont.prototype,"_width",void 0),BitmapFont_decorate([Attributes_unserializable(),BitmapFont_metadata("design:type",Object)],BitmapFont.prototype,"_height",void 0),BitmapFont_decorate([Attributes_unserializable(),BitmapFont_metadata("design:type",Object)],BitmapFont.prototype,"_pivotX",void 0),BitmapFont_decorate([Attributes_unserializable(),BitmapFont_metadata("design:type",Object)],BitmapFont.prototype,"_pivotY",void 0),BitmapFont_decorate([Attributes_unserializable(),BitmapFont_metadata("design:type",Number)],BitmapFont.prototype,"_alignment",void 0),BitmapFont}(ii),pi=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),FontShadow_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},FontShadow_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},fi=function(t){function FontShadow(){var n=null!==t&&t.apply(this,arguments)||this;return n.propertyChanged=new W.AsyncEvent,n}return pi(FontShadow,t),FontShadow.prototype.applyToContext=function(t){},FontShadow_decorate([Attributes_unserializable(),FontShadow_metadata("design:type",Object)],FontShadow.prototype,"propertyChanged",void 0),FontShadow}(z),hi=function(t){function DefaultFontShadow(){var n=null!==t&&t.apply(this,arguments)||this;return n._offset=new h(1,1),n._blur=1,n._color=new It,n}return pi(DefaultFontShadow,t),Object.defineProperty(DefaultFontShadow.prototype,"offset",{set:function(t){this._offset.copy(t),this.propertyChanged.post("offset")},enumerable:!1,configurable:!0}),Object.defineProperty(DefaultFontShadow.prototype,"blur",{set:function(t){this._blur=t,this.propertyChanged.post("blur")},enumerable:!1,configurable:!0}),Object.defineProperty(DefaultFontShadow.prototype,"color",{set:function(t){this._color.copy(t),this.propertyChanged.post("color")},enumerable:!1,configurable:!0}),DefaultFontShadow.prototype.applyToContext=function(t){t.shadowOffsetX=this._offset.x,t.shadowOffsetY=this._offset.y;var n=this._color.toChromeColor(),r=n.r,o=n.g,i=n.b,a=n.a;t.shadowColor="rgba("+r+", "+o+", "+i+", "+a+")",t.shadowBlur=this._blur},DefaultFontShadow=FontShadow_decorate([displayName("Default")],DefaultFontShadow)}(fi),di=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),FontTexture_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c};!function(t){t.wordWrap=function wordWrap(t,n,r){for(var o=[],i=n.split(" "),a="",c=0;c<i.length;c++){var u=a+i[c]+" ";t.measureText(u).width>r&&c>0?(o.push(a),a=i[c]+" "):a=u}return o.push(a),o}}(ui||(ui={}));var yi,mi=function(t){function FontTexture(){var n=null!==t&&t.apply(this,arguments)||this;return n._isDirty=!0,n._maxWidth=0,n._scaleFactor=1,n._filtering=a.Nearest,n}return di(FontTexture,t),Object.defineProperty(FontTexture.prototype,"scaleFactor",{set:function(t){t!==this._scaleFactor&&(this._isDirty=!0,this._scaleFactor=t)},enumerable:!1,configurable:!0}),Object.defineProperty(FontTexture.prototype,"maxWidth",{set:function(t){t!==this._maxWidth&&(this._isDirty=!0,this._maxWidth=t)},enumerable:!1,configurable:!0}),Object.defineProperty(FontTexture.prototype,"family",{set:function(t){t!==this._fontFamily&&(this._isDirty=!0,this._fontFamily=t)},enumerable:!1,configurable:!0}),Object.defineProperty(FontTexture.prototype,"text",{set:function(t){if(t!==this._text){if(this._text=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!1,configurable:!0}),Object.defineProperty(FontTexture.prototype,"size",{set:function(t){if(t!==this._fontSize){if(this._fontSize=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!1,configurable:!0}),Object.defineProperty(FontTexture.prototype,"bold",{set:function(t){if(t!==this._bold){if(this._bold=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!1,configurable:!0}),Object.defineProperty(FontTexture.prototype,"italic",{set:function(t){if(t!==this._italic){if(this._italic=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!1,configurable:!0}),Object.defineProperty(FontTexture.prototype,"alignment",{set:function(t){if(this._alignment!==t){if(this._alignment=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!1,configurable:!0}),Object.defineProperty(FontTexture.prototype,"shadow",{set:function(t){if(this._shadow!==t){if(this._shadow=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!1,configurable:!0}),Object.defineProperty(FontTexture.prototype,"filtering",{set:function(t){if(this._filtering!==t){if(this._filtering=t,this.tryUpdateTextureInEditor())return;this._isDirty=!0}},enumerable:!1,configurable:!0}),FontTexture.prototype.dirtify=function(){this._isDirty=!0},FontTexture.prototype.getWidth=function(){var t,n;return(null!==(n=null===(t=this._canvas)||void 0===t?void 0:t.width)&&void 0!==n?n:0)/this._scaleFactor},FontTexture.prototype.getHeight=function(){var t,n;return(null!==(n=null===(t=this._canvas)||void 0===t?void 0:t.height)&&void 0!==n?n:0)/this._scaleFactor},FontTexture.prototype.begin=function(t){var n,r=at.context,o=!0;if(this._textureId){if(this._isDirty){var i;(i=null===(n=this._canvas)||void 0===n?void 0:n.getContext("2d"))&&(o=this.updateTexture(i))}}else this._canvas||(this._canvas=document.createElement("canvas")),(i=this._canvas.getContext("2d"))&&(this._textureId=r.createTexture(),o=this.updateTexture(i));return!!o&&(r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,this._textureId),!0)},FontTexture.prototype.destroy=function(){delete this._canvas,t.prototype.destroy.call(this)},FontTexture.prototype.tryUpdateTextureInEditor=function(){return!1},FontTexture.prototype.updateTexture=function(t){var n=at.context,r=this._italic?"italic ":"";r+=this._bold?"bold ":"",r+=this._fontSize*this._scaleFactor+"px "+this._fontFamily,t.font=r;var o=this._text.split("\\n");if(0===o.length)return!1;var i=this._maxWidth>0,c=this._canvas;if(i){for(var u=this._maxWidth*this._scaleFactor,l=[],p=0,f=o;p<f.length;p++){var h=f[p];l=l.concat(ui.wordWrap(t,h,u))}if(0===l.length)return!1;var d=this.getTextHeight(r,l[0]);c.width=u,c.height=d*l.length,this.drawText(t,r,l,d)}else{for(var y=t.measureText(o[0]).width,m=1;m<o.length;++m)y=Math.max(y,t.measureText(o[m]).width);if(0===y)return!1;u=y;var v=(d=this.getTextHeight(r,o[0]))*o.length;c.width=u,c.height=v,this.drawText(t,r,o,d)}return n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this._textureId),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,1),n.pixelStorei(n.UNPACK_ALIGNMENT,4),this._filtering===a.Nearest?(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST)):(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR)),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,c),this._isDirty=!1,!0},FontTexture.prototype.getTextHeight=function(t,n){var r=document.createElement("span");r.setAttribute("style","font: "+t+";"),r.textContent=n,document.body.appendChild(r);var o=r.offsetHeight;return document.body.removeChild(r),o},FontTexture.prototype.drawText=function(t,n,r,o){t.font=n,t.textBaseline="middle",t.fillStyle="white",this._shadow?this._shadow.applyToContext(t):t.shadowColor="";var i=this._canvas;t.clearRect(0,0,i.width,i.height);for(var a=Math.ceil(o/2),c=0;c<r.length;++c){var u=0;this._alignment===jo.Center?u=(i.width-t.measureText(r[c]).width)/2:this._alignment===jo.Right&&(u=i.width-t.measureText(r[c]).width),t.fillText(r[c],u,c*o+a)}},FontTexture=FontTexture_decorate([displayName("Font Texture")],FontTexture)}(ct),vi=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),FontFamily_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},FontFamily_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},gi=function(t){function FontFamily(){var n=t.call(this)||this;return n.family="Arial",n.size=14,n.bold=!1,n.italic=!1,n._shadow=new v(fi),n._filtering=a.Nearest,n.texture=new mi,n.texture.size=n.size,n.texture.family=n.family,n.texture.filtering=n._filtering,n.onShadowPropertyChanged=n.onShadowPropertyChanged.bind(n),n.shadow=new hi,n}return vi(FontFamily,t),Object.defineProperty(FontFamily.prototype,"shadow",{set:function(t){var n=this._shadow.instance;this._shadow.instance=t,n&&n.propertyChanged.detach(this.onShadowPropertyChanged),t&&t.propertyChanged.attach(this.onShadowPropertyChanged),this.texture.shadow=t},enumerable:!1,configurable:!0}),FontFamily.prototype.setText=function(t){this.texture.text=t},FontFamily.prototype.setAlignment=function(t){this.texture.alignment=t},FontFamily.prototype.getTexture=function(){return this.texture},FontFamily.prototype.getWidth=function(){return this.texture.getWidth()},FontFamily.prototype.getHeight=function(){return this.texture.getHeight()},FontFamily.prototype.setProperty=function(n,r){t.prototype.setProperty.call(this,n,r),"family"===n?this.texture.family=r:"size"===n?this.texture.size=r:"bold"===n?this.texture.bold=r:"italic"===n?this.texture.italic=r:"_shadow"===n?this.shadow=r.instance:"_filtering"===n&&(this.texture.filtering=r)},FontFamily.prototype.prepareForRendering=function(t,n){this.texture.scaleFactor=t,this.texture.maxWidth=n},FontFamily.prototype.destroy=function(){this.texture.destroy(),this._shadow.instance&&this._shadow.instance.propertyChanged.detach(this.onShadowPropertyChanged),t.prototype.destroy.call(this)},FontFamily.prototype.onShadowPropertyChanged=function(t){this.texture.dirtify()},FontFamily_decorate([Attributes_unserializable(),FontFamily_metadata("design:type",mi)],FontFamily.prototype,"texture",void 0),FontFamily_decorate([Attributes_enumLiterals(a),FontFamily_metadata("design:type",Object)],FontFamily.prototype,"_filtering",void 0),FontFamily}(ii),_i=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),UIText_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},UIText_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},bi=function(t){function Text(){var n=t.call(this)||this;return n._font=new v(ii,new gi),n.text="Empty Text",n._color=new It(1,1,1,1),n._alignment=jo.Left,n}return _i(Text,t),Object.defineProperty(Text.prototype,"version",{get:function(){return 7},enumerable:!1,configurable:!0}),Object.defineProperty(Text.prototype,"text",{get:function(){return this._text},set:function(t){this._text=t||"",this.font&&this.font.setText(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Text.prototype,"alignment",{set:function(t){this._alignment=t,this.font&&this.font.setAlignment(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Text.prototype,"color",{get:function(){return this._color},set:function(t){this._color.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(Text.prototype,"font",{get:function(){return this._font.instance},enumerable:!1,configurable:!0}),Text.prototype.setProperty=function(n,r){if(t.prototype.setProperty.call(this,n,r),"_text"===n)this.text=r;else if("_alignment"===n)this.alignment=r;else if("_font"===n){var o=r.instance;o&&(o.setText(this._text),o.setAlignment(this._alignment))}},Text.prototype.setEntity=function(n){t.prototype.setEntity.call(this,n),n.getOrSetComponent(Mo)},Text.prototype.destroy=function(){this.font&&this.font.destroy(),t.prototype.destroy.call(this)},Text.prototype.isLoaded=function(){return!!t.prototype.isLoaded.call(this)&&(!this.font||this.font.isLoaded())},Text.prototype.getVertexBuffer=function(){if(this.font&&this.font.isA(li)){var n=this.entity.getComponent(Mo);return this.font.tesselate(n.pivot.x,n.pivot.y)}return t.prototype.getVertexBuffer.call(this)},Text.prototype.upgrade=function(t,n){if(1===n)delete t.properties.font,delete t.properties.yOffset;else if(2===n)Object.assign(t.properties,{_text:t.properties.text}),delete t.properties.text;else if(3===n)Object.assign(t.properties,{font:{baseTypeName:"Font",data:{typeName:"FontFamily",properties:{family:t.properties.fontFamily}}}}),delete t.properties.fontFamily;else if(4===n)Object.assign(t.properties,{_font:t.properties.font,_bold:t.properties.bold,_italic:t.properties.italic,_tint:t.properties.tint}),Object.assign(t.properties._font.data.properties,{size:t.properties.size}),delete t.properties.font,delete t.properties.size,delete t.properties.bold,delete t.properties.italic,delete t.properties.tint;else if(5===n)Object.assign(t.properties,{_color:t.properties._tint}),delete t.properties._tint;else if(6===n){var r=t.properties._font.data;r&&"FontFamily"===r.typeName&&Object.assign(r.properties,{bold:t.properties._bold,italic:t.properties._italic}),delete t.properties._bold,delete t.properties._italic}return t},UIText_decorate([Attributes_enumLiterals(jo),UIText_metadata("design:type",Number)],Text.prototype,"_alignment",void 0),Text=UIText_decorate([helpUrl("https://docs.spiderengine.io/2d/text.html"),UIText_metadata("design:paramtypes",[])],Text)}(ri),wi=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),TouchInteractions_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},TouchInteractions_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},xi=function(t){function TouchInteractions(n){var r=t.call(this)||this;return n&&r.setState(n),r}var n;return wi(TouchInteractions,t),TouchInteractions=TouchInteractions_decorate([(n="UIElement",Reflect.metadata("requires",n)),TouchInteractions_metadata("design:paramtypes",[Object])],TouchInteractions)}(fn),Pi=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Button_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Button_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Oi=function(t){function Button(n){var r=t.call(this)||this;return r._enabled=!0,r._pushed=!1,r._normal=new v(qo),r._highlighted=new v(qo),r._pressed=new v(qo),r._disabled=new v(qo),n&&r.setState(n),r._touchInteractions=new xi({controller:r}),r}return Pi(Button,t),Object.defineProperty(Button.prototype,"version",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(Button.prototype,"normal",{get:function(){return this._normal.instance},set:function(t){this._normal.instance=t},enumerable:!1,configurable:!0}),Object.defineProperty(Button.prototype,"highlighted",{get:function(){return this._highlighted.instance},set:function(t){this._highlighted.instance=t},enumerable:!1,configurable:!0}),Object.defineProperty(Button.prototype,"pressed",{get:function(){return this._pressed.instance},set:function(t){this._pressed.instance=t},enumerable:!1,configurable:!0}),Object.defineProperty(Button.prototype,"disabled",{get:function(){return this._disabled.instance},set:function(t){this._disabled.instance=t},enumerable:!1,configurable:!0}),Object.defineProperty(Button.prototype,"pushed",{get:function(){return this._pushed},set:function(t){this._pushed=t},enumerable:!1,configurable:!0}),Object.defineProperty(Button.prototype,"enabled",{get:function(){return this._touchInteractions.active},set:function(t){this._enabled=this._touchInteractions.active=t},enumerable:!1,configurable:!0}),Object.defineProperty(Button.prototype,"currentFill",{get:function(){return this.enabled?this.isTouchPressed||this._pushed?this.pressed||this.normal:this.isTouchInside&&this.highlighted||this.normal:this.disabled||this.normal},enumerable:!1,configurable:!0}),Button.prototype.setEntity=function(n){t.prototype.setEntity.call(this,n),n.getOrSetComponent(Mo),Oa.setComponentFromInstance(n,this._touchInteractions),this._touchInteractions.active=this._enabled},Button.prototype.destroy=function(){this.entity.clearComponent(xi),t.prototype.destroy.call(this)},Button.prototype.isLoaded=function(){return!(this.normal&&!this.normal.isLoaded())&&(!(this.highlighted&&!this.highlighted.isLoaded())&&(!(this.pressed&&!this.pressed.isLoaded())&&!(this.disabled&&!this.disabled.isLoaded())))},Button.prototype.getVertexBuffer=function(){return ti.getVertexBuffer(this.entity.getComponent(Mo),this.currentFill)},Button.prototype.upgrade=function(t,n){return 1===n?(Object.assign(t.properties,{_normal:t.properties.normal,_highlighted:t.properties.highlighted,_pressed:t.properties.pressed,_disabled:t.properties.disabled}),delete t.properties.normal,delete t.properties.highlighted,delete t.properties.pressed,delete t.properties.disabled):2===n&&(Object.assign(t.properties,{_enabled:t.properties.enabled}),delete t.properties.enabled),t},Button_decorate([Attributes_unserializable(),Button_metadata("design:type",xi)],Button.prototype,"_touchInteractions",void 0),Button=Button_decorate([displayName("Button"),helpUrl("https://docs.spiderengine.io/2d/button.html"),Button_metadata("design:paramtypes",[Object])],Button)}(ri);!function(t){t.swipeThreshold=20,t.keyEvent={pressed:!1,keyCode:0},t.touchEvent={pressed:!1,x:0,y:0,swipe:!1,swipeVelocity:new h,button:0},t.initialTouchPos=new h}(yi||(yi={}));var Ci,Si=function(){function Input(){}return Object.defineProperty(Input,"touchX",{get:function(){return yi.touchEvent.x},set:function(t){yi.touchEvent.x=t},enumerable:!1,configurable:!0}),Object.defineProperty(Input,"touchY",{get:function(){return yi.touchEvent.y},set:function(t){yi.touchEvent.y=t},enumerable:!1,configurable:!0}),Input.detachAll=function(){Input.touchPressed.detach(),Input.touchMoved.detach(),Input.touchReleased.detach(),Input.wheelMoved.detach(),Input.keyChanged.detach()},Input.touchPressed=new W.SyncEvent,Input.touchMoved=new W.SyncEvent,Input.touchReleased=new W.SyncEvent,Input.wheelMoved=new W.SyncEvent,Input.keyChanged=new W.SyncEvent,Input}(),Ai=function(){function InputInternal(){}return InputInternal.create=function(t){yi.touchEvent.x=t.x,yi.touchEvent.y=t.y},Object.defineProperty(InputInternal,"keyChangedInfo",{get:function(){return yi.keyEvent},enumerable:!1,configurable:!0}),InputInternal.onTouchDown=function(t,n,r){t<0||n<0||(yi.touchEvent.pressed=!0,yi.touchEvent.swipe=!1,yi.touchEvent.x=t,yi.touchEvent.y=n,yi.touchEvent.button=r,yi.initialTouchPos.set(t,n),Si.touchPressed.post(yi.touchEvent))},InputInternal.onTouchMove=function(t,n,r){t<0||n<0||(yi.touchEvent.swipe=!1,yi.touchEvent.x=t,yi.touchEvent.y=n,yi.touchEvent.button=r,Si.touchMoved.post(yi.touchEvent))},InputInternal.onTouchUp=function(t,n,r){if(!(t<0||n<0)){var o=t-yi.initialTouchPos.x,i=n-yi.initialTouchPos.y;yi.touchEvent.pressed=!1,yi.touchEvent.swipe=Math.max(Math.abs(o),Math.abs(i))>yi.swipeThreshold,yi.touchEvent.x=t,yi.touchEvent.y=n,yi.touchEvent.swipeVelocity.set(o,i),yi.touchEvent.button=r,Si.touchReleased.post(yi.touchEvent)}},InputInternal.onMouseWheel=function(t){Si.wheelMoved.post(t)},InputInternal}(),Ei=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Image_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Image_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},ji=function(t){function Image(n){var r=t.call(this)||this;return r._fill=new v(qo),n&&r.setState(n),r}return Ei(Image,t),Object.defineProperty(Image.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(Image.prototype,"fill",{get:function(){return this._fill.instance},set:function(t){this._fill.instance=t},enumerable:!1,configurable:!0}),Image.prototype.setEntity=function(n){t.prototype.setEntity.call(this,n),n.getOrSetComponent(Mo)},Image.prototype.isLoaded=function(){return!this._fill.instance||this._fill.instance.isLoaded()},Image.prototype.getVertexBuffer=function(){return ti.getVertexBuffer(this.entity.getComponent(Mo),this._fill.instance)},Image.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_fill:t.properties.fill}),delete t.properties.fill),t},Image=Image_decorate([helpUrl("https://docs.spiderengine.io/2d/image.html"),Image_metadata("design:paramtypes",[Object])],Image)}(ri),Ti=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),CheckBox_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},CheckBox_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Ri=function(t){function CheckBox(){var n=null!==t&&t.apply(this,arguments)||this;return n.highlightColor=(new It).copy(It.white),n.pressedColor=(new It).copy(It.white),n.disabledColor=(new It).copy(It.grey),n._enabled=!0,n._isChecked=!1,n._checked=new v(qo),n._unchecked=new v(qo),n}return Ti(CheckBox,t),Object.defineProperty(CheckBox.prototype,"checked",{get:function(){return this._checked.instance},enumerable:!1,configurable:!0}),Object.defineProperty(CheckBox.prototype,"unchecked",{get:function(){return this._unchecked.instance},enumerable:!1,configurable:!0}),Object.defineProperty(CheckBox.prototype,"isChecked",{get:function(){return this._isChecked},set:function(t){this._isChecked=t},enumerable:!1,configurable:!0}),Object.defineProperty(CheckBox.prototype,"enabled",{get:function(){return this._touchInteractions.active},set:function(t){this._enabled=this._touchInteractions.active=t},enumerable:!1,configurable:!0}),Object.defineProperty(CheckBox.prototype,"currentFill",{get:function(){return this._isChecked?this.checked:this.unchecked},enumerable:!1,configurable:!0}),Object.defineProperty(CheckBox.prototype,"currentColor",{get:function(){return this.enabled?this.isTouchPressed?this.pressedColor:this.isTouchInside?this.highlightColor:It.white:this.disabledColor},enumerable:!1,configurable:!0}),CheckBox.prototype.setEntity=function(n){t.prototype.setEntity.call(this,n),this._touchInteractions=new xi({active:this._enabled,controller:this}),Oa.setComponentFromInstance(n,this._touchInteractions)},CheckBox.prototype.destroy=function(){this.entity.clearComponent(xi),t.prototype.destroy.call(this)},CheckBox.prototype.isLoaded=function(){return!(this.checked&&!this.checked.isLoaded())&&!(this.unchecked&&!this.unchecked.isLoaded())},CheckBox.prototype.getVertexBuffer=function(){return ti.getVertexBuffer(this.entity.getComponent(Mo),this.currentFill)},CheckBox.prototype.setTouchPressed=function(n){var r=this.isTouchPressed;t.prototype.setTouchPressed.call(this,n),!n&&r&&this.enabled&&(this.isChecked=!this.isChecked)},CheckBox_decorate([Attributes_unserializable(),CheckBox_metadata("design:type",xi)],CheckBox.prototype,"_touchInteractions",void 0),CheckBox}(ri),Bi=function(){function LayoutUtils(){}return LayoutUtils.getLayoutActualSize=function(t,n,r,o,i,a){var c=0;if(r)c=n-i;else if(o.type===zt.Auto){var u=t.entity.getComponent(ji);if(u&&u.fill)return ti.getFillSize(u.fill,a);var l=t.entity.getComponent(Oi);if(l&&l.currentFill)return ti.getFillSize(l.currentFill,a);var p=t.entity.getComponent(Ri);if(p&&p.currentFill)return ti.getFillSize(p.currentFill,a);var f=t.entity.getComponent(bi),h=f?f.font:null;if(h)return a?h.getWidth():h.getHeight();var d=t.entity.getComponent(Uo);if(d){var y=d.texture;return y?a?y.getWidth():y.getHeight():0}}else o.type===zt.Relative?c=n*o.value-i:o.type===zt.Absolute&&(c=o.value);return c},LayoutUtils.updateLayoutWorldMatrix=function(t,n,r){var o=n,i=o.x,a=o.y,c=t.entity.parent?t.entity.parent.getComponent(Mo):void 0,u=t.offset.x,l=t.offset.y;c&&(i=c.actualWidth,a=c.actualHeight,u-=c.pivot.x*i,l-=c.pivot.y*a),t.actualWidth=LayoutUtils.getLayoutActualSize(t,i,t.horizontalAlignment===Ao.Stretch,t.width,t.margin.left+t.margin.right,!0),t.actualHeight=LayoutUtils.getLayoutActualSize(t,a,t.verticalAlignment===Eo.Stretch,t.height,t.margin.top+t.margin.bottom,!1);var p=t.entity.parent&&!t.entity.parent.hasComponent(Mo),f=t.horizontalAlignment===Ao.Stretch;f?u+=t.margin.left:t.horizontalAlignment===Ao.Left?(u+=t.margin.left,p&&(u+=r.x)):t.horizontalAlignment===Ao.Right?(u+=i-t.margin.right,p&&(u-=r.x)):t.horizontalAlignment===Ao.Center&&(u+=i/2);var h=t.verticalAlignment===Eo.Stretch;h?l+=t.margin.top:t.verticalAlignment===Eo.Bottom?(l+=a-t.margin.bottom,p&&(l-=r.y)):t.verticalAlignment===Eo.Top?(l+=t.margin.top,p&&(l+=r.y)):t.verticalAlignment===Eo.Center&&(l+=a/2),t.worldMatrix.setRotation(t.rotation),t.worldMatrix.scaleFromCoords(t.scale.x,t.scale.y,1),t.worldMatrix.translateFromCoords(u+(f?t.pivot.x*t.actualWidth:0),l+(h?t.pivot.y*t.actualHeight:0),0),t.finalTint.copy(t.tint),c&&(t.worldMatrix.multiplyMatrices(c.worldMatrix,t.worldMatrix),t.inheritTint&&t.finalTint.multiplyColor(c.finalTint))},LayoutUtils}(),Mi=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Resolution_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Ii=function(t){function Resolution(){var n=null!==t&&t.apply(this,arguments)||this;return n.size=new h(800,600),n.adaptiveWidth=!1,n}return Mi(Resolution,t),Resolution}(z),zi=function(t){function CustomResolution(){return null!==t&&t.apply(this,arguments)||this}return Mi(CustomResolution,t),CustomResolution=Resolution_decorate([displayName("Custom")],CustomResolution)}(Ii),ki=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Screen_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Screen_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.longPressDuration=.5,t.touchMovedTreshold=3,t.tintColor=new It,t.invModelView=new A,t._2dPickingAABB=new Ft,t.localCoords=new w,t.renderOptions={tint:new It,screenOffset:new h,screenPosition:new w}}(Ci||(Ci={}));var Di,Fi,Li=function(t){function Screen(){var n=null!==t&&t.apply(this,arguments)||this;return n._resolution=new v(Ii),n._integerPixels=!0,n._cache=[],n._cacheIndex=0,n._offset=new h,n._translationX=0,n._translationY=0,n._scale=1,n._pressDuration=-1,n._initialTouchPos=new h,n._screenTransform=new A,n}return ki(Screen,t),Object.defineProperty(Screen.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(Screen.prototype,"cache",{get:function(){return this._cache},enumerable:!1,configurable:!0}),Object.defineProperty(Screen.prototype,"cacheSize",{get:function(){return this._cacheIndex},enumerable:!1,configurable:!0}),Object.defineProperty(Screen.prototype,"offset",{get:function(){return this._offset},enumerable:!1,configurable:!0}),Object.defineProperty(Screen.prototype,"translationX",{get:function(){return this._translationX},enumerable:!1,configurable:!0}),Object.defineProperty(Screen.prototype,"translationY",{get:function(){return this._translationY},enumerable:!1,configurable:!0}),Object.defineProperty(Screen.prototype,"scale",{get:function(){return this._scale},enumerable:!1,configurable:!0}),Object.defineProperty(Screen.prototype,"screenTransform",{get:function(){return this._screenTransform},enumerable:!1,configurable:!0}),Object.defineProperty(Screen.prototype,"resolution",{get:function(){return this._resolution.instance},enumerable:!1,configurable:!0}),Screen.prototype.setEntity=function(n){t.prototype.setEntity.call(this,n),n.clearComponent(Mo),n.getOrSetComponent(Yn),this.onTouchPressed=this.onTouchPressed.bind(this),this.onTouchMoved=this.onTouchMoved.bind(this),this.onTouchReleased=this.onTouchReleased.bind(this),Si.touchPressed.attach(this.onTouchPressed),Si.touchMoved.attach(this.onTouchMoved),Si.touchReleased.attach(this.onTouchReleased)},Screen.prototype.destroy=function(){Si.touchPressed.detach(this.onTouchPressed),Si.touchMoved.detach(this.onTouchMoved),Si.touchReleased.detach(this.onTouchReleased),t.prototype.destroy.call(this)},Screen.prototype.getResolution=function(t){return this.resolution?this.resolution.size:t},Screen.prototype.updateTransforms=function(){var t=this,n=mt.renderer.screenSize;this._scale=1,this._translationX=0,this._translationY=0,this._screenTransform.copy(this.entity.transform.worldMatrix);var r=this.resolution;if(r){var o=r.size.x/r.size.y;if(r.adaptiveWidth){var i=n.y*o;this._translationX=(n.x-i)/2,this._integerPixels&&(this._translationX=Math.floor(this._translationX)),this._scale=n.y/r.size.y}else{var a=n.x/o;this._translationY=(n.y-a)/2,this._integerPixels&&(this._translationY=Math.floor(this._translationY)),this._scale=n.x/r.size.x}this._screenTransform.data[12]*=this._scale,this._screenTransform.data[13]*=this._scale}this._screenTransform.scaleFromCoords(this._scale,this._scale,1),this._screenTransform.translateFromCoords(this._translationX,this._translationY,0),this._offset.x=Math.max(-this._translationX,0),this._offset.y=Math.max(-this._translationY,0),this._offset.x=this._offset.x/this._scale,this._offset.y=this._offset.y/this._scale,this._integerPixels&&(this._offset.x=Math.floor(this._offset.x),this._offset.y=Math.floor(this._offset.y)),this.entity.traverse((function(r){var o=r.getComponent(Mo);return o&&Bi.updateLayoutWorldMatrix(o,t.getResolution(n),t.offset),!0}))},Screen.prototype.update=function(){var t=this._pressDuration>=0,n=this._pressedElement;n&&t&&(this._pressDuration+=je.deltaTime,this._pressDuration>Ci.longPressDuration&&(this.onEvent(n.entity,(function(t,r){return t._target.value.entity=n.entity,t.sendSignal(t._longPress.name),t._stopPropagation.getData()})),this._pressDuration=-1))},Screen.prototype.render=function(t){var n=this,r=Ci.tintColor;this._cacheIndex=0,this.entity.traverse((function(t){return n.addToCache(t)}));var o=A.fromPool(),i=at.context,a=Ci.renderOptions;Ro.integerPixels=this._integerPixels,a.material=t,a.context=i,a.screenOffset.set(this._translationX,this._translationY),a.screenPosition.copy(this.entity.transform.worldPosition),a.screenScale=this._scale,t.queueParameter("time",je.time);for(var c=0;c<this._cacheIndex;++c){var u=this._cache[c].element,l=u.worldMatrix;this._integerPixels&&(l.data[12]=Math.floor(l.data[12]),l.data[13]=Math.floor(l.data[13]),l.data[14]=Math.floor(l.data[14])),o.multiplyMatrices(this._screenTransform,l),t.queueParameter("modelViewMatrix",o),a.modelView=o,a.tint.copy(u.finalTint);var p=u.entity.getComponent(ji);if(p){var f=p.fill;p.active&&f&&(a.fill=f,a.vertexBuffer=p.getVertexBuffer(),ti.renderFill(a))}else{var h=u.entity.getComponent(Oi);if(h){f=h.currentFill;h.active&&f&&(a.fill=f,a.vertexBuffer=h.getVertexBuffer(),ti.renderFill(a))}else{var d=u.entity.getComponent(Ri);if(d){f=d.currentFill;d.active&&f&&(a.fill=f,a.vertexBuffer=d.getVertexBuffer(),a.tint.multiplyColor(d.currentColor),ti.renderFill(a))}else{var y=u.entity.getComponent(bi);if(y){var m=y.font;if(y.active&&m){var v=0;u.width.type!==zt.Auto&&(v=u.actualWidth),m.prepareForRendering(this.scale,v),t.queueParameter("useMask",!1),t.queueReferenceParameter(ti.uiShaderTextureParam,m.getTexture()),t.queueParameter(ti.uiShaderColorParam,r.copy(y.color).multiplyColor(u.finalTint)),t.begin()&&on.drawVertexBuffer(y.getVertexBuffer(),t.shader)}}else;}}}}},Screen.prototype.upgrade=function(t,n){return 1===n&&(t.properties.useResolution&&Object.assign(t.properties,{_resolution:{baseTypeName:"Resolution",data:{typeName:"CustomResolution",version:1,properties:{size:JSON.parse(JSON.stringify(t.properties.resolution)),adaptiveWidth:t.properties.matchHeight}}}}),delete t.properties.resolution,delete t.properties.useResolution,delete t.properties.matchHeight),t},Screen.prototype.addToCache=function(t){if(!t.active)return!1;if(this._cacheIndex>=this._cache.length){var n=Math.max(32,2*this._cache.length);this._cache.length=n;for(var r=this._cacheIndex;r<n;++r)this._cache[r]={drawOrder:999999,element:Ci.dummyLayout}}var o=t.getComponent(Mo);if(o){var i=this._cache[this._cacheIndex];i.element=o,i.drawOrder=this._cacheIndex,this._cacheIndex++}return!0},Screen.prototype.onTouchPressed=function(t){var n=this;this._initialTouchPos.set(t.x,t.y),this.onTouchChanged(t);var r=this._pressedElement;r&&this.onEvent(r.entity,(function(o,i){return o._target.value.entity=r.entity,o._touchPos.getData().set((t.x-n._translationX)/n._scale,(t.y-n._translationY)/n._scale),o.sendSignal(o._touchDown.name),o._stopPropagation.getData()}))},Screen.prototype.onTouchMoved=function(t){var n=this,r=this.onTouchChanged(t);if(this._pressDuration>=0){var o=t.x-this._initialTouchPos.x,i=t.y-this._initialTouchPos.y;Math.max(Math.abs(o),Math.abs(i))>Ci.touchMovedTreshold&&(this._pressDuration=-1)}var a=this._pressedElement||r;a&&this.onEvent(a.entity,(function(r,o){return r._target.value.entity=a.entity,r._touchPos.getData().set((t.x-n._translationX)/n._scale,(t.y-n._translationY)/n._scale),r.sendSignal(r._touchMove.name),r._stopPropagation.getData()}))},Screen.prototype.onTouchReleased=function(t){var n=this;this.onTouchChanged(t);var r=this._pressedElement;if(r){var o=r.entity;this.onEvent(o,(function(r,i){return r._target.value.entity=o,r._touchPos.getData().set((t.x-n._translationX)/n._scale,(t.y-n._translationY)/n._scale),r.sendSignal(r._touchUp.name),r._stopPropagation.getData()}))}if(t.swipe&&delete this._pressedElement,r=this._pressedElement){if(r.isTouchInside){var i=r.entity;this.onEvent(i,(function(r,o){return r._target.value.entity=i,r._touchPos.getData().set((t.x-n._translationX)/n._scale,(t.y-n._translationY)/n._scale),r.sendSignal(r._click.name),r._stopPropagation.getData()}))}delete this._pressedElement}},Screen.prototype.onTouchChanged=function(t){for(var n=Ci._2dPickingAABB,r=Ci.invModelView,o=Ci.localCoords,i=!0,a=null,c=this._cacheIndex-1;c>=0;--c){var u=this._cache[c].element,l=u.entity,p=l.getComponent(xi);if(p&&p.active){var f=l.getComponent(Oi)||l.getComponent(ji)||l.getComponent(bi)||l.getComponent(Ri);if(f){var h=u.actualWidth,d=u.actualHeight;n.min.set(-u.pivot.x*h,-u.pivot.y*d,-999999),n.max.set(h-u.pivot.x*h,d-u.pivot.y*d,999999),r.multiplyMatrices(this._screenTransform,u.worldMatrix).invert(),o.set(t.x,t.y,0).transform(r),n.contains(o)?(f.isTouchInside?i||this.onElementHovered(t,f,!1):i&&(this.onElementHovered(t,f,!0),a=f),i=!1):f.isTouchInside&&(this.onElementHovered(t,f,!1),a=null),!0===t.pressed?f.isTouchInside&&!f.isTouchPressed&&(f.setTouchPressed(!0),this._pressedElement=f,this._pressDuration=0):!1===t.pressed&&f.isTouchPressed&&f.setTouchPressed(!1)}}}return a},Screen.prototype.onEvent=function(t,n){for(Oa.collectEntityOperations=!0;t;){var r=t.getComponent(Es);if(r)if(r.onUIEvent((function(r){return n(r,t)})))break;if(t===this.entity)break;t=t.parent}Oa.collectEntityOperations=!1},Screen.prototype.onElementHovered=function(t,n,r){var o=this;n.setTouchInside(r);var i=n.entity;this.onEvent(i,(function(n,a){return n._target.value.entity=i,n._touchPos.getData().set((t.x-o._translationX)/o._scale,(t.y-o._translationY)/o._scale),n.sendSignal(r?n._touchEnter.name:n._touchLeave.name),n._stopPropagation.getData()}))},Screen_decorate([displayName("Scaling"),Screen_metadata("design:type",Object)],Screen.prototype,"_resolution",void 0),Screen_decorate([Attributes_unserializable(),Attributes_hidden(),Screen_metadata("design:type",Array)],Screen.prototype,"_cache",void 0),Screen_decorate([Attributes_unserializable(),Attributes_hidden(),Screen_metadata("design:type",Object)],Screen.prototype,"_cacheIndex",void 0),Screen_decorate([Attributes_unserializable(),Screen_metadata("design:type",Object)],Screen.prototype,"_offset",void 0),Screen_decorate([Attributes_unserializable(),Screen_metadata("design:type",Object)],Screen.prototype,"_translationX",void 0),Screen_decorate([Attributes_unserializable(),Screen_metadata("design:type",Object)],Screen.prototype,"_translationY",void 0),Screen_decorate([Attributes_unserializable(),Screen_metadata("design:type",Object)],Screen.prototype,"_scale",void 0),Screen_decorate([Attributes_unserializable(),Screen_metadata("design:type",ri)],Screen.prototype,"_pressedElement",void 0),Screen_decorate([Attributes_unserializable(),Screen_metadata("design:type",Object)],Screen.prototype,"_pressDuration",void 0),Screen_decorate([Attributes_unserializable(),Screen_metadata("design:type",Object)],Screen.prototype,"_initialTouchPos",void 0),Screen_decorate([Attributes_unserializable(),Screen_metadata("design:type",Object)],Screen.prototype,"_screenTransform",void 0),Screen=Screen_decorate([helpUrl("https://docs.spiderengine.io/2d/screen.html")],Screen)}(fn),Ni=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Vi=function(t){function IKSolverBase(){var n=null!==t&&t.apply(this,arguments)||this;return n.getEntity=function(){return null},n.getEffector=function(){return null},n}return Ni(IKSolverBase,t),IKSolverBase.prototype.update=function(){},IKSolverBase}(z),Ui=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),IKEffector_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Wi=function(t){function IKEffector(){var n=null!==t&&t.apply(this,arguments)||this;return n._influence=1,n}return Ui(IKEffector,t),Object.defineProperty(IKEffector.prototype,"influence",{get:function(){return this._influence},set:function(t){this._influence=P.clamp(t,0,1)},enumerable:!1,configurable:!0}),IKEffector.prototype.setEntity=function(n){t.prototype.setEntity.call(this,n),n.getOrSetComponent(Yn)},IKEffector=IKEffector_decorate([exclusiveWith("IKSolver")],IKEffector)}(fn),qi=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Gi=function(t){function IKConstraint(){return null!==t&&t.apply(this,arguments)||this}return qi(IKConstraint,t),IKConstraint}(z),Hi=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Xi=function(t){function IKNode(){var n=null!==t&&t.apply(this,arguments)||this;return n.constraint=new v(Gi),n}return Hi(IKNode,t),IKNode}(fn),Ki=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),IKGenericSolver_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},IKGenericSolver_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Qi=r(104);!function(t){t.basis=new pe,t.dummy=new Qi.V3}(Di||(Di={})),function(t){t[t.X=0]="X",t[t.Y=1]="Y",t[t.Z=2]="Z"}(Fi||(Fi={}));var Yi,Zi=function(t){function BaseRotation(){var n=null!==t&&t.apply(this,arguments)||this;return n.axis=Fi.Y,n.angle=-90,n}return Ki(BaseRotation,t),IKGenericSolver_decorate([Attributes_enumLiterals(Fi),IKGenericSolver_metadata("design:type",Object)],BaseRotation.prototype,"axis",void 0),BaseRotation}(z),Ji=function(t){function IKGenericSolver(){var n=null!==t&&t.apply(this,arguments)||this;return n.baseRotation=new Zi,n._entity=null,n._chainTransformChanged=!1,n._effectorTransformChanged=!1,n}return Ki(IKGenericSolver,t),IKGenericSolver.prototype.update=function(){var t=this,n=this.getEntity(),r=this.getEffector();if(n&&r){if(this._ikSolver){if(this._chainTransformChanged){c=this._ikSolver.chains[0];var o=this._nodes[0].entity.transform.worldPosition;c.setBaseLocation(Di.dummy.set(o.x,o.y,o.z));for(var i=0;i<this._nodes.length-1;++i){l=this._nodes[i].entity.transform.worldPosition,p=this._nodes[i+1].entity.transform.worldPosition;c.bones[i].start.set(l.x,l.y,l.z),c.bones[i].end.set(p.x,p.y,p.z)}c.updateChainLength(),c.resetTarget()}}else{var a=[];if(n.traverse((function(t){if(t.hasComponent(ta)&&t!==n)return!1;var r=t.getComponent(Xi);return r&&r.active&&a.push(r),!0}),!0),a.length<1)return;Object.assign(window,{FIK:Qi}),this._ikSolver=new Qi.Structure3D,this._nodes=a,this._entity=n,this._chainTransformChanged=!0;for(var c=new Qi.Chain3D,u=0;u<a.length-1;++u){var l=a[u].entity.transform.worldPosition,p=a[u+1].entity.transform.worldPosition,f=new Qi.Bone3D(new Qi.V3(l.x,l.y,l.z),new Qi.V3(p.x,p.y,p.z));c.addBone(f)}this._ikSolver.add(c,new Proxy(r,{get:function(t,n){return t.entity.transform.worldPosition[n]}})),n.transform.changed.attach((function(){t._chainTransformChanged=!0})),r.entity.transform.changed.attach((function(){t._effectorTransformChanged=!0}))}if(this._chainTransformChanged||this._effectorTransformChanged){this._ikSolver.update();var h=this._ikSolver.chains[0],d=w.fromPool(),y=kt.fromPool(),m=kt.fromPool(),v=A.fromPool(),g=A.fromPool();n.transform.eventsEnabled=!1;for(u=0;u<h.numBones;++u){f=h.bones[u];d.set(f.end.x-f.start.x,f.end.y-f.start.y,f.end.z-f.start.z).normalize(),Di.basis.setFromForward(d),y.lookAt(d,Di.basis.up),0!==this.baseRotation.angle&&(m.setFromAxisAngle(t.baseRotation.axis===Fi.Y?Di.basis.up:t.baseRotation.axis===Fi.X?Di.basis.right:Di.basis.forward,P.toRadians(this.baseRotation.angle)),y.multiply(m));var _=this._nodes[u],b=_.entity.parent?_.entity.parent.transform:null;if(b){g.copy(b.worldMatrix).invert();var x=g.multiply(v.setRotation(y)).getRotation(kt.fromPool());_.entity.transform.rotation.slerp(x,r.influence)}else _.entity.transform.rotation.slerp(y,r.influence)}n.transform.eventsEnabled=!0,this._chainTransformChanged=!1,this._effectorTransformChanged=!1}}},IKGenericSolver.prototype.destroy=function(){this._entity&&this._entity.transform.changed.detach();var t=this.getEffector();t&&t.entity.transform.changed.detach()},IKGenericSolver_decorate([Attributes_unserializable(),IKGenericSolver_metadata("design:type",Object)],IKGenericSolver.prototype,"_ikSolver",void 0),IKGenericSolver_decorate([Attributes_unserializable(),IKGenericSolver_metadata("design:type",Array)],IKGenericSolver.prototype,"_nodes",void 0),IKGenericSolver_decorate([Attributes_unserializable(),IKGenericSolver_metadata("design:type",Object)],IKGenericSolver.prototype,"_entity",void 0),IKGenericSolver_decorate([Attributes_unserializable(),IKGenericSolver_metadata("design:type",Object)],IKGenericSolver.prototype,"_chainTransformChanged",void 0),IKGenericSolver_decorate([Attributes_unserializable(),IKGenericSolver_metadata("design:type",Object)],IKGenericSolver.prototype,"_effectorTransformChanged",void 0),IKGenericSolver}(Vi),$i=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ta=function(t){function IKSolver(){var n=null!==t&&t.apply(this,arguments)||this;return n._solver=new v(Vi,new Ji),n._effector=new Gt(Wi),n}return $i(IKSolver,t),Object.defineProperty(IKSolver.prototype,"effector",{get:function(){return this._effector.component},set:function(t){this._effector.component=t},enumerable:!1,configurable:!0}),Object.defineProperty(IKSolver.prototype,"solver",{set:function(t){var n=this,r=this._solver.instance;r&&Object.assign(r,{getEntity:function(){return null},getEffector:function(){return null}}),this._solver.instance=t,t&&Object.assign(t,{getEntity:function(){return n.entity},getEffector:function(){return n.effector}})},enumerable:!1,configurable:!0}),IKSolver.prototype.update=function(){var t=this._solver.instance;t&&t.update()},IKSolver.prototype.setEntity=function(n){t.prototype.setEntity.call(this,n),this.solver=this._solver.instance},IKSolver}(fn),ea=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),CharacterCollider_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},CharacterCollider_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){var n,r,o={selfIntersectionPoint:new w,intersectionPoint:new w,toIntersection:0};function detectCollision(i,a,c,u){var l=!1;o.toIntersection=999999;for(var p=function getBoxMesh(){return n||(n=Is.primitives.box.vertexBuffer),n}().attributes.position,f=function getSphereMesh(){return r||(r=Is.primitives.sphere.vertexBuffer),r}().attributes.position,h=w.fromPool(),d=w.fromPool(),y=w.fromPool(),m=le.fromPool(),v=N.fromPool(),g=w.fromPool(),_=w.fromPool(),b=w.fromPool(),x=w.fromPool(),O=w.fromPool(),C=a.length,S=0,A=u;S<A.length;S++)for(var E=A[S],j=0,T=E.shapes;j<T.length;j++){var R=T[j];if(R){var B=null,I=null,z=void 0;if(R.isA(pr))B=R,z=p;else if(R.isA(ur))I=R,z=f;else{if(!R.isA(Lr))continue;var k=R.mesh.asset;if(!k)continue;if("TRIANGLES"!==k.vertexBuffer.primitiveType)continue;if(k.vertexBuffer.indices)continue;z=k.vertexBuffer.attributes.position}for(var D=z.length/3/3,F=E.entity.transform.worldMatrix,L=0;L<D;++L){var V=9*L;if(B?(h.set(z[V]*B.extent.x+B.center.x,z[V+1]*B.extent.y+B.center.y,z[V+2]*B.extent.z+B.center.z).transform(F).divideVector(c),d.set(z[V+3]*B.extent.x+B.center.x,z[V+4]*B.extent.y+B.center.y,z[V+5]*B.extent.z+B.center.z).transform(F).divideVector(c),y.set(z[V+6]*B.extent.x+B.center.x,z[V+7]*B.extent.y+B.center.y,z[V+8]*B.extent.z+B.center.z).transform(F).divideVector(c)):I?(h.set(z[V]*I.radius+I.center.x,z[V+1]*I.radius+I.center.y,z[V+2]*I.radius+I.center.z).transform(F).divideVector(c),d.set(z[V+3]*I.radius+I.center.x,z[V+4]*I.radius+I.center.y,z[V+5]*I.radius+I.center.z).transform(F).divideVector(c),y.set(z[V+6]*I.radius+I.center.x,z[V+7]*I.radius+I.center.y,z[V+8]*I.radius+I.center.z).transform(F).divideVector(c)):(h.set(z[V],z[V+1],z[V+2]).transform(F).divideVector(c),d.set(z[V+3],z[V+4],z[V+5]).transform(F).divideVector(c),y.set(z[V+6],z[V+7],z[V+8]).transform(F).divideVector(c)),v.setFromPoints(h,d,y),v.classifyPoint(i)===M.Front){var U=v.normal.dot(a);if(!(U>0)){var W=-1,q=-1,G=v.getSignedDistance(i),H=!1;if(0!==U){if((W=(1-G)/U)>(q=(-1-G)/U)){var X=q;q=W,W=X}if(W>1||q<0)continue;W=P.clamp(W,0,1),q=P.clamp(q,0,1)}else{if(!(Math.abs(G)<1))continue;W=0,q=1,H=!0}var K=!1,Q=1;if(H||(_.copy(v.normal).flip().add(i),b.copy(a).multiply(W).add(_),m.set(h,d,y),m.contains(b)&&(K=!0,Q=W)),!K){var Y=a.lengthSq,Z=void 0,J=void 0,$=void 0;Z=Y,g.copy(i).substract(h),J=2*a.dot(g),$=g.lengthSq-1;var tt=t.getLowestRoot(Z,J,$,Q);null!==tt&&(Q=tt,K=!0,b.copy(h)),g.copy(i).substract(d),J=2*a.dot(g),$=g.lengthSq-1,null!==(tt=t.getLowestRoot(Z,J,$,Q))&&(Q=tt,K=!0,b.copy(d)),g.copy(i).substract(y),J=2*a.dot(g),$=g.lengthSq-1,null!==(tt=t.getLowestRoot(Z,J,$,Q))&&(Q=tt,K=!0,b.copy(y)),x.substractVectors(d,h),O.substractVectors(h,i);var et,nt=x.lengthSq,rt=x.dot(a),ot=x.dot(O);if(Z=nt*-Y+rt*rt,J=nt*(2*a.dot(O))-2*rt*ot,$=nt*(1-O.lengthSq)+ot*ot,null!==(tt=t.getLowestRoot(Z,J,$,Q)))(et=(rt*tt-ot)/nt)>=0&&et<=1&&(Q=tt,K=!0,b.copy(x).multiply(et).add(h));if(x.copy(y).substract(d),O.copy(d).substract(i),nt=x.lengthSq,rt=x.dot(a),ot=x.dot(O),Z=nt*-Y+rt*rt,J=nt*(2*a.dot(O))-2*rt*ot,$=nt*(1-O.lengthSq)+ot*ot,null!==(tt=t.getLowestRoot(Z,J,$,Q)))(et=(rt*tt-ot)/nt)>=0&&et<=1&&(Q=tt,K=!0,b.copy(x).multiply(et).add(d));if(x.copy(h).substract(y),O.copy(y).substract(i),nt=x.lengthSq,rt=x.dot(a),ot=x.dot(O),Z=nt*-Y+rt*rt,J=nt*(2*a.dot(O))-2*rt*ot,$=nt*(1-O.lengthSq)+ot*ot,null!==(tt=t.getLowestRoot(Z,J,$,Q)))(et=(rt*tt-ot)/nt)>=0&&et<=1&&(Q=tt,K=!0,b.copy(x).multiply(et).add(y))}if(K){var it=Q*C;it<o.toIntersection&&(o.selfIntersectionPoint.copy(_),o.intersectionPoint.copy(b),o.toIntersection=it,l=!0)}}}}}}return l?o:null}t.getLowestRoot=function getLowestRoot(t,n,r,o){var i=n*n-4*t*r;if(i<0)return null;var a=Math.sqrt(i),c=(-n-a)/(2*t),u=(-n+a)/(2*t);if(c>u){var l=u;u=c,c=l}return c>0&&c<o?c:u>0&&u<o?u:null},t.collisionDetectionAndResponse=function collisionDetectionAndResponse(t,n,r,o,i){for(var a=w.fromPool().copy(t).divideVector(r),c=w.fromPool().copy(n).divideVector(r),toWorldSpace=function(t){return t.multiplyVector(r)},u=w.fromPool().addVectors(a,c),l=N.fromPool(),p=N.fromPool(),f=w.fromPool(),h=w.fromPool(),d=w.fromPool(),y=w.fromPool(),m=w.fromPool(),v=0;v<3;++v){var g=c.length;if(P.isZero(g))return void i.copy(toWorldSpace(u));var _=detectCollision(a,c,r,o);if(!_)return void i.copy(toWorldSpace(u));f.copy(c).divide(g);var b=Math.max(_.toIntersection-.001,0);if(a.add(f.multiply(b)),0===v){h.copy(_.intersectionPoint),d.copy(a).substract(_.intersectionPoint).normalize(),l.setFromPoint(d,h);var x=l.getSignedDistance(u);u.substract(d.multiply(x-1.001)),c.substractVectors(u,a)}else if(1===v){h.copy(_.intersectionPoint),d.copy(a).substract(_.intersectionPoint).normalize(),p.setFromPoint(d,h),y.crossVectors(l.normal,p.normal).normalize();var O=m.substractVectors(u,a).dot(y);c.copy(y).multiply(O),u.addVectors(a,c)}}i.copy(toWorldSpace(a))}}(Yi||(Yi={}));var na,ra,oa=function(t){function CharacterCollider(){var n=null!==t&&t.apply(this,arguments)||this;return n._gravity=new w(0,-40,0),n._radius=new w(1,1,1),n._group=new K(Xn),n._filter=new v($n),n._velocity=new w,n._desiredVelocity=new w,n}return ea(CharacterCollider,t),Object.defineProperty(CharacterCollider.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(CharacterCollider.prototype,"gravity",{get:function(){return this._gravity},set:function(t){this._gravity.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(CharacterCollider.prototype,"radius",{get:function(){return this._radius},set:function(t){this._radius.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(CharacterCollider.prototype,"desiredVelocity",{set:function(t){this._desiredVelocity.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(CharacterCollider.prototype,"velocity",{get:function(){return this._velocity},enumerable:!1,configurable:!0}),Object.defineProperty(CharacterCollider.prototype,"group",{get:function(){return this._group.asset},enumerable:!1,configurable:!0}),CharacterCollider.prototype.update=function(t){var n=this._filter.instance,r=n?t.filter((function(t){return n.canCollideWith(t.group)})):t,o=this.entity.transform,i=o.worldPosition,a=o.worldScale,c=o.worldUp,u=w.fromPool().copy(this.radius).multiplyVector(a),l=w.fromPool().copy(c).multiply(u.y),p=w.fromPool().copy(i).add(l),f=w.fromPool(),h=w.fromPool().copy(this._velocity).projectOnVector(this._gravity),d=w.fromPool().copy(this._desiredVelocity).projectOnVector(this._gravity),y=w.fromPool().substractVectors(this._desiredVelocity,d);this._velocity.copy(y);var m=w.fromPool().copy(this._velocity).multiply(je.deltaTime);Yi.collisionDetectionAndResponse(p,m,u,r,f),d.lengthSq>0?this._velocity.copy(d):this._velocity.copy(h),this._velocity.add(w.fromPool().copy(this._gravity).multiply(je.deltaTime)),m.copy(this._velocity).multiply(je.deltaTime),p.copy(f),Yi.collisionDetectionAndResponse(p,m,u,r,f),this._velocity.substractVectors(f,p).divide(je.deltaTime),this.entity.transform.worldPosition=f.substract(l)},CharacterCollider.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_gravity:{_x:0,_y:t.properties.gravity,_z:0},_radius:t.properties.radius}),delete t.properties.gravity,delete t.properties.radius),t},CharacterCollider_decorate([Attributes_unserializable(),CharacterCollider_metadata("design:type",Object)],CharacterCollider.prototype,"_velocity",void 0),CharacterCollider_decorate([Attributes_unserializable(),CharacterCollider_metadata("design:type",Object)],CharacterCollider.prototype,"_desiredVelocity",void 0),CharacterCollider}(fn);!function(t){t.updateHook=new W.VoidSyncEvent}(na||(na={})),function(t){function iterateComponents(t,n,r){n[t.name].forEach(r)}t.update=function update(){Ee.scanGamepads();var t=dr.ofTypes([xo,Es,Pn]);iterateComponents(xo,t,(function(t){t.update(),t.entity.getComponents(To).forEach((function(n){return n.update(t)}))})),Oa.collectEntityOperations=!0,yo.update(t.AnimationComponent),iterateComponents(Es,t,(function(t){return t.update()}));try{na.updateHook.post()}catch(t){console.error("Runtime Error"),console.error(t.toString()),na.updateHook.detach()}Oa.collectEntityOperations=!1;for(var n=0,r=Oa.entitiesJustDestroyed;n<r.length;n++){var o=r[n];Oa.destroyEntity(o)}Oa.entitiesJustDestroyed.length=0;for(var i=0,a=Oa.entitiesJustCreated;i<a.length;i++){var c=(o=a[i]).getComponent(Es);c&&c.active&&c.update()}Oa.entitiesJustCreated.length=0,t=dr.ofTypes([ta,ho,Li,Kr,hr,oa]),iterateComponents(ta,t,(function(t){return t.update()})),iterateComponents(ho,t,(function(t){return t.update()})),iterateComponents(Li,t,(function(t){return t.update()})),iterateComponents(Kr,t,(function(t){return t.update()})),ln.update(t.Collider,t.CharacterCollider),Oe.incrementCurrentFrame()}}(ra||(ra={}));var ia,aa=function(){function Update(){}return Object.defineProperty(Update,"hook",{get:function(){return na.updateHook},enumerable:!1,configurable:!0}),Update}(),sa=function(){function Http(){}return Http.request=function(t){var n=t.method,r=t.url,o=t.body,i=t.responseType,a=t.headerParams,c=t.onProgress,u=t.onUploadProgress;return new Promise((function(t,l){var p=new XMLHttpRequest;if(p.onreadystatechange=function(){p.readyState===XMLHttpRequest.DONE&&(200===p.status||0===p.status?t("blob"===i?p.response:p.responseText):l(p.statusText))},i&&(p.responseType=i),c&&(p.onprogress=c),u&&(p.upload.onprogress=u),p.open(n,r,!0),a)for(var f=0,h=Object.keys(a);f<h.length;f++){var d=h[f];p.setRequestHeader(d,a[d])}p.send(o)}))},Http}();!function(t){t.transientState={}}(ia||(ia={}));var ca,ua=function(){function BehaviorAPI(){}return BehaviorAPI.api={Math:{PI:function(){return Math.PI},sin:function(t){return Math.sin(t)},cos:function(t){return Math.cos(t)},tan:function(t){return Math.tan(t)},sqrt:function(t){return Math.sqrt(t)},min:function(t,n){return Math.min(t,n)},max:function(t,n){return Math.max(t,n)},random:function(){return Math.random()},abs:function(t){return Math.abs(t)},sign:function(t){return Math.sign(t)},floor:function(t){return Math.floor(t)},ceil:function(t){return Math.ceil(t)},round:function(t){return Math.round(t)},acos:function(t){return Math.acos(t)},atan:function(t){return Math.atan(t)},atan2:function(t,n){return Math.atan2(t,n)},pow:function(t,n){return Math.pow(t,n)},exp:function(t){return Math.exp(t)},log:function(t){return Math.log(t)}},MathEx:{toRadians:function(t){return P.toRadians(t)},toDegrees:function(t){return P.toDegrees(t)},clamp:function(t,n,r){return P.clamp(t,n,r)},degreesToRadians:function(){return P.degreesToRadians},radiansToDegrees:function(){return P.radiansToDegrees},lerp:function(t,n,r){return P.lerp(t,n,r)}},console:{log:function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return p.log(t)},assert:function(t,n){return console.assert(t,n)},clear:function(){return console.clear()},logVector3:function(t){return p.logVector3(t)}},location:{reload:function(){return location.reload()}},window:{open:function(t){return window.open(t)}},JSON:{stringify:function(t){return JSON.stringify(t,null,2)},parse:function(t){return JSON.parse(t)}},Random:{range:function(t,n){return Ht.range(t,n)},rangeInt:function(t,n){return Ht.rangeInt(t,n)}},Scenes:{load:function(t,n){return Un.load(t,n)}},Assets:{load:function(t){return Gn.load(t)},loadById:function(t){return Gn.loadById(t)}},Renderer:{screenSize:function(){return mt.renderer.screenSize}},Entities:{create:function(t){return Ra.create(t)},find:function(t){return Ra.find(t)}},Gamepads:{forEach:function(t){return Re.forEach(t)},get:function(t){return Re.get(t)}},Input:{touchX:function(){return Si.touchX},touchY:function(){return Si.touchY},touchPressed:function(){return Si.touchPressed},touchMoved:function(){return Si.touchMoved},touchReleased:function(){return Si.touchReleased},wheelMoved:function(){return Si.wheelMoved},keyChanged:function(){return Si.keyChanged}},Time:{deltaTime:function(){return je.deltaTime},smoothDeltaTime:function(){return je.smoothDeltaTime},fps:function(){return je.fps},currentFrame:function(){return je.currentFrame},time:function(){return je.time}},Project:{name:function(){return xe.projectName},isOpenSource:function(){return xe.isOpenSource},importToEditor:function(){return xe.importToEditor()}},SavedData:{get:function(){return Se.get()},flush:function(){return Se.flush()}},Update:{hook:function(){return aa.hook}},Game:{state:function(){return ia.transientState}},ExecutionStatus:{Continue:function(){return dt.Continue},Finish:function(){return dt.Finish}},Vector3:{up:function(){return w.fromPool().copy(w.up)},right:function(){return w.fromPool().copy(w.right)},forward:function(){return w.fromPool().copy(w.forward)},zero:function(){return w.fromPool().copy(w.zero)},one:function(){return w.fromPool().copy(w.one)},distance:function(t,n){return w.distance(t,n)},distanceSq:function(t,n){return w.distanceSq(t,n)},fromPool:function(){return w.fromPool()}},Vector2:{zero:function(){return h.fromPool().copy(h.zero)},one:function(){return h.fromPool().copy(h.one)},fromPool:function(){return h.fromPool()}},Plane:{fromPool:function(){return N.fromPool()}},Basis:{fromMatrix:function(t){return pe.fromMatrix(t)}},Matrix44:{identity:function(){return A.fromPool().copy(A.identity)},fromPool:function(){return A.fromPool()}},Quaternion:{identity:function(){return kt.fromPool().copy(kt.identity)},fromPool:function(){return kt.fromPool()},fromEulerAngles:function(t,n,r,o){return kt.fromEulerAngles(t,n,r,o)},fromAxisAngle:function(t,n){return kt.fromAxisAngle(t,n)}},Color:{white:function(){return It.dummy.copy(It.white)},black:function(){return It.dummy.copy(It.black)}},Object:{keys:function(t){return Object.keys(t)},values:function(t){return Object.values(t)},entries:function(t){return Object.entries(t)},assign:function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];return Object.assign(t,n)}},Promise:{all:function(t){return Promise.all(t)}},HorizontalAlignment:{Left:function(){return 0},Center:function(){return 1},Right:function(){return 2},Stretch:function(){return 3}},VerticalAlignment:{Top:function(){return 0},Center:function(){return 1},Bottom:function(){return 2},Stretch:function(){return 3}},Array:{isArray:function(t){return Array.isArray(t)},from:function(t){return Array.from(t)}},Physics:{rayCast:function(t,n){return Ur.rayCast(t,n)}},Collision:{rayCastOnSphere:function(t,n,r){return t.castOnSphere(n,r)}},EngineHud:{setControls:function(t){return Ls.setControls(t)}},AABB:{fromVertexBuffer:function(t){return Ft.fromVertexBuffer(t)}},Config:{isWeb:function(){return Wr.isWeb()},isDesktop:function(){return Wr.isDesktop()},isProduction:function(){return Wr.isProduction()},isDevelopment:function(){return Wr.isDevelopment()},isEditor:function(){return Wr.isEditor()},isStandalone:function(){return Wr.isStandalone()}},Http:{request:function(t){return sa.request(t)}},Date:{now:function(){return Date.now()}}},BehaviorAPI}();!function(t){t.errors=new Map}(ca||(ca={}));var la,pa=function(){function BehaviorErrors(){}return BehaviorErrors.checkCodeBlock=function(t){},BehaviorErrors.forEach=function(t){ca.errors.forEach(t)},BehaviorErrors.clear=function(t){t?ca.errors.delete(t):ca.errors.clear()},BehaviorErrors}();!function(t){t.generateRuntimeCode=function(t){return t.sourceInfo={},""}}(la||(la={}));var fa,ha=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),CodeBlock_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},CodeBlock_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.codeProperty="_code",t.trimId=function(t){return t.split("-").join("")}}(fa||(fa={}));var da,ya=function(t){function CodeBlock(){var n=null!==t&&t.apply(this,arguments)||this;return n.pinChanged=new W.VoidSyncEvent,n._pins=new Rt(At),n._code="\nfunction onStart() {        \n    return ExecutionStatus.Continue;\n}\n\nfunction onUpdate() {\n    return ExecutionStatus.Finish;\n}\n",n._isLoaded=!1,n._isLoading=!0,n._hasCompileErrors=!1,n}return ha(CodeBlock,t),Object.defineProperty(CodeBlock.prototype,"version",{get:function(){return 7},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"pins",{get:function(){return this._pins},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"code",{get:function(){return this._code},set:function(t){this._code=t,this.clearErrors(),this._standaloneScript&&this._standaloneScript.parentNode&&this._standaloneScript.parentNode.removeChild(this._standaloneScript);try{console.assert(this.templatePath);var n=this.templatePath.replace(" ","_").replace("."+this.constructor.name,".js"),r=t;0;var o=window.location,i=o.protocol,a=o.hostname,c=o.port,u=r+"\r\n//# sourceURL="+i+"//"+a+(c&&c.length>0?":"+c:"")+"/"+n;this._standaloneScript=document.createElement("script"),this._standaloneScript.appendChild(document.createTextNode(u)),document.head.appendChild(this._standaloneScript)}catch(t){this.logRuntimeError(t.message)}finally{var l=this._isLoaded;this._isLoading=!1,this._isLoaded=!0,l||zn.assetLoaded.post(this),pa.checkCodeBlock(this)}},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"program",{get:function(){return this._program},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"hasCompileErrors",{get:function(){return this._hasCompileErrors},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"runtimeError",{get:function(){return this._runtimeError},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"functions",{get:function(){return this._functions},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlock.prototype,"isLoading",{get:function(){return this._isLoading},enumerable:!1,configurable:!0}),CodeBlock.prototype.logRuntimeError=function(t){p.logError("Error: '"+t+"' in '"+this.templatePath+"'"),this._runtimeError=[t,Date.now()]},CodeBlock.prototype.logCompileError=function(t){p.logError("Error: '"+t+"' in '"+this.templatePath+"'"),this._hasCompileErrors=!0},CodeBlock.prototype.clearRuntimeErrors=function(){delete this._runtimeError},CodeBlock.prototype.isLoaded=function(){return this._isLoaded},CodeBlock.prototype.destroy=function(){this._standaloneScript&&this._standaloneScript.parentNode&&this._standaloneScript.parentNode.removeChild(this._standaloneScript),t.prototype.destroy.call(this)},CodeBlock.prototype.setProperty=function(n,r){t.prototype.setProperty.call(this,n,r),n===fa.codeProperty&&(this.code=r)},CodeBlock.prototype.upgrade=function(t,n){return 1===n?(t.properties._code=t.properties._code.replace(/getComponent\(("|')UIImage("|')\)/g,'getComponent("Image")'),t.properties._code=t.properties._code.replace(/getComponent\(("|')UIText("|')\)/g,'getComponent("Text")')):2===n?t.properties._code=t.properties._code.replace(/Engine.createFromPrefab/g,"Engine.createEntity"):3===n?t.properties._code=t.properties._code.replace(/Engine.root(\(\))?.findChild/g,"Engine.findEntity").replace(/transform.(_value.)?(position|rotation|scale|forward|right|up)/g,(function(t,n,r){var o="transform.";return n&&(o=""+o+n),o=o+"world"+(r[0].toUpperCase()+r.substring(1))})).replace(/transform.(_value.)?local(Position|Rotation|Scale|Forward|Right|Up)/g,(function(t,n,r){var o="transform.";return n&&(o=""+o+n),o=(""+o+r).toLowerCase()})):4===n?t.properties._code=t.properties._code.replace(/Engine.deltaTime/g,"Time.deltaTime").replace(/Engine.isOpenSource/g,"Project.isOpenSource").replace(/Engine.projectName/g,"Project.name").replace(/Engine.importToEditor/g,"Project.importToEditor").replace(/Engine.readSave/g,"SavedData.get").replace(/Engine.writeSave\([a-zA-Z]+\)/g,"SavedData.flush()").replace(/Engine.createEntity\(([a-zA-Z._]+)(, ([a-zA-Z 0-9\(\),]+))?\)/g,(function(t,n,r,o){return o?"Entities.create("+n+", { position: "+o+" })":"Entities.create("+n+")"})).replace(/Engine.destroyEntity\(([a-zA-Z0-9._]+)\)/g,(function(t,n,r){return n+".destroy()"})).replace(/Engine.findEntity\((['"a-zA-Z0-9._]+)\)/g,(function(t,n,r){return"Entities.find("+n+")"})).replace(/Engine.getScreenSize\(\)/g,"Renderer.screenSize").replace(/Engine.loadScene\((['"a-zA-Z0-9_/.]+)\)/g,(function(t,n,r){return"Scenes.load("+n+")"})).replace(/Engine.loadAssetById\(([a-zA-Z0-9_.]+)\)/g,(function(t,n,r){return"Assets.loadById("+n+")"})).replace(/Engine.loadAsset\((['"a-zA-Z0-9._]+)\)/g,(function(t,n,r){return"Assets.load("+n+")"})):5===n?t.properties._code=t.properties._code.replace(/.owner./g,".entity.").replace(/.findEntities/g,".filterChildren").replace(/getComponent\(["']([a-zA-Z]+)["']\)/g,(function(t,n){return'getComponentByName("'+n+'")'})).replace(/setComponent\(["']([a-zA-Z]+)["']\)/g,(function(t,n){return'setComponentByName("'+n+'")'})).replace(/getOrSetComponent\(["']([a-zA-Z]+)["']\)/g,(function(t,n){return'getOrSetComponentByName("'+n+'")'})):6===n&&(t.properties._code=t.properties._code.replace(/getComponentByName\(["']([a-zA-Z]+)["']\)/g,(function(t,n){return'getComponent("'+n+'")'}))),t},CodeBlock.prototype.clearErrors=function(){this._hasCompileErrors=!1,this.clearRuntimeErrors(),pa.clear(this)},CodeBlock_decorate([Attributes_unserializable(),CodeBlock_metadata("design:type",Object)],CodeBlock.prototype,"pinChanged",void 0),CodeBlock_decorate([Attributes_unserializable(),CodeBlock_metadata("design:type",Object)],CodeBlock.prototype,"sourceInfo",void 0),CodeBlock_decorate([Attributes_unserializable(),CodeBlock_metadata("design:type",Object)],CodeBlock.prototype,"_program",void 0),CodeBlock_decorate([Attributes_unserializable(),CodeBlock_metadata("design:type",Object)],CodeBlock.prototype,"_functions",void 0),CodeBlock_decorate([Attributes_unserializable(),CodeBlock_metadata("design:type",Object)],CodeBlock.prototype,"_isLoaded",void 0),CodeBlock_decorate([Attributes_unserializable(),CodeBlock_metadata("design:type",Object)],CodeBlock.prototype,"_isLoading",void 0),CodeBlock_decorate([Attributes_unserializable(),CodeBlock_metadata("design:type",HTMLScriptElement)],CodeBlock.prototype,"_standaloneScript",void 0),CodeBlock_decorate([Attributes_unserializable(),CodeBlock_metadata("design:type",String)],CodeBlock.prototype,"_scriptUrl",void 0),CodeBlock_decorate([Attributes_unserializable(),CodeBlock_metadata("design:type",Object)],CodeBlock.prototype,"_hasCompileErrors",void 0),CodeBlock_decorate([Attributes_unserializable(),CodeBlock_metadata("design:type",Array)],CodeBlock.prototype,"_runtimeError",void 0),CodeBlock=CodeBlock_decorate([displayName("Program"),hasDedicatedEditor(!0)],CodeBlock)}(nt),BehaviorUtils_assign=function(){return(BehaviorUtils_assign=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++)for(var i in n=arguments[r])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)},ma=function(){function BehaviorUtils(){}return BehaviorUtils.pinsHaveSameType=function(t,n){if(t.constructor.name===n.constructor.name){if(t.isA(Ka)){var r=t.componentType,o=n.componentType;return r===o||"Component"===r||"Component"===o}return t.isA(Ja)?t.assetType===n.assetType:t.isA(Za)?t.dataType===n.dataType&&t.declarationId===n.declarationId:!t.isA(Ya)||t.declarationId===n.declarationId}return!1},BehaviorUtils.isPinLoaded=function(t){if(t.isA(Ha)){var n=t.value;if(!Y.isAssetRefLoaded(n))return!1}else if(t.isA(Ja)){var r=t.value;if(!Y.isAssetRefLoaded(r))return!1}else if(t.isA(Za))for(var o=0,i=t.value.data;o<i.length;o++){var a=i[o];if(!BehaviorUtils.isPinLoaded(a))return!1}else if(t.isA(Ya)){r=t.value;if(!Y.isAssetRefLoaded(r))return!1}return!0},BehaviorUtils.buildPins=function(t,n){for(var r=new Rt(At),_loop_1=function(n){var o=n.instance;if(o){var i=void 0;if(t.getPins()){var a=t.getPins().data.find((function(t){return t.instance.id===o.id})),c=a?a.instance:void 0;c&&c.type===o.type&&BehaviorUtils.pinsHaveSameType(c,o)&&((i=c).name=o.name)}i?r.grow(i):r.grow(o.copy())}},o=0,i=n.pins.data;o<i.length;o++){_loop_1(i[o])}t.setPins(r)},BehaviorUtils.updatePinAccessors=function(t){for(var _loop_2=function(n){var r=n.instance.name;Object.defineProperty(t,r,{get:function(){return t.findPinByName(r)[Da.runtimeValueAccessor]},set:function(n){t.findPinByName(r)[Da.runtimeValueAccessor]=n},configurable:!0})},n=0,r=t.getPins().data.filter((function(t){return t.instance.isA(jt)}));n<r.length;n++){_loop_2(r[n])}},BehaviorUtils.initializeCodeBlockInstanceState=function(t,n,r,o){for(var i,a,c={this:(i={},i[Da.runtimeValueAccessor]=n,i),transform:(a={},a[Da.runtimeValueAccessor]=n.transform,a)},u=0,l=r.data.filter((function(t){return void 0!==t.instance&&t.instance.isA(jt)})).map((function(t){return t.instance}));u<l.length;u++){var p=l[u];c[p.name]=p}var f="initState_"+fa.trimId(t.id);return f in window&&window[f](c,ua.api,_e.createObject,o),c},BehaviorUtils.getVariables=function(t){return t.pins.data.map((function(t){return t.instance})).filter((function(t){return void 0!==t})).reduce((function(t,n){var r;return BehaviorUtils_assign(BehaviorUtils_assign({},t),((r={})[n.name]=n.constructor.name,r))}),{this:"Entity",transform:"Transform"})},BehaviorUtils}(),va=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ObjectDefinition_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},ObjectDefinition_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},ga=function(t){function ObjectDefinition(n){var r=t.call(this)||this;return r._pins=new Rt(At),r._declaration=new K(ce),r.onDeclarationPinChanged=r.onDeclarationPinChanged.bind(r),r.onDeclarationChanged=r.onDeclarationChanged.bind(r),r._declaration.assetChanged.attach(r.onDeclarationChanged),n&&r.setState(n),r}return va(ObjectDefinition,t),Object.defineProperty(ObjectDefinition.prototype,"declaration",{get:function(){return this._declaration.asset},set:function(t){this._declaration.asset=t},enumerable:!1,configurable:!0}),Object.defineProperty(ObjectDefinition.prototype,"declarationId",{get:function(){return this._declaration.id},enumerable:!1,configurable:!0}),Object.defineProperty(ObjectDefinition.prototype,"pins",{get:function(){return this._pins},enumerable:!1,configurable:!0}),ObjectDefinition.prototype.isLoaded=function(){for(var t=0,n=this._pins.data;t<n.length;t++){var r=n[t];if(!ma.isPinLoaded(r.instance))return!1}return!0},ObjectDefinition.prototype.destroy=function(){this.declaration&&this.declaration.pinChanged.detach(this.onDeclarationPinChanged),this._declaration.detach(),t.prototype.destroy.call(this)},ObjectDefinition.prototype.setProperty=function(n,r){t.prototype.setProperty.call(this,n,r),"_pins"===n&&ma.updatePinAccessors(this)},ObjectDefinition.prototype.getPins=function(){return this._pins},ObjectDefinition.prototype.setPins=function(t){this._pins=t},ObjectDefinition.prototype.findPinByName=function(t){return this._pins.data.map((function(t){return t.instance})).find((function(n){return n.name===t}))},ObjectDefinition.prototype.onDeclarationPinChanged=function(t){this.declaration&&(ma.buildPins(this,this.declaration),ma.updatePinAccessors(this))},ObjectDefinition.prototype.onDeclarationChanged=function(t){var n=t.oldAsset;n&&n.pinChanged.detach(this.onDeclarationPinChanged);var r=t.newAsset;r&&(ma.buildPins(this,r),ma.updatePinAccessors(this),r.pinChanged.attach(this.onDeclarationPinChanged))},ObjectDefinition=ObjectDefinition_decorate([displayName("Object Definition"),creatable(!1),ObjectDefinition_metadata("design:paramtypes",[Object])],ObjectDefinition)}(nt),_a=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ba=function(t){function ObjectReference(n){var r=t.call(this,ga)||this;return r._declarationId=n,r}return _a(ObjectReference,t),Object.defineProperty(ObjectReference.prototype,"declarationId",{get:function(){return this._declarationId},set:function(t){this._declarationId=t},enumerable:!1,configurable:!0}),ObjectReference}(K);da||(da={});var wa,xa,Pa=function(){function IEntityUtilsInternal(){}return Object.defineProperty(IEntityUtilsInternal,"instance",{get:function(){return da.instance},set:function(t){da.instance=t},enumerable:!1,configurable:!0}),IEntityUtilsInternal}(),SerializerUtils_assign=function(){return(SerializerUtils_assign=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++)for(var i in n=arguments[r])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};!function(t){t.serializeNonPersistentObjects=void 0,t.nonPersistentObjectCache=null,t.mockInstanceCache={}}(wa||(wa={})),function(t){t.serializeIdsAsPaths=!1,t.tryUsePropertySetter=!1}(xa||(xa={}));var Oa,Ca=function(){function SerializerUtils(){}return SerializerUtils.serializeEntity=function(t,n){SerializerUtils.serializeNonPersistentObjects(n);var r=t.children.filter((function(t){return!t.transient})).map((function(t){return SerializerUtils.serializeEntity(t,n)})),o=[];t.iterateComponents((function(t){t.controller||o.push(t)}));var i=Pa.instance.sortComponents(o),a=SerializerUtils.serializeComponents(i);return SerializerUtils.serializeNonPersistentObjects(!1),{id:t.id,name:t.name,active:t.active,prefabId:t.prefabId,components:o.length>0?a:void 0,children:r.length>0?r:void 0}},SerializerUtils.deserializeEntity=function(t,n){if(t.name=n.name,t.id=n.id,t.initializeActive(n.active),t.prefabId=n.prefabId,n.components){if(Array.isArray(n.components)){for(var r={},o=0,i=n.components;o<i.length;o++){var a=i[o],c=a.typeName;delete a.typeName,r[c]=a}n.components=r}for(var u=0,l=Object.keys(n.components);u<l.length;u++){c=l[u];var p=n.components[c],f=I.instance.createObject(c);SerializerUtils.deserializeObject(f,p),Oa.setComponentFromInstance(t,f)}}if(n.children)for(var h=0,d=n.children;h<d.length;h++){var y=d[h],m=new ja;t.addChild(m),SerializerUtils.deserializeEntity(m,y)}},SerializerUtils.serializeEntityWithPrefabRefs=function(t){if(t.prefabId)return{id:t.id,name:t.name,active:t.active,prefabId:t.prefabId};var n=t.children.filter((function(t){return!t.transient})).map((function(t){return SerializerUtils.serializeEntityWithPrefabRefs(t)})),r=[];t.iterateComponents((function(t){t.controller||r.push(t)}));var o=Pa.instance.sortComponents(r),i=SerializerUtils.serializeComponents(o);return{id:t.id,name:t.name,active:t.active,components:r.length>0?i:void 0,children:n.length>0?n:void 0}},SerializerUtils.serializeObject=function(t){var n={typeName:t.constructor.name,version:SerializerUtils.getObjectVersion(t),properties:{}};return SerializerUtils.serializeProperties(t,n),n},SerializerUtils.deserializeObject=function(t,n){var r=n,o=n.version||1,i=SerializerUtils.getObjectVersion(t);if(o<i)for(var a=o;a<i;++a)(r=t.upgrade(n,a)).version=a+1;for(var c=0,u=Object.keys(r.properties);c<u.length;c++){var l=u[c];if(SerializerUtils.isPropertySerializable(t.constructor.name,l)){var p,f=r.properties[l];if(SerializerUtils.isDynamicProperty(t.constructor.name,l))(p=f.typeName)&&SerializerUtils.deserializeProperty(t,l,p,f.data);else(p=SerializerUtils.getPropertyTypeName(t[l]))&&SerializerUtils.deserializeProperty(t,l,p,f)}}},SerializerUtils.serializeNonPersistentObjects=function(t){wa.serializeNonPersistentObjects=t},SerializerUtils.clearNonPersistentObjectCache=function(){wa.nonPersistentObjectCache=null},SerializerUtils.serializeProperty=function(t,n){var r,o=null!=n?n:SerializerUtils.getPropertyTypeName(t);if(["AssetReference","ObjectReference"].indexOf(o)>=0){var i=t,a=i.id;if(i.asset&&!i.asset.isPersistent&&(wa.serializeNonPersistentObjects?(wa.nonPersistentObjectCache||(wa.nonPersistentObjectCache={}),wa.nonPersistentObjectCache[i.asset.id]=i.asset):a=void 0),a&&xa.serializeIdsAsPaths){var c=function(){var t;return null===(t=i.asset)||void 0===t?void 0:t.templatePath}();c&&(a=c)}var u={typeName:i.typeName(),id:a};return"ObjectReference"===o?u.declarationId=t.declarationId:i.inline&&(u.inlineData=JSON.stringify(null===(r=i.asset)||void 0===r?void 0:r.serialize())),u}if("Entity"===o)return SerializerUtils.serializeEntity(t);if(T.isObjectOfType(o,"SerializableObject"))return t.serialize();var l=ae.properties;return o in l?l[o].writeProperty(t):(p.logWarning("Cannot serialize property of type '"+o+"'"),te.noOp)},SerializerUtils.deserializeProperty=function(t,n,r,o){if(["AssetReference","ObjectReference"].indexOf(r)>=0){var i=o,a=i.id,c=t[n];if("AssetReference"===r)c||(c=I.instance.createAssetReference(i.typeName,Boolean(i.inlineData)),t[n]=c);else{var u=o;c?c.declarationId=u.declarationId:(c=new ba(u.declarationId),t[n]=c)}if(c.id=a,i.inlineData){var l=Mn.loadObjectFromData(a,i.inlineData);c.asset=l,c.inline=!0,SerializerUtils.setProperty(t,n,c)}else if(a)if(wa.nonPersistentObjectCache&&a in wa.nonPersistentObjectCache)c.asset=wa.nonPersistentObjectCache[a],SerializerUtils.setProperty(t,n,c);else{Mn.loadObject(a,(function(r,o){var i=r,a=t[n];a.asset=i,SerializerUtils.setProperty(t,n,a),!1===o&&zn.assetLoaded.post(i)}),(function(){var r=t[n];r.setAssetFast(null),r.state=q.Resolved,SerializerUtils.setProperty(t,n,r);var o=t.templatePath;o=o?"in '"+o+"'":"in '"+t.constructor.name+"'",p.logError("Missing asset still referenced '"+n+"', id: '"+a+"' "+(o||""))}),!1)}else c.asset=null,SerializerUtils.setProperty(t,n,c)}else if("Entity"===r){var f=new ja;SerializerUtils.deserializeEntity(f,o),SerializerUtils.setProperty(t,n,f)}else if(T.isObjectOfType(r,"SerializableObject")){(f=I.instance.createObject(r))&&(f.deserialize(o),SerializerUtils.setProperty(t,n,f))}else{if("Number"===r){var h=Reflect.getMetadata("enumLiterals",t,n);if(h){if("number"==typeof o)SerializerUtils.setProperty(t,n,o);else if("object"==typeof o)SerializerUtils.setProperty(t,n,o.value);else{var d=h.literals[o];console.assert(void 0!==d),SerializerUtils.setProperty(t,n,d)}return}}var y=ae.properties,m=r in y?y[r].readProperty(o,t,n):o;void 0!==m&&SerializerUtils.setProperty(t,n,m)}},SerializerUtils.getPropertyTypeName=function(t){var n=typeof t;return"object"===n?t.constructor.name:n=n[0].toUpperCase()+n.substring(1)},SerializerUtils.copyProperty=function(t,n,r){var o=SerializerUtils.getSerializablePropertyTypeName(t,r);if(null===o)return!1;var i=SerializerUtils.serializeProperty(t[r],o);return SerializerUtils.deserializeProperty(n,r,o,i),!0},SerializerUtils.getSerializablePropertyTypeName=function(t,n){var r=t[n];return"function"==typeof r||Reflect.getMetadata("unserializable",t,n)?null:SerializerUtils.getPropertyTypeName(r)},SerializerUtils.setProperty=function(t,n,r){var setProperty=function(){Array.isArray(t)?t[n]=r:t.setProperty(n,r)};if(xa.tryUsePropertySetter)if("string"==typeof n&&n.startsWith("_")){var o=n.slice(1),i=Object.getPrototypeOf(t),a=Object.getOwnPropertyDescriptor(i,o);if(!a)for(i=Object.getPrototypeOf(i);i&&i.isA&&i.isA(z)&&"SerializableObject"!==i.constructor.name&&!(a=Object.getOwnPropertyDescriptor(i,o));)i=Object.getPrototypeOf(i);a&&a.set?"Reference"===r.constructor.name?a.set.call(t,r.getInstance()):"AssetReference"===r.constructor.name?a.set.call(t,r.asset):"EntityReference"===r.constructor.name?a.set.call(t,r.entity):"ComponentReference"===r.constructor.name?a.set.call(t,r.component):"ReferenceArray"===r.constructor.name?a.set.call(t,r.getData().map((function(t){return t.getInstance()}))):a.set.call(t,r):setProperty()}else setProperty();else setProperty()},SerializerUtils.isDynamicProperty=function(t,n){var r=wa.mockInstanceCache[t];return r||(r=I.instance.createObject(t),wa.mockInstanceCache[t]=r),!(n in r)},SerializerUtils.isPropertySerializable=function(t,n){var r=wa.mockInstanceCache[t];return r||(r=I.instance.createObject(t),wa.mockInstanceCache[t]=r),!Reflect.getMetadata("unserializable",r,n)},SerializerUtils.getObjectVersion=function(t){return t.version||1},SerializerUtils.serializeProperties=function(t,n){for(var _loop_1=function(r){if(Reflect.getMetadata("unserializable",t,r))return"continue";var o=t[r];if("function"==typeof o||null==o)return"continue";var i=SerializerUtils.getPropertyTypeName(o);if("Number"===i){var a=Reflect.getMetadata("enumLiterals",t,r);if(a){var c=Object.keys(a.literals).find((function(t){return a.literals[t]===o}));console.assert(c),o=c,i="String"}}var u=SerializerUtils.serializeProperty(o,i);u!==te.noOp&&(SerializerUtils.isDynamicProperty(t.constructor.name,r)?n.properties[r]={typeName:i,data:u}:n.properties[r]=u)},r=0,o=Object.keys(t);r<o.length;r++){_loop_1(o[r])}},SerializerUtils.serializeComponent=function(t){var n={version:SerializerUtils.getObjectVersion(t),properties:{}};return SerializerUtils.serializeProperties(t,n),n},SerializerUtils.serializeComponents=function(t){return t.reduce((function(t,n){var r;return SerializerUtils_assign(SerializerUtils_assign({},t),((r={})[n.constructor.name]=SerializerUtils.serializeComponent(n),r))}),{})},SerializerUtils}(),Sa=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Entity_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Entity_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Entity_spreadArray=function(t,n){for(var r=0,o=n.length,i=t.length;r<o;r++,i++)t[i]=n[r];return t},Aa=void 0;(function(t){function setComponentFromInstance(t,n){var r=n.constructor.name,o=t._components[r];o&&(n.onReplace(o),o.destroy()),t._components[r]=n,n.setEntity(t)}t.entitiesJustDestroyed=[],t.entitiesJustCreated=[],t.collectEntityOperations=!1,t.destroyEntity=function destroyEntity(t){for(var n=0,r=Object.keys(t._components).map((function(n){return t._components[n]})).filter((function(t){return!t.controller}));n<r.length;n++){r[n].destroy()}for(var o=0,i=Entity_spreadArray([],t.children);o<i.length;o++){i[o].destroy()}t._components={},t.children=[]},t.setComponentFromInstance=setComponentFromInstance,t.setComponentByName=function setComponentByName(t,n,r){var o=I.instance.createObject(n,r);return setComponentFromInstance(t,o),Aa&&Aa.componentAddedOrRemovedByRuntime.post(t),o},t.getComponentByName=function getComponentByName(t,n){return t._components[n]||null},t.clearComponentByName=function clearComponentByName(t,n){(function clearComponent(t,n){var r=t._components[n];return!!r&&(r.destroy(),delete t._components[n],!0)})(t,n)&&Aa&&Aa.componentAddedOrRemovedByRuntime.post(t)}})(Oa||(Oa={}));var Ea,ja=function(t){function Entity(){var n=null!==t&&t.apply(this,arguments)||this;return n.children=[],n.transient=!1,n._components={},n._tags={},n._active=!0,n}return Sa(Entity,t),Object.defineProperty(Entity.prototype,"transform",{get:function(){return this.getComponent(Yn)},enumerable:!1,configurable:!0}),Object.defineProperty(Entity.prototype,"active",{get:function(){return this._active},set:function(t){Aa&&t!==this._active&&Aa.entityActivated.post({entity:this,active:t}),this._active=t},enumerable:!1,configurable:!0}),Entity.prototype.isLoaded=function(){var t=!0;return this.traverse((function(n){for(var r=0,o=Object.values(n._components);r<o.length;r++){if(!o[r].isLoaded())return t=!1,!1}return!0}),!0),t},Entity.prototype.setComponent=function(t,n){var r=new t(n);return Oa.setComponentFromInstance(this,r),this},Entity.prototype.setComponentByName=function(t,n){return Oa.setComponentByName(this,t,n),this},Entity.prototype.getComponent=function(t){return Oa.getComponentByName(this,t.name)},Entity.prototype.getComponentByName=function(t){return Oa.getComponentByName(this,t)},Entity.prototype.clearComponent=function(t){return Oa.clearComponentByName(this,t.name),this},Entity.prototype.updateComponent=function(t,n){return this.updateComponentByName(t.name,n)},Entity.prototype.updateComponentByName=function(t,n){var r=this.getComponentByName(t);return r&&r.setState(n),this},Entity.prototype.getOrSetComponent=function(t){return this.getOrSetComponentByName(t.name)},Entity.prototype.getOrSetComponentByName=function(t){return Oa.getComponentByName(this,t)||Oa.setComponentByName(this,t)},Entity.prototype.getComponents=function(t){var n=[];return this.getComponentsInChildren(t.name,n),n},Entity.prototype.addChild=function(t,n){void 0===n&&(n=!1);var r=t.parent;return r&&(n&&Pa.instance.preserveWorldPosition(t,this),r.removeChild(t)),t.parent=this,this.children.push(t),Pa.instance.dirtifyWorldMatrixIfNecessary(t),Pa.instance.updateLayoutMatrixIfNecessary(t),Aa&&Aa.entityHierarchyChanged.post(),this},Entity.prototype.insertChild=function(t,n,r){void 0===r&&(r=!1);var o=t.parent;return o&&(r&&Pa.instance.preserveWorldPosition(t,this),o.removeChild(t)),t.parent=this,this.children.splice(n,0,t),Pa.instance.dirtifyWorldMatrixIfNecessary(t),Pa.instance.updateLayoutMatrixIfNecessary(t),Aa&&Aa.entityHierarchyChanged.post(),this},Entity.prototype.removeChild=function(t){delete t.parent;var n=this.children.indexOf(t);return this.children.splice(n,1),Aa&&Aa.entityHierarchyChanged.post(),this},Entity.prototype.removeAllChildren=function(){for(var t=0,n=Entity_spreadArray([],this.children);t<n.length;t++){n[t].destroy()}return this},Entity.prototype.findChildById=function(t){if(this.id===t)return this;for(var n=0,r=this.children;n<r.length;n++){if((a=r[n]).id===t)return a}for(var o=0,i=this.children;o<i.length;o++){var a,c=(a=i[o]).findChildById(t);if(c)return c}},Entity.prototype.findChild=function(t){for(var n=0,r=this.children;n<r.length;n++){if((a=r[n]).name===t)return a}for(var o=0,i=this.children;o<i.length;o++){var a,c=(a=i[o]).findChild(t);if(c)return c}},Entity.prototype.filterChildren=function(t){var n=[];return this.traverse((function(r){return t(r)&&n.push(r),!0})),n},Entity.prototype.isAncestor=function(t){return this.parent===t||!!this.parent&&this.parent.isAncestor(t)},Entity.prototype.setTag=function(t){var n;return Object.assign(this._tags,((n={})[t]=!0,n)),this},Entity.prototype.hasTag=function(t){return t in this._tags},Entity.prototype.traverse=function(t,n){void 0===n&&(n=!1);var r=!0;n&&(r=t(this)),!1!==r&&this.traverseInternal(this,t)},Entity.prototype.traverseAncestors=function(t,n){void 0===n&&(n=!1);var r=!0;n&&(r=t(this)),!1!==r&&this.traverseAncestorsInternal(this,t)},Entity.prototype.iterateComponents=function(t){for(var n=0,r=Object.values(this._components);n<r.length;n++){t(r[n])}},Entity.prototype.getAncestor=function(t){var n=Oa.getComponentByName(this,t);return n&&n.active?n:this.parent?this.parent.getAncestor(t):null},Entity.prototype.getAncestorOfType=function(t){return this.getAncestor(t.name)},Entity.prototype.destroy=function(){this.parent&&this.parent.removeChild(this),Oa.collectEntityOperations?Oa.entitiesJustDestroyed.push(this):Oa.destroyEntity(this)},Entity.prototype.hasComponentByName=function(t){return t in this._components},Entity.prototype.hasComponent=function(t){return this.hasComponentByName(t.name)},Entity.prototype.serialize=function(){return console.assert(!1),{typeName:"InvalidEntityData",version:1,properties:{}}},Entity.prototype.deserialize=function(t){return console.assert(!1),Promise.reject()},Entity.prototype.copyWithIdMap=function(t){return this.copyInternal(t,void 0)},Entity.prototype.copy=function(t,n){return this.copyInternal(void 0,t)},Entity.prototype.initializeActive=function(t){this._active=t},Entity.prototype.copyInternal=function(t,n){var r=new Entity;r.prefabId=this.prefabId,Ca.deserializeEntity(r,Ca.serializeEntity(this,!0));var o=t||n||{};return r.traverse((function(n){if(t){var r=t[n.id];if(r)return n.id=r,!0}var i=Y.makeUniqueId();return o[n.id]=i,n.id=i,!0}),!0),Pa.instance.translateReferences(r,o),r},Entity.prototype.getComponentsInChildren=function(t,n){if(this.active&&!this.transient){var r=Oa.getComponentByName(this,t);r&&r.active&&n.push(r);for(var o=0,i=this.children;o<i.length;o++){i[o].getComponentsInChildren(t,n)}}},Entity.prototype.traverseInternal=function(t,n){for(var r=0,o=t.children;r<o.length;r++){var i=o[r];n(i)&&this.traverseInternal(i,n)}},Entity.prototype.traverseAncestorsInternal=function(t,n){t.parent&&n(t.parent)&&this.traverseAncestorsInternal(t.parent,n)},Entity_decorate([Attributes_unserializable(),Entity_metadata("design:type",Object)],Entity.prototype,"transient",void 0),Entity}(J);!function(t){t.defaultPRS={position:w.zero,rotation:kt.identity,scale:w.one},t.emptyProps={name:void 0,prefab:void 0,prs:void 0,children:void 0}}(Ea||(Ea={}));var Ta,Ra=function(){function Entities(){}return Entities.create=function(t){var n,r=t||Ea.emptyProps,o=r.name,i=r.prefab,a=r.prs,c=r.children;if(i?(n=i.root.copy()).name=o||i.name:(n=new ja,o&&(n.name=o)),a&&n.setComponent(Yn,{position:a.position||Ea.defaultPRS.position,rotation:a.rotation||Ea.defaultPRS.rotation,scale:a.scale||Ea.defaultPRS.scale}),c)for(var u=0,l=c;u<l.length;u++){var p=l[u];n.addChild(Entities.create(p))}var f=Dn.list();return 0===f.length&&(Un.create(),console.assert(1===f.length)),f[0].root.addChild(n),Oa.collectEntityOperations&&Oa.entitiesJustCreated.push(n),n},Entities.find=function(t){for(var n=0,r=Dn.list();n<r.length;n++){var o=r[n];if(t===o.root.name)return o.root;var i=o.root.findChild(t);if(i)return i}return null},Entities.get=function(t){for(var n=0,r=Dn.list();n<r.length;n++){var o=r[n];if(t===o.root.id)return o.root;var i=o.root.findChildById(t);if(i)return i}return null},Entities}(),Ba=function(){function EntityReference(t){this._entity=null,this._resolved=!1,this._id=t,this._resolved=!1}return Object.defineProperty(EntityReference.prototype,"id",{get:function(){return this._id},set:function(t){t!==this._id&&(this._id=t,this._resolved=!1)},enumerable:!1,configurable:!0}),Object.defineProperty(EntityReference.prototype,"entity",{get:function(){return this._id?(this._resolved||(this._entity=Ra.get(this._id),this._entity||p.log("A missing entity (id: '"+this._id+"') is still referenced by the scene."),this._resolved=!0),this._entity):null},set:function(t){t?(this._id=t.id,this._entity=t):(delete this._id,this._entity=null),this._resolved=!0},enumerable:!1,configurable:!0}),EntityReference}(),Ma=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Prefab_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Prefab_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Ia=function(t){function Prefab(){var n=t.call(this)||this;return n.root=new ja,n}return Ma(Prefab,t),Object.defineProperty(Prefab.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Prefab.prototype.isLoaded=function(){return this.root.isLoaded()},Prefab.prototype.serialize=function(){return{typeName:this.constructor.name,version:this.version,id:this.id,name:this.name,root:Ca.serializeEntity(this.root)}},Prefab.prototype.deserialize=function(t){var n=t;if(1===n.version){var r=t;n.root=r.properties.root,n.id=r.properties.id,n.name=r.properties.name}return this.id=n.id,this.name=n.name,Ca.deserializeEntity(this.root,n.root),this},Prefab=Prefab_decorate([editable(!1),creatable(!1),Prefab_metadata("design:paramtypes",[])],Prefab)}(nt),za=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),DataPins_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},DataPins_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.defaultComponentType="Transform",t.defaultAssetType="Material"}(Ta||(Ta={}));var ka,Da=function(t){function TDataPin(n,r){var o=t.call(this,n,r)||this;return Object.defineProperty(o,TDataPin.runtimeValueAccessor,{get:function(){return o.value},set:function(t){return o.value=t},configurable:!0}),o}return za(TDataPin,t),TDataPin.prototype.setData=function(t){this.value=t},TDataPin.prototype.getData=function(){return this.value},TDataPin.runtimeValueAccessor="_value",TDataPin}(jt),Fa=function(t){function NumberPin(n,r,o){var i=t.call(this,n,r)||this;return i.value=o||0,i}return za(NumberPin,t),NumberPin=DataPins_decorate([displayName("Number"),DataPins_metadata("design:paramtypes",[String,Number,Number])],NumberPin)}(Da),La=function(t){function StringPin(n,r){var o=t.call(this,n,r)||this;return o.value="",o}return za(StringPin,t),StringPin=DataPins_decorate([displayName("String"),DataPins_metadata("design:paramtypes",[String,Number])],StringPin)}(Da),Na=function(t){function BooleanPin(n,r){var o=t.call(this,n,r)||this;return o.value=!1,o}return za(BooleanPin,t),BooleanPin=DataPins_decorate([displayName("Boolean"),DataPins_metadata("design:paramtypes",[String,Number])],BooleanPin)}(Da),Va=function(t){function Vector2Pin(n,r){var o=t.call(this,n,r)||this;return o.value=new h,o}return za(Vector2Pin,t),Vector2Pin.prototype.setData=function(t){this.value.copy(t)},Vector2Pin=DataPins_decorate([displayName("Vector2"),DataPins_metadata("design:paramtypes",[String,Number])],Vector2Pin)}(Da),Ua=function(t){function Vector3Pin(n,r){var o=t.call(this,n,r)||this;return o.value=new w,o}return za(Vector3Pin,t),Vector3Pin.prototype.setData=function(t){this.value.copy(t)},Vector3Pin=DataPins_decorate([displayName("Vector3"),DataPins_metadata("design:paramtypes",[String,Number])],Vector3Pin)}(Da),Wa=function(t){function Vector4Pin(n,r){var o=t.call(this,n,r)||this;return o.value=new Bt,o}return za(Vector4Pin,t),Vector4Pin.prototype.setData=function(t){this.value.copy(t)},Vector4Pin=DataPins_decorate([displayName("Vector4"),DataPins_metadata("design:paramtypes",[String,Number])],Vector4Pin)}(Da),qa=function(t){function ColorPin(n,r){var o=t.call(this,n,r)||this;return o.value=new It,o}return za(ColorPin,t),ColorPin.prototype.setData=function(t){this.value.copy(t)},ColorPin=DataPins_decorate([displayName("Color"),DataPins_metadata("design:paramtypes",[String,Number])],ColorPin)}(Da),Ga=function(t){function RayPin(n,r){var o=t.call(this,n,r)||this;return o.value=new ge,o}return za(RayPin,t),RayPin.prototype.setData=function(t){this.value.copy(t)},RayPin=DataPins_decorate([displayName("Ray"),DataPins_metadata("design:paramtypes",[String,Number])],RayPin)}(Da),Ha=function(t){function PrefabPin(n,r){var o=t.call(this,n,r)||this;return o.value=new K(Ia),Object.defineProperty(o,Da.runtimeValueAccessor,{get:function(){return o.value.asset},set:function(t){return o.value.asset=t}}),o}return za(PrefabPin,t),PrefabPin=DataPins_decorate([displayName("Prefab"),DataPins_metadata("design:paramtypes",[String,Number])],PrefabPin)}(Da),Xa=function(t){function EntityReferencePin(n,r){var o=t.call(this,n,r)||this;return o.value=new Ba,Object.defineProperty(o,Da.runtimeValueAccessor,{get:function(){return o.value.entity},set:function(t){return o.value.entity=t}}),o}return za(EntityReferencePin,t),EntityReferencePin=DataPins_decorate([displayName("Entity"),DataPins_metadata("design:paramtypes",[String,Number])],EntityReferencePin)}(Da),Ka=function(t){function ComponentReferencePin(n,r,o){var i=t.call(this,n,r)||this;return i._componentType=o||Ta.defaultComponentType,Object.defineProperty(i,Da.runtimeValueAccessor,{get:function(){return i.value.component},set:function(t){return i.value.component=t}}),i}return za(ComponentReferencePin,t),Object.defineProperty(ComponentReferencePin.prototype,"version",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(ComponentReferencePin.prototype,"componentType",{get:function(){return this._componentType},set:function(t){this.value=mt.factory.createComponentReference(t),this._componentType=t},enumerable:!1,configurable:!0}),ComponentReferencePin.prototype.setProperty=function(n,r){t.prototype.setProperty.call(this,n,r),"_componentType"!==n||this.value||(this.componentType=r)},ComponentReferencePin.prototype.upgrade=function(n,r){if(1===r)n=t.prototype.upgrade.call(this,n,r);else if(2===r){var o=n.properties._componentType;"UIImage"===o?Object.assign(n.properties,{_componentType:"Image"}):"UIText"===o&&Object.assign(n.properties,{_componentType:"Text"})}return n},ComponentReferencePin=DataPins_decorate([displayName("Component"),DataPins_metadata("design:paramtypes",[String,Number,String])],ComponentReferencePin)}(Da),Qa=function(t){function CollisionInfoPin(n,r){return t.call(this,n,r)||this}return za(CollisionInfoPin,t),CollisionInfoPin=DataPins_decorate([displayName("CollisionInfo"),DataPins_metadata("design:paramtypes",[String,Number])],CollisionInfoPin)}(Da),Ya=function(t){function ObjectReferencePin(n,r,o){var i=t.call(this,r,o)||this;return i.value=new ba(n),Object.defineProperty(i,Da.runtimeValueAccessor,{get:function(){return i.value.asset},set:function(t){return i.value.asset=t}}),i}return za(ObjectReferencePin,t),Object.defineProperty(ObjectReferencePin.prototype,"declarationId",{get:function(){return this.value.declarationId},set:function(t){this.value=new ba(t)},enumerable:!1,configurable:!0}),ObjectReferencePin.prototype.setProperty=function(n,r){t.prototype.setProperty.call(this,n,r),"_declarationId"===n&&this.value.declarationId!==r&&(this.value=new ba(r))},ObjectReferencePin}(Da),Za=function(t){function ArrayPin(n,r,o){var i=t.call(this,n,r)||this;return i._isDirty=!0,Object.defineProperty(i,Da.runtimeValueAccessor,{get:function(){return i._isDirty&&(i._runtimeData=i.value.data.map((function(t){return t[Da.runtimeValueAccessor]})),i._isDirty=!1),i._runtimeData},set:function(t){i.value.data=t.map((function(t){var n=(i._dataType?mt.factory.createObject(i._dataType):null)||new Da;return n.value=t,n})),i._isDirty=!0}}),i}return za(ArrayPin,t),Object.defineProperty(ArrayPin.prototype,"dataType",{get:function(){return this._dataType},set:function(t){t&&(this.value=mt.factory.createObjectArray(t)),this._dataType=t,delete this._declarationId},enumerable:!1,configurable:!0}),Object.defineProperty(ArrayPin.prototype,"declarationId",{get:function(){return this._declarationId},set:function(t){var n=this;t&&(this.value&&"ObjectReferencePin"===this.value.typeName()||(this.value=mt.factory.createObjectArray("ObjectReferencePin")),this.value.grow=function(r){r?r.declarationId=t:r=new Ya(t),n.value.data.push(r)}),this._declarationId=t,delete this._dataType},enumerable:!1,configurable:!0}),ArrayPin.prototype.setData=function(n){t.prototype.setData.call(this,n),this._isDirty=!0},ArrayPin.prototype.setProperty=function(n,r){t.prototype.setProperty.call(this,n,r),"_dataType"!==n||this.value?"_declarationId"===n&&(this.declarationId=r):this.dataType=r},DataPins_decorate([Attributes_unserializable(),DataPins_metadata("design:type",Object)],ArrayPin.prototype,"_isDirty",void 0),DataPins_decorate([Attributes_unserializable(),DataPins_metadata("design:type",Array)],ArrayPin.prototype,"_runtimeData",void 0),ArrayPin=DataPins_decorate([displayName("Array"),DataPins_metadata("design:paramtypes",[String,Number,String])],ArrayPin)}(Da),Ja=function(t){function AssetPin(n,r,o){var i=t.call(this,n,r)||this;return i._assetType=o||Ta.defaultAssetType,Object.defineProperty(i,Da.runtimeValueAccessor,{get:function(){return i.value.asset},set:function(t){return i.value.asset=t}}),i}return za(AssetPin,t),Object.defineProperty(AssetPin.prototype,"assetType",{get:function(){return this._assetType},set:function(t){this.value=mt.factory.createAssetReference(t),this._assetType=t},enumerable:!1,configurable:!0}),AssetPin.prototype.setProperty=function(n,r){t.prototype.setProperty.call(this,n,r),"_assetType"!==n||this.value||(this.assetType=r)},AssetPin=DataPins_decorate([displayName("Asset"),DataPins_metadata("design:paramtypes",[String,Number,String])],AssetPin)}(Da),$a=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),BehaviorNode_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},BehaviorNode_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},BehaviorNode_spreadArray=function(t,n){for(var r=0,o=n.length,i=t.length;r<o;r++,i++)t[i]=n[r];return t},ts=function(t){function BehaviorNode(){var n=t.call(this)||this;return n.position=new h,n._pins=new Rt(At),n.id=Y.makeUniqueId(),n}return $a(BehaviorNode,t),Object.defineProperty(BehaviorNode.prototype,"pins",{get:function(){return this._pins},enumerable:!1,configurable:!0}),Object.defineProperty(BehaviorNode.prototype,"ownerBehavior",{get:function(){return this._ownerBehavior},set:function(t){this._ownerBehavior=t},enumerable:!1,configurable:!0}),BehaviorNode.prototype.onBehaviorStarted=function(){},BehaviorNode.prototype.findPin=function(t){var n=this._pins.data.find((function(n){return n.instance.id===t}));return n?n.instance:void 0},BehaviorNode.prototype.findPinByName=function(t){var n=this._pins.data.find((function(n){return n.instance.name===t}));return n?n.instance:void 0},BehaviorNode.prototype.filterPins=function(t){return this._pins.data.filter((function(n){return t(n.instance)})).map((function(t){return t.instance}))},BehaviorNode.prototype.sendSignal=function(t){var n=this.findPinByName(t);n&&this._ownerBehavior.sendSignal(this.id,n.id)},BehaviorNode.prototype.isLoaded=function(){return!0},BehaviorNode.prototype.createPin=function(t,n,r){for(var o,i=[],a=3;a<arguments.length;a++)i[a-3]=arguments[a];this[t]=(o=mt.factory).createObject.apply(o,BehaviorNode_spreadArray([r.name,t,n],i)),this.registerPin(this[t])},BehaviorNode.prototype.createComponentReferencePin=function(t,n,r){var o=new Ka(t,n,r.name);o.componentType=r.name,this[t]=o,this.registerPin(this[t])},BehaviorNode.prototype.createAssetPin=function(t,n,r){var o=new Ja(t,n,r.name);o.assetType=r.name,this[t]=o,this.registerPin(this[t])},BehaviorNode.prototype.createArrayPin=function(t,n,r){var o=new Za(t,n,r.name);o.dataType=r.name,this[t]=o,this.registerPin(this[t])},BehaviorNode.prototype.registerPin=function(t){this._pins.grow(t)},BehaviorNode_decorate([Attributes_unserializable(),BehaviorNode_metadata("design:type",Number)],BehaviorNode.prototype,"widthInEditor",void 0),BehaviorNode_decorate([Attributes_unserializable(),BehaviorNode_metadata("design:type",Object)],BehaviorNode.prototype,"_ownerBehavior",void 0),BehaviorNode_decorate([Attributes_unserializable(),BehaviorNode_metadata("design:type",Object)],BehaviorNode.prototype,"_pins",void 0),BehaviorNode}(z),es=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Operator_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Operator_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.startPinId="_start",t.finishPinId="_finish"}(ka||(ka={}));var ns,rs=function(t){function Operator(){var n=t.call(this)||this;return n.createPin(ka.startPinId,Pt.Input,Et),n.createPin(ka.finishPinId,Pt.Output,Et),n}return es(Operator,t),Operator.prototype.onStart=function(){return dt.Finish},Operator.prototype.onUpdate=function(){return dt.Finish},Operator.prototype.onFinish=function(){},Operator.prototype.onSignalReceived=function(t){},Operator_decorate([Attributes_unserializable(),Operator_metadata("design:type",Et)],Operator.prototype,"_start",void 0),Operator_decorate([Attributes_unserializable(),Operator_metadata("design:type",Et)],Operator.prototype,"_finish",void 0),Operator}(ts),os=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),CodeBlockInstance_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},CodeBlockInstance_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},CodeBlockInstance_spreadArray=function(t,n){for(var r=0,o=n.length,i=t.length;r<o;r++,i++)t[i]=n[r];return t},is=function(t){function CodeBlockInstance(){var n=t.call(this)||this;return n._onStartExecutionPending=!1,n._initStateExecutionPending=!1,n._stateInitialized=!1,n._codeBlock=new K(ya),n.sendSignal=n.sendSignal.bind(n),n.onCodeBlockPinsChanged=n.onCodeBlockPinsChanged.bind(n),n.onCodeBlockChanged=n.onCodeBlockChanged.bind(n),n._codeBlock.assetChanged.attach(n.onCodeBlockChanged),n}return os(CodeBlockInstance,t),Object.defineProperty(CodeBlockInstance.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlockInstance.prototype,"codeBlock",{get:function(){return this._codeBlock.asset},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlockInstance.prototype,"codeBlockRef",{get:function(){return this._codeBlock},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlockInstance.prototype,"customPins",{get:function(){return this._customPins},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlockInstance.prototype,"stateVariables",{get:function(){return this._stateVariables},enumerable:!1,configurable:!0}),CodeBlockInstance.prototype.isLoaded=function(){return Y.isAssetRefLoaded(this._codeBlock)},CodeBlockInstance.prototype.destroy=function(){if(this._stateInitialized){this.executeFunction("onDestroy");for(var n=0,r=Object.values(this._stateVariables);n<r.length;n++){var o=r[n];if(!o.isA||!o.isA(jt)){var i=o[Da.runtimeValueAccessor];i&&i.constructor&&"VertexBuffer"===i.constructor.name&&i.unload()}}}this._codeBlock.asset&&this._codeBlock.asset.pinChanged.detach(this.onCodeBlockPinsChanged),this._codeBlock.detach(),t.prototype.destroy.call(this)},CodeBlockInstance.prototype.onBehaviorStarted=function(){this.initializeStateIfNecessary(),this.executeFunction("onBehaviorStarted")},CodeBlockInstance.prototype.onStart=function(){var t=this.codeBlock;if(this.initializeStateIfNecessary(),t.runtimeError)return this._onStartExecutionPending=!0,dt.Continue;if(t.runtimeError||t.isLoading)return this._onStartExecutionPending=!0,dt.Continue;var n=this.executeFunction("onStart");return void 0!==n?n:t.runtimeError?(this._onStartExecutionPending=!0,dt.Continue):dt.Finish},CodeBlockInstance.prototype.onUpdate=function(){var t=this.codeBlock;if(t.runtimeError||t.isLoading)return dt.Continue;if(this._initStateExecutionPending){if(this.initializeStateIfNecessary(),t.runtimeError)return dt.Continue;this._initStateExecutionPending=!1}if(this._onStartExecutionPending){var n=this.executeFunction("onStart");return void 0!==n?(this._onStartExecutionPending=!1,n):t.runtimeError?dt.Continue:dt.Finish}var r=this.executeFunction("onUpdate");return void 0!==r?r:t.runtimeError?dt.Continue:dt.Finish},CodeBlockInstance.prototype.onFinish=function(){this.executeFunction("onFinish")},CodeBlockInstance.prototype.onSignalReceived=function(t){this.codeBlock.runtimeError||this.executeFunction("onSignalReceived",t)},CodeBlockInstance.prototype.onCodeBlockPinsChanged=function(){var t=this.codeBlock;this._customPins=t.pins.copy(),this._stateInitialized=!1},CodeBlockInstance.prototype.findPin=function(n){var r=t.prototype.findPin.call(this,n);if(!r){var o=this._customPins?this._customPins.data.find((function(t){return t.instance.id===n})):void 0;r=o?o.instance:void 0}return r},CodeBlockInstance.prototype.filterPins=function(n){return t.prototype.filterPins.call(this,n).concat(this._customPins.data.filter((function(t){return n(t.instance)})).map((function(t){return t.instance})))},CodeBlockInstance.prototype.findPinByName=function(n){var r=t.prototype.findPin.call(this,n);if(!r){var o=this._customPins.data.find((function(t){return t.instance.name===n}));r=o?o.instance:void 0}return r},CodeBlockInstance.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_codeBlock:t.properties.codeBlock}),delete t.properties.codeBlock),t},CodeBlockInstance.prototype.setCodeBlock=function(t,n){this._codeBlock.asset=t,this._codeBlock.inline=Boolean(n)},CodeBlockInstance.prototype.executeFunction=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this.codeBlock;try{var i=t+"_"+fa.trimId(o.id);return i in window?(this.initializeStateIfNecessary(),window[i].apply(window,CodeBlockInstance_spreadArray([this._stateVariables,ua.api,_e.createObject,this.sendSignal],n))):void 0}catch(t){o.logRuntimeError("Runtime Error: '"+t.stack+"'")}},CodeBlockInstance.prototype.onCodeBlockChanged=function(t){var n=t.oldAsset;n&&n.pinChanged.detach(this.onCodeBlockPinsChanged);var r=t.newAsset;r&&(this._customPins=r.pins.copy(),this._stateInitialized=!1,r.pinChanged.attach(this.onCodeBlockPinsChanged))},CodeBlockInstance.prototype.initializeStateIfNecessary=function(){if(!this._stateInitialized){var t=this.codeBlock;try{this._stateVariables=ma.initializeCodeBlockInstanceState(t,this.ownerBehavior.ownerComponent.entity,this._customPins,this.sendSignal),this._stateInitialized=!0}catch(n){this._initStateExecutionPending=!0,t.logRuntimeError("Runtime Error: '"+n.stack+"'")}}},CodeBlockInstance_decorate([Attributes_unserializable(),CodeBlockInstance_metadata("design:type",Rt)],CodeBlockInstance.prototype,"_customPins",void 0),CodeBlockInstance_decorate([Attributes_unserializable(),CodeBlockInstance_metadata("design:type",Object)],CodeBlockInstance.prototype,"_stateVariables",void 0),CodeBlockInstance_decorate([Attributes_unserializable(),CodeBlockInstance_metadata("design:type",Object)],CodeBlockInstance.prototype,"_onStartExecutionPending",void 0),CodeBlockInstance_decorate([Attributes_unserializable(),CodeBlockInstance_metadata("design:type",Object)],CodeBlockInstance.prototype,"_initStateExecutionPending",void 0),CodeBlockInstance_decorate([Attributes_unserializable(),CodeBlockInstance_metadata("design:type",Object)],CodeBlockInstance.prototype,"_stateInitialized",void 0),CodeBlockInstance}(rs),as=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),BehaviorOperator_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},BehaviorOperator_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},ss=function(t){function BehaviorOperator(){var n=t.call(this)||this;return n._uniqueBehaviorInstance=null,n._behavior=new K(Os),n.onBehaviorPinsChanged=n.onBehaviorPinsChanged.bind(n),n.onBehaviorInlineVariableChanged=n.onBehaviorInlineVariableChanged.bind(n),n.onBehaviorChanged=n.onBehaviorChanged.bind(n),n._behavior.assetChanged.attach(n.onBehaviorChanged),n}return as(BehaviorOperator,t),Object.defineProperty(BehaviorOperator.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(BehaviorOperator.prototype,"behavior",{get:function(){return this._behavior.asset},set:function(t){this._behavior.asset=t},enumerable:!1,configurable:!0}),Object.defineProperty(BehaviorOperator.prototype,"customPins",{get:function(){return this._customPins},enumerable:!1,configurable:!0}),BehaviorOperator.prototype.destroy=function(){var n=this.behavior;n&&n.inlineVariableChanged.detach(this.onBehaviorInlineVariableChanged),this._behavior.detach(),this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.destroy(),this._uniqueBehaviorInstance=null),t.prototype.destroy.call(this)},BehaviorOperator.prototype.isLoaded=function(){return Y.isAssetRefLoaded(this._behavior)},BehaviorOperator.prototype.onStart=function(){return this._uniqueBehaviorInstance?this._uniqueBehaviorInstance.sendSignal(this._uniqueBehaviorInstance.id,ka.startPinId):(this._uniqueBehaviorInstance=this.behavior.copy(!0),this._uniqueBehaviorInstance.ownerComponent=this.ownerBehavior.ownerComponent,this._uniqueBehaviorInstance.customPins=this._customPins,this._uniqueBehaviorInstance.start()),this.checkIfBehaviorFinished()},BehaviorOperator.prototype.onUpdate=function(){return this._uniqueBehaviorInstance.update(),this.checkIfBehaviorFinished()},BehaviorOperator.prototype.onSignalReceived=function(t){if(this._uniqueBehaviorInstance){var n=this._uniqueBehaviorInstance.activeOperators.length>0;this._uniqueBehaviorInstance.sendSignal(this._uniqueBehaviorInstance.id,t),this._uniqueBehaviorInstance.activeOperators.length>0&&!n&&this.ownerBehavior.activateOperator(this)}},BehaviorOperator.prototype.onCollision=function(t){this._uniqueBehaviorInstance&&this._uniqueBehaviorInstance.onCollision(t)},BehaviorOperator.prototype.onUIEvent=function(t){return!!this._uniqueBehaviorInstance&&this._uniqueBehaviorInstance.onUIEvent(t)},BehaviorOperator.prototype.onBehaviorPinsChanged=function(){this.behavior&&(this._customPins=this.behavior.customPins.copy())},BehaviorOperator.prototype.findPin=function(n){var r=t.prototype.findPin.call(this,n);if(!r){var o=this._customPins?this._customPins.data.find((function(t){return t.instance.id===n})):void 0;r=o?o.instance:void 0}return r},BehaviorOperator.prototype.filterPins=function(n){return t.prototype.filterPins.call(this,n).concat(this._customPins.data.filter((function(t){return n(t.instance)})).map((function(t){return t.instance})))},BehaviorOperator.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_behavior:t.properties.behavior}),delete t.properties.behavior),t},BehaviorOperator.prototype.checkIfBehaviorFinished=function(){var t=this._uniqueBehaviorInstance;return 0===t.activeOperators.length?(t.fetchInputData(t.id),dt.Finish):dt.Continue},BehaviorOperator.prototype.onBehaviorInlineVariableChanged=function(t){if(this._uniqueBehaviorInstance){var n=this.behavior.inlineVariables.data.find((function(n){return n.id===t}));n&&this._uniqueBehaviorInstance.updateInlineVariable(t,n)}},BehaviorOperator.prototype.onBehaviorChanged=function(t){this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.destroy(),this._uniqueBehaviorInstance=null);var n=t.newAsset;n&&(this._customPins=n.customPins.copy())},BehaviorOperator_decorate([Attributes_unserializable(),BehaviorOperator_metadata("design:type",Object)],BehaviorOperator.prototype,"_uniqueBehaviorInstance",void 0),BehaviorOperator_decorate([Attributes_unserializable(),BehaviorOperator_metadata("design:type",Rt)],BehaviorOperator.prototype,"_customPins",void 0),BehaviorOperator}(rs),cs=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),us=function(t){function InlineVariable(){var n=t.call(this)||this;return n.data=new v(At),n.position=new h,n.id=Y.makeUniqueId(),n}return cs(InlineVariable,t),InlineVariable}(z),ls=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ps=function(t){function Converter(){return null!==t&&t.apply(this,arguments)||this}return ls(Converter,t),Converter.prototype.convert=function(){},Converter}(ts),fs=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Collision_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Collision_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},hs=function(t){function Collision(){var n=t.call(this)||this;return n.createPin("_collision",Pt.Output,Et),n.createPin("_collisionInfo",Pt.Output,Qa),n}return fs(Collision,t),Collision.prototype.onCollision=function(t){this._collisionInfo.setData(t),this.sendSignal(this._collision.name)},Collision_decorate([Attributes_unserializable(),Collision_metadata("design:type",Et)],Collision.prototype,"_collision",void 0),Collision_decorate([Attributes_unserializable(),Collision_metadata("design:type",Qa)],Collision.prototype,"_collisionInfo",void 0),Collision}(ts),ds=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),UIEvents_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},UIEvents_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},ys=function(t){function UIEvents(){var n=t.call(this)||this;return n.createPin("_stopPropagation",Pt.Input,Na),n.createPin("_click",Pt.Output,Et),n.createPin("_touchDown",Pt.Output,Et),n.createPin("_touchMove",Pt.Output,Et),n.createPin("_touchUp",Pt.Output,Et),n.createPin("_touchEnter",Pt.Output,Et),n.createPin("_touchLeave",Pt.Output,Et),n.createPin("_longPress",Pt.Output,Et),n.createPin("_target",Pt.Output,Xa),n.createPin("_touchPos",Pt.Output,Va),n}return ds(UIEvents,t),Object.defineProperty(UIEvents.prototype,"stopPropagation",{get:function(){return this._stopPropagation.getData()},enumerable:!1,configurable:!0}),UIEvents_decorate([Attributes_unserializable(),UIEvents_metadata("design:type",Et)],UIEvents.prototype,"_touchDown",void 0),UIEvents_decorate([Attributes_unserializable(),UIEvents_metadata("design:type",Et)],UIEvents.prototype,"_click",void 0),UIEvents_decorate([Attributes_unserializable(),UIEvents_metadata("design:type",Et)],UIEvents.prototype,"_touchMove",void 0),UIEvents_decorate([Attributes_unserializable(),UIEvents_metadata("design:type",Et)],UIEvents.prototype,"_touchUp",void 0),UIEvents_decorate([Attributes_unserializable(),UIEvents_metadata("design:type",Et)],UIEvents.prototype,"_touchEnter",void 0),UIEvents_decorate([Attributes_unserializable(),UIEvents_metadata("design:type",Et)],UIEvents.prototype,"_touchLeave",void 0),UIEvents_decorate([Attributes_unserializable(),UIEvents_metadata("design:type",Et)],UIEvents.prototype,"_longPress",void 0),UIEvents_decorate([Attributes_unserializable(),UIEvents_metadata("design:type",Xa)],UIEvents.prototype,"_target",void 0),UIEvents_decorate([Attributes_unserializable(),UIEvents_metadata("design:type",Va)],UIEvents.prototype,"_touchPos",void 0),UIEvents_decorate([Attributes_unserializable(),UIEvents_metadata("design:type",Na)],UIEvents.prototype,"_stopPropagation",void 0),UIEvents=UIEvents_decorate([displayName("UI Events"),UIEvents_metadata("design:paramtypes",[])],UIEvents)}(ts),ms=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),CodeBlockConverter_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},CodeBlockConverter_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},vs=function(t){function CodeBlockConverter(){var n=t.call(this)||this;return n._code="\nfunction convert() {                \n}\n",n}return ms(CodeBlockConverter,t),CodeBlockConverter=CodeBlockConverter_decorate([displayName("Converter"),CodeBlockConverter_metadata("design:paramtypes",[])],CodeBlockConverter)}(ya),gs=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),CodeBlockConverterInstance_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},CodeBlockConverterInstance_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},CodeBlockConverterInstance_spreadArray=function(t,n){for(var r=0,o=n.length,i=t.length;r<o;r++,i++)t[i]=n[r];return t},_s=function(t){function CodeBlockConverterInstance(){var n=t.call(this)||this;return n._stateInitialized=!1,n._codeBlock=new K(vs),n.sendSignal=n.sendSignal.bind(n),n.onCodeBlockPinsChanged=n.onCodeBlockPinsChanged.bind(n),n.onCodeBlockChanged=n.onCodeBlockChanged.bind(n),n._codeBlock.assetChanged.attach(n.onCodeBlockChanged),n}return gs(CodeBlockConverterInstance,t),Object.defineProperty(CodeBlockConverterInstance.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlockConverterInstance.prototype,"codeBlock",{get:function(){return this._codeBlock.asset},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlockConverterInstance.prototype,"codeBlockRef",{get:function(){return this._codeBlock},enumerable:!1,configurable:!0}),Object.defineProperty(CodeBlockConverterInstance.prototype,"customPins",{get:function(){return this._customPins},enumerable:!1,configurable:!0}),CodeBlockConverterInstance.prototype.destroy=function(){if(this._stateInitialized){this.executeFunction("onDestroy");for(var n=0,r=Object.keys(this._stateVariables);n<r.length;n++){var o=r[n],i=this._stateVariables[o].value;i&&i.constructor&&"VertexBuffer"===i.constructor.name&&i.unload()}}this._codeBlock.asset&&this._codeBlock.asset.pinChanged.detach(this.onCodeBlockPinsChanged),this._codeBlock.detach(),t.prototype.destroy.call(this)},CodeBlockConverterInstance.prototype.isLoaded=function(){return Y.isAssetRefLoaded(this._codeBlock)},CodeBlockConverterInstance.prototype.convert=function(){this.codeBlock.runtimeError||this.executeFunction("convert")},CodeBlockConverterInstance.prototype.onSignalReceived=function(t){this.codeBlock.runtimeError||this.executeFunction("onSignalReceived",t)},CodeBlockConverterInstance.prototype.onCodeBlockPinsChanged=function(){this.codeBlock&&(this._customPins=this.codeBlock.pins.copy())},CodeBlockConverterInstance.prototype.findPin=function(n){var r=t.prototype.findPin.call(this,n);if(!r){var o=this._customPins?this._customPins.data.find((function(t){return t.instance.id===n})):void 0;r=o?o.instance:void 0}return r},CodeBlockConverterInstance.prototype.filterPins=function(n){return t.prototype.filterPins.call(this,n).concat(this._customPins.data.filter((function(t){return n(t.instance)})).map((function(t){return t.instance})))},CodeBlockConverterInstance.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_codeBlock:t.properties.codeBlock}),delete t.properties.codeBlock),t},CodeBlockConverterInstance.prototype.setCodeBlock=function(t,n){this._codeBlock.asset=t,this._codeBlock.inline=Boolean(n)},CodeBlockConverterInstance.prototype.executeFunction=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=this.codeBlock;try{var i=t+"_"+fa.trimId(o.id);return i in window?(this.initializeStateIfNecessary(),window[i].apply(window,CodeBlockConverterInstance_spreadArray([this._stateVariables,ua.api,_e.createObject,this.sendSignal],n))):void 0}catch(t){o.logRuntimeError("Runtime Error: '"+t.stack+"'")}},CodeBlockConverterInstance.prototype.onCodeBlockChanged=function(t){var n=t.oldAsset;n&&n.pinChanged.detach(this.onCodeBlockPinsChanged);var r=t.newAsset;r&&(this._customPins=r.pins.copy(),this._stateInitialized=!1,r.pinChanged.attach(this.onCodeBlockPinsChanged))},CodeBlockConverterInstance.prototype.initializeStateIfNecessary=function(){this._stateInitialized||(this._stateVariables=ma.initializeCodeBlockInstanceState(this.codeBlock,this.ownerBehavior.ownerComponent.entity,this._customPins,this.sendSignal),this._stateInitialized=!0)},CodeBlockConverterInstance_decorate([Attributes_unserializable(),CodeBlockConverterInstance_metadata("design:type",Rt)],CodeBlockConverterInstance.prototype,"_customPins",void 0),CodeBlockConverterInstance_decorate([Attributes_unserializable(),CodeBlockConverterInstance_metadata("design:type",Object)],CodeBlockConverterInstance.prototype,"_stateVariables",void 0),CodeBlockConverterInstance_decorate([Attributes_unserializable(),CodeBlockConverterInstance_metadata("design:type",Object)],CodeBlockConverterInstance.prototype,"_stateInitialized",void 0),CodeBlockConverterInstance}(ps),bs=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Connection_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Connection_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t[t.Signal=0]="Signal",t[t.Data=1]="Data"}(ns||(ns={}));var ws=function(t){function Connection(n,r,o){var i=t.call(this)||this;return i.src=n||new St,i.dest=r||new St,i.type=o||ns.Signal,i.id=Y.makeUniqueId(),i}return bs(Connection,t),Connection_decorate([Attributes_unserializable(),Connection_metadata("design:type",String)],Connection.prototype,"id",void 0),Connection}(z),xs=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Behavior_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Behavior_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Ps=void 0;var Os=function(t){function Behavior(){var n=t.call(this)||this;return n.inputsPosition=new h,n.outputsPosition=new h(150,150),n.pinChanged=new W.VoidAsyncEvent,n.inlineVariableChanged=new W.AsyncEvent,n._operators=new Rt(ts),n._customPins=new Rt(At),n._connections=new xt(ws),n._inlineVariables=new xt(us),n._pins=new Rt(At),n._activeOperators=[],n._finishedOperators=[],n._pins.grow(new Et(ka.startPinId,Pt.Input)),n}var n;return xs(Behavior,t),n=Behavior,Object.defineProperty(Behavior.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(Behavior.prototype,"operators",{get:function(){return this._operators.data},enumerable:!1,configurable:!0}),Object.defineProperty(Behavior.prototype,"connections",{get:function(){return this._connections.data},enumerable:!1,configurable:!0}),Object.defineProperty(Behavior.prototype,"pins",{get:function(){return this._pins},enumerable:!1,configurable:!0}),Object.defineProperty(Behavior.prototype,"customPins",{get:function(){return this._customPins},set:function(t){this._customPins=t},enumerable:!1,configurable:!0}),Object.defineProperty(Behavior.prototype,"inlineVariables",{get:function(){return this._inlineVariables},enumerable:!1,configurable:!0}),Object.defineProperty(Behavior.prototype,"activeOperators",{get:function(){return this._activeOperators},enumerable:!1,configurable:!0}),Object.defineProperty(Behavior.prototype,"ownerComponent",{get:function(){return this._ownerComponent},set:function(t){this._ownerComponent=t},enumerable:!1,configurable:!0}),Behavior.isConnectionValid=function(t,n,r){if(n.operatorId!==r.operatorId){var o=t.findPin(n.operatorId,n.pinId),i=t.findPin(r.operatorId,r.pinId);if(o&&i){var a=t.id;if(n.operatorId===a||r.operatorId===a){if(o.type===i.type)return ma.pinsHaveSameType(o,i)}else if(o.type!==i.type)return ma.pinsHaveSameType(o,i)}}return!1},Behavior.prototype.sendSignal=function(t,n){var r=this._signalConnectionMap[t];if(Boolean(r)){var o=r[n];if(Boolean(o))for(var i=0,a=o;i<a.length;i++){var c=a[i],u=this.findOperator(c.operatorId);u&&(this.fetchInputData(u.id),this.activateInputPin(u,c.pinId))}}},Behavior.prototype.fetchInputData=function(t){var n=this._dataConnectionMap[t];if(n)for(var r=0,o=Object.keys(n);r<o.length;r++){var i=o[r],a=n[i],c=void 0,u=void 0;if(a.operatorId===this.id)c=this.findBehaviorPin(a.pinId);else{var l=this.findOperator(a.operatorId);l?(c=l.findPin(a.pinId),l.isA(ps)&&(u=l)):c=this.findVariablePin(a.operatorId)}if(c)if(c.isA(jt)){var f=a.operatorId===this.id?Pt.Input:Pt.Output;if(c.type!==f)p.log("Trying to get data from an input pin "+c.name);else{u&&(this.fetchInputData(u.id),u.convert(),this.checkCodeBlockError(u));var h=c.getData(),d=this.findPin(t,i);if(d)if(d.isA(jt)){var y=t===this.id?Pt.Output:Pt.Input;d.type!==y?p.log("Trying to set data on an output pin "+d.name):d.setData(h)}else p.log("Trying to set data on a signal pin "+d.name)}}else p.log("Trying to get data from a signal pin "+c.name)}},Behavior.prototype.activateOperator=function(t){this._activeOperators.indexOf(t)>=0||this._activeOperators.push(t)},Behavior.prototype.setProperty=function(n,r){if(t.prototype.setProperty.call(this,n,r),"_operators"===n)for(var o=0,i=this._operators.data;o<i.length;o++){var a=i[o];a.instance&&(a.instance.ownerBehavior=this)}},Behavior.prototype.isLoaded=function(){for(var t=0,n=this._operators.data;t<n.length;t++){if(!n[t].instance.isLoaded())return!1}for(var r=0,o=this._inlineVariables.data;r<o.length;r++){var i=o[r];if(!ma.isPinLoaded(i.data.instance))return!1}return!0},Behavior.prototype.start=function(){this.buildConnectionMaps();for(var t=0,n=this._operators.data;t<n.length;t++){var r=n[t].instance;this.fetchInputData(r.id),r.onBehaviorStarted()}var o=this._signalConnectionMap[this.id];if(Boolean(o)){var i=o[ka.startPinId];if(Boolean(i))for(var a=0,c=i;a<c.length;a++){var u=c[a];(r=this.findOperator(u.operatorId))&&this.activateInputPin(r,u.pinId)}}},Behavior.prototype.update=function(){this._finishedOperators.length=0;for(var t=0,n=this._activeOperators;t<n.length;t++){var r=n[t];this.fetchInputData(r.id);var o=r.onUpdate();this.checkCodeBlockError(r),o===dt.Finish&&this._finishedOperators.push(r)}if(this._finishedOperators.length>0)for(var i=0,a=this._finishedOperators;i<a.length;i++){r=a[i];var c=this._activeOperators.indexOf(r);console.assert(c>=0),this._activeOperators.splice(c,1),this.finishOperator(r)}},Behavior.prototype.addConnection=function(t){this._connections.grow(t)},Behavior.prototype.removeConnection=function(t){var n=this._connections.data.indexOf(t);return n>=0&&this._connections.data.splice(n,1),this.clearOrphanVariables()},Behavior.prototype.removeVariable=function(t){for(var n=0;n<this._connections.data.length;){var r=this._connections.data[n];r.src.operatorId===t.id||r.dest.operatorId===t.id?this._connections.data.splice(n,1):++n}for(n=0;n<this._inlineVariables.data.length;++n){if(this._inlineVariables.data[n].id===t.id){this._inlineVariables.data.splice(n,1);break}}},Behavior.prototype.removeNode=function(t){for(var n=[],r=0;r<this._connections.data.length;){var o=this._connections.data[r];o.src.operatorId===t.id||o.dest.operatorId===t.id?(n.push(o),this._connections.data.splice(r,1)):++r}for(r=0;r<this._operators.data.length;++r){var i=this._operators.data[r];if(i.instance&&i.instance===t){this._operators.data.splice(r,1);break}}return{removedConnections:n,removedVariables:this.clearOrphanVariables()}},Behavior.prototype.clearOrphanVariables=function(){for(var t=[],n=0;n<this._inlineVariables.data.length;){for(var r=0,o=this._inlineVariables.data[n],i=0,a=this._connections.data;i<a.length;i++){var c=a[i];c.src.operatorId!==o.id&&c.dest.operatorId!==o.id||++r}0===r?(this._inlineVariables.data.splice(n,1),t.push(o)):++n}return t},Behavior.prototype.addNode=function(t){this._operators.grow(t),t.ownerBehavior=this},Behavior.prototype.addVariable=function(t){this._inlineVariables.grow(t)},Behavior.prototype.findOperator=function(t){for(var n=0,r=this._operators.data;n<r.length;n++){var o=r[n];if(o.instance&&o.instance.id===t)return o.instance}},Behavior.prototype.findVariable=function(t){return this._inlineVariables.data.find((function(n){return n.id===t}))},Behavior.prototype.findPin=function(t,n){if(t===this.id)return this.findBehaviorPin(n);var r=this.findOperator(t);return r?r.findPin(n):this.findVariablePin(t)},Behavior.prototype.copy=function(n){var r=this.id,o=t.prototype.copy.call(this);if(!0!==n)for(var i=o.id,a=0,c=o._connections.data;a<c.length;a++){var u=c[a];u.src.operatorId===r?u.src.operatorId=i:u.dest.operatorId===r&&(u.dest.operatorId=i)}else o.id=r;return o},Behavior.prototype.deserialize=function(n){return t.prototype.deserialize.call(this,n)},Behavior.prototype.updateInlineVariable=function(t,n){var r=this._inlineVariables.data.find((function(n){return n.id===t}));if(r){var o=r.data.instance,i=n.data.instance;o.setData(i.getData())}},Behavior.prototype.destroy=function(){for(var n=0,r=this._operators.data;n<r.length;n++){r[n].instance.destroy()}t.prototype.destroy.call(this)},Behavior.prototype.onCollision=function(t){for(var n=0,r=this._operators.data;n<r.length;n++){var o=r[n].instance;(o.isA(hs)||o.isA(ss))&&o.onCollision(t)}},Behavior.prototype.onUIEvent=function(t){for(var n=!1,r=0,o=this._operators.data;r<o.length;r++){var i=o[r].instance;if(i.isA(ys)){if(t(i)){n=!0;break}}else if(i.isA(ss)){if(i.onUIEvent(t)){n=!0;break}}}return n},Behavior.prototype.upgrade=function(t,n){if(1===n)for(var r=0,o=t.properties._operators.data;r<o.length;r++){var i=o[r];"ScreenToWorldRay"===i.data.typeName&&(i.data.typeName="ScreenToRay")}return t},Behavior.prototype.startOperator=function(t){var n=t.onStart();this.checkCodeBlockError(t),n===dt.Continue?this.activateOperator(t):this.finishOperator(t)},Behavior.prototype.finishOperator=function(t){t.onFinish(),this.sendSignal(t.id,ka.finishPinId)},Behavior.prototype.checkCodeBlockError=function(t){},Behavior.prototype.activateInputPin=function(t,n){if(n===ka.startPinId)this.startOperator(t);else{var r=t.findPin(n);r&&(t.onSignalReceived(r.name),this.checkCodeBlockError(t))}},Behavior.prototype.buildConnectionMaps=function(){var t,r,o,i,a,c;this._signalConnectionMap={},this._dataConnectionMap={};for(var u=0,l=this._connections.data;u<l.length;u++){var p=l[u];if(n.isConnectionValid(this,p.src,p.dest))if(p.type===ns.Signal){var f=p.src.operatorId,h=p.src.pinId,d={operatorId:p.dest.operatorId,pinId:p.dest.pinId};f in this._signalConnectionMap?h in this._signalConnectionMap[f]?this._signalConnectionMap[f][h].push(d):Object.assign(this._signalConnectionMap[f],((t={})[h]=[d],t)):Object.assign(this._signalConnectionMap,((r={})[f]=((o={})[h]=[d],o),r))}else{var y=p.dest.operatorId,m=p.dest.pinId,v={operatorId:p.src.operatorId,pinId:p.src.pinId};y in this._dataConnectionMap?m in this._dataConnectionMap[y]?this._dataConnectionMap[y][m]=v:Object.assign(this._dataConnectionMap[y],((i={})[m]=v,i)):Object.assign(this._dataConnectionMap,((a={})[y]=((c={})[m]=v,c),a))}}},Behavior.prototype.findBehaviorPin=function(t){var n=this._pins.data.find((function(n){return!!n.instance&&n.instance.id===t}));return n||(n=this._customPins.data.find((function(n){return!!n.instance&&n.instance.id===t}))),n?n.instance:void 0},Behavior.prototype.findVariablePin=function(t){var n=this.findVariable(t);return n?n.data.instance:void 0},Behavior.prototype.recordSignalFired=function(t,n,r,o){var i={timeStamp:Date.now(),entityId:this._ownerComponent.entity.id,behaviorPath:this.templatePath,srcOperatorId:t,srcPinId:n,destOperatorId:r,destPinId:o};localStorage.setItem("secondary_editor_signal_fired",JSON.stringify(i)),Ps.signalFired.post(i)},Behavior_decorate([Attributes_unserializable(),Behavior_metadata("design:type",Object)],Behavior.prototype,"pinChanged",void 0),Behavior_decorate([Attributes_unserializable(),Behavior_metadata("design:type",Object)],Behavior.prototype,"inlineVariableChanged",void 0),Behavior_decorate([Attributes_unserializable(),Behavior_metadata("design:type",Object)],Behavior.prototype,"_pins",void 0),Behavior_decorate([Attributes_unserializable(),Behavior_metadata("design:type",Object)],Behavior.prototype,"_signalConnectionMap",void 0),Behavior_decorate([Attributes_unserializable(),Behavior_metadata("design:type",Object)],Behavior.prototype,"_dataConnectionMap",void 0),Behavior_decorate([Attributes_unserializable(),Behavior_metadata("design:type",Object)],Behavior.prototype,"_ownerComponent",void 0),Behavior_decorate([Attributes_unserializable(),Behavior_metadata("design:type",Array)],Behavior.prototype,"_activeOperators",void 0),Behavior_decorate([Attributes_unserializable(),Behavior_metadata("design:type",Array)],Behavior.prototype,"_finishedOperators",void 0),Behavior=n=Behavior_decorate([hasDedicatedEditor(!0),Behavior_metadata("design:paramtypes",[])],Behavior)}(nt),Cs=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),BehaviorComponent_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},BehaviorComponent_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Ss=void 0;var As,Es=function(t){function BehaviorComponent(){var n=t.call(this)||this;return n.autoStart=!0,n._customPins=new Rt(At),n._uniqueBehaviorInstance=null,n._behavior=new K(Os),n.onBehaviorPinChanged=n.onBehaviorPinChanged.bind(n),n.onBehaviorInlineVariableChanged=n.onBehaviorInlineVariableChanged.bind(n),n.onBehaviorChanged=n.onBehaviorChanged.bind(n),n._behavior.assetChanged.attach(n.onBehaviorChanged),n}return Cs(BehaviorComponent,t),Object.defineProperty(BehaviorComponent.prototype,"version",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(BehaviorComponent.prototype,"behavior",{get:function(){return this._behavior.asset},set:function(t){this._behavior.asset=t},enumerable:!1,configurable:!0}),Object.defineProperty(BehaviorComponent.prototype,"customPins",{get:function(){return this._customPins},enumerable:!1,configurable:!0}),Object.defineProperty(BehaviorComponent.prototype,"activeOperators",{get:function(){return this.behavior?this.behavior.activeOperators:[]},enumerable:!1,configurable:!0}),BehaviorComponent.prototype.isLoaded=function(){if(!t.prototype.isLoaded.call(this))return!1;if(this._customPins)for(var n=0,r=this._customPins.data;n<r.length;n++){var o=r[n];if(!ma.isPinLoaded(o.instance))return!1}return Y.isAssetRefLoaded(this._behavior)},BehaviorComponent.prototype.destroy=function(){var n=this.behavior;n&&(n.pinChanged.detach(this.onBehaviorPinChanged),n.inlineVariableChanged.detach(this.onBehaviorInlineVariableChanged)),this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.destroy(),this._uniqueBehaviorInstance=null),this._behavior.detach(),t.prototype.destroy.call(this)},BehaviorComponent.prototype.start=function(){var t=this.behavior;t&&(this._uniqueBehaviorInstance?this._uniqueBehaviorInstance.sendSignal(this._uniqueBehaviorInstance.id,ka.startPinId):(this._uniqueBehaviorInstance=t.copy(!0),this._uniqueBehaviorInstance.ownerComponent=this,this._customPins?this._uniqueBehaviorInstance.customPins=this._customPins:p.logWarning("BehaviorComponent.start: undefined customPins"),this._uniqueBehaviorInstance.start()))},BehaviorComponent.prototype.update=function(){this.behavior&&(this._uniqueBehaviorInstance?this._uniqueBehaviorInstance.update():this.autoStart&&this.start())},BehaviorComponent.prototype.onCollision=function(t){this._uniqueBehaviorInstance&&this._uniqueBehaviorInstance.onCollision(t)},BehaviorComponent.prototype.onUIEvent=function(t){return!!this._uniqueBehaviorInstance&&this._uniqueBehaviorInstance.onUIEvent(t)},BehaviorComponent.prototype.sendSignal=function(t){this._uniqueBehaviorInstance||this.start();var n=this._uniqueBehaviorInstance,r=n.customPins.data.find((function(n){return n.instance.name===t}));r?n.sendSignal(n.id,r.instance.id):p.logWarning("Could not fire signal '"+t+"' (pin not found)")},BehaviorComponent.prototype.getPins=function(){return this._customPins},BehaviorComponent.prototype.setPins=function(t){this._customPins=t},BehaviorComponent.prototype.findPinByName=function(t){for(var n=0,r=this._customPins.data;n<r.length;n++){var o=r[n].instance;if(o.name===t)return o}},BehaviorComponent.prototype.upgrade=function(t,n){if(1===n)Object.assign(t.properties,{_behavior:t.properties.behavior}),delete t.properties.behavior;else if(2===n){var r=t.properties._customPins,o=t.properties._behavior;delete t.properties._customPins,delete t.properties._behavior,t.properties._customPins=r.data,t.properties._behavior=o}return t},BehaviorComponent.prototype.onBehaviorChanged=function(t){this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.destroy(),this._uniqueBehaviorInstance=null);var n=t.newAsset;n&&this.buildCustomPins(n)},BehaviorComponent.prototype.buildCustomPins=function(t){for(var n=new Rt(At),r=[],_loop_1=function(t){var i=t.instance;if(i){var a=void 0;if(o._customPins){var c=o._customPins.data.find((function(t){return t.instance.id===i.id})),u=c?c.instance:void 0;u&&u.type===i.type&&ma.pinsHaveSameType(u,i)&&((a=u).name=i.name)}a?n.grow(a):(n.grow(i.copy()),r.push(i.id))}},o=this,i=0,a=t.customPins.data;i<a.length;i++){_loop_1(a[i])}return this._customPins=n,ma.updatePinAccessors(this),r},BehaviorComponent.prototype.onBehaviorPinChanged=function(){var t=this.behavior,n=this.buildCustomPins(t);this._uniqueBehaviorInstance&&(this._uniqueBehaviorInstance.customPins=this._customPins),Ss&&Ss.behaviorComponentPinsChanged.post({ownerId:t.id,pinIds:n})},BehaviorComponent.prototype.onBehaviorInlineVariableChanged=function(t){if(this._uniqueBehaviorInstance){var n=this.behavior.inlineVariables.data.find((function(n){return n.id===t}));n&&this._uniqueBehaviorInstance.updateInlineVariable(t,n)}},BehaviorComponent_decorate([Attributes_hidden(),BehaviorComponent_metadata("design:type",Object)],BehaviorComponent.prototype,"_customPins",void 0),BehaviorComponent_decorate([Attributes_unserializable(),BehaviorComponent_metadata("design:type",Object)],BehaviorComponent.prototype,"_uniqueBehaviorInstance",void 0),BehaviorComponent=BehaviorComponent_decorate([helpUrl("https://docs.spiderengine.io/behavior.html"),BehaviorComponent_metadata("design:paramtypes",[])],BehaviorComponent)}(fn),js=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Ts=function(t){function HudControl(n){var r=t.call(this)||this;return r.name=n,r}return js(HudControl,t),HudControl}(z),Rs=function(t){function HudNumber(n,r,o,i,a){var c=t.call(this,n)||this;return c.initialValue=r,c.min=o,c.max=i,c.onChanged=a,c}return js(HudNumber,t),HudNumber}(Ts),Bs=function(t){function HudBoolean(n,r,o){var i=t.call(this,n)||this;return i.initialValue=r,i.onChanged=o,i}return js(HudBoolean,t),HudBoolean}(Ts),Ms=function(t){function HudCommand(n,r){var o=t.call(this,n)||this;return o.onTriggered=r,o}return js(HudCommand,t),HudCommand}(Ts);!function(t){var n,r,o;t.hud=null,t.constrolsInitializedOnce=!1,t.hudAssets=[{path:"Assets/DefaultAssets/Hud/Prefabs/EngineHud.Prefab",set:function(n){return t.hudPrefab=n},get:function(){return t.hudPrefab}},{path:"Assets/DefaultAssets/Hud/Prefabs/Property.Prefab",set:function(n){return t.hudProperty=n},get:function(){return t.hudProperty}}],t.factory={HudCommand:{path:"Assets/DefaultAssets/Hud/Controls/Command/Command.Prefab",set:function(t){return n=t},get:function(){return n}},HudNumber:{path:"Assets/DefaultAssets/Hud/Controls/Slider/Slider.Prefab",set:function(t){return r=t},get:function(){return r}},HudBoolean:{path:"Assets/DefaultAssets/Hud/Controls/CheckBox/CheckBox.Prefab",set:function(t){return o=t},get:function(){return o}}},t.getHudAsset=function getHudAsset(n){return n in t.factory?t.factory[n].get():(console.assert(!1,"getHudAsset('"+n+"') returned null."),null)}}(As||(As={}));var Is,zs,ks,Ds,Fs,Ls=function(){function EngineHud(){}return EngineHud.load=function(){return Promise.all(Object.keys(As.factory).map((function(t){return new Promise((function(n,r){yt.instance.loadObject(As.factory[t].path).then((function(r){As.factory[t].set(r[0]),n()})).catch(r)}))}))).then((function(){return Promise.all(As.hudAssets.map((function(t){return new Promise((function(n,r){yt.instance.loadObject(t.path).then((function(r){t.set(r[0]),n()})).catch(r)}))})))}))},EngineHud.isLoaded=function(){for(var t=0,n=Object.keys(As.hudAssets);t<n.length;t++){var r=n[t];if(!As.hudAssets[r].get().isLoaded())return!1}return!0},EngineHud.create=function(){return console.assert(!As.hud),As.hudPrefab?(As.hud=Ra.create({prefab:As.hudPrefab}),As.hud):null},EngineHud.setControls=function(t){if(As.hud||(As.hud=EngineHud.create(),As.hud)){var n=As.hud.getComponent(Es),r=n.list;r.removeAllChildren();for(var o=4,_loop_1=function(n){var i=t[n],a=Ra.create({prefab:As.getHudAsset(i.constructor.name)}),c=null;if(i.isA(Rs)){var u=i;(c=Ra.create({prefab:As.hudProperty})).findChild("Name").getComponent(bi).text=u.name,Object.assign(Oa.setComponentByName(a,"Proxy"),{onChanged:function(t){var n=i.onChanged;if(n)return n(t)}});var l=a.getComponent(Es);l.initialValue=u.initialValue,l.min=u.min,l.max=u.max,Object.assign(l,{initialValue:u.initialValue}),c.findChild("Value").addChild(a)}else if(i.isA(Bs)){var p=i;(c=Ra.create({prefab:As.hudProperty})).findChild("Name").getComponent(bi).text=p.name,Object.assign(Oa.setComponentByName(a,"Proxy"),{onChanged:function(t){var n=i.onChanged;n&&n(t)}}),a.getComponent(Ri).isChecked=p.initialValue,c.findChild("Value").addChild(a)}else i.isA(Ms)&&((c=a).findChild("Text").getComponent(bi).text=i.name,Object.assign(Oa.setComponentByName(c,"Proxy"),{onClicked:function(){i.onTriggered()}}));c&&(c.getComponent(Mo).offset.y=o,r.addChild(c),o+=34)},i=0;i<t.length;++i)_loop_1(i);var a=r.getComponent(Mo);a.height.value=o;var c=n.close;if(c.getComponent(Mo).offset.y=a.offset.y+o,!As.constrolsInitializedOnce){r.active=!0;var u=r.getComponent(Pn);u.playAnimation(0),u.animationFinished.once((function(){return c.active=!0})),As.constrolsInitializedOnce=!0}}},EngineHud.onSceneDestroyed=function(){As.hud=null,As.constrolsInitializedOnce=!1},EngineHud}();(zs=Is||(Is={})).materials||(zs.materials={}),zs.shaders||(zs.shaders={}),zs.primitives||(zs.primitives={}),function(t){t.definitions=[{path:"Assets/DefaultAssets/Materials/Particles.Material",set:function(t){return Is.materials.particles=t},get:function(){return Is.materials.particles}},{path:"Assets/DefaultAssets/Materials/UI.Material",set:function(t){return Is.materials.ui=t},get:function(){return Is.materials.ui}},{path:"Assets/DefaultAssets/Materials/Sky.Material",set:function(t){return Is.materials.sky=t},get:function(){return Is.materials.sky}},{path:"Assets/DefaultAssets/Materials/CubeMap.Material",set:function(t){return Is.materials.cubeMap=t},get:function(){return Is.materials.cubeMap}},{path:"Assets/DefaultAssets/Shaders/RenderDepth.Shader",set:function(t){return Is.shaders.renderDepth=t},get:function(){return Is.shaders.renderDepth}},{path:"Assets/DefaultAssets/Shaders/SkinnedRenderDepth.Shader",set:function(t){return Is.shaders.skinnedRenderDepth=t},get:function(){return Is.shaders.skinnedRenderDepth}},{path:"Assets/DefaultAssets/Shaders/FullScreen.Shader",set:function(t){return Is.shaders.fullScreen=t},get:function(){return Is.shaders.fullScreen}},{path:"Assets/DefaultAssets/Shaders/PostFX/BloomStep1.Shader",set:function(t){return Is.shaders.bloom=t},get:function(){return Is.shaders.bloom}},{path:"Assets/DefaultAssets/Shaders/PostFX/Blur.Shader",set:function(t){return Is.shaders.blur=t},get:function(){return Is.shaders.blur}},{path:"Assets/DefaultAssets/Shaders/PostFX/Compose.Shader",set:function(t){return Is.shaders.compose=t},get:function(){return Is.shaders.compose}},{path:"Assets/DefaultAssets/Shaders/Phong.PhongShader",set:function(t){return Is.shaders.phong=t},get:function(){return Is.shaders.phong}},{path:"Assets/DefaultAssets/Shaders/Diffuse.Shader",set:function(t){return Is.shaders.diffuse=t},get:function(){return Is.shaders.diffuse}},{path:"Assets/DefaultAssets/Shaders/DynamicCubemap.Shader",set:function(t){return Is.shaders.dynamicCubemap=t},get:function(){return Is.shaders.dynamicCubemap}},{path:"Assets/DefaultAssets/Shaders/SkinnedDynamicCubemap.Shader",set:function(t){return Is.shaders.skinnedDynamicCubemap=t},get:function(){return Is.shaders.skinnedDynamicCubemap}},{path:"Assets/DefaultAssets/Geometry/Meshes/Cube.StaticMeshAsset",set:function(t){return Is.primitives.box=t},get:function(){return Is.primitives.box}},{path:"Assets/DefaultAssets/Geometry/Meshes/Sphere.StaticMeshAsset",set:function(t){return Is.primitives.sphere=t},get:function(){return Is.primitives.sphere}},{path:"Assets/DefaultAssets/Geometry/Meshes/Plane.StaticMeshAsset",set:function(t){return Is.primitives.plane=t},get:function(){return Is.primitives.plane}},{path:"Assets/DefaultAssets/Geometry/Meshes/Cone.StaticMeshAsset",set:function(t){return Is.primitives.cone=t},get:function(){return Is.primitives.cone}},{path:"Assets/DefaultAssets/Textures/WhiteSquare.Texture2D",set:function(t){return Is.whiteTexture=t},get:function(){return Is.whiteTexture}},{path:"Assets/DefaultAssets/Transition/Transition.Scene",set:function(t){return Is.transitionScene=t},get:function(){return Is.transitionScene}},{path:"Assets/DefaultAssets/Prefabs/CubemapCaptureRig.Prefab",set:function(t){return Is.cubemapCaptureRig=t},get:function(){return Is.cubemapCaptureRig}}],t.isLoaded=!1}(ks||(ks={})),(Fs=Ds||(Ds={})).load=function load(){return Promise.all(ks.definitions.map((function(t){return yt.instance.loadObject(t.path).then((function(n){var r=n[0];return t.set(r)}))}))).then((function(){return Ls.load()}))},Fs.isLoaded=function isLoaded(){if(ks.isLoaded)return!0;for(var t=0,n=ks.definitions;t<n.length;t++)if(!n[t].get().isLoaded())return!1;return!!Ls.isLoaded()&&(ks.isLoaded=!0,!0)};var Ns,Vs=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),PostEffects_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},PostEffects_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Us=function(t){function Bloom(){var n=null!==t&&t.apply(this,arguments)||this;return n.intensity=.2,n}return Vs(Bloom,t),Bloom.prototype.render=function(t,n){return null},Bloom}(z),Ws=function(t){function FastBloom(){var n=null!==t&&t.apply(this,arguments)||this;return n.threshold=.9,n._downSample=8,n}return Vs(FastBloom,t),Object.defineProperty(FastBloom.prototype,"downSample",{set:function(t){var n=Math.max(t,1);if(this._buffer1&&n!==this._downSample){var r=this._buffer1.getWidth()*this._downSample/n,o=this._buffer1.getHeight()*this._downSample/n,i=new lt(it.Absolute,r),a=new lt(it.Absolute,o);this._buffer1.width=i,this._buffer1.height=a,this._buffer2.width=i,this._buffer2.height=a}this._downSample=n},enumerable:!1,configurable:!0}),FastBloom.prototype.render=function(t,n){if(!this._buffer1){var r=t.getWidth()/this._downSample,o=t.getHeight()/this._downSample,i=new lt(it.Absolute,r),a=new lt(it.Absolute,o);this._buffer1=new gt(i,a,!1,!1),this._buffer2=new gt(i,a,!1,!1)}var c=mt.renderer,u=Is.shaders.fullScreen;if(!u.begin())return null;c.setRenderTarget(this._buffer1),u.applyReferenceParam("texture",t),u.applyParam("threshold",this.threshold),on.drawVertexBuffer(n,u);var l=Is.shaders.blur;if(!l.begin())return null;var p=h.fromPool().set(1/this._buffer1.getWidth(),1/this._buffer1.getHeight());return c.setRenderTarget(this._buffer2),l.applyParam("horizontal",!0),l.applyReferenceParam("texture",this._buffer1),l.applyParam("pixelSize",p),on.drawVertexBuffer(n,l),c.setRenderTarget(this._buffer1),l.applyParam("horizontal",!1),l.applyReferenceParam("texture",this._buffer2),on.drawVertexBuffer(n,l),this._buffer1},FastBloom.prototype.destroy=function(){this._buffer1&&this._buffer1.destroy(),this._buffer2&&this._buffer2.destroy()},PostEffects_decorate([Attributes_unserializable(),PostEffects_metadata("design:type",gt)],FastBloom.prototype,"_buffer1",void 0),PostEffects_decorate([Attributes_unserializable(),PostEffects_metadata("design:type",gt)],FastBloom.prototype,"_buffer2",void 0),FastBloom}(Us),qs=function(t){function Desaturate(){return null!==t&&t.apply(this,arguments)||this}return Vs(Desaturate,t),Desaturate}(z),Gs=function(t){function FastDesaturate(){var n=null!==t&&t.apply(this,arguments)||this;return n.rgbWeights=new w(.3,.59,.11),n}return Vs(FastDesaturate,t),FastDesaturate}(qs),Hs=function(t){function PostEffects(){var n=null!==t&&t.apply(this,arguments)||this;return n._bloom=new v(Us),n}return Vs(PostEffects,t),Object.defineProperty(PostEffects.prototype,"bloom",{get:function(){return this._bloom.instance},enumerable:!1,configurable:!0}),PostEffects.prototype.destroy=function(){var t=this.bloom;t&&t.destroy()},PostEffects}(z),Xs=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),OrthographicProjector_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},OrthographicProjector_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Ks=function(t){function OrthographicProjector(){var n=null!==t&&t.apply(this,arguments)||this;return n._size=5,n._projectionMatrix=new A,n}return Xs(OrthographicProjector,t),Object.defineProperty(OrthographicProjector.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(OrthographicProjector.prototype,"size",{get:function(){return this._size},set:function(t){this._size=t,this.changed.post()},enumerable:!1,configurable:!0}),OrthographicProjector.prototype.getProjectionMatrix=function(){return this._projectionMatrix},OrthographicProjector.prototype.updateFrustum=function(t,n){var r=this,o=this._size*n,i=this._size;this._projectionMatrix.makeOrthoProjection(-o,o,i,-i,this._zNear,this._zFar);var a=this._size*n,c=this._size;this._frustum.full.update(a,c,a,c,this._zNear,this._zFar,t),V.shadowCascadeEdges.forEach((function(n,o){r._frustum.splits[o].update(a,c,a,c,r._zNear+(o>0?V.shadowCascadeEdges[o-1]:0),r._zNear+n,t)}))},OrthographicProjector.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_zNear:t.properties.zNear,_zFar:t.properties.zFar,_size:t.properties.size}),delete t.properties.zNear,delete t.properties.zFar,delete t.properties.size),t},OrthographicProjector_decorate([Attributes_unserializable(),OrthographicProjector_metadata("design:type",Object)],OrthographicProjector.prototype,"_projectionMatrix",void 0),OrthographicProjector}(H),Qs=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();!function(t){t.emptyArray=new Kt(xr)}(Ns||(Ns={}));var Ys,Zs,Js=function(t){function VisualFilter(){return null!==t&&t.apply(this,arguments)||this}return Qs(VisualFilter,t),VisualFilter.prototype.getIncluded=function(){return Ns.emptyArray},VisualFilter.prototype.getExcluded=function(){return Ns.emptyArray},VisualFilter.prototype.detach=function(){this.getExcluded().detach(),this.getIncluded().detach()},VisualFilter.prototype.canRender=function(t){var n=Boolean(t);return!(!!n&&this.getExcluded().data.some((function(n){return n.asset===t})))&&(!(this.getIncluded().data.length>0)||n&&this.getIncluded().data.some((function(n){return n.asset===t})))},VisualFilter}(z),$s=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Camera_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Camera_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t[t.Environment=0]="Environment",t[t.None=1]="None"}(Ys||(Ys={})),function(t){t.projectorProperty="_projector"}(Zs||(Zs={}));var tc,ec=function(t){function Camera(n){var r=t.call(this)||this;return r._projector=new v(H),r._clearValue=Ys.Environment,r._priority=0,r._filter=new v(Js),r._renderTarget=new K(gt),r._postEffects=new v(Hs),r._viewMatrix=new A,r._viewMatrixDirty=!0,r._invalidFrustum=!0,n&&r.setState(n),r.onTransformChanged=r.onTransformChanged.bind(r),r.onProjectorChanged=r.onProjectorChanged.bind(r),r.onRenderTargetChanged=r.onRenderTargetChanged.bind(r),r.onRenderTargetSizeChanged=r.onRenderTargetSizeChanged.bind(r),r._renderTarget.assetChanged.attach(r.onRenderTargetChanged),r.projector||(r.projector=new bt),r}return $s(Camera,t),Object.defineProperty(Camera.prototype,"version",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(Camera.prototype,"projector",{get:function(){return this._projector.instance},set:function(t){var n=this._projector.instance;n&&n.changed.detach(this.onProjectorChanged),this._projector.instance=t,t.changed.attach(this.onProjectorChanged),this.entity&&this.updateFrustum()},enumerable:!1,configurable:!0}),Object.defineProperty(Camera.prototype,"clearValue",{get:function(){return this._clearValue},enumerable:!1,configurable:!0}),Object.defineProperty(Camera.prototype,"postEffects",{get:function(){return this._postEffects.instance},enumerable:!1,configurable:!0}),Object.defineProperty(Camera.prototype,"renderTarget",{get:function(){return this._renderTarget.asset},set:function(t){this._renderTarget.asset=t},enumerable:!1,configurable:!0}),Object.defineProperty(Camera.prototype,"priority",{get:function(){return this._priority},enumerable:!1,configurable:!0}),Object.defineProperty(Camera.prototype,"sceneRenderTarget",{get:function(){if(!this._sceneRenderTarget){var t=h.fromPool().copy(mt.renderer.screenSize),n=this.renderTarget;n&&(t.x=n.getWidth(),t.y=n.getHeight());var r=new lt(it.Absolute,t.x),o=new lt(it.Absolute,t.y);this._sceneRenderTarget=new gt(r,o,!1,!1)}return this._sceneRenderTarget},enumerable:!1,configurable:!0}),Object.defineProperty(Camera.prototype,"frustum",{get:function(){var t=this.projector;return this._invalidFrustum&&this.updateFrustum(),t.frustum},enumerable:!1,configurable:!0}),Object.defineProperty(Camera.prototype,"filter",{set:function(t){this._filter.instance=t},enumerable:!1,configurable:!0}),Camera.prototype.setEntity=function(n){t.prototype.setEntity.call(this,n),n.getOrSetComponent(Yn).changed.attach(this.onTransformChanged);var r=this.projector;r&&0===r.changed.listenerCount()&&r.changed.attach(this.onProjectorChanged),this.updateFrustum()},Camera.prototype.destroy=function(){this._filter.instance&&this._filter.instance.detach(),this._renderTarget.detach(),this._sceneRenderTarget&&this._sceneRenderTarget.destroy();var n=this.postEffects;n&&n.destroy();var r=this.entity.transform;r&&r.changed.detach(this.onTransformChanged),t.prototype.destroy.call(this)},Camera.prototype.canRenderGroup=function(t){var n,r;return null===(r=null===(n=this._filter.instance)||void 0===n?void 0:n.canRender(t))||void 0===r||r},Camera.prototype.getProjectionMatrix=function(){var t=this.projector;return t?(this._invalidFrustum&&this.updateFrustum(),t.getProjectionMatrix()):A.identity},Camera.prototype.getViewMatrix=function(){return this._viewMatrixDirty&&(this._viewMatrix.copy(this.entity.transform.worldMatrix),this._viewMatrix.invert(),this._viewMatrixDirty=!0),this._viewMatrix},Camera.prototype.getWorldRay=function(t,n){var r,o,i=this.projector;if(!i)return null;var a=this.renderTarget;if(a&&a.valid)r=a.getWidth(),o=a.getHeight();else{var c=mt.renderer.screenSize;r=c.x,o=c.y}if(i.isA(bt)){var u=i;return ge.dummy.setFromPerspectiveView(u.fov*P.degreesToRadians,this.entity.transform.worldMatrix,t,n,r,o)}if(i.isA(Ks)){var l=i;return ge.dummy.setFromOrthographicView(l.size,this.entity.transform.worldMatrix,t,n,r,o)}return null},Camera.prototype.getViewPosition=function(t,n){var r=A.fromPool().copy(this.getProjectionMatrix()).multiply(this.getViewMatrix()),o=Bt.fromPool().set(t.x,t.y,t.z,1).transform(r);return!(o.w<=0)&&(n.set(o.x/o.w,o.y/o.w,o.z/o.w),!0)},Camera.prototype.getScreenPosition=function(t,n){if(this.getViewPosition(t,n)){var r=mt.renderer.screenSize;return n.x=r.x*(.5*(n.x+1)),n.y=r.y*(.5*(1-n.y)),!0}return!1},Camera.prototype.setupFrame=function(){this._viewMatrixDirty=!0},Camera.prototype.setProperty=function(n,r){n===Zs.projectorProperty?this.projector=r.instance:t.prototype.setProperty.call(this,n,r)},Camera.prototype.upgrade=function(t,n){var r;if(1===n){var o={_projector:t.properties.projector,_clearValue:t.properties.clear,_excludedGroups:t.properties.excludedGroups,_includedGroups:t.properties.includedGroups,_renderTarget:t.properties.renderTarget,_priority:t.properties.priority};Object.assign(t.properties,o),delete t.properties.projector,delete t.properties.clear,delete t.properties.excludedGroups,delete t.properties.includedGroups,delete t.properties.renderTarget,delete t.properties.priority}else if(2===n){var i=t.properties._excludedGroups.data.map((function(t){return t.id})).filter(Boolean),a=t.properties._includedGroups.data.map((function(t){return t.id})).filter(Boolean);if(i.length>0||a.length>0){var c="ExclusionVisualFilter",u=i,l="_excluded";0===i.length&&(c="InclusionVisualFilter",u=a,l="_included"),Object.assign(t.properties,{_filter:{baseTypeName:"VisualFilter",data:{typeName:c,version:1,properties:(r={},r[l]={typeName:"VisualGroup",data:u.map((function(t){return{typeName:"VisualGroup",id:t}}))},r)}}})}delete t.properties._excludedGroups,delete t.properties._includedGroups}return t},Camera.prototype.invalidateFrustum=function(){this._invalidFrustum=!0},Camera.prototype.updateFrustum=function(){var t=this.projector;if(t)if(this._invalidFrustum=!0,this._renderTarget.id||this._renderTarget.asset){var n=this.renderTarget;if(n&&n.valid){var r=n.getWidth()/n.getHeight();t.updateFrustum(this.entity.transform,r),this._invalidFrustum=!1}}else{var o=mt.renderer.screenSize;r=o.x/o.y;t.updateFrustum(this.entity.transform,r),this._invalidFrustum=!1}},Camera.prototype.onRenderTargetChanged=function(t){t.oldAsset&&t.oldAsset.sizeChanged.detach(this.onRenderTargetSizeChanged),t.newAsset&&t.newAsset.sizeChanged.attach(this.onRenderTargetSizeChanged),this.invalidateFrustum()},Camera.prototype.onTransformChanged=function(){this.invalidateFrustum()},Camera.prototype.onProjectorChanged=function(){this.invalidateFrustum()},Camera.prototype.onRenderTargetSizeChanged=function(){this.invalidateFrustum()},Camera_decorate([nullable(!1),Camera_metadata("design:type",Object)],Camera.prototype,"_projector",void 0),Camera_decorate([Attributes_enumLiterals(Ys),Camera_metadata("design:type",Object)],Camera.prototype,"_clearValue",void 0),Camera_decorate([Attributes_unserializable(),Camera_metadata("design:type",gt)],Camera.prototype,"_sceneRenderTarget",void 0),Camera_decorate([Attributes_unserializable(),Camera_metadata("design:type",Object)],Camera.prototype,"_viewMatrix",void 0),Camera_decorate([Attributes_unserializable(),Camera_metadata("design:type",Object)],Camera.prototype,"_viewMatrixDirty",void 0),Camera_decorate([Attributes_unserializable(),Camera_metadata("design:type",Object)],Camera.prototype,"_invalidFrustum",void 0),Camera=Camera_decorate([helpUrl("https://docs.spiderengine.io/3d/camera.html"),Camera_metadata("design:paramtypes",[Object])],Camera)}(fn),nc=function(){function MapPool(t){this._size=0,this._initialCapacity=t,this._capacity=t,this._maps=[],this._maps.length=t;for(var n=0;n<t;++n)this._maps[n]=new Map}return MapPool.prototype.flush=function(){for(var t=0;t<this._size;++t)this._maps[t].clear();this._size=0},MapPool.prototype.get=function(){return this._size===this._capacity&&this.grow(),this._maps[this._size++]},MapPool.prototype.shrink=function(){this._capacity=this._initialCapacity,this._maps.length=this._capacity,this._size=Math.min(this._size,this._capacity)},MapPool.prototype.grow=function(){p.log("MapPool capacity reached, doubling the pool. Consider allocation a bigger pool.");var t=2*this._capacity;this._maps.length=t;for(var n=this._capacity;n<t;++n)this._maps[n]=new Map;this._capacity=t},MapPool}(),rc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),oc=function(t){function LightType(){return null!==t&&t.apply(this,arguments)||this}return rc(LightType,t),LightType}(z),ic=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ac=function(t){function DirectionalLight(){return null!==t&&t.apply(this,arguments)||this}return ic(DirectionalLight,t),DirectionalLight}(oc),sc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Shadow_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},cc=function(t){function Shadow(){return null!==t&&t.apply(this,arguments)||this}return sc(Shadow,t),Shadow.prototype.getTypeIndex=function(){return-1},Shadow}(z),uc=function(t){function PCFShadow(){var n=null!==t&&t.apply(this,arguments)||this;return n.radius=2,n}return sc(PCFShadow,t),PCFShadow.prototype.getTypeIndex=function(){return 1},PCFShadow=Shadow_decorate([displayName("Smooth")],PCFShadow)}(cc),lc=function(t){function PCFSoftShadow(){return null!==t&&t.apply(this,arguments)||this}return sc(PCFSoftShadow,t),PCFSoftShadow.prototype.getTypeIndex=function(){return 0},PCFSoftShadow=Shadow_decorate([displayName("Smoothest")],PCFSoftShadow)}(uc),pc=function(t){function HardShadow(){return null!==t&&t.apply(this,arguments)||this}return sc(HardShadow,t),HardShadow.prototype.getTypeIndex=function(){return 2},HardShadow=Shadow_decorate([displayName("Hard")],HardShadow)}(cc),fc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),PhongShader_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c};!function(t){t.diffuseKey="diffuse",t.diffuseMapKey="diffuseMap",t.ambientKey="ambient",t.emissiveKey="emissive"}(tc||(tc={}));var hc,dc=function(t){function PhongShader(){return null!==t&&t.apply(this,arguments)||this}return fc(PhongShader,t),PhongShader.prototype.loadInstance=function(n){if(!t.prototype.loadInstance.call(this,n))return!1;for(var r=n.uniforms,o=n.program,i=0,a=Array.from(new Array(V.maxDirectionalLights)).map((function(t,n){var r;return(r={})["directionalLights["+n+"].color"]={type:"vec4",uniformLocation:null},r["directionalLights["+n+"].shadow"]={type:"bool",uniformLocation:null},r["directionalLights["+n+"].shadowType"]={type:"int",uniformLocation:null},r["directionalLights["+n+"].shadowRadius"]={type:"float",uniformLocation:null},r["directionalLights["+n+"].intensity"]={type:"float",uniformLocation:null},r}));i<a.length;i++){for(var c=a[i],u=0,l=Object.keys(c);u<l.length;u++){var p=l[u],f=at.context.getUniformLocation(o,p);c[p].uniformLocation=f,console.assert(null!==f,"getUniformLocation("+p+") failed in shader '"+this.templatePath+"'")}Object.assign(r,c)}return!0},PhongShader.prototype.useDirectionalLights=function(){return!0},PhongShader=PhongShader_decorate([displayName("Phong Shader"),creatable(!1)],PhongShader)}(rn);!function(t){function doRenderPass(n,r,o){if(0!==n.renderStateBucketMap.size)for(var i=r.getViewMatrix(),a=V.maxDirectionalLights,c=V.maxShadowCascades,u=V.shadowCascadeEdges,l=Math.min(a,t.directionalLights.length),p=0,f=Array.from(n.renderStateBucketMap.keys()).sort();p<f.length;p++){var h=f[p],d=n.renderStateBucketMap.get(h),y=d.reference;y.uploadState(),at.enableDepthTest(y.depthTest),y.depthTest&&at.enableDepthWrite(n.allowDepthWrite()),d.shaderToVisualBucketsMap.forEach((function(n,a){n.forEach((function(n,p){var f=a.beginWithVisual(n.reference,p,o);if(f){if(a.applyParam("projectionMatrix",r.getProjectionMatrix(),p),a.applyParam("viewMatrix",i,p),a.applyParam("cameraPosition",r.entity.transform.worldPosition,p),l>0){var h=n.reference.receiveShadows;a.applyParam("directionalLightCount",l,p),h&&(a.applyNumberArrayParam("shadowCascadeEdges",u,p),a.applyReferenceArrayParam("directionalShadowMaps",t.directionalShadowMaps,p));for(var d=w.fromPool(),y=[],m=0;m<l;++m){var v=t.directionalLights[m].light;if(d.copy(v.entity.transform.worldForward).transformDirection(i),y.push(w.fromPool().copy(d)),a.applyParam("directionalLights["+m+"].color",v.color,p),a.applyParam("directionalLights["+m+"].intensity",v.intensity,p),h&&v.castShadows){for(var g=t.directionalLights[m],_=g.projectionMatrices,b=g.viewMatrices,x=0;x<c;++x){var P=t.dummyMatrix.multiplyMatrices(_[x],b[x]);a.applyParam("directionalLightMatrices["+(m*c+x)+"]",P,p)}var O=v.shadow;a.applyParam("directionalLights["+m+"].shadow",!0,p),a.applyParam("directionalLights["+m+"].shadowType",O.getTypeIndex(),p),O.isA(uc)&&a.applyParam("directionalLights["+m+"].shadowRadius",O.radius,p)}else a.applyParam("directionalLights["+m+"].shadow",!1,p)}a.applyVec3ArrayParam("directionalLightDirs",y,p)}else a.applyParam("directionalLightCount",0,p);if(o&&n.reference.receiveFog)if(a.applyParam("fogColor",o.color,p),o.isA(Ke))a.applyParam("fogDensity",o.density,p);else{var C=o;a.applyParam("fogNear",C.near,p),a.applyParam("fogFar",C.far,p)}var S=f.vertexAttribs;n.vertexBufferToVisualsMap.forEach((function(n,o){var c;o.bindBuffers(),o.bindAttributes(S);for(var u=0,l=n;u<l.length;u++){var f=l[u];f.graphicUpdate(r)===mr.Changed&&o.updateBufferDatas();var h=void 0;if(f.isSkinned){h=i;var d=f.geometry;t.updatedSkinnedMeshes.has(d)||(d.updateMatrices(),t.updatedSkinnedMeshes.set(d,!0)),d.updateShader(a,p)}else h=t.dummyMatrix.multiplyMatrices(i,f.worldTransform);t.normalMatrix.getNormalMatrix(h),a.applyParam("worldMatrix",f.worldTransform,p),a.applyParam("modelViewMatrix",h,p),a.applyParam("normalMatrix",t.normalMatrix,p),a.applyParam("screenSize",t.screenSize,p),a.applyParam("time",je.time,p),a.applyParam("deltaTime",je.deltaTime,p),a.applyParam("frame",je.currentFrame,p);var y=f.envMap;y&&a.applyReferenceParam("envMap",y,p);for(var m=(null!==(c=f.animatedMaterial)&&void 0!==c?c:f.material).shaderParams,v=0,g=Object.entries(m);v<g.length;v++){var _=g[v],b=_[0],w=_[1];a.applyParam(b,w,p)}o.draw()}o.unbindAttributes(S)}))}}))}))}}function doReflectionRenderPass(n,r,o){var i=null;n.renderStateBucketMap.forEach((function(n,a){n.shaderToVisualBucketsMap.forEach((function(n,a){var c=a.getUniforms(),u=c[tc.diffuseMapKey],l=u&&"sampler2D"===u.type,p=c[tc.diffuseKey],f=p&&"vec4"===p.type;n.forEach((function(n,a){n.vertexBufferToVisualsMap.forEach((function(n,a){var c,u=n[0].isSkinned,p=u?Is.shaders.skinnedDynamicCubemap:Is.shaders.dynamicCubemap;p!==i&&(p.begin(),p.applyParam("projectionMatrix",r.getProjectionMatrix()),u&&p.applyParam("viewMatrix",o),i=p),a.begin(p);for(var h=0,d=n;h<d.length;h++){var y=d[h],m=null!==(c=y.material)&&void 0!==c?c:y.animatedMaterial,v=l?m[tc.diffuseMapKey]:Is.whiteTexture,g=f?m[tc.diffuseKey]:It.white;if(p.applyReferenceParam("diffuse",v),p.applyParam("ambient",g),u){var _=y.geometry;t.updatedSkinnedMeshes.has(_)||(_.updateMatrices(),t.updatedSkinnedMeshes.set(_,!0)),_.updateShader(p,y.bucketId),p.applyParam("bindMatrix",_.bindMatrix),p.applyParam("bindMatrixInverse",_.bindMatrixInverse),at.extensions.OES_texture_float?(t.skinnedRenderDepthBonesTexture.asset=_.boneTexture,p.applyParam("boneTexture",t.skinnedRenderDepthBonesTexture),p.applyParam("boneTextureSize",_.boneTextureSize)):p.applyParam("boneMatrices",_.boneMatrices)}else{var b=t.dummyMatrix.multiplyMatrices(o,y.worldTransform);p.applyParam("modelViewMatrix",b)}a.draw()}a.end(p)}))}))}))}))}function findBounds(t,n,r,o,i){var a=w.fromPool();o.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),i.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var c=0;c<r.length;++c)a.copy(r[c]).substract(t.worldPosition).transform(n),a.x<o.x&&(o.x=a.x),a.x>i.x&&(i.x=a.x),a.y<o.y&&(o.y=a.y),a.y>i.y&&(i.y=a.y),a.z<o.z&&(o.z=a.z),a.z>i.z&&(i.z=a.z)}function renderShadowMaps(n){var r=V.maxDirectionalLights,o=V.maxShadowCascades,i=r*o;t.directionalShadowMaps.length=i;var c=Math.min(t.directionalLights.length,r),u=null;c>0&&(at.enableDepthTest(!0),at.enableBlending(!1),at.enableDepthWrite(!0),at.enableCulling(!0),at.setCullMode(at.context.BACK));for(var l=t.cameraToShadowCastersMap.get(n),_loop_1=function(r){if(!t.directionalShadowMaps[r*o])for(var i=0;i<o;++i){var c=new lt(it.Absolute,t.defaultShadowMapSize.x/Math.pow(2,i));t.directionalShadowMaps[r*o+i]=new gt(c,c,!0,!1,a.Nearest)}var _loop_2=function(i){var a=!0,c=t.directionalShadowMaps[r*o+i];if(ft.instance.setRenderTarget(c),!l)return"continue";var p=function setupDirectionalLightMatrices(n,r,o,i){var a=r.light.entity.transform;t.dummyTransform.position=w.zero,t.dummyTransform.rotation=a.rotation;var c=A.fromPool().copy(t.dummyTransform.worldMatrix).invert(),u=n.entity.transform,l=n.frustum.splits[o],p=w.fromPool(),f=w.fromPool();findBounds(u,c,l.corners,p,f);for(var h=t.shadowCastersMapPool.get(),d=w.fromPool(),y=w.fromPool(),m=w.fromPool().set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),v=w.fromPool().set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),g=0,_=i;g<_.length;g++){var b=_[g],x=b.geometry.getBoundingBox();if(t.dummyAABB.copy(x).transform(b.worldTransform),findBounds(u,c,t.dummyAABB.corners,d,y),!(y.x<p.x||d.x>f.x||y.y<p.y||d.y>f.y||y.z<p.z)){m.set(Math.min(m.x,d.x),Math.min(m.y,d.y),Math.min(m.z,d.z)),v.set(Math.max(v.x,y.x),Math.max(v.y,y.y),Math.max(v.z,y.z));var P=b.vertexBuffer,O=h.get(P);O?O.push(b):h.set(P,[b])}}if(h.size>0){p.x=Math.max(m.x-1,p.x),f.x=Math.min(v.x+1,f.x),p.y=Math.max(m.y-1,p.y),f.y=Math.min(v.y+1,f.y),p.z=Math.min(m.z,p.z),f.z=Math.max(v.z,f.z);var C=(f.x-p.x)/2,S=(f.y-p.y)/2,E=(f.z-p.z)/2;r.projectionMatrices[o].makeOrthoProjection(-C,C,S,-S,-E,E);var j=p.x+C,T=p.y+S,R=p.z+E;return t.dummyTransform.position.copy(u.worldPosition).add(w.fromPool().copy(a.worldForward).multiply(R)).add(w.fromPool().copy(a.worldRight).multiply(j)).add(w.fromPool().copy(a.worldUp).multiply(T)),r.viewMatrices[o].copy(t.dummyTransform.worldMatrix).invert(),h}return null}(n,t.directionalLights[r],i,l);if(!p)return"continue";p.forEach((function(n,o){var c=n[0].isSkinned,l=c?Is.shaders.skinnedRenderDepth:Is.shaders.renderDepth;l!==u&&(l.begin(),u=l,a=!0),a&&(l.applyParam("projectionMatrix",t.directionalLights[r].projectionMatrices[i]),c&&l.applyParam("viewMatrix",t.directionalLights[r].viewMatrices[i]),a=!1),o.begin(l);for(var p=0,f=n;p<f.length;p++){var h=f[p];if(c){var d=h.geometry;t.updatedSkinnedMeshes.has(d)||(d.updateMatrices(),t.updatedSkinnedMeshes.set(d,!0)),d.updateShader(l,h.bucketId),l.applyParam("bindMatrix",d.bindMatrix),l.applyParam("bindMatrixInverse",d.bindMatrixInverse),at.extensions.OES_texture_float?(t.skinnedRenderDepthBonesTexture.asset=d.boneTexture,l.applyParam("boneTexture",t.skinnedRenderDepthBonesTexture),l.applyParam("boneTextureSize",d.boneTextureSize)):l.applyParam("boneMatrices",d.boneMatrices)}else{var y=t.dummyMatrix.multiplyMatrices(t.directionalLights[r].viewMatrices[i],h.worldTransform);l.applyParam("modelViewMatrix",y)}o.draw()}o.end(l)}))};for(i=0;i<o;++i)_loop_2(i)},p=0;p<c;++p)_loop_1(p)}function tryClearWithColor(t){var n=at.context;if(t.isA(We)){var r=t.color;return n.clearColor(r.r,r.g,r.b,r.a),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),!0}return n.clear(n.DEPTH_BUFFER_BIT),!1}function tryClearWithEnvironment(t,n,r){if(n.isA(qe)){var o=n;if(at.enableDepthTest(!0),at.enableDepthWrite(!1),(a=Is.materials.sky).queueParameter("projectionMatrix",t.getProjectionMatrix()),a.queueParameter("modelViewMatrix",r),a.queueParameter("sunPosition",o.sunPosition),a.queueParameter("rayleigh",o.rayleigh),a.queueParameter("turbidity",o.turbidity),a.queueParameter("mieCoefficient",o.mieCoefficient),a.queueParameter("luminance",o.luminance),a.queueParameter("mieDirectionalG",o.mieDirectionalG),a.begin()){var i=Is.primitives.sphere;on.drawVertexBuffer(i.vertexBuffer,a.shader)}}else if(n.isA(Ge)){var a;if((a=n).cubeMap){at.enableDepthTest(!0),at.enableDepthWrite(!1);var c=Is.materials.cubeMap;c.queueParameter("projectionMatrix",t.getProjectionMatrix()),c.queueParameter("modelViewMatrix",r),c.queueReferenceParameter("cubemap",a.cubeMap),c.begin()&&on.drawVertexBuffer(Jo.skyBox,c.shader)}}}t.initialShadowCastersPoolSize=128,t.numRenderPasses=u.Transparent+1,t.initialCameraPoolSize=8,t.initialMaterialPoolSize=128,t.defaultShadowMapSize=new h(4096,4096),t.defaultPerspectiveCamera=null,t.screenSizeDirty=!0,t.screenSize=new h,t.dummyMatrix=new A,t.normalMatrix=new Dt,t.uiProjectionMatrix=new A,t.cameraToRenderPassMap=new Map,t.probeToRenderPassMap=new Map,t.renderPassToDefinitionMapPool=new nc(t.initialCameraPoolSize),t.renderStateBucketMapPool=new nc(3*t.numRenderPasses),t.shaderToVisualBucketsMapPool=new nc(16),t.visualBucketsMapPool=new nc(16),t.vertexBufferToVisualsMapPool=new nc(16),t.shadowCastersMapPool=new nc(16),t.cameraToRenderPassMapPool=new nc(16),t.currentRenderTarget=null,t.currentCubemapFace=void 0,t.showWireFrame=!1,t.showShadowCascades=!1,t.directionalShadowMaps=[],t.cameraToShadowCastersMap=new Map,t.skinnedRenderDepthBonesTexture=new K(ct),t.updatedSkinnedMeshes=new Map,t.dummyAABB=new Ft,t.addToRenderMap=function addToRenderMap(n,r){var o,i=r.vertexBuffer;if(i){var a=r.animatedMaterial||r.material;if(a&&a.shader){var c=null===(o=n.get(a.renderPass))||void 0===o?void 0:o.renderStateBucketMap,u=a.buckedId,l=null==c?void 0:c.get(u);l||(l={reference:a,shaderToVisualBucketsMap:t.shaderToVisualBucketsMapPool.get()},null==c||c.set(u,l));var p=l.shaderToVisualBucketsMap.get(a.shader);p||(p=t.visualBucketsMapPool.get(),l.shaderToVisualBucketsMap.set(a.shader,p));var f=r.bucketId,h=p.get(f);h||(h={reference:r,vertexBufferToVisualsMap:t.vertexBufferToVisualsMapPool.get()},p.set(f,h));var d=h.vertexBufferToVisualsMap.get(i);d?d.push(r):h.vertexBufferToVisualsMap.set(i,[r])}}},t.renderReflections=function renderReflections(t,n,r,o){n.setupFrame(),ft.instance.setRenderTarget(n.renderTarget,r);var i=n.clearValue===Ys.Environment&&Boolean(o),a=i&&tryClearWithColor(o);at.enableDepthTest(!0),at.enableBlending(!1);var c=n.entity.transform,l=c.worldPosition,p=c.rotation,f=A.fromPool().compose(l,p,w.one).invert(),beginPass=function(){at.enableDepthWrite(!0)};if(beginPass(),doReflectionRenderPass(t.get(u.Opaque),n,f),i&&!a){var h=n.projector.zFar;tryClearWithEnvironment(n,o,A.fromPool().compose(w.zero,p,w.one).transpose().scaleFromCoords(h,h,h)),beginPass()}doReflectionRenderPass(t.get(u.Transparent),n,f)},t.render=function render(n,r,o,i,a,c){var l;renderShadowMaps(r),r.setupFrame();var p=null===(l=r.postEffects)||void 0===l?void 0:l.bloom;if(p?ft.instance.setRenderTarget(r.sceneRenderTarget):ft.instance.setRenderTarget(r.renderTarget),!t.defaultPerspectiveCamera){var f=r.projector;f&&f.isA(bt)&&(t.defaultPerspectiveCamera=r)}var h=r.clearValue===Ys.Environment&&Boolean(o),d=h&&tryClearWithColor(o);a&&a(r),doRenderPass(n.get(u.Opaque),r,i),h&&!d&&tryClearWithEnvironment(r,o,function makeSkyViewMatrix(t){var n=t.projector.zFar;return A.fromPool().copy(t.entity.transform.worldMatrix).setPosition(w.zero).transpose().scaleFromCoords(n,n,n)}(r)),doRenderPass(n.get(u.Transparent),r,i),c&&c(r),p&&function doPostFX(t,n){var r=Jo.centeredQuad,o=n.render(t.sceneRenderTarget,r),i=Is.shaders.compose;i.begin()&&(ft.instance.setRenderTarget(t.renderTarget),i.applyReferenceParam("scene",t.sceneRenderTarget),i.applyReferenceParam("postFX",o),i.applyParam("postFxIntensity",n.intensity),on.drawVertexBuffer(r,i))}(r,p)},t.makeRenderPassDefinitions=function makeRenderPassDefinitions(){var n=t.renderPassToDefinitionMapPool.get();return n.set(u.Opaque,{allowDepthWrite:function(){return!0},renderStateBucketMap:t.renderStateBucketMapPool.get()}),n.set(u.Transparent,{allowDepthWrite:function(){return!1},renderStateBucketMap:t.renderStateBucketMapPool.get()}),n}}(hc||(hc={}));var yc,mc=function(){function Renderer(){}return Object.defineProperty(Renderer.prototype,"screenSize",{get:function(){return hc.screenSize},enumerable:!1,configurable:!0}),Object.defineProperty(Renderer.prototype,"defaultPerspectiveCamera",{get:function(){return hc.defaultPerspectiveCamera},enumerable:!1,configurable:!0}),Object.defineProperty(Renderer.prototype,"canvas",{get:function(){return hc.canvas},enumerable:!1,configurable:!0}),Object.defineProperty(Renderer.prototype,"renderTarget",{get:function(){return hc.currentRenderTarget},enumerable:!1,configurable:!0}),Object.defineProperty(Renderer.prototype,"showWireFrame",{get:function(){return hc.showWireFrame},set:function(t){t!==hc.showWireFrame&&(on.invalidateShaders(),hc.showWireFrame=t)},enumerable:!1,configurable:!0}),Object.defineProperty(Renderer.prototype,"showShadowCascades",{get:function(){return hc.showShadowCascades},set:function(t){t!==hc.showShadowCascades&&(on.invalidateShaders(),hc.showShadowCascades=t)},enumerable:!1,configurable:!0}),Renderer.prototype.setRenderTarget=function(t,n){if(t!==hc.currentRenderTarget||hc.currentCubemapFace!==n||hc.screenSizeDirty)if(t){if(!t.bind(n))throw"RenderTarget not ready for rendering";hc.currentRenderTarget=t,hc.currentCubemapFace=n}else at.context.bindFramebuffer(at.context.FRAMEBUFFER,null),at.context.viewport(0,0,this.screenSize.x,this.screenSize.y),hc.screenSizeDirty=!1,hc.currentRenderTarget=null,hc.currentCubemapFace=void 0},Renderer}(),vc=function(){function RendererInternal(){}return RendererInternal.processCanvasDimensions=function(t){var n=t.clientWidth,r=t.clientHeight;0!==n&&0!==r&&(hc.screenSize.set(n,r),hc.screenSizeDirty=!0,hc.uiProjectionMatrix.makeOrthoProjection(0,t.clientWidth,0,t.clientHeight,-100,100),t.width=t.clientWidth,t.height=t.clientHeight)},RendererInternal.create=function(t){ft.instance=new mc,RendererInternal.processCanvasDimensions(t),hc.canvas=t,hc.dummyTransform=new Yn,hc.dummyTransform.setEntity(new ja)},RendererInternal.render=function(t,n,r,o,i,a,c){var u,l,p;hc.renderPassToDefinitionMapPool.flush(),hc.renderStateBucketMapPool.flush(),hc.shaderToVisualBucketsMapPool.flush(),hc.visualBucketsMapPool.flush(),hc.vertexBufferToVisualsMapPool.flush(),hc.shadowCastersMapPool.flush(),hc.cameraToRenderPassMapPool.flush(),hc.cameraToRenderPassMap.clear(),r.forEach((function(t){hc.cameraToRenderPassMap.set(t,hc.makeRenderPassDefinitions())})),hc.probeToRenderPassMap.clear(),hc.defaultPerspectiveCamera=null,hc.cameraToShadowCastersMap.clear();for(var f=(null==t?void 0:t.isA(Ge))?t.cubeMap:null,_loop_3=function(t){if(!t.vertexBuffer)return"continue";var n=null,i=null,a=Number.MAX_VALUE;if(t.isReflective){for(var c=0,h=o.ReflectionProbe;c<h.length;c++){var d=h[c],y=w.distanceSq(d.entity.transform.worldPosition,t.entity.transform.worldPosition);y<a&&(i=d,a=y)}t.envMap=null!==(u=null==i?void 0:i.renderTarget)&&void 0!==u?u:f}else t.envMap=null;for(var _loop_4=function(r){if(!r.canCapture())return"continue";var o=hc.probeToRenderPassMap.get(r);if(o||(o=hc.cameraToRenderPassMapPool.get(),hc.probeToRenderPassMap.set(r,o),r.traverseCameras((function(t){null==o||o.set(t,hc.makeRenderPassDefinitions())}))),r.entity.isAncestor(t.entity)||!r.canRenderGroup(t.group))return"continue";var i=null===(l=t.geometry)||void 0===l?void 0:l.getBoundingBox();i?(n=hc.dummyAABB.copy(i).transform(t.worldTransform),r.traverseCameras((function(n){var r=null==o?void 0:o.get(n);hc.addToRenderMap(r,t)}))):r.traverseCameras((function(n){var r=null==o?void 0:o.get(n);hc.addToRenderMap(r,t)}))},m=0,v=o.ReflectionProbe;m<v.length;m++){_loop_4(d=v[m])}for(var g=0,_=r;g<_.length;g++){var b=_[g];if(b.canRenderGroup(t.group)){var x=null===(p=t.geometry)||void 0===p?void 0:p.getBoundingBox();if(x){if(t.castShadows){var P=hc.cameraToShadowCastersMap.get(b);P?P.push(t):hc.cameraToShadowCastersMap.set(b,[t])}var O=null!=n?n:hc.dummyAABB.copy(x).transform(t.worldTransform);if(b.frustum.full.testAABB(O)===F.Out)continue}var C=hc.cameraToRenderPassMap.get(b);hc.addToRenderMap(C,t)}}},h=0,d=o.Visual;h<d.length;h++){_loop_3(d[h])}var y=o.Light;hc.directionalLights=y.filter((function(t){return t.type.isA(ac)})).map((function(t){return{light:t,viewMatrices:Array.from(new Array(V.maxShadowCascades)).map((function(t){return A.fromPool()})),projectionMatrices:Array.from(new Array(V.maxShadowCascades)).map((function(t){return A.fromPool()}))}})),hc.updatedSkinnedMeshes.clear();for(var m=0,v=o.ReflectionProbe;m<v.length;m++){v[m].tick()}if(hc.probeToRenderPassMap.forEach((function(n,r){n.forEach((function(n,o){var i=r.getCameraIndex(o),a=at.cubeMapFaces[i];hc.renderReflections(n,o,a,t)}))})),hc.cameraToRenderPassMap.size>0?hc.cameraToRenderPassMap.forEach((function(r,o){hc.render(r,o,t,n,i,a)})):(ft.instance.setRenderTarget(null),i&&r.length>0&&i(r[0]),a&&r.length>0&&a(r[0])),o.Screen.length){ft.instance.setRenderTarget(null),at.enableDepthTest(!1);var g=Is.materials.ui;g.queueParameter("projectionMatrix",hc.uiProjectionMatrix);for(var _=0,b=o.Screen;_<b.length;_++){var x=b[_];x.updateTransforms(),x.render(g)}}c&&c()},RendererInternal.clearDefaultPerspectiveCamera=function(){hc.defaultPerspectiveCamera=null},Object.defineProperty(RendererInternal,"uiProjectionMatrix",{get:function(){return hc.uiProjectionMatrix},enumerable:!1,configurable:!0}),RendererInternal}(),gc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),CenteredQuad_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},CenteredQuad_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},_c=function(t){function CenteredQuad(){var n=null!==t&&t.apply(this,arguments)||this;return n._boundingBox=new Ft(new w(-1,-1,-.1),new w(1,1,.1)),n}return gc(CenteredQuad,t),CenteredQuad.prototype.getVertexBuffer=function(){return Jo.centeredQuad},CenteredQuad.prototype.getBoundingBox=function(){return this._boundingBox},CenteredQuad_decorate([Attributes_unserializable(),CenteredQuad_metadata("design:type",Object)],CenteredQuad.prototype,"_boundingBox",void 0),CenteredQuad}(br),bc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Delay_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Delay_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},wc=function(t){function Delay(){var n=t.call(this)||this;return n._remainingTime=0,n.createPin("_delay",Pt.Input,Fa),n}return bc(Delay,t),Delay.prototype.onStart=function(){return this._remainingTime=this._delay.getData(),this._remainingTime>0?dt.Continue:dt.Finish},Delay.prototype.onUpdate=function(){return this._remainingTime-=je.deltaTime,this._remainingTime<0?dt.Finish:dt.Continue},Delay_decorate([Attributes_unserializable(),Delay_metadata("design:type",Fa)],Delay.prototype,"_delay",void 0),Delay_decorate([Attributes_unserializable(),Delay_metadata("design:type",Object)],Delay.prototype,"_remainingTime",void 0),Delay}(rs),xc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ModelElement_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},ModelElement_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Pc=function(t){function ModelElement(){var n=t.call(this)||this;return n.userData={},n.children=new Rt(ModelElement),n.transform=new Yn,n}return xc(ModelElement,t),Object.defineProperty(ModelElement.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),ModelElement.prototype.addChild=function(t){this.children.grow(t),t._parent=this},ModelElement.prototype.traverse=function(t){t(this);for(var n=0,r=this.children.data.map((function(t){return t.instance}));n<r.length;n++){var o=r[n];o&&o.traverse(t)}},ModelElement.prototype.isLoaded=function(){return!0},ModelElement_decorate([Attributes_unserializable(),ModelElement_metadata("design:type",Object)],ModelElement.prototype,"userData",void 0),ModelElement_decorate([Attributes_hidden(),ModelElement_metadata("design:type",Object)],ModelElement.prototype,"children",void 0),ModelElement_decorate([Attributes_hidden(),ModelElement_metadata("design:type",Number)],ModelElement.prototype,"fbxNodeId",void 0),ModelElement_decorate([Attributes_unserializable(),ModelElement_metadata("design:type",ModelElement)],ModelElement.prototype,"_parent",void 0),ModelElement}(J),Oc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Model_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Cc=function(t){function Model(){var n=null!==t&&t.apply(this,arguments)||this;return n.fbxScaleFactor=1,n.elements=new Rt(Pc),n._animations=new Kt(mn),n}return Oc(Model,t),Object.defineProperty(Model.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(Model.prototype,"animations",{get:function(){return this._animations.data.map((function(t){return t.asset}))},enumerable:!1,configurable:!0}),Object.defineProperty(Model.prototype,"animationRefs",{get:function(){return this._animations},enumerable:!1,configurable:!0}),Model.prototype.clearAnimations=function(){this._animations.data.length=0},Model.prototype.addAnimation=function(t){this._animations.grow(t)},Model.prototype.destroy=function(){for(var n=0,r=this.elements.data;n<r.length;n++){var o=r[n];o.instance&&o.instance.destroy()}t.prototype.destroy.call(this)},Model.prototype.isLoaded=function(){for(var t=0,n=this.elements.data;t<n.length;t++){var r=n[t];if(r.instance&&!r.instance.isLoaded())return!1}return!0},Model.prototype.traverse=function(t){for(var n=0,r=this.elements.data.map((function(t){return t.instance}));n<r.length;n++){var o=r[n];o&&o.traverse(t)}},Model.prototype.upgrade=function(t,n){if(1===n){for(var r={typeName:"ModelElement",data:[]},o=0,i=t.properties.meshes.data;o<i.length;o++){var a=i[o],c={baseTypeName:"ModelElement",data:{typeName:t.properties.meshes.typeName}};Object.assign(c.data,a),r.data.push(c)}Object.assign(t.properties,{elements:r}),delete t.properties.meshes}return t},Model=Model_decorate([creatable(!1)],Model)}(nt),Sc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),AnimationTrack_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},AnimationTrack_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Ac=function(t){function AnimationTrack(){var n=null!==t&&t.apply(this,arguments)||this;return n.tokenCache={},n}return Sc(AnimationTrack,t),AnimationTrack.prototype.getKeys=function(){return[]},AnimationTrack.prototype.getSample=function(t,n){var r=this.getKeys();if(0!==r.length){var o=r.filter((function(n){return n.time>t}));if(o.length===r.length)return o[0].getValue();var i=r.filter((function(n){return n.time<=t}));console.assert(i.length>0);var a=i[i.length-1];if(i.length===r.length)return a.getValue();console.assert(o.length>0);var c=o[0],u=(t-a.time)/(c.time-a.time);return a.lerp(a,c,u,n)}},AnimationTrack.prototype.isLoaded=function(){return!0},AnimationTrack.prototype.createKey=function(t,n,r){},AnimationTrack.prototype.removeKey=function(t){},AnimationTrack.prototype.sortByTime=function(t){void 0===t&&(t=!0)},AnimationTrack_decorate([Attributes_unserializable(),AnimationTrack_metadata("design:type",Object)],AnimationTrack.prototype,"tokenCache",void 0),AnimationTrack}(z),Ec=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();!function(t){t.find=function find(t,n){return t.find((function(t){return t.time===n}))}}(yc||(yc={}));var jc,Tc=function(t){function AnimationKey(){return null!==t&&t.apply(this,arguments)||this}return Ec(AnimationKey,t),AnimationKey.prototype.lerp=function(t,n,r,o){},AnimationKey.prototype.getValue=function(){},AnimationKey.prototype.setValue=function(t){},AnimationKey}(z),Rc=function(t){function TAnimationKey(){return null!==t&&t.apply(this,arguments)||this}return Ec(TAnimationKey,t),TAnimationKey.prototype.getValue=function(){return this.value},TAnimationKey.prototype.setValue=function(t){this.value=t},TAnimationKey}(Tc),Bc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),TouchInput_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},TouchInput_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Mc=function(t){function TouchInput(){var n=t.call(this)||this;return n.createPin("_x",Pt.Output,Fa),n.createPin("_y",Pt.Output,Fa),n.createPin("_wheelDelta",Pt.Output,Fa),n.createPin("_button",Pt.Output,Fa),n.createPin("_isPressed",Pt.Output,Na),n.createPin("_pressed",Pt.Output,Et),n.createPin("_released",Pt.Output,Et),n.createPin("_moved",Pt.Output,Et),n.createPin("_wheel",Pt.Output,Et),n.createPin("_swipe",Pt.Output,Et),n.createPin("_swipeVelocity",Pt.Output,Va),n}return Bc(TouchInput,t),TouchInput.prototype.onBehaviorStarted=function(){this.onTouchPressed=this.onTouchPressed.bind(this),this.onTouchMoved=this.onTouchMoved.bind(this),this.onTouchReleased=this.onTouchReleased.bind(this),this.onMouseWheel=this.onMouseWheel.bind(this),Si.touchPressed.attach(this.onTouchPressed),Si.touchMoved.attach(this.onTouchMoved),Si.touchReleased.attach(this.onTouchReleased),Si.wheelMoved.attach(this.onMouseWheel),this._x.setData(Si.touchX),this._y.setData(Si.touchY)},TouchInput.prototype.destroy=function(){Si.touchPressed.detach(this.onTouchPressed),Si.touchMoved.detach(this.onTouchMoved),Si.touchReleased.detach(this.onTouchReleased),Si.wheelMoved.detach(this.onMouseWheel),t.prototype.destroy.call(this)},TouchInput.prototype.onTouchPressed=function(t){this._x.setData(t.x),this._y.setData(t.y),this._button.setData(t.button),this._isPressed.setData(t.pressed),this.sendSignal(this._pressed.name)},TouchInput.prototype.onTouchMoved=function(t){this._x.setData(t.x),this._y.setData(t.y),this.sendSignal(this._moved.name)},TouchInput.prototype.onTouchReleased=function(t){this._x.setData(t.x),this._y.setData(t.y),this._button.setData(t.button),this._isPressed.setData(t.pressed),t.swipe&&(this._swipeVelocity.value.copy(t.swipeVelocity),this.sendSignal(this._swipe.name)),this.sendSignal(this._released.name)},TouchInput.prototype.onMouseWheel=function(t){this._wheelDelta.setData(t),this.sendSignal(this._wheel.name)},TouchInput_decorate([Attributes_unserializable(),TouchInput_metadata("design:type",Fa)],TouchInput.prototype,"_x",void 0),TouchInput_decorate([Attributes_unserializable(),TouchInput_metadata("design:type",Fa)],TouchInput.prototype,"_y",void 0),TouchInput_decorate([Attributes_unserializable(),TouchInput_metadata("design:type",Fa)],TouchInput.prototype,"_wheelDelta",void 0),TouchInput_decorate([Attributes_unserializable(),TouchInput_metadata("design:type",Fa)],TouchInput.prototype,"_button",void 0),TouchInput_decorate([Attributes_unserializable(),TouchInput_metadata("design:type",Na)],TouchInput.prototype,"_isPressed",void 0),TouchInput_decorate([Attributes_unserializable(),TouchInput_metadata("design:type",Et)],TouchInput.prototype,"_pressed",void 0),TouchInput_decorate([Attributes_unserializable(),TouchInput_metadata("design:type",Et)],TouchInput.prototype,"_released",void 0),TouchInput_decorate([Attributes_unserializable(),TouchInput_metadata("design:type",Et)],TouchInput.prototype,"_moved",void 0),TouchInput_decorate([Attributes_unserializable(),TouchInput_metadata("design:type",Et)],TouchInput.prototype,"_wheel",void 0),TouchInput_decorate([Attributes_unserializable(),TouchInput_metadata("design:type",Et)],TouchInput.prototype,"_swipe",void 0),TouchInput_decorate([Attributes_unserializable(),TouchInput_metadata("design:type",Va)],TouchInput.prototype,"_swipeVelocity",void 0),TouchInput=TouchInput_decorate([displayName("Touch Input"),TouchInput_metadata("design:paramtypes",[])],TouchInput)}(ts),Ic=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),KeyInput_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},KeyInput_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},zc=function(t){function KeyInput(){var n=t.call(this)||this;return n.createPin("_keyCode",Pt.Output,Fa),n.createPin("_keyDown",Pt.Output,Et),n.createPin("_keyUp",Pt.Output,Et),n}return Ic(KeyInput,t),KeyInput.prototype.onBehaviorStarted=function(){this.onKeyChanged=this.onKeyChanged.bind(this),Si.keyChanged.attach(this.onKeyChanged)},KeyInput.prototype.destroy=function(){Si.keyChanged.detach(this.onKeyChanged),t.prototype.destroy.call(this)},KeyInput.prototype.onKeyChanged=function(t){this._keyCode.setData(t.keyCode),t.pressed?this.sendSignal(this._keyDown.name):this.sendSignal(this._keyUp.name)},KeyInput_decorate([Attributes_unserializable(),KeyInput_metadata("design:type",Fa)],KeyInput.prototype,"_keyCode",void 0),KeyInput_decorate([Attributes_unserializable(),KeyInput_metadata("design:type",Et)],KeyInput.prototype,"_keyDown",void 0),KeyInput_decorate([Attributes_unserializable(),KeyInput_metadata("design:type",Et)],KeyInput.prototype,"_keyUp",void 0),KeyInput=KeyInput_decorate([displayName("Key Input"),KeyInput_metadata("design:paramtypes",[])],KeyInput)}(ts),kc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),SphereVolume_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},SphereVolume_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Dc=function(t){function SphereVolume(n){var r=t.call(this)||this;return r.center=new w,r.radius=1,n&&r.setState(n),r}return kc(SphereVolume,t),SphereVolume.prototype.emitPoint=function(t){return P.sphericalToCartesian(this.radius*Math.random(),P.PI2*Math.random(),Math.PI*Math.random(),t)},SphereVolume.prototype.getCenter=function(t){return t.copy(this.center)},SphereVolume=SphereVolume_decorate([displayName("Sphere"),SphereVolume_metadata("design:paramtypes",[Object])],SphereVolume)}(Yr),Fc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Billboard_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Billboard_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Lc=function(t){function Billboard(){var n=null!==t&&t.apply(this,arguments)||this;return n._orientMatrix=new A,n}return Fc(Billboard,t),Billboard.prototype.getVertexBuffer=function(){return Jo.centeredQuad},Billboard.prototype.getWorldTransform=function(t){return this._orientMatrix},Billboard.prototype.graphicUpdate=function(t,n){var r=t.entity.transform,o=r.worldForward,i=r.worldUp;return this._orientMatrix.makeLookAt(o,i).transpose(),this._orientMatrix.scale(n.worldScale),this._orientMatrix.setPosition(n.worldPosition),mr.Unchanged},Billboard_decorate([Attributes_unserializable(),Billboard_metadata("design:type",Object)],Billboard.prototype,"_orientMatrix",void 0),Billboard}(br),Nc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Light_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Light_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Vc=function(t){function Light(n){var r=t.call(this)||this;return r.intensity=1,r.color=new It(1,1,1,1),r._type=new v(oc),r._shadows=new v(cc,new lc),n&&r.setState(n),r._type.instance||(r._type.instance=new ac),r}return Nc(Light,t),Object.defineProperty(Light.prototype,"version",{get:function(){return 3},enumerable:!1,configurable:!0}),Object.defineProperty(Light.prototype,"type",{get:function(){return this._type.instance},set:function(t){this._type.instance=t},enumerable:!1,configurable:!0}),Object.defineProperty(Light.prototype,"castShadows",{get:function(){return Boolean(this._shadows.instance)},enumerable:!1,configurable:!0}),Object.defineProperty(Light.prototype,"shadow",{get:function(){return this._shadows.instance},enumerable:!1,configurable:!0}),Light.prototype.setEntity=function(n){t.prototype.setEntity.call(this,n),n.getOrSetComponent(Yn)},Light.prototype.upgrade=function(t,n){return 1===n?(Object.assign(t.properties,{_type:t.properties.type}),delete t.properties.type):2===n&&(Object.assign(t.properties,{_shadows:{baseTypeName:"Shadow",data:t.properties.castShadows?{typeName:"PCFSoftShadow",version:1,properties:{radius:t.properties.shadowRadius}}:void 0}}),delete t.properties.castShadows,delete t.properties.shadowRadius,delete t.properties.shadowMapSize),t},Light_decorate([Attributes_enumLiterals(l,(function(t){return t.substring(1)})),nullable(!1),Light_metadata("design:type",Object)],Light.prototype,"_type",void 0),Light}(fn),Uc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),QuadGeometry_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},QuadGeometry_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Wc=function(t){function QuadGeometry(){var n=null!==t&&t.apply(this,arguments)||this;return n._boundingBox=new Ft(new w(0,0,-.1),new w(1,1,.1)),n}return Uc(QuadGeometry,t),QuadGeometry.prototype.getVertexBuffer=function(){return Jo.quad},QuadGeometry.prototype.getBoundingBox=function(){return this._boundingBox},QuadGeometry_decorate([Attributes_unserializable(),QuadGeometry_metadata("design:type",Object)],QuadGeometry.prototype,"_boundingBox",void 0),QuadGeometry=QuadGeometry_decorate([displayName("Quad")],QuadGeometry)}(br),qc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Vector2Converter_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},Vector2Converter_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Gc=function(t){function Vector2Converter(){var n=t.call(this)||this;return n.createPin("_x",Pt.Input,Fa),n.createPin("_y",Pt.Input,Fa),n.createPin("_output",Pt.Output,Va),n}return qc(Vector2Converter,t),Vector2Converter.prototype.convert=function(){this._output.getData().set(this._x.getData(),this._y.getData())},Vector2Converter_decorate([Attributes_unserializable(),Vector2Converter_metadata("design:type",Fa)],Vector2Converter.prototype,"_x",void 0),Vector2Converter_decorate([Attributes_unserializable(),Vector2Converter_metadata("design:type",Fa)],Vector2Converter.prototype,"_y",void 0),Vector2Converter_decorate([Attributes_unserializable(),Vector2Converter_metadata("design:type",Va)],Vector2Converter.prototype,"_output",void 0),Vector2Converter=Vector2Converter_decorate([displayName("Vector2"),Vector2Converter_metadata("design:paramtypes",[])],Vector2Converter)}(ps),Hc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ScreenToRay_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},ScreenToRay_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Xc=function(t){function ScreenToRay(){var n=t.call(this)||this;return n.createComponentReferencePin("_camera",Pt.Input,ec),n.createPin("_screenPos",Pt.Input,Va),n.createPin("_ray",Pt.Output,Ga),n}return Hc(ScreenToRay,t),ScreenToRay.prototype.convert=function(){var t=this._camera.value.component;if(t||(t=mt.renderer.defaultPerspectiveCamera),t){var n=this._screenPos.value,r=t.getWorldRay(n.x,n.y);r&&this._ray.setData(r)}},ScreenToRay_decorate([Attributes_unserializable(),ScreenToRay_metadata("design:type",Va)],ScreenToRay.prototype,"_screenPos",void 0),ScreenToRay_decorate([Attributes_unserializable(),ScreenToRay_metadata("design:type",Ka)],ScreenToRay.prototype,"_camera",void 0),ScreenToRay_decorate([Attributes_unserializable(),ScreenToRay_metadata("design:type",Ga)],ScreenToRay.prototype,"_ray",void 0),ScreenToRay=ScreenToRay_decorate([displayName("Screen to Ray"),ScreenToRay_metadata("design:paramtypes",[])],ScreenToRay)}(ps),Kc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),RayCastOnPlane_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},RayCastOnPlane_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Qc=function(t){function RayCastOnPlane(){var n=t.call(this)||this;return n._plane=new N,n.createPin("_ray",Pt.Input,Ga),n.createPin("_planeNormal",Pt.Input,Ua),n.createPin("_planeDist",Pt.Input,Fa),n.createPin("_intersects",Pt.Output,Na),n.createPin("_intersection",Pt.Output,Ua),n}return Kc(RayCastOnPlane,t),RayCastOnPlane.prototype.convert=function(){this._plane.set(this._planeNormal.getData(),this._planeDist.getData());var t=this._ray.getData().castOnPlane(this._plane),n=null!==t.intersection;this._intersects.setData(n),n&&this._intersection.setData(t.intersection)},RayCastOnPlane_decorate([Attributes_unserializable(),RayCastOnPlane_metadata("design:type",Ga)],RayCastOnPlane.prototype,"_ray",void 0),RayCastOnPlane_decorate([Attributes_unserializable(),RayCastOnPlane_metadata("design:type",Ua)],RayCastOnPlane.prototype,"_planeNormal",void 0),RayCastOnPlane_decorate([Attributes_unserializable(),RayCastOnPlane_metadata("design:type",Fa)],RayCastOnPlane.prototype,"_planeDist",void 0),RayCastOnPlane_decorate([Attributes_unserializable(),RayCastOnPlane_metadata("design:type",Na)],RayCastOnPlane.prototype,"_intersects",void 0),RayCastOnPlane_decorate([Attributes_unserializable(),RayCastOnPlane_metadata("design:type",Ua)],RayCastOnPlane.prototype,"_intersection",void 0),RayCastOnPlane_decorate([Attributes_unserializable(),RayCastOnPlane_metadata("design:type",Object)],RayCastOnPlane.prototype,"_plane",void 0),RayCastOnPlane=RayCastOnPlane_decorate([displayName("RayCast on Plane"),RayCastOnPlane_metadata("design:paramtypes",[])],RayCastOnPlane)}(ps),Yc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Zc=function(t){function ParticlesCollisionShape(n){var r=t.call(this)||this;return r.tag="Particles",r._particles=new Gt(ho),n&&r.setState(n),r}return Yc(ParticlesCollisionShape,t),Object.defineProperty(ParticlesCollisionShape.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),Object.defineProperty(ParticlesCollisionShape.prototype,"particlesEntity",{set:function(t){this._particles.component=t.getComponent(ho)},enumerable:!1,configurable:!0}),Object.defineProperty(ParticlesCollisionShape.prototype,"particles",{get:function(){return this._particles.component},enumerable:!1,configurable:!0}),ParticlesCollisionShape.prototype.getTestPriority=function(){return Jn.Particles},ParticlesCollisionShape.prototype.checkCollisions=function(t,n,r,o){var i=this._particles.component;i&&i.checkCollisions(t,r,o)},ParticlesCollisionShape.prototype.upgrade=function(t,n){return 1===n&&(Object.assign(t.properties,{_particles:t.properties.particles}),delete t.properties.particles),t},ParticlesCollisionShape}(or),Jc=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),SpriteGeometry_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},SpriteGeometry_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},$c=function(t){function SpriteGeometry(){var n=null!==t&&t.apply(this,arguments)||this;return n.sprite=new K(Do),n}return Jc(SpriteGeometry,t),SpriteGeometry.prototype.getVertexBuffer=function(){return this._vertexBuffer||(this._vertexBuffer=new Vt,this._vertexBuffer.isDynamic=!0,this._vertexBuffer.primitiveType="TRIANGLES",this._vertexBuffer.setAttribute("position",[]),this._vertexBuffer.setAttribute("uv",[])),this.sprite.asset&&this.sprite.asset.tesselateInWorldUnits(this._vertexBuffer),this._vertexBuffer},SpriteGeometry.prototype.destroy=function(){this._vertexBuffer&&this._vertexBuffer.unload(),t.prototype.destroy.call(this)},SpriteGeometry_decorate([Attributes_unserializable(),SpriteGeometry_metadata("design:type",Vt)],SpriteGeometry.prototype,"_vertexBuffer",void 0),SpriteGeometry=SpriteGeometry_decorate([displayName("Sprite")],SpriteGeometry)}(br),tu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),eu=function(t){function Data(n){var r=t.call(this)||this;return r._pins=new Rt(At),r._declaration=new K(ce),n&&r.setState(n),r.onDeclarationPinChanged=r.onDeclarationPinChanged.bind(r),r.onDeclarationChanged=r.onDeclarationChanged.bind(r),r._declaration.assetChanged.attach(r.onDeclarationChanged),r}return tu(Data,t),Object.defineProperty(Data.prototype,"declaration",{get:function(){return this._declaration.asset},set:function(t){this._declaration.asset=t},enumerable:!1,configurable:!0}),Object.defineProperty(Data.prototype,"declarationId",{get:function(){return this._declaration.id},enumerable:!1,configurable:!0}),Object.defineProperty(Data.prototype,"pins",{get:function(){return this._pins},enumerable:!1,configurable:!0}),Data.prototype.destroy=function(){this.declaration&&this.declaration.pinChanged.detach(this.onDeclarationPinChanged),this._declaration.detach(),t.prototype.destroy.call(this)},Data.prototype.setProperty=function(n,r){t.prototype.setProperty.call(this,n,r),n===Data.pinsPropertyKey&&ma.updatePinAccessors(this)},Data.prototype.getPins=function(){return this._pins},Data.prototype.setPins=function(t){this._pins=t},Data.prototype.findPinByName=function(t){return this._pins.data.map((function(t){return t.instance})).find((function(n){return n.name===t}))},Data.prototype.isLoaded=function(){if(!t.prototype.isLoaded.call(this))return!1;for(var n=0,r=this._pins.data;n<r.length;n++){var o=r[n];if(!ma.isPinLoaded(o.instance))return!1}return!0},Data.prototype.onDeclarationPinChanged=function(t){ma.buildPins(this,this.declaration)},Data.prototype.onDeclarationChanged=function(t){var n=t.oldAsset;n&&n.pinChanged.detach(this.onDeclarationPinChanged);var r=t.newAsset;r&&(ma.buildPins(this,r),r.pinChanged.attach(this.onDeclarationPinChanged))},Data.pinsPropertyKey="_pins",Data}(fn),nu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),DynamicGeometry_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},DynamicGeometry_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},ru=function(t){function DynamicGeometry(n){var r=t.call(this)||this;return n&&r.setState(n),r}return nu(DynamicGeometry,t),Object.defineProperty(DynamicGeometry.prototype,"vertexBuffer",{get:function(){return this._vb},set:function(t){this._vb=t},enumerable:!1,configurable:!0}),DynamicGeometry.prototype.getVertexBuffer=function(){return this._vb},DynamicGeometry.prototype.getBoundingBox=function(){return!this._boundingBox&&this._vb&&(this._boundingBox=Ft.fromVertexBuffer(this._vb)),this._boundingBox},DynamicGeometry_decorate([Attributes_unserializable(),DynamicGeometry_metadata("design:type",Vt)],DynamicGeometry.prototype,"_vb",void 0),DynamicGeometry_decorate([Attributes_unserializable(),DynamicGeometry_metadata("design:type",Ft)],DynamicGeometry.prototype,"_boundingBox",void 0),DynamicGeometry}(br),ou=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),GamepadData_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},iu=function(t){function GamepadData(){var n=null!==t&&t.apply(this,arguments)||this;return n._data={},n}return ou(GamepadData,t),Object.defineProperty(GamepadData.prototype,"version",{get:function(){return 1},enumerable:!1,configurable:!0}),Object.defineProperty(GamepadData.prototype,"data",{get:function(){return this._data},set:function(t){this._data=t,yt.instance.saveObject(this)},enumerable:!1,configurable:!0}),GamepadData.prototype.serialize=function(){return{typeName:this.constructor.name,version:this.version,id:this.id,name:this.name,data:this._data}},GamepadData.prototype.deserialize=function(t){var n=t;return this.id=n.id,this.name=n.name,this._data=n.data,this},GamepadData=GamepadData_decorate([displayName("Gamepad Data")],GamepadData)}(nt),au=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),GamepadRecorder_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},GamepadRecorder_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},su=function(t){function GamepadRecorder(){var n=t.call(this)||this;return n.createPin("_frameSkip",Pt.Input,Fa),n.createPin("_gamePadIndex",Pt.Input,Fa),n.createAssetPin("_dataStore",Pt.Input,iu),n}return au(GamepadRecorder,t),GamepadRecorder.prototype.onStart=function(){return this._data={},dt.Continue},GamepadRecorder.prototype.onUpdate=function(){var t=this._frameSkip.value+1,n=je.currentFrame;if(n%t==0){var r=this._gamePadIndex.value,o=Re.get(r);o&&(this._data[n]={buttons:o.buttons.map((function(t){return t})),axes:JSON.parse(JSON.stringify(o.axes))})}return dt.Continue},GamepadRecorder.prototype.destroy=function(){var t=this._dataStore.value.asset;t&&(t.data=this._data)},GamepadRecorder_decorate([Attributes_unserializable(),GamepadRecorder_metadata("design:type",Fa)],GamepadRecorder.prototype,"_frameSkip",void 0),GamepadRecorder_decorate([Attributes_unserializable(),GamepadRecorder_metadata("design:type",Fa)],GamepadRecorder.prototype,"_gamePadIndex",void 0),GamepadRecorder_decorate([Attributes_unserializable(),GamepadRecorder_metadata("design:type",Ja)],GamepadRecorder.prototype,"_dataStore",void 0),GamepadRecorder_decorate([Attributes_unserializable(),GamepadRecorder_metadata("design:type",Object)],GamepadRecorder.prototype,"_data",void 0),GamepadRecorder=GamepadRecorder_decorate([displayName("Gamepad Recorder"),GamepadRecorder_metadata("design:paramtypes",[])],GamepadRecorder)}(rs),cu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),uu=function(t){function Proxy(){return null!==t&&t.apply(this,arguments)||this}return cu(Proxy,t),Proxy}(fn),lu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),pu=function(t){function NumberKey(){return null!==t&&t.apply(this,arguments)||this}return lu(NumberKey,t),NumberKey.prototype.setValue=function(t){this.value=t},NumberKey.prototype.lerp=function(t,n,r){return P.lerp(t.value,n.value,r)},NumberKey}(Rc),fu=function(t){function BooleanKey(){return null!==t&&t.apply(this,arguments)||this}return lu(BooleanKey,t),BooleanKey.prototype.lerp=function(t,n,r){return t.value},BooleanKey}(Rc),hu=function(t){function StringKey(){return null!==t&&t.apply(this,arguments)||this}return lu(StringKey,t),StringKey.prototype.lerp=function(t,n,r){return t.value},StringKey}(Rc),du=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),yu=function(t){function ColorKey(){return null!==t&&t.apply(this,arguments)||this}return du(ColorKey,t),ColorKey.prototype.lerp=function(t,n,r,o){return(o||It.dummy).copy(t.value).lerp(n.value,r)},ColorKey.prototype.setValue=function(t){this.value=new It(t.r,t.g,t.b,t.a)},ColorKey}(Rc),mu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),AssetKey_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},AssetKey_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},vu=function(t){function AssetKey(){return null!==t&&t.apply(this,arguments)||this}return mu(AssetKey,t),AssetKey.prototype.lerp=function(t,n,r){return t.assetRef?t.assetRef.asset:null},AssetKey.prototype.initializeReference=function(n,r,o){var i=this;if(t.prototype.setValue.call(this,n),this.assetRef||(this.assetRef=I.instance.createAssetReference(r),this.assetRef.state=q.Loading),void 0!==n){Mn.loadObject(n,(function(t,n){i.assetRef.asset=t,o()}),o,!1)}else this.assetRef.asset=null,o()},AssetKey.prototype.isLoaded=function(){return Y.isAssetRefLoaded(this.assetRef)},AssetKey.prototype.getValue=function(){return this.assetRef.asset},AssetKey_decorate([Attributes_unserializable(),AssetKey_metadata("design:type",K)],AssetKey.prototype,"assetRef",void 0),AssetKey}(Rc),gu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),_u=function(t){function SingleTrack(n){var r=t.call(this)||this;return r.keys=new xt(n),r.internalCreateKey=function(){return new n},r}return gu(SingleTrack,t),Object.defineProperty(SingleTrack.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),SingleTrack.prototype.getKeys=function(){return this.keys.data},SingleTrack.prototype.createKey=function(t,n,r){var o=yc.find(this.keys.data,t);o?o.setValue(n):((o=this.internalCreateKey()).time=t,o.setValue(n),this.keys.grow(o),this.sortByTime()),r&&r(o)},SingleTrack.prototype.removeKey=function(t){for(var n=0;n<this.keys.data.length;++n)if(this.keys.data[n]===t){this.keys.data.splice(n,1);break}},SingleTrack.prototype.sortByTime=function(t){if(void 0===t&&(t=!0),this.keys.data.sort((function(t,n){return t.time-n.time})),t)for(var n=0;n<this.keys.data.length-1;){var r=this.keys.data[n],o=this.keys.data[n+1];r.time===o.time?this.keys.data.splice(n,1):++n}},SingleTrack.prototype.serialize=function(){return{typeName:this.constructor.name,version:this.version,times:this.keys.data.map((function(t){return t.time})),values:this.keys.data.map((function(t){return t.value}))}},SingleTrack.prototype.deserialize=function(t){1===t.version&&console.assert(!1);for(var n=t,r=0;r<n.times.length;++r){var o=this.internalCreateKey();o.time=n.times[r],o.setValue(n.values[r]),this.keys.grow(o)}return this},SingleTrack}(Ac),bu=function(t){function BooleanTrack(){return t.call(this,fu)||this}return gu(BooleanTrack,t),BooleanTrack}(_u),wu=function(t){function StringTrack(){return t.call(this,hu)||this}return gu(StringTrack,t),StringTrack}(_u),xu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Pu=function(t){function NumberTrack(){return t.call(this,pu)||this}return xu(NumberTrack,t),Object.defineProperty(NumberTrack.prototype,"version",{get:function(){return 3},enumerable:!1,configurable:!0}),NumberTrack.prototype.getSample=function(t){var n=this.getKeys();if(0!==n.length){var r=n.filter((function(n){return n.time>t}));if(r.length===n.length)return r[0].value;var o=n.filter((function(n){return n.time<=t}));console.assert(o.length>0);var i=o[o.length-1];if(o.length===n.length)return i.value;console.assert(r.length>0);var a=r[0],c=(t-i.time)/(a.time-i.time);return i.lerp(i,a,c)}},NumberTrack.prototype.serialize=function(){return{typeName:this.constructor.name,version:this.version,times:this.keys.data.map((function(t){return[t.time,t.tangents[0][0],t.tangents[1][0]]})),values:this.keys.data.map((function(t){return[t.value,t.tangents[0][1],t.tangents[1][1]]}))}},NumberTrack.prototype.deserialize=function(t){if(1===t.version)console.assert(!1);else if(2===t.version){var n=t,r=n.times,o=n.values;Object.assign(t,{times:r.map((function(t){return[t,t,t]})),values:o.map((function(t){return[t,t,t]}))})}for(var i=t,a=0;a<i.times.length;++a){var c=this.internalCreateKey();c.time=i.times[a][0],c.setValue(i.values[a][0]),c.tangents=[[i.times[a][1],i.values[a][1]],[i.times[a][2],i.values[a][2]]],this.keys.grow(c)}return this},NumberTrack}(_u),Ou=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Cu=function(t){function AnimationSubTrackDefinition(n,r){var o=t.call(this)||this;return o.componentId=n||"",o.track=r||new v(Pu),o}return Ou(AnimationSubTrackDefinition,t),AnimationSubTrackDefinition}(z),Su=function(t){function CompositeTrack(){var n=null!==t&&t.apply(this,arguments)||this;return n.tracks=new xt(Cu),n}return Ou(CompositeTrack,t),CompositeTrack.prototype.getSample=function(t,n){for(var r=0,o=this.tracks.data;r<o.length;r++){var i=o[r],a=i.track.instance.getSample(t);void 0!==a&&(n[i.componentId]=a)}return n},CompositeTrack}(Ac),Au=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Eu=function(t){function AssetTrack(n){var r=t.call(this,vu)||this;return r._typeName=n,r}return Au(AssetTrack,t),Object.defineProperty(AssetTrack.prototype,"typeName",{get:function(){return this._typeName},enumerable:!1,configurable:!0}),AssetTrack.prototype.createKey=function(t,n,r){var o=yc.find(this.keys.data,t);if(o)o.initializeReference(n,this._typeName,(function(){r&&r(o)}));else{var i=this.internalCreateKey();i.time=t,this.keys.grow(i),this.sortByTime(),i.initializeReference(n,this._typeName,(function(){r&&r(i)}))}},AssetTrack.prototype.isLoaded=function(){if(!this._typeName)return!1;if(this.keys)for(var t=0,n=this.keys.data;t<n.length;t++){if(!n[t].isLoaded())return!1}return!0},AssetTrack.prototype.serialize=function(){var t={typeName:this.constructor.name,version:this.version,times:this.keys.data.map((function(t){return t.time})),values:this.keys.data.map((function(t){return t.value}))};return Object.assign(t,{_typeName:this._typeName}),t},AssetTrack.prototype.deserialize=function(n){1===n.version?this._typeName=n.properties._typeName.data:this._typeName=n._typeName,t.prototype.deserialize.call(this,n);for(var r=0,o=this.keys.data;r<o.length;r++){var i=o[r];i.initializeReference(i.value,this.typeName,(function(){}))}return this},AssetTrack}(_u),ju=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Tu=function(t){function ColorTrack(){return t.call(this,yu)||this}return ju(ColorTrack,t),ColorTrack.prototype.createKey=function(t,n,r){var o=yc.find(this.keys.data,t);o?o.getValue().copy(n):((o=this.internalCreateKey()).time=t,o.setValue((new It).copy(n)),this.keys.grow(o),this.sortByTime()),r&&r(o)},ColorTrack.prototype.getSample=function(t,n){var r=this.getKeys();if(0!==r.length&&n){var o=r.filter((function(n){return n.time>t}));if(o.length===r.length)return n.copy(o[0].getValue());var i=r.filter((function(n){return n.time<=t}));console.assert(i.length>0);var a=i[i.length-1];if(i.length===r.length)return n.copy(a.getValue());var c=o[0],u=(t-a.time)/(c.time-a.time);return a.lerp(a,c,u,n)}},ColorTrack}(_u),Ru=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Bu=function(t){function RotationTrack(){var n=t.call(this)||this;return n.eulerOrder="YXZ",n.tracks.grow(new Cu("x",new v(Pu,new Pu))),n.tracks.grow(new Cu("y",new v(Pu,new Pu))),n.tracks.grow(new Cu("z",new v(Pu,new Pu))),n}return Ru(RotationTrack,t),RotationTrack.prototype.getSample=function(t,n){var r=this.tracks.data[0].track.instance,o=this.tracks.data[1].track.instance,i=this.tracks.data[2].track.instance;return n.setFromEulerAngles(r.getSample(t)||0,o.getSample(t)||0,i.getSample(t)||0,this.eulerOrder)},RotationTrack}(Su),Mu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),MeshParticle_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},MeshParticle_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)};!function(t){t.meshPropertyKey="mesh"}(jc||(jc={}));var Iu,zu=function(t){function MeshParticle(){var n=t.call(this)||this;return n.mesh=new K(Or),n.scale=new w(1,1,1),n.onMeshChanged=n.onMeshChanged.bind(n),n.mesh.assetChanged.attach(n.onMeshChanged),n}return Mu(MeshParticle,t),MeshParticle.prototype.getPositions=function(t,n,r){var o=this.mesh.asset?this.mesh.asset.vertexBuffer:null;if(o)for(var i=o.attributes.position,a=0;a<o.vertexCount;++a){var c=3*a,u=n+c;t[u+0]=i[c+0]*r*this.scale.x,t[u+1]=i[c+1]*r*this.scale.y,t[u+2]=i[c+2]*r*this.scale.z}},MeshParticle.prototype.getUvs=function(t,n){var r=this.mesh.asset?this.mesh.asset.vertexBuffer:null;if(r)for(var o=r.attributes.uv,i=2*r.vertexCount,a=0;a<i;++a)t[n+a]=o[a]},MeshParticle.prototype.makeLocalTransform=function(t,n){},MeshParticle.prototype.makeParticleTransform=function(t,n){t.makeLookAt(n.normalize(),w.up).transpose()},MeshParticle.prototype.vertexCount=function(){return this.mesh.asset?this.mesh.asset.vertexBuffer.vertexCount:0},MeshParticle.prototype.setProperty=function(n,r){t.prototype.setProperty.call(this,n,r),this.onPropertyChanged&&this.onPropertyChanged(n)},MeshParticle.prototype.destroy=function(){this.mesh.detach()},MeshParticle.prototype.onMeshChanged=function(t){this.onPropertyChanged&&this.onPropertyChanged(jc.meshPropertyKey)},MeshParticle=MeshParticle_decorate([displayName("Mesh"),MeshParticle_metadata("design:paramtypes",[])],MeshParticle)}(Jr),ku=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),BoxGeometry_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},BoxGeometry_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Du=function(t){function BoxGeometry(){var n=null!==t&&t.apply(this,arguments)||this;return n._boundingBox=new Ft(new w(-1,-1,-1),new w(1,1,1)),n}return ku(BoxGeometry,t),BoxGeometry.prototype.getVertexBuffer=function(){return Is.primitives.box.vertexBuffer},BoxGeometry.prototype.getBoundingBox=function(){return this._boundingBox},BoxGeometry_decorate([Attributes_unserializable(),BoxGeometry_metadata("design:type",Object)],BoxGeometry.prototype,"_boundingBox",void 0),BoxGeometry=BoxGeometry_decorate([displayName("Box")],BoxGeometry)}(br),Fu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),SphereGeometry_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},SphereGeometry_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Lu=function(t){function SphereGeometry(){var n=null!==t&&t.apply(this,arguments)||this;return n._boundingBox=new Ft(new w(-1,-1,-1),new w(1,1,1)),n}return Fu(SphereGeometry,t),SphereGeometry.prototype.getVertexBuffer=function(){return Is.primitives.sphere.vertexBuffer},SphereGeometry.prototype.getBoundingBox=function(){return this._boundingBox},SphereGeometry_decorate([Attributes_unserializable(),SphereGeometry_metadata("design:type",Object)],SphereGeometry.prototype,"_boundingBox",void 0),SphereGeometry=SphereGeometry_decorate([displayName("Sphere")],SphereGeometry)}(br),Nu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),PlaneGeometry_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},PlaneGeometry_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Vu=function(t){function PlaneGeometry(){var n=null!==t&&t.apply(this,arguments)||this;return n._boundingBox=new Ft(new w(-1,-.1,-1),new w(1,.1,1)),n}return Nu(PlaneGeometry,t),PlaneGeometry.prototype.getVertexBuffer=function(){return Is.primitives.plane.vertexBuffer},PlaneGeometry.prototype.getBoundingBox=function(){return this._boundingBox},PlaneGeometry_decorate([Attributes_unserializable(),PlaneGeometry_metadata("design:type",Object)],PlaneGeometry.prototype,"_boundingBox",void 0),PlaneGeometry=PlaneGeometry_decorate([displayName("Plane")],PlaneGeometry)}(br),Uu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ConeGeometry_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},ConeGeometry_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Wu=function(t){function ConeGeometry(){var n=null!==t&&t.apply(this,arguments)||this;return n._boundingBox=new Ft(new w(-1,-1,-1),new w(1,1,1)),n}return Uu(ConeGeometry,t),ConeGeometry.prototype.getVertexBuffer=function(){return Is.primitives.cone.vertexBuffer},ConeGeometry.prototype.getBoundingBox=function(){return this._boundingBox},ConeGeometry_decorate([Attributes_unserializable(),ConeGeometry_metadata("design:type",Object)],ConeGeometry.prototype,"_boundingBox",void 0),ConeGeometry=ConeGeometry_decorate([displayName("Cone")],ConeGeometry)}(br),qu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}();!function(t){t.dummyTransform={worldForward:w.forward,worldUp:w.up,worldMatrix:A.identity}}(Iu||(Iu={}));var Gu,Hu=function(t){function IKFootSolver(){return null!==t&&t.apply(this,arguments)||this}return qu(IKFootSolver,t),IKFootSolver.prototype.update=function(){var t=this.getEntity(),n=this.getEffector();if(t&&n&&t.parent){var r=t.getComponents(Xi).filter((function(t){return t.active}));if(!(r.length<3)){var o=r[0],i=r[1],a=(r[2],r.map((function(t){return t.entity.transform.worldPosition}))),c=a[0],u=a[1],l=a[2],p=n.entity.transform.worldPosition,f=t.parent.transform||Iu.dummyTransform,h=f.worldForward,d=f.worldUp,y=f.worldMatrix,m=w.fromPool().copy(p).substract(c).projectOnVector(d),v=w.distance(w.fromPool().copy(p).substract(m),c),g=w.fromPool().copy(h).multiply(v).add(c).add(m),_=A.fromPool().compose(t.transform.position,kt.identity,t.transform.scale),b=A.fromPool().multiplyMatrices(y,_).invert(),x=w.fromPool().copy(g).transform(b).normalize(),O=w.distance(c,u),C=w.distance(u,l),S=w.distance(c,g),E=Math.atan2(x.z,-x.y);x.copy(p).transform(b).normalize();var j=Math.atan2(x.x,x.z),T=kt.fromPool(),R=kt.fromPool();if(S>=O+C)T.setFromEulerAngles(-E,j,0),R.copy(kt.identity);else{var B=(C*C-O*O-S*S)/(-2*O*S),M=Math.acos(P.clamp(B,-1,1));T.setFromEulerAngles(-(E+M),j,0);var I=(S*S-O*O-C*C)/(-2*O*C),z=Math.acos(P.clamp(I,-1,1));R.setFromEulerAngles(Math.PI-z,0,0)}o.entity.transform.rotation.slerp(T,n.influence),i.entity.transform.rotation.slerp(R,n.influence)}}},IKFootSolver}(Vi),Xu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Ku=function(t){function AnimationTransition(){var n=null!==t&&t.apply(this,arguments)||this;return n.from=new K(mn),n.to=new K(mn),n.duration=.3,n}return Xu(AnimationTransition,t),AnimationTransition}(nt),Qu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),Yu=function(t){function ModelMesh(){var n=null!==t&&t.apply(this,arguments)||this;return n.material=new K(vr),n.mesh=new K(Or),n}return Qu(ModelMesh,t),Object.defineProperty(ModelMesh.prototype,"version",{get:function(){return 2},enumerable:!1,configurable:!0}),ModelMesh.prototype.destroy=function(){this.material.detach(),this.mesh.detach()},ModelMesh.prototype.isLoaded=function(){return Y.isAssetRefLoaded(this.material)&&Y.isAssetRefLoaded(this.mesh)},ModelMesh.prototype.upgrade=function(t,n){if(1===n){for(var r={typeName:"ModelElement",data:[]},o=0,i=t.properties.children.data;o<i.length;o++){var a=i[o],c={baseTypeName:"ModelElement",data:{typeName:t.properties.children.typeName}};Object.assign(c.data,a),r.data.push(c)}t.properties.children=r}return t},ModelMesh}(Pc),Zu=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ModelSkinnedMesh_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},ModelSkinnedMesh_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},Ju=function(t){function ModelSkinnedMesh(){var n=null!==t&&t.apply(this,arguments)||this;return n._bindMatrix=new E,n._bonesFbxIds=new xt(Number),n}return Zu(ModelSkinnedMesh,t),Object.defineProperty(ModelSkinnedMesh.prototype,"bindMatrix",{get:function(){return this._bindMatrix},set:function(t){this._bindMatrix.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(ModelSkinnedMesh.prototype,"boneFbxIds",{get:function(){return this._bonesFbxIds.data.map((function(t){return t.valueOf()}))},enumerable:!1,configurable:!0}),ModelSkinnedMesh.prototype.setBones=function(t){this._bonesFbxIds.data.length=0;for(var n=0,r=t;n<r.length;n++){var o=r[n];this._bonesFbxIds.grow(o.fbxNodeId)}},ModelSkinnedMesh_decorate([Attributes_hidden(),ModelSkinnedMesh_metadata("design:type",Object)],ModelSkinnedMesh.prototype,"_bonesFbxIds",void 0),ModelSkinnedMesh}(Yu),$u=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),tl=function(t){function ModelBone(){var n=null!==t&&t.apply(this,arguments)||this;return n.worldMatrix=new E,n}return $u(ModelBone,t),ModelBone}(Pc),el=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),nl=function(t){function ModelSubMesh(){var n=null!==t&&t.apply(this,arguments)||this;return n.geometry=new K(Or),n.material=new K(vr),n}return el(ModelSubMesh,t),ModelSubMesh.prototype.destroy=function(){this.geometry.detach(),this.material.detach()},ModelSubMesh}(z),rl=function(t){function ModelMultiMesh(){var n=null!==t&&t.apply(this,arguments)||this;return n.subMeshes=new xt(nl),n}return el(ModelMultiMesh,t),ModelMultiMesh.prototype.destroy=function(){this.subMeshes.data.forEach((function(t){return t.destroy()}))},ModelMultiMesh}(Pc),ol=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),VisualFilters_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},VisualFilters_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},il=function(t){function InclusionVisualFilter(n){var r=t.call(this)||this;return r._included=new Kt(xr),n&&(r._included.data=n.map((function(t){return new K(xr,t)}))),r}return ol(InclusionVisualFilter,t),InclusionVisualFilter.prototype.getIncluded=function(){return this._included},InclusionVisualFilter=VisualFilters_decorate([displayName("Include"),VisualFilters_metadata("design:paramtypes",[Array])],InclusionVisualFilter)}(Js),al=function(t){function ExclusionVisualFilter(n){var r=t.call(this)||this;return r._excluded=new Kt(xr),n&&(r._excluded.data=n.map((function(t){return new K(xr,t)}))),r}return ol(ExclusionVisualFilter,t),ExclusionVisualFilter.prototype.getExcluded=function(){return this._excluded},ExclusionVisualFilter=VisualFilters_decorate([displayName("Exclude"),VisualFilters_metadata("design:paramtypes",[Array])],ExclusionVisualFilter)}(Js),sl=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),CaptureMode_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},CaptureMode_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},cl=function(t){function CaptureMode(){return null!==t&&t.apply(this,arguments)||this}return sl(CaptureMode,t),CaptureMode.prototype.tick=function(){},CaptureMode.prototype.canCapture=function(){return!1},CaptureMode}(z),ul=function(t){function CaptureOnce(){var n=null!==t&&t.apply(this,arguments)||this;return n.captured=!1,n}return sl(CaptureOnce,t),CaptureOnce.prototype.tick=function(){this.captured=!0},CaptureOnce.prototype.canCapture=function(){return!this.captured},CaptureMode_decorate([Attributes_unserializable(),CaptureMode_metadata("design:type",Object)],CaptureOnce.prototype,"captured",void 0),CaptureOnce=CaptureMode_decorate([displayName("Once")],CaptureOnce)}(cl),ll=function(t){function CaptureAllTheTime(){return null!==t&&t.apply(this,arguments)||this}return sl(CaptureAllTheTime,t),CaptureAllTheTime.prototype.canCapture=function(){return!0},CaptureAllTheTime=CaptureMode_decorate([displayName("Every frame")],CaptureAllTheTime)}(cl),pl=function(t){function CaptureByFrequency(){var n=null!==t&&t.apply(this,arguments)||this;return n.frequency=.2,n.timer=-1,n}return sl(CaptureByFrequency,t),CaptureByFrequency.prototype.tick=function(){this.timer<0?this.timer=this.frequency:this.timer-=je.deltaTime},CaptureByFrequency.prototype.canCapture=function(){return this.timer<0},CaptureMode_decorate([Attributes_unserializable(),CaptureMode_metadata("design:type",Object)],CaptureByFrequency.prototype,"timer",void 0),CaptureByFrequency=CaptureMode_decorate([displayName("Every X Seconds")],CaptureByFrequency)}(cl),fl=function(){var extendStatics=function(t,n){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function __(){this.constructor=t}extendStatics(t,n),t.prototype=null===n?Object.create(n):(__.prototype=n.prototype,new __)}}(),ReflectionProbe_decorate=function(t,n,r,o){var i,a=arguments.length,c=a<3?n:null===o?o=Object.getOwnPropertyDescriptor(n,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,n,r,o);else for(var u=t.length-1;u>=0;u--)(i=t[u])&&(c=(a<3?i(c):a>3?i(n,r,c):i(n,r))||c);return a>3&&c&&Object.defineProperty(n,r,c),c},ReflectionProbe_metadata=function(t,n){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,n)},hl=function(t){function ReflectionProbe(){var n=null!==t&&t.apply(this,arguments)||this;return n._resolution=512,n._radius=100,n._filter=new v(Js),n._captureMode=new v(cl,new pl),n._captureRig=null,n._renderTarget=null,n}return fl(ReflectionProbe,t),Object.defineProperty(ReflectionProbe.prototype,"renderTarget",{get:function(){return this._renderTarget},enumerable:!1,configurable:!0}),ReflectionProbe.prototype.canRenderGroup=function(t){var n,r;return null===(r=null===(n=this._filter.instance)||void 0===n?void 0:n.canRender(t))||void 0===r||r},ReflectionProbe.prototype.canCapture=function(){var t;return null===(t=this._captureMode.instance)||void 0===t?void 0:t.canCapture()},ReflectionProbe.prototype.tick=function(){var t;null===(t=this._captureMode.instance)||void 0===t||t.tick()},ReflectionProbe.prototype.traverseCameras=function(t){this.getCaptureRig().children.forEach((function(n){t(n.getComponent(ec))}))},ReflectionProbe.prototype.getCameraIndex=function(t){return this.getCaptureRig().children.findIndex((function(n){return n.getComponent(ec)===t}))},ReflectionProbe.prototype.getCaptureRig=function(){var t=this;if(this._captureRig)return this._captureRig;this._captureRig=Ra.create({prefab:Is.cubemapCaptureRig}),this._captureRig.transient=!0;var n=new lt(it.Absolute,this._resolution);return this._renderTarget=new gt(n,n,void 0,!1,void 0,!0),this._captureRig.children.forEach((function(n){var r=n.getComponent(ec);r.projector.zFar=t._radius,r.renderTarget=t._renderTarget})),this.entity.addChild(this._captureRig),this._captureRig},ReflectionProbe_decorate([nullable(!1),ReflectionProbe_metadata("design:type",Object)],ReflectionProbe.prototype,"_captureMode",void 0),ReflectionProbe_decorate([Attributes_unserializable(),ReflectionProbe_metadata("design:type",Object)],ReflectionProbe.prototype,"_captureRig",void 0),ReflectionProbe_decorate([Attributes_unserializable(),ReflectionProbe_metadata("design:type",Object)],ReflectionProbe.prototype,"_renderTarget",void 0),ReflectionProbe}(fn),dl=function(){function TypeRegistration(){}return TypeRegistration.registerDefaultTypes=function(){var t=I.instance;t.registerObject(z),t.registerObject(J,z),t.registerObject(ja,J),t.registerObject(H,z),t.registerObject(nt,J),t.registerObject(sn,nt),t.registerObject(Ia,nt),t.registerObject(fn,z,!0),t.registerObject(Yn,fn),t.registerObject(ec,fn),t.registerObject(Er,fn),t.registerObject(Ks,H),t.registerObject(bt,H),t.registerObject(Tn,J),t.registerObject(uu,fn),t.registerObject(Ts,z),t.registerObject(Rs,Ts),t.registerObject(Bs,Ts),t.registerObject(Ms,Ts),t.registerObject(zr,fn),t.registerObject(br,z),t.registerObject(_c,br),t.registerObject(Wc,br),t.registerObject(Sr,br),t.registerObject(Mr,Sr),t.registerObject(Lc,br),t.registerObject($c,br),t.registerObject(ru,br),t.registerObject(Du,br),t.registerObject(Lu,br),t.registerObject(Vu,br),t.registerObject(Wu,br),t.registerObject(xr,nt),t.registerObject(vr,nt),t.registerObject(ot,nt),t.registerObject(rn,ot),t.registerObject(dc,rn),t.registerObject(ct,ot),t.registerObject(Fe,ct),t.registerObject(gt,ct),t.registerObject(mi,ct),t.registerObject(Tr,ct),t.registerObject(Gr,ct),t.registerObject(Ne,ct),t.registerObject(Or,ot),t.registerObject(Cc,nt),t.registerObject(Pc,J),t.registerObject(Yu,Pc),t.registerObject(rl,Pc),t.registerObject(nl,z),t.registerObject(Ju,Yu),t.registerObject(tl,Pc),t.registerObject(Yr,z),t.registerObject(Dc,Yr),t.registerObject(io,Yr),t.registerObject(Vc,fn),t.registerObject(oc,z),t.registerObject(ac,oc),t.registerObject(lo,z),t.registerObject(po,lo),t.registerObject(fo,lo),t.registerObject(Ue,z),t.registerObject(We,Ue),t.registerObject(qe,Ue),t.registerObject(Ge,Ue),t.registerObject(Xe,z),t.registerObject(Qe,Xe),t.registerObject(Ke,Xe),t.registerObject(Hs,z),t.registerObject(Us,z),t.registerObject(Ws,Us),t.registerObject(qs,z),t.registerObject(Gs,qs),t.registerObject(Kr,fn),t.registerObject(Js,z),t.registerObject(il,Js),t.registerObject(al,Js),t.registerObject(cc,z),t.registerObject(uc,cc),t.registerObject(lc,uc),t.registerObject(pc,cc),t.registerObject(hl,fn),t.registerObject(cl,z),t.registerObject(ul,cl),t.registerObject(pl,cl),t.registerObject(ll,cl),t.registerObject(ho,fn),t.registerObject(ro,br),t.registerObject(Jr,z),t.registerObject(so,Jr),t.registerObject(zu,Jr),t.registerObject(hr,fn),t.registerObject(oa,fn),t.registerObject(Xn,nt),t.registerObject(or,z),t.registerObject(ur,or),t.registerObject(pr,or),t.registerObject(Zc,or),t.registerObject(Lr,or),t.registerObject(Dr,or),t.registerObject(Oo,or),t.registerObject(Qa,jt),t.registerObject(xo,fn),t.registerObject(To,fn),t.registerObject($n,z,!0),t.registerObject(tr,$n),t.registerObject(er,$n),t.registerObject(ri,fn),t.registerObject(xi,fn),t.registerObject(Mo,fn),t.registerObject(Oi,ri),t.registerObject(Ri,ri),t.registerObject(ji,ri),t.registerObject(bi,ri),t.registerObject(Uo,fn),t.registerObject(Li,fn),t.registerObject(Do,nt),t.registerObject(No,nt),t.registerObject(qo,z),t.registerObject(Go,qo),t.registerObject(Ho,qo),t.registerObject(Xo,qo),t.registerObject(Ko,qo),t.registerObject(Qo,qo),t.registerObject(Yo,Qo),t.registerObject(ys,ts),t.registerObject(ii,z),t.registerObject(fi,z),t.registerObject(hi,fi),t.registerObject(gi,ii),t.registerObject(li,ii),t.registerObject(si,nt),t.registerObject(Ii,z),t.registerObject(zi,Ii),t.registerObject(ce,nt),t.registerObject(ga,nt),t.registerObject(Es,fn),t.registerObject(eu,fn),t.registerObject(Os,nt),t.registerObject(ts,z),t.registerObject(rs,ts),t.registerObject(ps,ts),t.registerObject(_s,ps),t.registerObject(ws,z),t.registerObject(ss,rs),t.registerObject(is,rs),t.registerObject(hs,ts),t.registerObject(ya,nt),t.registerObject(vs,ya),t.registerObject(us,z),t.registerObject(St,z),t.registerObject(At,z),t.registerObject(Et,At),t.registerObject(jt,At,!0),t.registerObject(Fa,jt),t.registerObject(La,jt),t.registerObject(Na,jt),t.registerObject(Va,jt),t.registerObject(Ua,jt),t.registerObject(Ga,jt),t.registerObject(Wa,jt),t.registerObject(qa,jt),t.registerObject(Xa,jt),t.registerObject(Ka,jt),t.registerObject(Ja,jt),t.registerObject(Ha,jt),t.registerObject(Za,jt),t.registerObject(Ya,jt),t.registerObject(mn,nt),t.registerObject(Ku,nt),t.registerObject(Ac,z),t.registerObject(Tc,z),t.registerObject(dn,z),t.registerObject(Cu,z),t.registerObject(Su,Ac),t.registerObject(Pu,Ac),t.registerObject(bu,Ac),t.registerObject(wu,Ac),t.registerObject(Eu,Ac),t.registerObject(Tu,Ac),t.registerObject(Bu,Su),t.registerObject(pu,Tc),t.registerObject(fu,Tc),t.registerObject(hu,Tc),t.registerObject(yu,Tc),t.registerObject(vu,Tc),t.registerObject(Pn,fn),t.registerObject(gn,z),t.registerObject(ta,fn),t.registerObject(Vi,z),t.registerObject(Ji,Vi),t.registerObject(Hu,Vi),t.registerObject(Wi,fn),t.registerObject(Xi,fn),t.registerObject(Gi,z),t.registerObject(Zi,z),t.registerObject(wc,rs),t.registerObject(zc,ts),t.registerObject(Mc,ts),t.registerObject(Qc,ps),t.registerObject(Xc,ps),t.registerObject(Gc,ps),t.registerObject(su,rs),t.registerObject(iu,nt)},TypeRegistration}(),Factory_spreadArray=function(t,n){for(var r=0,o=n.length,i=t.length;r<o;r++,i++)t[i]=n[r];return t};!function(t){t.objectRegister={},t.getObjectInfo=function getObjectInfo(n){return n in t.objectRegister?t.objectRegister[n]:(p.logError("Unknown object type: "+n),null)}}(Gu||(Gu={}));var yl,ml,vl=function(){function Factory(){}return Factory.prototype.registerObject=function(t,n,r){Gu.objectRegister[t.name]={createInstance:function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return new(t.bind.apply(t,Factory_spreadArray([void 0],n)))},createReference:function(n){return new v(t,n)},createAssetReference:function(n){return new K(t,void 0,n)},createComponentReference:function(){return new Gt(t)},createObjectArray:function(n){return new xt(t,n)},createReferenceArray:function(n){return new Rt(t,n)},createAssetReferenceArray:function(n){return new Kt(t,n)}},r&&(Gu.objectRegister[t.name].isAbstract=r),n&&S.registerRawTypeInfo(n.name,t.name)},Factory.prototype.createObject=function(t){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];var o=Gu.getObjectInfo(t),i=o&&!o.isAbstract?o.createInstance.apply(o,n):null;return i},Factory.prototype.createReference=function(t,n){var r=Gu.getObjectInfo(t);return r?r.createReference(n):null},Factory.prototype.createAssetReference=function(t,n){var r=Gu.getObjectInfo(t);return r?r.createAssetReference(Boolean(n)):null},Factory.prototype.createAssetReferenceArray=function(t,n){var r=Gu.getObjectInfo(t);return r?r.createAssetReferenceArray(n):null},Factory.prototype.createComponentReference=function(t){var n=Gu.getObjectInfo(t);return n?n.createComponentReference():null},Factory.prototype.createObjectArray=function(t,n){var r=Gu.getObjectInfo(t);return r?r.createObjectArray(n):null},Factory.prototype.createReferenceArray=function(t,n){var r=Gu.getObjectInfo(t);return r?r.createReferenceArray(n):null},Factory.prototype.isAbstract=function(t){if(t in Gu.objectRegister){var n=Gu.objectRegister[t].isAbstract;return void 0!==n&&n}return!1},Factory}(),gl=function(){function FactoryInternal(){}return FactoryInternal.create=function(t){var n=new vl;I.instance=n,dl.registerDefaultTypes(),t&&t.forEach((function(t){var r=t[0],o=t[1];return n.registerObject(r,o)})),S.buildTypeTree()},FactoryInternal}(),_l=function(){function Serializer(){}return Serializer.prototype.copyVertexBuffer=function(t){var n=ae.properties.VertexBuffer.writeProperty(t);return ae.properties.VertexBuffer.readProperty(JSON.parse(JSON.stringify(n)))},Serializer.prototype.serializeObject=function(t){return Ca.serializeObject(t)},Serializer.prototype.deserializeObject=function(t,n){Ca.deserializeObject(t,n)},Serializer}();(yl||(yl={})).create=function create(){B.instance=new _l},function(t){t.requests={}}(ml||(ml={}));var bl,wl=function(){function WebUtils(){}return WebUtils.request=function(t,n,r,o,i,a,c){var u=t+"_"+n,l=new XMLHttpRequest;if(l.onreadystatechange=function(){if(l.readyState===XMLHttpRequest.DONE){var t=null;u in ml.requests&&(t=ml.requests[u],delete ml.requests[u]),t&&(200===l.status||0===l.status?t&&("blob"===a?t.onSuccess(l.response):t.onSuccess(l.responseText)):t.onError(l.statusText))}},l.upload.onprogress=function(t){if(t.lengthComputable){var n=t.loaded/t.total*100;WebUtils.uploadProgressChanged.post(n)}},l.onprogress=function(t){if(t.lengthComputable){var n=t.loaded/t.total*100;WebUtils.downloadProgressChanged.post(n)}},a&&(l.responseType=a),ml.requests[u]={request:l,onSuccess:r,onError:o},l.open(t,n,!0),c)for(var p=0,f=Object.keys(c);p<f.length;p++){var h=f[p];l.setRequestHeader(h,c[h])}return l.send(i),u},WebUtils.abortRequest=function(t){var n=ml.requests[t],r=n?n.request:null;r&&(delete ml.requests[t],r.abort())},WebUtils.downloadProgressChanged=new W.AsyncEvent,WebUtils.uploadProgressChanged=new W.AsyncEvent,WebUtils}(),xl=function(){function DOMUtils(){}return DOMUtils.getWheelDelta=function(t,n){return 1===n?32*t:2===n?32*t*10:t},DOMUtils}();!function(t){t.translateEntityRef=function translateEntityRef(t,n,r){return!!(t.id&&t.id in n)&&(t.id=n[t.id],!0)},t.translateComponentRef=function translateComponentRef(t,n){return!!(t.entityId&&t.entityId in n)&&(t.entityId=n[t.entityId],!0)},t.recordTranslatedReference=function recordTranslatedReference(t,n,r,o,i){t&&(n in t||(t[n]={}),r in t[n]||(t[n][r]=[]),t[n][r][o]=i)},t.invParentMatrix=new A,t.localScale=new w}(bl||(bl={}));var Pl,Ol=function(){function EntityUtils(){}return EntityUtils.prototype.preserveWorldPosition=function(t,n){var r=t.transform;if(r){(u=n.transform?n.transform.worldMatrix:null)||(u=A.identity);var o=bl.invParentMatrix,i=r.worldMatrix;o.copy(u).invert(),r.eventsEnabled=!1,r.position.setFromMatrix(i).transform(o);var a=r.worldScale;o.getScale(r.scale),r.scale.x*=a.x,r.scale.y*=a.y,r.scale.z*=a.z,o.multiply(i).getRotation(r.rotation),r.eventsEnabled=!0}else{var c=t.getComponent(Mo);if(c){var u,l=n.getComponent(Mo);if(u=l?l.worldMatrix:null)u.translateFromCoords(-l.pivot.x*l.actualWidth,-l.pivot.y*l.actualHeight,0);else{var p=n.getComponent(Li);p&&(u=A.fromPool().copy(A.identity).translateFromCoords(p.offset.x,p.offset.y,0))}if(u){o=bl.invParentMatrix;var f=bl.localScale;i=c.worldMatrix;c.horizontalAlignment=Ao.Left,c.verticalAlignment=Eo.Top,c.margin.set(0,0,0,0),o.copy(u).invert(),c.offset.setFromMatrix(i).transform(o);a=c.absoluteScale;o.getScale(f),f.x*=a.x,f.y*=a.y,c.scale.set(f.x,f.y),o.multiply(i).getRotation(c.rotation)}}}},EntityUtils.prototype.updateLayoutMatrixIfNecessary=function(t){var n=this;t.traverse((function(t){var r=t.getComponent(Mo);return!!r&&(n.updateLayoutWorldMatrix(r),!0)}),!0)},EntityUtils.prototype.dirtifyWorldMatrixIfNecessary=function(t){var n=t.transform;n&&n.dirtifyWorldMatrix()},EntityUtils.prototype.updateLayoutWorldMatrix=function(t){var n=t.entity.getAncestorOfType(Li);n&&Bi.updateLayoutWorldMatrix(t,n.getResolution(ft.instance.screenSize),n.offset)},EntityUtils.prototype.translateReferences=function(t,n,r){t.traverse((function(t){return t.iterateComponents((function(o){for(var i=0,a=Object.keys(o);i<a.length;i++){var c=a[i],u=Ca.getSerializablePropertyTypeName(o,c);if("EntityReference"===u){var l=o[c];bl.translateEntityRef(l,n)&&bl.recordTranslatedReference(r,t.id,o.constructor.name,c,l)}else if("ComponentReference"===u){var p=o[c];bl.translateComponentRef(p,n)&&bl.recordTranslatedReference(r,t.id,o.constructor.name,c,p)}else if("ReferenceArray"===u)for(var f=o[c],h=0,d=f.data;h<d.length;h++){var y=d[h].instance;if(y)for(var m=0,v=Object.keys(y);m<v.length;m++){var g=v[m],_=Ca.getSerializablePropertyTypeName(y,g);if("EntityReference"===_){l=y[g];bl.translateEntityRef(l,n)&&bl.recordTranslatedReference(r,t.id,o.constructor.name,c,f)}else if("ComponentReference"===_){p=y[g];bl.translateComponentRef(p,n)&&bl.recordTranslatedReference(r,t.id,o.constructor.name,c,f)}}}else if("Reference"===u)if("_geometry"===c){var b=o[c];if(b.instance&&b.instance.isA(Mr)){l=b.instance[Mr.skeletonPropertyKey];bl.translateEntityRef(l,n)&&bl.recordTranslatedReference(r,t.id,o.constructor.name,c,o[c])}}else if("_fill"===c){var w=o[c];if(w.instance&&w.instance.isA(Xo)){p=w.instance[Xo.maskPropertyKey];bl.translateComponentRef(p,n)&&bl.recordTranslatedReference(r,t.id,o.constructor.name,c,p)}}}})),!0}),!0)},EntityUtils.prototype.sortComponents=function(t){return t.sort((function(t,n){var r=Reflect.getMetadata("sortOrder",t.constructor),o=void 0===r?-1:r,i=Reflect.getMetadata("sortOrder",n.constructor);return(void 0===i?-1:i)-o}))},EntityUtils}();(Pl||(Pl={})).create=function create(){Pa.instance=new Ol};var Cl,Sl,Al,Engine_assign=function(){return(Engine_assign=Object.assign||function(t){for(var n,r=1,o=arguments.length;r<o;r++)for(var i in n=arguments[r])Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i]);return t}).apply(this,arguments)};!function(t){t.canvasResized=!1,t.playRequestId=null,t.engineActive=!1,t.loadingInProgress=!1,t.keysDown=new Map,t.onDownloadProgressChanged=function onDownloadProgressChanged(n){t.engineConfig.onDownloadProgress&&t.engineConfig.onDownloadProgress(n,!1)},t.createFileInterface=function createFileInterface(n){if(n)return ht.a.instance=n,Promise.resolve();var o=Boolean(t.engineConfig.startupUrl)?r(105).FileInMemory:r(106).FileStandaloneWeb;return o?(ht.a.instance=new o,Promise.resolve()):Promise.reject("Could not create a file I/O interface on this platform")},t.downloadPlayableProject=function downloadPlayableProject(n){return new Promise((function(r,o){console.assert(!t.playRequestId),t.playRequestId=wl.request("GET",n,(function(n){t.engineConfig.onDownloadProgress&&t.engineConfig.onDownloadProgress(100,!0),wl.downloadProgressChanged.detach(t.onDownloadProgressChanged),In.importGameFromBlob(n,(function(){return r()}),o)}),(function(){return wl.downloadProgressChanged.detach(t.onDownloadProgressChanged)}),void 0,"blob"),wl.downloadProgressChanged.attach(t.onDownloadProgressChanged)}))}}(Cl||(Cl={})),function(t){function onTouchEnd(t){t.preventDefault();for(var n=0;n<t.changedTouches.length;++n){var r=Cl.targetCanvas.getBoundingClientRect(),o=t.changedTouches[n];Ai.onTouchUp(o.clientX-r.left,o.clientY-r.top,0);break}}t.onWindowResized=function onWindowResized(){Cl.targetCanvas&&(vc.processCanvasDimensions(Cl.targetCanvas),Cl.canvasResized=!0)},t.onMouseDown=function onMouseDown(t){var n=Cl.targetCanvas.getBoundingClientRect();Ai.onTouchDown(t.clientX-n.left,t.clientY-n.top,t.button),t.preventDefault()},t.onMouseWheel=function onMouseWheel(t){var n=xl.getWheelDelta(t.deltaY,t.deltaMode);Ai.onMouseWheel(n),t.preventDefault()},t.onMouseMove=function onMouseMove(t){var n=Cl.targetCanvas.getBoundingClientRect();Ai.onTouchMove(t.clientX-n.left,t.clientY-n.top,t.button),t.preventDefault()},t.onMouseUp=function onMouseUp(t){var n=Cl.targetCanvas.getBoundingClientRect();Ai.onTouchUp(t.clientX-n.left,t.clientY-n.top,t.button),t.preventDefault()},t.onTouchStart=function onTouchStart(t){t.preventDefault();for(var n=0;n<t.changedTouches.length;++n){var r=Cl.targetCanvas.getBoundingClientRect(),o=t.changedTouches[n];Ai.onTouchDown(o.clientX-r.left,o.clientY-r.top,0);break}},t.onTouchEnd=onTouchEnd,t.onTouchCancel=function onTouchCancel(t){t.preventDefault(),onTouchEnd(t)},t.onTouchMove=function onTouchMove(t){t.preventDefault();for(var n=0;n<t.changedTouches.length;++n){var r=Cl.targetCanvas.getBoundingClientRect(),o=t.changedTouches[n];Ai.onTouchMove(o.clientX-r.left,o.clientY-r.top,0);break}},t.onKeyDown=function onKeyDown(t){var n=Ai.keyChangedInfo;Cl.keysDown.has(t.keyCode)||(n.pressed=!0,n.keyCode=t.keyCode,Cl.keysDown.set(t.keyCode,!0),Si.keyChanged.post(n))},t.onKeyUp=function onKeyUp(t){var n=Ai.keyChangedInfo;n.pressed=!1,n.keyCode=t.keyCode,Cl.keysDown.delete(t.keyCode),Si.keyChanged.post(n)}}(Sl||(Sl={})),function(t){function unload(){Jo.unload(),Dn.destroy(),yt.instance.clearCache(),pa.clear()}function render(t,n,r,o,i){Cl.canvasResized&&(t.forEach((function(t){return t.invalidateFrustum()})),Cl.canvasResized=!1);for(var a=0,c=Dn.list();a<c.length;a++){var u=c[a];vc.render(u.environment,u.fog,t,n,r,o,i)}}t.targetCanvas=function(){return Cl.targetCanvas},t.initializeWithCanvas=function initializeWithCanvas(t){var n={alpha:Tn.instance.canvasAlpha},r=t.getContext("webgl2",n),o=r||t.getContext("webgl",n)||t.getContext("experimental-webgl",n);return o?(at.create(o,r?2:1),Ee.initialize(),"isMobile"in window&&window.isMobile.any?(t.addEventListener("touchstart",Sl.onTouchStart),t.addEventListener("touchend",Sl.onTouchEnd),t.addEventListener("touchcancel",Sl.onTouchCancel),t.addEventListener("touchmove",Sl.onTouchMove)):(t.addEventListener("mousemove",Sl.onMouseMove),t.addEventListener("mouseup",Sl.onMouseUp),t.addEventListener("mousedown",Sl.onMouseDown),t.addEventListener("wheel",Sl.onMouseWheel,{passive:!1})),window.addEventListener("resize",Sl.onWindowResized),window.addEventListener("keyup",Sl.onKeyUp),window.addEventListener("keydown",Sl.onKeyDown),Promise.resolve()):Promise.reject(xn.WebGLContextCreationFailed)},t.unload=unload,t.reload=function reload(){return unload(),Tn.load().then((function(){return Ds.load()})).then((function(){return at.context?Promise.resolve():t.initializeWithCanvas(Cl.targetCanvas)}))},t.flushPools=function flushPools(){h.pool.flush(),w.pool.flush(),Bt.pool.flush(),A.pool.flush(),Dt.pool.flush(),N.pool.flush(),kt.pool.flush(),le.pool.flush(),Ft.pool.flush()},t.render=render,t.updateFrame=function updateFrame(){if(Cl.engineActive){if(Cl.loadingInProgress=Vn.updateLoading(),!Ds.isLoaded())return Cl.loadingInProgress=!0,void requestAnimationFrame(updateFrame);Dn.updateTransition(),Oe.updateDeltaTime(),t.flushPools();var n=Dn.list();if(0===n.length)return at.context.clear(at.context.COLOR_BUFFER_BIT|at.context.DEPTH_BUFFER_BIT),void requestAnimationFrame(updateFrame);if(!n.every((function(t){return t.isLoaded()})))return Cl.loadingInProgress=!0,void requestAnimationFrame(updateFrame);Dn.updatePreloading(),Cl.loadingInProgress=!1,ra.update();var r=dr.ofTypes([zr,Vc,Li,ec,hl]),o=r.Camera;o.sort((function(t,n){return t.priority-n.priority}));var i=Cl.engineConfig;render(o,r,i.preRender,i.postRender,i.uiPostRender),requestAnimationFrame(updateFrame)}}}(Al||(Al={}));var El=function(){function Engine(){}return Engine.create=function(t){var n,r,o,i,a;p.log("SpiderEngine creation - Platform: web, Config: standalone, Env: production"),Cl.engineConfig=t,Mn.create(),gl.create(t.customTypes),yl.create(),Pl.create(),t.container&&(Cl.targetCanvas=t.container,vc.create(Cl.targetCanvas),Ai.create((n=Cl.targetCanvas.getBoundingClientRect(),r=n.left,o=n.top,i=n.width,a=n.height,new h(t.initialTouchPosition?t.initialTouchPosition.x-r:i/2,t.initialTouchPosition?t.initialTouchPosition.y-o:a/2))));return Cl.createFileInterface(t.customFileIO).then((function(){return t.startupUrl?Cl.downloadPlayableProject(t.startupUrl):Promise.resolve()})).then((function(){return Cl.targetCanvas?Promise.resolve().then((function(){return Promise.resolve()})).then((function(){return Tn.load()})).then((function(){return Boolean(Cl.engineConfig.startupUrl)||Tn.instance.useCustomDefaultAssets?Promise.resolve():sa.request({method:"GET",url:"/dist/default-assets.json"}).then((function(t){var n=JSON.parse(t),r=Object.entries(n).reduce((function(t,n){var r,o=n[0],i=n[1];return Engine_assign(Engine_assign({},t),((r={})["Assets/DefaultAssets/"+o]=JSON.stringify(i),r))}),{});ht.a.defaultAssets=r}))})).then((function(){return Al.initializeWithCanvas(Cl.targetCanvas)})):Promise.resolve()})).then((function(){return we.preload()})).then((function(){return Ds.load()})).then((function(){if(Cl.targetCanvas){Cl.engineActive=!0,Al.updateFrame();var n=t.startupScene||Tn.instance.startupScene;if(n)return Un.load(n)}return Promise.resolve(null)})).then((function(n){n&&t.onSceneLoaded&&t.onSceneLoaded(n.templatePath)})).catch((function(t){return Cl.engineActive=!1,Promise.reject(t)}))},Engine.destroy=function(){if(Cl.engineActive&&(p.log("SpiderEngine destruction"),Cl.engineActive=!1,wl.downloadProgressChanged.detach(Cl.onDownloadProgressChanged),Cl.playRequestId&&(wl.abortRequest(Cl.playRequestId),Cl.playRequestId=null),Cl.engineConfig.container)){Ee.destroy();var t="isMobile"in window&&window.isMobile.any,n=Cl.targetCanvas;t?(n.removeEventListener("touchstart",Sl.onTouchStart),n.removeEventListener("touchend",Sl.onTouchEnd),n.removeEventListener("touchcancel",Sl.onTouchCancel),n.removeEventListener("touchmove",Sl.onTouchMove)):(n.removeEventListener("mousemove",Sl.onMouseMove),n.removeEventListener("mouseup",Sl.onMouseUp),n.removeEventListener("mousedown",Sl.onMouseDown),n.removeEventListener("wheel",Sl.onMouseWheel)),window.removeEventListener("resize",Sl.onWindowResized),window.removeEventListener("keyup",Sl.onKeyUp),window.removeEventListener("keydown",Sl.onKeyDown),Al.unload()}},Engine.isLoadingInProgress=function(){return Cl.loadingInProgress},Engine}()}]));
      